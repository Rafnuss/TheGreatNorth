(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))m(g);new MutationObserver(g=>{for(const b of g)if(b.type==="childList")for(const E of b.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&m(E)}).observe(document,{childList:!0,subtree:!0});function c(g){const b={};return g.integrity&&(b.integrity=g.integrity),g.referrerPolicy&&(b.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?b.credentials="include":g.crossOrigin==="anonymous"?b.credentials="omit":b.credentials="same-origin",b}function m(g){if(g.ep)return;g.ep=!0;const b=c(g);fetch(g.href,b)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Au(a){const s=Object.create(null);for(const c of a.split(","))s[c]=1;return c=>c in s}const ys={},cf=[],yo=()=>{},mz=()=>!1,Rf=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&(a.charCodeAt(2)>122||a.charCodeAt(2)<97),a1=a=>a.startsWith("onUpdate:"),Lr=Object.assign,l1=(a,s)=>{const c=a.indexOf(s);c>-1&&a.splice(c,1)},_z=Object.prototype.hasOwnProperty,cs=(a,s)=>_z.call(a,s),Hi=Array.isArray,hf=a=>x_(a)==="[object Map]",Iu=a=>x_(a)==="[object Set]",r2=a=>x_(a)==="[object Date]",vn=a=>typeof a=="function",ps=a=>typeof a=="string",qa=a=>typeof a=="symbol",As=a=>a!==null&&typeof a=="object",xf=a=>(As(a)||vn(a))&&vn(a.then)&&vn(a.catch),FI=Object.prototype.toString,x_=a=>FI.call(a),gz=a=>x_(a).slice(8,-1),BI=a=>x_(a)==="[object Object]",c1=a=>ps(a)&&a!=="NaN"&&a[0]!=="-"&&""+parseInt(a,10)===a,uf=Au(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Lx=a=>{const s=Object.create(null);return c=>s[c]||(s[c]=a(c))},yz=/-(\w)/g,jc=Lx(a=>a.replace(yz,(s,c)=>c?c.toUpperCase():"")),xz=/\B([A-Z])/g,Zc=Lx(a=>a.replace(xz,"-$1").toLowerCase()),NI=Lx(a=>a.charAt(0).toUpperCase()+a.slice(1)),Q0=Lx(a=>a?`on${NI(a)}`:""),Bc=(a,s)=>!Object.is(a,s),Qy=(a,...s)=>{for(let c=0;c<a.length;c++)a[c](...s)},Fb=(a,s,c,m=!1)=>{Object.defineProperty(a,s,{configurable:!0,enumerable:!1,writable:m,value:c})},dx=a=>{const s=parseFloat(a);return isNaN(s)?a:s};let o2;const v_=()=>o2||(o2=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function zx(a){if(Hi(a)){const s={};for(let c=0;c<a.length;c++){const m=a[c],g=ps(m)?Tz(m):zx(m);if(g)for(const b in g)s[b]=g[b]}return s}else if(ps(a)||As(a))return a}const vz=/;(?![^(]*\))/g,bz=/:([^]+)/,wz=/\/\*[^]*?\*\//g;function Tz(a){const s={};return a.replace(wz,"").split(vz).forEach(c=>{if(c){const m=c.split(bz);m.length>1&&(s[m[0].trim()]=m[1].trim())}}),s}function Sz(a){if(!a)return"";if(ps(a))return a;let s="";for(const c in a){const m=a[c];if(ps(m)||typeof m=="number"){const g=c.startsWith("--")?c:Zc(c);s+=`${g}:${m};`}}return s}function la(a){let s="";if(ps(a))s=a;else if(Hi(a))for(let c=0;c<a.length;c++){const m=la(a[c]);m&&(s+=m+" ")}else if(As(a))for(const c in a)a[c]&&(s+=c+" ");return s.trim()}const Ez="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",Az="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",Iz=Au(Ez),Cz=Au(Az),VI="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Mz=Au(VI),Pz=Au(VI+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,inert,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected");function h1(a){return!!a||a===""}const Dz=/[>/="'\u0009\u000a\u000c\u0020]/,eb={};function Rz(a){if(eb.hasOwnProperty(a))return eb[a];const s=Dz.test(a);return s&&console.error(`unsafe attribute name: ${a}`),eb[a]=!s}const Lz={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"};function zz(a){if(a==null)return!1;const s=typeof a;return s==="string"||s==="number"||s==="boolean"}const Oz=/["'&<>]/;function Nc(a){const s=""+a,c=Oz.exec(s);if(!c)return s;let m="",g,b,E=0;for(b=c.index;b<s.length;b++){switch(s.charCodeAt(b)){case 34:g="&quot;";break;case 38:g="&amp;";break;case 39:g="&#39;";break;case 60:g="&lt;";break;case 62:g="&gt;";break;default:continue}E!==b&&(m+=s.slice(E,b)),E=b+1,m+=g}return E!==b?m+s.slice(E,b):m}const kz=/^-?>|<!--|-->|--!>|<!-$/g;function Fz(a){return a.replace(kz,"")}function Bz(a,s){if(a.length!==s.length)return!1;let c=!0;for(let m=0;c&&m<a.length;m++)c=Lf(a[m],s[m]);return c}function Lf(a,s){if(a===s)return!0;let c=r2(a),m=r2(s);if(c||m)return c&&m?a.getTime()===s.getTime():!1;if(c=qa(a),m=qa(s),c||m)return a===s;if(c=Hi(a),m=Hi(s),c||m)return c&&m?Bz(a,s):!1;if(c=As(a),m=As(s),c||m){if(!c||!m)return!1;const g=Object.keys(a).length,b=Object.keys(s).length;if(g!==b)return!1;for(const E in a){const n=a.hasOwnProperty(E),R=s.hasOwnProperty(E);if(n&&!R||!n&&R||!Lf(a[E],s[E]))return!1}}return String(a)===String(s)}function Ox(a,s){return a.findIndex(c=>Lf(c,s))}const UI=a=>!!(a&&a.__v_isRef===!0),dr=a=>ps(a)?a:a==null?"":Hi(a)||As(a)&&(a.toString===FI||!vn(a.toString))?UI(a)?dr(a.value):JSON.stringify(a,jI,2):String(a),jI=(a,s)=>UI(s)?jI(a,s.value):hf(s)?{[`Map(${s.size})`]:[...s.entries()].reduce((c,[m,g],b)=>(c[tb(m,b)+" =>"]=g,c),{})}:Iu(s)?{[`Set(${s.size})`]:[...s.values()].map(c=>tb(c))}:qa(s)?tb(s):As(s)&&!Hi(s)&&!BI(s)?String(s):s,tb=(a,s="")=>{var c;return qa(a)?`Symbol(${(c=a.description)!=null?c:s})`:a};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let eo;class Nz{constructor(s=!1){this.detached=s,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=eo,!s&&eo&&(this.index=(eo.scopes||(eo.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let s,c;if(this.scopes)for(s=0,c=this.scopes.length;s<c;s++)this.scopes[s].pause();for(s=0,c=this.effects.length;s<c;s++)this.effects[s].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let s,c;if(this.scopes)for(s=0,c=this.scopes.length;s<c;s++)this.scopes[s].resume();for(s=0,c=this.effects.length;s<c;s++)this.effects[s].resume()}}run(s){if(this._active){const c=eo;try{return eo=this,s()}finally{eo=c}}}on(){++this._on===1&&(this.prevScope=eo,eo=this)}off(){this._on>0&&--this._on===0&&(eo=this.prevScope,this.prevScope=void 0)}stop(s){if(this._active){this._active=!1;let c,m;for(c=0,m=this.effects.length;c<m;c++)this.effects[c].stop();for(this.effects.length=0,c=0,m=this.cleanups.length;c<m;c++)this.cleanups[c]();if(this.cleanups.length=0,this.scopes){for(c=0,m=this.scopes.length;c<m;c++)this.scopes[c].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!s){const g=this.parent.scopes.pop();g&&g!==this&&(this.parent.scopes[this.index]=g,g.index=this.index)}this.parent=void 0}}}function Vz(){return eo}let Ss;const ib=new WeakSet;class $I{constructor(s){this.fn=s,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,eo&&eo.active&&eo.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,ib.has(this)&&(ib.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||HI(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,a2(this),WI(this);const s=Ss,c=ua;Ss=this,ua=!0;try{return this.fn()}finally{qI(this),Ss=s,ua=c,this.flags&=-3}}stop(){if(this.flags&1){for(let s=this.deps;s;s=s.nextDep)f1(s);this.deps=this.depsTail=void 0,a2(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?ib.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Bb(this)&&this.run()}get dirty(){return Bb(this)}}let GI=0,Hm,Wm;function HI(a,s=!1){if(a.flags|=8,s){a.next=Wm,Wm=a;return}a.next=Hm,Hm=a}function u1(){GI++}function d1(){if(--GI>0)return;if(Wm){let s=Wm;for(Wm=void 0;s;){const c=s.next;s.next=void 0,s.flags&=-9,s=c}}let a;for(;Hm;){let s=Hm;for(Hm=void 0;s;){const c=s.next;if(s.next=void 0,s.flags&=-9,s.flags&1)try{s.trigger()}catch(m){a||(a=m)}s=c}}if(a)throw a}function WI(a){for(let s=a.deps;s;s=s.nextDep)s.version=-1,s.prevActiveLink=s.dep.activeLink,s.dep.activeLink=s}function qI(a){let s,c=a.depsTail,m=c;for(;m;){const g=m.prevDep;m.version===-1?(m===c&&(c=g),f1(m),Uz(m)):s=m,m.dep.activeLink=m.prevActiveLink,m.prevActiveLink=void 0,m=g}a.deps=s,a.depsTail=c}function Bb(a){for(let s=a.deps;s;s=s.nextDep)if(s.dep.version!==s.version||s.dep.computed&&(ZI(s.dep.computed)||s.dep.version!==s.version))return!0;return!!a._dirty}function ZI(a){if(a.flags&4&&!(a.flags&16)||(a.flags&=-17,a.globalVersion===i_)||(a.globalVersion=i_,!a.isSSR&&a.flags&128&&(!a.deps&&!a._dirty||!Bb(a))))return;a.flags|=2;const s=a.dep,c=Ss,m=ua;Ss=a,ua=!0;try{WI(a);const g=a.fn(a._value);(s.version===0||Bc(g,a._value))&&(a.flags|=128,a._value=g,s.version++)}catch(g){throw s.version++,g}finally{Ss=c,ua=m,qI(a),a.flags&=-3}}function f1(a,s=!1){const{dep:c,prevSub:m,nextSub:g}=a;if(m&&(m.nextSub=g,a.prevSub=void 0),g&&(g.prevSub=m,a.nextSub=void 0),c.subs===a&&(c.subs=m,!m&&c.computed)){c.computed.flags&=-5;for(let b=c.computed.deps;b;b=b.nextDep)f1(b,!0)}!s&&!--c.sc&&c.map&&c.map.delete(c.key)}function Uz(a){const{prevDep:s,nextDep:c}=a;s&&(s.nextDep=c,a.prevDep=void 0),c&&(c.prevDep=s,a.nextDep=void 0)}let ua=!0;const XI=[];function Ol(){XI.push(ua),ua=!1}function kl(){const a=XI.pop();ua=a===void 0?!0:a}function a2(a){const{cleanup:s}=a;if(a.cleanup=void 0,s){const c=Ss;Ss=void 0;try{s()}finally{Ss=c}}}let i_=0;class jz{constructor(s,c){this.sub=s,this.dep=c,this.version=c.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class p1{constructor(s){this.computed=s,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(s){if(!Ss||!ua||Ss===this.computed)return;let c=this.activeLink;if(c===void 0||c.sub!==Ss)c=this.activeLink=new jz(Ss,this),Ss.deps?(c.prevDep=Ss.depsTail,Ss.depsTail.nextDep=c,Ss.depsTail=c):Ss.deps=Ss.depsTail=c,YI(c);else if(c.version===-1&&(c.version=this.version,c.nextDep)){const m=c.nextDep;m.prevDep=c.prevDep,c.prevDep&&(c.prevDep.nextDep=m),c.prevDep=Ss.depsTail,c.nextDep=void 0,Ss.depsTail.nextDep=c,Ss.depsTail=c,Ss.deps===c&&(Ss.deps=m)}return c}trigger(s){this.version++,i_++,this.notify(s)}notify(s){u1();try{for(let c=this.subs;c;c=c.prevSub)c.sub.notify()&&c.sub.dep.notify()}finally{d1()}}}function YI(a){if(a.dep.sc++,a.sub.flags&4){const s=a.dep.computed;if(s&&!a.dep.subs){s.flags|=20;for(let m=s.deps;m;m=m.nextDep)YI(m)}const c=a.dep.subs;c!==a&&(a.prevSub=c,c&&(c.nextSub=a)),a.dep.subs=a}}const fx=new WeakMap,yu=Symbol(""),Nb=Symbol(""),n_=Symbol("");function Dr(a,s,c){if(ua&&Ss){let m=fx.get(a);m||fx.set(a,m=new Map);let g=m.get(c);g||(m.set(c,g=new p1),g.map=m,g.key=c),g.track()}}function Pl(a,s,c,m,g,b){const E=fx.get(a);if(!E){i_++;return}const n=R=>{R&&R.trigger()};if(u1(),s==="clear")E.forEach(n);else{const R=Hi(a),B=R&&c1(c);if(R&&c==="length"){const N=Number(m);E.forEach((X,ie)=>{(ie==="length"||ie===n_||!qa(ie)&&ie>=N)&&n(X)})}else switch((c!==void 0||E.has(void 0))&&n(E.get(c)),B&&n(E.get(n_)),s){case"add":R?B&&n(E.get("length")):(n(E.get(yu)),hf(a)&&n(E.get(Nb)));break;case"delete":R||(n(E.get(yu)),hf(a)&&n(E.get(Nb)));break;case"set":hf(a)&&n(E.get(yu));break}}d1()}function $z(a,s){const c=fx.get(a);return c&&c.get(s)}function Yd(a){const s=Qn(a);return s===a?s:(Dr(s,"iterate",n_),Oo(a)?s:s.map(vr))}function kx(a){return Dr(a=Qn(a),"iterate",n_),a}const Gz={__proto__:null,[Symbol.iterator](){return nb(this,Symbol.iterator,vr)},concat(...a){return Yd(this).concat(...a.map(s=>Hi(s)?Yd(s):s))},entries(){return nb(this,"entries",a=>(a[1]=vr(a[1]),a))},every(a,s){return Sl(this,"every",a,s,void 0,arguments)},filter(a,s){return Sl(this,"filter",a,s,c=>c.map(vr),arguments)},find(a,s){return Sl(this,"find",a,s,vr,arguments)},findIndex(a,s){return Sl(this,"findIndex",a,s,void 0,arguments)},findLast(a,s){return Sl(this,"findLast",a,s,vr,arguments)},findLastIndex(a,s){return Sl(this,"findLastIndex",a,s,void 0,arguments)},forEach(a,s){return Sl(this,"forEach",a,s,void 0,arguments)},includes(...a){return sb(this,"includes",a)},indexOf(...a){return sb(this,"indexOf",a)},join(a){return Yd(this).join(a)},lastIndexOf(...a){return sb(this,"lastIndexOf",a)},map(a,s){return Sl(this,"map",a,s,void 0,arguments)},pop(){return Cm(this,"pop")},push(...a){return Cm(this,"push",a)},reduce(a,...s){return l2(this,"reduce",a,s)},reduceRight(a,...s){return l2(this,"reduceRight",a,s)},shift(){return Cm(this,"shift")},some(a,s){return Sl(this,"some",a,s,void 0,arguments)},splice(...a){return Cm(this,"splice",a)},toReversed(){return Yd(this).toReversed()},toSorted(a){return Yd(this).toSorted(a)},toSpliced(...a){return Yd(this).toSpliced(...a)},unshift(...a){return Cm(this,"unshift",a)},values(){return nb(this,"values",vr)}};function nb(a,s,c){const m=kx(a),g=m[s]();return m!==a&&!Oo(a)&&(g._next=g.next,g.next=()=>{const b=g._next();return b.value&&(b.value=c(b.value)),b}),g}const Hz=Array.prototype;function Sl(a,s,c,m,g,b){const E=kx(a),n=E!==a&&!Oo(a),R=E[s];if(R!==Hz[s]){const X=R.apply(a,b);return n?vr(X):X}let B=c;E!==a&&(n?B=function(X,ie){return c.call(this,vr(X),ie,a)}:c.length>2&&(B=function(X,ie){return c.call(this,X,ie,a)}));const N=R.call(E,B,m);return n&&g?g(N):N}function l2(a,s,c,m){const g=kx(a);let b=c;return g!==a&&(Oo(a)?c.length>3&&(b=function(E,n,R){return c.call(this,E,n,R,a)}):b=function(E,n,R){return c.call(this,E,vr(n),R,a)}),g[s](b,...m)}function sb(a,s,c){const m=Qn(a);Dr(m,"iterate",n_);const g=m[s](...c);return(g===-1||g===!1)&&b_(c[0])?(c[0]=Qn(c[0]),m[s](...c)):g}function Cm(a,s,c=[]){Ol(),u1();const m=Qn(a)[s].apply(a,c);return d1(),kl(),m}const Wz=Au("__proto__,__v_isRef,__isVue"),KI=new Set(Object.getOwnPropertyNames(Symbol).filter(a=>a!=="arguments"&&a!=="caller").map(a=>Symbol[a]).filter(qa));function qz(a){qa(a)||(a=String(a));const s=Qn(this);return Dr(s,"has",a),s.hasOwnProperty(a)}class JI{constructor(s=!1,c=!1){this._isReadonly=s,this._isShallow=c}get(s,c,m){if(c==="__v_skip")return s.__v_skip;const g=this._isReadonly,b=this._isShallow;if(c==="__v_isReactive")return!g;if(c==="__v_isReadonly")return g;if(c==="__v_isShallow")return b;if(c==="__v_raw")return m===(g?b?nO:iC:b?tC:eC).get(s)||Object.getPrototypeOf(s)===Object.getPrototypeOf(m)?s:void 0;const E=Hi(s);if(!g){let R;if(E&&(R=Gz[c]))return R;if(c==="hasOwnProperty")return qz}const n=Reflect.get(s,c,br(s)?s:m);return(qa(c)?KI.has(c):Wz(c))||(g||Dr(s,"get",c),b)?n:br(n)?E&&c1(c)?n:n.value:As(n)?g?nC(n):_1(n):n}}class QI extends JI{constructor(s=!1){super(!1,s)}set(s,c,m,g){let b=s[c];if(!this._isShallow){const R=$c(b);if(!Oo(m)&&!$c(m)&&(b=Qn(b),m=Qn(m)),!Hi(s)&&br(b)&&!br(m))return R?!1:(b.value=m,!0)}const E=Hi(s)&&c1(c)?Number(c)<s.length:cs(s,c),n=Reflect.set(s,c,m,br(s)?s:g);return s===Qn(g)&&(E?Bc(m,b)&&Pl(s,"set",c,m):Pl(s,"add",c,m)),n}deleteProperty(s,c){const m=cs(s,c);s[c];const g=Reflect.deleteProperty(s,c);return g&&m&&Pl(s,"delete",c,void 0),g}has(s,c){const m=Reflect.has(s,c);return(!qa(c)||!KI.has(c))&&Dr(s,"has",c),m}ownKeys(s){return Dr(s,"iterate",Hi(s)?"length":yu),Reflect.ownKeys(s)}}class Zz extends JI{constructor(s=!1){super(!0,s)}set(s,c){return!0}deleteProperty(s,c){return!0}}const Xz=new QI,Yz=new Zz,Kz=new QI(!0);const Vb=a=>a,Ay=a=>Reflect.getPrototypeOf(a);function Jz(a,s,c){return function(...m){const g=this.__v_raw,b=Qn(g),E=hf(b),n=a==="entries"||a===Symbol.iterator&&E,R=a==="keys"&&E,B=g[a](...m),N=c?Vb:s?px:vr;return!s&&Dr(b,"iterate",R?Nb:yu),{next(){const{value:X,done:ie}=B.next();return ie?{value:X,done:ie}:{value:n?[N(X[0]),N(X[1])]:N(X),done:ie}},[Symbol.iterator](){return this}}}}function Iy(a){return function(...s){return a==="delete"?!1:a==="clear"?void 0:this}}function Qz(a,s){const c={get(g){const b=this.__v_raw,E=Qn(b),n=Qn(g);a||(Bc(g,n)&&Dr(E,"get",g),Dr(E,"get",n));const{has:R}=Ay(E),B=s?Vb:a?px:vr;if(R.call(E,g))return B(b.get(g));if(R.call(E,n))return B(b.get(n));b!==E&&b.get(g)},get size(){const g=this.__v_raw;return!a&&Dr(Qn(g),"iterate",yu),Reflect.get(g,"size",g)},has(g){const b=this.__v_raw,E=Qn(b),n=Qn(g);return a||(Bc(g,n)&&Dr(E,"has",g),Dr(E,"has",n)),g===n?b.has(g):b.has(g)||b.has(n)},forEach(g,b){const E=this,n=E.__v_raw,R=Qn(n),B=s?Vb:a?px:vr;return!a&&Dr(R,"iterate",yu),n.forEach((N,X)=>g.call(b,B(N),B(X),E))}};return Lr(c,a?{add:Iy("add"),set:Iy("set"),delete:Iy("delete"),clear:Iy("clear")}:{add(g){!s&&!Oo(g)&&!$c(g)&&(g=Qn(g));const b=Qn(this);return Ay(b).has.call(b,g)||(b.add(g),Pl(b,"add",g,g)),this},set(g,b){!s&&!Oo(b)&&!$c(b)&&(b=Qn(b));const E=Qn(this),{has:n,get:R}=Ay(E);let B=n.call(E,g);B||(g=Qn(g),B=n.call(E,g));const N=R.call(E,g);return E.set(g,b),B?Bc(b,N)&&Pl(E,"set",g,b):Pl(E,"add",g,b),this},delete(g){const b=Qn(this),{has:E,get:n}=Ay(b);let R=E.call(b,g);R||(g=Qn(g),R=E.call(b,g)),n&&n.call(b,g);const B=b.delete(g);return R&&Pl(b,"delete",g,void 0),B},clear(){const g=Qn(this),b=g.size!==0,E=g.clear();return b&&Pl(g,"clear",void 0,void 0),E}}),["keys","values","entries",Symbol.iterator].forEach(g=>{c[g]=Jz(g,a,s)}),c}function m1(a,s){const c=Qz(a,s);return(m,g,b)=>g==="__v_isReactive"?!a:g==="__v_isReadonly"?a:g==="__v_raw"?m:Reflect.get(cs(c,g)&&g in m?c:m,g,b)}const eO={get:m1(!1,!1)},tO={get:m1(!1,!0)},iO={get:m1(!0,!1)};const eC=new WeakMap,tC=new WeakMap,iC=new WeakMap,nO=new WeakMap;function sO(a){switch(a){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function rO(a){return a.__v_skip||!Object.isExtensible(a)?0:sO(gz(a))}function _1(a){return $c(a)?a:g1(a,!1,Xz,eO,eC)}function oO(a){return g1(a,!1,Kz,tO,tC)}function nC(a){return g1(a,!0,Yz,iO,iC)}function g1(a,s,c,m,g){if(!As(a)||a.__v_raw&&!(s&&a.__v_isReactive))return a;const b=rO(a);if(b===0)return a;const E=g.get(a);if(E)return E;const n=new Proxy(a,b===2?m:c);return g.set(a,n),n}function xu(a){return $c(a)?xu(a.__v_raw):!!(a&&a.__v_isReactive)}function $c(a){return!!(a&&a.__v_isReadonly)}function Oo(a){return!!(a&&a.__v_isShallow)}function b_(a){return a?!!a.__v_raw:!1}function Qn(a){const s=a&&a.__v_raw;return s?Qn(s):a}function aO(a){return!cs(a,"__v_skip")&&Object.isExtensible(a)&&Fb(a,"__v_skip",!0),a}const vr=a=>As(a)?_1(a):a,px=a=>As(a)?nC(a):a;function br(a){return a?a.__v_isRef===!0:!1}function mo(a){return rC(a,!1)}function sC(a){return rC(a,!0)}function rC(a,s){return br(a)?a:new lO(a,s)}class lO{constructor(s,c){this.dep=new p1,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=c?s:Qn(s),this._value=c?s:vr(s),this.__v_isShallow=c}get value(){return this.dep.track(),this._value}set value(s){const c=this._rawValue,m=this.__v_isShallow||Oo(s)||$c(s);s=m?s:Qn(s),Bc(s,c)&&(this._rawValue=s,this._value=m?s:vr(s),this.dep.trigger())}}function aa(a){return br(a)?a.value:a}const cO={get:(a,s,c)=>s==="__v_raw"?a:aa(Reflect.get(a,s,c)),set:(a,s,c,m)=>{const g=a[s];return br(g)&&!br(c)?(g.value=c,!0):Reflect.set(a,s,c,m)}};function oC(a){return xu(a)?a:new Proxy(a,cO)}function hO(a){const s=Hi(a)?new Array(a.length):{};for(const c in a)s[c]=dO(a,c);return s}class uO{constructor(s,c,m){this._object=s,this._key=c,this._defaultValue=m,this.__v_isRef=!0,this._value=void 0}get value(){const s=this._object[this._key];return this._value=s===void 0?this._defaultValue:s}set value(s){this._object[this._key]=s}get dep(){return $z(Qn(this._object),this._key)}}function dO(a,s,c){const m=a[s];return br(m)?m:new uO(a,s,c)}class fO{constructor(s,c,m){this.fn=s,this.setter=c,this._value=void 0,this.dep=new p1(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=i_-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!c,this.isSSR=m}notify(){if(this.flags|=16,!(this.flags&8)&&Ss!==this)return HI(this,!0),!0}get value(){const s=this.dep.track();return ZI(this),s&&(s.version=this.dep.version),this._value}set value(s){this.setter&&this.setter(s)}}function pO(a,s,c=!1){let m,g;return vn(a)?m=a:(m=a.get,g=a.set),new fO(m,g,c)}const Cy={},mx=new WeakMap;let cu;function mO(a,s=!1,c=cu){if(c){let m=mx.get(c);m||mx.set(c,m=[]),m.push(a)}}function _O(a,s,c=ys){const{immediate:m,deep:g,once:b,scheduler:E,augmentJob:n,call:R}=c,B=Oe=>g?Oe:Oo(Oe)||g===!1||g===0?Dl(Oe,1):Dl(Oe);let N,X,ie,se,we=!1,pe=!1;if(br(a)?(X=()=>a.value,we=Oo(a)):xu(a)?(X=()=>B(a),we=!0):Hi(a)?(pe=!0,we=a.some(Oe=>xu(Oe)||Oo(Oe)),X=()=>a.map(Oe=>{if(br(Oe))return Oe.value;if(xu(Oe))return B(Oe);if(vn(Oe))return R?R(Oe,2):Oe()})):vn(a)?s?X=R?()=>R(a,2):a:X=()=>{if(ie){Ol();try{ie()}finally{kl()}}const Oe=cu;cu=N;try{return R?R(a,3,[se]):a(se)}finally{cu=Oe}}:X=yo,s&&g){const Oe=X,tt=g===!0?1/0:g;X=()=>Dl(Oe(),tt)}const Ae=Vz(),Ie=()=>{N.stop(),Ae&&Ae.active&&l1(Ae.effects,N)};if(b&&s){const Oe=s;s=(...tt)=>{Oe(...tt),Ie()}}let Je=pe?new Array(a.length).fill(Cy):Cy;const Pe=Oe=>{if(!(!(N.flags&1)||!N.dirty&&!Oe))if(s){const tt=N.run();if(g||we||(pe?tt.some((xt,Tt)=>Bc(xt,Je[Tt])):Bc(tt,Je))){ie&&ie();const xt=cu;cu=N;try{const Tt=[tt,Je===Cy?void 0:pe&&Je[0]===Cy?[]:Je,se];Je=tt,R?R(s,3,Tt):s(...Tt)}finally{cu=xt}}}else N.run()};return n&&n(Pe),N=new $I(X),N.scheduler=E?()=>E(Pe,!1):Pe,se=Oe=>mO(Oe,!1,N),ie=N.onStop=()=>{const Oe=mx.get(N);if(Oe){if(R)R(Oe,4);else for(const tt of Oe)tt();mx.delete(N)}},s?m?Pe(!0):Je=N.run():E?E(Pe.bind(null,!0),!0):N.run(),Ie.pause=N.pause.bind(N),Ie.resume=N.resume.bind(N),Ie.stop=Ie,Ie}function Dl(a,s=1/0,c){if(s<=0||!As(a)||a.__v_skip||(c=c||new Set,c.has(a)))return a;if(c.add(a),s--,br(a))Dl(a.value,s,c);else if(Hi(a))for(let m=0;m<a.length;m++)Dl(a[m],s,c);else if(Iu(a)||hf(a))a.forEach(m=>{Dl(m,s,c)});else if(BI(a)){for(const m in a)Dl(a[m],s,c);for(const m of Object.getOwnPropertySymbols(a))Object.prototype.propertyIsEnumerable.call(a,m)&&Dl(a[m],s,c)}return a}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function w_(a,s,c,m){try{return m?a(...m):a()}catch(g){Fx(g,s,c)}}function Za(a,s,c,m){if(vn(a)){const g=w_(a,s,c,m);return g&&xf(g)&&g.catch(b=>{Fx(b,s,c)}),g}if(Hi(a)){const g=[];for(let b=0;b<a.length;b++)g.push(Za(a[b],s,c,m));return g}}function Fx(a,s,c,m=!0){const g=s?s.vnode:null,{errorHandler:b,throwUnhandledErrorInProduction:E}=s&&s.appContext.config||ys;if(s){let n=s.parent;const R=s.proxy,B=`https://vuejs.org/error-reference/#runtime-${c}`;for(;n;){const N=n.ec;if(N){for(let X=0;X<N.length;X++)if(N[X](a,R,B)===!1)return}n=n.parent}if(b){Ol(),w_(b,null,10,[a,R,B]),kl();return}}gO(a,c,g,m,E)}function gO(a,s,c,m=!0,g=!1){if(g)throw a;console.error(a)}const Ur=[];let Va=-1;const df=[];let Lc=null,nf=0;const aC=Promise.resolve();let _x=null;function y1(a){const s=_x||aC;return a?s.then(this?a.bind(this):a):s}function yO(a){let s=Va+1,c=Ur.length;for(;s<c;){const m=s+c>>>1,g=Ur[m],b=s_(g);b<a||b===a&&g.flags&2?s=m+1:c=m}return s}function x1(a){if(!(a.flags&1)){const s=s_(a),c=Ur[Ur.length-1];!c||!(a.flags&2)&&s>=s_(c)?Ur.push(a):Ur.splice(yO(s),0,a),a.flags|=1,lC()}}function lC(){_x||(_x=aC.then(cC))}function xO(a){Hi(a)?df.push(...a):Lc&&a.id===-1?Lc.splice(nf+1,0,a):a.flags&1||(df.push(a),a.flags|=1),lC()}function c2(a,s,c=Va+1){for(;c<Ur.length;c++){const m=Ur[c];if(m&&m.flags&2){if(a&&m.id!==a.uid)continue;Ur.splice(c,1),c--,m.flags&4&&(m.flags&=-2),m(),m.flags&4||(m.flags&=-2)}}}function gx(a){if(df.length){const s=[...new Set(df)].sort((c,m)=>s_(c)-s_(m));if(df.length=0,Lc){Lc.push(...s);return}for(Lc=s,nf=0;nf<Lc.length;nf++){const c=Lc[nf];c.flags&4&&(c.flags&=-2),c.flags&8||c(),c.flags&=-2}Lc=null,nf=0}}const s_=a=>a.id==null?a.flags&2?-1:1/0:a.id;function cC(a){try{for(Va=0;Va<Ur.length;Va++){const s=Ur[Va];s&&!(s.flags&8)&&(s.flags&4&&(s.flags&=-2),w_(s,s.i,s.i?15:14),s.flags&4||(s.flags&=-2))}}finally{for(;Va<Ur.length;Va++){const s=Ur[Va];s&&(s.flags&=-2)}Va=-1,Ur.length=0,gx(),_x=null,(Ur.length||df.length)&&cC()}}let Lo=null,hC=null;function r_(a){const s=Lo;return Lo=a,hC=a&&a.type.__scopeId||null,s}function vO(a,s=Lo,c){if(!s||a._n)return a;const m=(...g)=>{m._d&&x2(-1);const b=r_(s);let E;try{E=a(...g)}finally{r_(b),m._d&&x2(1)}return E};return m._n=!0,m._c=!0,m._d=!0,m}function du(a,s){if(Lo===null)return a;const c=Ux(Lo),m=a.dirs||(a.dirs=[]);for(let g=0;g<s.length;g++){let[b,E,n,R=ys]=s[g];b&&(vn(b)&&(b={mounted:b,updated:b}),b.deep&&Dl(E),m.push({dir:b,instance:c,value:E,oldValue:void 0,arg:n,modifiers:R}))}return a}function ja(a,s,c,m){const g=a.dirs,b=s&&s.dirs;for(let E=0;E<g.length;E++){const n=g[E];b&&(n.oldValue=b[E].value);let R=n.dir[m];R&&(Ol(),Za(R,c,8,[a.el,n,a,s]),kl())}}const bO=Symbol("_vte"),wO=a=>a.__isTeleport;function v1(a,s){a.shapeFlag&6&&a.component?(a.transition=s,v1(a.component.subTree,s)):a.shapeFlag&128?(a.ssContent.transition=s.clone(a.ssContent),a.ssFallback.transition=s.clone(a.ssFallback)):a.transition=s}/*! #__NO_SIDE_EFFECTS__ */function uC(a,s){return vn(a)?Lr({name:a.name},s,{setup:a}):a}function dC(a){a.ids=[a.ids[0]+a.ids[2]+++"-",0,0]}function ff(a,s,c,m,g=!1){if(Hi(a)){a.forEach((we,pe)=>ff(we,s&&(Hi(s)?s[pe]:s),c,m,g));return}if(pf(m)&&!g){m.shapeFlag&512&&m.type.__asyncResolved&&m.component.subTree.component&&ff(a,s,c,m.component.subTree);return}const b=m.shapeFlag&4?Ux(m.component):m.el,E=g?null:b,{i:n,r:R}=a,B=s&&s.r,N=n.refs===ys?n.refs={}:n.refs,X=n.setupState,ie=Qn(X),se=X===ys?()=>!1:we=>cs(ie,we);if(B!=null&&B!==R&&(ps(B)?(N[B]=null,se(B)&&(X[B]=null)):br(B)&&(B.value=null)),vn(R))w_(R,n,12,[E,N]);else{const we=ps(R),pe=br(R);if(we||pe){const Ae=()=>{if(a.f){const Ie=we?se(R)?X[R]:N[R]:R.value;g?Hi(Ie)&&l1(Ie,b):Hi(Ie)?Ie.includes(b)||Ie.push(b):we?(N[R]=[b],se(R)&&(X[R]=N[R])):(R.value=[b],a.k&&(N[a.k]=R.value))}else we?(N[R]=E,se(R)&&(X[R]=E)):pe&&(R.value=E,a.k&&(N[a.k]=E))};E?(Ae.id=-1,fo(Ae,c)):Ae()}}}let h2=!1;const Kd=()=>{h2||(console.error("Hydration completed but contains mismatches."),h2=!0)},TO=a=>a.namespaceURI.includes("svg")&&a.tagName!=="foreignObject",SO=a=>a.namespaceURI.includes("MathML"),My=a=>{if(a.nodeType===1){if(TO(a))return"svg";if(SO(a))return"mathml"}},Py=a=>a.nodeType===8;function EO(a){const{mt:s,p:c,o:{patchProp:m,createText:g,nextSibling:b,parentNode:E,remove:n,insert:R,createComment:B}}=a,N=(Pe,Oe)=>{if(!Oe.hasChildNodes()){c(null,Pe,Oe),gx(),Oe._vnode=Pe;return}X(Oe.firstChild,Pe,null,null,null),gx(),Oe._vnode=Pe},X=(Pe,Oe,tt,xt,Tt,At=!1)=>{At=At||!!Oe.dynamicChildren;const Wt=Py(Pe)&&Pe.data==="[",Zt=()=>pe(Pe,Oe,tt,xt,Tt,Wt),{type:jt,ref:pi,shapeFlag:gi,patchFlag:_i}=Oe;let yi=Pe.nodeType;Oe.el=Pe,_i===-2&&(At=!1,Oe.dynamicChildren=null);let $t=null;switch(jt){case Vc:yi!==3?Oe.children===""?(R(Oe.el=g(""),E(Pe),Pe),$t=Pe):$t=Zt():(Pe.data!==Oe.children&&(Kd(),Pe.data=Oe.children),$t=b(Pe));break;case Xa:Je(Pe)?($t=b(Pe),Ie(Oe.el=Pe.content.firstChild,Pe,tt)):yi!==8||Wt?$t=Zt():$t=b(Pe);break;case _f:if(Wt&&(Pe=b(Pe),yi=Pe.nodeType),yi===1||yi===3){$t=Pe;const xi=!Oe.children.length;for(let hi=0;hi<Oe.staticCount;hi++)xi&&(Oe.children+=$t.nodeType===1?$t.outerHTML:$t.data),hi===Oe.staticCount-1&&(Oe.anchor=$t),$t=b($t);return Wt?b($t):$t}else Zt();break;case Us:Wt?$t=we(Pe,Oe,tt,xt,Tt,At):$t=Zt();break;default:if(gi&1)(yi!==1||Oe.type.toLowerCase()!==Pe.tagName.toLowerCase())&&!Je(Pe)?$t=Zt():$t=ie(Pe,Oe,tt,xt,Tt,At);else if(gi&6){Oe.slotScopeIds=Tt;const xi=E(Pe);if(Wt?$t=Ae(Pe):Py(Pe)&&Pe.data==="teleport start"?$t=Ae(Pe,Pe.data,"teleport end"):$t=b(Pe),s(Oe,xi,null,tt,xt,My(xi),At),pf(Oe)&&!Oe.type.__asyncResolved){let hi;Wt?(hi=Es(Us),hi.anchor=$t?$t.previousSibling:xi.lastChild):hi=Pe.nodeType===3?ca(""):Es("div"),hi.el=Pe,Oe.component.subTree=hi}}else gi&64?yi!==8?$t=Zt():$t=Oe.type.hydrate(Pe,Oe,tt,xt,Tt,At,a,se):gi&128&&($t=Oe.type.hydrate(Pe,Oe,tt,xt,My(E(Pe)),Tt,At,a,X))}return pi!=null&&ff(pi,null,xt,Oe),$t},ie=(Pe,Oe,tt,xt,Tt,At)=>{At=At||!!Oe.dynamicChildren;const{type:Wt,props:Zt,patchFlag:jt,shapeFlag:pi,dirs:gi,transition:_i}=Oe,yi=Wt==="input"||Wt==="option";if(yi||jt!==-1){gi&&ja(Oe,null,tt,"created");let $t=!1;if(Je(Pe)){$t=IC(null,_i)&&tt&&tt.vnode.props&&tt.vnode.props.appear;const hi=Pe.content.firstChild;if($t){const sn=hi.getAttribute("class");sn&&(hi.$cls=sn),_i.beforeEnter(hi)}Ie(hi,Pe,tt),Oe.el=Pe=hi}if(pi&16&&!(Zt&&(Zt.innerHTML||Zt.textContent))){let hi=se(Pe.firstChild,Oe,Pe,tt,xt,Tt,At);for(;hi;){Dy(Pe,1)||Kd();const sn=hi;hi=hi.nextSibling,n(sn)}}else if(pi&8){let hi=Oe.children;hi[0]===`
`&&(Pe.tagName==="PRE"||Pe.tagName==="TEXTAREA")&&(hi=hi.slice(1)),Pe.textContent!==hi&&(Dy(Pe,0)||Kd(),Pe.textContent=Oe.children)}if(Zt){if(yi||!At||jt&48){const hi=Pe.tagName.includes("-");for(const sn in Zt)(yi&&(sn.endsWith("value")||sn==="indeterminate")||Rf(sn)&&!uf(sn)||sn[0]==="."||hi)&&m(Pe,sn,null,Zt[sn],void 0,tt)}else if(Zt.onClick)m(Pe,"onClick",null,Zt.onClick,void 0,tt);else if(jt&4&&xu(Zt.style))for(const hi in Zt.style)Zt.style[hi]}let xi;(xi=Zt&&Zt.onVnodeBeforeMount)&&Ro(xi,tt,Oe),gi&&ja(Oe,null,tt,"beforeMount"),((xi=Zt&&Zt.onVnodeMounted)||gi||$t)&&OC(()=>{xi&&Ro(xi,tt,Oe),$t&&_i.enter(Pe),gi&&ja(Oe,null,tt,"mounted")},xt)}return Pe.nextSibling},se=(Pe,Oe,tt,xt,Tt,At,Wt)=>{Wt=Wt||!!Oe.dynamicChildren;const Zt=Oe.children,jt=Zt.length;for(let pi=0;pi<jt;pi++){const gi=Wt?Zt[pi]:Zt[pi]=po(Zt[pi]),_i=gi.type===Vc;Pe?(_i&&!Wt&&pi+1<jt&&po(Zt[pi+1]).type===Vc&&(R(g(Pe.data.slice(gi.children.length)),tt,b(Pe)),Pe.data=gi.children),Pe=X(Pe,gi,xt,Tt,At,Wt)):_i&&!gi.children?R(gi.el=g(""),tt):(Dy(tt,1)||Kd(),c(null,gi,tt,null,xt,Tt,My(tt),At))}return Pe},we=(Pe,Oe,tt,xt,Tt,At)=>{const{slotScopeIds:Wt}=Oe;Wt&&(Tt=Tt?Tt.concat(Wt):Wt);const Zt=E(Pe),jt=se(b(Pe),Oe,Zt,tt,xt,Tt,At);return jt&&Py(jt)&&jt.data==="]"?b(Oe.anchor=jt):(Kd(),R(Oe.anchor=B("]"),Zt,jt),jt)},pe=(Pe,Oe,tt,xt,Tt,At)=>{if(Dy(Pe.parentElement,1)||Kd(),Oe.el=null,At){const jt=Ae(Pe);for(;;){const pi=b(Pe);if(pi&&pi!==jt)n(pi);else break}}const Wt=b(Pe),Zt=E(Pe);return n(Pe),c(null,Oe,Zt,Wt,tt,xt,My(Zt),Tt),tt&&(tt.vnode.el=Oe.el,LC(tt,Oe.el)),Wt},Ae=(Pe,Oe="[",tt="]")=>{let xt=0;for(;Pe;)if(Pe=b(Pe),Pe&&Py(Pe)&&(Pe.data===Oe&&xt++,Pe.data===tt)){if(xt===0)return b(Pe);xt--}return Pe},Ie=(Pe,Oe,tt)=>{const xt=Oe.parentNode;xt&&xt.replaceChild(Pe,Oe);let Tt=tt;for(;Tt;)Tt.vnode.el===Oe&&(Tt.vnode.el=Tt.subTree.el=Pe),Tt=Tt.parent},Je=Pe=>Pe.nodeType===1&&Pe.tagName==="TEMPLATE";return[N,X]}const u2="data-allow-mismatch",AO={0:"text",1:"children",2:"class",3:"style",4:"attribute"};function Dy(a,s){if(s===0||s===1)for(;a&&!a.hasAttribute(u2);)a=a.parentElement;const c=a&&a.getAttribute(u2);if(c==null)return!1;if(c==="")return!0;{const m=c.split(",");return s===0&&m.includes("children")?!0:m.includes(AO[s])}}v_().requestIdleCallback;v_().cancelIdleCallback;const pf=a=>!!a.type.__asyncLoader,fC=a=>a.type.__isKeepAlive;function IO(a,s){pC(a,"a",s)}function CO(a,s){pC(a,"da",s)}function pC(a,s,c=jr){const m=a.__wdc||(a.__wdc=()=>{let g=c;for(;g;){if(g.isDeactivated)return;g=g.parent}return a()});if(Bx(s,m,c),c){let g=c.parent;for(;g&&g.parent;)fC(g.parent.vnode)&&MO(m,s,c,g),g=g.parent}}function MO(a,s,c,m){const g=Bx(s,a,m,!0);b1(()=>{l1(m[s],g)},c)}function Bx(a,s,c=jr,m=!1){if(c){const g=c[a]||(c[a]=[]),b=s.__weh||(s.__weh=(...E)=>{Ol();const n=T_(c),R=Za(s,c,a,E);return n(),kl(),R});return m?g.unshift(b):g.push(b),b}}const Bl=a=>(s,c=jr)=>{(!c_||a==="sp")&&Bx(a,(...m)=>s(...m),c)},PO=Bl("bm"),Nx=Bl("m"),DO=Bl("bu"),RO=Bl("u"),LO=Bl("bum"),b1=Bl("um"),zO=Bl("sp"),OO=Bl("rtg"),kO=Bl("rtc");function FO(a,s=jr){Bx("ec",a,s)}const BO=Symbol.for("v-ndc");function o_(a,s,c,m){let g;const b=c,E=Hi(a);if(E||ps(a)){const n=E&&xu(a);let R=!1,B=!1;n&&(R=!Oo(a),B=$c(a),a=kx(a)),g=new Array(a.length);for(let N=0,X=a.length;N<X;N++)g[N]=s(R?B?px(vr(a[N])):vr(a[N]):a[N],N,void 0,b)}else if(typeof a=="number"){g=new Array(a);for(let n=0;n<a;n++)g[n]=s(n+1,n,void 0,b)}else if(As(a))if(a[Symbol.iterator])g=Array.from(a,(n,R)=>s(n,R,void 0,b));else{const n=Object.keys(a);g=new Array(n.length);for(let R=0,B=n.length;R<B;R++){const N=n[R];g[R]=s(a[N],N,R,b)}}else g=[];return g}const Ub=a=>a?VC(a)?Ux(a):Ub(a.parent):null,qm=Lr(Object.create(null),{$:a=>a,$el:a=>a.vnode.el,$data:a=>a.data,$props:a=>a.props,$attrs:a=>a.attrs,$slots:a=>a.slots,$refs:a=>a.refs,$parent:a=>Ub(a.parent),$root:a=>Ub(a.root),$host:a=>a.ce,$emit:a=>a.emit,$options:a=>_C(a),$forceUpdate:a=>a.f||(a.f=()=>{x1(a.update)}),$nextTick:a=>a.n||(a.n=y1.bind(a.proxy)),$watch:a=>sk.bind(a)}),rb=(a,s)=>a!==ys&&!a.__isScriptSetup&&cs(a,s),NO={get({_:a},s){if(s==="__v_skip")return!0;const{ctx:c,setupState:m,data:g,props:b,accessCache:E,type:n,appContext:R}=a;let B;if(s[0]!=="$"){const se=E[s];if(se!==void 0)switch(se){case 1:return m[s];case 2:return g[s];case 4:return c[s];case 3:return b[s]}else{if(rb(m,s))return E[s]=1,m[s];if(g!==ys&&cs(g,s))return E[s]=2,g[s];if((B=a.propsOptions[0])&&cs(B,s))return E[s]=3,b[s];if(c!==ys&&cs(c,s))return E[s]=4,c[s];jb&&(E[s]=0)}}const N=qm[s];let X,ie;if(N)return s==="$attrs"&&Dr(a.attrs,"get",""),N(a);if((X=n.__cssModules)&&(X=X[s]))return X;if(c!==ys&&cs(c,s))return E[s]=4,c[s];if(ie=R.config.globalProperties,cs(ie,s))return ie[s]},set({_:a},s,c){const{data:m,setupState:g,ctx:b}=a;return rb(g,s)?(g[s]=c,!0):m!==ys&&cs(m,s)?(m[s]=c,!0):cs(a.props,s)||s[0]==="$"&&s.slice(1)in a?!1:(b[s]=c,!0)},has({_:{data:a,setupState:s,accessCache:c,ctx:m,appContext:g,propsOptions:b}},E){let n;return!!c[E]||a!==ys&&cs(a,E)||rb(s,E)||(n=b[0])&&cs(n,E)||cs(m,E)||cs(qm,E)||cs(g.config.globalProperties,E)},defineProperty(a,s,c){return c.get!=null?a._.accessCache[s]=0:cs(c,"value")&&this.set(a,s,c.value,null),Reflect.defineProperty(a,s,c)}};function d2(a){return Hi(a)?a.reduce((s,c)=>(s[c]=null,s),{}):a}let jb=!0;function VO(a){const s=_C(a),c=a.proxy,m=a.ctx;jb=!1,s.beforeCreate&&f2(s.beforeCreate,a,"bc");const{data:g,computed:b,methods:E,watch:n,provide:R,inject:B,created:N,beforeMount:X,mounted:ie,beforeUpdate:se,updated:we,activated:pe,deactivated:Ae,beforeDestroy:Ie,beforeUnmount:Je,destroyed:Pe,unmounted:Oe,render:tt,renderTracked:xt,renderTriggered:Tt,errorCaptured:At,serverPrefetch:Wt,expose:Zt,inheritAttrs:jt,components:pi,directives:gi,filters:_i}=s;if(B&&UO(B,m,null),E)for(const xi in E){const hi=E[xi];vn(hi)&&(m[xi]=hi.bind(c))}if(g){const xi=g.call(c,c);As(xi)&&(a.data=_1(xi))}if(jb=!0,b)for(const xi in b){const hi=b[xi],sn=vn(hi)?hi.bind(c,c):vn(hi.get)?hi.get.bind(c,c):yo,Ui=!vn(hi)&&vn(hi.set)?hi.set.bind(c):yo,ss=vu({get:sn,set:Ui});Object.defineProperty(m,xi,{enumerable:!0,configurable:!0,get:()=>ss.value,set:jn=>ss.value=jn})}if(n)for(const xi in n)mC(n[xi],m,c,xi);if(R){const xi=vn(R)?R.call(c):R;Reflect.ownKeys(xi).forEach(hi=>{qO(hi,xi[hi])})}N&&f2(N,a,"c");function $t(xi,hi){Hi(hi)?hi.forEach(sn=>xi(sn.bind(c))):hi&&xi(hi.bind(c))}if($t(PO,X),$t(Nx,ie),$t(DO,se),$t(RO,we),$t(IO,pe),$t(CO,Ae),$t(FO,At),$t(kO,xt),$t(OO,Tt),$t(LO,Je),$t(b1,Oe),$t(zO,Wt),Hi(Zt))if(Zt.length){const xi=a.exposed||(a.exposed={});Zt.forEach(hi=>{Object.defineProperty(xi,hi,{get:()=>c[hi],set:sn=>c[hi]=sn})})}else a.exposed||(a.exposed={});tt&&a.render===yo&&(a.render=tt),jt!=null&&(a.inheritAttrs=jt),pi&&(a.components=pi),gi&&(a.directives=gi),Wt&&dC(a)}function UO(a,s,c=yo){Hi(a)&&(a=$b(a));for(const m in a){const g=a[m];let b;As(g)?"default"in g?b=ex(g.from||m,g.default,!0):b=ex(g.from||m):b=ex(g),br(b)?Object.defineProperty(s,m,{enumerable:!0,configurable:!0,get:()=>b.value,set:E=>b.value=E}):s[m]=b}}function f2(a,s,c){Za(Hi(a)?a.map(m=>m.bind(s.proxy)):a.bind(s.proxy),s,c)}function mC(a,s,c,m){let g=m.includes(".")?DC(c,m):()=>c[m];if(ps(a)){const b=s[a];vn(b)&&tx(g,b)}else if(vn(a))tx(g,a.bind(c));else if(As(a))if(Hi(a))a.forEach(b=>mC(b,s,c,m));else{const b=vn(a.handler)?a.handler.bind(c):s[a.handler];vn(b)&&tx(g,b,a)}}function _C(a){const s=a.type,{mixins:c,extends:m}=s,{mixins:g,optionsCache:b,config:{optionMergeStrategies:E}}=a.appContext,n=b.get(s);let R;return n?R=n:!g.length&&!c&&!m?R=s:(R={},g.length&&g.forEach(B=>yx(R,B,E,!0)),yx(R,s,E)),As(s)&&b.set(s,R),R}function yx(a,s,c,m=!1){const{mixins:g,extends:b}=s;b&&yx(a,b,c,!0),g&&g.forEach(E=>yx(a,E,c,!0));for(const E in s)if(!(m&&E==="expose")){const n=jO[E]||c&&c[E];a[E]=n?n(a[E],s[E]):s[E]}return a}const jO={data:p2,props:m2,emits:m2,methods:Nm,computed:Nm,beforeCreate:Vr,created:Vr,beforeMount:Vr,mounted:Vr,beforeUpdate:Vr,updated:Vr,beforeDestroy:Vr,beforeUnmount:Vr,destroyed:Vr,unmounted:Vr,activated:Vr,deactivated:Vr,errorCaptured:Vr,serverPrefetch:Vr,components:Nm,directives:Nm,watch:GO,provide:p2,inject:$O};function p2(a,s){return s?a?function(){return Lr(vn(a)?a.call(this,this):a,vn(s)?s.call(this,this):s)}:s:a}function $O(a,s){return Nm($b(a),$b(s))}function $b(a){if(Hi(a)){const s={};for(let c=0;c<a.length;c++)s[a[c]]=a[c];return s}return a}function Vr(a,s){return a?[...new Set([].concat(a,s))]:s}function Nm(a,s){return a?Lr(Object.create(null),a,s):s}function m2(a,s){return a?Hi(a)&&Hi(s)?[...new Set([...a,...s])]:Lr(Object.create(null),d2(a),d2(s??{})):s}function GO(a,s){if(!a)return s;if(!s)return a;const c=Lr(Object.create(null),a);for(const m in s)c[m]=Vr(a[m],s[m]);return c}function gC(){return{app:null,config:{isNativeTag:mz,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let HO=0;function WO(a,s){return function(m,g=null){vn(m)||(m=Lr({},m)),g!=null&&!As(g)&&(g=null);const b=gC(),E=new WeakSet,n=[];let R=!1;const B=b.app={_uid:HO++,_component:m,_props:g,_container:null,_context:b,_instance:null,version:$C,get config(){return b.config},set config(N){},use(N,...X){return E.has(N)||(N&&vn(N.install)?(E.add(N),N.install(B,...X)):vn(N)&&(E.add(N),N(B,...X))),B},mixin(N){return b.mixins.includes(N)||b.mixins.push(N),B},component(N,X){return X?(b.components[N]=X,B):b.components[N]},directive(N,X){return X?(b.directives[N]=X,B):b.directives[N]},mount(N,X,ie){if(!R){const se=B._ceVNode||Es(m,g);return se.appContext=b,ie===!0?ie="svg":ie===!1&&(ie=void 0),X&&s?s(se,N):a(se,N,ie),R=!0,B._container=N,N.__vue_app__=B,Ux(se.component)}},onUnmount(N){n.push(N)},unmount(){R&&(Za(n,B._instance,16),a(null,B._container),delete B._container.__vue_app__)},provide(N,X){return b.provides[N]=X,B},runWithContext(N){const X=mf;mf=B;try{return N()}finally{mf=X}}};return B}}let mf=null;function qO(a,s){if(jr){let c=jr.provides;const m=jr.parent&&jr.parent.provides;m===c&&(c=jr.provides=Object.create(m)),c[a]=s}}function ex(a,s,c=!1){const m=jr||Lo;if(m||mf){let g=mf?mf._context.provides:m?m.parent==null||m.ce?m.vnode.appContext&&m.vnode.appContext.provides:m.parent.provides:void 0;if(g&&a in g)return g[a];if(arguments.length>1)return c&&vn(s)?s.call(m&&m.proxy):s}}const yC={},xC=()=>Object.create(yC),vC=a=>Object.getPrototypeOf(a)===yC;function ZO(a,s,c,m=!1){const g={},b=xC();a.propsDefaults=Object.create(null),bC(a,s,g,b);for(const E in a.propsOptions[0])E in g||(g[E]=void 0);c?a.props=m?g:oO(g):a.type.props?a.props=g:a.props=b,a.attrs=b}function XO(a,s,c,m){const{props:g,attrs:b,vnode:{patchFlag:E}}=a,n=Qn(g),[R]=a.propsOptions;let B=!1;if((m||E>0)&&!(E&16)){if(E&8){const N=a.vnode.dynamicProps;for(let X=0;X<N.length;X++){let ie=N[X];if(Vx(a.emitsOptions,ie))continue;const se=s[ie];if(R)if(cs(b,ie))se!==b[ie]&&(b[ie]=se,B=!0);else{const we=jc(ie);g[we]=Gb(R,n,we,se,a,!1)}else se!==b[ie]&&(b[ie]=se,B=!0)}}}else{bC(a,s,g,b)&&(B=!0);let N;for(const X in n)(!s||!cs(s,X)&&((N=Zc(X))===X||!cs(s,N)))&&(R?c&&(c[X]!==void 0||c[N]!==void 0)&&(g[X]=Gb(R,n,X,void 0,a,!0)):delete g[X]);if(b!==n)for(const X in b)(!s||!cs(s,X))&&(delete b[X],B=!0)}B&&Pl(a.attrs,"set","")}function bC(a,s,c,m){const[g,b]=a.propsOptions;let E=!1,n;if(s)for(let R in s){if(uf(R))continue;const B=s[R];let N;g&&cs(g,N=jc(R))?!b||!b.includes(N)?c[N]=B:(n||(n={}))[N]=B:Vx(a.emitsOptions,R)||(!(R in m)||B!==m[R])&&(m[R]=B,E=!0)}if(b){const R=Qn(c),B=n||ys;for(let N=0;N<b.length;N++){const X=b[N];c[X]=Gb(g,R,X,B[X],a,!cs(B,X))}}return E}function Gb(a,s,c,m,g,b){const E=a[c];if(E!=null){const n=cs(E,"default");if(n&&m===void 0){const R=E.default;if(E.type!==Function&&!E.skipFactory&&vn(R)){const{propsDefaults:B}=g;if(c in B)m=B[c];else{const N=T_(g);m=B[c]=R.call(null,s),N()}}else m=R;g.ce&&g.ce._setProp(c,m)}E[0]&&(b&&!n?m=!1:E[1]&&(m===""||m===Zc(c))&&(m=!0))}return m}const YO=new WeakMap;function wC(a,s,c=!1){const m=c?YO:s.propsCache,g=m.get(a);if(g)return g;const b=a.props,E={},n=[];let R=!1;if(!vn(a)){const N=X=>{R=!0;const[ie,se]=wC(X,s,!0);Lr(E,ie),se&&n.push(...se)};!c&&s.mixins.length&&s.mixins.forEach(N),a.extends&&N(a.extends),a.mixins&&a.mixins.forEach(N)}if(!b&&!R)return As(a)&&m.set(a,cf),cf;if(Hi(b))for(let N=0;N<b.length;N++){const X=jc(b[N]);_2(X)&&(E[X]=ys)}else if(b)for(const N in b){const X=jc(N);if(_2(X)){const ie=b[N],se=E[X]=Hi(ie)||vn(ie)?{type:ie}:Lr({},ie),we=se.type;let pe=!1,Ae=!0;if(Hi(we))for(let Ie=0;Ie<we.length;++Ie){const Je=we[Ie],Pe=vn(Je)&&Je.name;if(Pe==="Boolean"){pe=!0;break}else Pe==="String"&&(Ae=!1)}else pe=vn(we)&&we.name==="Boolean";se[0]=pe,se[1]=Ae,(pe||cs(se,"default"))&&n.push(X)}}const B=[E,n];return As(a)&&m.set(a,B),B}function _2(a){return a[0]!=="$"&&!uf(a)}const w1=a=>a[0]==="_"||a==="$stable",T1=a=>Hi(a)?a.map(po):[po(a)],KO=(a,s,c)=>{if(s._n)return s;const m=vO((...g)=>T1(s(...g)),c);return m._c=!1,m},TC=(a,s,c)=>{const m=a._ctx;for(const g in a){if(w1(g))continue;const b=a[g];if(vn(b))s[g]=KO(g,b,m);else if(b!=null){const E=T1(b);s[g]=()=>E}}},SC=(a,s)=>{const c=T1(s);a.slots.default=()=>c},EC=(a,s,c)=>{for(const m in s)(c||!w1(m))&&(a[m]=s[m])},JO=(a,s,c)=>{const m=a.slots=xC();if(a.vnode.shapeFlag&32){const g=s.__;g&&Fb(m,"__",g,!0);const b=s._;b?(EC(m,s,c),c&&Fb(m,"_",b,!0)):TC(s,m)}else s&&SC(a,s)},QO=(a,s,c)=>{const{vnode:m,slots:g}=a;let b=!0,E=ys;if(m.shapeFlag&32){const n=s._;n?c&&n===1?b=!1:EC(g,s,c):(b=!s.$stable,TC(s,g)),E=s}else s&&(SC(a,s),E={default:1});if(b)for(const n in g)!w1(n)&&E[n]==null&&delete g[n]},fo=OC;function ek(a){return AC(a)}function tk(a){return AC(a,EO)}function AC(a,s){const c=v_();c.__VUE__=!0;const{insert:m,remove:g,patchProp:b,createElement:E,createText:n,createComment:R,setText:B,setElementText:N,parentNode:X,nextSibling:ie,setScopeId:se=yo,insertStaticContent:we}=a,pe=(Ce,Ze,gt,Rt=null,zt=null,Nt=null,Qt=void 0,Gt=null,Kt=!!Ze.dynamicChildren)=>{if(Ce===Ze)return;Ce&&!Mm(Ce,Ze)&&(Rt=es(Ce),jn(Ce,zt,Nt,!0),Ce=null),Ze.patchFlag===-2&&(Kt=!1,Ze.dynamicChildren=null);const{type:Vt,ref:Ci,shapeFlag:Jt}=Ze;switch(Vt){case Vc:Ae(Ce,Ze,gt,Rt);break;case Xa:Ie(Ce,Ze,gt,Rt);break;case _f:Ce==null&&Je(Ze,gt,Rt,Qt);break;case Us:pi(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt);break;default:Jt&1?tt(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt):Jt&6?gi(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt):(Jt&64||Jt&128)&&Vt.process(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt,pr)}Ci!=null&&zt?ff(Ci,Ce&&Ce.ref,Nt,Ze||Ce,!Ze):Ci==null&&Ce&&Ce.ref!=null&&ff(Ce.ref,null,Nt,Ce,!0)},Ae=(Ce,Ze,gt,Rt)=>{if(Ce==null)m(Ze.el=n(Ze.children),gt,Rt);else{const zt=Ze.el=Ce.el;Ze.children!==Ce.children&&B(zt,Ze.children)}},Ie=(Ce,Ze,gt,Rt)=>{Ce==null?m(Ze.el=R(Ze.children||""),gt,Rt):Ze.el=Ce.el},Je=(Ce,Ze,gt,Rt)=>{[Ce.el,Ce.anchor]=we(Ce.children,Ze,gt,Rt,Ce.el,Ce.anchor)},Pe=({el:Ce,anchor:Ze},gt,Rt)=>{let zt;for(;Ce&&Ce!==Ze;)zt=ie(Ce),m(Ce,gt,Rt),Ce=zt;m(Ze,gt,Rt)},Oe=({el:Ce,anchor:Ze})=>{let gt;for(;Ce&&Ce!==Ze;)gt=ie(Ce),g(Ce),Ce=gt;g(Ze)},tt=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt)=>{Ze.type==="svg"?Qt="svg":Ze.type==="math"&&(Qt="mathml"),Ce==null?xt(Ze,gt,Rt,zt,Nt,Qt,Gt,Kt):Wt(Ce,Ze,zt,Nt,Qt,Gt,Kt)},xt=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt)=>{let Kt,Vt;const{props:Ci,shapeFlag:Jt,transition:Ti,dirs:Vi}=Ce;if(Kt=Ce.el=E(Ce.type,Nt,Ci&&Ci.is,Ci),Jt&8?N(Kt,Ce.children):Jt&16&&At(Ce.children,Kt,null,Rt,zt,ob(Ce,Nt),Qt,Gt),Vi&&ja(Ce,null,Rt,"created"),Tt(Kt,Ce,Ce.scopeId,Qt,Rt),Ci){for(const $n in Ci)$n!=="value"&&!uf($n)&&b(Kt,$n,null,Ci[$n],Nt,Rt);"value"in Ci&&b(Kt,"value",null,Ci.value,Nt),(Vt=Ci.onVnodeBeforeMount)&&Ro(Vt,Rt,Ce)}Vi&&ja(Ce,null,Rt,"beforeMount");const ji=IC(zt,Ti);ji&&Ti.beforeEnter(Kt),m(Kt,Ze,gt),((Vt=Ci&&Ci.onVnodeMounted)||ji||Vi)&&fo(()=>{Vt&&Ro(Vt,Rt,Ce),ji&&Ti.enter(Kt),Vi&&ja(Ce,null,Rt,"mounted")},zt)},Tt=(Ce,Ze,gt,Rt,zt)=>{if(gt&&se(Ce,gt),Rt)for(let Nt=0;Nt<Rt.length;Nt++)se(Ce,Rt[Nt]);if(zt){let Nt=zt.subTree;if(Ze===Nt||zC(Nt.type)&&(Nt.ssContent===Ze||Nt.ssFallback===Ze)){const Qt=zt.vnode;Tt(Ce,Qt,Qt.scopeId,Qt.slotScopeIds,zt.parent)}}},At=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt=0)=>{for(let Vt=Kt;Vt<Ce.length;Vt++){const Ci=Ce[Vt]=Gt?zc(Ce[Vt]):po(Ce[Vt]);pe(null,Ci,Ze,gt,Rt,zt,Nt,Qt,Gt)}},Wt=(Ce,Ze,gt,Rt,zt,Nt,Qt)=>{const Gt=Ze.el=Ce.el;let{patchFlag:Kt,dynamicChildren:Vt,dirs:Ci}=Ze;Kt|=Ce.patchFlag&16;const Jt=Ce.props||ys,Ti=Ze.props||ys;let Vi;if(gt&&ru(gt,!1),(Vi=Ti.onVnodeBeforeUpdate)&&Ro(Vi,gt,Ze,Ce),Ci&&ja(Ze,Ce,gt,"beforeUpdate"),gt&&ru(gt,!0),(Jt.innerHTML&&Ti.innerHTML==null||Jt.textContent&&Ti.textContent==null)&&N(Gt,""),Vt?Zt(Ce.dynamicChildren,Vt,Gt,gt,Rt,ob(Ze,zt),Nt):Qt||hi(Ce,Ze,Gt,null,gt,Rt,ob(Ze,zt),Nt,!1),Kt>0){if(Kt&16)jt(Gt,Jt,Ti,gt,zt);else if(Kt&2&&Jt.class!==Ti.class&&b(Gt,"class",null,Ti.class,zt),Kt&4&&b(Gt,"style",Jt.style,Ti.style,zt),Kt&8){const ji=Ze.dynamicProps;for(let $n=0;$n<ji.length;$n++){const wn=ji[$n],zs=Jt[wn],Hn=Ti[wn];(Hn!==zs||wn==="value")&&b(Gt,wn,zs,Hn,zt,gt)}}Kt&1&&Ce.children!==Ze.children&&N(Gt,Ze.children)}else!Qt&&Vt==null&&jt(Gt,Jt,Ti,gt,zt);((Vi=Ti.onVnodeUpdated)||Ci)&&fo(()=>{Vi&&Ro(Vi,gt,Ze,Ce),Ci&&ja(Ze,Ce,gt,"updated")},Rt)},Zt=(Ce,Ze,gt,Rt,zt,Nt,Qt)=>{for(let Gt=0;Gt<Ze.length;Gt++){const Kt=Ce[Gt],Vt=Ze[Gt],Ci=Kt.el&&(Kt.type===Us||!Mm(Kt,Vt)||Kt.shapeFlag&198)?X(Kt.el):gt;pe(Kt,Vt,Ci,null,Rt,zt,Nt,Qt,!0)}},jt=(Ce,Ze,gt,Rt,zt)=>{if(Ze!==gt){if(Ze!==ys)for(const Nt in Ze)!uf(Nt)&&!(Nt in gt)&&b(Ce,Nt,Ze[Nt],null,zt,Rt);for(const Nt in gt){if(uf(Nt))continue;const Qt=gt[Nt],Gt=Ze[Nt];Qt!==Gt&&Nt!=="value"&&b(Ce,Nt,Gt,Qt,zt,Rt)}"value"in gt&&b(Ce,"value",Ze.value,gt.value,zt)}},pi=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt)=>{const Vt=Ze.el=Ce?Ce.el:n(""),Ci=Ze.anchor=Ce?Ce.anchor:n("");let{patchFlag:Jt,dynamicChildren:Ti,slotScopeIds:Vi}=Ze;Vi&&(Gt=Gt?Gt.concat(Vi):Vi),Ce==null?(m(Vt,gt,Rt),m(Ci,gt,Rt),At(Ze.children||[],gt,Ci,zt,Nt,Qt,Gt,Kt)):Jt>0&&Jt&64&&Ti&&Ce.dynamicChildren?(Zt(Ce.dynamicChildren,Ti,gt,zt,Nt,Qt,Gt),(Ze.key!=null||zt&&Ze===zt.subTree)&&CC(Ce,Ze,!0)):hi(Ce,Ze,gt,Ci,zt,Nt,Qt,Gt,Kt)},gi=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt)=>{Ze.slotScopeIds=Gt,Ce==null?Ze.shapeFlag&512?zt.ctx.activate(Ze,gt,Rt,Qt,Kt):_i(Ze,gt,Rt,zt,Nt,Qt,Kt):yi(Ce,Ze,Kt)},_i=(Ce,Ze,gt,Rt,zt,Nt,Qt)=>{const Gt=Ce.component=NC(Ce,Rt,zt);if(fC(Ce)&&(Gt.ctx.renderer=pr),UC(Gt,!1,Qt),Gt.asyncDep){if(zt&&zt.registerDep(Gt,$t,Qt),!Ce.el){const Kt=Gt.subTree=Es(Xa);Ie(null,Kt,Ze,gt)}}else $t(Gt,Ce,Ze,gt,zt,Nt,Qt)},yi=(Ce,Ze,gt)=>{const Rt=Ze.component=Ce.component;if(ck(Ce,Ze,gt))if(Rt.asyncDep&&!Rt.asyncResolved){xi(Rt,Ze,gt);return}else Rt.next=Ze,Rt.update();else Ze.el=Ce.el,Rt.vnode=Ze},$t=(Ce,Ze,gt,Rt,zt,Nt,Qt)=>{const Gt=()=>{if(Ce.isMounted){let{next:Jt,bu:Ti,u:Vi,parent:ji,vnode:$n}=Ce;{const Os=MC(Ce);if(Os){Jt&&(Jt.el=$n.el,xi(Ce,Jt,Qt)),Os.asyncDep.then(()=>{Ce.isUnmounted||Gt()});return}}let wn=Jt,zs;ru(Ce,!1),Jt?(Jt.el=$n.el,xi(Ce,Jt,Qt)):Jt=$n,Ti&&Qy(Ti),(zs=Jt.props&&Jt.props.onVnodeBeforeUpdate)&&Ro(zs,ji,Jt,$n),ru(Ce,!0);const Hn=ix(Ce),vs=Ce.subTree;Ce.subTree=Hn,pe(vs,Hn,X(vs.el),es(vs),Ce,zt,Nt),Jt.el=Hn.el,wn===null&&LC(Ce,Hn.el),Vi&&fo(Vi,zt),(zs=Jt.props&&Jt.props.onVnodeUpdated)&&fo(()=>Ro(zs,ji,Jt,$n),zt)}else{let Jt;const{el:Ti,props:Vi}=Ze,{bm:ji,m:$n,parent:wn,root:zs,type:Hn}=Ce,vs=pf(Ze);if(ru(Ce,!1),ji&&Qy(ji),!vs&&(Jt=Vi&&Vi.onVnodeBeforeMount)&&Ro(Jt,wn,Ze),ru(Ce,!0),Ti&&Js){const Os=()=>{Ce.subTree=ix(Ce),Js(Ti,Ce.subTree,Ce,zt,null)};vs&&Hn.__asyncHydrate?Hn.__asyncHydrate(Ti,Ce,Os):Os()}else{zs.ce&&zs.ce._def.shadowRoot!==!1&&zs.ce._injectChildStyle(Hn);const Os=Ce.subTree=ix(Ce);pe(null,Os,gt,Rt,Ce,zt,Nt),Ze.el=Os.el}if($n&&fo($n,zt),!vs&&(Jt=Vi&&Vi.onVnodeMounted)){const Os=Ze;fo(()=>Ro(Jt,wn,Os),zt)}(Ze.shapeFlag&256||wn&&pf(wn.vnode)&&wn.vnode.shapeFlag&256)&&Ce.a&&fo(Ce.a,zt),Ce.isMounted=!0,Ze=gt=Rt=null}};Ce.scope.on();const Kt=Ce.effect=new $I(Gt);Ce.scope.off();const Vt=Ce.update=Kt.run.bind(Kt),Ci=Ce.job=Kt.runIfDirty.bind(Kt);Ci.i=Ce,Ci.id=Ce.uid,Kt.scheduler=()=>x1(Ci),ru(Ce,!0),Vt()},xi=(Ce,Ze,gt)=>{Ze.component=Ce;const Rt=Ce.vnode.props;Ce.vnode=Ze,Ce.next=null,XO(Ce,Ze.props,Rt,gt),QO(Ce,Ze.children,gt),Ol(),c2(Ce),kl()},hi=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt=!1)=>{const Vt=Ce&&Ce.children,Ci=Ce?Ce.shapeFlag:0,Jt=Ze.children,{patchFlag:Ti,shapeFlag:Vi}=Ze;if(Ti>0){if(Ti&128){Ui(Vt,Jt,gt,Rt,zt,Nt,Qt,Gt,Kt);return}else if(Ti&256){sn(Vt,Jt,gt,Rt,zt,Nt,Qt,Gt,Kt);return}}Vi&8?(Ci&16&&en(Vt,zt,Nt),Jt!==Vt&&N(gt,Jt)):Ci&16?Vi&16?Ui(Vt,Jt,gt,Rt,zt,Nt,Qt,Gt,Kt):en(Vt,zt,Nt,!0):(Ci&8&&N(gt,""),Vi&16&&At(Jt,gt,Rt,zt,Nt,Qt,Gt,Kt))},sn=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt)=>{Ce=Ce||cf,Ze=Ze||cf;const Vt=Ce.length,Ci=Ze.length,Jt=Math.min(Vt,Ci);let Ti;for(Ti=0;Ti<Jt;Ti++){const Vi=Ze[Ti]=Kt?zc(Ze[Ti]):po(Ze[Ti]);pe(Ce[Ti],Vi,gt,null,zt,Nt,Qt,Gt,Kt)}Vt>Ci?en(Ce,zt,Nt,!0,!1,Jt):At(Ze,gt,Rt,zt,Nt,Qt,Gt,Kt,Jt)},Ui=(Ce,Ze,gt,Rt,zt,Nt,Qt,Gt,Kt)=>{let Vt=0;const Ci=Ze.length;let Jt=Ce.length-1,Ti=Ci-1;for(;Vt<=Jt&&Vt<=Ti;){const Vi=Ce[Vt],ji=Ze[Vt]=Kt?zc(Ze[Vt]):po(Ze[Vt]);if(Mm(Vi,ji))pe(Vi,ji,gt,null,zt,Nt,Qt,Gt,Kt);else break;Vt++}for(;Vt<=Jt&&Vt<=Ti;){const Vi=Ce[Jt],ji=Ze[Ti]=Kt?zc(Ze[Ti]):po(Ze[Ti]);if(Mm(Vi,ji))pe(Vi,ji,gt,null,zt,Nt,Qt,Gt,Kt);else break;Jt--,Ti--}if(Vt>Jt){if(Vt<=Ti){const Vi=Ti+1,ji=Vi<Ci?Ze[Vi].el:Rt;for(;Vt<=Ti;)pe(null,Ze[Vt]=Kt?zc(Ze[Vt]):po(Ze[Vt]),gt,ji,zt,Nt,Qt,Gt,Kt),Vt++}}else if(Vt>Ti)for(;Vt<=Jt;)jn(Ce[Vt],zt,Nt,!0),Vt++;else{const Vi=Vt,ji=Vt,$n=new Map;for(Vt=ji;Vt<=Ti;Vt++){const Ds=Ze[Vt]=Kt?zc(Ze[Vt]):po(Ze[Vt]);Ds.key!=null&&$n.set(Ds.key,Vt)}let wn,zs=0;const Hn=Ti-ji+1;let vs=!1,Os=0;const wr=new Array(Hn);for(Vt=0;Vt<Hn;Vt++)wr[Vt]=0;for(Vt=Vi;Vt<=Jt;Vt++){const Ds=Ce[Vt];if(zs>=Hn){jn(Ds,zt,Nt,!0);continue}let Qs;if(Ds.key!=null)Qs=$n.get(Ds.key);else for(wn=ji;wn<=Ti;wn++)if(wr[wn-ji]===0&&Mm(Ds,Ze[wn])){Qs=wn;break}Qs===void 0?jn(Ds,zt,Nt,!0):(wr[Qs-ji]=Vt+1,Qs>=Os?Os=Qs:vs=!0,pe(Ds,Ze[Qs],gt,null,zt,Nt,Qt,Gt,Kt),zs++)}const wo=vs?ik(wr):cf;for(wn=wo.length-1,Vt=Hn-1;Vt>=0;Vt--){const Ds=ji+Vt,Qs=Ze[Ds],An=Ds+1<Ci?Ze[Ds+1].el:Rt;wr[Vt]===0?pe(null,Qs,gt,An,zt,Nt,Qt,Gt,Kt):vs&&(wn<0||Vt!==wo[wn]?ss(Qs,gt,An,2):wn--)}}},ss=(Ce,Ze,gt,Rt,zt=null)=>{const{el:Nt,type:Qt,transition:Gt,children:Kt,shapeFlag:Vt}=Ce;if(Vt&6){ss(Ce.component.subTree,Ze,gt,Rt);return}if(Vt&128){Ce.suspense.move(Ze,gt,Rt);return}if(Vt&64){Qt.move(Ce,Ze,gt,pr);return}if(Qt===Us){m(Nt,Ze,gt);for(let Jt=0;Jt<Kt.length;Jt++)ss(Kt[Jt],Ze,gt,Rt);m(Ce.anchor,Ze,gt);return}if(Qt===_f){Pe(Ce,Ze,gt);return}if(Rt!==2&&Vt&1&&Gt)if(Rt===0)Gt.beforeEnter(Nt),m(Nt,Ze,gt),fo(()=>Gt.enter(Nt),zt);else{const{leave:Jt,delayLeave:Ti,afterLeave:Vi}=Gt,ji=()=>{Ce.ctx.isUnmounted?g(Nt):m(Nt,Ze,gt)},$n=()=>{Jt(Nt,()=>{ji(),Vi&&Vi()})};Ti?Ti(Nt,ji,$n):$n()}else m(Nt,Ze,gt)},jn=(Ce,Ze,gt,Rt=!1,zt=!1)=>{const{type:Nt,props:Qt,ref:Gt,children:Kt,dynamicChildren:Vt,shapeFlag:Ci,patchFlag:Jt,dirs:Ti,cacheIndex:Vi}=Ce;if(Jt===-2&&(zt=!1),Gt!=null&&(Ol(),ff(Gt,null,gt,Ce,!0),kl()),Vi!=null&&(Ze.renderCache[Vi]=void 0),Ci&256){Ze.ctx.deactivate(Ce);return}const ji=Ci&1&&Ti,$n=!pf(Ce);let wn;if($n&&(wn=Qt&&Qt.onVnodeBeforeUnmount)&&Ro(wn,Ze,Ce),Ci&6)Zi(Ce.component,gt,Rt);else{if(Ci&128){Ce.suspense.unmount(gt,Rt);return}ji&&ja(Ce,null,Ze,"beforeUnmount"),Ci&64?Ce.type.remove(Ce,Ze,gt,pr,Rt):Vt&&!Vt.hasOnce&&(Nt!==Us||Jt>0&&Jt&64)?en(Vt,Ze,gt,!1,!0):(Nt===Us&&Jt&384||!zt&&Ci&16)&&en(Kt,Ze,gt),Rt&&Fs(Ce)}($n&&(wn=Qt&&Qt.onVnodeUnmounted)||ji)&&fo(()=>{wn&&Ro(wn,Ze,Ce),ji&&ja(Ce,null,Ze,"unmounted")},gt)},Fs=Ce=>{const{type:Ze,el:gt,anchor:Rt,transition:zt}=Ce;if(Ze===Us){Is(gt,Rt);return}if(Ze===_f){Oe(Ce);return}const Nt=()=>{g(gt),zt&&!zt.persisted&&zt.afterLeave&&zt.afterLeave()};if(Ce.shapeFlag&1&&zt&&!zt.persisted){const{leave:Qt,delayLeave:Gt}=zt,Kt=()=>Qt(gt,Nt);Gt?Gt(Ce.el,Nt,Kt):Kt()}else Nt()},Is=(Ce,Ze)=>{let gt;for(;Ce!==Ze;)gt=ie(Ce),g(Ce),Ce=gt;g(Ze)},Zi=(Ce,Ze,gt)=>{const{bum:Rt,scope:zt,job:Nt,subTree:Qt,um:Gt,m:Kt,a:Vt,parent:Ci,slots:{__:Jt}}=Ce;g2(Kt),g2(Vt),Rt&&Qy(Rt),Ci&&Hi(Jt)&&Jt.forEach(Ti=>{Ci.renderCache[Ti]=void 0}),zt.stop(),Nt&&(Nt.flags|=8,jn(Qt,Ce,Ze,gt)),Gt&&fo(Gt,Ze),fo(()=>{Ce.isUnmounted=!0},Ze),Ze&&Ze.pendingBranch&&!Ze.isUnmounted&&Ce.asyncDep&&!Ce.asyncResolved&&Ce.suspenseId===Ze.pendingId&&(Ze.deps--,Ze.deps===0&&Ze.resolve())},en=(Ce,Ze,gt,Rt=!1,zt=!1,Nt=0)=>{for(let Qt=Nt;Qt<Ce.length;Qt++)jn(Ce[Qt],Ze,gt,Rt,zt)},es=Ce=>{if(Ce.shapeFlag&6)return es(Ce.component.subTree);if(Ce.shapeFlag&128)return Ce.suspense.next();const Ze=ie(Ce.anchor||Ce.el),gt=Ze&&Ze[bO];return gt?ie(gt):Ze};let xs=!1;const fn=(Ce,Ze,gt)=>{Ce==null?Ze._vnode&&jn(Ze._vnode,null,null,!0):pe(Ze._vnode||null,Ce,Ze,null,null,null,gt),Ze._vnode=Ce,xs||(xs=!0,c2(),gx(),xs=!1)},pr={p:pe,um:jn,m:ss,r:Fs,mt:_i,mc:At,pc:hi,pbc:Zt,n:es,o:a};let Ks,Js;return s&&([Ks,Js]=s(pr)),{render:fn,hydrate:Ks,createApp:WO(fn,Ks)}}function ob({type:a,props:s},c){return c==="svg"&&a==="foreignObject"||c==="mathml"&&a==="annotation-xml"&&s&&s.encoding&&s.encoding.includes("html")?void 0:c}function ru({effect:a,job:s},c){c?(a.flags|=32,s.flags|=4):(a.flags&=-33,s.flags&=-5)}function IC(a,s){return(!a||a&&!a.pendingBranch)&&s&&!s.persisted}function CC(a,s,c=!1){const m=a.children,g=s.children;if(Hi(m)&&Hi(g))for(let b=0;b<m.length;b++){const E=m[b];let n=g[b];n.shapeFlag&1&&!n.dynamicChildren&&((n.patchFlag<=0||n.patchFlag===32)&&(n=g[b]=zc(g[b]),n.el=E.el),!c&&n.patchFlag!==-2&&CC(E,n)),n.type===Vc&&(n.el=E.el),n.type===Xa&&!n.el&&(n.el=E.el)}}function ik(a){const s=a.slice(),c=[0];let m,g,b,E,n;const R=a.length;for(m=0;m<R;m++){const B=a[m];if(B!==0){if(g=c[c.length-1],a[g]<B){s[m]=g,c.push(m);continue}for(b=0,E=c.length-1;b<E;)n=b+E>>1,a[c[n]]<B?b=n+1:E=n;B<a[c[b]]&&(b>0&&(s[m]=c[b-1]),c[b]=m)}}for(b=c.length,E=c[b-1];b-- >0;)c[b]=E,E=s[E];return c}function MC(a){const s=a.subTree.component;if(s)return s.asyncDep&&!s.asyncResolved?s:MC(s)}function g2(a){if(a)for(let s=0;s<a.length;s++)a[s].flags|=8}const S1=Symbol.for("v-scx"),nk=()=>ex(S1);function tx(a,s,c){return PC(a,s,c)}function PC(a,s,c=ys){const{immediate:m,deep:g,flush:b,once:E}=c,n=Lr({},c),R=s&&m||!s&&b!=="post";let B;if(c_){if(b==="sync"){const se=nk();B=se.__watcherHandles||(se.__watcherHandles=[])}else if(!R){const se=()=>{};return se.stop=yo,se.resume=yo,se.pause=yo,se}}const N=jr;n.call=(se,we,pe)=>Za(se,N,we,pe);let X=!1;b==="post"?n.scheduler=se=>{fo(se,N&&N.suspense)}:b!=="sync"&&(X=!0,n.scheduler=(se,we)=>{we?se():x1(se)}),n.augmentJob=se=>{s&&(se.flags|=4),X&&(se.flags|=2,N&&(se.id=N.uid,se.i=N))};const ie=_O(a,s,n);return c_&&(B?B.push(ie):R&&ie()),ie}function sk(a,s,c){const m=this.proxy,g=ps(a)?a.includes(".")?DC(m,a):()=>m[a]:a.bind(m,m);let b;vn(s)?b=s:(b=s.handler,c=s);const E=T_(this),n=PC(g,b.bind(m),c);return E(),n}function DC(a,s){const c=s.split(".");return()=>{let m=a;for(let g=0;g<c.length&&m;g++)m=m[c[g]];return m}}const rk=(a,s)=>s==="modelValue"||s==="model-value"?a.modelModifiers:a[`${s}Modifiers`]||a[`${jc(s)}Modifiers`]||a[`${Zc(s)}Modifiers`];function ok(a,s,...c){if(a.isUnmounted)return;const m=a.vnode.props||ys;let g=c;const b=s.startsWith("update:"),E=b&&rk(m,s.slice(7));E&&(E.trim&&(g=c.map(N=>ps(N)?N.trim():N)),E.number&&(g=c.map(dx)));let n,R=m[n=Q0(s)]||m[n=Q0(jc(s))];!R&&b&&(R=m[n=Q0(Zc(s))]),R&&Za(R,a,6,g);const B=m[n+"Once"];if(B){if(!a.emitted)a.emitted={};else if(a.emitted[n])return;a.emitted[n]=!0,Za(B,a,6,g)}}function RC(a,s,c=!1){const m=s.emitsCache,g=m.get(a);if(g!==void 0)return g;const b=a.emits;let E={},n=!1;if(!vn(a)){const R=B=>{const N=RC(B,s,!0);N&&(n=!0,Lr(E,N))};!c&&s.mixins.length&&s.mixins.forEach(R),a.extends&&R(a.extends),a.mixins&&a.mixins.forEach(R)}return!b&&!n?(As(a)&&m.set(a,null),null):(Hi(b)?b.forEach(R=>E[R]=null):Lr(E,b),As(a)&&m.set(a,E),E)}function Vx(a,s){return!a||!Rf(s)?!1:(s=s.slice(2).replace(/Once$/,""),cs(a,s[0].toLowerCase()+s.slice(1))||cs(a,Zc(s))||cs(a,s))}function ix(a){const{type:s,vnode:c,proxy:m,withProxy:g,propsOptions:[b],slots:E,attrs:n,emit:R,render:B,renderCache:N,props:X,data:ie,setupState:se,ctx:we,inheritAttrs:pe}=a,Ae=r_(a);let Ie,Je;try{if(c.shapeFlag&4){const Oe=g||m,tt=Oe;Ie=po(B.call(tt,Oe,N,X,se,ie,we)),Je=n}else{const Oe=s;Ie=po(Oe.length>1?Oe(X,{attrs:n,slots:E,emit:R}):Oe(X,null)),Je=s.props?n:ak(n)}}catch(Oe){Zm.length=0,Fx(Oe,a,1),Ie=Es(Xa)}let Pe=Ie;if(Je&&pe!==!1){const Oe=Object.keys(Je),{shapeFlag:tt}=Pe;Oe.length&&tt&7&&(b&&Oe.some(a1)&&(Je=lk(Je,b)),Pe=vf(Pe,Je,!1,!0))}return c.dirs&&(Pe=vf(Pe,null,!1,!0),Pe.dirs=Pe.dirs?Pe.dirs.concat(c.dirs):c.dirs),c.transition&&v1(Pe,c.transition),Ie=Pe,r_(Ae),Ie}const ak=a=>{let s;for(const c in a)(c==="class"||c==="style"||Rf(c))&&((s||(s={}))[c]=a[c]);return s},lk=(a,s)=>{const c={};for(const m in a)(!a1(m)||!(m.slice(9)in s))&&(c[m]=a[m]);return c};function ck(a,s,c){const{props:m,children:g,component:b}=a,{props:E,children:n,patchFlag:R}=s,B=b.emitsOptions;if(s.dirs||s.transition)return!0;if(c&&R>=0){if(R&1024)return!0;if(R&16)return m?y2(m,E,B):!!E;if(R&8){const N=s.dynamicProps;for(let X=0;X<N.length;X++){const ie=N[X];if(E[ie]!==m[ie]&&!Vx(B,ie))return!0}}}else return(g||n)&&(!n||!n.$stable)?!0:m===E?!1:m?E?y2(m,E,B):!0:!!E;return!1}function y2(a,s,c){const m=Object.keys(s);if(m.length!==Object.keys(a).length)return!0;for(let g=0;g<m.length;g++){const b=m[g];if(s[b]!==a[b]&&!Vx(c,b))return!0}return!1}function LC({vnode:a,parent:s},c){for(;s;){const m=s.subTree;if(m.suspense&&m.suspense.activeBranch===a&&(m.el=a.el),m===a)(a=s.vnode).el=c,s=s.parent;else break}}const zC=a=>a.__isSuspense;function OC(a,s){s&&s.pendingBranch?Hi(a)?s.effects.push(...a):s.effects.push(a):xO(a)}const Us=Symbol.for("v-fgt"),Vc=Symbol.for("v-txt"),Xa=Symbol.for("v-cmt"),_f=Symbol.for("v-stc"),Zm=[];let _o=null;function Ps(a=!1){Zm.push(_o=a?null:[])}function hk(){Zm.pop(),_o=Zm[Zm.length-1]||null}let a_=1;function x2(a,s=!1){a_+=a,a<0&&_o&&s&&(_o.hasOnce=!0)}function kC(a){return a.dynamicChildren=a_>0?_o||cf:null,hk(),a_>0&&_o&&_o.push(a),a}function Ls(a,s,c,m,g,b){return kC(fi(a,s,c,m,g,b,!0))}function uk(a,s,c,m,g){return kC(Es(a,s,c,m,g,!0))}function l_(a){return a?a.__v_isVNode===!0:!1}function Mm(a,s){return a.type===s.type&&a.key===s.key}const FC=({key:a})=>a??null,nx=({ref:a,ref_key:s,ref_for:c})=>(typeof a=="number"&&(a=""+a),a!=null?ps(a)||br(a)||vn(a)?{i:Lo,r:a,k:s,f:!!c}:a:null);function fi(a,s=null,c=null,m=0,g=null,b=a===Us?0:1,E=!1,n=!1){const R={__v_isVNode:!0,__v_skip:!0,type:a,props:s,key:s&&FC(s),ref:s&&nx(s),scopeId:hC,slotScopeIds:null,children:c,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:b,patchFlag:m,dynamicProps:g,dynamicChildren:null,appContext:null,ctx:Lo};return n?(E1(R,c),b&128&&a.normalize(R)):c&&(R.shapeFlag|=ps(c)?8:16),a_>0&&!E&&_o&&(R.patchFlag>0||b&6)&&R.patchFlag!==32&&_o.push(R),R}const Es=dk;function dk(a,s=null,c=null,m=0,g=null,b=!1){if((!a||a===BO)&&(a=Xa),l_(a)){const n=vf(a,s,!0);return c&&E1(n,c),a_>0&&!b&&_o&&(n.shapeFlag&6?_o[_o.indexOf(a)]=n:_o.push(n)),n.patchFlag=-2,n}if(xk(a)&&(a=a.__vccOpts),s){s=fk(s);let{class:n,style:R}=s;n&&!ps(n)&&(s.class=la(n)),As(R)&&(b_(R)&&!Hi(R)&&(R=Lr({},R)),s.style=zx(R))}const E=ps(a)?1:zC(a)?128:wO(a)?64:As(a)?4:vn(a)?2:0;return fi(a,s,c,m,g,E,b,!0)}function fk(a){return a?b_(a)||vC(a)?Lr({},a):a:null}function vf(a,s,c=!1,m=!1){const{props:g,ref:b,patchFlag:E,children:n,transition:R}=a,B=s?BC(g||{},s):g,N={__v_isVNode:!0,__v_skip:!0,type:a.type,props:B,key:B&&FC(B),ref:s&&s.ref?c&&b?Hi(b)?b.concat(nx(s)):[b,nx(s)]:nx(s):b,scopeId:a.scopeId,slotScopeIds:a.slotScopeIds,children:n,target:a.target,targetStart:a.targetStart,targetAnchor:a.targetAnchor,staticCount:a.staticCount,shapeFlag:a.shapeFlag,patchFlag:s&&a.type!==Us?E===-1?16:E|16:E,dynamicProps:a.dynamicProps,dynamicChildren:a.dynamicChildren,appContext:a.appContext,dirs:a.dirs,transition:R,component:a.component,suspense:a.suspense,ssContent:a.ssContent&&vf(a.ssContent),ssFallback:a.ssFallback&&vf(a.ssFallback),el:a.el,anchor:a.anchor,ctx:a.ctx,ce:a.ce};return R&&m&&v1(N,R.clone(N)),N}function ca(a=" ",s=0){return Es(Vc,null,a,s)}function Vm(a,s){const c=Es(_f,null,a);return c.staticCount=s,c}function af(a="",s=!1){return s?(Ps(),uk(Xa,null,a)):Es(Xa,null,a)}function po(a){return a==null||typeof a=="boolean"?Es(Xa):Hi(a)?Es(Us,null,a.slice()):l_(a)?zc(a):Es(Vc,null,String(a))}function zc(a){return a.el===null&&a.patchFlag!==-1||a.memo?a:vf(a)}function E1(a,s){let c=0;const{shapeFlag:m}=a;if(s==null)s=null;else if(Hi(s))c=16;else if(typeof s=="object")if(m&65){const g=s.default;g&&(g._c&&(g._d=!1),E1(a,g()),g._c&&(g._d=!0));return}else{c=32;const g=s._;!g&&!vC(s)?s._ctx=Lo:g===3&&Lo&&(Lo.slots._===1?s._=1:(s._=2,a.patchFlag|=1024))}else vn(s)?(s={default:s,_ctx:Lo},c=32):(s=String(s),m&64?(c=16,s=[ca(s)]):c=8);a.children=s,a.shapeFlag|=c}function BC(...a){const s={};for(let c=0;c<a.length;c++){const m=a[c];for(const g in m)if(g==="class")s.class!==m.class&&(s.class=la([s.class,m.class]));else if(g==="style")s.style=zx([s.style,m.style]);else if(Rf(g)){const b=s[g],E=m[g];E&&b!==E&&!(Hi(b)&&b.includes(E))&&(s[g]=b?[].concat(b,E):E)}else g!==""&&(s[g]=m[g])}return s}function Ro(a,s,c,m=null){Za(a,s,7,[c,m])}const pk=gC();let mk=0;function NC(a,s,c){const m=a.type,g=(s?s.appContext:a.appContext)||pk,b={uid:mk++,vnode:a,type:m,parent:s,appContext:g,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Nz(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:s?s.provides:Object.create(g.provides),ids:s?s.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:wC(m,g),emitsOptions:RC(m,g),emit:null,emitted:null,propsDefaults:ys,inheritAttrs:m.inheritAttrs,ctx:ys,data:ys,props:ys,attrs:ys,slots:ys,refs:ys,setupState:ys,setupContext:null,suspense:c,suspenseId:c?c.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return b.ctx={_:b},b.root=s?s.root:b,b.emit=ok.bind(null,b),a.ce&&a.ce(b),b}let jr=null,xx,Hb;{const a=v_(),s=(c,m)=>{let g;return(g=a[c])||(g=a[c]=[]),g.push(m),b=>{g.length>1?g.forEach(E=>E(b)):g[0](b)}};xx=s("__VUE_INSTANCE_SETTERS__",c=>jr=c),Hb=s("__VUE_SSR_SETTERS__",c=>c_=c)}const T_=a=>{const s=jr;return xx(a),a.scope.on(),()=>{a.scope.off(),xx(s)}},v2=()=>{jr&&jr.scope.off(),xx(null)};function VC(a){return a.vnode.shapeFlag&4}let c_=!1;function UC(a,s=!1,c=!1){s&&Hb(s);const{props:m,children:g}=a.vnode,b=VC(a);ZO(a,m,b,s),JO(a,g,c||s);const E=b?_k(a,s):void 0;return s&&Hb(!1),E}function _k(a,s){const c=a.type;a.accessCache=Object.create(null),a.proxy=new Proxy(a.ctx,NO);const{setup:m}=c;if(m){Ol();const g=a.setupContext=m.length>1?yk(a):null,b=T_(a),E=w_(m,a,0,[a.props,g]),n=xf(E);if(kl(),b(),(n||a.sp)&&!pf(a)&&dC(a),n){if(E.then(v2,v2),s)return E.then(R=>{b2(a,R)}).catch(R=>{Fx(R,a,0)});a.asyncDep=E}else b2(a,E)}else jC(a)}function b2(a,s,c){vn(s)?a.type.__ssrInlineRender?a.ssrRender=s:a.render=s:As(s)&&(a.setupState=oC(s)),jC(a)}function jC(a,s,c){const m=a.type;a.render||(a.render=m.render||yo);{const g=T_(a);Ol();try{VO(a)}finally{kl(),g()}}}const gk={get(a,s){return Dr(a,"get",""),a[s]}};function yk(a){const s=c=>{a.exposed=c||{}};return{attrs:new Proxy(a.attrs,gk),slots:a.slots,emit:a.emit,expose:s}}function Ux(a){return a.exposed?a.exposeProxy||(a.exposeProxy=new Proxy(oC(aO(a.exposed)),{get(s,c){if(c in s)return s[c];if(c in qm)return qm[c](a)},has(s,c){return c in s||c in qm}})):a.proxy}function xk(a){return vn(a)&&"__vccOpts"in a}const vu=(a,s)=>pO(a,s,c_);function vx(a,s,c){const m=arguments.length;return m===2?As(s)&&!Hi(s)?l_(s)?Es(a,null,[s]):Es(a,s):Es(a,null,s):(m>3?c=Array.prototype.slice.call(arguments,2):m===3&&l_(c)&&(c=[c]),Es(a,s,c))}const $C="3.5.17",vk={createComponentInstance:NC,setupComponent:UC,renderComponentRoot:ix,setCurrentRenderingInstance:r_,isVNode:l_,normalizeVNode:po},GC=vk;/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Wb;const w2=typeof window<"u"&&window.trustedTypes;if(w2)try{Wb=w2.createPolicy("vue",{createHTML:a=>a})}catch{}const HC=Wb?a=>Wb.createHTML(a):a=>a,bk="http://www.w3.org/2000/svg",wk="http://www.w3.org/1998/Math/MathML",Cl=typeof document<"u"?document:null,T2=Cl&&Cl.createElement("template"),Tk={insert:(a,s,c)=>{s.insertBefore(a,c||null)},remove:a=>{const s=a.parentNode;s&&s.removeChild(a)},createElement:(a,s,c,m)=>{const g=s==="svg"?Cl.createElementNS(bk,a):s==="mathml"?Cl.createElementNS(wk,a):c?Cl.createElement(a,{is:c}):Cl.createElement(a);return a==="select"&&m&&m.multiple!=null&&g.setAttribute("multiple",m.multiple),g},createText:a=>Cl.createTextNode(a),createComment:a=>Cl.createComment(a),setText:(a,s)=>{a.nodeValue=s},setElementText:(a,s)=>{a.textContent=s},parentNode:a=>a.parentNode,nextSibling:a=>a.nextSibling,querySelector:a=>Cl.querySelector(a),setScopeId(a,s){a.setAttribute(s,"")},insertStaticContent(a,s,c,m,g,b){const E=c?c.previousSibling:s.lastChild;if(g&&(g===b||g.nextSibling))for(;s.insertBefore(g.cloneNode(!0),c),!(g===b||!(g=g.nextSibling)););else{T2.innerHTML=HC(m==="svg"?`<svg>${a}</svg>`:m==="mathml"?`<math>${a}</math>`:a);const n=T2.content;if(m==="svg"||m==="mathml"){const R=n.firstChild;for(;R.firstChild;)n.appendChild(R.firstChild);n.removeChild(R)}s.insertBefore(n,c)}return[E?E.nextSibling:s.firstChild,c?c.previousSibling:s.lastChild]}},Sk=Symbol("_vtc");function Ek(a,s,c){const m=a[Sk];m&&(s=(s?[s,...m]:[...m]).join(" ")),s==null?a.removeAttribute("class"):c?a.setAttribute("class",s):a.className=s}const bx=Symbol("_vod"),WC=Symbol("_vsh"),Um={beforeMount(a,{value:s},{transition:c}){a[bx]=a.style.display==="none"?"":a.style.display,c&&s?c.beforeEnter(a):Pm(a,s)},mounted(a,{value:s},{transition:c}){c&&s&&c.enter(a)},updated(a,{value:s,oldValue:c},{transition:m}){!s!=!c&&(m?s?(m.beforeEnter(a),Pm(a,!0),m.enter(a)):m.leave(a,()=>{Pm(a,!1)}):Pm(a,s))},beforeUnmount(a,{value:s}){Pm(a,s)}};function Pm(a,s){a.style.display=s?a[bx]:"none",a[WC]=!s}function Ak(){Um.getSSRProps=({value:a})=>{if(!a)return{style:{display:"none"}}}}const Ik=Symbol(""),Ck=/(^|;)\s*display\s*:/;function Mk(a,s,c){const m=a.style,g=ps(c);let b=!1;if(c&&!g){if(s)if(ps(s))for(const E of s.split(";")){const n=E.slice(0,E.indexOf(":")).trim();c[n]==null&&sx(m,n,"")}else for(const E in s)c[E]==null&&sx(m,E,"");for(const E in c)E==="display"&&(b=!0),sx(m,E,c[E])}else if(g){if(s!==c){const E=m[Ik];E&&(c+=";"+E),m.cssText=c,b=Ck.test(c)}}else s&&a.removeAttribute("style");bx in a&&(a[bx]=b?m.display:"",a[WC]&&(m.display="none"))}const S2=/\s*!important$/;function sx(a,s,c){if(Hi(c))c.forEach(m=>sx(a,s,m));else if(c==null&&(c=""),s.startsWith("--"))a.setProperty(s,c);else{const m=Pk(a,s);S2.test(c)?a.setProperty(Zc(m),c.replace(S2,""),"important"):a[m]=c}}const E2=["Webkit","Moz","ms"],ab={};function Pk(a,s){const c=ab[s];if(c)return c;let m=jc(s);if(m!=="filter"&&m in a)return ab[s]=m;m=NI(m);for(let g=0;g<E2.length;g++){const b=E2[g]+m;if(b in a)return ab[s]=b}return s}const A2="http://www.w3.org/1999/xlink";function I2(a,s,c,m,g,b=Mz(s)){m&&s.startsWith("xlink:")?c==null?a.removeAttributeNS(A2,s.slice(6,s.length)):a.setAttributeNS(A2,s,c):c==null||b&&!h1(c)?a.removeAttribute(s):a.setAttribute(s,b?"":qa(c)?String(c):c)}function C2(a,s,c,m,g){if(s==="innerHTML"||s==="textContent"){c!=null&&(a[s]=s==="innerHTML"?HC(c):c);return}const b=a.tagName;if(s==="value"&&b!=="PROGRESS"&&!b.includes("-")){const n=b==="OPTION"?a.getAttribute("value")||"":a.value,R=c==null?a.type==="checkbox"?"on":"":String(c);(n!==R||!("_value"in a))&&(a.value=R),c==null&&a.removeAttribute(s),a._value=c;return}let E=!1;if(c===""||c==null){const n=typeof a[s];n==="boolean"?c=h1(c):c==null&&n==="string"?(c="",E=!0):n==="number"&&(c=0,E=!0)}try{a[s]=c}catch{}E&&a.removeAttribute(g||s)}function Oc(a,s,c,m){a.addEventListener(s,c,m)}function Dk(a,s,c,m){a.removeEventListener(s,c,m)}const M2=Symbol("_vei");function Rk(a,s,c,m,g=null){const b=a[M2]||(a[M2]={}),E=b[s];if(m&&E)E.value=m;else{const[n,R]=Lk(s);if(m){const B=b[s]=kk(m,g);Oc(a,n,B,R)}else E&&(Dk(a,n,E,R),b[s]=void 0)}}const P2=/(?:Once|Passive|Capture)$/;function Lk(a){let s;if(P2.test(a)){s={};let m;for(;m=a.match(P2);)a=a.slice(0,a.length-m[0].length),s[m[0].toLowerCase()]=!0}return[a[2]===":"?a.slice(3):Zc(a.slice(2)),s]}let lb=0;const zk=Promise.resolve(),Ok=()=>lb||(zk.then(()=>lb=0),lb=Date.now());function kk(a,s){const c=m=>{if(!m._vts)m._vts=Date.now();else if(m._vts<=c.attached)return;Za(Fk(m,c.value),s,5,[m])};return c.value=a,c.attached=Ok(),c}function Fk(a,s){if(Hi(s)){const c=a.stopImmediatePropagation;return a.stopImmediatePropagation=()=>{c.call(a),a._stopped=!0},s.map(m=>g=>!g._stopped&&m&&m(g))}else return s}const D2=a=>a.charCodeAt(0)===111&&a.charCodeAt(1)===110&&a.charCodeAt(2)>96&&a.charCodeAt(2)<123,Bk=(a,s,c,m,g,b)=>{const E=g==="svg";s==="class"?Ek(a,m,E):s==="style"?Mk(a,c,m):Rf(s)?a1(s)||Rk(a,s,c,m,b):(s[0]==="."?(s=s.slice(1),!0):s[0]==="^"?(s=s.slice(1),!1):Nk(a,s,m,E))?(C2(a,s,m),!a.tagName.includes("-")&&(s==="value"||s==="checked"||s==="selected")&&I2(a,s,m,E,b,s!=="value")):a._isVueCE&&(/[A-Z]/.test(s)||!ps(m))?C2(a,jc(s),m,b,s):(s==="true-value"?a._trueValue=m:s==="false-value"&&(a._falseValue=m),I2(a,s,m,E))};function Nk(a,s,c,m){if(m)return!!(s==="innerHTML"||s==="textContent"||s in a&&D2(s)&&vn(c));if(s==="spellcheck"||s==="draggable"||s==="translate"||s==="autocorrect"||s==="form"||s==="list"&&a.tagName==="INPUT"||s==="type"&&a.tagName==="TEXTAREA")return!1;if(s==="width"||s==="height"){const g=a.tagName;if(g==="IMG"||g==="VIDEO"||g==="CANVAS"||g==="SOURCE")return!1}return D2(s)&&ps(c)?!1:s in a}const bf=a=>{const s=a.props["onUpdate:modelValue"]||!1;return Hi(s)?c=>Qy(s,c):s};function Vk(a){a.target.composing=!0}function R2(a){const s=a.target;s.composing&&(s.composing=!1,s.dispatchEvent(new Event("input")))}const Rl=Symbol("_assign"),qC={created(a,{modifiers:{lazy:s,trim:c,number:m}},g){a[Rl]=bf(g);const b=m||g.props&&g.props.type==="number";Oc(a,s?"change":"input",E=>{if(E.target.composing)return;let n=a.value;c&&(n=n.trim()),b&&(n=dx(n)),a[Rl](n)}),c&&Oc(a,"change",()=>{a.value=a.value.trim()}),s||(Oc(a,"compositionstart",Vk),Oc(a,"compositionend",R2),Oc(a,"change",R2))},mounted(a,{value:s}){a.value=s??""},beforeUpdate(a,{value:s,oldValue:c,modifiers:{lazy:m,trim:g,number:b}},E){if(a[Rl]=bf(E),a.composing)return;const n=(b||a.type==="number")&&!/^0\d/.test(a.value)?dx(a.value):a.value,R=s??"";n!==R&&(document.activeElement===a&&a.type!=="range"&&(m&&s===c||g&&a.value.trim()===R)||(a.value=R))}},ZC={deep:!0,created(a,s,c){a[Rl]=bf(c),Oc(a,"change",()=>{const m=a._modelValue,g=h_(a),b=a.checked,E=a[Rl];if(Hi(m)){const n=Ox(m,g),R=n!==-1;if(b&&!R)E(m.concat(g));else if(!b&&R){const B=[...m];B.splice(n,1),E(B)}}else if(Iu(m)){const n=new Set(m);b?n.add(g):n.delete(g),E(n)}else E(XC(a,b))})},mounted:L2,beforeUpdate(a,s,c){a[Rl]=bf(c),L2(a,s,c)}};function L2(a,{value:s,oldValue:c},m){a._modelValue=s;let g;if(Hi(s))g=Ox(s,m.props.value)>-1;else if(Iu(s))g=s.has(m.props.value);else{if(s===c)return;g=Lf(s,XC(a,!0))}a.checked!==g&&(a.checked=g)}const Uk={},jk={deep:!0,created(a,{value:s,modifiers:{number:c}},m){const g=Iu(s);Oc(a,"change",()=>{const b=Array.prototype.filter.call(a.options,E=>E.selected).map(E=>c?dx(h_(E)):h_(E));a[Rl](a.multiple?g?new Set(b):b:b[0]),a._assigning=!0,y1(()=>{a._assigning=!1})}),a[Rl]=bf(m)},mounted(a,{value:s}){z2(a,s)},beforeUpdate(a,s,c){a[Rl]=bf(c)},updated(a,{value:s}){a._assigning||z2(a,s)}};function z2(a,s){const c=a.multiple,m=Hi(s);if(!(c&&!m&&!Iu(s))){for(let g=0,b=a.options.length;g<b;g++){const E=a.options[g],n=h_(E);if(c)if(m){const R=typeof n;R==="string"||R==="number"?E.selected=s.some(B=>String(B)===String(n)):E.selected=Ox(s,n)>-1}else E.selected=s.has(n);else if(Lf(h_(E),s)){a.selectedIndex!==g&&(a.selectedIndex=g);return}}!c&&a.selectedIndex!==-1&&(a.selectedIndex=-1)}}function h_(a){return"_value"in a?a._value:a.value}function XC(a,s){const c=s?"_trueValue":"_falseValue";return c in a?a[c]:s}function $k(){qC.getSSRProps=({value:a})=>({value:a}),Uk.getSSRProps=({value:a},s)=>{if(s.props&&Lf(s.props.value,a))return{checked:!0}},ZC.getSSRProps=({value:a},s)=>{if(Hi(a)){if(s.props&&Ox(a,s.props.value)>-1)return{checked:!0}}else if(Iu(a)){if(s.props&&a.has(s.props.value))return{checked:!0}}else if(a)return{checked:!0}}}const YC=Lr({patchProp:Bk},Tk);let Xm,O2=!1;function Gk(){return Xm||(Xm=ek(YC))}function Hk(){return Xm=O2?Xm:tk(YC),O2=!0,Xm}const KC=(...a)=>{const s=Gk().createApp(...a),{mount:c}=s;return s.mount=m=>{const g=QC(m);if(!g)return;const b=s._component;!vn(b)&&!b.render&&!b.template&&(b.template=g.innerHTML),g.nodeType===1&&(g.textContent="");const E=c(g,!1,JC(g));return g instanceof Element&&(g.removeAttribute("v-cloak"),g.setAttribute("data-v-app","")),E},s},Wk=(...a)=>{const s=Hk().createApp(...a),{mount:c}=s;return s.mount=m=>{const g=QC(m);if(g)return c(g,!0,JC(g))},s};function JC(a){if(a instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&a instanceof MathMLElement)return"mathml"}function QC(a){return ps(a)?document.querySelector(a):a}let k2=!1;const qk=()=>{k2||(k2=!0,$k(),Ak())};/**
* @vue/server-renderer v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const Zk=Au(",key,ref,innerHTML,textContent,ref_key,ref_for");function Xk(a,s){let c="";for(const m in a){if(Zk(m)||Rf(m)||s==="textarea"&&m==="value")continue;const g=a[m];m==="class"?c+=` class="${Kk(g)}"`:m==="style"?c+=` style="${Jk(g)}"`:m==="className"?c+=` class="${String(g)}"`:c+=Yk(m,g,s)}return c}function Yk(a,s,c){if(!zz(s))return"";const m=c&&(c.indexOf("-")>0||Iz(c))?a:Lz[a]||a.toLowerCase();return Pz(m)?h1(s)?` ${m}`:"":Rz(m)?s===""?` ${m}`:` ${m}="${Nc(s)}"`:(console.warn(`[@vue/server-renderer] Skipped rendering unsafe attribute name: ${m}`),"")}function Kk(a){return Nc(la(a))}function Jk(a){if(!a)return"";if(ps(a))return Nc(a);const s=zx(a);return Nc(Sz(s))}function Qk(a,s,c,m,g){a("<!--teleport start-->");const b=g.appContext.provides[S1],E=b.__teleportBuffers||(b.__teleportBuffers={}),n=E[c]||(E[c]=[]),R=n.length;let B;if(m)s(a),B="<!--teleport start anchor--><!--teleport anchor-->";else{const{getBuffer:N,push:X}=eM();X("<!--teleport start anchor-->"),s(X),X("<!--teleport anchor-->"),B=N()}n.splice(R,0,B),a("<!--teleport end-->")}{const a=v_(),s=(c,m)=>{let g;return(g=a[c])||(g=a[c]=[]),g.push(m),b=>{g.length>1?g.forEach(E=>E(b)):g[0](b)}};s("__VUE_INSTANCE_SETTERS__",c=>c),s("__VUE_SSR_SETTERS__",c=>c)}function e3(a,s){throw new Error("On-the-fly template compilation is not supported in the ESM build of @vue/server-renderer. All templates must be pre-compiled into render functions.")}const{createComponentInstance:t3,setCurrentRenderingInstance:F2,setupComponent:i3,renderComponentRoot:B2,normalizeVNode:n3}=GC;function eM(){let a=!1;const s=[];return{getBuffer(){return s},push(c){const m=ps(c);if(a&&m){s[s.length-1]+=c;return}s.push(c),a=m,(xf(c)||Hi(c)&&c.hasAsync)&&(s.hasAsync=!0)}}}function tM(a,s=null,c){const m=a.component=t3(a,s,null),g=i3(m,!0),b=xf(g);let E=m.sp;return b||E?Promise.resolve(g).then(()=>{if(b&&(E=m.sp),E)return Promise.all(E.map(R=>R.call(m.proxy)))}).catch(yo).then(()=>N2(m,c)):N2(m,c)}function N2(a,s){const c=a.type,{getBuffer:m,push:g}=eM();if(vn(c)){let b=B2(a);if(!c.props)for(const E in a.attrs)E.startsWith("data-v-")&&((b.props||(b.props={}))[E]="");wx(g,a.subTree=b,a,s)}else{(!a.render||a.render===yo)&&!a.ssrRender&&!c.ssrRender&&ps(c.template)&&(c.ssrRender=e3(c.template));const b=a.ssrRender||c.ssrRender;if(b){let E=a.inheritAttrs!==!1?a.attrs:void 0,n=!1,R=a;for(;;){const N=R.vnode.scopeId;N&&(n||(E={...E},n=!0),E[N]="");const X=R.parent;if(X&&X.subTree&&X.subTree===R.vnode)R=X;else break}if(s){n||(E={...E});const N=s.trim().split(" ");for(let X=0;X<N.length;X++)E[N[X]]=""}const B=F2(a);try{b(a.proxy,g,a,E,a.props,a.setupState,a.data,a.ctx)}finally{F2(B)}}else a.render&&a.render!==yo?wx(g,a.subTree=B2(a),a,s):(c.name||c.__file,g("<!---->"))}return m()}function wx(a,s,c,m){const{type:g,shapeFlag:b,children:E,dirs:n,props:R}=s;switch(n&&(s.props=r3(s,R,n)),g){case Vc:a(Nc(E));break;case Xa:a(E?`<!--${Fz(E)}-->`:"<!---->");break;case _f:a(E);break;case Us:s.slotScopeIds&&(m=(m?m+" ":"")+s.slotScopeIds.join(" ")),a("<!--[-->"),A1(a,E,c,m),a("<!--]-->");break;default:b&1?s3(a,s,c,m):b&6?a(tM(s,c,m)):b&64?o3(a,s,c,m):b&128&&wx(a,s.ssContent,c,m)}}function A1(a,s,c,m){for(let g=0;g<s.length;g++)wx(a,n3(s[g]),c,m)}function s3(a,s,c,m){const g=s.type;let{props:b,children:E,shapeFlag:n,scopeId:R}=s,B=`<${g}`;b&&(B+=Xk(b,g)),R&&(B+=` ${R}`);let N=c,X=s;for(;N&&X===N.subTree;)X=N.vnode,X.scopeId&&(B+=` ${X.scopeId}`),N=N.parent;if(m&&(B+=` ${m}`),a(B+">"),!Cz(g)){let ie=!1;b&&(b.innerHTML?(ie=!0,a(b.innerHTML)):b.textContent?(ie=!0,a(Nc(b.textContent))):g==="textarea"&&b.value&&(ie=!0,a(Nc(b.value)))),ie||(n&8?a(Nc(E)):n&16&&A1(a,E,c,m)),a(`</${g}>`)}}function r3(a,s,c){const m=[];for(let g=0;g<c.length;g++){const b=c[g],{dir:{getSSRProps:E}}=b;if(E){const n=E(b,a);n&&m.push(n)}}return BC(s||{},...m)}function o3(a,s,c,m){const g=s.props&&s.props.to,b=s.props&&s.props.disabled;if(!g)return[];if(!ps(g))return[];Qk(a,E=>{A1(E,s.children,c,m)},g,b||b==="",c)}const{isVNode:a3}=GC;function rx(a,s,c){if(!a.hasAsync)return s+nM(a);let m=s;for(let g=c;g<a.length;g+=1){const b=a[g];if(ps(b)){m+=b;continue}if(xf(b))return b.then(n=>(a[g]=n,rx(a,m,g)));const E=rx(b,m,0);if(xf(E))return E.then(n=>(a[g]=n,rx(a,"",g)));m=E}return m}function iM(a){return rx(a,"",0)}function nM(a){let s="";for(let c=0;c<a.length;c++){let m=a[c];ps(m)?s+=m:s+=nM(m)}return s}async function sM(a,s={}){if(a3(a))return sM(KC({render:()=>a}),s);const c=Es(a._component,a._props);c.appContext=a._context,a.provide(S1,s);const m=await tM(c),g=await iM(m);if(await l3(s),s.__watcherHandles)for(const b of s.__watcherHandles)b();return g}async function l3(a){if(a.__teleportBuffers){a.teleports=a.teleports||{};for(const s in a.__teleportBuffers)a.teleports[s]=await iM(await Promise.all([a.__teleportBuffers[s]]))}}qk();function c3(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var ox={exports:{}},h3=ox.exports,V2;function u3(){return V2||(V2=1,function(a,s){(function(c,m){a.exports=m()})(h3,function(){var c,m,g;function b(n,R){if(!c)c=R;else if(!m)m=R;else{var B="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+m+")(sharedChunk); self.onerror = null;",N={};c(N),g=R(N),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([B],{type:"text/javascript"})))}}b(["exports"],function(n){var R=1e-6,B=typeof Float32Array<"u"?Float32Array:Array;function N(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=i*f-h*l;return p?(r[0]=f*(p=1/p),r[1]=-l*p,r[2]=-h*p,r[3]=i*p,r):null}function X(){var r=new B(9);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function ie(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=e[4],x=e[5],w=e[6],T=e[7],I=e[8];return r[0]=p*I-x*T,r[1]=h*T-l*I,r[2]=l*x-h*p,r[3]=x*w-f*I,r[4]=i*I-h*w,r[5]=h*f-i*x,r[6]=f*T-p*w,r[7]=l*w-i*T,r[8]=i*p-l*f,r}function se(r,e,i){var l=e[0],h=e[1],f=e[2],p=e[3],x=e[4],w=e[5],T=e[6],I=e[7],C=e[8],M=i[0],L=i[1],O=i[2],V=i[3],$=i[4],W=i[5],Q=i[6],ee=i[7],U=i[8];return r[0]=M*l+L*p+O*T,r[1]=M*h+L*x+O*I,r[2]=M*f+L*w+O*C,r[3]=V*l+$*p+W*T,r[4]=V*h+$*x+W*I,r[5]=V*f+$*w+W*C,r[6]=Q*l+ee*p+U*T,r[7]=Q*h+ee*x+U*I,r[8]=Q*f+ee*w+U*C,r}function we(){var r=new B(16);return B!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function pe(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Ae(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=e[4],x=e[5],w=e[6],T=e[7],I=e[8],C=e[9],M=e[10],L=e[11],O=e[12],V=e[13],$=e[14],W=e[15],Q=i*x-l*p,ee=i*w-h*p,U=i*T-f*p,Y=l*w-h*x,te=l*T-f*x,oe=h*T-f*w,ve=I*V-C*O,ge=I*$-M*O,be=I*W-L*O,Me=C*$-M*V,$e=C*W-L*V,ot=M*W-L*$,Qe=Q*ot-ee*$e+U*Me+Y*be-te*ge+oe*ve;return Qe?(r[0]=(x*ot-w*$e+T*Me)*(Qe=1/Qe),r[1]=(h*$e-l*ot-f*Me)*Qe,r[2]=(V*oe-$*te+W*Y)*Qe,r[3]=(M*te-C*oe-L*Y)*Qe,r[4]=(w*be-p*ot-T*ge)*Qe,r[5]=(i*ot-h*be+f*ge)*Qe,r[6]=($*U-O*oe-W*ee)*Qe,r[7]=(I*oe-M*U+L*ee)*Qe,r[8]=(p*$e-x*be+T*ve)*Qe,r[9]=(l*be-i*$e-f*ve)*Qe,r[10]=(O*te-V*U+W*Q)*Qe,r[11]=(C*U-I*te-L*Q)*Qe,r[12]=(x*ge-p*Me-w*ve)*Qe,r[13]=(i*Me-l*ge+h*ve)*Qe,r[14]=(V*ee-O*Y-$*Q)*Qe,r[15]=(I*Y-C*ee+M*Q)*Qe,r):null}function Ie(r,e,i){var l=e[0],h=e[1],f=e[2],p=e[3],x=e[4],w=e[5],T=e[6],I=e[7],C=e[8],M=e[9],L=e[10],O=e[11],V=e[12],$=e[13],W=e[14],Q=e[15],ee=i[0],U=i[1],Y=i[2],te=i[3];return r[0]=ee*l+U*x+Y*C+te*V,r[1]=ee*h+U*w+Y*M+te*$,r[2]=ee*f+U*T+Y*L+te*W,r[3]=ee*p+U*I+Y*O+te*Q,r[4]=(ee=i[4])*l+(U=i[5])*x+(Y=i[6])*C+(te=i[7])*V,r[5]=ee*h+U*w+Y*M+te*$,r[6]=ee*f+U*T+Y*L+te*W,r[7]=ee*p+U*I+Y*O+te*Q,r[8]=(ee=i[8])*l+(U=i[9])*x+(Y=i[10])*C+(te=i[11])*V,r[9]=ee*h+U*w+Y*M+te*$,r[10]=ee*f+U*T+Y*L+te*W,r[11]=ee*p+U*I+Y*O+te*Q,r[12]=(ee=i[12])*l+(U=i[13])*x+(Y=i[14])*C+(te=i[15])*V,r[13]=ee*h+U*w+Y*M+te*$,r[14]=ee*f+U*T+Y*L+te*W,r[15]=ee*p+U*I+Y*O+te*Q,r}function Je(r,e,i){var l,h,f,p,x,w,T,I,C,M,L,O,V=i[0],$=i[1],W=i[2];return e===r?(r[12]=e[0]*V+e[4]*$+e[8]*W+e[12],r[13]=e[1]*V+e[5]*$+e[9]*W+e[13],r[14]=e[2]*V+e[6]*$+e[10]*W+e[14],r[15]=e[3]*V+e[7]*$+e[11]*W+e[15]):(h=e[1],f=e[2],p=e[3],x=e[4],w=e[5],T=e[6],I=e[7],C=e[8],M=e[9],L=e[10],O=e[11],r[0]=l=e[0],r[1]=h,r[2]=f,r[3]=p,r[4]=x,r[5]=w,r[6]=T,r[7]=I,r[8]=C,r[9]=M,r[10]=L,r[11]=O,r[12]=l*V+x*$+C*W+e[12],r[13]=h*V+w*$+M*W+e[13],r[14]=f*V+T*$+L*W+e[14],r[15]=p*V+I*$+O*W+e[15]),r}function Pe(r,e,i){var l=i[0],h=i[1],f=i[2];return r[0]=e[0]*l,r[1]=e[1]*l,r[2]=e[2]*l,r[3]=e[3]*l,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*f,r[9]=e[9]*f,r[10]=e[10]*f,r[11]=e[11]*f,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Oe(r,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[4],p=e[5],x=e[6],w=e[7],T=e[8],I=e[9],C=e[10],M=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=f*h+T*l,r[5]=p*h+I*l,r[6]=x*h+C*l,r[7]=w*h+M*l,r[8]=T*h-f*l,r[9]=I*h-p*l,r[10]=C*h-x*l,r[11]=M*h-w*l,r}function tt(r,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[0],p=e[1],x=e[2],w=e[3],T=e[8],I=e[9],C=e[10],M=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*h-T*l,r[1]=p*h-I*l,r[2]=x*h-C*l,r[3]=w*h-M*l,r[8]=f*l+T*h,r[9]=p*l+I*h,r[10]=x*l+C*h,r[11]=w*l+M*h,r}function xt(r,e,i){var l=Math.sin(i),h=Math.cos(i),f=e[0],p=e[1],x=e[2],w=e[3],T=e[4],I=e[5],C=e[6],M=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=f*h+T*l,r[1]=p*h+I*l,r[2]=x*h+C*l,r[3]=w*h+M*l,r[4]=T*h-f*l,r[5]=I*h-p*l,r[6]=C*h-x*l,r[7]=M*h-w*l,r}function Tt(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function At(r,e,i){var l,h,f,p=i[0],x=i[1],w=i[2],T=Math.hypot(p,x,w);return T<R?null:(p*=T=1/T,x*=T,w*=T,l=Math.sin(e),h=Math.cos(e),r[0]=p*p*(f=1-h)+h,r[1]=x*p*f+w*l,r[2]=w*p*f-x*l,r[3]=0,r[4]=p*x*f-w*l,r[5]=x*x*f+h,r[6]=w*x*f+p*l,r[7]=0,r[8]=p*w*f+x*l,r[9]=x*w*f-p*l,r[10]=w*w*f+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function Wt(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=i+i,x=l+l,w=h+h,T=i*p,I=l*p,C=l*x,M=h*p,L=h*x,O=h*w,V=f*p,$=f*x,W=f*w;return r[0]=1-C-O,r[1]=I+W,r[2]=M-$,r[3]=0,r[4]=I-W,r[5]=1-T-O,r[6]=L+V,r[7]=0,r[8]=M+$,r[9]=L-V,r[10]=1-T-C,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Zt=Ie;function jt(){var r=new B(3);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function pi(r){var e=new B(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function gi(r){return Math.hypot(r[0],r[1],r[2])}function _i(r,e,i){var l=new B(3);return l[0]=r,l[1]=e,l[2]=i,l}function yi(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function $t(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function xi(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function hi(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function sn(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Ui(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function ss(r,e,i,l){return r[0]=e[0]+i[0]*l,r[1]=e[1]+i[1]*l,r[2]=e[2]+i[2]*l,r}function jn(r,e){var i=e[0]-r[0],l=e[1]-r[1],h=e[2]-r[2];return i*i+l*l+h*h}function Fs(r){var e=r[0],i=r[1],l=r[2];return e*e+i*i+l*l}function Is(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function Zi(r,e){var i=e[0],l=e[1],h=e[2],f=i*i+l*l+h*h;return f>0&&(f=1/Math.sqrt(f)),r[0]=e[0]*f,r[1]=e[1]*f,r[2]=e[2]*f,r}function en(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function es(r,e,i){var l=e[0],h=e[1],f=e[2],p=i[0],x=i[1],w=i[2];return r[0]=h*w-f*x,r[1]=f*p-l*w,r[2]=l*x-h*p,r}function xs(r,e,i,l){var h=e[0],f=e[1],p=e[2];return r[0]=h+l*(i[0]-h),r[1]=f+l*(i[1]-f),r[2]=p+l*(i[2]-p),r}function fn(r,e,i){var l=e[0],h=e[1],f=e[2],p=i[3]*l+i[7]*h+i[11]*f+i[15];return r[0]=(i[0]*l+i[4]*h+i[8]*f+i[12])/(p=p||1),r[1]=(i[1]*l+i[5]*h+i[9]*f+i[13])/p,r[2]=(i[2]*l+i[6]*h+i[10]*f+i[14])/p,r}function pr(r,e,i){var l=e[0],h=e[1],f=e[2];return r[0]=l*i[0]+h*i[3]+f*i[6],r[1]=l*i[1]+h*i[4]+f*i[7],r[2]=l*i[2]+h*i[5]+f*i[8],r}function Ks(r,e,i){var l=i[0],h=i[1],f=i[2],p=e[0],x=e[1],w=e[2],T=h*w-f*x,I=f*p-l*w,C=l*x-h*p,M=h*C-f*I,L=f*T-l*C,O=l*I-h*T,V=2*i[3];return I*=V,C*=V,L*=2,O*=2,r[0]=p+(T*=V)+(M*=2),r[1]=x+I+L,r[2]=w+C+O,r}function Js(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var Ce=$t,Ze=xi,gt=gi;function Rt(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function zt(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function Nt(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=i*i+l*l+h*h+f*f;return p>0&&(p=1/Math.sqrt(p)),r[0]=i*p,r[1]=l*p,r[2]=h*p,r[3]=f*p,r}function Qt(r,e,i){var l=e[0],h=e[1],f=e[2],p=e[3];return r[0]=i[0]*l+i[4]*h+i[8]*f+i[12]*p,r[1]=i[1]*l+i[5]*h+i[9]*f+i[13]*p,r[2]=i[2]*l+i[6]*h+i[10]*f+i[14]*p,r[3]=i[3]*l+i[7]*h+i[11]*f+i[15]*p,r}function Gt(){var r=new B(4);return B!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Kt(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Vt(r,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],p=e[3],x=Math.sin(i),w=Math.cos(i);return r[0]=l*w+p*x,r[1]=h*w+f*x,r[2]=f*w-h*x,r[3]=p*w-l*x,r}function Ci(r,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],p=e[3],x=Math.sin(i),w=Math.cos(i);return r[0]=l*w-f*x,r[1]=h*w+p*x,r[2]=f*w+l*x,r[3]=p*w-h*x,r}jt(),Rt();var Jt,Ti,Vi,ji,$n,wn=Nt,zs=(Jt=jt(),Ti=_i(1,0,0),Vi=_i(0,1,0),function(r,e,i){var l=en(e,i);return l<-.999999?(es(Jt,Ti,e),gt(Jt)<1e-6&&es(Jt,Vi,e),Zi(Jt,Jt),function(h,f,p){p*=.5;var x=Math.sin(p);h[0]=x*f[0],h[1]=x*f[1],h[2]=x*f[2],h[3]=Math.cos(p)}(r,Jt,Math.PI),r):l>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(es(Jt,e,i),r[0]=Jt[0],r[1]=Jt[1],r[2]=Jt[2],r[3]=1+l,wn(r,r))});function Hn(){var r=new B(2);return B!=Float32Array&&(r[0]=0,r[1]=0),r}function vs(r,e){var i=new B(2);return i[0]=r,i[1]=e,i}function Os(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function wr(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function wo(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function Ds(r){return Math.hypot(r[0],r[1])}function Qs(r,e){var i=e[0],l=e[1],h=i*i+l*l;return h>0&&(h=1/Math.sqrt(h)),r[0]=e[0]*h,r[1]=e[1]*h,r}function An(r,e){return r[0]*e[0]+r[1]*e[1]}function fa(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}Gt(),Gt(),X(),Hn();var Vl,Tr,Vf=function(){if($n)return ji;function r(e,i,l,h){this.cx=3*e,this.bx=3*(l-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=l,this.p2y=h}return $n=1,ji=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var l=e,h=0;h<8;h++){var f=this.sampleCurveX(l)-e;if(Math.abs(f)<i)return l;var p=this.sampleCurveDerivativeX(l);if(Math.abs(p)<1e-6)break;l-=f/p}var x=0,w=1;for(l=e,h=0;h<20&&(f=this.sampleCurveX(l),!(Math.abs(f-e)<i));h++)e>f?x=l:w=l,l=.5*(w-x)+x;return l},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ji}(),Du=fa(Vf);function Ka(){if(Tr)return Vl;function r(e,i){this.x=e,this.y=i}return Tr=1,Vl=r,r.prototype={clone:function(){return new r(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,i){return this.clone()._rotateAround(e,i)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var i=e.x-this.x,l=e.y-this.y;return i*i+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,i){return Math.atan2(this.x*i-this.y*e,this.x*e+this.y*i)},_matMult:function(e){var i=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=i,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var i=Math.cos(e),l=Math.sin(e),h=l*this.x+i*this.y;return this.x=i*this.x-l*this.y,this.y=h,this},_rotateAround:function(e,i){var l=Math.cos(e),h=Math.sin(e),f=i.y+h*(this.x-i.x)+l*(this.y-i.y);return this.x=i.x+l*(this.x-i.x)-h*(this.y-i.y),this.y=f,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},r.convert=function(e){return e instanceof r?e:Array.isArray(e)?new r(e[0],e[1]):e},Vl}var _t=fa(Ka());function jo(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!jo(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!jo(r[i],e[i]))return!1;return!0}return r===e}const Uf=Math.PI/180,Qc=180/Math.PI;function Yi(r){return r*Uf}function Ne(r){return r*Qc}const q=[[0,0],[1,0],[1,1],[0,1]];function J(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function le(r,e,i,l){const h=new Du(r,e,i,l);return function(f){return h.solve(f)}}const xe=le(.25,.1,.25,1);function de(r,e,i){return Math.min(i,Math.max(e,r))}function Se(r,e,i){return(i=de((i-r)/(e-r),0,1))*i*(3-2*i)}function ke(r,e,i){const l=i-e,h=((r-e)%l+l)%l+e;return h===e?i:h}function Ee(r,e,i){if(!r.length)return i(null,[]);let l=r.length;const h=new Array(r.length);let f=null;r.forEach((p,x)=>{e(p,(w,T)=>{w&&(f=w),h[x]=T,--l==0&&i(f,h)})})}function Fe(r,...e){for(const i of e)for(const l in i)r[l]=i[l];return r}let et=1;function Ve(){return et++}function mt(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function kt(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Bt(r,e,i){const l={};for(const h in r)l[h]=e.call(this,r[h],h,r);return l}function li(r,e,i){const l={};for(const h in r)e.call(this,r[h],h,r)&&(l[h]=r[h]);return l}function ui(r){return Array.isArray(r)?r.map(ui):typeof r=="object"&&r?Bt(r,ui):r}function mi(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const zi={};function Si(r){zi[r]||(typeof console<"u"&&console.warn(r),zi[r]=!0)}function bn(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function Fn(r){let e=0;for(let i,l,h=0,f=r.length,p=f-1;h<f;p=h++)i=r[h],l=r[p],e+=(l.x-i.x)*(i.y+l.y);return e}function Bn([r,e,i]){const l=Yi(e+90),h=Yi(i);return{x:r*Math.cos(l)*Math.sin(h),y:r*Math.sin(l)*Math.sin(h),z:r*Math.cos(h),azimuthal:e,polar:i}}function hn(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Ji(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,l,h,f)=>{const p=h||f;return e[l]=!p||p.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let rs=null;function Yn(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function Wn(r,e,i,l){for(;e<i;){const h=e+i>>1;r[h]<l?e=h+1:i=h}return e}function Bs(r,e,i,l){for(;e<i;){const h=e+i>>1;r[h]<=l?e=h+1:i=h}return e}function mr(r){return r>0?1/(1.001-r):1+r}function er(r){return r>0?1-1/(1.001-r):-r}function eh(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const js={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!js.API_URL)return null;try{const r=new URL(js.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v0.3.0.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function pa(r){return js.API_URL_REGEX.test(r)}function Ru(r){return js.API_SPRITE_REGEX.test(r)}let th,ih,Lu,zu,Ja,nh;function Ou(){return th==null&&(th=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),th}const no={now:()=>zu!==void 0?zu:performance.now(),setNow(r){zu=r},restoreNow(){zu=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:l}=r;Ja||(Ja=document.createElement("canvas"));const h=Ja.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>Ja.width||l>Ja.height)&&(Ja.width=i,Ja.height=l),h.clearRect(-e,-e,i+2*e,l+2*e),h.drawImage(r,0,0,i,l),h.getImageData(-e,-e,i+2*e,l+2*e)},resolveURL:r=>(ih||(ih=document.createElement("a")),ih.href=r,ih.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Lu==null&&(Lu=window.matchMedia("(prefers-reduced-motion: reduce)")),Lu.matches)},hasCanvasFingerprintNoise(){if(nh!==void 0)return nh;if(!Ou())return nh=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const l=e.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<l.data.length;++h)if(h%4!=3&&i++!==l.data[h])return nh=!0,!0;return nh=!1,!1}};function zr(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const l=new URLSearchParams(r.slice(i));for(const h in e)l.set(h,e[h]);return`${r.slice(0,i)}?${l.toString()}`}function Hr(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const l=new URLSearchParams,h=new URLSearchParams(r.slice(i));for(const p of e.persistentParams){const x=h.get(p);x&&l.set(p,x)}const f=l.toString();return`${r.slice(0,i)}${f.length>0?`?${f}`:""}`}const $o="mapbox-tiles";let so=500,Go=50;const sh=["language","worldview","jobid"];let To,rh;function Qa(){try{return caches}catch{}}function Ul(){const r=Qa();r&&To==null&&(To=r.open($o))}let jf=1/0;const $f={supported:!1,testSupport:function(r){!oh&&el&&(jl?D_(r):_r=r)}};let _r,el,oh=!1,jl=!1;const P_=typeof self<"u"?self:{};function D_(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,el),r.isContextLost())return;$f.supported=!0}catch{}r.deleteTexture(e),oh=!0}P_.document&&(el=P_.document.createElement("img"),el.onload=function(){_r&&D_(_r),_r=null,jl=!0},el.onerror=function(){oh=!0,_r=null},el.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const ah={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(ah);class qi extends Error{constructor(e,i,l){i===401&&pa(l)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ku=hn()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$l=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(ku())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(l,h){const f=new AbortController,p=new Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:ku(),referrerPolicy:l.referrerPolicy,signal:f.signal});let x=!1,w=!1;const T=(I=p.url).indexOf("sku=")>0&&pa(I);var I;l.type==="json"&&p.headers.set("Accept","application/json");const C=(L,O,V)=>{if(w)return;if(L&&L.message!=="SecurityError"&&Si(L.toString()),O&&V)return M(O);const $=Date.now();fetch(p).then(W=>{if(W.ok){const Q=T?W.clone():null;return M(W,Q,$)}return h(new qi(W.statusText,W.status,l.url))}).catch(W=>{W.name!=="AbortError"&&h(new Error(`${W.message} ${l.url}`))})},M=(L,O,V)=>{(l.type==="arrayBuffer"?L.arrayBuffer():l.type==="json"?L.json():L.text()).then($=>{w||(O&&V&&function(W,Q,ee){if(Ul(),To==null)return;const U=Ji(Q.headers.get("Cache-Control")||"");if(U["no-store"])return;const Y={status:Q.status,statusText:Q.statusText,headers:new Headers};Q.headers.forEach((ve,ge)=>Y.headers.set(ge,ve)),U["max-age"]&&Y.headers.set("Expires",new Date(ee+1e3*U["max-age"]).toUTCString());const te=Y.headers.get("Expires");if(!te||new Date(te).getTime()-ee<42e4)return;let oe=Hr(W.url,{persistentParams:sh});if(Q.status===206){const ve=W.headers.get("Range");if(!ve)return;Y.status=200,oe=zr(oe,{range:ve})}(function(ve,ge){if(rh===void 0)try{new Response(new ReadableStream),rh=!0}catch{rh=!1}rh?ge(ve.body):ve.blob().then(ge).catch(be=>Si(be.message))})(Q,ve=>{const ge=new Response((be=Q.status)!==200&&be!==404&&[101,103,204,205,304].includes(be)?null:ve,Y);var be;Ul(),To?.then(Me=>Me.put(oe,ge)).catch(Me=>Si(Me.message))})}(p,O,V),x=!0,h(null,$,L.headers.get("Cache-Control"),L.headers.get("Expires")))}).catch($=>{w||h(new Error($.message))})};return T?function(L,O){if(Ul(),To==null)return O(null);To.then(V=>{let $=Hr(L.url,{persistentParams:sh});const W=L.headers.get("Range");W&&($=zr($,{range:W})),V.match($).then(Q=>{const ee=function(U){if(!U)return!1;const Y=new Date(U.headers.get("Expires")||0),te=Ji(U.headers.get("Cache-Control")||"");return Number(Y)>Date.now()&&!te["no-cache"]}(Q);V.delete($).catch(O),ee&&V.put($,Q.clone()).catch(O),O(null,Q,ee)}).catch(O)}).catch(O)}(p,C):C(null,null),{cancel:()=>{w=!0,x||f.abort()}}}(r,e);if(hn(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(l,h){const f=new XMLHttpRequest;f.open(l.method||"GET",l.url,!0),l.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const p in l.headers)f.setRequestHeader(p,l.headers[p]);return l.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=l.credentials==="include",f.onerror=()=>{h(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let p=f.response;if(l.type==="json")try{p=JSON.parse(f.response)}catch(x){return h(x)}h(null,p,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else h(new qi(f.statusText,f.status,l.url))},f.send(l.body),{cancel:()=>f.abort()}}(r,e)},lh=function(r,e){return $l(Fe(r,{type:"arrayBuffer"}),e)};function Qx(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const ch="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tl,ma;tl=[],ma=0;const Gf=function(r,e){if($f.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),ma>=js.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return tl.push(f),f}ma++;let i=!1;const l=()=>{if(!i)for(i=!0,ma--;tl.length&&ma<js.MAX_PARALLEL_IMAGE_REQUESTS;){const f=tl.shift(),{requestParameters:p,callback:x,cancelled:w}=f;w||(f.cancel=Gf(p,x).cancel)}},h=lh(r,(f,p,x,w)=>{l(),f?e(f):p&&(self.createImageBitmap?function(T,I){const C=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(C).then(M=>{I(null,M)}).catch(M=>{I(new Error(`Could not load image because of ${M.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(p,(T,I)=>e(T,I,x,w)):function(T,I){const C=new Image;C.onload=()=>{I(null,C),URL.revokeObjectURL(C.src),C.onload=null,requestAnimationFrame(()=>{C.src=ch})},C.onerror=()=>I(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const M=new Blob([new Uint8Array(T)],{type:"image/png"});C.src=T.byteLength?URL.createObjectURL(M):ch}(p,(T,I)=>e(T,I,x,w)))});return{cancel:()=>{h.cancel(),l()}}};var Hf,il,R_,Ho={exports:{}},Fu={exports:{}},Bu={exports:{}},ro=function(){if(R_)return Ho.exports;R_=1;var r=(Hf||(Hf=1,Fu.exports=function(i,l){var h,f,p,x,w,T,I,C;for(f=i.length-(h=3&i.length),p=l,w=3432918353,T=461845907,C=0;C<f;)I=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,p=27492+(65535&(x=5*(65535&(p=(p^=I=(65535&(I=(I=(65535&I)*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&i.charCodeAt(C+2))<<16;case 2:I^=(255&i.charCodeAt(C+1))<<8;case 1:p^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(C)))*w+(((I>>>16)*w&65535)<<16)&4294967295)<<15|I>>>17))*T+(((I>>>16)*T&65535)<<16)&4294967295}return p^=i.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}),Fu.exports),e=(il||(il=1,Bu.exports=function(i,l){for(var h,f=i.length,p=l^f,x=0;f>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(x)|(255&i.charCodeAt(++x))<<8|(255&i.charCodeAt(++x))<<16|(255&i.charCodeAt(++x))<<24))+((1540483477*(h>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++x;switch(f){case 3:p^=(255&i.charCodeAt(x+2))<<16;case 2:p^=(255&i.charCodeAt(x+1))<<8;case 1:p=1540483477*(65535&(p^=255&i.charCodeAt(x)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}),Bu.exports);return Ho.exports=r,Ho.exports.murmur3=r,Ho.exports.murmur2=e,Ho.exports}(),hh=fa(ro);class nl{constructor(e,...i){Fe(this,i[0]||{}),this.type=e}}class Nu extends nl{constructor(e,i={}){super("error",Fe({error:e},i))}}function Wf(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Vu(r,e,i){if(i&&i[r]){const l=i[r].indexOf(e);l!==-1&&i[r].splice(l,1)}}class sl{on(e,i){return this._listeners=this._listeners||{},Wf(e,i,this._listeners),this}off(e,i){return Vu(e,i,this._listeners),Vu(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Wf(e,i,this._oneTimeListeners),this):new Promise(l=>{this.once(e,l)})}fire(e,i){const l=typeof e=="string"?new nl(e,i):e,h=l.type;if(this.listens(h)){l.target=this;const f=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const w of f)w.call(this,l);const p=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const w of p)Vu(h,w,this._oneTimeListeners),w.call(this,l);const x=this._eventedParent;x&&(Fe(l,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),x.fire(l))}else l instanceof Nu&&console.error(l.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class Sr{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new Sr(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,l]=e.split("");return new Sr({name:i,iconsetId:l})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return Sr.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var qf,Gl={},rl=function(){if(qf)return Gl;qf=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function l(f){return(p=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:p>1?1:p;var p}function h(f,p,x){return x<0?x+=1:x>1&&(x-=1),6*x<1?f+(p-f)*x*6:2*x<1?p:3*x<2?f+(p-f)*(2/3-x)*6:f}try{Gl.parseCSSColor=function(f){var p,x=f.replace(/ /g,"").toLowerCase();if(x in r)return r[x].slice();if(x[0]==="#")return x.length===4?(p=parseInt(x.substr(1),16))>=0&&p<=4095?[(3840&p)>>4|(3840&p)>>8,240&p|(240&p)>>4,15&p|(15&p)<<4,1]:null:x.length===7&&(p=parseInt(x.substr(1),16))>=0&&p<=16777215?[(16711680&p)>>16,(65280&p)>>8,255&p,1]:null;var w=x.indexOf("("),T=x.indexOf(")");if(w!==-1&&T+1===x.length){var I=x.substr(0,w),C=x.substr(w+1,T-(w+1)).split(","),M=1;switch(I){case"rgba":if(C.length!==4)return null;M=l(C.pop());case"rgb":return C.length!==3?null:[i(C[0]),i(C[1]),i(C[2]),M];case"hsla":if(C.length!==4)return null;M=l(C.pop());case"hsl":if(C.length!==3)return null;var L=(parseFloat(C[0])%360+360)%360/360,O=l(C[1]),V=l(C[2]),$=V<=.5?V*(O+1):V+O-V*O,W=2*V-$;return[e(255*h(W,$,L+1/3)),e(255*h(W,$,L)),e(255*h(W,$,L-1/3)),M];default:return null}}return null}}catch{}return Gl}();class rn{constructor(e,i,l,h=1){this.r=e,this.g=i,this.b=l,this.a=h}static parse(e){if(!e)return;if(e instanceof rn)return e;if(typeof e!="string")return;const i=rl.parseCSSColor(e);return i?new rn(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,l,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*l)},${h})`}toNonPremultipliedRenderColor(e){const{r:i,g:l,b:h,a:f}=this;return new ev(e,i,l,h,f)}toPremultipliedRenderColor(e){const{r:i,g:l,b:h,a:f}=this;return new Zf(e,i*f,l*f,h*f,f)}clone(){return new rn(this.r,this.g,this.b,this.a)}}class oo{constructor(e,i,l,h,f,p=!1){if(this.premultiplied=!1,this.premultiplied=p,e){const x=e.image.height,w=x*x;this.premultiplied?(i=f===0?0:i/f*(x-1),l=f===0?0:l/f*(x-1),h=f===0?0:h/f*(x-1)):(i*=x-1,l*=x-1,h*=x-1);const T=Math.floor(i),I=Math.floor(l),C=Math.floor(h),M=Math.ceil(i),L=Math.ceil(l),O=Math.ceil(h),V=i-T,$=l-I,W=h-C,Q=e.image.data,ee=4*(T+I*w+C*x),U=4*(T+I*w+O*x),Y=4*(T+L*w+C*x),te=4*(T+L*w+O*x),oe=4*(M+I*w+C*x),ve=4*(M+I*w+O*x),ge=4*(M+L*w+C*x),be=4*(M+L*w+O*x);if(ee<0||be>=Q.length)throw new Error("out of range");this.r=ri(ri(ri(Q[ee],Q[U],W),ri(Q[Y],Q[te],W),$),ri(ri(Q[oe],Q[ve],W),ri(Q[ge],Q[be],W),$),V)/255*(this.premultiplied?f:1),this.g=ri(ri(ri(Q[ee+1],Q[U+1],W),ri(Q[Y+1],Q[te+1],W),$),ri(ri(Q[oe+1],Q[ve+1],W),ri(Q[ge+1],Q[be+1],W),$),V)/255*(this.premultiplied?f:1),this.b=ri(ri(ri(Q[ee+2],Q[U+2],W),ri(Q[Y+2],Q[te+2],W),$),ri(ri(Q[oe+2],Q[ve+2],W),ri(Q[ge+2],Q[be+2],W),$),V)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=l,this.b=h,this.a=f}toArray(){const{r:e,g:i,b:l,a:h}=this;return[255*e,255*i,255*l,h]}toHslaArray(){let{r:e,g:i,b:l,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];e/=h,i/=h,l/=h}const f=Math.min(Math.max(e,0),1),p=Math.min(Math.max(i,0),1),x=Math.min(Math.max(l,0),1),w=Math.min(f,p,x),T=Math.max(f,p,x),I=(w+T)/2;if(w===T)return[0,0,100*I,h];const C=T-w,M=I>.5?C/(2-T-w):C/(T+w);let L=0;return T===f?L=(p-x)/C+(p<x?6:0):T===p?L=(x-f)/C+2:T===x&&(L=(f-p)/C+4),L*=60,[Math.min(Math.max(L,0),360),Math.min(Math.max(100*M,0),100),Math.min(Math.max(100*I,0),100),h]}toArray01(){const{r:e,g:i,b:l,a:h}=this;return[e,i,l,h]}toArray01Scaled(e){const{r:i,g:l,b:h}=this;return[i*e,l*e,h*e]}toArray01Linear(){const{r:e,g:i,b:l,a:h}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(l,2.2),h]}}class ev extends oo{constructor(e,i,l,h,f){super(e,i,l,h,f,!1)}}class Zf extends oo{constructor(e,i,l,h,f){super(e,i,l,h,f,!0)}}function ri(r,e,i){return r*(1-i)+e*i}function Uu(r,e,i){return r.map((l,h)=>ri(l,e[h],i))}rn.black=new rn(0,0,0,1),rn.white=new rn(1,1,1,1),rn.transparent=new rn(0,0,0,0),rn.red=new rn(1,0,0,1),rn.blue=new rn(0,0,1,1);var uh=Object.freeze({__proto__:null,array:Uu,color:function(r,e,i){return new rn(ri(r.r,e.r,i),ri(r.g,e.g,i),ri(r.b,e.b,i),ri(r.a,e.a,i))},number:ri});function ol(r,...e){for(const i of e)for(const l in i)r[l]=i[l];return r}class Or extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Xf{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[l,h]of i)this.bindings[l]=h}concat(e){return new Xf(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Hl={kind:"null"},Ht={kind:"number"},pn={kind:"string"},tn={kind:"boolean"},Er={kind:"color"},Wo={kind:"object"},on={kind:"value"},ju={kind:"collator"},dh={kind:"formatted"},fh={kind:"resolvedImage"};function or(r,e){return{kind:"array",itemType:r,N:e}}function bs(r){if(r.kind==="array"){const e=bs(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const tv=[Hl,Ht,pn,tn,Er,dh,Wo,or(on),fh];function Wl(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Wl(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of tv)if(!Wl(i,e))return null}}return`Expected ${bs(r)} but found ${bs(e)} instead.`}function _a(r,e){return e.some(i=>i.kind===r.kind)}function ph(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function $u(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&$u(r.itemType,e.itemType):r.kind===e.kind}class mh{constructor(e,i,l){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Gu{constructor(e,i,l,h,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=l,this.fontStack=h,this.textColor=f}}class ar{constructor(e){this.sections=e}static fromString(e){return new ar([new Gu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ar?e:ar.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();e.push(["image",h]);continue}e.push(i.text);const l={};i.fontStack&&(l["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(l["font-scale"]=i.scale),i.textColor&&(l["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(l)}return e}}class qo{constructor(e,i={}){if(this.id=Sr.from(e),this.options=Object.assign({},i),i.transform){const{a:l,b:h,c:f,d:p,e:x,f:w}=i.transform;this.options.transform=new DOMMatrix([l,h,f,p,x,w])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:e,b:i,c:l,d:h,e:f,f:p}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:e,b:i,c:l,d:h,e:f,f:p}})}static parse(e){let i,l,h,f;try{({name:i,iconsetId:l,params:h,transform:f}=JSON.parse(e)||{})}catch{return null}if(!i)return null;const{a:p,b:x,c:w,d:T,e:I,f:C}=f||{};return new qo({name:i,iconsetId:l},{params:h,transform:new DOMMatrix([p,x,w,T,I,C])})}scaleSelf(e,i){return this.options.transform.scaleSelf(e,i),this}}class gr{constructor(e,i,l,h,f=!1){this.primaryId=Sr.from(e),this.primaryOptions=i,l&&(this.secondaryId=Sr.from(l)),this.secondaryOptions=h,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new qo(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new qo(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?gr.build({name:e}):e}static build(e,i,l,h){return!e||typeof e=="object"&&!("name"in e)?null:new gr(e,l,i,h)}}function al(r,e,i,l){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?l===void 0||typeof l=="number"&&l>=0&&l<=1?null:`Invalid rgba value [${[r,e,i,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof l=="number"?[r,e,i,l]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Di(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof rn||r instanceof mh||r instanceof ar||r instanceof gr)return!0;if(Array.isArray(r)){for(const e of r)if(!Di(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Di(r[e]))return!1;return!0}return!1}function It(r){if(r===null)return Hl;if(typeof r=="string")return pn;if(typeof r=="boolean")return tn;if(typeof r=="number")return Ht;if(r instanceof rn)return Er;if(r instanceof mh)return ju;if(r instanceof ar)return dh;if(r instanceof gr)return fh;if(Array.isArray(r)){const e=r.length;let i;for(const l of r){const h=It(l);if(i){if(i===h)continue;i=on;break}i=h}return or(i||on,e)}return Wo}function Wr(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ar||r instanceof gr||r instanceof rn?r.toString():JSON.stringify(r)}class ci{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Di(e[1]))return i.error("invalid value");const l=e[1];let h=It(l);const f=i.expectedType;return h.kind!=="array"||h.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(h=f),new ci(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof rn?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ar?this.value.serialize():this.value}}class ms{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const _h={string:pn,number:Ht,boolean:tn,object:Wo};class ni{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let l,h=1;const f=e[0];if(f==="array"){let x,w;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in _h)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);x=_h[T],h++}else x=on;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);w=e[2],h++}l=or(x,w)}else l=_h[f];const p=[];for(;h<e.length;h++){const x=i.parse(e[h],h,on);if(!x)return null;p.push(x)}return new ni(l,p)}evaluate(e){for(let i=0;i<this.args.length;i++){const l=this.args[i].evaluate(e);if(!Wl(this.type,It(l)))return l;if(i===this.args.length-1)throw new ms(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${bs(It(l))} but was expected to be of type ${bs(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const l=e.itemType;if(l.kind==="string"||l.kind==="number"||l.kind==="boolean"){i.push(l.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(l=>l.serialize()))}}class ql{constructor(e){this.type=dh,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[1];if(!Array.isArray(l)&&typeof l=="object")return i.error("First argument must be an image or text section.");const h=[];let f=!1;for(let p=1;p<=e.length-1;++p){const x=e[p];if(f&&typeof x=="object"&&!Array.isArray(x)){f=!1;let w=null;if(x["font-scale"]&&(w=i.parseObjectValue(x["font-scale"],p,"font-scale",Ht),!w))return null;let T=null;if(x["text-font"]&&(T=i.parseObjectValue(x["text-font"],p,"text-font",or(pn)),!T))return null;let I=null;if(x["text-color"]&&(I=i.parseObjectValue(x["text-color"],p,"text-color",Er),!I))return null;const C=h[h.length-1];C.scale=w,C.font=T,C.textColor=I}else{const w=i.parse(e[p],p,on);if(!w)return null;const T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new ql(h)}evaluate(e){return new ar(this.sections.map(i=>{const l=i.content.evaluate(e);return $u(It(l),fh)?new Gu("",l,null,null,null):new Gu(Wr(l),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const l={};i.scale&&(l["font-scale"]=i.scale.serialize()),i.font&&(l["text-font"]=i.font.serialize()),i.textColor&&(l["text-color"]=i.textColor.serialize()),e.push(l)}return e}}class Zl{constructor(e,i,l,h){this._imageWarnHistory={},this.type=fh,this.namePrimary=e,this.nameSecondary=i,l&&(this.paramsPrimary=l.params,this.iconsetIdPrimary=l.iconset?l.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let l=1;const h=[];function f(){if(l<e.length){const x=i.parse(e[l],l++,pn);return x?(h.push({image:x,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function p(){if(l<e.length){const w=e[l];if((x=w)===null||typeof x!="object"||Array.isArray(x))return!0;const T=w.params,I=w.iconset,C=i.concat(l);if(!T&&!I)return l++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const M={},L=C.concat(void 0,"params");for(const O in T){if(!O)return L.error("Image parameter name should be non-empty"),!1;const V=L.concat(void 0,O).parse(T[O],void 0,Er,void 0,{typeAnnotation:"coerce"});if(!V)return!1;M[O]=V}h[h.length-1].options.params=M}if(I){if(typeof I!="object"||I.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!I.id)return C.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=I}return l++,!0}var x;return!0}for(let x=0;x<2;x++)if(!f()||!p())return;return new Zl(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(e,i){const l={};if(i){for(const h in i)if(i[h])try{l[h]=i[h].evaluate(e)}catch{continue}if(Object.keys(l).length!==0)return{params:l}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},l=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,h=gr.build(i,l,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(h&&e.availableImages){const f=h.getPrimary().id;if(h.available=e.availableImages.some(p=>Sr.isEqual(p,f)),h.available){const p=h.getSecondary()?h.getSecondary().id:null;p&&(h.available=e.availableImages.some(x=>Sr.isEqual(x,p)))}}return h}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const l={};if(i&&(l.iconset={id:i}),e){l.params={};for(const h in e)e[h]&&(l.params[h]=e[h].serialize())}return Object.keys(l).length>0?l:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function ga(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const L_={"to-boolean":tn,"to-color":Er,"to-number":Ht,"to-string":pn};class qr{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const l=e[0],h=[];let f=Hl;if(l==="to-array"){if(!Array.isArray(e[1]))return null;const p=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=or(i.expectedType.itemType,p)}else{if(!(p>0&&Di(e[1][0])))return null;f=or(It(e[1][0]),p)}for(let x=0;x<p;x++){const w=e[1][x];let T;if(ga(w)==="array")T=i.parse(w,void 0,f.itemType);else{const I=ga(w);if(I!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${I}.`);T=i.registry.literal.parse(["literal",w===void 0?null:w],i)}if(!T)return null;h.push(T)}}else{if((l==="to-boolean"||l==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=L_[l];for(let p=1;p<e.length;p++){const x=i.parse(e[p],p,on);if(!x)return null;h.push(x)}}return new qr(f,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,l;for(const h of this.args){if(i=h.evaluate(e),l=null,i instanceof rn)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(l=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:al(i[0],i[1],i[2],i[3]),!l))return new rn(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new ms(l||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const l of this.args){if(i=l.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new ms(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ar.fromString(Wr(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?gr.build(Wr(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Wr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new ql([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Zl(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const lr=["Unknown","Point","LineString","Polygon"];class gh{constructor(e,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?lr[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:l,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(l*i-e[0])+this.featureDistanceData.bearing[1]*(h*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=rn.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class Ns{constructor(e,i,l,h,f){this.name=e,this.type=i,this._evaluate=l,this.args=h,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=Ns.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const l=e[0],h=Ns.definitions[l];if(!h)return i.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(h)?h[0]:h.type,p=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=[];let w=null,T=-1;for(const[I,C]of p){if(Array.isArray(I)&&I.length!==e.length-1)continue;x.push(I),T++,w=new id(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const M=[];let L=!1;for(let O=1;O<e.length;O++){const V=e[O],$=Array.isArray(I)?I[O-1]:I.type,W=w.parse(V,1+M.length,$);if(!W){L=!0;break}M.push(W)}if(!L)if(Array.isArray(I)&&I.length!==M.length)w.error(`Expected ${I.length} arguments, but found ${M.length} instead.`);else{for(let O=0;O<M.length;O++){const V=Array.isArray(I)?I[O]:I.type,$=M[O];w.concat(O+1).checkSubtype(V,$.type)}if(w.errors.length===0)return new Ns(l,f,C,M,T)}}if(x.length===1)i.errors.push(...w.errors);else{const I=(x.length?x:p.map(([M])=>M)).map(Yf).join(" | "),C=[];for(let M=1;M<e.length;M++){const L=i.parse(e[M],1+C.length);if(!L)return null;C.push(bs(L.type))}i.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){Ns.definitions=i;for(const l in i)e[l]=Ns}}function Yf(r){return Array.isArray(r)?`(${r.map(bs).join(", ")})`:`(${bs(r.type)}...)`}class So{constructor(e,i,l){this.type=ju,this.locale=l,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const l=e[1];if(typeof l!="object"||Array.isArray(l))return i.error("Collator options argument must be an object.");const h=l["case-sensitive"]===void 0?i.parse(!1,1,tn):i.parseObjectValue(l["case-sensitive"],1,"case-sensitive",tn);if(!h)return null;const f=l["diacritic-sensitive"]===void 0?i.parse(!1,1,tn):i.parseObjectValue(l["diacritic-sensitive"],1,"diacritic-sensitive",tn);if(!f)return null;let p=null;return l.locale&&(p=i.parseObjectValue(l.locale,1,"locale",pn),!p)?null:new So(h,f,p)}evaluate(e){return new mh(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function tr(r,e,i=0,l=r.length-1,h=iv){for(;l>i;){if(l-i>600){const w=l-i+1,T=e-i+1,I=Math.log(w),C=.5*Math.exp(2*I/3),M=.5*Math.sqrt(I*C*(w-C)/w)*(T-w/2<0?-1:1);tr(r,e,Math.max(i,Math.floor(e-T*C/w+M)),Math.min(l,Math.floor(e+(w-T)*C/w+M)),h)}const f=r[e];let p=i,x=l;for(yh(r,i,e),h(r[l],f)>0&&yh(r,i,l);p<x;){for(yh(r,p,x),p++,x--;h(r[p],f)<0;)p++;for(;h(r[x],f)>0;)x--}h(r[i],f)===0?yh(r,i,x):(x++,yh(r,x,l)),x<=e&&(i=x+1),e<=x&&(l=x-1)}}function yh(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function iv(r,e){return r<e?-1:r>e?1:0}function nv(r){let e=0;for(let i,l,h=0,f=r.length,p=f-1;h<f;p=h++)i=r[h],l=r[p],e+=(l.x-i.x)*(i.y+l.y);return e}function ya(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Xl(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function ll(r,e,i){const l=r[0]-e[0],h=r[1]-e[1],f=r[0]-i[0],p=r[1]-i[1];return l*p-f*h==0&&l*f<=0&&h*p<=0}function Yl(r,e,i=!1){let l=!1;for(let x=0,w=e.length;x<w;x++){const T=e[x];for(let I=0,C=T.length,M=C-1;I<C;M=I++){const L=T[M],O=T[I];if(ll(r,L,O))return i;(f=L)[1]>(h=r)[1]!=(p=O)[1]>h[1]&&h[0]<(p[0]-f[0])*(h[1]-f[1])/(p[1]-f[1])+f[0]&&(l=!l)}}var h,f,p;return l}function z_(r,e,i,l){const h=l[0]-i[0],f=l[1]-i[1],p=(r[0]-i[0])*f-h*(r[1]-i[1]),x=(e[0]-i[0])*f-h*(e[1]-i[1]);return p>0&&x<0||p<0&&x>0}function Hu(r,e,i,l){return(h=[l[0]-i[0],l[1]-i[1]])[0]*(f=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*f[0]!=0&&!(!z_(r,e,i,l)||!z_(i,l,r,e));var h,f}function Kf(r){const e=new _t(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new _t(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const l of r[0])e.x>l.x&&(e.x=l.x),e.y>l.y&&(e.y=l.y),i.x<l.x&&(i.x=l.x),i.y<l.y&&(i.y=l.y);return{min:e,max:i}}const Zo=8192;function sv(r,e){const i=(180+r[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Zo),Math.round(l*h*Zo)]}function rv(r,e){for(let i=0;i<e.length;i++)if(Yl(r,e[i]))return!0;return!1}function O_(r,e,i){for(const l of i)for(let h=0,f=l.length,p=f-1;h<f;p=h++)if(Hu(r,e,l[p],l[h]))return!0;return!1}function k_(r,e){for(let i=0;i<r.length;++i)if(!Yl(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(O_(r[i],r[i+1],e))return!1;return!0}function cl(r,e){for(let i=0;i<e.length;i++)if(k_(r,e[i]))return!0;return!1}function Jf(r,e,i){const l=[];for(let h=0;h<r.length;h++){const f=[];for(let p=0;p<r[h].length;p++){const x=sv(r[h][p],i);ya(e,x),f.push(x)}l.push(f)}return l}function F_(r,e,i){const l=[];for(let h=0;h<r.length;h++){const f=Jf(r[h],e,i);l.push(f)}return l}function Wu(r,e,i,l){if(r[0]<i[0]||r[0]>i[2]){const h=.5*l;let f=r[0]-i[0]>h?-l:i[0]-r[0]>h?l:0;f===0&&(f=r[0]-i[2]>h?-l:i[2]-r[0]>h?l:0),r[0]+=f}ya(e,r)}function Qf(r,e,i,l){const h=Math.pow(2,l.z)*Zo,f=[l.x*Zo,l.y*Zo],p=[];if(!r)return p;for(const x of r)for(const w of x){const T=[w.x+f[0],w.y+f[1]];Wu(T,e,i,h),p.push(T)}return p}function ep(r,e,i,l){const h=Math.pow(2,l.z)*Zo,f=[l.x*Zo,l.y*Zo],p=[];if(!r)return p;for(const w of r){const T=[];for(const I of w){const C=[I.x+f[0],I.y+f[1]];ya(e,C),T.push(C)}p.push(T)}if(e[2]-e[0]<=h/2){(x=e)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of p)for(const T of w)Wu(T,e,i,h)}var x;return p}class ir{constructor(e,i){this.type=tn,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Di(e[1])){const l=e[1];if(l.type==="FeatureCollection")for(let h=0;h<l.features.length;++h){const f=l.features[h].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new ir(l,l.features[h].geometry)}else if(l.type==="Feature"){const h=l.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new ir(l,l.geometry)}else if(l.type==="Polygon"||l.type==="MultiPolygon")return new ir(l,l)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const x=Jf(l.coordinates,f,p),w=Qf(i.geometry(),h,f,p);if(!Xl(h,f))return!1;for(const T of w)if(!Yl(T,x))return!1}if(l.type==="MultiPolygon"){const x=F_(l.coordinates,f,p),w=Qf(i.geometry(),h,f,p);if(!Xl(h,f))return!1;for(const T of w)if(!rv(T,x))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,l){const h=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],p=i.canonicalID();if(!p)return!1;if(l.type==="Polygon"){const x=Jf(l.coordinates,f,p),w=ep(i.geometry(),h,f,p);if(!Xl(h,f))return!1;for(const T of w)if(!k_(T,x))return!1}if(l.type==="MultiPolygon"){const x=F_(l.coordinates,f,p),w=ep(i.geometry(),h,f,p);if(!Xl(h,f))return!1;for(const T of w)if(!cl(T,x))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const xh={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},tp=1/298.257223563,ip=tp*(2-tp),Kl=Math.PI/180;class Jl{static fromTile(e,i,l){const h=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/Kl;return new Jl(f,l)}static get units(){return xh}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!xh[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(xh).join(", ")}`);const l=6378.137*Kl*(i?xh[i]:1),h=Math.cos(e*Kl),f=1/(1-ip*(1-h*h)),p=Math.sqrt(f);this.kx=l*p*h,this.ky=l*p*f*(1-ip)}distance(e,i){const l=kr(e[0]-i[0])*this.kx,h=(e[1]-i[1])*this.ky;return Math.sqrt(l*l+h*h)}bearing(e,i){const l=kr(i[0]-e[0])*this.kx;return Math.atan2(l,(i[1]-e[1])*this.ky)/Kl}destination(e,i,l){const h=l*Kl;return this.offset(e,Math.sin(h)*i,Math.cos(h)*i)}offset(e,i,l){return[e[0]+i/this.kx,e[1]+l/this.ky]}lineDistance(e){let i=0;for(let l=0;l<e.length-1;l++)i+=this.distance(e[l],e[l+1]);return i}area(e){let i=0;for(let l=0;l<e.length;l++){const h=e[l];for(let f=0,p=h.length,x=p-1;f<p;x=f++)i+=kr(h[f][0]-h[x][0])*(h[f][1]+h[x][1])*(l?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let l=0;if(i<=0)return e[0];for(let h=0;h<e.length-1;h++){const f=e[h],p=e[h+1],x=this.distance(f,p);if(l+=x,l>i)return qu(f,p,(i-(l-x))/x)}return e[e.length-1]}pointToSegmentDistance(e,i,l){let[h,f]=i,p=kr(l[0]-h)*this.kx,x=(l[1]-f)*this.ky;if(p!==0||x!==0){const w=(kr(e[0]-h)*this.kx*p+(e[1]-f)*this.ky*x)/(p*p+x*x);w>1?(h=l[0],f=l[1]):w>0&&(h+=p/this.kx*w,f+=x/this.ky*w)}return p=kr(e[0]-h)*this.kx,x=(e[1]-f)*this.ky,Math.sqrt(p*p+x*x)}pointOnLine(e,i){let l=1/0,h=e[0][0],f=e[0][1],p=0,x=0;for(let w=0;w<e.length-1;w++){let T=e[w][0],I=e[w][1],C=kr(e[w+1][0]-T)*this.kx,M=(e[w+1][1]-I)*this.ky,L=0;C===0&&M===0||(L=(kr(i[0]-T)*this.kx*C+(i[1]-I)*this.ky*M)/(C*C+M*M),L>1?(T=e[w+1][0],I=e[w+1][1]):L>0&&(T+=C/this.kx*L,I+=M/this.ky*L)),C=kr(i[0]-T)*this.kx,M=(i[1]-I)*this.ky;const O=C*C+M*M;O<l&&(l=O,h=T,f=I,p=w,x=L)}return{point:[h,f],index:p,t:Math.max(0,Math.min(1,x))}}lineSlice(e,i,l){let h=this.pointOnLine(l,e),f=this.pointOnLine(l,i);if(h.index>f.index||h.index===f.index&&h.t>f.t){const T=h;h=f,f=T}const p=[h.point],x=h.index+1,w=f.index;!np(l[x],p[0])&&x<=w&&p.push(l[x]);for(let T=x+1;T<=w;T++)p.push(l[T]);return np(l[w],f.point)||p.push(f.point),p}lineSliceAlong(e,i,l){let h=0;const f=[];for(let p=0;p<l.length-1;p++){const x=l[p],w=l[p+1],T=this.distance(x,w);if(h+=T,h>e&&f.length===0&&f.push(qu(x,w,(e-(h-T))/T)),h>=i)return f.push(qu(x,w,(i-(h-T))/T)),f;h>e&&f.push(w)}return f}bufferPoint(e,i){const l=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-l,e[0]+h,e[1]+l]}bufferBBox(e,i){const l=i/this.ky,h=i/this.kx;return[e[0]-h,e[1]-l,e[2]+h,e[3]+l]}insideBBox(e,i){return kr(e[0]-i[0])>=0&&kr(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function np(r,e){return r[0]===e[0]&&r[1]===e[1]}function qu(r,e,i){const l=kr(e[0]-r[0]);return[r[0]+l*i,r[1]+(e[1]-r[1])*i]}function kr(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class Zu{constructor(e=[],i=(l,h)=>l<h?-1:l>h?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:l}=this,h=i[e];for(;e>0;){const f=e-1>>1,p=i[f];if(l(h,p)>=0)break;i[e]=p,e=f}i[e]=h}_down(e){const{data:i,compare:l}=this,h=this.length>>1,f=i[e];for(;e<h;){let p=1+(e<<1);const x=p+1;if(x<this.length&&l(i[x],i[p])<0&&(p=x),l(i[p],f)>=0)break;i[e]=i[p],e=p}i[e]=f}}var yt=8192;function sp(r,e){return e.dist-r.dist}const Ql=100,ec=50;function vh(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function bh(r){return r[1]-r[0]+1}function Eo(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Xu(r,e){if(r[0]>r[1])return[null,null];const i=bh(r);if(e){if(i===2)return[r,null];const l=Math.floor(i/2);return[[r[0],r[0]+l],[r[0]+l,r[1]]]}{if(i===1)return[r,null];const l=Math.floor(i/2)-1;return[[r[0],r[0]+l],[r[0]+l+1,r[1]]]}}function Zr(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!Eo(e,r.length))return i;for(let l=e[0];l<=e[1];++l)ya(i,r[l]);return i}function Ni(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let l=0;l<r[i].length;++l)ya(e,r[i][l]);return e}function tc(r,e,i){if(vh(r)||vh(e))return NaN;let l=0,h=0;return r[2]<e[0]&&(l=e[0]-r[2]),r[0]>e[2]&&(l=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),i.distance([0,0],[l,h])}function ov(r){return 360*r-180}function av(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Yu(r,e){const i=Math.pow(2,e.z),l=(r.y/yt+e.y)/i;return[ov((r.x/yt+e.x)/i),av(l)]}function lv(r,e){const i=[];for(let l=0;l<r.length;++l)i.push(Yu(r[l],e));return i}function qn(r,e,i){const l=i.pointOnLine(e,r).point;return i.distance(r,l)}function B_(r,e,i,l,h){const f=i.slice(l[0],l[1]+1);let p=1/0;for(let x=e[0];x<=e[1];++x)if((p=Math.min(p,qn(r[x],f,h)))===0)return 0;return p}function rp(r,e,i,l,h){const f=Math.min(h.pointToSegmentDistance(r,i,l),h.pointToSegmentDistance(e,i,l)),p=Math.min(h.pointToSegmentDistance(i,r,e),h.pointToSegmentDistance(l,r,e));return Math.min(f,p)}function cv(r,e,i,l,h){if(!Eo(e,r.length)||!Eo(l,i.length))return NaN;let f=1/0;for(let p=e[0];p<e[1];++p)for(let x=l[0];x<l[1];++x){if(Hu(r[p],r[p+1],i[x],i[x+1]))return 0;f=Math.min(f,rp(r[p],r[p+1],i[x],i[x+1],h))}return f}function hv(r,e,i,l,h){if(!Eo(e,r.length)||!Eo(l,i.length))return NaN;let f=1/0;for(let p=e[0];p<=e[1];++p)for(let x=l[0];x<=l[1];++x)if((f=Math.min(f,h.distance(r[p],i[x])))===0)return f;return f}function uv(r,e,i){if(Yl(r,e,!0))return 0;let l=1/0;for(const h of e){const f=h.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[f-1]&&(l=Math.min(l,i.pointToSegmentDistance(r,h[f-1],h[0])))===0||(l=Math.min(l,qn(r,h,i)))===0)return l}return l}function dv(r,e,i,l){if(!Eo(e,r.length))return NaN;for(let f=e[0];f<=e[1];++f)if(Yl(r[f],i,!0))return 0;let h=1/0;for(let f=e[0];f<e[1];++f)for(const p of i)for(let x=0,w=p.length,T=w-1;x<w;T=x++){if(Hu(r[f],r[f+1],p[T],p[x]))return 0;h=Math.min(h,rp(r[f],r[f+1],p[T],p[x],l))}return h}function N_(r,e){for(const i of r)for(let l=0;l<=i.length-1;++l)if(Yl(i[l],e,!0))return!0;return!1}function fv(r,e,i,l=1/0){const h=Ni(r),f=Ni(e);if(l!==1/0&&tc(h,f,i)>=l)return l;if(Xl(h,f)){if(N_(r,e))return 0}else if(N_(e,r))return 0;let p=l;for(const x of r)for(let w=0,T=x.length,I=T-1;w<T;I=w++)for(const C of e)for(let M=0,L=C.length,O=L-1;M<L;O=M++){if(Hu(x[I],x[w],C[O],C[M]))return 0;p=Math.min(p,rp(x[I],x[w],C[O],C[M],i))}return p}function Ku(r,e,i,l,h,f,p){if(f===null||p===null)return;const x=tc(Zr(l,f),Zr(h,p),i);x<e&&r.push({dist:x,range1:f,range2:p})}function pv(r,e,i,l,h=1/0){let f=Math.min(l.distance(r[0],i[0][0]),h);if(f===0)return f;const p=new Zu([{dist:0,range1:[0,r.length-1],range2:[0,0]}],sp),x=e?ec:Ql,w=Ni(i);for(;p.length;){const T=p.pop();if(T.dist>=f)continue;const I=T.range1;if(bh(I)<=x){if(!Eo(I,r.length))return NaN;if(e){const C=dv(r,I,i,l);if((f=Math.min(f,C))===0)return f}else for(let C=I[0];C<=I[1];++C){const M=uv(r[C],i,l);if((f=Math.min(f,M))===0)return f}}else{const C=Xu(I,e);if(C[0]!==null){const M=tc(Zr(r,C[0]),w,l);M<f&&p.push({dist:M,range1:C[0],range2:[0,0]})}if(C[1]!==null){const M=tc(Zr(r,C[1]),w,l);M<f&&p.push({dist:M,range1:C[1],range2:[0,0]})}}}return f}function V_(r,e,i,l,h,f=1/0){let p=Math.min(f,h.distance(r[0],i[0]));if(p===0)return p;const x=new Zu([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],sp),w=e?ec:Ql,T=l?ec:Ql;for(;x.length;){const I=x.pop();if(I.dist>=p)continue;const C=I.range1,M=I.range2;if(bh(C)<=w&&bh(M)<=T){if(!Eo(C,r.length)||!Eo(M,i.length))return NaN;if(e&&l?p=Math.min(p,cv(r,C,i,M,h)):e||l?e&&!l?p=Math.min(p,B_(i,M,r,C,h)):!e&&l&&(p=Math.min(p,B_(r,C,i,M,h))):p=Math.min(p,hv(r,C,i,M,h)),p===0)return p}else{const L=Xu(C,e),O=Xu(M,l);Ku(x,p,h,r,i,L[0],O[0]),Ku(x,p,h,r,i,L[0],O[1]),Ku(x,p,h,r,i,L[1],O[0]),Ku(x,p,h,r,i,L[1],O[1])}}return p}function op(r,e,i,l,h=1/0){let f=h;const p=Zr(r,[0,r.length-1]);for(const x of i)if(!(f!==1/0&&tc(p,Zr(x,[0,x.length-1]),l)>=f)&&(f=Math.min(f,V_(r,e,x,!0,l,f)),f===0))return f;return f}function Ju(r,e,i,l,h=1/0){let f=h;const p=Zr(r,[0,r.length-1]);for(const x of i){if(f!==1/0&&tc(p,Ni(x),l)>=f)continue;const w=pv(r,e,x,l,f);if(isNaN(w))return w;if((f=Math.min(f,w))===0)return f}return f}function ap(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class hl{constructor(e,i){this.type=Ht,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Di(e[1])){const l=e[1];if(l.type==="FeatureCollection"){for(let h=0;h<l.features.length;++h)if(ap(l.features[h].geometry.type))return new hl(l,l.features[h].geometry)}else if(l.type==="Feature"){if(ap(l.geometry.type))return new hl(l,l.geometry)}else if(ap(l.type))return new hl(l,l)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),l=e.canonicalID();if(i!=null&&l!=null){if(e.geometryType()==="Point")return function(h,f,p){const x=[];for(const T of h)for(const I of T)x.push(Yu(I,f));const w=new Jl(x[0][1],"meters");return p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString"?V_(x,!1,p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",w):p.type==="MultiLineString"?op(x,!1,p.coordinates,w):p.type==="Polygon"||p.type==="MultiPolygon"?Ju(x,!1,p.type==="Polygon"?[p.coordinates]:p.coordinates,w):null}(i,l,this.geometries);if(e.geometryType()==="LineString")return function(h,f,p){const x=[];for(const T of h){const I=[];for(const C of T)I.push(Yu(C,f));x.push(I)}const w=new Jl(x[0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return op(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x,w);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=op(p.coordinates[I],!0,x,w,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}if(p.type==="Polygon"||p.type==="MultiPolygon"){let T=1/0;for(let I=0;I<x.length;I++){const C=Ju(x[I],!0,p.type==="Polygon"?[p.coordinates]:p.coordinates,w,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return null}(i,l,this.geometries);if(e.geometryType()==="Polygon")return function(h,f,p){const x=[];for(const T of function(I,C){const M=I.length;if(M<=1)return[I];const L=[];let O,V;for(let $=0;$<M;$++){const W=nv(I[$]);W!==0&&(I[$].area=Math.abs(W),V===void 0&&(V=W<0),V===W<0?(O&&L.push(O),O=[I[$]]):O.push(I[$]))}return O&&L.push(O),L}(h)){const I=[];for(let C=0;C<T.length;++C)I.push(lv(T[C],f));x.push(I)}const w=new Jl(x[0][0][0][1],"meters");if(p.type==="Point"||p.type==="MultiPoint"||p.type==="LineString")return Ju(p.type==="Point"?[p.coordinates]:p.coordinates,p.type==="LineString",x,w);if(p.type==="MultiLineString"){let T=1/0;for(let I=0;I<p.coordinates.length;I++){const C=Ju(p.coordinates[I],!0,x,w,T);if(isNaN(C))return C;if((T=Math.min(T,C))===0)return T}return T}return p.type==="Polygon"||p.type==="MultiPolygon"?function(T,I,C){let M=1/0;for(const L of T)for(const O of I){const V=fv(L,O,C,M);if(isNaN(V))return V;if((M=Math.min(M,V))===0)return M}return M}(p.type==="Polygon"?[p.coordinates]:p.coordinates,x,w):null}(i,l,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function ic(r){if(r instanceof Ns&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof ir||r instanceof hl)return!1;if(r instanceof sc)return r.featureConstant;let e=!0;return r.eachChild(i=>{e&&!ic(i)&&(e=!1)}),e}function Qu(r){if(r instanceof Ns&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Qu(i)&&(e=!1)}),e}function ed(r){if(r instanceof sc)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...ed(i)])}),e}function nc(r,e){if(r instanceof Ns&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(l=>{i&&!nc(l,e)&&(i=!1)}),i}function U_(r,e,i){return[r,e,i].filter(Boolean).join("")}function lp(r,e){switch(r){case"string":return Wr(e);case"number":return+e;case"boolean":return!!e;case"color":return rn.parse(e);case"formatted":return ar.fromString(Wr(e));case"resolvedImage":return gr.build(Wr(e))}return e}function j_(r,e,i,l){return l!==void 0&&(r=l*Math.round(r/l)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class sc{constructor(e,i,l,h=!1){this.type=e,this.key=i,this.scope=l,this.featureConstant=h}static parse(e,i){let l=i.expectedType;if(l==null&&(l=on),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(e[1],1);if(!(h instanceof ci))return i.error("Key name of 'config' expression must be a string literal.");let f,p=!0;const x=Wr(h.value);if(e.length>=3){const w=i.parse(e[2],2);if(!(w instanceof ci))return i.error("Scope of 'config' expression must be a string literal.");f=Wr(w.value)}if(i.options){const w=U_(x,f,i._scope),T=i.options.get(w);T&&(p=ic(T.value||T.default))}return new sc(l,x,f,p)}evaluate(e){const i=U_(this.key,this.scope,e.scope),l=e.getConfig(i);if(!l)return null;const{type:h,value:f,values:p,minValue:x,maxValue:w,stepValue:T}=l,I=l.default.evaluate(e);let C=I;if(f){const M=e.scope;e.scope=(M||"").split("").slice(1).join(""),C=f.evaluate(e),e.scope=M}return h&&(C=lp(h,C)),C===void 0||x===void 0&&w===void 0&&T===void 0||(typeof C=="number"?C=j_(C,x,w,T):Array.isArray(C)&&(C=C.map(M=>typeof M=="number"?j_(M,x,w,T):M))),f!==void 0&&C!==void 0&&p&&!p.includes(C)&&(C=I,h&&(C=lp(h,C))),(h&&h!==this.type||C!==void 0&&!$u(It(C),this.type))&&(C=lp(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class td{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const l=e[1];return i.scope.has(l)?new td(l,i.scope.get(l)):i.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class id{constructor(e,i=[],l,h=new Xf,f=[],p,x){this.registry=e,this.path=i,this.key=i.map(w=>typeof w=="string"?`['${w}']`:`[${w}]`).join(""),this.scope=h,this.errors=f,this.expectedType=l,this._scope=p,this.options=x}parse(e,i,l,h,f={}){return i||l?this.concat(i,null,l,h)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,l,h,f,p={}){return this.concat(i,l,h,f)._parse(e,p)}_parse(e,i){function l(h,f,p){return p==="assert"?new ni(f,[h]):p==="coerce"?new qr(f,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let f=h.parse(e,this);if(!f)return null;if(this.expectedType){const p=this.expectedType,x=f.type;if(p.kind!=="string"&&p.kind!=="number"&&p.kind!=="boolean"&&p.kind!=="object"&&p.kind!=="array"||x.kind!=="value")if(p.kind!=="color"&&p.kind!=="formatted"&&p.kind!=="resolvedImage"||x.kind!=="value"&&x.kind!=="string"){if(this.checkSubtype(p,x))return null}else f=l(f,p,i.typeAnnotation||"coerce");else f=l(f,p,i.typeAnnotation||"assert")}if(!(f instanceof ci)&&f.type.kind!=="resolvedImage"&&cp(f)){const p=new gh(this._scope,this.options);try{f=new ci(f.type,f.evaluate(p))}catch(x){return this.error(x.message),null}}return f}return qr.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,l,h){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const p=h?this.scope.concat(h):this.scope;return new id(this.registry,f,l||null,p,this.errors,this._scope,this.options)}error(e,...i){const l=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new Or(l,e))}checkSubtype(e,i){const l=Wl(e,i);return l&&this.error(l),l}}function cp(r){if(r instanceof td)return cp(r.boundExpression);if(r instanceof Ns&&r.name==="error"||r instanceof So||r instanceof ir||r instanceof hl||r instanceof sc)return!1;const e=r instanceof qr||r instanceof ni;let i=!0;return r.eachChild(l=>{i=e?i&&cp(l):i&&l instanceof ci}),!!i&&ic(r)&&nc(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function nd(r,e){const i=r.length-1;let l,h,f=0,p=i,x=0;for(;f<=p;)if(x=Math.floor((f+p)/2),l=r[x],h=r[x+1],l<=e){if(x===i||e<h)return x;f=x+1}else{if(!(l>e))throw new ms("Input is not a number.");p=x-1}return 0}class wh{constructor(e,i,l){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,f]of l)this.labels.push(h),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const l=i.parse(e[1],1,Ht);if(!l)return null;const h=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let p=1;p<e.length;p+=2){const x=p===1?-1/0:e[p],w=e[p+1],T=p,I=p+1;if(typeof x!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=x)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const C=i.parse(w,I,f);if(!C)return null;f=f||C.type,h.push([x,C])}return new wh(f,l,h)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const f=i.length;return h>=i[f-1]?l[f-1].evaluate(e):l[nd(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const $_=.95047,G_=1.08883,H_=4/29,xa=6/29,W_=3*xa*xa,q_=xa*xa*xa,mv=Math.PI/180,_v=180/Math.PI;function hp(r){return r>q_?Math.pow(r,1/3):r/W_+H_}function sd(r){return r>xa?r*r*r:W_*(r-H_)}function rd(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function va(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function up(r){const e=va(r.r),i=va(r.g),l=va(r.b),h=hp((.4124564*e+.3575761*i+.1804375*l)/$_),f=hp((.2126729*e+.7151522*i+.072175*l)/1);return{l:116*f-16,a:500*(h-f),b:200*(f-hp((.0193339*e+.119192*i+.9503041*l)/G_)),alpha:r.a}}function dp(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,l=isNaN(r.b)?e:e-r.b/200;return e=1*sd(e),i=$_*sd(i),l=G_*sd(l),new rn(rd(3.2404542*i-1.5371385*e-.4985314*l),rd(-.969266*i+1.8760108*e+.041556*l),rd(.0556434*i-.2040259*e+1.0572252*l),r.alpha)}function gv(r,e,i){const l=e-r;return r+i*(l>180||l<-180?l-360*Math.round(l/360):l)}const ul={forward:up,reverse:dp,interpolate:function(r,e,i){return{l:ri(r.l,e.l,i),a:ri(r.a,e.a,i),b:ri(r.b,e.b,i),alpha:ri(r.alpha,e.alpha,i)}}},dl={forward:function(r){const{l:e,a:i,b:l}=up(r),h=Math.atan2(l,i)*_v;return{h:h<0?h+360:h,c:Math.sqrt(i*i+l*l),l:e,alpha:r.a}},reverse:function(r){const e=r.h*mv,i=r.c;return dp({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:gv(r.h,e.h,i),c:ri(r.c,e.c,i),l:ri(r.l,e.l,i),alpha:ri(r.alpha,e.alpha,i)}}};var Z_=Object.freeze({__proto__:null,hcl:dl,lab:ul});class Fr{constructor(e,i,l,h,f){this.type=e,this.operator=i,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[p,x]of f)this.labels.push(p),this.outputs.push(x)}static interpolationFactor(e,i,l,h){let f=0;if(e.name==="exponential")f=od(i,e.base,l,h);else if(e.name==="linear")f=od(i,1,l,h);else if(e.name==="cubic-bezier"){const p=e.controlPoints;f=new Du(p[0],p[1],p[2],p[3]).solve(od(i,1,l,h))}return f}static parse(e,i){let[l,h,f,...p]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const T=h[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(T.length!==4||T.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Ht),!f)return null;const x=[];let w=null;l==="interpolate-hcl"||l==="interpolate-lab"?w=Er:i.expectedType&&i.expectedType.kind!=="value"&&(w=i.expectedType);for(let T=0;T<p.length;T+=2){const I=p[T],C=p[T+1],M=T+3,L=T+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',M);if(x.length&&x[x.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',M);const O=i.parse(C,L,w);if(!O)return null;w=w||O.type,x.push([I,O])}return w.kind==="number"||w.kind==="color"||w.kind==="array"&&w.itemType.kind==="number"&&typeof w.N=="number"?new Fr(w,l,h,f,x):i.error(`Type ${bs(w)} is not interpolatable.`)}evaluate(e){const i=this.labels,l=this.outputs;if(i.length===1)return l[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return l[0].evaluate(e);const f=i.length;if(h>=i[f-1])return l[f-1].evaluate(e);const p=nd(i,h),x=Fr.interpolationFactor(this.interpolation,h,i[p],i[p+1]),w=l[p].evaluate(e),T=l[p+1].evaluate(e);return this.operator==="interpolate"?uh[this.type.kind.toLowerCase()](w,T,x):this.operator==="interpolate-hcl"?dl.reverse(dl.interpolate(dl.forward(w),dl.forward(T),x)):ul.reverse(ul.interpolate(ul.forward(w),ul.forward(T),x))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let l=0;l<this.labels.length;l++)i.push(this.labels[l],this.outputs[l].serialize());return i}}function od(r,e,i,l){const h=l-i,f=r-i;return h===0?0:e===1?f/h:(Math.pow(e,f)-1)/(Math.pow(e,h)-1)}class Th{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let l=null;const h=i.expectedType;h&&h.kind!=="value"&&(l=h);const f=[];for(const x of e.slice(1)){const w=i.parse(x,1+f.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,f.push(w)}const p=h&&f.some(x=>Wl(h,x.type));return new Th(p?on:l,f)}evaluate(e){let i,l=null,h=0;for(const f of this.args){if(h++,l=f.evaluate(e),l&&l instanceof gr&&!l.available&&(i||(i=l),l=null,h===this.args.length))return i;if(l!==null)break}return l}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class ad{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const l=[];for(let f=1;f<e.length-1;f+=2){const p=e[f];if(typeof p!="string")return i.error(`Expected string, but found ${typeof p} instead.`,f);if(/[^a-zA-Z0-9_]/.test(p))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const x=i.parse(e[f+1],f+1);if(!x)return null;l.push([p,x])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,l);return h?new ad(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,l]of this.bindings)e.push(i,l.serialize());return e.push(this.result.serialize()),e}}class fp{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ht),h=i.parse(e[2],2,or(i.expectedType||on));return l&&h?new fp(h.type.itemType,l,h):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ms(`Array index out of bounds: ${i} < 0.`);if(i>=l.length)throw new ms(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i!==Math.floor(i))throw new ms(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return l[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class pp{constructor(e,i,l){this.type=e,this.index=i,this.input=l}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,Ht),h=i.parse(e[2],2,or(i.expectedType||on));return l&&h?new pp(h.type.itemType,l,h):null}evaluate(e){const i=this.index.evaluate(e),l=this.input.evaluate(e);if(i<0)throw new ms(`Array index out of bounds: ${i} < 0.`);if(i>l.length-1)throw new ms(`Array index out of bounds: ${i} > ${l.length-1}.`);if(i===Math.floor(i))return l[i];const h=Math.floor(i),f=Math.ceil(i),p=l[h],x=l[f];if(typeof p!="number"||typeof x!="number")throw new ms(`Cannot interpolate between non-number values at index ${i}.`);const w=i-h;return p*(1-w)+x*w}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ld{constructor(e,i){this.type=tn,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,on),h=i.parse(e[2],2,on);return l&&h?_a(l.type,[tn,pn,Ht,Hl,on])?new ld(l,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bs(l.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(l==null)return!1;if(!ph(i,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${bs(It(i))} instead.`);if(!ph(l,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${bs(It(l))} instead.`);return l.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Sh{constructor(e,i,l){this.type=Ht,this.needle=e,this.haystack=i,this.fromIndex=l}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,on),h=i.parse(e[2],2,on);if(!l||!h)return null;if(!_a(l.type,[tn,pn,Ht,Hl,on]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${bs(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ht);return f?new Sh(l,h,f):null}return new Sh(l,h)}evaluate(e){const i=this.needle.evaluate(e),l=this.haystack.evaluate(e);if(!ph(i,["boolean","string","number","null"]))throw new ms(`Expected first argument to be of type boolean, string, number or null, but found ${bs(It(i))} instead.`);if(!ph(l,["string","array"]))throw new ms(`Expected second argument to be of type array or string, but found ${bs(It(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return l.indexOf(i,h)}return l.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class rc{constructor(e,i,l,h,f,p){this.inputType=e,this.type=i,this.input=l,this.cases=h,this.outputs=f,this.otherwise=p}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let l,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const f={},p=[];for(let T=2;T<e.length-1;T+=2){let I=e[T];const C=e[T+1];Array.isArray(I)||(I=[I]);const M=i.concat(T);if(I.length===0)return M.error("Expected at least one branch label.");for(const O of I){if(typeof O!="number"&&typeof O!="string")return M.error("Branch labels must be numbers or strings.");if(typeof O=="number"&&Math.abs(O)>Number.MAX_SAFE_INTEGER)return M.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof O=="number"&&Math.floor(O)!==O)return M.error("Numeric branch labels must be integer values.");if(l){if(M.checkSubtype(l,It(O)))return null}else l=It(O);if(f[String(O)]!==void 0)return M.error("Branch labels must be unique.");f[String(O)]=p.length}const L=i.parse(C,T,h);if(!L)return null;h=h||L.type,p.push(L)}const x=i.parse(e[1],1,on);if(!x)return null;const w=i.parse(e[e.length-1],e.length-1,h);return w?x.type.kind!=="value"&&i.concat(1).checkSubtype(l,x.type)?null:new rc(l,h,x,f,p,w):null}evaluate(e){const i=this.input.evaluate(e);return($u(It(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),l=[],h={};for(const p of i){const x=h[this.cases[p]];x===void 0?(h[this.cases[p]]=l.length,l.push([this.cases[p],[p]])):l[x][1].push(p)}const f=p=>this.inputType.kind==="number"?Number(p):p;for(const[p,x]of l)e.push(x.length===1?f(x[0]):x.map(f)),e.push(this.outputs[p].serialize());return e.push(this.otherwise.serialize()),e}}class mp{constructor(e,i,l){this.type=e,this.branches=i,this.otherwise=l}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let l;i.expectedType&&i.expectedType.kind!=="value"&&(l=i.expectedType);const h=[];for(let p=1;p<e.length-1;p+=2){const x=i.parse(e[p],p,tn);if(!x)return null;const w=i.parse(e[p+1],p+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const f=i.parse(e[e.length-1],e.length-1,l);return f?new mp(l,h,f):null}evaluate(e){for(const[i,l]of this.branches)if(i.evaluate(e))return l.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,l]of this.branches)e(i),e(l);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Eh{constructor(e,i,l,h){this.type=e,this.input=i,this.beginIndex=l,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const l=i.parse(e[1],1,on),h=i.parse(e[2],2,Ht);if(!l||!h)return null;if(!_a(l.type,[or(on),pn,on]))return i.error(`Expected first argument to be of type array or string, but found ${bs(l.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Ht);return f?new Eh(l.type,l,h,f):null}return new Eh(l.type,l,h)}evaluate(e){const i=this.input.evaluate(e),l=this.beginIndex.evaluate(e);if(!ph(i,["string","array"]))throw new ms(`Expected first argument to be of type array or string, but found ${bs(It(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(l,h)}return i.slice(l)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function X_(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Y_(r,e,i,l){return l.compare(e,i)===0}function fl(r,e,i){const l=r!=="=="&&r!=="!=";return class rM{constructor(f,p,x){this.type=tn,this.lhs=f,this.rhs=p,this.collator=x,this.hasUntypedArgument=f.type.kind==="value"||p.type.kind==="value"}static parse(f,p){if(f.length!==3&&f.length!==4)return p.error("Expected two or three arguments.");const x=f[0];let w=p.parse(f[1],1,on);if(!w)return null;if(!X_(x,w.type))return p.concat(1).error(`"${x}" comparisons are not supported for type '${bs(w.type)}'.`);let T=p.parse(f[2],2,on);if(!T)return null;if(!X_(x,T.type))return p.concat(2).error(`"${x}" comparisons are not supported for type '${bs(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return p.error(`Cannot compare types '${bs(w.type)}' and '${bs(T.type)}'.`);l&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new ni(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new ni(w.type,[T])));let I=null;if(f.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return p.error("Cannot use collator to compare non-string types.");if(I=p.parse(f[3],3,ju),!I)return null}return new rM(w,T,I)}evaluate(f){const p=this.lhs.evaluate(f),x=this.rhs.evaluate(f);if(l&&this.hasUntypedArgument){const w=It(p),T=It(x);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new ms(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=It(p),T=It(x);if(w.kind!=="string"||T.kind!=="string")return e(f,p,x)}return this.collator?i(f,p,x,this.collator.evaluate(f)):e(f,p,x)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[r];return this.eachChild(p=>{f.push(p.serialize())}),f}}}const K_=fl("==",function(r,e,i){return e===i},Y_),yv=fl("!=",function(r,e,i){return e!==i},function(r,e,i,l){return!Y_(0,e,i,l)}),xv=fl("<",function(r,e,i){return e<i},function(r,e,i,l){return l.compare(e,i)<0}),vv=fl(">",function(r,e,i){return e>i},function(r,e,i,l){return l.compare(e,i)>0}),cd=fl("<=",function(r,e,i){return e<=i},function(r,e,i,l){return l.compare(e,i)<=0}),bv=fl(">=",function(r,e,i){return e>=i},function(r,e,i,l){return l.compare(e,i)>=0});class hd{constructor(e,i,l,h,f,p){this.type=pn,this.number=e,this.locale=i,this.currency=l,this.unit=h,this.minFractionDigits=f,this.maxFractionDigits=p}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const l=i.parse(e[1],1,Ht);if(!l)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let f=null;if(h.locale&&(f=i.parseObjectValue(h.locale,2,"locale",pn),!f))return null;let p=null;if(h.currency&&(p=i.parseObjectValue(h.currency,2,"currency",pn),!p))return null;let x=null;if(h.unit&&(x=i.parseObjectValue(h.unit,2,"unit",pn),!x))return null;let w=null;if(h["min-fraction-digits"]&&(w=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",Ht),!w))return null;let T=null;return h["max-fraction-digits"]&&(T=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",Ht),!T)?null:new hd(l,f,p,x,w,T)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _p{constructor(e){this.type=Ht,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const l=i.parse(e[1],1);return l?l.type.kind!=="array"&&l.type.kind!=="string"&&l.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${bs(l.type)} instead.`):new _p(l):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new ms(`Expected value to be of type string or array, but found ${bs(It(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function J_(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const pl={"==":K_,"!=":yv,">":vv,"<":xv,">=":bv,"<=":cd,array:ni,at:fp,"at-interpolated":pp,boolean:ni,case:mp,coalesce:Th,collator:So,format:ql,image:Zl,in:ld,"index-of":Sh,interpolate:Fr,"interpolate-hcl":Fr,"interpolate-lab":Fr,length:_p,let:ad,literal:ci,match:rc,number:ni,"number-format":hd,object:ni,slice:Eh,step:wh,string:ni,"to-boolean":qr,"to-color":qr,"to-number":qr,"to-string":qr,var:td,within:ir,distance:hl,config:sc};function gp(r,[e,i,l,h]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const f=h?h.evaluate(r):1,p=al(e,i,l,f);if(p)throw new ms(p);return new rn(e/255,i/255,l/255,f)}function yp(r,[e,i,l,h]){e=e.evaluate(r),i=i.evaluate(r),l=l.evaluate(r);const f=h?h.evaluate(r):1,p=function(T,I,C,M){return typeof T=="number"&&T>=0&&T<=360?typeof I=="number"&&I>=0&&I<=100&&typeof C=="number"&&C>=0&&C<=100?M===void 0||typeof M=="number"&&M>=0&&M<=1?null:`Invalid hsla value [${[T,I,C,M].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof M=="number"?[T,I,C,M]:[T,I,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof M=="number"?[T,I,C,M]:[T,I,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,l,f);if(p)throw new ms(p);const x=`hsla(${e}, ${i}%, ${l}%, ${f})`,w=rn.parse(x);if(!w)throw new ms(`Failed to parse HSLA color: ${x}`);return w}function Q_(r,e){return r in e}function ba(r,e){const i=e[r];return i===void 0?null:i}function ml(r){return{type:r}}function eg(r){return{result:"success",value:r}}function wa(r){return{result:"error",value:r}}function ud(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function Ah(r){return r["property-type"]==="data-driven"}function xp(r){return ud(r.expression,"measure-light")}function vp(r){return ud(r.expression,"zoom")}function Ih(r){return!!r.expression&&r.expression.interpolated}function Ch(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function tg(r){return r}function ig(r,e){const i=e.type==="color",l=r.stops&&typeof r.stops[0][0]=="object",h=l||!(l||r.property!==void 0),f=r.type||(Ih(e)?"exponential":"interval");if(i&&((r=ol({},r)).stops&&(r.stops=r.stops.map(T=>[T[0],rn.parse(T[1])])),r.default=rn.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Z_[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let p,x,w;if(f==="exponential")p=bp;else if(f==="interval")p=Tv;else if(f==="categorical"){p=wv,x=Object.create(null);for(const T of r.stops)x[T[0]]=T[1];w=typeof r.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);p=Sv}if(l){const T={},I=[];for(let L=0;L<r.stops.length;L++){const O=r.stops[L],V=O[0].zoom;T[V]===void 0&&(T[V]={zoom:V,type:r.type,property:r.property,default:r.default,stops:[]},I.push(V)),T[V].stops.push([O[0].value,O[1]])}const C=[];for(const L of I)C.push([T[L].zoom,ig(T[L],e)]);const M={name:"linear"};return{kind:"composite",interpolationType:M,interpolationFactor:Fr.interpolationFactor.bind(void 0,M),zoomStops:C.map(L=>L[0]),evaluate:({zoom:L},O)=>bp({stops:C,base:r.base},e,L).evaluate(L,O)}}if(h){const T=f==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Fr.interpolationFactor.bind(void 0,T),zoomStops:r.stops.map(I=>I[0]),evaluate:({zoom:I})=>p(r,e,I,x,w)}}return{kind:"source",evaluate(T,I){const C=I&&I.properties?I.properties[r.property]:void 0;return C===void 0?Xr(r.default,e.default):p(r,e,C,x,w)}}}function Xr(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function wv(r,e,i,l,h){return Xr(typeof i===h?l[i]:void 0,r.default,e.default)}function Tv(r,e,i){if(ga(i)!=="number")return Xr(r.default,e.default);const l=r.stops.length;if(l===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[l-1][0])return r.stops[l-1][1];const h=nd(r.stops.map(f=>f[0]),i);return r.stops[h][1]}function bp(r,e,i){const l=r.base!==void 0?r.base:1;if(ga(i)!=="number")return Xr(r.default,e.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const f=nd(r.stops.map(I=>I[0]),i),p=function(I,C,M,L){const O=L-M,V=I-M;return O===0?0:C===1?V/O:(Math.pow(C,V)-1)/(Math.pow(C,O)-1)}(i,l,r.stops[f][0],r.stops[f+1][0]),x=r.stops[f][1],w=r.stops[f+1][1];let T=uh[e.type]||tg;if(r.colorSpace&&r.colorSpace!=="rgb"){const I=Z_[r.colorSpace];T=(C,M)=>I.reverse(I.interpolate(I.forward(C),I.forward(M),p))}return typeof x.evaluate=="function"?{evaluate(...I){const C=x.evaluate.apply(void 0,I),M=w.evaluate.apply(void 0,I);if(C!==void 0&&M!==void 0)return T(C,M,p)}}:T(x,w,p)}function Sv(r,e,i){return e.type==="color"?i=rn.parse(i):e.type==="formatted"?i=ar.fromString(i.toString()):e.type==="resolvedImage"?i=gr.build(i.toString()):ga(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Xr(i,r.default,e.default)}Ns.register(pl,{error:[{kind:"error"},[pn],(r,[e])=>{throw new ms(e.evaluate(r))}],typeof:[pn,[on],(r,[e])=>bs(It(e.evaluate(r)))],"to-rgba":[or(Ht,4),[Er],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[or(Ht,4),[Er],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Er,[Ht,Ht,Ht],gp],rgba:[Er,[Ht,Ht,Ht,Ht],gp],hsl:[Er,[Ht,Ht,Ht],yp],hsla:[Er,[Ht,Ht,Ht,Ht],yp],has:{type:tn,overloads:[[[pn],(r,[e])=>Q_(e.evaluate(r),r.properties())],[[pn,Wo],(r,[e,i])=>Q_(e.evaluate(r),i.evaluate(r))]]},get:{type:on,overloads:[[[pn],(r,[e])=>ba(e.evaluate(r),r.properties())],[[pn,Wo],(r,[e,i])=>ba(e.evaluate(r),i.evaluate(r))]]},"feature-state":[on,[pn],(r,[e])=>ba(e.evaluate(r),r.featureState||{})],properties:[Wo,[],r=>r.properties()],"geometry-type":[pn,[],r=>r.geometryType()],worldview:[pn,[],r=>r.globals.worldview||""],id:[on,[],r=>r.id()],zoom:[Ht,[],r=>r.globals.zoom],pitch:[Ht,[],r=>r.globals.pitch||0],"distance-from-center":[Ht,[],r=>r.distanceFromCenter()],"measure-light":[Ht,[pn],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Ht,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ht,[],r=>r.globals.lineProgress||0],"raster-value":[Ht,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Ht,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ht,[],r=>r.globals.skyRadialProgress||0],accumulated:[on,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ht,ml(Ht),(r,e)=>{let i=0;for(const l of e)i+=l.evaluate(r);return i}],"*":[Ht,ml(Ht),(r,e)=>{let i=1;for(const l of e)i*=l.evaluate(r);return i}],"-":{type:Ht,overloads:[[[Ht,Ht],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ht],(r,[e])=>-e.evaluate(r)]]},"/":[Ht,[Ht,Ht],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ht,[Ht,Ht],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ht,[Ht],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ht,[Ht],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Ht,[Ht],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ht,[Ht],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ht,[Ht],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ht,[Ht],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ht,[Ht],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ht,[Ht],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ht,ml(Ht),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ht,ml(Ht),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ht,[Ht],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ht,[Ht],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ht,[Ht],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ht,[Ht],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[tn,[pn,on],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[tn,[on],(r,[e])=>r.id()===e.value],"filter-type-==":[tn,[pn],(r,[e])=>r.geometryType()===e.value],"filter-<":[tn,[pn,on],(r,[e,i])=>{const l=r.properties()[e.value],h=i.value;return typeof l==typeof h&&l<h}],"filter-id-<":[tn,[on],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<l}],"filter->":[tn,[pn,on],(r,[e,i])=>{const l=r.properties()[e.value],h=i.value;return typeof l==typeof h&&l>h}],"filter-id->":[tn,[on],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>l}],"filter-<=":[tn,[pn,on],(r,[e,i])=>{const l=r.properties()[e.value],h=i.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[tn,[on],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i<=l}],"filter->=":[tn,[pn,on],(r,[e,i])=>{const l=r.properties()[e.value],h=i.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[tn,[on],(r,[e])=>{const i=r.id(),l=e.value;return typeof i==typeof l&&i>=l}],"filter-has":[tn,[on],(r,[e])=>e.value in r.properties()],"filter-has-id":[tn,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[tn,[or(pn)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[tn,[or(on)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[tn,[pn,or(on)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[tn,[pn,or(on)],(r,[e,i])=>function(l,h,f,p){for(;f<=p;){const x=f+p>>1;if(h[x]===l)return!0;h[x]>l?p=x-1:f=x+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:tn,overloads:[[[tn,tn],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[ml(tn),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:tn,overloads:[[[tn,tn],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[ml(tn),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[tn,[tn],(r,[e])=>!e.evaluate(r)],"is-supported-script":[tn,[pn],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[pn,[pn],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[pn,[pn],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[pn,ml(on),(r,e)=>e.map(i=>Wr(i.evaluate(r))).join("")],"resolved-locale":[pn,[ju],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Ht,[Ht,Ht,on],(r,e)=>{const[i,l,h]=e.map(p=>p.evaluate(r));if(i>l||i===l)return i;let f;if(typeof h=="string")f=function(p){let x=0;if(p.length===0)return x;for(let w=0;w<p.length;w++)x=(x<<5)-x+p.charCodeAt(w),x|=0;return x}(h);else{if(typeof h!="number")throw new ms(`Invalid seed input: ${h}`);f=h}return i+J_(f)()*(l-i)}]});class oc{constructor(e,i,l,h){this.expression=e,this._warningHistory={},this._evaluator=new gh(l,h),this._defaultValue=i?function(f){return f.type==="color"&&(Ch(f.default)||Array.isArray(f.default))?new rn(0,0,0,0):f.type==="color"?rn.parse(f.default)||null:f.default===void 0?null:f.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=ed(e)}evaluateWithoutErrorHandling(e,i,l,h,f,p,x,w){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,l,h,f,p,x,w){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=p||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ms(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function dd(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in pl}function Xo(r,e,i,l){const h=new id(pl,[],e?function(p){const x={color:Er,string:pn,number:Ht,enum:pn,boolean:tn,formatted:dh,resolvedImage:fh};return p.type==="array"?or(x[p.value]||on,p.length):x[p.type]}(e):void 0,void 0,void 0,i,l),f=h.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?eg(new oc(f,e,i,l)):wa(h.errors)}class Mh{constructor(e,i,l,h){this.kind=e,this._styleExpression=i,this.isLightConstant=l,this.isLineProgressConstant=h,this.isStateDependent=e!=="constant"&&!Qu(i.expression),this.configDependencies=ed(i.expression)}evaluateWithoutErrorHandling(e,i,l,h,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,f,p)}evaluate(e,i,l,h,f,p){return this._styleExpression.evaluate(e,i,l,h,f,p)}}class Ph{constructor(e,i,l,h,f,p){this.kind=e,this.zoomStops=l,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Qu(i.expression),this.isLightConstant=f,this.isLineProgressConstant=p,this.configDependencies=ed(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,l,h,f,p){return this._styleExpression.evaluateWithoutErrorHandling(e,i,l,h,f,p)}evaluate(e,i,l,h,f,p){return this._styleExpression.evaluate(e,i,l,h,f,p)}interpolationFactor(e,i,l){return this.interpolationType?Fr.interpolationFactor(this.interpolationType,e,i,l):0}}function ng(r,e,i,l){if((r=Xo(r,e,i,l)).result==="error")return r;const h=r.value.expression,f=ic(h);if(!f&&!Ah(e))return wa([new Or("","data expressions not supported")]);const p=nc(h,["zoom","pitch","distance-from-center"]);if(!p&&!vp(e))return wa([new Or("","zoom expressions not supported")]);const x=nc(h,["measure-light"]);if(!x&&!xp(e))return wa([new Or("","measure-light expression not supported")]);const w=nc(h,["line-progress"]);if(!w&&!function(C){return ud(C.expression,"line-progress")}(e))return wa([new Or("","line-progress expression not supported")]);const T=e.expression&&e.expression.relaxZoomRestriction,I=lc(h);return I||p||T?I instanceof Or?wa([I]):I instanceof Fr&&!Ih(e)?wa([new Or("",'"interpolate" expressions cannot be used with this property')]):eg(I?new Ph(f&&w?"camera":"composite",r.value,I.labels,I instanceof Fr?I.interpolation:void 0,x,w):new Mh(f&&w?"constant":"source",r.value,x,w)):wa([new Or("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class ac{constructor(e,i){this._parameters=e,this._specification=i,ol(this,ig(this._parameters,this._specification))}static deserialize(e){return new ac(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function lc(r){let e=null;if(r instanceof ad)e=lc(r.result);else if(r instanceof Th){for(const i of r.args)if(e=lc(i),e)break}else(r instanceof wh||r instanceof Fr)&&r.input instanceof Ns&&r.input.name==="zoom"&&(e=r);return e instanceof Or||r.eachChild(i=>{const l=lc(i);l instanceof Or?e=l:e&&l&&e!==l&&(e=new Or("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var fd,wp,Tp=function(){if(wp)return fd;wp=1,fd=e;var r=3;function e(i,l,h){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var p=new Int32Array(this.arrayBuffer);i=p[0],this.d=(l=p[1])+2*(h=p[2]);for(var x=0;x<this.d*this.d;x++){var w=p[r+x],T=p[r+x+1];f.push(w===T?null:p.subarray(w,T))}var I=p[r+f.length+1];this.keys=p.subarray(p[r+f.length],I),this.bboxes=p.subarray(I),this.insert=this._insertReadonly}else{this.d=l+2*h;for(var C=0;C<this.d*this.d;C++)f.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=i,this.padding=h,this.scale=l/i,this.uid=0;var M=h/l*i;this.min=-M,this.max=i+M}return e.prototype.insert=function(i,l,h,f,p){this._forEachCell(l,h,f,p,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(p)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,l,h,f,p,x){this.cells[p].push(x)},e.prototype.query=function(i,l,h,f,p){var x=this.min,w=this.max;if(i<=x&&l<=x&&w<=h&&w<=f&&!p)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,l,h,f,this._queryCell,T,{},p),T},e.prototype._queryCell=function(i,l,h,f,p,x,w,T){var I=this.cells[p];if(I!==null)for(var C=this.keys,M=this.bboxes,L=0;L<I.length;L++){var O=I[L];if(w[O]===void 0){var V=4*O;(T?T(M[V+0],M[V+1],M[V+2],M[V+3]):i<=M[V+2]&&l<=M[V+3]&&h>=M[V+0]&&f>=M[V+1])?(w[O]=!0,x.push(C[O])):w[O]=!1}}},e.prototype._forEachCell=function(i,l,h,f,p,x,w,T){for(var I=this._convertToCellCoord(i),C=this._convertToCellCoord(l),M=this._convertToCellCoord(h),L=this._convertToCellCoord(f),O=I;O<=M;O++)for(var V=C;V<=L;V++){var $=this.d*V+O;if((!T||T(this._convertFromCellCoord(O),this._convertFromCellCoord(V),this._convertFromCellCoord(O+1),this._convertFromCellCoord(V+1)))&&p.call(this,i,l,h,f,$,x,w,T))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,l=r+this.cells.length+1+1,h=0,f=0;f<this.cells.length;f++)h+=this.cells[f].length;var p=new Int32Array(l+h+this.keys.length+this.bboxes.length);p[0]=this.extent,p[1]=this.n,p[2]=this.padding;for(var x=l,w=0;w<i.length;w++){var T=i[w];p[r+w]=x,p.set(T,x),x+=T.length}return p[r+i.length]=x,p.set(this.keys,x),p[r+i.length+1]=x+=this.keys.length,p.set(this.bboxes,x),x+=this.bboxes.length,p.buffer},fd}(),Yo=fa(Tp);const Ko={};function Ct(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),Ko[e]={klass:r,omit:i.omit||[]}}Ct(Object,"Object"),Yo.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Yo.deserialize=function(r){return new Yo(r.buffer)},Object.defineProperty(Yo,"name",{value:"Grid"}),Ct(Yo,"Grid"),typeof DOMMatrix<"u"&&Ct(DOMMatrix,"DOMMatrix"),Ct(rn,"Color"),Ct(Error,"Error"),Ct(ar,"Formatted"),Ct(Gu,"FormattedSection"),Ct(qi,"AJAXError"),Ct(gr,"ResolvedImage"),Ct(ac,"StylePropertyFunction"),Ct(oc,"StyleExpression",{omit:["_evaluator"]}),Ct(Sr,"ImageId"),Ct(qo,"ImageVariant"),Ct(Ph,"ZoomDependentExpression"),Ct(Mh,"ZoomConstantExpression"),Ct(Ns,"CompoundExpression",{omit:["_evaluate"]});for(const r in pl)Ko[pl[r]._classRegistryKey]||Ct(pl[r],`Expression${r}`);function sg(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function rg(r){return self.ImageBitmap&&r instanceof ImageBitmap}function Ta(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(sg(r)||rg(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const l of r)i.push(Ta(l,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[l,h]of r.entries())i.entries.push(Ta(l),Ta(h,e));return i}if(r instanceof Set){const i={$name:"Set"};let l=0;for(const h of r.values())i[++l]=Ta(h);return i}if(r instanceof DOMMatrix){const i={$name:"DOMMatrix"},l=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of l)i[h]=r[h];return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,l=i._classRegistryKey;if(!l)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const f in r)r.hasOwnProperty(f)&&(Ko[l].omit.indexOf(f)>=0||(h[f]=Ta(r[f],e)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return l!=="Object"&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof r)}function Sa(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||sg(r)||rg(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Sa);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const h=r.entries||[],f=new Map;for(let p=0;p<h.length;p+=2)f.set(Sa(h[p]),Sa(h[p+1]));return f}if(e==="Set"){const h=new Set;for(const f of Object.keys(r))f!=="$name"&&h.add(Sa(r[f]));return h}if(e==="DOMMatrix"){let h;return h=r.is2D?[r.a,r.b,r.c,r.d,r.e,r.f]:[r.m11,r.m12,r.m13,r.m14,r.m21,r.m22,r.m23,r.m24,r.m31,r.m32,r.m33,r.m34,r.m41,r.m42,r.m43,r.m44],new DOMMatrix(h)}if(e==="BigInt")return BigInt(r.value);const{klass:i}=Ko[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const l=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(l[h]=Sa(r[h]));return l}throw new Error("can't deserialize object of type "+typeof r)}const ti={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function Dh(r){for(const e of r)if(Sp(e.charCodeAt(0)))return!0;return!1}function Ev(r){for(const e of r)if(!Av(e.charCodeAt(0)))return!1;return!0}function Av(r){return!(ti.Arabic(r)||ti["Arabic Supplement"](r)||ti["Arabic Extended-A"](r)||ti["Arabic Presentation Forms-A"](r)||ti["Arabic Presentation Forms-B"](r))}function Sp(r){return!(r!==746&&r!==747&&(r<4352||!(ti["Bopomofo Extended"](r)||ti.Bopomofo(r)||ti["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||ti["CJK Compatibility Ideographs"](r)||ti["CJK Compatibility"](r)||ti["CJK Radicals Supplement"](r)||ti["CJK Strokes"](r)||!(!ti["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||ti["CJK Unified Ideographs Extension A"](r)||ti["CJK Unified Ideographs"](r)||ti["Enclosed CJK Letters and Months"](r)||ti["Hangul Compatibility Jamo"](r)||ti["Hangul Jamo Extended-A"](r)||ti["Hangul Jamo Extended-B"](r)||ti["Hangul Jamo"](r)||ti["Hangul Syllables"](r)||ti.Hiragana(r)||ti["Ideographic Description Characters"](r)||ti.Kanbun(r)||ti["Kangxi Radicals"](r)||ti["Katakana Phonetic Extensions"](r)||ti.Katakana(r)&&r!==12540||!(!ti["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!ti["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||ti["Unified Canadian Aboriginal Syllabics"](r)||ti["Unified Canadian Aboriginal Syllabics Extended"](r)||ti["Vertical Forms"](r)||ti["Yijing Hexagram Symbols"](r)||ti["Yi Syllables"](r)||ti["Yi Radicals"](r))))}function og(r){return!(Sp(r)||function(e){return!!(ti["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||ti["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||ti["Letterlike Symbols"](e)||ti["Number Forms"](e)||ti["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||ti["Control Pictures"](e)&&e!==9251||ti["Optical Character Recognition"](e)||ti["Enclosed Alphanumerics"](e)||ti["Geometric Shapes"](e)||ti["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ti["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ti["CJK Symbols and Punctuation"](e)||ti.Katakana(e)||ti["Private Use Area"](e)||ti["CJK Compatibility Forms"](e)||ti["Small Form Variants"](e)||ti["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Iv(r){return ti.Arabic(r)||ti["Arabic Supplement"](r)||ti["Arabic Extended-A"](r)||ti["Arabic Presentation Forms-A"](r)||ti["Arabic Presentation Forms-B"](r)}function ag(r){return r>=1424&&r<=2303||ti["Arabic Presentation Forms-A"](r)||ti["Arabic Presentation Forms-B"](r)}function Cv(r,e){return!(!e&&ag(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||ti.Khmer(r))}function Mv(r){for(const e of r)if(ag(e.charCodeAt(0)))return!0;return!1}const Ar={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Ep=null,cr=Ar.unavailable,Jo=null;const _l=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(cr=Ar.error),Ep&&Ep(r)};function pd(){md.fire(new nl("pluginStateChange",{pluginStatus:cr,pluginURL:Jo}))}const md=new sl,cc=function(){return cr},lg=function(){if(cr!==Ar.deferred||!Jo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");cr=Ar.loading,pd(),Jo&&lh({url:Jo},r=>{r?_l(r):(cr=Ar.loaded,pd())})},Qo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>cr===Ar.loaded||Qo.applyArabicShaping!=null,isLoading:()=>cr===Ar.loading,setState(r){cr=r.pluginStatus,Jo=r.pluginURL},isParsing:()=>cr===Ar.parsing,isParsed:()=>cr===Ar.parsed,getPluginURL:()=>Jo};class gn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,l){for(const h of i)if(!Cv(h.charCodeAt(0),l))return!1;return!0}(e,Qo.isLoaded())}}class Rh{constructor(e,i,l,h){this.property=e,this.value=i,this.expression=function(f,p,x,w){if(Ch(f))return new ac(f,p);if(dd(f)||Array.isArray(f)&&f.length>0){const T=ng(f,p,x,w);if(T.result==="error")throw new Error(T.value.map(I=>`${I.key}: ${I.message}`).join(", "));return T.value}{let T=f;return typeof f=="string"&&p.type==="color"&&(T=rn.parse(f)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(i===void 0?e.specification.default:i,e.specification,l,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,l){return this.property.possiblyEvaluate(this,e,i,l)}}class Ea{constructor(e,i,l){this.property=e,this.value=new Rh(e,void 0,i,l)}transitioned(e,i){return new hg(this.property,this.value,i,Fe({},e.transition,this.transition),e.now)}untransitioned(){return new hg(this.property,this.value,null,{},0)}}class cg{constructor(e,i,l){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=l,this.configDependencies=new Set}getValue(e){return ui(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property,this._scope,this._options)),this._values[e].value=new Rh(this._values[e].property,i===null?void 0:ui(i),this._scope,this._options),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]))}setTransitionOrValue(e,i){i&&(this._options=i);const l=this._properties.properties;if(e)for(const h in e){const f=e[h];if(h.endsWith("-transition")){const p=h.slice(0,-11);l[p]&&this.setTransition(p,f)}else l.hasOwnProperty(h)&&this.setValue(h,f)}}getTransition(e){return ui(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property)),this._values[e].transition=ui(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const l=new ug(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(e,i._values[h]);return l}untransitioned(){const e=new ug(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class hg{constructor(e,i,l,h,f){const p=h.delay||0,x=h.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+p,this.end=this.begin+x,e.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(e,i,l){const h=e.now||0,f=this.value.possiblyEvaluate(e,i,l),p=this.prior;if(p){if(h>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(h<this.begin)return p.possiblyEvaluate(e,i,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(p.possiblyEvaluate(e,i,l),f,J(x))}}return f}}class ug{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,l){const h=new gl(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,l);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Pv{constructor(e,i,l){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=l,this.configDependencies=new Set}getValue(e){return ui(this._values[e].value)}setValue(e,i){this._values[e]=new Rh(this._values[e].property,i===null?void 0:ui(i),this._scope,this._options),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]))}serialize(){const e={};for(const i of Object.keys(this._values)){const l=this.getValue(i);l!==void 0&&(e[i]=l)}return e}possiblyEvaluate(e,i,l){const h=new gl(this._properties);for(const f of Object.keys(this._values))h._values[f]=this._values[f].possiblyEvaluate(e,i,l);return h}}class hc{constructor(e,i,l){this.property=e,this.value=i,this.parameters=l}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,l,h){return this.property.evaluate(this.value,this.parameters,e,i,l,h)}}class gl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class lt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,l){const h=uh[this.specification.type];return h?h(e,i,l):e}}class St{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,l,h){return new hc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},l,h)}:e.expression,i)}interpolate(e,i,l){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new hc(this,{kind:"constant",value:void 0},e.parameters);const h=uh[this.specification.type];return h?new hc(this,{kind:"constant",value:h(e.value.value,i.value.value,l)},e.parameters):e}evaluate(e,i,l,h,f,p){return e.kind==="constant"?e.value:e.evaluate(i,l,h,f,p)}}class yl{constructor(e){this.specification=e}possiblyEvaluate(e,i,l,h){return!!e.expression.evaluate(i,null,{},l,h)}interpolate(){return!1}}class Kn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new gn(0,{});for(const l in e){const h=e[l];h.specification.overridable&&this.overridableProperties.push(l);const f=this.defaultPropertyValues[l]=new Rh(h,void 0),p=this.defaultTransitionablePropertyValues[l]=new Ea(h);this.defaultTransitioningPropertyValues[l]=p.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=f.possiblyEvaluate(i)}}}Ct(St,"DataDrivenProperty"),Ct(lt,"DataConstantProperty"),Ct(yl,"ColorRampProperty");var Re=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-wall-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function ao(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function _d(r){if(Array.isArray(r))return r.map(_d);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=_d(r[i]);return e}return ao(r)}function gd(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!gd(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ap(r,e="",i=null,l="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};gd(r)||(r=yd(r));const h=r;let f=!0;try{f=function(I){if(!uc(I))return I;let C=_d(I);return fg(C),C=dg(C),C}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let p=null,x=null;if(l!=="background"&&l!=="sky"&&l!=="slot"){x=Re[`filter_${l}`];const I=Xo(f,x,e,i);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));p=(C,M,L)=>I.value.evaluate(C,M,{},L)}let w=null,T=null;if(f!==h){const I=Xo(h,x,e,i);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));w=(C,M,L,O,V)=>I.value.evaluate(C,M,{},L,void 0,void 0,O,V),T=!ic(I.value.expression)}return{filter:p,dynamicFilter:w||void 0,needGeometry:pg(f),needFeature:!!T}}function dg(r){if(!Array.isArray(r))return r;const e=function(i){if(Dv.has(i[0])){for(let l=1;l<i.length;l++)if(uc(i[l]))return!0}return i}(r);return e===!0?e:e.map(i=>dg(i))}function fg(r){let e=!1;const i=[];if(r[0]==="case"){for(let l=1;l<r.length-1;l+=2)e=e||uc(r[l]),i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||uc(r[1]);for(let l=2;l<r.length-1;l+=2)i.push(r[l+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||uc(r[1]);for(let l=1;l<r.length-1;l+=2)i.push(r[l+1])}e&&(r.length=0,r.push("any",...i));for(let l=1;l<r.length;l++)fg(r[l])}function uc(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(uc(r[i]))return!0;return!1}const Dv=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Rv(r,e){return r<e?-1:r>e?1:0}function pg(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(pg(r[e]))return!0;return!1}function yd(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Ip(r[1],r[2],"=="):e==="!="?xd(Ip(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Ip(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(yd))):e==="all"?["all"].concat(r.slice(1).map(yd)):e==="none"?["all"].concat(r.slice(1).map(yd).map(xd)):e==="in"?Cp(r[1],r.slice(2)):e==="!in"?xd(Cp(r[1],r.slice(2))):e==="has"?mg(r[1]):e!=="!has"||xd(mg(r[1]));var i}function Ip(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Cp(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Rv)]]:["filter-in-small",r,["literal",e]]}}function mg(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function xd(r){return["!",r]}const Lh="";function xl(r,e){return e?`${r}${Lh}${e}`:r}const Mp="-transition",Aa=new Set(["fill","line","background","hillshade","raster"]);class nr extends sl{constructor(e,i,l,h,f){if(super(),this.id=e.id,this.fqid=xl(this.id,l),this.type=e.type,this.scope=l,this.lut=h,this.options=f,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const p=Xo(this.filter,Re[`filter_${e.type}`]);p.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...p.value.configDependencies]))}if(e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new Pv(i.layout,this.scope,f),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new cg(i.paint,this.scope,f);for(const p in e.paint)this.setPaintProperty(p,e.paint[p]);for(const p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new gl(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Aa.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const l=this._unevaluatedLayout;l._properties.properties[e]&&(l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Mp)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i){const l=this._transitionablePaint,h=l._properties.properties;if(e.endsWith(Mp)){const C=e.slice(0,-11);return h[C]&&l.setTransition(C,i||void 0),!1}if(!h[e])return!1;const f=l._values[e],p=f.value.isDataDriven(),x=f.value;l.setValue(e,i),this.configDependencies=new Set([...this.configDependencies,...l.configDependencies]),this._handleSpecialPaintPropertyUpdate(e);const w=l._values[e].value,T=w.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return T||p||I||this._handleOverridablePaintPropertyUpdate(e,x,w)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,l){return null}_handleOverridablePaintPropertyUpdate(e,i,l){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return li({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof hc&&Ah(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Ap(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(e){}queryIntersectsFeature(e,i,l,h,f,p,x,w,T){}}const Lv={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class zh{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Nn{constructor(){this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Xi(r,e=1){let i=0,l=0;return{members:r.map(h=>{const f=Lv[h.type].BYTES_PER_ELEMENT,p=i=Pp(i,Math.max(e,f)),x=h.components||1;return l=Math.max(l,f),i+=f*x,{name:h.name,type:h.type,components:x,offset:p}}),size:Pp(i,Math.max(l,e)),alignment:e}}function Pp(r,e){return Math.ceil(r/e)*e}class ea extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=l,e}}ea.prototype.bytesPerElement=4,Ct(ea,"StructArrayLayout2i4");class Oh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=h,e}}Oh.prototype.bytesPerElement=6,Ct(Oh,"StructArrayLayout3i6");class dc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const p=4*e;return this.int16[p+0]=i,this.int16[p+1]=l,this.int16[p+2]=h,this.int16[p+3]=f,e}}dc.prototype.bytesPerElement=8,Ct(dc,"StructArrayLayout4i8");class Ia extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Ia.prototype.bytesPerElement=4,Ct(Ia,"StructArrayLayout1f4");class Dp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=4*e,p=2*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.float32[p+1]=h,e}}Dp.prototype.bytesPerElement=8,Ct(Dp,"StructArrayLayout2i1f8");class vd extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=l,this.int16[f+2]=h,e}}vd.prototype.bytesPerElement=8,Ct(vd,"StructArrayLayout3i8");class fc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h,f)}emplace(e,i,l,h,f,p){const x=5*e;return this.int16[x+0]=i,this.int16[x+1]=l,this.int16[x+2]=h,this.int16[x+3]=f,this.int16[x+4]=p,e}}fc.prototype.bytesPerElement=10,Ct(fc,"StructArrayLayout5i10");class Rp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,p,x)}emplace(e,i,l,h,f,p,x,w){const T=6*e,I=12*e,C=3*e;return this.int16[T+0]=i,this.int16[T+1]=l,this.uint8[I+4]=h,this.uint8[I+5]=f,this.uint8[I+6]=p,this.uint8[I+7]=x,this.float32[C+2]=w,e}}Rp.prototype.bytesPerElement=12,Ct(Rp,"StructArrayLayout2i4ub1f12");class Ao extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=l,this.float32[f+2]=h,e}}Ao.prototype.bytesPerElement=12,Ct(Ao,"StructArrayLayout3f12");class Ca extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h,f)}emplace(e,i,l,h,f,p){const x=6*e,w=3*e;return this.uint16[x+0]=i,this.uint16[x+1]=l,this.uint16[x+2]=h,this.uint16[x+3]=f,this.float32[w+2]=p,e}}Ca.prototype.bytesPerElement=12,Ct(Ca,"StructArrayLayout4ui1f12");class kh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const p=4*e;return this.uint16[p+0]=i,this.uint16[p+1]=l,this.uint16[p+2]=h,this.uint16[p+3]=f,e}}kh.prototype.bytesPerElement=8,Ct(kh,"StructArrayLayout4ui8");class bd extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,p)}emplace(e,i,l,h,f,p,x){const w=6*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=f,this.int16[w+4]=p,this.int16[w+5]=x,e}}bd.prototype.bytesPerElement=12,Ct(bd,"StructArrayLayout6i12");class pc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C,M){const L=this.length;return this.resize(L+1),this.emplace(L,e,i,l,h,f,p,x,w,T,I,C,M)}emplace(e,i,l,h,f,p,x,w,T,I,C,M,L){const O=12*e;return this.int16[O+0]=i,this.int16[O+1]=l,this.int16[O+2]=h,this.int16[O+3]=f,this.uint16[O+4]=p,this.uint16[O+5]=x,this.uint16[O+6]=w,this.uint16[O+7]=T,this.int16[O+8]=I,this.int16[O+9]=C,this.int16[O+10]=M,this.int16[O+11]=L,e}}pc.prototype.bytesPerElement=24,Ct(pc,"StructArrayLayout4i4ui4i24");class mc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,p)}emplace(e,i,l,h,f,p,x){const w=10*e,T=5*e;return this.int16[w+0]=i,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=x,e}}mc.prototype.bytesPerElement=20,Ct(mc,"StructArrayLayout3i3f20");class $s extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const p=4*e;return this.float32[p+0]=i,this.float32[p+1]=l,this.float32[p+2]=h,this.float32[p+3]=f,e}}$s.prototype.bytesPerElement=16,Ct($s,"StructArrayLayout4f16");class _c extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}_c.prototype.bytesPerElement=4,Ct(_c,"StructArrayLayout1ul4");class Ma extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=l,e}}Ma.prototype.bytesPerElement=4,Ct(Ma,"StructArrayLayout2ui4");class Lp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C,M,L){const O=this.length;return this.resize(O+1),this.emplace(O,e,i,l,h,f,p,x,w,T,I,C,M,L)}emplace(e,i,l,h,f,p,x,w,T,I,C,M,L,O){const V=20*e,$=10*e;return this.int16[V+0]=i,this.int16[V+1]=l,this.int16[V+2]=h,this.int16[V+3]=f,this.int16[V+4]=p,this.float32[$+3]=x,this.float32[$+4]=w,this.float32[$+5]=T,this.float32[$+6]=I,this.int16[V+14]=C,this.uint32[$+8]=M,this.uint16[V+18]=L,this.uint16[V+19]=O,e}}Lp.prototype.bytesPerElement=40,Ct(Lp,"StructArrayLayout5i4f1i1ul2ui40");class wd extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,p,x)}emplace(e,i,l,h,f,p,x,w){const T=8*e;return this.int16[T+0]=i,this.int16[T+1]=l,this.int16[T+2]=h,this.int16[T+4]=f,this.int16[T+5]=p,this.int16[T+6]=x,this.int16[T+7]=w,e}}wd.prototype.bytesPerElement=16,Ct(wd,"StructArrayLayout3i2i2i16");class zp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h,f)}emplace(e,i,l,h,f,p){const x=4*e,w=8*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=f,this.int16[w+7]=p,e}}zp.prototype.bytesPerElement=16,Ct(zp,"StructArrayLayout2f1f2i16");class Fh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,p)}emplace(e,i,l,h,f,p,x){const w=20*e,T=5*e;return this.uint8[w+0]=i,this.uint8[w+1]=l,this.float32[T+1]=h,this.float32[T+2]=f,this.float32[T+3]=p,this.float32[T+4]=x,e}}Fh.prototype.bytesPerElement=20,Ct(Fh,"StructArrayLayout2ub4f20");class Gs extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,l)}emplace(e,i,l,h){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=l,this.uint16[f+2]=h,e}}Gs.prototype.bytesPerElement=6,Ct(Gs,"StructArrayLayout3ui6");class Bh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y)}emplace(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y,te){const oe=30*e,ve=15*e,ge=60*e;return this.int16[oe+0]=i,this.int16[oe+1]=l,this.int16[oe+2]=h,this.float32[ve+2]=f,this.float32[ve+3]=p,this.uint16[oe+8]=x,this.uint16[oe+9]=w,this.uint32[ve+5]=T,this.uint32[ve+6]=I,this.uint32[ve+7]=C,this.uint16[oe+16]=M,this.uint16[oe+17]=L,this.uint16[oe+18]=O,this.float32[ve+10]=V,this.float32[ve+11]=$,this.uint8[ge+48]=W,this.uint8[ge+49]=Q,this.uint8[ge+50]=ee,this.uint32[ve+13]=U,this.int16[oe+28]=Y,this.uint8[ge+58]=te,e}}Bh.prototype.bytesPerElement=60,Ct(Bh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Op extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y,te,oe,ve,ge,be,Me,$e,ot,Qe,rt,at,He){const nt=this.length;return this.resize(nt+1),this.emplace(nt,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y,te,oe,ve,ge,be,Me,$e,ot,Qe,rt,at,He)}emplace(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee,U,Y,te,oe,ve,ge,be,Me,$e,ot,Qe,rt,at,He,nt){const Ue=20*e,Ge=40*e,ht=80*e;return this.float32[Ue+0]=i,this.float32[Ue+1]=l,this.int16[Ge+4]=h,this.int16[Ge+5]=f,this.int16[Ge+6]=p,this.int16[Ge+7]=x,this.int16[Ge+8]=w,this.int16[Ge+9]=T,this.int16[Ge+10]=I,this.int16[Ge+11]=C,this.int16[Ge+12]=M,this.uint16[Ge+13]=L,this.uint16[Ge+14]=O,this.uint16[Ge+15]=V,this.uint16[Ge+16]=$,this.uint16[Ge+17]=W,this.uint16[Ge+18]=Q,this.uint16[Ge+19]=ee,this.uint16[Ge+20]=U,this.uint16[Ge+21]=Y,this.uint16[Ge+22]=te,this.uint16[Ge+23]=oe,this.uint16[Ge+24]=ve,this.uint16[Ge+25]=ge,this.uint16[Ge+26]=be,this.uint16[Ge+27]=Me,this.uint32[Ue+14]=$e,this.float32[Ue+15]=ot,this.float32[Ue+16]=Qe,this.float32[Ue+17]=rt,this.float32[Ue+18]=at,this.uint8[ht+76]=He,this.uint16[Ge+39]=nt,e}}Op.prototype.bytesPerElement=80,Ct(Op,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class kp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p){const x=this.length;return this.resize(x+1),this.emplace(x,e,i,l,h,f,p)}emplace(e,i,l,h,f,p,x){const w=6*e;return this.float32[w+0]=i,this.float32[w+1]=l,this.float32[w+2]=h,this.float32[w+3]=f,this.float32[w+4]=p,this.float32[w+5]=x,e}}kp.prototype.bytesPerElement=24,Ct(kp,"StructArrayLayout6f24");class Pa extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,l,h,f)}emplace(e,i,l,h,f,p){const x=5*e;return this.float32[x+0]=i,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=f,this.float32[x+4]=p,e}}Pa.prototype.bytesPerElement=20,Ct(Pa,"StructArrayLayout5f20");class Nh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,p,x)}emplace(e,i,l,h,f,p,x,w){const T=7*e;return this.float32[T+0]=i,this.float32[T+1]=l,this.float32[T+2]=h,this.float32[T+3]=f,this.float32[T+4]=p,this.float32[T+5]=x,this.float32[T+6]=w,e}}Nh.prototype.bytesPerElement=28,Ct(Nh,"StructArrayLayout7f28");class Fp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,l,h,f,p,x,w,T,I,C)}emplace(e,i,l,h,f,p,x,w,T,I,C,M){const L=11*e;return this.float32[L+0]=i,this.float32[L+1]=l,this.float32[L+2]=h,this.float32[L+3]=f,this.float32[L+4]=p,this.float32[L+5]=x,this.float32[L+6]=w,this.float32[L+7]=T,this.float32[L+8]=I,this.float32[L+9]=C,this.float32[L+10]=M,e}}Fp.prototype.bytesPerElement=44,Ct(Fp,"StructArrayLayout11f44");class Td extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,l,h,f,p,x,w,T)}emplace(e,i,l,h,f,p,x,w,T,I){const C=9*e;return this.float32[C+0]=i,this.float32[C+1]=l,this.float32[C+2]=h,this.float32[C+3]=f,this.float32[C+4]=p,this.float32[C+5]=x,this.float32[C+6]=w,this.float32[C+7]=T,this.float32[C+8]=I,e}}Td.prototype.bytesPerElement=36,Ct(Td,"StructArrayLayout9f36");class vl extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const l=this.length;return this.resize(l+1),this.emplace(l,e,i)}emplace(e,i,l){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=l,e}}vl.prototype.bytesPerElement=8,Ct(vl,"StructArrayLayout2f8");class Bp extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,l,h){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,l,h)}emplace(e,i,l,h,f){const p=6*e;return this.uint32[3*e+0]=i,this.uint16[p+2]=l,this.uint16[p+3]=h,this.uint16[p+4]=f,e}}Bp.prototype.bytesPerElement=12,Ct(Bp,"StructArrayLayout1ul3ui12");class Vh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}Vh.prototype.bytesPerElement=2,Ct(Vh,"StructArrayLayout1ui2");class gc extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$){const W=this.length;return this.resize(W+1),this.emplace(W,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$)}emplace(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W){const Q=16*e;return this.float32[Q+0]=i,this.float32[Q+1]=l,this.float32[Q+2]=h,this.float32[Q+3]=f,this.float32[Q+4]=p,this.float32[Q+5]=x,this.float32[Q+6]=w,this.float32[Q+7]=T,this.float32[Q+8]=I,this.float32[Q+9]=C,this.float32[Q+10]=M,this.float32[Q+11]=L,this.float32[Q+12]=O,this.float32[Q+13]=V,this.float32[Q+14]=$,this.float32[Q+15]=W,e}}gc.prototype.bytesPerElement=64,Ct(gc,"StructArrayLayout16f64");class Uh extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,l,h,f,p,x){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,l,h,f,p,x)}emplace(e,i,l,h,f,p,x,w){const T=10*e,I=5*e;return this.uint16[T+0]=i,this.uint16[T+1]=l,this.uint16[T+2]=h,this.uint16[T+3]=f,this.float32[I+2]=p,this.float32[I+3]=x,this.float32[I+4]=w,e}}Uh.prototype.bytesPerElement=20,Ct(Uh,"StructArrayLayout4ui3f20");class Np extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Np.prototype.bytesPerElement=2,Ct(Np,"StructArrayLayout1i2");class Sd extends Nn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Sd.prototype.bytesPerElement=1,Ct(Sd,"StructArrayLayout1ub1");class _g extends zh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}_g.prototype.size=40;class Ed extends Lp{get(e){return new _g(this,e)}}Ct(Ed,"CollisionBoxArray");class gg extends zh{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}gg.prototype.size=60;class yg extends Bh{get(e){return new gg(this,e)}}Ct(yg,"PlacedSymbolArray");class xg extends zh{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}xg.prototype.size=80;class vg extends Op{get(e){return new xg(this,e)}}Ct(vg,"SymbolInstanceArray");class Vp extends Ia{getoffsetX(e){return this.float32[1*e+0]}}Ct(Vp,"GlyphOffsetArray");class bg extends ea{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ct(bg,"SymbolLineVertexArray");class wg extends zh{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}wg.prototype.size=12;class Tg extends Bp{get(e){return new wg(this,e)}}Ct(Tg,"FeatureIndexArray");class Sg extends Ma{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ct(Sg,"FillExtrusionCentroidArray");class Eg extends zh{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Eg.prototype.size=6;class Ag extends Oh{get(e){return new Eg(this,e)}}Ct(Ag,"FillExtrusionWallArray");const zv=Xi([{name:"a_pos",components:2,type:"Int16"}],4),Ov=Xi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),Ad=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class ts{constructor(e=[]){this.segments=e}_prepareSegment(e,i,l,h){let f=this.segments[this.segments.length-1];return e>ts.MAX_VERTEX_ARRAY_LENGTH&&Si(`Max vertices per segment is ${ts.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>ts.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==h)&&(f={vertexOffset:i,primitiveOffset:l,vertexLength:0,primitiveLength:0},h!==void 0&&(f.sortKey=h),this.segments.push(f)),f}prepareSegment(e,i,l,h){return this._prepareSegment(e,i.length,l.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,l,h){return new ts([{vertexOffset:e,primitiveOffset:i,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}function Ig(r,e){return 256*(r=de(Math.floor(r),0,255))+de(Math.floor(e),0,255)}ts.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct(ts,"SegmentVector");const Id=Xi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Up=Xi([{name:"a_pattern_b",components:4,type:"Uint16"}]),Cg=Xi([{name:"a_dash",components:4,type:"Uint16"}]);class jh{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,l,h){this.ids.push(jp(e)),this.positions.push(i,l,h)}eachPosition(e,i){const l=jp(e);let h=0,f=this.ids.length-1;for(;h<f;){const p=h+f>>1;this.ids[p]>=l?f=p:h=p+1}for(;this.ids[h]===l;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const l=new Float64Array(e.ids),h=new Uint32Array(e.positions);return Cd(l,h,0,l.length-1),i&&(i.add(l.buffer),i.add(h.buffer)),{ids:l,positions:h}}static deserialize(e){const i=new jh;let l;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==l&&i.uniqueIds.push(h),l=h;return i.indexed=!0,i}}function jp(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:hh(String(r))}function Cd(r,e,i,l){for(;i<l;){const h=r[i+l>>1];let f=i-1,p=l+1;for(;;){do f++;while(r[f]<h);do p--;while(r[p]>h);if(f>=p)break;$h(r,f,p),$h(e,3*f,3*p),$h(e,3*f+1,3*p+1),$h(e,3*f+2,3*p+2)}p-i<l-p?(Cd(r,e,i,p),i=p+1):(Cd(r,e,p+1,l),l=p)}}function $h(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}Ct(jh,"FeaturePositionMap");class ta{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,l){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Md extends ta{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1i(this.location,l))}}class us extends ta{constructor(e){super(e),this.current=0}set(e,i,l){this.fetchUniformLocation(e,i)&&this.current!==l&&(this.current=l,this.gl.uniform1f(this.location,l))}}class Io extends ta{constructor(e){super(e),this.current=[0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]||(this.current=l,this.gl.uniform2f(this.location,l[0],l[1])))}}class Gh extends ta{constructor(e){super(e),this.current=[0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]||(this.current=l,this.gl.uniform3f(this.location,l[0],l[1],l[2])))}}class Pd extends ta{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,l){this.fetchUniformLocation(e,i)&&(l[0]===this.current[0]&&l[1]===this.current[1]&&l[2]===this.current[2]&&l[3]===this.current[3]||(this.current=l,this.gl.uniform4f(this.location,l[0],l[1],l[2],l[3])))}}class Mg extends ta{constructor(e){super(e),this.current=rn.transparent.toPremultipliedRenderColor(null)}set(e,i,l){this.fetchUniformLocation(e,i)&&(l.r===this.current.r&&l.g===this.current.g&&l.b===this.current.b&&l.a===this.current.a||(this.current=l,this.gl.uniform4f(this.location,l.r,l.g,l.b,l.a)))}}const kv=new Float32Array(16);class yc extends ta{constructor(e){super(e),this.current=kv}set(e,i,l){if(this.fetchUniformLocation(e,i)){if(l[12]!==this.current[12]||l[0]!==this.current[0])return this.current=l,void this.gl.uniformMatrix4fv(this.location,!1,l);for(let h=1;h<16;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix4fv(this.location,!1,l);break}}}}const $p=new Float32Array(9),Co=new Float32Array(4);class Hh extends ta{constructor(e){super(e),this.current=Co}set(e,i,l){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(l[h]!==this.current[h]){this.current=l,this.gl.uniformMatrix2fv(this.location,!1,l);break}}}}function Gp(r){return[Ig(255*r.r,255*r.g),Ig(255*r.b,255*r.a)]}class Wh{constructor(e,i,l,h){this.value=e,this.uniformNames=i.map(f=>`u_${f}`),this.type=l,this.context=h}setUniform(e,i,l,h,f){const p=h.constantOr(this.value);i.set(e,f,p instanceof rn?p.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):p)}getBinding(e,i){return this.type==="color"?new Mg(e):new us(e)}}class xc{constructor(e,i){this.uniformNames=i.map(l=>`u_${l}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,l,h,f){let p=null;f!=="u_pattern"&&f!=="u_dash"||(p=this.pattern),f==="u_pattern_b"&&(p=this.patternTransition),f==="u_pixel_ratio"&&(p=this.pixelRatio),p&&i.set(e,f,p)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Pd(e):new us(e)}}class ia{constructor(e,i,l,h){this.expression=e,this.type=l,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:l==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,l,h,f,p,x,w){const T=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new gn(0,{brightness:p,worldview:w}),i,{},f,h,x):this.expression.kind==="constant"&&this.expression.value,C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:p,worldview:w}),i,{},f,h,x):this.lutExpression.value)==="none";this.paintVertexArray.resize(e),this._setPaintValue(T,e,I,C?null:this.context.lut)}updatePaintArray(e,i,l,h,f,p,x,w){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:x,worldview:w},l,h,void 0,f):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:x,worldview:w}),l,h,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I?null:this.context.lut)}_setPaintValue(e,i,l,h){if(this.type==="color"){const f=Gp(l.toPremultipliedRenderColor(h));for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class lo{constructor(e,i,l,h,f,p){this.expression=e,this.uniformNames=i.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map(x=>({name:`a_${x}`,type:"Float32",components:l==="color"?4:2,offset:0})),this.paintVertexArray=new p}populatePaintArray(e,i,l,h,f,p,x,w){const T=this.expression.evaluate(new gn(this.context.zoom,{brightness:p,worldview:w}),i,{},f,h,x),I=this.expression.evaluate(new gn(this.context.zoom+1,{brightness:p,worldview:w}),i,{},f,h,x),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:p,worldview:w}),i,{},f,h,x):this.lutExpression.value)==="none",M=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(M,e,T,I,C?null:this.context.lut)}updatePaintArray(e,i,l,h,f,p,x,w){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:x,worldview:w},l,h,void 0,f),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:x,worldview:w},l,h,void 0,f),C=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new gn(0,{brightness:x,worldview:w}),l,h,void 0,f):this.lutExpression.value)==="none";this._setPaintValue(e,i,T,I,C?null:this.context.lut)}_setPaintValue(e,i,l,h,f){if(this.type==="color"){const p=Gp(l.toPremultipliedRenderColor(f)),x=Gp(l.toPremultipliedRenderColor(f));for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,p[0],p[1],x[0],x[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,l,h,f){const p=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,x=de(this.expression.interpolationFactor(p,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,x)}getBinding(e,i){return new us(e)}}class Yr{constructor(e,i,l,h,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(l==="array"?Cg:Id).members;for(let p=0;p<i.length;++p);this.paintVertexArray=new h,this.paintTransitionVertexArray=new kh}populatePaintArray(e,i,l,h){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],l)}updatePaintArray(e,i,l,h,f,p,x){this._setPaintValues(e,i,l.patterns&&l.patterns[this.layerId],p)}_setPaintValues(e,i,l,h){if(!h||!l)return;const f=h[l[0]],p=h[l[1]];if(f){if(f){const{tl:x,br:w,pixelRatio:T}=f;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,x[0],x[1],w[0],w[1],T)}if(p){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:x,br:w}=p;for(let T=e;T<i;T++)this.paintTransitionVertexArray.emplace(T,x[0],x[1],w[0],w[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Up.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class vc{constructor(e,i,l=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const f in e.paint._values){const p=e.paint.get(f);if(f.endsWith("-use-theme")||!l(f)||!(p instanceof hc&&Ah(p.property.specification)))continue;const x=o(f,e.type),w=p.value,T=p.property.specification.type,I=!!p.property.useIntegerZoom,C=f==="line-dasharray"||f.endsWith("pattern"),M=e.paint.get(`${f}-use-theme`),L=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||M&&M.value.kind!=="constant";if(w.kind!=="constant"||L)if(w.kind==="source"||L||C){const O=y(f,T,"source");this.binders[f]=C?new Yr(w,x,T,O,e.id):new ia(w,x,T,O),h.push(`/a_${f}`)}else{const O=y(f,T,"composite");this.binders[f]=new lo(w,x,T,I,i,O),h.push(`/z_${f}`)}else this.binders[f]=C?new xc(w.value,x):new Wh(w.value,x,T,i),h.push(`/u_${f}`);M&&(this.binders[f].lutExpression=M.value)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof ia||i instanceof lo?i.maxValue:0}populatePaintArrays(e,i,l,h,f,p,x,w){for(const T in this.binders){const I=this.binders[T];I.context=this.context,(I instanceof ia||I instanceof lo||I instanceof Yr)&&I.populatePaintArray(e,i,l,h,f,p,x,w)}}setConstantPatternPositions(e,i){for(const l in this.binders){const h=this.binders[l];h instanceof xc&&h.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof Yr?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,l,h,f,p,x,w,T,I){let C=!1;const M=Object.keys(e),L=M.length!==0&&!w,O=L?M:i.uniqueIds;this.context.lut=f.lut;for(const V in this.binders){const $=this.binders[V];if($.context=this.context,($ instanceof ia||$ instanceof lo||$ instanceof Yr)&&$.expression&&$.expression.kind&&$.expression.kind!=="constant"&&($.expression.isStateDependent===!0||$.expression.isLightConstant===!1)){const W=f.paint.get(V);$.expression=W.value;for(const Q of O){const ee=e[Q.toString()];i.eachPosition(Q,(U,Y,te)=>{const oe=h.feature(U);$.updatePaintArray(Y,te,oe,ee,p,x,T,I)})}if(!L)for(const Q of l.uniqueIds){const ee=e[Q.toString()];l.eachPosition(Q,(U,Y,te)=>{const oe=h.feature(U);$.updatePaintArray(Y,te,oe,ee,p,x,T,I)})}C=!0}}return C}defines(){const e=[];for(const i in this.binders){const l=this.binders[i];(l instanceof Wh||l instanceof xc)&&e.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof ia||l instanceof lo||l instanceof Yr)for(let h=0;h<l.paintVertexAttributes.length;h++)e.push(l.paintVertexAttributes[h].name);if(l instanceof Yr)for(let h=0;h<Up.members.length;h++)e.push(Up.members[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const l=this.binders[i];if(l instanceof Wh||l instanceof xc||l instanceof lo)for(const h of l.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const l in this.binders){const h=this.binders[l];if(h instanceof Wh||h instanceof xc||h instanceof lo)for(const f of h.uniformNames)i.push({name:f,property:l,binding:h.getBinding(e,f)})}return i}setUniforms(e,i,l,h,f){for(const{name:p,property:x,binding:w}of l)this.binders[x].setUniform(e,w,f,h.get(x),p)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof ia||i instanceof lo||i instanceof Yr)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof Yr&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const l=this.binders[i];(l instanceof ia||l instanceof lo||l instanceof Yr)&&l.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof ia||i instanceof lo||i instanceof Yr)&&i.destroy()}}}class u{constructor(e,i,l=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new vc(h,i,l);this.needsUpload=!1,this._featureMap=new jh,this._featureMapWithoutIds=new jh,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,l,h,f,p,x,w,T){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,h,f,p,x,w,T);i.id!==void 0?this._featureMap.add(i.id,l,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,l,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,l,h,f,p,x,w){for(const T of l)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,T,h,f,p,x||0,w)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const t={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function o(r,e){return t[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const d={"line-pattern":{source:Ca,composite:Ca},"fill-pattern":{source:Ca,composite:Ca},"fill-extrusion-pattern":{source:Ca,composite:Ca},"line-dasharray":{source:kh,composite:kh}},_={color:{source:vl,composite:$s},number:{source:Ia,composite:vl}};function y(r,e,i){const l=d[r];return l&&l[i]||_[e][i]}Ct(Wh,"ConstantBinder"),Ct(xc,"PatternConstantBinder"),Ct(ia,"SourceExpressionBinder"),Ct(Yr,"PatternCompositeBinder"),Ct(lo,"CompositeExpressionBinder"),Ct(vc,"ProgramConfiguration",{omit:["_buffers"]}),Ct(u,"ProgramConfigurationSet");const v=yt/Math.PI/2,S=5,A=6,P=16383,D=64,k=[D,32,16],z=-v,F=v;function G(r,e,i,l=v){return i=Yi(i),[r*Math.sin(i)*l,-e*l,r*Math.cos(i)*l]}function j(r,e,i){return G(Math.cos(Yi(r)),Math.sin(Yi(r)),e,i)}const H=63710088e-1,Z=2*Math.PI*H;class K{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new K(ke(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,l=this.lat*i,h=e.lat*i,f=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return H*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,l=i/Math.cos(Math.PI/180*this.lat);return new re({lng:this.lng-l,lat:this.lat-i},{lng:this.lng+l,lat:this.lat+i})}toEcef(e){return j(this.lat,this.lng,v+e*v/H)}static convert(e){if(e instanceof K)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new K(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new K(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class re{constructor(e,i){if(e)if(i)this.setSouthWest(e).setNorthEast(i);else if(e.length===4){const l=e;this.setSouthWest([l[0],l[1]]).setNorthEast([l[2],l[3]])}else{const l=e;this.setSouthWest(l[0]).setNorthEast(l[1])}}setNorthEast(e){return this._ne=e instanceof K?new K(e.lng,e.lat):K.convert(e),this}setSouthWest(e){return this._sw=e instanceof K?new K(e.lng,e.lat):K.convert(e),this}extend(e){const i=this._sw,l=this._ne;let h,f;if(e instanceof K)h=e,f=e;else{if(!(e instanceof re))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(re.convert(e)):this.extend(K.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(K.convert(e)):this;if(h=e._sw,f=e._ne,!h||!f)return this}return i||l?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),l.lng=Math.max(f.lng,l.lng),l.lat=Math.max(f.lat,l.lat)):(this._sw=new K(h.lng,h.lat),this._ne=new K(f.lng,f.lat)),this}getCenter(){return new K((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new K(this.getWest(),this.getNorth())}getSouthEast(){return new K(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:l}=K.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(e){if(e)return e instanceof re?e:new re(e)}}const ce=0,me=25.5;function fe(r){return Z*Math.cos(r*Math.PI/180)}function ue(r){return(180+r)/360}function he(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function _e(r,e){return r/fe(e)}function ye(r){return 360*r-180}function Le(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function ze(r,e){return r*fe(Le(e))}const qe=85.051129;function Xe(r){return Math.cos(Yi(de(r,-85.051129,qe)))}function st(r,e){const i=de(e,ce,me),l=Math.pow(2,i);return Xe(r)*Z/(512*l)}function De(r){return 1/Math.cos(r*Math.PI/180)}function je(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/yt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/yt/(1<<r.z)}class Te{constructor(e,i,l=0){this.x=+e,this.y=+i,this.z=+l}static fromLngLat(e,i=0){const l=K.convert(e);return new Te(ue(l.lng),he(l.lat),_e(i,l.lat))}toLngLat(){return new K(ye(this.x),Le(this.y))}toAltitude(){return ze(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Z*De(Le(this.y))}}function Ke(r,e,i,l,h,f,p,x,w){const T=(e+l)/2,I=(i+h)/2,C=new _t(T,I);x(C),function(M,L,O,V,$,W){const Q=O-$,ee=V-W;return Math.abs((V-L)*Q-(O-M)*ee)/Math.hypot(Q,ee)}(C.x,C.y,f.x,f.y,p.x,p.y)>=w?(Ke(r,e,i,T,I,f,C,x,w),Ke(r,T,I,l,h,C,p,x,w)):r.push(p)}function Be(r,e,i){let l=r[0],h=l.x,f=l.y;e(l);const p=[l];for(let x=1;x<r.length;x++){const w=r[x],{x:T,y:I}=w;e(w),Ke(p,h,f,T,I,l,w,e,i),h=T,f=I,l=w}return p}function it(r,e,i,l){if(l(e,i)){const h=e.add(i)._mult(.5);it(r,e,h,l),it(r,h,i,l)}else r.push(i)}function ft(r,e){let i=r[0];const l=[i];for(let h=1;h<r.length;h++){const f=r[h];it(l,i,f,e),i=f}return l}const Ye=Math.pow(2,14)-1,ut=-Ye-1;function Mt(r,e){const i=Math.round(r.x*e),l=Math.round(r.y*e);return r.x=de(i,ut,Ye),r.y=de(l,ut,Ye),(i<r.x||i>r.x+1||l<r.y||l>r.y+1)&&Si("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Pt(r,e,i){const l=r.loadGeometry(),h=r.extent,f=yt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const p=1<<e.z,{scale:x,x:w,y:T,projection:I}=i,C=M=>{const L=ye((e.x+M.x/h)/p),O=Le((e.y+M.y/h)/p),V=I.project(L,O);M.x=(V.x*x-w)*h,M.y=(V.y*x-T)*h};for(let M=0;M<l.length;M++)if(r.type!==1)l[M]=Be(l[M],C,1);else{const L=[];for(const O of l[M])O.x<0||O.x>=h||O.y<0||O.y>=h||(C(O),L.push(O));l[M]=L}}for(const p of l)for(const x of p)Mt(x,f);return l}function Et(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Pt(r):[]}}var Ut,qt,ei,ai,Ei,an,In,un={};function mn(){if(qt)return Ut;qt=1;var r=Ka();function e(h,f,p,x,w){this.properties={},this.extent=p,this.type=0,this._pbf=h,this._geometry=-1,this._keys=x,this._values=w,h.readFields(i,this,f)}function i(h,f,p){h==1?f.id=p.readVarint():h==2?function(x,w){for(var T=x.readVarint()+x.pos;x.pos<T;){var I=w._keys[x.readVarint()],C=w._values[x.readVarint()];w.properties[I]=C}}(p,f):h==3?f.type=p.readVarint():h==4&&(f._geometry=p.pos)}function l(h){for(var f,p,x=0,w=0,T=h.length,I=T-1;w<T;I=w++)x+=((p=h[I]).x-(f=h[w]).x)*(f.y+p.y);return x}return Ut=e,e.types=["Unknown","Point","LineString","Polygon"],e.prototype.loadGeometry=function(){var h=this._pbf;h.pos=this._geometry;for(var f,p=h.readVarint()+h.pos,x=1,w=0,T=0,I=0,C=[];h.pos<p;){if(w<=0){var M=h.readVarint();x=7&M,w=M>>3}if(w--,x===1||x===2)T+=h.readSVarint(),I+=h.readSVarint(),x===1&&(f&&C.push(f),f=[]),f.push(new r(T,I));else{if(x!==7)throw new Error("unknown command "+x);f&&f.push(f[0].clone())}}return f&&C.push(f),C},e.prototype.bbox=function(){var h=this._pbf;h.pos=this._geometry;for(var f=h.readVarint()+h.pos,p=1,x=0,w=0,T=0,I=1/0,C=-1/0,M=1/0,L=-1/0;h.pos<f;){if(x<=0){var O=h.readVarint();p=7&O,x=O>>3}if(x--,p===1||p===2)(w+=h.readSVarint())<I&&(I=w),w>C&&(C=w),(T+=h.readSVarint())<M&&(M=T),T>L&&(L=T);else if(p!==7)throw new Error("unknown command "+p)}return[I,M,C,L]},e.prototype.toGeoJSON=function(h,f,p){var x,w,T=this.extent*Math.pow(2,p),I=this.extent*h,C=this.extent*f,M=this.loadGeometry(),L=e.types[this.type];function O(W){for(var Q=0;Q<W.length;Q++){var ee=W[Q];W[Q]=[360*(ee.x+I)/T-180,360/Math.PI*Math.atan(Math.exp((180-360*(ee.y+C)/T)*Math.PI/180))-90]}}switch(this.type){case 1:var V=[];for(x=0;x<M.length;x++)V[x]=M[x][0];O(M=V);break;case 2:for(x=0;x<M.length;x++)O(M[x]);break;case 3:for(M=function(W){var Q=W.length;if(Q<=1)return[W];for(var ee,U,Y=[],te=0;te<Q;te++){var oe=l(W[te]);oe!==0&&(U===void 0&&(U=oe<0),U===oe<0?(ee&&Y.push(ee),ee=[W[te]]):ee.push(W[te]))}return ee&&Y.push(ee),Y}(M),x=0;x<M.length;x++)for(w=0;w<M[x].length;w++)O(M[x][w])}M.length===1?M=M[0]:L="Multi"+L;var $={type:"Feature",geometry:{type:L,coordinates:M},properties:this.properties};return"id"in this&&($.id=this.id),$},Ut}function os(){if(ai)return ei;ai=1;var r=mn();function e(l,h){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(i,this,h),this.length=this._features.length}function i(l,h,f){l===15?h.version=f.readVarint():l===1?h.name=f.readString():l===5?h.extent=f.readVarint():l===2?h._features.push(f.pos):l===3?h._keys.push(f.readString()):l===4&&h._values.push(function(p){for(var x=null,w=p.readVarint()+p.pos;p.pos<w;){var T=p.readVarint()>>3;x=T===1?p.readString():T===2?p.readFloat():T===3?p.readDouble():T===4?p.readVarint64():T===5?p.readVarint():T===6?p.readSVarint():T===7?p.readBoolean():null}return x}(f))}return ei=e,e.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var h=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,h,this.extent,this._keys,this._values)},ei}function vi(){return In||(In=1,un.VectorTile=function(){if(an)return Ei;an=1;var r=os();function e(i,l,h){if(i===3){var f=new r(h,h.readVarint()+h.pos);f.length&&(l[f.name]=f)}}return Ei=function(i,l){this.layers=i.readFields(e,{},l)},Ei}(),un.VectorTileFeature=mn(),un.VectorTileLayer=os()),un}var Mi=vi();const Oi="3d_elevation_id",Rn="level";class _s{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,l){return this.get(e,!0,i,l)}optional(e,i,l){return this.get(e,!1,i,l)}success(){return this._valid}get(e,i,l,h){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?l(h?h(f):f):i&&(this._valid=!1),this}}class Cn{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,l){return this.featureFunc(e,i,l)}parseVertex(e,i,l){return this.vertexFunc(e,i,l)}}const Qi=new Cn((r,e,i)=>r.reset(e).require(Oi,l=>{i.id=l}).optional("fixed_height_relative",l=>{i.constantHeight=l},$i.decodeRelativeHeight).geometry(l=>{i.bounds=l},Kf).success(),(r,e,i)=>r.reset(e).require(Oi,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height_relative",l=>{i.height=l},$i.decodeRelativeHeight).geometry(l=>{i.position=l},$i.getPoint).success()),Jn=new Cn((r,e,i)=>r.reset(e).require(Oi,l=>{i.id=l}).optional("fixed_height",l=>{i.constantHeight=l},$i.decodeMetricHeight).geometry(l=>{i.bounds=l},Kf).success(),(r,e,i)=>r.reset(e).require(Oi,l=>{i.id=l}).require("elevation_idx",l=>{i.idx=l}).require("extent",l=>{i.extent=l}).require("height",l=>{i.height=l},$i.decodeMetricHeight).geometry(l=>{i.position=l},$i.getPoint).success());class $i{static getPoint(e){return vs(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static parse(e){const i=[],l=[],h=e.length,f=new _s;for(let x=0;x<h;x++){const w=e.feature(x),T=w.properties.hasOwnProperty("version")?String(w.properties.version):void 0,I=(p=T)?p==="1.0.1"?Jn:void 0:Qi;if(I===void 0){Si(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const C=w.properties.hasOwnProperty("type")?w.properties.type:void 0;if(C){if(Mi.VectorTileFeature.types[w.type]==="Point"&&C==="curve_point"){const M={};I.parseVertex(f,w,M)&&i.push(M)}else if(Mi.VectorTileFeature.types[w.type]==="Polygon"&&C==="curve_meta"){const M={};I.parseFeature(f,w,M)&&l.push(M)}}}var p;return{vertices:i,features:l}}}class ds{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const h=An(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,!0}}class Ln{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,l){const h=en(i,this.dir);if(Math.abs(h)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return l[0]=this.pos[0]+this.dir[0]*f,l[1]=this.pos[1]+this.dir[1]*f,l[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,l){if(function(L,O){var V=L[0],$=L[1],W=L[2],Q=O[0],ee=O[1],U=O[2];return Math.abs(V-Q)<=R*Math.max(1,Math.abs(V),Math.abs(Q))&&Math.abs($-ee)<=R*Math.max(1,Math.abs($),Math.abs(ee))&&Math.abs(W-U)<=R*Math.max(1,Math.abs(W),Math.abs(U))}(this.pos,e)||i===0)return l[0]=l[1]=l[2]=0,!1;const[h,f,p]=this.dir,x=this.pos[0]-e[0],w=this.pos[1]-e[1],T=this.pos[2]-e[2],I=h*h+f*f+p*p,C=2*(x*h+w*f+T*p),M=C*C-4*I*(x*x+w*w+T*T-i*i);if(M<0){const L=Math.max(-C/2,0),O=x+h*L,V=w+f*L,$=T+p*L,W=Math.hypot(O,V,$);return l[0]=O*i/W,l[1]=V*i/W,l[2]=$*i/W,!1}{const L=(-C-Math.sqrt(M))/(2*I);if(L<0){const O=Math.hypot(x,w,T);return l[0]=x*i/O,l[1]=w*i/O,l[2]=T*i/O,!1}return l[0]=x+h*L,l[1]=w+f*L,l[2]=T+p*L,!0}}}class Tn{constructor(e,i,l,h,f){this.TL=e,this.TR=i,this.BR=l,this.BL=h,this.horizon=f}static fromInvProjectionMatrix(e,i,l){const h=[-1,1,1],f=[1,1,1],p=[1,-1,1],x=[-1,-1,1],w=fn(h,h,e),T=fn(f,f,e),I=fn(p,p,e),C=fn(x,x,e);return new Tn(w,T,I,C,i/l)}}function zn(r,e,i){let l=1/0,h=-1/0;const f=[];for(const p of r){Ce(f,p,e);const x=en(f,i);l=Math.min(l,x),h=Math.max(h,x)}return[l,h]}function nn(r,e){let i=!0;for(let l=0;l<r.planes.length;l++){const h=r.planes[l];let f=0;for(let p=0;p<e.length;p++)f+=en(h,e[p])+h[3]>=0;if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function is(r,e){for(const i of r.projections){const l=zn(e,r.points[0],i.axis);if(i.projection[1]<l[0]||i.projection[0]>l[1])return 0}return 1}function Hs(r,e){let i=0;const l=[0,0,0,0];for(let p=0;p<r.length;p++)l[0]=r[p][0],l[1]=r[p][1],l[2]=r[p][2],l[3]=1,(h=l)[0]*(f=e)[0]+h[1]*f[1]+h[2]*f[2]+h[3]*f[3]>=0&&i++;var h,f;return i}class Vn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ki.fromPoints(this.points),this.projections=[],this.frustumEdges=[Ce([],this.points[2],this.points[3]),Ce([],this.points[0],this.points[3]),Ce([],this.points[4],this.points[0]),Ce([],this.points[5],this.points[1]),Ce([],this.points[6],this.points[2]),Ce([],this.points[7],this.points[3])];for(const l of this.frustumEdges){const h=[0,-l[2],l[1]],f=[l[2],0,-l[0]];this.projections.push({axis:h,projection:zn(this.points,this.points[0],h)}),this.projections.push({axis:f,projection:zn(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,l,h){const f=Math.pow(2,l),p=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const I=Qt([],T,e),C=1/I[3]/i*f;return(M=I)[0]=(L=I)[0]*(O=[C,C,h?1/I[3]:C,C])[0],M[1]=L[1]*O[1],M[2]=L[2]*O[2],M[3]=L[3]*O[3],M;var M,L,O}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const I=Zi([],es([],Ce([],p[T[0]],p[T[1]]),Ce([],p[T[2]],p[T[1]]))),C=-en(I,p[T[1]]);return I.concat(C)}),w=[];for(let T=0;T<p.length;T++)w.push([p[T][0],p[T][1],p[T][2]]);return new Vn(w,x)}intersectsPrecise(e,i,l){for(let h=0;h<i.length;h++)if(!Hs(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Hs(e,this.planes[h]))return 0;for(const h of l)for(const f of this.frustumEdges){const p=es([],h,f),x=gi(p);if(x===0)continue;Ui(p,p,1/x);const w=zn(this.points,this.points[0],p),T=zn(e,this.points[0],p);if(w[0]>T[1]||T[0]>w[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const l=i[3];if(en([i[0],i[1],i[2]],e)+l<0)return!1}return!0}}class Ki{static fromPoints(e){const i=[1/0,1/0,1/0],l=[-1/0,-1/0,-1/0];for(const h of e)hi(i,i,h),sn(l,l,h);return new Ki(i,l)}static fromTileIdAndHeight(e,i,l){const h=1<<e.canonical.z,f=e.canonical.x,p=e.canonical.y;return new Ki([f/h,p/h,i],[(f+1)/h,(p+1)/h,l])}static applyTransform(e,i){const l=e.getCorners();for(let h=0;h<l.length;++h)fn(l[h],l[h],i);return Ki.fromPoints(l)}static applyTransformFast(e,i){const l=[i[12],i[13],i[14]],h=[...l];for(let f=0;f<3;f++)for(let p=0;p<3;p++){const x=i[4*p+f],w=x*e.min[p],T=x*e.max[p];l[f]+=Math.min(w,T),h[f]+=Math.max(w,T)}return new Ki(l,h)}static projectAabbCorners(e,i){const l=e.getCorners();for(let h=0;h<l.length;++h)fn(l[h],l[h],i);return l}constructor(e,i){this.min=e,this.max=i,this.center=Ui([],yi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],l=pi(this.min),h=pi(this.max);for(let f=0;f<i.length;f++)l[f]=i[f]?this.min[f]:this.center[f],h[f]=i[f]?this.center[f]:this.max[f];return h[2]=this.max[2],new Ki(l,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?nn(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?nn(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?is(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?is(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ct(Ki,"Aabb");class Ir{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,l=i[1],h=-i[0],f=(e.extent+1)*this.metersToTile;return[new _t(Math.trunc(e.position[0]+l*f),Math.trunc(e.position[1]+h*f)),new _t(Math.trunc(e.position[0]-l*f),Math.trunc(e.position[1]-h*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class yr{constructor(e,i,l,h,f,p){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=e,this.heightRange={min:l,max:l},this.safeArea=i,this.constantHeight=l,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=f,this.edges=this.edges.filter(x=>{return x.a<this.vertices.length&&x.b<this.vertices.length&&!((w=this.vertices[x.a].position)[0]===(T=this.vertices[x.b].position)[0]&&w[1]===T[1]);var w,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const x of this.vertices)this.vertexProps.push({dir:vs(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,x.height),this.heightRange.max=Math.max(this.heightRange.max,x.height);for(const x of this.edges){const w=this.vertices[x.a].position,T=this.vertices[x.b].position,I=wr(Hn(),T,w),C=Ds(I),M=wo(Hn(),I,1/C);this.edgeProps.push({vec:I,dir:M,len:C});const L=this.vertexProps[x.a].dir,O=this.vertexProps[x.b].dir;Os(L,L,M),Os(O,O,M)}for(const x of this.vertexProps)x.dir[0]===0&&x.dir[1]===0||Qs(x.dir,x.dir);this.tessellate(p)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[l,h]=i;return ri(this.vertices[this.edges[l].a].height,this.vertices[this.edges[l].b].height,h)}computeSlopeNormal(e,i){const l=this.getClosestEdge(e);if(!l)return _i(0,0,1);const h=l[0],f=this.edges[h],p=this.edgeProps[h].vec,x=_i(p[0],p[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),w=_i(x[1],-x[0],0);es(w,w,x);const T=gi(w);return T>0?Ui(w,w,1/T):_i(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,l=Number.POSITIVE_INFINITY,h=0;const f=vs(e.x,e.y);for(let p=0;p<this.edges.length;p++){const x=this.edges[p],w=this.edgeProps[p].dir,T=new ds(f,this.edgeProps[p].dir),I=this.vertices[x.a].position,C=this.vertices[x.b].position,M=Hn(),L=Hn(),O=T.intersectsPlane(I,this.vertexProps[x.a].dir,M),V=T.intersectsPlane(C,this.vertexProps[x.b].dir,L);if(!O||!V)continue;const $=wr(Hn(),L,M),W=wr(Hn(),f,M),Q=An($,$),ee=Q>0?An(W,$)/Q:0,U=de(ee,0,1),Y=Math.abs((ee-U)*this.edgeProps[p].len),te=wr(Hn(),f,I),oe=Y+Math.abs(An(te,vs(w[1],-w[0])));oe<l&&(i=p,l=oe,h=U)}return[i,h]}tessellate(e){for(let i=this.edges.length-1;i>=0;--i){const l=this.edges[i].a,h=this.edges[i].b,{position:f,height:p,extent:x}=this.vertices[l],{position:w,height:T,extent:I}=this.vertices[h],C=this.vertexProps[l].dir,M=this.vertexProps[h].dir,L=_i(f[0]/e,f[1]/e,p),O=_i(w[0]/e,w[1]/e,T),V=_i(C[1],-C[0],0);Ui(V,V,x);const $=_i(M[1],-M[0],0);if(Ui($,$,I),this.distSqLines(_i(L[0]+.5*V[0],L[1]+.5*V[1],L[2]+.5*V[2]),_i(O[0]-.5*$[0],O[1]-.5*$[1],O[2]-.5*$[2]),_i(L[0]-.5*V[0],L[1]-.5*V[1],L[2]-.5*V[2]),_i(O[0]+.5*$[0],O[1]+.5*$[1],O[2]+.5*$[2]))<=.0025000000000000005)continue;const W=this.vertices.length,Q=Os(Hn(),f,w);this.vertices.push({position:wo(Q,Q,.5),height:.5*(p+T),extent:.5*(x+I)});const ee=Os(Hn(),C,M);this.vertexProps.push({dir:Qs(ee,ee)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:l,b:W}),this.edges.push({a:W,b:h});const U=wr(Hn(),this.vertices[W].position,f),Y=Ds(U),te={vec:U,dir:wo(Hn(),U,1/Y),len:Y};this.edgeProps.push(te),this.edgeProps.push(te)}}distSqLines(e,i,l,h){const f=$t(jt(),i,e),p=$t(jt(),h,l),x=$t(jt(),e,l),w=en(f,f),T=en(f,p),I=en(f,x),C=en(p,p),M=en(p,x),L=w*C-T*T;if(L===0){const $=en(x,p)/en(p,p);return jn(xs(jt(),l,h,$),e)}const O=(T*M-I*C)/L,V=(w*M-T*I)/L;return jn(xs(jt(),e,i,O),xs(jt(),l,h,V))}}class Br{static parseFrom(e,i){const l=$i.parse(e);if(!l)return[];let{vertices:h,features:f}=l;const p=1/je(i);f.sort((I,C)=>I.id-C.id),h.sort((I,C)=>I.id-C.id||I.idx-C.idx),h=h.filter((I,C,M)=>C===M.findIndex(L=>L.id===I.id&&L.idx===I.idx));const x=new Array;let w=0;const T=h.length;for(const I of f){if(I.constantHeight){x.push(new yr(I.id,I.bounds,I.constantHeight));continue}for(;w!==T&&h[w].id<I.id;)w++;if(w===T||h[w].id!==I.id)continue;const C=new Array,M=new Array,L=w;for(;w!==T&&h[w].id===I.id;){const O=h[w];if(C.push({position:O.position,height:O.height,extent:O.extent}),w!==L&&h[w-1].idx===O.idx-1){const V=w-L;M.push({a:V-1,b:V})}w++}x.push(new yr(I.id,I.bounds,void 0,C,M,p))}return x}static getElevationFeature(e,i){if(!i)return;const l=+e.properties[Oi];return Number.isNaN(l)?void 0:i.find(h=>h.id===l)}}class co{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*yt,this.yOffset=(e.y*this.zScale-i.y)*yt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,l){const h=this.constantElevation(i,l);return h??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),l))}computeBiasedHeight(e,i){return i<=0?e:e+i*Se(0,i,e>=0?e:Math.abs(.5*e))}}Ct(yr,"ElevationFeature");class Kr{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new ea,this.indexArray=new Gs,this.segments=new ts,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ia),this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,h){const f=this.layers[0],p=[];let x=null;f.type==="circle"&&(x=f.layout.get("circle-sort-key"));for(const{feature:T,id:I,index:C,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,O=Et(T,L);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),O,l))continue;const V=x?x.evaluate(O,{},l):void 0,$={id:I,properties:T.properties,type:T.type,sourceLayerIndex:M,index:C,geometry:L?O.geometry:Pt(T,l,h),patterns:{},sortKey:V};p.push($)}x&&p.sort((T,I)=>T.sortKey-I.sortKey);let w=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new bd,w=h.projection);for(const T of p){const{geometry:I,index:C,sourceLayerIndex:M}=T,L=e[C].feature;this.addFeature(T,I,C,i.availableImages,l,w,i.brightness,i.elevationFeatures),i.featureIndex.insert(L,I,C,M,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,l,h,f,p,x){this.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zv.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ad.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Ov.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,l,h,f,p,x,w){let T;this.elevationMode!=="none"&&(T=Br.getElevationFeature(e,w));for(const I of i)for(const C of I){const M=C.x,L=C.y;if(M<0||M>=yt||L<0||L>=yt)continue;if(p){const $=p.projectTilePoint(M,L,f),W=p.upVector(f,M,L);this.addGlobeExtVertex($,W),this.addGlobeExtVertex($,W),this.addGlobeExtVertex($,W),this.addGlobeExtVertex($,W)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=O.vertexLength;if(this.addCircleVertex(M,L,-1,-1),this.addCircleVertex(M,L,1,-1),this.addCircleVertex(M,L,1,1),this.addCircleVertex(M,L,-1,1),this.elevationMode!=="none"){const $=T?T.pointElevation(new _t(M,L)):0;this.hasElevation=this.hasElevation||$!==0;for(let W=0;W<4;W++)this.elevatedLayoutVertexArray.emplaceBack($)}this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,{},h,f,x,void 0,this.worldview)}addCircleVertex(e,i,l,h){this.layoutVertexArray.emplaceBack(2*e+(l+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function xr(r,e){for(let i=0;i<r.length;i++)if(Mo(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Mo(r,e[i]))return!0;return!!qh(r,e)}function Da(r,e,i){return!!Mo(r,e)||!!Zh(e,r,i)}function ho(r,e){if(r.length===1)return Rd(e,r[0]);for(let i=0;i<e.length;i++){const l=e[i];for(let h=0;h<l.length;h++)if(Mo(r,l[h]))return!0}for(let i=0;i<r.length;i++)if(Rd(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(qh(r,e[i]))return!0;return!1}function Ra(r,e,i){if(r.length>1){if(qh(r,e))return!0;for(let l=0;l<e.length;l++)if(Zh(e[l],r,i))return!0}for(let l=0;l<r.length;l++)if(Zh(r[l],e,i))return!0;return!1}function qh(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const l=r[i],h=r[i+1];for(let f=0;f<e.length-1;f++)if(Hp(l,h,e[f],e[f+1]))return!0}return!1}function Hp(r,e,i,l){return bn(r,i,l)!==bn(e,i,l)&&bn(r,e,i)!==bn(r,e,l)}function bc(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function Wp(r,e,i,l){const h=bc(r,e,l),f=bc(r,e,i);if(Math.sign(h)===Math.sign(f))return;const p=bc(i,l,r),x=p+f-h;return Math.sign(p)!==Math.sign(x)?[p/(p-x),f/(f-h)]:void 0}function Zh(r,e,i){const l=i*i;if(e.length===1)return r.distSqr(e[0])<l;for(let h=1;h<e.length;h++)if(Dd(r,e[h-1],e[h])<l)return!0;return!1}function Dd(r,e,i){const l=e.distSqr(i);if(l===0)return r.distSqr(e);const h=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/l;return r.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Rd(r,e){let i,l,h,f=!1;for(let p=0;p<r.length;p++){i=r[p];for(let x=0,w=i.length-1;x<i.length;w=x++)l=i[x],h=i[w],l.y>e.y!=h.y>e.y&&e.x<(h.x-l.x)*(e.y-l.y)/(h.y-l.y)+l.x&&(f=!f)}return f}function Mo(r,e){let i=!1;for(let l=0,h=r.length-1;l<r.length;h=l++){const f=r[l],p=r[h];f.y>e.y!=p.y>e.y&&e.x<(p.x-f.x)*(e.y-f.y)/(p.y-f.y)+f.x&&(i=!i)}return i}function wc(r,e,i,l,h){for(const p of r)if(e<=p.x&&i<=p.y&&l>=p.x&&h>=p.y)return!0;const f=[new _t(e,i),new _t(e,h),new _t(l,h),new _t(l,i)];if(r.length>2){for(const p of f)if(Mo(r,p))return!0}for(let p=0;p<r.length-1;p++)if(bl(r[p],r[p+1],f))return!0;return!1}function bl(r,e,i){const l=i[0],h=i[2];if(r.x<l.x&&e.x<l.x||r.x>h.x&&e.x>h.x||r.y<l.y&&e.y<l.y||r.y>h.y&&e.y>h.y)return!1;const f=bn(r,e,i[0]);return f!==bn(r,e,i[1])||f!==bn(r,e,i[2])||f!==bn(r,e,i[3])}function La(r,e,i,l,h,f){let p=e.y-r.y,x=r.x-e.x;if(f=f||0){const w=p*p+x*x;if(w===0)return!0;const T=Math.sqrt(w);p/=T,x/=T}return!((i.x-r.x)*p+(i.y-r.y)*x-f<0||(l.x-r.x)*p+(l.y-r.y)*x-f<0||(h.x-r.x)*p+(h.y-r.y)*x-f<0)}function Fv(r,e,i,l,h,f,p){return!(La(r,e,l,h,f,p)||La(e,i,l,h,f,p)||La(i,r,l,h,f,p)||La(l,h,r,e,i,p)||La(h,f,r,e,i,p)||La(f,l,r,e,i,p))}function Ld(r,e,i){const l=e.paint.get(r).value;return l.kind==="constant"?l.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Pg(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function fw(r,e,i,l,h){if(!e[0]&&!e[1])return r;const f=_t.convert(e)._mult(h);i==="viewport"&&f._rotate(-l);const p=[];for(let x=0;x<r.length;x++)p.push(r[x].sub(f));return p}function pw(r,e,i,l){const h=_t.convert(r)._mult(l);return e==="viewport"&&h._rotate(-i),h}let mw,_w;function gw(r,e,i){var l=2*Math.PI*6378137/256/Math.pow(2,i);return[r*l-2*Math.PI*6378137/2,e*l-2*Math.PI*6378137/2]}Ct(Kr,"CircleBucket",{omit:["layers"]});class Xh{constructor(e,i,l){this.z=e,this.x=i,this.y=l,this.key=zd(0,e,e,i,l)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const l=function(f,p,x){var w=gw(256*f,256*(p=Math.pow(2,x)-p-1),x),T=gw(256*(f+1),256*(p+1),x);return w[0]+","+w[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),h=function(f,p,x){let w,T="";for(let I=f;I>0;I--)w=1<<I-1,T+=(p&w?1:0)+(x&w?2:0);return T}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yw{constructor(e,i){this.wrap=e,this.canonical=i,this.key=zd(e,i.z,i.z,i.x,i.y)}}class hr{constructor(e,i,l,h,f){this.overscaledZ=e,this.wrap=i,this.canonical=new Xh(l,+h,+f),this.key=i===0&&e===l?this.canonical.key:zd(i,e,l,h,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new hr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return zd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-e;return zd(this.wrap*+i,e,e,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new hr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new hr(i,this.wrap,i,l,h),new hr(i,this.wrap,i,l+1,h),new hr(i,this.wrap,i,l,h+1),new hr(i,this.wrap,i,l+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yw(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function zd(r,e,i,l,h){const f=1<<Math.min(i,22);let p=f*(h%f)+l%f;return r&&i<22&&(p+=f*f*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*p+i)+(e-i)}const QP=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new hr(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new hr(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new hr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new hr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Ct(Xh,"CanonicalTileID"),Ct(hr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const eD=Xi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Dg}=eD,tD=Xi([{name:"a_pos_3",components:3,type:"Int16"}]);var xw=Xi([{name:"a_pos",type:"Int16",components:2}]);function Rg(r){return r*v/H}const iD=[new Ki([z,z,z],[F,F,F]),new Ki([z,z,z],[0,0,F]),new Ki([0,z,z],[F,0,F]),new Ki([z,0,z],[0,F,F]),new Ki([0,0,z],[F,F,F])];function vw(r,e,i,l=!0){const h=Ui([],r._camera.position,r.worldSize),f=[e,i,1,1];Qt(f,f,r.pixelMatrixInverse),zt(f,f,1/f[3]);const p=Zi([],Ce([],f,h)),x=r.globeMatrix,w=[x[12],x[13],x[14]],T=Ce([],w,h),I=gi(T),C=Zi([],T),M=r.worldSize/(2*Math.PI),L=en(C,p),O=Math.asin(M/I);if(O<Math.acos(L)){if(!l)return null;const be=[],Me=[];Ui(be,p,I/L),Zi(Me,Ce(Me,be,T)),Zi(p,yi(p,T,Ui(p,Me,Math.tan(O)*I)))}const V=[];new Ln(h,p).closestPointOnSphere(w,M,V);const $=Zi([],Yn(x,0)),W=Zi([],Yn(x,1)),Q=Zi([],Yn(x,2)),ee=en($,V),U=en(W,V),Y=en(Q,V),te=Ne(Math.asin(-U/M));let oe=Ne(Math.atan2(ee,Y));oe=r.center.lng+function(be,Me){const $e=(Me-be+180)%360-180;return $e<-180?$e+360:$e}(r.center.lng,oe);const ve=ue(oe),ge=de(he(te),0,1);return new Te(ve,ge)}class nD{constructor(e,i,l){this.a=Ce([],e,l),this.b=Ce([],i,l),this.center=l;const h=Zi([],this.a),f=Zi([],this.b);this.angle=Math.acos(en(h,f))}}function Bv(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(l,h,f,p){const x=Math.sin(f);return l*(Math.sin((1-p)*f)/x)+h*(Math.sin(p*f)/x)}(r.a[e],r.b[e],r.angle,de(i,0,1))+r.center[e]}function za(r){if(r.z<=1)return iD[r.z+2*r.y+r.x];const e=Nv(Lg(r));return Ki.fromPoints(e)}function wl(r,e,i){return Ui(r,r,1-i),ss(r,r,e,i)}function bw(r,e,i){for(const l of r)fn(l,l,e),Ui(l,l,i)}function ww(r,e,i,l){const h=e/r.worldSize,f=r.globeMatrix;if(i.z<=1){const ge=za(i).getCorners();return bw(ge,f,h),Ki.fromPoints(ge)}const p=Lg(i,l),x=Nv(p,v+Rg(r._tileCoverLift));bw(x,f,h);const w=Number.MAX_VALUE,T=[-w,-w,-w],I=[w,w,w];if(p.contains(r.center)){for(const Me of x)hi(I,I,Me),sn(T,T,Me);T[2]=0;const ge=r.point,be=[ge.x*h,ge.y*h,0];return hi(I,I,be),sn(T,T,be),new Ki(I,T)}if(r._tileCoverLift>0){for(const ge of x)hi(I,I,ge),sn(T,T,ge);return new Ki(I,T)}const C=[f[12]*h,f[13]*h,f[14]*h],M=p.getCenter(),L=de(r.center.lat,-85.051129,qe),O=de(M.lat,-85.051129,qe),V=ue(r.center.lng),$=he(L);let W=V-ue(M.lng);const Q=$-he(O);W>.5?W-=1:W<-.5&&(W+=1);let ee=0;Math.abs(W)>Math.abs(Q)?ee=W>=0?1:3:(ee=Q>=0?0:2,ss(C,C,[f[4]*h,f[5]*h,f[6]*h],-Math.sin(Yi(Q>=0?p.getSouth():p.getNorth()))*v));const U=x[ee],Y=x[(ee+1)%4],te=new nD(U,Y,C),oe=[Bv(te,0)||U[0],Bv(te,1)||U[1],Bv(te,2)||U[2]],ve=Tc(r.zoom);if(ve>0){const ge=function({x:Me,y:$e,z:ot},Qe,rt,at,He){const nt=1/(1<<ot);let Ue=Me*nt,Ge=Ue+nt,ht=$e*nt,dt=ht+nt,Yt=0;const Ot=(Ue+Ge)/2-at;return Ot>.5?Yt=-1:Ot<-.5&&(Yt=1),Ue=((Ue+Yt)*Qe-(at*=Qe))*rt+at,Ge=((Ge+Yt)*Qe-at)*rt+at,ht=(ht*Qe-(He*=Qe))*rt+He,dt=(dt*Qe-He)*rt+He,[[Ue,dt,0],[Ge,dt,0],[Ge,ht,0],[Ue,ht,0]]}(i,e,r._pixelsPerMercatorPixel,V,$);for(let Me=0;Me<x.length;Me++)wl(x[Me],ge[Me],ve);const be=yi([],ge[ee],ge[(ee+1)%4]);Ui(be,be,.5),wl(oe,be,ve)}for(const ge of x)hi(I,I,ge),sn(T,T,ge);return I[2]=Math.min(U[2],Y[2]),hi(I,I,oe),sn(T,T,oe),new Ki(I,T)}function Lg({x:r,y:e,z:i},l=!1){const h=1/(1<<i),f=new K(ye(r*h),e===(1<<i)-1&&l?-90:Le((e+1)*h)),p=new K(ye((r+1)*h),e===0&&l?90:Le(e*h));return new re(f,p)}function Nv(r,e=v){const i=Yi(r.getNorth()),l=Yi(r.getSouth()),h=Math.cos(i),f=Math.cos(l),p=Math.sin(i),x=Math.sin(l),w=r.getWest(),T=r.getEast();return[G(f,x,w,e),G(f,x,T,e),G(h,p,T,e),G(h,p,w,e)]}function qp(r,e,i,l){const h=1<<i.z,f=(r/yt+i.x)/h;return j(Le((e/yt+i.y)/h),ye(f),l)}function zg({min:r,max:e}){return P/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const Tw=new Float64Array(16);function Og(r){const e=zg(r),i=Tt(Tw,[e,e,e]);return Je(i,i,Is([],r.min))}function Vv(r){const e=(l=r.min,(i=Tw)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=l[0],i[13]=l[1],i[14]=l[2],i[15]=1,i);var i,l;const h=1/zg(r);return Pe(e,e,[h,h,h])}function Uv(r){const e=yt/(2*Math.PI);return r/(2*Math.PI)/e}function Sw(r,e){return yt/(512*Math.pow(2,r))*zg(za(e))}function Ew(r,e,i,l,h){const f=Uv(i),p=[r,e,-i/(2*Math.PI)],x=pe(new Float64Array(16));return Je(x,x,p),Pe(x,x,[f,f,f]),Oe(x,x,Yi(-h)),tt(x,x,Yi(-l)),x}function Tc(r){return Se(S,A,r)}function Aw(r,e){const i=j(e.lat,e.lng),l=function(O){const V=j(O._center.lat,O._center.lng);let $=es([],_i(0,1,0),V);const W=At([],-O.angle,V);$=fn($,$,W),At(W,-O._pitch,$);const Q=Zi([],V);return Ui(Q,Q,Rg(O.cameraToCenterDistance/O.pixelsPerMeter)),fn(Q,Q,W),yi([],V,Q)}(r);return p=(h=$t([],l,i))[0],x=h[1],w=h[2],T=(f=i)[0],I=f[1],C=f[2],L=(M=Math.sqrt(p*p+x*x+w*w)*Math.sqrt(T*T+I*I+C*C))&&en(h,f)/M,Math.acos(Math.min(Math.max(L,-1),1));var h,f,p,x,w,T,I,C,M,L}function jv(r,e){return Aw(r,e)>Math.PI/2*1.01}const Iw=Yi(85),sD=Math.cos(Iw),rD=Math.sin(Iw),oD=we(),Cw=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Mw(r,e,i,l,h,f,p,x,w){if(f&&r.queryGeometry.isAboveHorizon)return!1;f&&(w*=r.pixelToTileUnitsFactor);const T=r.tileID.canonical,I=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const M of C){const L=M.add(x),O=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(L.x,L.y,!0):0,V=i.projection.projectTilePoint(L.x,L.y,T);if(O>0){const ee=i.projection.upVector(T,L.x,L.y);V.x+=ee[0]*I*O,V.y+=ee[1]*I*O,V.z+=ee[2]*I*O}const $=f?L:aD(V.x,V.y,V.z,l),W=f?r.tilespaceRays.map(ee=>cD(ee,O)):r.queryGeometry.screenGeometry,Q=Qt([],[V.x,V.y,V.z,1],l);if(!p&&f?w*=Q[3]/i.cameraToCenterDistance:p&&!f&&(w*=i.cameraToCenterDistance/Q[3]),f){const ee=Le((M.y/yt+T.y)/(1<<T.z));w/=i.projection.pixelsPerMeter(ee,1)/_e(1,ee)}if(Da(W,$,w))return!0}return!1}function aD(r,e,i,l){const h=Qt([],[r,e,i,1],l);return new _t(h[0]/h[3],h[1]/h[3])}const Pw=_i(0,0,0),lD=_i(0,0,1);function cD(r,e){const i=jt();return Pw[2]=e,r.intersectsPlane(Pw,lD,i),new _t(i[0],i[1])}class Dw extends Kr{}let Rw,Lw,zw,Ow;function kw(r,{width:e,height:i},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*l);return r.width=e,r.height=i,r.data=h,r}function Fw(r,e,i){const{width:l,height:h}=e;l===r.width&&h===r.height||($v(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,l),height:Math.min(r.height,h)},i,null),r.width=l,r.height=h,r.data=e.data)}function $v(r,e,i,l,h,f,p,x){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||l.x>e.width-h.width||l.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const w=r.data,T=e.data,I=f===4&&x;for(let C=0;C<h.height;C++){const M=((i.y+C)*r.width+i.x)*f,L=((l.y+C)*e.width+l.x)*f;if(I)for(let O=0;O<h.width;O++){const V=M+O*f+3,$=L+O*f;T[$+0]=255,T[$+1]=255,T[$+2]=255,T[$+3]=w[V]}else if(p)for(let O=0;O<h.width;O++){const V=M+O*f,$=L+O*f,W=new rn(w[V+0]/255,w[V+1]/255,w[V+2]/255,w[V+3]).toNonPremultipliedRenderColor(p).toArray();T[$+0]=W[0],T[$+1]=W[1],T[$+2]=W[2],T[$+3]=W[3]}else for(let O=0;O<h.width*f;O++)T[L+O]=w[M+O]}return e}Ct(Dw,"HeatmapBucket",{omit:["layers"]});class Sc{constructor(e,i){kw(this,e,1,i)}resize(e){Fw(this,new Sc(e),1)}clone(){return new Sc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,f){$v(e,i,l,h,f,1,null)}}class Zs{constructor(e,i){kw(this,e,4,i)}resize(e){Fw(this,new Zs(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Zs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,l,h,f,p,x){$v(e,i,l,h,f,4,p,x)}}class Bw{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Zp(r){const e={},i=r.resolution||256,l=r.clips?r.clips.length:1,h=r.image||new Zs({width:i,height:l}),f=(p,x,w)=>{e[r.evaluationKey]=w;const T=r.expression.evaluate(e),I=T?T.toNonPremultipliedRenderColor(null):null;I&&(h.data[p+x+0]=Math.floor(255*I.r),h.data[p+x+1]=Math.floor(255*I.g),h.data[p+x+2]=Math.floor(255*I.b),h.data[p+x+3]=Math.floor(255*I.a))};if(r.clips)for(let p=0,x=0;p<l;++p,x+=4*i)for(let w=0,T=0;w<i;w++,T+=4){const I=w/(i-1),{start:C,end:M}=r.clips[p];f(x,T,C*(1-I)+M*I)}else for(let p=0,x=0;p<i;p++,x+=4)f(0,x,p/(i-1));return h}Ct(Sc,"AlphaImage"),Ct(Zs,"RGBAImage");const hD=Xi([{name:"a_pos",components:2,type:"Int16"}],4),uD=Xi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),dD=Xi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),fD=Xi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Xp(r,e,i=2){const l=e&&e.length,h=l?e[0]*i:r.length;let f=Nw(r,0,h,i,!0);const p=[];if(!f||f.next===f.prev)return p;let x,w,T;if(l&&(f=function(I,C,M,L){const O=[];for(let V=0,$=C.length;V<$;V++){const W=Nw(I,C[V]*L,V<$-1?C[V+1]*L:I.length,L,!1);W===W.next&&(W.steiner=!0),O.push(bD(W))}O.sort(yD);for(let V=0;V<O.length;V++)M=xD(O[V],M);return M}(r,e,f,i)),r.length>80*i){x=1/0,w=1/0;let I=-1/0,C=-1/0;for(let M=i;M<h;M+=i){const L=r[M],O=r[M+1];L<x&&(x=L),O<w&&(w=O),L>I&&(I=L),O>C&&(C=O)}T=Math.max(I-x,C-w),T=T!==0?32767/T:0}return Yp(f,p,i,x,w,T,0),p}function Nw(r,e,i,l,h){let f;if(h===function(p,x,w,T){let I=0;for(let C=x,M=w-T;C<w;C+=T)I+=(p[M]-p[C])*(p[C+1]+p[M+1]),M=C;return I}(r,e,i,l)>0)for(let p=e;p<i;p+=l)f=$w(p/l|0,r[p],r[p+1],f);else for(let p=i-l;p>=e;p-=l)f=$w(p/l|0,r[p],r[p+1],f);return f&&Od(f,f.next)&&(Qp(f),f=f.next),f}function Yh(r,e){if(!r)return r;e||(e=r);let i,l=r;do if(i=!1,l.steiner||!Od(l,l.next)&&ks(l.prev,l,l.next)!==0)l=l.next;else{if(Qp(l),l=e=l.prev,l===l.next)break;i=!0}while(i||l!==e);return e}function Yp(r,e,i,l,h,f,p){if(!r)return;!p&&f&&function(w,T,I,C){let M=w;do M.z===0&&(M.z=Gv(M.x,M.y,T,I,C)),M.prevZ=M.prev,M.nextZ=M.next,M=M.next;while(M!==w);M.prevZ.nextZ=null,M.prevZ=null,function(L){let O,V=1;do{let $,W=L;L=null;let Q=null;for(O=0;W;){O++;let ee=W,U=0;for(let te=0;te<V&&(U++,ee=ee.nextZ,ee);te++);let Y=V;for(;U>0||Y>0&&ee;)U!==0&&(Y===0||!ee||W.z<=ee.z)?($=W,W=W.nextZ,U--):($=ee,ee=ee.nextZ,Y--),Q?Q.nextZ=$:L=$,$.prevZ=Q,Q=$;W=ee}Q.nextZ=null,V*=2}while(O>1)}(M)}(r,l,h,f);let x=r;for(;r.prev!==r.next;){const w=r.prev,T=r.next;if(f?mD(r,l,h,f):pD(r))e.push(w.i,r.i,T.i),Qp(r),r=T.next,x=T.next;else if((r=T)===x){p?p===1?Yp(r=_D(Yh(r),e),e,i,l,h,f,2):p===2&&gD(r,e,i,l,h,f):Yp(Yh(r),e,i,l,h,f,1);break}}}function pD(r){const e=r.prev,i=r,l=r.next;if(ks(e,i,l)>=0)return!1;const h=e.x,f=i.x,p=l.x,x=e.y,w=i.y,T=l.y,I=Math.min(h,f,p),C=Math.min(x,w,T),M=Math.max(h,f,p),L=Math.max(x,w,T);let O=l.next;for(;O!==e;){if(O.x>=I&&O.x<=M&&O.y>=C&&O.y<=L&&Kp(h,x,f,w,p,T,O.x,O.y)&&ks(O.prev,O,O.next)>=0)return!1;O=O.next}return!0}function mD(r,e,i,l){const h=r.prev,f=r,p=r.next;if(ks(h,f,p)>=0)return!1;const x=h.x,w=f.x,T=p.x,I=h.y,C=f.y,M=p.y,L=Math.min(x,w,T),O=Math.min(I,C,M),V=Math.max(x,w,T),$=Math.max(I,C,M),W=Gv(L,O,e,i,l),Q=Gv(V,$,e,i,l);let ee=r.prevZ,U=r.nextZ;for(;ee&&ee.z>=W&&U&&U.z<=Q;){if(ee.x>=L&&ee.x<=V&&ee.y>=O&&ee.y<=$&&ee!==h&&ee!==p&&Kp(x,I,w,C,T,M,ee.x,ee.y)&&ks(ee.prev,ee,ee.next)>=0||(ee=ee.prevZ,U.x>=L&&U.x<=V&&U.y>=O&&U.y<=$&&U!==h&&U!==p&&Kp(x,I,w,C,T,M,U.x,U.y)&&ks(U.prev,U,U.next)>=0))return!1;U=U.nextZ}for(;ee&&ee.z>=W;){if(ee.x>=L&&ee.x<=V&&ee.y>=O&&ee.y<=$&&ee!==h&&ee!==p&&Kp(x,I,w,C,T,M,ee.x,ee.y)&&ks(ee.prev,ee,ee.next)>=0)return!1;ee=ee.prevZ}for(;U&&U.z<=Q;){if(U.x>=L&&U.x<=V&&U.y>=O&&U.y<=$&&U!==h&&U!==p&&Kp(x,I,w,C,T,M,U.x,U.y)&&ks(U.prev,U,U.next)>=0)return!1;U=U.nextZ}return!0}function _D(r,e){let i=r;do{const l=i.prev,h=i.next.next;!Od(l,h)&&Uw(l,i,i.next,h)&&Jp(l,h)&&Jp(h,l)&&(e.push(l.i,i.i,h.i),Qp(i),Qp(i.next),i=r=h),i=i.next}while(i!==r);return Yh(i)}function gD(r,e,i,l,h,f){let p=r;do{let x=p.next.next;for(;x!==p.prev;){if(p.i!==x.i&&wD(p,x)){let w=jw(p,x);return p=Yh(p,p.next),w=Yh(w,w.next),Yp(p,e,i,l,h,f,0),void Yp(w,e,i,l,h,f,0)}x=x.next}p=p.next}while(p!==r)}function yD(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function xD(r,e){const i=function(h,f){let p=f;const x=h.x,w=h.y;let T,I=-1/0;if(Od(h,p))return p;do{if(Od(h,p.next))return p.next;if(w<=p.y&&w>=p.next.y&&p.next.y!==p.y){const V=p.x+(w-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(V<=x&&V>I&&(I=V,T=p.x<p.next.x?p:p.next,V===x))return T}p=p.next}while(p!==f);if(!T)return null;const C=T,M=T.x,L=T.y;let O=1/0;p=T;do{if(x>=p.x&&p.x>=M&&x!==p.x&&Vw(w<L?x:I,w,M,L,w<L?I:x,w,p.x,p.y)){const V=Math.abs(w-p.y)/(x-p.x);Jp(p,h)&&(V<O||V===O&&(p.x>T.x||p.x===T.x&&vD(T,p)))&&(T=p,O=V)}p=p.next}while(p!==C);return T}(r,e);if(!i)return e;const l=jw(i,r);return Yh(l,l.next),Yh(i,i.next)}function vD(r,e){return ks(r.prev,r,e.prev)<0&&ks(e.next,r,r.next)<0}function Gv(r,e,i,l,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-l)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function bD(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Vw(r,e,i,l,h,f,p,x){return(h-p)*(e-x)>=(r-p)*(f-x)&&(r-p)*(l-x)>=(i-p)*(e-x)&&(i-p)*(f-x)>=(h-p)*(l-x)}function Kp(r,e,i,l,h,f,p,x){return!(r===p&&e===x)&&Vw(r,e,i,l,h,f,p,x)}function wD(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,l){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==l.i&&h.next.i!==l.i&&Uw(h,h.next,i,l))return!0;h=h.next}while(h!==i);return!1}(r,e)&&(Jp(r,e)&&Jp(e,r)&&function(i,l){let h=i,f=!1;const p=(i.x+l.x)/2,x=(i.y+l.y)/2;do h.y>x!=h.next.y>x&&h.next.y!==h.y&&p<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(f=!f),h=h.next;while(h!==i);return f}(r,e)&&(ks(r.prev,r,e.prev)||ks(r,e.prev,e))||Od(r,e)&&ks(r.prev,r,r.next)>0&&ks(e.prev,e,e.next)>0)}function ks(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Od(r,e){return r.x===e.x&&r.y===e.y}function Uw(r,e,i,l){const h=Fg(ks(r,e,i)),f=Fg(ks(r,e,l)),p=Fg(ks(i,l,r)),x=Fg(ks(i,l,e));return h!==f&&p!==x||!(h!==0||!kg(r,i,e))||!(f!==0||!kg(r,l,e))||!(p!==0||!kg(i,r,l))||!(x!==0||!kg(i,e,l))}function kg(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Fg(r){return r>0?1:r<0?-1:0}function Jp(r,e){return ks(r.prev,r,r.next)<0?ks(r,e,r.next)>=0&&ks(r,r.prev,e)>=0:ks(r,e,r.prev)<0||ks(r,r.next,e)<0}function jw(r,e){const i=Hv(r.i,r.x,r.y),l=Hv(e.i,e.x,e.y),h=r.next,f=e.prev;return r.next=e,e.prev=r,i.next=h,h.prev=i,l.next=i,i.prev=l,f.next=l,l.prev=f,l}function $w(r,e,i,l){const h=Hv(r,e,i);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function Qp(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Hv(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Bg(r,e){const i=r.length;if(i<=1)return[r];const l=[];let h,f;for(let p=0;p<i;p++){const x=Fn(r[p]);x!==0&&(r[p].area=Math.abs(x),f===void 0&&(f=x<0),f===x<0?(h&&l.push(h),h=[r[p]]):h.push(r[p]))}if(h&&l.push(h),e>1)for(let p=0;p<l.length;p++)l[p].length<=e||(tr(l[p],e,1,l[p].length-1,TD),l[p]=l[p].slice(0,e));return l}function TD(r,e){return e.area-r.area}function Gw(r,e,i=1){if(!r)return null;const l=typeof r=="string"?gr.from(r).getPrimary():r.getPrimary(),h=typeof r=="string"?null:r.getSecondary();for(const f of[l,h]){if(!f)continue;const p=f.id.toString();e.has(p)||e.set(p,[]),f.scaleSelf(i),e.get(p).push(f)}return{primary:l.toString(),secondary:h?h.toString():null}}function Wv(r,e,i,l){const h=l.patternDependencies;let f=!1;for(const p of e){const x=p.paint.get(`${r}-pattern`);x.isConstant()||(f=!0),Gw(x.constantOr(null),h,i)&&(f=!0)}return f}function qv(r,e,i,l,h,f){const p=f.patternDependencies;for(const x of e){const w=x.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let T=w.evaluate({zoom:l},i,{},f.availableImages);T=T&&T.name?T.name:T;const I=Gw(T,p,h);if(!I)continue;const{primary:C,secondary:M}=I;C&&(i.patterns[x.id]=[C,M].filter(Boolean))}}return i}class Hw{constructor(){this.polygons=new Map}add(e,...i){this.polygons.has(e)?this.polygons.get(e).push(...i):this.polygons.set(e,i)}merge(e){for(const[i,l]of e.polygons)this.add(i,...l)}}class Kh{constructor(){this.portals=[]}static evaluate(e){if(e.length===0)return new Kh;let i=[];for(const T of e)i.push(...T.portals);if(i.length===0)return new Kh;const l=(T,I)=>T<=0&&I<=0||T>=yt&&I>=yt;for(const T of i){const I=T.va,C=T.vb;(l(I.x,C.x)||l(I.y,C.y))&&(T.type="border")}const h=i.filter(T=>T.type!=="unevaluated"),f=i.filter(T=>T.type==="unevaluated");if(f.length===0)return new Kh;f.sort((T,I)=>T.hash===I.hash?T.isTunnel===I.isTunnel?0:T.isTunnel?-1:1:T.hash<I.hash?1:-1),i=h.concat(f);let p=h.length,x=p,w=p;do if(x++,x===i.length||i[p].hash!==i[x].hash){if(x-p==2){w<p&&(i[w]=i[p],i[p]=null);const T=i[w],I=i[x-1];T.type=T.isTunnel!==I.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:I.connection.a},w++}p=x}while(p!==i.length);return i.splice(w),i.sort((T,I)=>T.hash<I.hash?1:-1),{portals:i}}}Ct(Kh,"ElevationPortalGraph"),Ct(Hw,"ElevationPolygons");class SD{constructor(e,i,l){this.outPositions=e,this.outNormals=i,this.outIndices=l,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(e,i,l){let h=e[2];l!=null&&(h*=l);const f=this.getVec3Bits(e)<<96n|this.getVec3Bits(i),p=this.vertexLookup.get(f);if(p!=null)return p;const x=this.outPositions.length;this.vertexLookup.set(f,x);const w=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],h),this.outNormals.emplaceBack(w,T,I),x}addVertices(e,i,...l){const h=[];for(const f of l){const p=this.addVertex(f,e,i);h.push(p)}return h}addTriangles(e,i,l){if(i&&l){const h=l.length===1,f=_i(0,0,0);for(let p=0;p<e.length;p+=3){const x=i[e[p+0]],w=i[e[p+1]],T=i[e[p+2]],I=h?l[0]:l[e[p+1]],C=h?l[0]:l[e[p+2]],M=this.addVertex(_i(x.x,x.y,h?l[0]:l[e[p+0]]),f),L=this.addVertex(_i(w.x,w.y,I),f),O=this.addVertex(_i(T.x,T.y,C),f);this.outIndices.emplaceBack(M,L,O)}}else for(let h=0;h<e.length;h+=3)this.outIndices.emplaceBack(e[h+0],e[h+1],e[h+2])}addQuad(e,i){const l=this.addVertices(i,void 0,...e.map(w=>_i(w.coord.x,w.coord.y,w.height))),[h,f,p,x]=l;this.addTriangles([h,f,p,p,x,h])}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(e){return this.view.setFloat32(0,e),BigInt(this.view.getUint32(0))}getVec3Bits(e){return this.getBits(e[0])<<64n|this.getBits(e[1])<<32n|this.getBits(e[2])}}class Jr{constructor(e,i,l,h){this.unevaluatedPortals=new Kh,this.portalPolygons=new Hw,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Dp,this.vertexNormals=new vd,this.indexArray=new Gs,this.tileToMeters=je(e),this.bridgeProgramConfigurations=new u(i,{zoom:l,lut:h},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new u(i,{zoom:l,lut:h},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,i){const l=this.unevalVertices.length;for(let h=0;h<e.length;h++)this.unevalVertices.push(e[h]),this.unevalHeights.push(i[h]);return l}addTriangles(e,i,l){const h=l?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)h.push(f+i)}addRenderableRing(e,i,l,h,f,p){const x=[new _t(f.min.x,f.min.y),new _t(f.max.x,f.min.y),new _t(f.max.x,f.max.y),new _t(f.min.x,f.max.y)];for(let w=0;w<l-1;w++){const T=i+w,I=T+1,C=this.unevalVertices[T],M=this.unevalVertices[I];if(!(C.x>=f.min.x&&C.x<=f.max.x&&C.y>=f.min.y&&C.y<=f.max.y||M.x>=f.min.x&&M.x<=f.max.x&&M.y>=f.min.y&&M.y<=f.max.y||bl(C,M,x))||this.isOnBorder(C.x,M.x)||this.isOnBorder(C.y,M.y))continue;const L=Jr.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[I]);let O,V=this.vertexHashLookup.get(Jr.computePosHash(C));V!=null?O=V.next:(V=this.vertexHashLookup.get(Jr.computePosHash(M)),O=V!=null?V.prev:L),this.unevalEdges.push({polygonIdx:e,a:T,b:I,hash:L,portalHash:O,isTunnel:h,type:"unevaluated",featureInfo:p})}}addPortalCandidates(e,i,l,h,f){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:f});const p=i[0];this.vertexHashLookup.clear();let x=Jr.computeEdgeHash(p[p.length-2],p[p.length-1]);for(let w=0;w<p.length-1;w++){const T=p[w+0],I=p[w+1],C=vs(I.x-T.x,I.y-T.y),M=Ds(C);if(M===0)continue;let L="unevaluated";const O=h.pointElevation(T),V=h.pointElevation(I);Math.abs(O)<.01&&Math.abs(V)<.01?L="entrance":(this.isOnBorder(T.x,I.x)||this.isOnBorder(T.y,I.y))&&(L="border");const $=Jr.computeEdgeHash(T,I);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:T,vb:I,vab:C,length:M,hash:$,isTunnel:l,type:L});const W=Jr.computePosHash(T);this.vertexHashLookup.set(W,{prev:x,next:$}),x=$}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),l=M=>{M.primitiveLength=this.indexArray.length-M.primitiveOffset},h=new SD(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),p=i(),x=i(),w=(M,L)=>{M.sort((V,$)=>V.type===L&&$.type!==L?-1:V.type!==L&&$.type===L?1:0);const O=M.findIndex(V=>V.type!==L);return O>=0?O:M.length};let T=0;this.unevalEdges.length>0&&(T=w(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),l(x);const I=i(),C=i();if(this.unevalEdges.length>0){const M=this.unevalEdges.splice(T),L=w(M,"tunnel")+T;this.unevalEdges.push(...M),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:L})}l(I),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),l(C),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),l(p),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),l(f),this.maskSegments=ts.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=ts.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableBridgeSegments=ts.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableTunnelSegments=ts.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=ts.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,l,h,f,p,x,w){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,l,h,p,x,w),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,l,h,p,x,w)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,dD.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,fD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,l,h,f){const p=(x,w)=>{for(let T=0;T<w.length-1;T++){const I=w[T].featureIndex,C=w[T+1].vertexStart,M=e.feature(I);x.populatePaintArrays(C,M,I,{},l,i,h,void 0,f)}};p(this.bridgeProgramConfigurations,this.bridgeFeatureSections),p(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,l,h,f){const p=new Map;for(let x=h;x<f;x++){const w=l[x],T=w.a,I=w.b,C=Jr.computePosHash(e[T]),M=Jr.computePosHash(e[I]);p.has(C)||p.set(C,{}),p.has(M)||p.set(M,{});const L=p.get(C),O=p.get(M);i[T]<=0&&i[I]<=0||(L.to=I,O.from=T)}return p}constructBridgeStructures(e,i,l,h,f,p){e.clearVertexLookup();const x=this.computeVertexConnections(i,l,h,f.min,f.max),w=1/p,T=.5*w,I=L=>_i(i[L].x,i[L].y,l[L]*w),C=L=>{const O=x.get(Jr.computePosHash(i[L])),V=O.from,$=O.to;if(!V||!$)return;const W=I(V),Q=I(L),ee=I($),U=_i(0,0,0);if(!Js(W,Q)){const te=Ce(jt(),Q,W);yi(U,U,Zi(te,te))}if(!Js(ee,Q)){const te=Ce(jt(),ee,Q);yi(U,U,Zi(te,te))}const Y=gt(U);return Y>0?Ui(U,U,1/Y):void 0};let M=Number.POSITIVE_INFINITY;this.sortSubarray(h,f.min,f.max,(L,O)=>L.featureInfo.featureIndex-O.featureInfo.featureIndex);for(let L=f.min;L<f.max;L++){const O=h[L];if(!O.featureInfo.guardRailEnabled)continue;const V=this.prepareEdgePoints(i,l,O,(di,Lt)=>di>Lt);if(V==null)continue;const $=V[0],W=V[1],Q=_i($.coord.x,$.coord.y,w*$.height),ee=_i(W.coord.x,W.coord.y,w*W.height);if(Js(Q,ee))continue;const U=Ce(jt(),ee,Q);Zi(U,U);const Y=di=>Zi(di,di),te=C(O.a)||U,oe=C(O.b)||U,ve=Y(_i(te[1],-te[0],0)),ge=Y(_i(oe[1],-oe[0],0)),be=Y(es(jt(),ve,te)),Me=Y(es(jt(),ge,oe)),$e=jt(),ot=[yi(jt(),Q,Ui($e,Ce($e,ve,be),T)),yi(jt(),Q,Ui($e,yi($e,ve,be),T)),yi(jt(),Q,Ui($e,be,T)),Q],Qe=[yi(jt(),ee,Ui($e,Ce($e,ge,Me),T)),yi(jt(),ee,Ui($e,yi($e,ge,Me),T)),yi(jt(),ee,Ui($e,Me,T)),ee];M=this.addFeatureSection(O.featureInfo.featureIndex,M,this.bridgeFeatureSections,e);const[rt,at]=e.addVertices(ve,p,ot[0],ot[1]),[He,nt]=e.addVertices(ge,p,Qe[0],Qe[1]);e.addTriangles([rt,at,He,at,nt,He]);const[Ue,Ge]=e.addVertices(be,p,ot[1],ot[2]),[ht,dt]=e.addVertices(Me,p,Qe[1],Qe[2]);e.addTriangles([Ue,Ge,ht,Ge,dt,ht]);const[Yt,Ot]=e.addVertices(Is(ve,ve),p,ot[2],ot[3]),[bt,ct]=e.addVertices(Is(ge,ge),p,Qe[2],Qe[3]);e.addTriangles([Yt,Ot,bt,Ot,ct,bt])}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,l,h,f,p){e.clearVertexLookup();let x=Number.POSITIVE_INFINITY;const w=(I,C)=>I.featureInfo.featureIndex-C.featureInfo.featureIndex;this.sortSubarray(h,f.min,f.max,w),this.sortSubarray(h,p.min,p.max,w);const T=I=>Zi(I,I);for(let I=f.min;I<f.max;I++){const C=this.prepareEdgePoints(i,l,h[I],(V,$)=>V<$);if(C==null)continue;const[M,L]=C,O=T(_i(-(L.coord.y-M.coord.y),L.coord.x-M.coord.x,0));x=this.addFeatureSection(h[I].featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([M,L,{coord:L.coord,height:h[I].isTunnel?-.1:0},{coord:M.coord,height:h[I].isTunnel?-.1:0}],O)}for(let I=p.min;I<p.max;I++){const C=h[I];C.isTunnel&&([C.a,C.b]=[C.b,C.a]);const M=i[C.a],L=i[C.b],O=T(_i(-(L.y-M.y),L.x-M.x,0));x=this.addFeatureSection(C.featureInfo.featureIndex,x,this.tunnelFeatureSections,e),e.addQuad([{coord:L,height:0},{coord:M,height:0},{coord:M,height:l[C.a]+4},{coord:L,height:l[C.b]+4}],O),e.addQuad([{coord:M,height:0},{coord:L,height:0},{coord:L,height:l[C.b]+4},{coord:M,height:l[C.a]+4}],O)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}prepareEdgePoints(e,i,l,h){let f=i[l.a],p=i[l.b];const x=h(f,0),w=h(p,0);if(x&&w)return[{coord:e[l.a],height:f},{coord:e[l.b],height:p}];if(!x&&!w)return;const T=e[l.a].clone(),I=e[l.b].clone();if(x){if(!w){const C=p/(p-f);I.x=ri(I.x,T.x,C),I.y=ri(I.y,T.y,C),p=ri(p,f,C)}}else{const C=f/(f-p);T.x=ri(T.x,I.x,C),T.y=ri(T.y,I.y,C),f=ri(f,p,C)}return[{coord:T,height:f},{coord:I,height:p}]}prepareEdges(e,i){if(i.length===0)return;i.sort((x,w)=>x.hash===w.hash?w.polygonIdx-x.polygonIdx:w.hash>x.hash?1:-1);let l=0,h=0,f=0,p=i[l].polygonIdx;do h++,(h===i.length||i[l].hash!==i[h].hash)&&((h-l==1||i[h-1].polygonIdx!==p)&&(f<l&&(i[f]=i[l],i[l]=null),i[f].type="none",f++),l=h,l!==i.length&&(p=i[l].polygonIdx));while(l!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort((T,I)=>T.portalHash<I.portalHash?1:-1);let x=0,w=0;for(;x!==i.length&&w!==e.length;){const T=i[x],I=e[w];T.portalHash>I.hash?x++:I.hash>T.portalHash?w++:(T.type=I.type,x++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=yt&&i>=yt}addFeatureSection(e,i,l,h){return e!==i&&(i=e,l.push({featureIndex:e,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(e,i,l,h){const f=e.slice(i,l);f.sort(h),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(Jr.computePosHash(e))<<32n|BigInt(Jr.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Ww,qw={exports:{}},Zw=(Ww||(Ww=1,function(r,e){(function(i){function l(ne,ae){return ne>ae?1:ne<ae?-1:0}var h=function(ne,ae){ne===void 0&&(ne=l),ae===void 0&&(ae=!1),this._compare=ne,this._root=null,this._size=0,this._noDuplicates=!!ae},f={size:{configurable:!0}};function p(ne,ae,We,pt,wt){var vt=wt-pt;if(vt>0){var Dt=pt+Math.floor(vt/2),si={key:ae[Dt],data:We[Dt],parent:ne};return si.left=p(si,ae,We,pt,Dt),si.right=p(si,ae,We,Dt+1,wt),si}return null}function x(ne,ae,We,pt,wt){if(!(We>=pt)){for(var vt=ne[We+pt>>1],Dt=We-1,si=pt+1;;){do Dt++;while(wt(ne[Dt],vt)<0);do si--;while(wt(ne[si],vt)>0);if(Dt>=si)break;var ki=ne[Dt];ne[Dt]=ne[si],ne[si]=ki,ki=ae[Dt],ae[Dt]=ae[si],ae[si]=ki}x(ne,ae,We,si,wt),x(ne,ae,si+1,pt,wt)}}h.prototype.rotateLeft=function(ne){var ae=ne.right;ae&&(ne.right=ae.left,ae.left&&(ae.left.parent=ne),ae.parent=ne.parent),ne.parent?ne===ne.parent.left?ne.parent.left=ae:ne.parent.right=ae:this._root=ae,ae&&(ae.left=ne),ne.parent=ae},h.prototype.rotateRight=function(ne){var ae=ne.left;ae&&(ne.left=ae.right,ae.right&&(ae.right.parent=ne),ae.parent=ne.parent),ne.parent?ne===ne.parent.left?ne.parent.left=ae:ne.parent.right=ae:this._root=ae,ae&&(ae.right=ne),ne.parent=ae},h.prototype._splay=function(ne){for(;ne.parent;){var ae=ne.parent;ae.parent?ae.left===ne&&ae.parent.left===ae?(this.rotateRight(ae.parent),this.rotateRight(ae)):ae.right===ne&&ae.parent.right===ae?(this.rotateLeft(ae.parent),this.rotateLeft(ae)):ae.left===ne&&ae.parent.right===ae?(this.rotateRight(ae),this.rotateLeft(ae)):(this.rotateLeft(ae),this.rotateRight(ae)):ae.left===ne?this.rotateRight(ae):this.rotateLeft(ae)}},h.prototype.splay=function(ne){for(var ae,We,pt,wt,vt;ne.parent;)(We=(ae=ne.parent).parent)&&We.parent?((pt=We.parent).left===We?pt.left=ne:pt.right=ne,ne.parent=pt):(ne.parent=null,this._root=ne),wt=ne.left,vt=ne.right,ne===ae.left?(We&&(We.left===ae?(ae.right?(We.left=ae.right,We.left.parent=We):We.left=null,ae.right=We,We.parent=ae):(wt?(We.right=wt,wt.parent=We):We.right=null,ne.left=We,We.parent=ne)),vt?(ae.left=vt,vt.parent=ae):ae.left=null,ne.right=ae,ae.parent=ne):(We&&(We.right===ae?(ae.left?(We.right=ae.left,We.right.parent=We):We.right=null,ae.left=We,We.parent=ae):(vt?(We.left=vt,vt.parent=We):We.left=null,ne.right=We,We.parent=ne)),wt?(ae.right=wt,wt.parent=ae):ae.right=null,ne.left=ae,ae.parent=ne)},h.prototype.replace=function(ne,ae){ne.parent?ne===ne.parent.left?ne.parent.left=ae:ne.parent.right=ae:this._root=ae,ae&&(ae.parent=ne.parent)},h.prototype.minNode=function(ne){if(ne===void 0&&(ne=this._root),ne)for(;ne.left;)ne=ne.left;return ne},h.prototype.maxNode=function(ne){if(ne===void 0&&(ne=this._root),ne)for(;ne.right;)ne=ne.right;return ne},h.prototype.insert=function(ne,ae){var We=this._root,pt=null,wt=this._compare;if(this._noDuplicates)for(;We;){if(pt=We,wt(We.key,ne)===0)return;We=wt(We.key,ne)<0?We.right:We.left}else for(;We;)pt=We,We=wt(We.key,ne)<0?We.right:We.left;return We={key:ne,data:ae,left:null,right:null,parent:pt},pt?wt(pt.key,We.key)<0?pt.right=We:pt.left=We:this._root=We,this.splay(We),this._size++,We},h.prototype.find=function(ne){for(var ae=this._root,We=this._compare;ae;){var pt=We(ae.key,ne);if(pt<0)ae=ae.right;else{if(!(pt>0))return ae;ae=ae.left}}return null},h.prototype.contains=function(ne){for(var ae=this._root,We=this._compare;ae;){var pt=We(ne,ae.key);if(pt===0)return!0;ae=pt<0?ae.left:ae.right}return!1},h.prototype.remove=function(ne){var ae=this.find(ne);if(!ae)return!1;if(this.splay(ae),ae.left)if(ae.right){var We=this.minNode(ae.right);We.parent!==ae&&(this.replace(We,We.right),We.right=ae.right,We.right.parent=We),this.replace(ae,We),We.left=ae.left,We.left.parent=We}else this.replace(ae,ae.left);else this.replace(ae,ae.right);return this._size--,!0},h.prototype.removeNode=function(ne){if(!ne)return!1;if(this.splay(ne),ne.left)if(ne.right){var ae=this.minNode(ne.right);ae.parent!==ne&&(this.replace(ae,ae.right),ae.right=ne.right,ae.right.parent=ae),this.replace(ne,ae),ae.left=ne.left,ae.left.parent=ae}else this.replace(ne,ne.left);else this.replace(ne,ne.right);return this._size--,!0},h.prototype.erase=function(ne){var ae=this.find(ne);if(ae){this.splay(ae);var We=ae.left,pt=ae.right,wt=null;We&&(We.parent=null,wt=this.maxNode(We),this.splay(wt),this._root=wt),pt&&(We?wt.right=pt:this._root=pt,pt.parent=wt),this._size--}},h.prototype.pop=function(){var ne=this._root,ae=null;if(ne){for(;ne.left;)ne=ne.left;ae={key:ne.key,data:ne.data},this.remove(ne.key)}return ae},h.prototype.next=function(ne){var ae=ne;if(ae)if(ae.right)for(ae=ae.right;ae&&ae.left;)ae=ae.left;else for(ae=ne.parent;ae&&ae.right===ne;)ne=ae,ae=ae.parent;return ae},h.prototype.prev=function(ne){var ae=ne;if(ae)if(ae.left)for(ae=ae.left;ae&&ae.right;)ae=ae.right;else for(ae=ne.parent;ae&&ae.left===ne;)ne=ae,ae=ae.parent;return ae},h.prototype.forEach=function(ne){for(var ae=this._root,We=[],pt=!1,wt=0;!pt;)ae?(We.push(ae),ae=ae.left):We.length>0?(ne(ae=We.pop(),wt++),ae=ae.right):pt=!0;return this},h.prototype.range=function(ne,ae,We,pt){for(var wt=[],vt=this._compare,Dt=this._root;wt.length!==0||Dt;)if(Dt)wt.push(Dt),Dt=Dt.left;else{if(vt((Dt=wt.pop()).key,ae)>0)break;if(vt(Dt.key,ne)>=0&&We.call(pt,Dt))return this;Dt=Dt.right}return this},h.prototype.keys=function(){for(var ne=this._root,ae=[],We=[],pt=!1;!pt;)ne?(ae.push(ne),ne=ne.left):ae.length>0?(ne=ae.pop(),We.push(ne.key),ne=ne.right):pt=!0;return We},h.prototype.values=function(){for(var ne=this._root,ae=[],We=[],pt=!1;!pt;)ne?(ae.push(ne),ne=ne.left):ae.length>0?(ne=ae.pop(),We.push(ne.data),ne=ne.right):pt=!0;return We},h.prototype.at=function(ne){for(var ae=this._root,We=[],pt=!1,wt=0;!pt;)if(ae)We.push(ae),ae=ae.left;else if(We.length>0){if(ae=We.pop(),wt===ne)return ae;wt++,ae=ae.right}else pt=!0;return null},h.prototype.load=function(ne,ae,We){if(ne===void 0&&(ne=[]),ae===void 0&&(ae=[]),We===void 0&&(We=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var pt=ne.length;return We&&x(ne,ae,0,pt-1,this._compare),this._root=p(null,ne,ae,0,pt),this._size=pt,this},h.prototype.min=function(){var ne=this.minNode(this._root);return ne?ne.key:null},h.prototype.max=function(){var ne=this.maxNode(this._root);return ne?ne.key:null},h.prototype.isEmpty=function(){return this._root===null},f.size.get=function(){return this._size},h.createTree=function(ne,ae,We,pt,wt){return new h(We,wt).load(ne,ae,pt)},Object.defineProperties(h.prototype,f);var w=0,T=1,I=2,C=3,M=0,L=1,O=2,V=3;function $(ne,ae,We){ae===null?(ne.inOut=!1,ne.otherInOut=!0):(ne.isSubject===ae.isSubject?(ne.inOut=!ae.inOut,ne.otherInOut=ae.otherInOut):(ne.inOut=!ae.otherInOut,ne.otherInOut=ae.isVertical()?!ae.inOut:ae.inOut),ae&&(ne.prevInResult=!W(ae,We)||ae.isVertical()?ae.prevInResult:ae));var pt=W(ne,We);ne.resultTransition=pt?function(wt,vt){var Dt,si=!wt.inOut,ki=!wt.otherInOut;switch(vt){case M:Dt=si&&ki;break;case L:Dt=si||ki;break;case V:Dt=si^ki;break;case O:Dt=wt.isSubject?si&&!ki:ki&&!si}return Dt?1:-1}(ne,We):0}function W(ne,ae){switch(ne.type){case w:switch(ae){case M:return!ne.otherInOut;case L:return ne.otherInOut;case O:return ne.isSubject&&ne.otherInOut||!ne.isSubject&&!ne.otherInOut;case V:return!0}break;case I:return ae===M||ae===L;case C:return ae===O;case T:return!1}return!1}var Q=function(ne,ae,We,pt,wt){this.left=ae,this.point=ne,this.otherEvent=We,this.isSubject=pt,this.type=wt||w,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ee={inResult:{configurable:!0}};function U(ne,ae){return ne[0]===ae[0]&&ne[1]===ae[1]}Q.prototype.isBelow=function(ne){var ae=this.point,We=this.otherEvent.point;return this.left?(ae[0]-ne[0])*(We[1]-ne[1])-(We[0]-ne[0])*(ae[1]-ne[1])>0:(We[0]-ne[0])*(ae[1]-ne[1])-(ae[0]-ne[0])*(We[1]-ne[1])>0},Q.prototype.isAbove=function(ne){return!this.isBelow(ne)},Q.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ee.inResult.get=function(){return this.resultTransition!==0},Q.prototype.clone=function(){var ne=new Q(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ne.contourId=this.contourId,ne.resultTransition=this.resultTransition,ne.prevInResult=this.prevInResult,ne.isExteriorRing=this.isExteriorRing,ne.inOut=this.inOut,ne.otherInOut=this.otherInOut,ne},Object.defineProperties(Q.prototype,ee);var Y=11102230246251565e-32,te=134217729,oe=(3+8*Y)*Y;function ve(ne,ae,We,pt,wt){var vt,Dt,si,ki,Fi=ae[0],Ii=pt[0],dn=0,Sn=0;Ii>Fi==Ii>-Fi?(vt=Fi,Fi=ae[++dn]):(vt=Ii,Ii=pt[++Sn]);var Bi=0;if(dn<ne&&Sn<We)for(Ii>Fi==Ii>-Fi?(si=vt-((Dt=Fi+vt)-Fi),Fi=ae[++dn]):(si=vt-((Dt=Ii+vt)-Ii),Ii=pt[++Sn]),vt=Dt,si!==0&&(wt[Bi++]=si);dn<ne&&Sn<We;)Ii>Fi==Ii>-Fi?(si=vt-((Dt=vt+Fi)-(ki=Dt-vt))+(Fi-ki),Fi=ae[++dn]):(si=vt-((Dt=vt+Ii)-(ki=Dt-vt))+(Ii-ki),Ii=pt[++Sn]),vt=Dt,si!==0&&(wt[Bi++]=si);for(;dn<ne;)si=vt-((Dt=vt+Fi)-(ki=Dt-vt))+(Fi-ki),Fi=ae[++dn],vt=Dt,si!==0&&(wt[Bi++]=si);for(;Sn<We;)si=vt-((Dt=vt+Ii)-(ki=Dt-vt))+(Ii-ki),Ii=pt[++Sn],vt=Dt,si!==0&&(wt[Bi++]=si);return vt===0&&Bi!==0||(wt[Bi++]=vt),Bi}function ge(ne){return new Float64Array(ne)}var be=33306690738754716e-32,Me=22204460492503146e-32,$e=11093356479670487e-47,ot=ge(4),Qe=ge(8),rt=ge(12),at=ge(16),He=ge(4);function nt(ne,ae,We){var pt=function(wt,vt,Dt,si,ki,Fi){var Ii=(vt-Fi)*(Dt-ki),dn=(wt-ki)*(si-Fi),Sn=Ii-dn;if(Ii===0||dn===0||Ii>0!=dn>0)return Sn;var Bi=Math.abs(Ii+dn);return Math.abs(Sn)>=be*Bi?Sn:-function(Zn,Pn,cn,as,On,En,Dn){var _n,Pi,yn,Xn,ii,Gi,kn,ns,Un,ws,xn,gs,Cr,Xs,Ws,Mr,Fa,Ts,Rs=Zn-On,Ys=cn-On,ur=Pn-En,sr=as-En;ot[0]=(Ws=(ns=Rs-(kn=(Gi=te*Rs)-(Gi-Rs)))*(ws=sr-(Un=(Gi=te*sr)-(Gi-sr)))-((Xs=Rs*sr)-kn*Un-ns*Un-kn*ws))-((xn=Ws-(Fa=(ns=ur-(kn=(Gi=te*ur)-(Gi-ur)))*(ws=Ys-(Un=(Gi=te*Ys)-(Gi-Ys)))-((Mr=ur*Ys)-kn*Un-ns*Un-kn*ws)))+(ii=Ws-xn))+(ii-Fa),ot[1]=(Cr=Xs-((gs=Xs+xn)-(ii=gs-Xs))+(xn-ii))-((xn=Cr-Mr)+(ii=Cr-xn))+(ii-Mr),ot[2]=gs-((Ts=gs+xn)-(ii=Ts-gs))+(xn-ii),ot[3]=Ts;var Pc=function(R8,n2){for(var s2=n2[0],J0=1;J0<4;J0++)s2+=n2[J0];return s2}(0,ot),Im=Me*Dn;if(Pc>=Im||-Pc>=Im||(_n=Zn-(Rs+(ii=Zn-Rs))+(ii-On),yn=cn-(Ys+(ii=cn-Ys))+(ii-On),Pi=Pn-(ur+(ii=Pn-ur))+(ii-En),Xn=as-(sr+(ii=as-sr))+(ii-En),_n===0&&Pi===0&&yn===0&&Xn===0)||(Im=$e*Dn+oe*Math.abs(Pc),(Pc+=Rs*Xn+sr*_n-(ur*yn+Ys*Pi))>=Im||-Pc>=Im))return Pc;He[0]=(Ws=(ns=_n-(kn=(Gi=te*_n)-(Gi-_n)))*(ws=sr-(Un=(Gi=te*sr)-(Gi-sr)))-((Xs=_n*sr)-kn*Un-ns*Un-kn*ws))-((xn=Ws-(Fa=(ns=Pi-(kn=(Gi=te*Pi)-(Gi-Pi)))*(ws=Ys-(Un=(Gi=te*Ys)-(Gi-Ys)))-((Mr=Pi*Ys)-kn*Un-ns*Un-kn*ws)))+(ii=Ws-xn))+(ii-Fa),He[1]=(Cr=Xs-((gs=Xs+xn)-(ii=gs-Xs))+(xn-ii))-((xn=Cr-Mr)+(ii=Cr-xn))+(ii-Mr),He[2]=gs-((Ts=gs+xn)-(ii=Ts-gs))+(xn-ii),He[3]=Ts;var dz=ve(4,ot,4,He,Qe);He[0]=(Ws=(ns=Rs-(kn=(Gi=te*Rs)-(Gi-Rs)))*(ws=Xn-(Un=(Gi=te*Xn)-(Gi-Xn)))-((Xs=Rs*Xn)-kn*Un-ns*Un-kn*ws))-((xn=Ws-(Fa=(ns=ur-(kn=(Gi=te*ur)-(Gi-ur)))*(ws=yn-(Un=(Gi=te*yn)-(Gi-yn)))-((Mr=ur*yn)-kn*Un-ns*Un-kn*ws)))+(ii=Ws-xn))+(ii-Fa),He[1]=(Cr=Xs-((gs=Xs+xn)-(ii=gs-Xs))+(xn-ii))-((xn=Cr-Mr)+(ii=Cr-xn))+(ii-Mr),He[2]=gs-((Ts=gs+xn)-(ii=Ts-gs))+(xn-ii),He[3]=Ts;var fz=ve(dz,Qe,4,He,rt);He[0]=(Ws=(ns=_n-(kn=(Gi=te*_n)-(Gi-_n)))*(ws=Xn-(Un=(Gi=te*Xn)-(Gi-Xn)))-((Xs=_n*Xn)-kn*Un-ns*Un-kn*ws))-((xn=Ws-(Fa=(ns=Pi-(kn=(Gi=te*Pi)-(Gi-Pi)))*(ws=yn-(Un=(Gi=te*yn)-(Gi-yn)))-((Mr=Pi*yn)-kn*Un-ns*Un-kn*ws)))+(ii=Ws-xn))+(ii-Fa),He[1]=(Cr=Xs-((gs=Xs+xn)-(ii=gs-Xs))+(xn-ii))-((xn=Cr-Mr)+(ii=Cr-xn))+(ii-Mr),He[2]=gs-((Ts=gs+xn)-(ii=Ts-gs))+(xn-ii),He[3]=Ts;var pz=ve(fz,rt,4,He,at);return at[pz-1]}(wt,vt,Dt,si,ki,Fi,Bi)}(ne[0],ne[1],ae[0],ae[1],We[0],We[1]);return pt>0?-1:pt<0?1:0}function Ue(ne,ae){var We=ne.point,pt=ae.point;return We[0]>pt[0]?1:We[0]<pt[0]?-1:We[1]!==pt[1]?We[1]>pt[1]?1:-1:function(wt,vt,Dt,si){return wt.left!==vt.left?wt.left?1:-1:nt(Dt,wt.otherEvent.point,vt.otherEvent.point)!==0?wt.isBelow(vt.otherEvent.point)?-1:1:!wt.isSubject&&vt.isSubject?1:-1}(ne,ae,We)}function Ge(ne,ae,We){var pt=new Q(ae,!1,ne,ne.isSubject),wt=new Q(ae,!0,ne.otherEvent,ne.isSubject);return U(ne.point,ne.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ne),pt.contourId=wt.contourId=ne.contourId,Ue(wt,ne.otherEvent)>0&&(ne.otherEvent.left=!0,wt.left=!1),ne.otherEvent.otherEvent=wt,ne.otherEvent=pt,We.push(wt),We.push(pt),We}function ht(ne,ae){return ne[0]*ae[1]-ne[1]*ae[0]}function dt(ne,ae){return ne[0]*ae[0]+ne[1]*ae[1]}function Yt(ne,ae,We){var pt=function(ki,Fi,Ii,dn,Sn){var Bi=[Fi[0]-ki[0],Fi[1]-ki[1]],Zn=[dn[0]-Ii[0],dn[1]-Ii[1]];function Pn(Gi,kn,ns){return[Gi[0]+kn*ns[0],Gi[1]+kn*ns[1]]}var cn=[Ii[0]-ki[0],Ii[1]-ki[1]],as=ht(Bi,Zn),On=as*as,En=dt(Bi,Bi);if(On>0){var Dn=ht(cn,Zn)/as;if(Dn<0||Dn>1)return null;var _n=ht(cn,Bi)/as;return _n<0||_n>1?null:Dn===0||Dn===1?[Pn(ki,Dn,Bi)]:_n===0||_n===1?[Pn(Ii,_n,Zn)]:[Pn(ki,Dn,Bi)]}if((On=(as=ht(cn,Bi))*as)>0)return null;var Pi=dt(Bi,cn)/En,yn=Pi+dt(Bi,Zn)/En,Xn=Math.min(Pi,yn),ii=Math.max(Pi,yn);return Xn<=1&&ii>=0?Xn===1?[Pn(ki,Xn>0?Xn:0,Bi)]:ii===0?[Pn(ki,ii<1?ii:1,Bi)]:[Pn(ki,Xn>0?Xn:0,Bi),Pn(ki,ii<1?ii:1,Bi)]:null}(ne.point,ne.otherEvent.point,ae.point,ae.otherEvent.point),wt=pt?pt.length:0;if(wt===0||wt===1&&(U(ne.point,ae.point)||U(ne.otherEvent.point,ae.otherEvent.point))||wt===2&&ne.isSubject===ae.isSubject)return 0;if(wt===1)return U(ne.point,pt[0])||U(ne.otherEvent.point,pt[0])||Ge(ne,pt[0],We),U(ae.point,pt[0])||U(ae.otherEvent.point,pt[0])||Ge(ae,pt[0],We),1;var vt=[],Dt=!1,si=!1;return U(ne.point,ae.point)?Dt=!0:Ue(ne,ae)===1?vt.push(ae,ne):vt.push(ne,ae),U(ne.otherEvent.point,ae.otherEvent.point)?si=!0:Ue(ne.otherEvent,ae.otherEvent)===1?vt.push(ae.otherEvent,ne.otherEvent):vt.push(ne.otherEvent,ae.otherEvent),Dt&&si||Dt?(ae.type=T,ne.type=ae.inOut===ne.inOut?I:C,Dt&&!si&&Ge(vt[1].otherEvent,vt[0].point,We),2):si?(Ge(vt[0],vt[1].point,We),3):vt[0]!==vt[3].otherEvent?(Ge(vt[0],vt[1].point,We),Ge(vt[1],vt[2].point,We),3):(Ge(vt[0],vt[1].point,We),Ge(vt[3].otherEvent,vt[2].point,We),3)}function Ot(ne,ae){if(ne===ae)return 0;if(nt(ne.point,ne.otherEvent.point,ae.point)!==0||nt(ne.point,ne.otherEvent.point,ae.otherEvent.point)!==0)return U(ne.point,ae.point)?ne.isBelow(ae.otherEvent.point)?-1:1:ne.point[0]===ae.point[0]?ne.point[1]<ae.point[1]?-1:1:Ue(ne,ae)===1?ae.isAbove(ne.point)?-1:1:ne.isBelow(ae.point)?-1:1;if(ne.isSubject!==ae.isSubject)return ne.isSubject?-1:1;var We=ne.point,pt=ae.point;return We[0]===pt[0]&&We[1]===pt[1]?(We=ne.otherEvent.point)[0]===(pt=ae.otherEvent.point)[0]&&We[1]===pt[1]?0:ne.contourId>ae.contourId?1:-1:Ue(ne,ae)===1?1:-1}var bt=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function ct(ne,ae,We,pt){var wt,vt=ne+1,Dt=ae[ne].point,si=ae.length;for(vt<si&&(wt=ae[vt].point);vt<si&&wt[0]===Dt[0]&&wt[1]===Dt[1];){if(!We[vt])return vt;++vt<si&&(wt=ae[vt].point)}for(vt=ne-1;We[vt]&&vt>pt;)vt--;return vt}bt.prototype.isExterior=function(){return this.holeOf==null};var di=Ft,Lt=Ft;function Ft(ne,ae){if(!(this instanceof Ft))return new Ft(ne,ae);if(this.data=ne||[],this.length=this.data.length,this.compare=ae||oi,this.length>0)for(var We=(this.length>>1)-1;We>=0;We--)this._down(We)}function oi(ne,ae){return ne<ae?-1:ne>ae?1:0}Ft.prototype={push:function(ne){this.data.push(ne),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ne=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ne}},peek:function(){return this.data[0]},_up:function(ne){for(var ae=this.data,We=this.compare,pt=ae[ne];ne>0;){var wt=ne-1>>1,vt=ae[wt];if(We(pt,vt)>=0)break;ae[ne]=vt,ne=wt}ae[ne]=pt},_down:function(ne){for(var ae=this.data,We=this.compare,pt=this.length>>1,wt=ae[ne];ne<pt;){var vt=1+(ne<<1),Dt=vt+1,si=ae[vt];if(Dt<this.length&&We(ae[Dt],si)<0&&(vt=Dt,si=ae[Dt]),We(si,wt)>=0)break;ae[ne]=si,ne=vt}ae[ne]=wt}},di.default=Lt;var wi=Math.max,bi=Math.min,Ri=0;function Ai(ne,ae,We,pt,wt,vt){var Dt,si,ki,Fi,Ii,dn;for(Dt=0,si=ne.length-1;Dt<si;Dt++)if(Fi=ne[Dt+1],Ii=new Q(ki=ne[Dt],!1,void 0,ae),dn=new Q(Fi,!1,Ii,ae),Ii.otherEvent=dn,ki[0]!==Fi[0]||ki[1]!==Fi[1]){Ii.contourId=dn.contourId=We,vt||(Ii.isExteriorRing=!1,dn.isExteriorRing=!1),Ue(Ii,dn)>0?dn.left=!0:Ii.left=!0;var Sn=ki[0],Bi=ki[1];wt[0]=bi(wt[0],Sn),wt[1]=bi(wt[1],Bi),wt[2]=wi(wt[2],Sn),wt[3]=wi(wt[3],Bi),pt.push(Ii),pt.push(dn)}}var Li=[];function ln(ne,ae,We){typeof ne[0][0][0]=="number"&&(ne=[ne]),typeof ae[0][0][0]=="number"&&(ae=[ae]);var pt=function(Bi,Zn,Pn){var cn=null;return Bi.length*Zn.length==0&&(Pn===M?cn=Li:Pn===O?cn=Bi:Pn!==L&&Pn!==V||(cn=Bi.length===0?Zn:Bi)),cn}(ne,ae,We);if(pt)return pt===Li?null:pt;var wt=[1/0,1/0,-1/0,-1/0],vt=[1/0,1/0,-1/0,-1/0],Dt=function(Bi,Zn,Pn,cn,as){var On,En,Dn,_n,Pi,yn,Xn=new di(null,Ue);for(Dn=0,_n=Bi.length;Dn<_n;Dn++)for(Pi=0,yn=(On=Bi[Dn]).length;Pi<yn;Pi++)(En=Pi===0)&&Ri++,Ai(On[Pi],!0,Ri,Xn,Pn,En);for(Dn=0,_n=Zn.length;Dn<_n;Dn++)for(Pi=0,yn=(On=Zn[Dn]).length;Pi<yn;Pi++)En=Pi===0,as===O&&(En=!1),En&&Ri++,Ai(On[Pi],!1,Ri,Xn,cn,En);return Xn}(ne,ae,wt,vt,We);if(pt=function(Bi,Zn,Pn,cn,as){var On=null;return(Pn[0]>cn[2]||cn[0]>Pn[2]||Pn[1]>cn[3]||cn[1]>Pn[3])&&(as===M?On=Li:as===O?On=Bi:as!==L&&as!==V||(On=Bi.concat(Zn))),On}(ne,ae,wt,vt,We))return pt===Li?null:pt;for(var si=function(Bi){var Zn,Pn,cn=function(Dn){var _n,Pi,yn,Xn,ii=[];for(Pi=0,yn=Dn.length;Pi<yn;Pi++)((_n=Dn[Pi]).left&&_n.inResult||!_n.left&&_n.otherEvent.inResult)&&ii.push(_n);for(var Gi=!1;!Gi;)for(Gi=!0,Pi=0,yn=ii.length;Pi<yn;Pi++)Pi+1<yn&&Ue(ii[Pi],ii[Pi+1])===1&&(Xn=ii[Pi],ii[Pi]=ii[Pi+1],ii[Pi+1]=Xn,Gi=!1);for(Pi=0,yn=ii.length;Pi<yn;Pi++)(_n=ii[Pi]).otherPos=Pi;for(Pi=0,yn=ii.length;Pi<yn;Pi++)(_n=ii[Pi]).left||(Xn=_n.otherPos,_n.otherPos=_n.otherEvent.otherPos,_n.otherEvent.otherPos=Xn);return ii}(Bi),as={},On=[],En=function(){if(!as[Zn]){var Dn=On.length,_n=function(ii,Gi,kn){var ns=new bt;if(ii.prevInResult!=null){var Un=ii.prevInResult,ws=Un.outputContourId;if(Un.resultTransition>0){var xn=Gi[ws];if(xn.holeOf!=null){var gs=xn.holeOf;Gi[gs].holeIds.push(kn),ns.holeOf=gs,ns.depth=Gi[ws].depth}else Gi[ws].holeIds.push(kn),ns.holeOf=ws,ns.depth=Gi[ws].depth+1}else ns.holeOf=null,ns.depth=Gi[ws].depth}else ns.holeOf=null,ns.depth=0;return ns}(cn[Zn],On,Dn),Pi=function(ii){as[ii]=!0,ii<cn.length&&cn[ii]&&(cn[ii].outputContourId=Dn)},yn=Zn,Xn=Zn;for(_n.points.push(cn[Zn].point);Pi(yn),Pi(yn=cn[yn].otherPos),_n.points.push(cn[yn].point),!((yn=ct(yn,cn,as,Xn))==Xn||yn>=cn.length)&&cn[yn];);On.push(_n)}};for(Zn=0,Pn=cn.length;Zn<Pn;Zn++)En();return On}(function(Bi,Zn,Pn,cn,as,On){for(var En,Dn,_n,Pi=new h(Ot),yn=[],Xn=Math.min(cn[2],as[2]);Bi.length!==0;){var ii=Bi.pop();if(yn.push(ii),On===M&&ii.point[0]>Xn||On===O&&ii.point[0]>cn[2])break;if(ii.left){Dn=En=Pi.insert(ii),En=En!==(_n=Pi.minNode())?Pi.prev(En):null,Dn=Pi.next(Dn);var Gi=En?En.key:null;if($(ii,Gi,On),Dn&&Yt(ii,Dn.key,Bi)===2&&($(ii,Gi,On),$(Dn.key,ii,On)),En&&Yt(En.key,ii,Bi)===2){var kn=En;$(Gi,(kn=kn!==_n?Pi.prev(kn):null)?kn.key:null,On),$(ii,Gi,On)}}else Dn=En=Pi.find(ii=ii.otherEvent),En&&Dn&&(En=En!==_n?Pi.prev(En):null,Dn=Pi.next(Dn),Pi.remove(ii),Dn&&En&&Yt(En.key,Dn.key,Bi))}return yn}(Dt,0,0,wt,vt,We)),ki=[],Fi=0;Fi<si.length;Fi++){var Ii=si[Fi];if(Ii.isExterior()){for(var dn=[Ii.points],Sn=0;Sn<Ii.holeIds.length;Sn++)dn.push(si[Ii.holeIds[Sn]].points);ki.push(dn)}}return ki}var Mn={UNION:L,DIFFERENCE:O,INTERSECTION:M,XOR:V};i.diff=function(ne,ae){return ln(ne,ae,O)},i.intersection=function(ne,ae){return ln(ne,ae,M)},i.operations=Mn,i.union=function(ne,ae){return ln(ne,ae,L)},i.xor=function(ne,ae){return ln(ne,ae,V)},Object.defineProperty(i,"__esModule",{value:!0})})(e)}(0,qw.exports)),qw.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function Ng(r,e,i,l){const h=[],f=l===0?(p,x,w,T,I,C)=>{p.push(new _t(C,w+(C-x)/(T-x)*(I-w)))}:(p,x,w,T,I,C)=>{p.push(new _t(x+(C-w)/(I-w)*(T-x),C))};for(const p of r){const x=[];for(const w of p){if(w.length<=2)continue;const T=[];for(let M=0;M<w.length-1;M++){const L=w[M].x,O=w[M].y,V=w[M+1].x,$=w[M+1].y,W=l===0?L:O,Q=l===0?V:$;W<e?Q>e&&f(T,L,O,V,$,e):W>i?Q<i&&f(T,L,O,V,$,i):T.push(w[M]),Q<e&&W>=e&&f(T,L,O,V,$,e),Q>i&&W<=i&&f(T,L,O,V,$,i)}let I=w[w.length-1];const C=l===0?I.x:I.y;C>=e&&C<=i&&T.push(I),T.length&&(I=T[T.length-1],T[0].x===I.x&&T[0].y===I.y||T.push(T[0]),x.push(T))}x.length&&h.push(x)}return h}function ED(r,e){const i=Zv(r),l=Zv([e]),h=Zw.intersection(i,l);return h==null?[]:Xw(h)}function AD(r,e){let l=Zv(r,65536);for(;e.valid();e.next()){const[h,f]=e.get(),p=h.x*65536,x=h.y*65536,w=f.x*65536,T=f.y*65536,I=w-p,C=T-x,M=Math.hypot(I,C),L=Math.trunc(C/M*3),O=-Math.trunc(I/M*3);l=Zw.diff(l,[[[p,x],[w,T],[w+L,T+O],[p+L,x+O],[p,x]]])}return Xw(l,1/65536)}function Zv(r,e=1){return[r.map(i=>i.map(l=>[l.x*e,l.y*e]))]}function Xw(r,e=1){return r.map(i=>i.map((l,h)=>{const f=l.map(p=>new _t(p[0]*e,p[1]*e).round());return h>0&&f.reverse(),f}))}class Xv{constructor(e,i){this.layoutVertexArray=new ea,this.indexArray=new Gs,this.lineIndexArray=new Ma,this.triangleSegments=new ts,this.lineSegments=new ts,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Ia)}update(e,i,l,h,f,p,x,w){this.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,w)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,uD.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,l,h,f,p,x){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,l,h,f,p,void 0,x)}}class Yv{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new Xv(e,!1),this.elevationBufferData=new Xv(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,h){this.hasPattern=Wv("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),p=[];for(const{feature:x,id:w,index:T,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,M=Et(x,C);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),M,l))continue;const L=f?f.evaluate(M,{},l,i.availableImages):void 0,O={id:w,properties:x.properties,type:x.type,sourceLayerIndex:I,index:T,geometry:C?M.geometry:Pt(x,l,h),patterns:{},sortKey:L};p.push(O)}f&&p.sort((x,w)=>x.sortKey-w.sortKey);for(const x of p){const{geometry:w,index:T,sourceLayerIndex:I}=x;if(this.hasPattern){const C=qv("fill",this.layers,x,this.zoom,this.pixelRatio,i);this.patternFeatures.push(C)}else this.addFeature(x,w,T,l,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[T].feature,w,T,I,this.index)}}update(e,i,l,h,f,p,x){this.bufferData.update(e,i,l,h,f,p,x,this.worldview),this.elevationBufferData.update(e,i,l,h,f,p,x,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,l,h,f,p,x,this.worldview)}addFeatures(e,i,l,h,f,p){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,l,h,p,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,l,h,f,p=[],x,w){const T=Bg(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,T,h,l,w):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(e,l,f,p,h,x,this.worldview),this.elevationBufferData.populatePaintArrays(e,l,f,p,h,x,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,l,h,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,l,h,f,this.worldview))}addElevatedRoadFeature(e,i,l,h,f){const p=new Array,x=Br.getElevationFeature(e,f);if(!x)return void this.addGeometry(i,this.bufferData);{const T=this.clipPolygonsToTile(i,1);T.length>0&&p.push({polygons:T,elevationFeature:x,elevationTileID:l})}const w={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},l),featureIndex:h};for(const T of p)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new Jr(T.elevationTileID,this.layers,this.zoom,this.lut));const C=T.elevationFeature.isTunnel();let M=0;e.properties.hasOwnProperty(Rn)&&(M=+e.properties[Rn]);for(const L of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,L,C,T.elevationFeature,M)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const I=new co(l,T.elevationTileID);this.addElevatedGeometry(T.polygons,I,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,w)}}addElevatedGeometry(e,i,l,h,f,p){const x={elevation:l,elevationSampler:i,bias:h,index:f,featureInfo:p},[w,T]=this.addGeometry(e,this.elevationBufferData,x);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:w,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,w),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(e,i,l){let h=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,p=null;l&&(p=l.elevationSampler.constantElevation(l.elevation,l.bias),p!=null&&(h=p,f=p));const x=(w,T,I)=>{if(l!=null)if(T.push(w),p!=null)i.elevatedLayoutVertexArray.emplaceBack(p),I.push(p);else{const C=l.elevationSampler.pointElevation(w,l.elevation,l.bias);i.elevatedLayoutVertexArray.emplaceBack(C),I.push(C),h=Math.min(h,C),f=Math.max(f,C)}};for(const w of e){let T=0;for(const ee of w)T+=ee.length;const I=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),C=I.vertexLength,M=[],L=[],O=[],V=[],$=[],W=i.layoutVertexArray.length;for(const ee of w){if(ee.length===0)continue;ee!==w[0]&&L.push(M.length/2);const U=i.lineSegments.prepareSegment(ee.length,i.layoutVertexArray,i.lineIndexArray),Y=U.vertexLength;l&&$.push(i.layoutVertexArray.length-W),x(ee[0],O,V),i.layoutVertexArray.emplaceBack(ee[0].x,ee[0].y),i.lineIndexArray.emplaceBack(Y+ee.length-1,Y),M.push(ee[0].x),M.push(ee[0].y);for(let te=1;te<ee.length;te++)x(ee[te],O,V),i.layoutVertexArray.emplaceBack(ee[te].x,ee[te].y),i.lineIndexArray.emplaceBack(Y+te-1,Y+te),M.push(ee[te].x),M.push(ee[te].y);U.vertexLength+=ee.length,U.primitiveLength+=ee.length}const Q=Xp(M,L);for(let ee=0;ee<Q.length;ee+=3)i.indexArray.emplaceBack(C+Q[ee],C+Q[ee+1],C+Q[ee+2]);if(Q.length>0&&l&&this.elevationMode==="hd-road-base"){const ee=l.elevation.isTunnel(),U=l.elevation.safeArea,Y=this.elevatedStructures.addVertices(O,V);this.elevatedStructures.addTriangles(Q,Y,ee);const te=$.length;if(te>0){for(let oe=0;oe<te-1;oe++)this.elevatedStructures.addRenderableRing(l.index,$[oe]+Y,$[oe+1]-$[oe],ee,U,l.featureInfo);this.elevatedStructures.addRenderableRing(l.index,$[te-1]+Y,O.length-$[te-1],ee,U,l.featureInfo)}}I.vertexLength+=T,I.primitiveLength+=Q.length/3}return[h,f]}prepareElevatedPolygons(e,i,l){const h=1/je(l),f=[];for(const p of e){const x=AD(p,new Ir(i,h));f.push(...x)}return f}clipPolygonsToTile(e,i){const l=-i,h=-i,f=yt+i,p=yt+i;let x=0;const w=[],T=[];for(;x<e.length;x++){const M=e[x],L=Kf(M);(L.min.x>=l&&L.max.x<=f&&L.min.y>=h&&L.max.y<=p?w:T).push(M)}if(w.length===e.length)return e;const I=[new _t(l,h),new _t(f,h),new _t(f,p),new _t(l,p),new _t(l,h)],C=w;for(const M of T)C.push(...ED(M,I));return C}}let Yw,Kw,Jw,Qw;Ct(Yv,"FillBucket",{omit:["layers","patternFeatures"]}),Ct(Xv,"FillBufferData"),Ct(Jr,"ElevatedStructures");class Kv{constructor(e,i,l,h){if(this.triangleCount=i.length/3,this.min=new _t(0,0),this.max=new _t(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,p]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const M=e[C];f.x=Math.min(f.x,M.x),f.y=Math.min(f.y,M.y),p.x=Math.max(p.x,M.x),p.y=Math.max(p.y,M.y)}if(h){const C=Math.ceil(Math.max(p.x-f.x,p.y-f.y)/h);l=Math.max(l,C)}if(l===0)return;this.min=f,this.max=p;const x=this.max.sub(this.min);x.x=Math.max(x.x,1),x.y=Math.max(x.y,1);const w=Math.max(x.x,x.y)/l;this.cellsX=Math.max(1,Math.ceil(x.x/w)),this.cellsY=Math.max(1,Math.ceil(x.y/w)),this.xScale=1/w,this.yScale=1/w;const T=[];for(let C=0;C<this.triangleCount;C++){const M=e[i[3*C+0]].sub(this.min),L=e[i[3*C+1]].sub(this.min),O=e[i[3*C+2]].sub(this.min),V=Oa(Math.floor(Math.min(M.x,L.x,O.x)),this.xScale,this.cellsX),$=Oa(Math.floor(Math.max(M.x,L.x,O.x)),this.xScale,this.cellsX),W=Oa(Math.floor(Math.min(M.y,L.y,O.y)),this.yScale,this.cellsY),Q=Oa(Math.floor(Math.max(M.y,L.y,O.y)),this.yScale,this.cellsY),ee=new _t(0,0),U=new _t(0,0),Y=new _t(0,0),te=new _t(0,0);for(let oe=W;oe<=Q;++oe){ee.y=U.y=oe*w,Y.y=te.y=(oe+1)*w;for(let ve=V;ve<=$;++ve)ee.x=Y.x=ve*w,U.x=te.x=(ve+1)*w,(Fv(M,L,O,ee,U,te)||Fv(M,L,O,ee,te,Y))&&T.push({cellIdx:oe*this.cellsX+ve,triIdx:C})}}if(T.length===0)return;T.sort((C,M)=>C.cellIdx-M.cellIdx||C.triIdx-M.triIdx);let I=0;for(;I<T.length;){const C=T[I].cellIdx,M={start:this.payload.length,len:0};for(;I<T.length&&T[I].cellIdx===C;)++M.len,this.payload.push(T[I++].triIdx);this.cells[C]=M}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const l=Oa(e.x-this.min.x,this.xScale,this.cellsX),h=Oa(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[h*this.cellsX+l];if(f){this._lazyInitLookup();for(let p=0;p<f.len;p++){const x=this.payload[f.start+p],w=Math.floor(x/8),T=1<<x%8;if(!(this.lookup[w]&T)&&(this.lookup[w]|=T,i.push(x),i.length===this.triangleCount))return}}}query(e,i,l){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Oa(e.x-this.min.x,this.xScale,this.cellsX),f=Oa(i.x-this.min.x,this.xScale,this.cellsX),p=Oa(e.y-this.min.y,this.yScale,this.cellsY),x=Oa(i.y-this.min.y,this.yScale,this.cellsY);for(let w=p;w<=x;w++)for(let T=h;T<=f;T++){const I=this.cells[w*this.cellsX+T];if(I)for(let C=0;C<I.len;C++){const M=this.payload[I.start+C],L=Math.floor(M/8),O=1<<M%8;if(!(this.lookup[L]&O)&&(this.lookup[L]|=O,l.push(M),l.length===this.triangleCount))return}}}}function Oa(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Ct(Kv,"TriangleGridIndex");class eT{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview}updateFootprints(e,i){for(const l of this.footprints)i.push({footprint:l,id:e})}populate(e,i,l,h){const f=[];for(const{feature:p,id:x,index:w,sourceLayerIndex:T}of e){const I=this.layers[0]._featureFilter.needGeometry,C=Et(p,I);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),C,l))continue;const M={id:x,properties:p.properties,type:p.type,sourceLayerIndex:T,index:w,geometry:I?C.geometry:Pt(p,l,h),patterns:{}};f.push(M)}for(const p of f){const{geometry:x,index:w,sourceLayerIndex:T}=p;this.addFeature(p,x,w,l,{},i.availableImages,i.brightness),i.featureIndex.insert(e[w].feature,x,w,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,l,h,f,p,x){}destroy(){}addFeature(e,i,l,h,f,p=[],x){for(const w of Bg(i,2)){const T=[],I=[],C=[],M=new _t(1/0,1/0),L=new _t(-1/0,-1/0);for(const $ of w)if($.length!==0){$!==w[0]&&C.push(I.length/2);for(let W=0;W<$.length;W++)I.push($[W].x),I.push($[W].y),T.push($[W]),M.x=Math.min(M.x,$[W].x),M.y=Math.min(M.y,$[W].y),L.x=Math.max(L.x,$[W].x),L.y=Math.max(L.y,$[W].y)}const O=Xp(I,C),V=new Kv(T,O,8,256);this.footprints.push({vertices:T,indices:O,grid:V,min:M,max:L})}}}Ct(eT,"ClipBucket",{omit:["layers"]});const ID=Xi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),CD=Xi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),MD=Xi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),PD=Xi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),DD=Xi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),RD=Xi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:LD}=ID,Vg=Number.MAX_SAFE_INTEGER;function tT(r,e,i,l){return r.order<e||r.order===Vg||!(r.clipMask&i)||function(h,f){return f.length!==0&&f.find(p=>p===h)===void 0}(l,r.clipScope)}function Ug(r,e){return r.x-e.x||r.y-e.y}function iT(r,e){return Ug(r.min,e.min)===0&&Ug(r.max,e.max)===0}function Jv(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function Qv(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!iT(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!jo(r[i].clipScope,e[i].clipScope))return!1;return!0}function nT(r,e,i){const l=1/yt,h=1/(1<<i.canonical.z),f=(e.x*l+i.canonical.x)*h+i.wrap,p=(e.y*l+i.canonical.y)*h;return{min:new _t((r.x*l+i.canonical.x)*h+i.wrap,(r.y*l+i.canonical.y)*h),max:new _t(f,p)}}function zD(r,e,i){const l=1<<i.canonical.z,h=((e.x-i.wrap)*l-i.canonical.x)*yt,f=(e.y*l-i.canonical.y)*yt;return{min:new _t(((r.x-i.wrap)*l-i.canonical.x)*yt,(r.y*l-i.canonical.y)*yt),max:new _t(h,f)}}function sT(r,e,i,l,h,f,p){const x=r.indices,w=r.vertices,T=[];for(let I=l;I<l+h;I+=3){const C=e[i[I+0]+f],M=e[i[I+1]+f],L=e[i[I+2]+f],O=Math.min(C.x,M.x,L.x),V=Math.max(C.x,M.x,L.x),$=Math.min(C.y,M.y,L.y),W=Math.max(C.y,M.y,L.y);T.length=0,r.grid.query(new _t(O,$),new _t(V,W),T);for(let Q=0;Q<T.length;Q++){const ee=T[Q];if(Fv(w[x[3*ee+0]],w[x[3*ee+1]],w[x[3*ee+2]],C,M,L,p))return!0}}return!1}function rT(r,e,i,l){if(!r||!i)return!1;let h=r.vertices;if(!e.canonical.equals(l.canonical)||e.wrap!==l.wrap){if(i.vertices.length<r.vertices.length)return rT(i,l,r,e);const f=e.canonical,p=l.canonical,x=Math.pow(2,p.z-f.z);h=r.vertices.map(w=>new _t((w.x+f.x*yt)*x-p.x*yt,(w.y+f.y*yt)*x-p.y*yt))}return sT(i,h,r.indices,0,r.indices.length,0,0)}function oT(r,e,i,l){const h=Math.pow(2,l.z-i.z);return new _t((r+i.x*yt)*h-l.x*yt,(e+i.y*yt)*h-l.y*yt)}function aT(r,e){const i=[];e.grid.queryPoint(r,i);const l=e.indices,h=e.vertices;for(let f=0;f<i.length;f++){const p=i[f];if(Mo([h[l[3*p+0]],h[l[3*p+1]],h[l[3*p+2]]],r))return!0}return!1}const e0=[new _t(0,0),new _t(yt,0),new _t(yt,yt),new _t(0,yt)];function lT(r,e){const i=[];let l=[];if(!e||r.length<2)return[r];if(r.length===2)return bl(r[0],r[1],e0)?[r]:[];for(let h=0;h<r.length+2;h++){const f=r[h%r.length],p=r[(h+1)%r.length],x=bl(h===0?r[r.length-1]:r[(h-1)%r.length],f,e0),w=bl(f,p,e0),T=x||w;T&&l.push(f),T&&w||l.length>0&&(l.length>1&&i.push(l),l=[])}return l.length>1&&i.push(l),i}const t0=Mi.VectorTileFeature.types,OD=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],kD=["fill-extrusion-flood-light-ground-radius"],FD=Math.pow(2,13),BD=Math.pow(2,15)-1,cT=new _t(0,1),Ec=2147483648;function em(r,e,i,l,h,f,p,x){r.emplaceBack((e<<1)+p,(i<<1)+f,(Math.floor(l*FD)<<1)+h,Math.round(x))}function tm(r,e,i){r.emplaceBack(e.x*yt,e.y*yt,i?1:0)}function jg(r,e,i,l,h,f){r.emplaceBack(e.x,e.y,(i.x<<1)+l,(i.y<<1)+h,f)}function im(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class hT{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class uT{constructor(){this.centroidXY=new _t(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new _t(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new _t(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new _t(this.max.x-this.min.x,this.max.y-this.min.y)}}class dT{constructor(){this.acc=new _t(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,l){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===yt)&&i.x===l.x)!=((i.y===0||i.y===yt)&&i.y===l.y)&&this.processBorderOverlap(i,l),h&&this.checkBorderIntersection(i,l)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ri(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>yt!=e.x>yt&&this.addBorderIntersection(1,ri(i.y,e.y,(yt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ri(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>yt!=e.y>yt&&this.addBorderIntersection(3,ri(i.x,e.x,(yt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[e];i<l[0]&&(l[0]=i),i>l[1]&&(l[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const l=e.x===0?0:1;this.addBorderIntersection(l,i.y),this.addBorderIntersection(l,e.y)}else{const l=e.y===0?2:3;this.addBorderIntersection(l,i.x),this.addBorderIntersection(l,e.x)}}centroid(){return this.accCount===0?new _t(0,0):new _t(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function fT(r,e){const i=r.add(e)._unit(),l=de(r.x*i.x+r.y*i.y,-1,1);var h,f,p;return h=Math.acos(l),Math.min(4,Math.max(-4,Math.tan(h)))/4*BD*((f=r).x*(p=e).y-f.y*p.x<0?-1:1)}const ND=[r=>r.x<0,r=>r.x>yt,r=>r.y<0,r=>r.y>yt];function VD(r,e,i,l){const h=[4];if(l===0)return h;i._mult(l);const f=r.sub(i),p=e.sub(i),x=[r,e,f,p];for(let w=0;w<4;w++)for(const T of x)if(ND[w](T)){h.push(w);break}return h}class pT{constructor(e){this.vertexArray=new fc,this.indexArray=new Gs,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut},i=>kD.includes(i)),this._segments=new ts,this.hiddenByLandmarkVertexArray=new Sd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new ts}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,l,h=!1){const f=e.length;if(f>2){let p=Math.max(0,this._segments.get().length-1);const x=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[p].length);let w;p!==this._segments.get().length-1&&(p++,this._segmentToGroundQuads[p]=[],this._segmentToRegionTriCounts[p]=[0,0,0,0,0]);{const T=e[0],I=e[1];w=fT(T.sub(e[f-1])._perp()._unit(),I.sub(T)._perp()._unit())}for(let T=0;T<f;T++){const I=T===f-1?0:T+1,C=e[T],M=e[I],L=e[I===f-1?0:I+1],O=M.sub(C)._perp()._unit(),V=fT(O,L.sub(M)._perp()._unit()),$=w,W=V;if(i0(C,M,i)||h&&gT(C,i)&&gT(M,i)){w=V;continue}const Q=x.vertexLength;jg(this.vertexArray,C,M,1,1,$),jg(this.vertexArray,C,M,1,0,$),jg(this.vertexArray,C,M,0,1,W),jg(this.vertexArray,C,M,0,0,W),x.vertexLength+=4;const ee=VD(C,M,O,l);for(const U of ee)this._segmentToGroundQuads[p].push({id:Q,region:U}),this._segmentToRegionTriCounts[p][U]+=2,x.primitiveLength+=2;w=V}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let l=0;l<i;l++)this._segmentToGroundQuads[l].sort((h,f)=>h.region-f.region);for(let l=0;l<i;l++){const h=this._segmentToGroundQuads[l],f=e[l],p=this._segmentToRegionTriCounts[l];p.reduce((w,T)=>w+T,0);let x=0;for(let w=0;w<=4;w++){const T=p[w];if(T!==0){let I=this.regionSegments[w];I||(I=this.regionSegments[w]=new ts);const C={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+x,vertexLength:f.vertexLength,primitiveLength:T};I.get().push(C)}x+=T}for(let w=0;w<h.length;w++){const T=h[w].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,l,h,f,p,x){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,l,h,f,p,void 0,x)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,CD.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,l,h,f,p,x,w){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,l,h,f,p,x,w)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const l=e.flags&Ec?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,l);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,DD.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class $g{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Gs,this.footprintVertices=new ea,this.footprintSegments=[],this.layoutVertexArray=new dc,this.centroidVertexArray=new Sg,this.wallVertexArray=new Ag,this.indexArray=new Gs,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut},i=>OD.includes(i)),this.segments=new ts,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new pT(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,h){this.features=[],this.hasPattern=Wv("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=je(l),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:p,index:x,sourceLayerIndex:w}of e){const T=this.layers[0]._featureFilter.needGeometry,I=Et(f,T);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),I,l))continue;const C={id:p,sourceLayerIndex:w,index:x,geometry:T?I.geometry:Pt(f,l,h),properties:f.properties,type:f.type,patterns:{}},M=this.layoutVertexArray.length,L=t0[C.type]==="Polygon";if(this.hasPattern)this.features.push(qv("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,i));else if(this.wallMode)for(const O of C.geometry)for(const V of lT(O,L))this.addFeature(C,[V],x,l,{},i.availableImages,h,i.brightness);else this.addFeature(C,C.geometry,x,l,{},i.availableImages,h,i.brightness);i.featureIndex.insert(f,C.geometry,x,w,this.index,M)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,l,h,f,p){for(const x of this.features){const w=t0[x.type]==="Polygon",{geometry:T}=x;if(this.wallMode)for(const I of T)for(const C of lT(I,w))this.addFeature(x,[C],x.index,i,l,h,f,p);else this.addFeature(x,T,x.index,i,l,h,f,p)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,l,h,f,p,x){this.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,this.worldview),this.groundEffect.update(e,i,f,l,h,p,x,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,LD),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,PD.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,RD.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,MD.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,l,h,f,p,x,w){const T=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,I=[new _t(0,0),new _t(yt,yt)],C=x.projection,M=C.name==="globe",L=this.wallMode||t0[e.type]==="Polygon",O=new dT;O.centroidDataIndex=this.centroidData.length;const V=new uT,$=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,W=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);let Q;if(V.height=W,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new bd),this.wallMode){if(M)return void Si("Non zero fill-extrusion-line-width is not yet supported on globe.");if(i.length!==1)return;Q=function(be){const Me=be[0].x===be[be.length-1].x&&be[0].y===be[be.length-1].y;(function(bt){let ct=0;const di=bt.length;for(let Lt=0;Lt<di;Lt++)ct+=(bt[(Lt+1)%di].x-bt[Lt].x)*(bt[(Lt+1)%di].y+bt[Lt].y);return ct>=0})(be)||(be=be.reverse());const ot={geometry:[],joinNormals:[],indices:[]},Qe=[],rt=[],at=[];let He=be.length;for(;He>=2&&be[He-1].equals(be[He-2]);)He--;if(He<(Me?3:2))return ot;let nt,Ue,Ge,ht,dt,Yt=0;for(;Yt<He-1&&be[Yt].equals(be[Yt+1]);)Yt++;Me&&(nt=be[He-2],dt=be[Yt].sub(nt)._unit()._perp());for(let bt=Yt;bt<He;bt++){if(Ge=bt===He-1?Me?be[Yt+1]:void 0:be[bt+1],Ge&&be[bt].equals(Ge))continue;dt&&(ht=dt),nt&&(Ue=nt),nt=be[bt],dt=Ge?Ge.sub(nt)._unit()._perp():ht,ht=ht||dt;let ct=ht.add(dt);ct.x===0&&ct.y===0||ct._unit();const di=ct.x*dt.x+ct.y*dt.y,Lt=di!==0?1/di:1/0,Ft=ht.x*dt.y-ht.y*dt.x>0;let oi="miter";const wi=2;oi==="miter"&&Lt>wi&&(oi="bevel"),oi==="bevel"&&(Lt>100&&(oi="flipbevel"),Lt<wi&&(oi="miter"));const bi=(Ri,Ai,Li,ln)=>{const Mn=new _t(Ri.x,Ri.y),ne=new _t(Ri.x,Ri.y);Mn.x+=Ai.x*ln,Mn.y+=Ai.y*ln,ne.x-=Ai.x*Math.max(Li,1),ne.y-=Ai.y*Math.max(Li,1),at.push(Ai),Qe.push(Mn),rt.push(ne)};if(oi==="miter")ct._mult(Lt),bi(nt,ct,0,0);else if(oi==="flipbevel")ct=dt.mult(-1),bi(nt,ct,0,0),bi(nt,ct.mult(-1),0,0);else{const Ri=-Math.sqrt(Lt*Lt-1),Ai=Ft?Ri:0,Li=Ft?0:Ri;Ue&&bi(nt,ht,Ai,Li),Ge&&bi(nt,dt,Ai,Li)}}ot.geometry=[...Qe,...rt.reverse(),Qe[0]],ot.joinNormals=[...at,...at.reverse(),at[at.length-1]];const Ot=ot.geometry.length-1;for(let bt=0;bt<Ot/2;bt++)if(bt+1<Ot/2){let ct=bt,di=bt+1,Lt=Ot-1-bt,Ft=Ot-2-bt;ct=ct===0?Ot-1:ct-1,di=di===0?Ot-1:di-1,Lt=Lt===0?Ot-1:Lt-1,Ft=Ft===0?Ot-1:Ft-1,ot.indices.push(Lt),ot.indices.push(di),ot.indices.push(ct),ot.indices.push(Lt),ot.indices.push(Ft),ot.indices.push(di)}return ot}(i[0]),i=[Q.geometry]}const ee=(be,Me)=>be<(Me.length-1)/2||be===Me.length-1,U=this.wallMode?[i]:Bg(i,500);for(let be=U.length-1;be>=0;be--){const Me=U[be];(Me.length===0||(Y=Me[0]).every($e=>$e.x<=0)||Y.every($e=>$e.x>=yt)||Y.every($e=>$e.y<=0)||Y.every($e=>$e.y>=yt))&&U.splice(be,1)}var Y;let te;if(M)te=bT(U,I,h);else{te=[];for(const be of U)te.push({polygon:be,bounds:I})}const oe=L?this.edgeRadius:0,ve=oe>0&&this.zoom<17,ge=(be,Me)=>{if(be.length===0)return!1;const $e=be[be.length-1];return Me.x===$e.x&&Me.y===$e.y};for(const{polygon:be,bounds:Me}of te){let $e=0,ot=0;for(const He of be)L&&!He[0].equals(He[He.length-1])&&He.push(He[0]),ot+=L?He.length-1:He.length;const Qe=this.segments.prepareSegment((L?5:4)*ot,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},at=new hT;if(at.vertexOffset=this.footprintVertices.length,at.indexOffset=3*this.footprintIndices.length,at.ringIndices=[],L){const He=[],nt=[];$e=Qe.vertexLength;for(let Ge=0;Ge<be.length;Ge++){const ht=be[Ge];ht.length&&Ge!==0&&nt.push(He.length/2);const dt=[];let Yt,Ot;Yt=ht[1].sub(ht[0])._perp()._unit(),at.ringIndices.push(ht.length-1);for(let bt=1;bt<ht.length;bt++){const ct=ht[bt],di=ht[bt===ht.length-1?1:bt+1],Lt=ct.clone();if(oe){Ot=di.sub(ct)._perp()._unit();const Ft=Yt.add(Ot)._unit(),oi=oe*Math.min(4,1/(Yt.x*Ft.x+Yt.y*Ft.y));Lt.x+=oi*Ft.x,Lt.y+=oi*Ft.y,Lt.x=Math.round(Lt.x),Lt.y=Math.round(Lt.y),Yt=Ot}if(!$||oe!==0&&!ve||ge(dt,Lt)||dt.push(Lt),em(this.layoutVertexArray,Lt.x,Lt.y,0,0,1,1,0),this.wallMode){const Ft=ee(bt,ht);tm(this.wallVertexArray,Q.joinNormals[bt],!Ft)}Qe.vertexLength++,this.footprintVertices.emplaceBack(ct.x,ct.y),He.push(ct.x,ct.y),M&&im(this.layoutVertexExtArray,C.projectTilePoint(Lt.x,Lt.y,h),C.upVector(h,Lt.x,Lt.y))}$&&(oe===0||ve)&&(dt.length!==0&&ge(dt,dt[0])&&dt.pop(),this.groundEffect.addData(dt,Me,T))}const Ue=this.wallMode?Q.indices:Xp(He,nt);for(let Ge=0;Ge<Ue.length;Ge+=3)this.footprintIndices.emplaceBack(at.vertexOffset+Ue[Ge+0],at.vertexOffset+Ue[Ge+1],at.vertexOffset+Ue[Ge+2]),this.indexArray.emplaceBack($e+Ue[Ge],$e+Ue[Ge+2],$e+Ue[Ge+1]),Qe.primitiveLength++;at.indexCount+=Ue.length,at.vertexCount+=this.footprintVertices.length-at.vertexOffset}for(let He=0;He<be.length;He++){const nt=be[He];O.startRing(V,nt[0]);let Ue=nt.length>4&&yT(nt[nt.length-2],nt[0],nt[1]),Ge=oe?UD(nt[nt.length-2],nt[0],nt[1],oe):0;const ht=[];let dt,Yt,Ot;Yt=nt[1].sub(nt[0])._perp()._unit();let bt=!0;for(let ct=1,di=0;ct<nt.length;ct++){let Lt=nt[ct-1],Ft=nt[ct];const oi=nt[ct===nt.length-1?1:ct+1];if(O.appendEdge(V,Ft,Lt),i0(Ft,Lt,Me)){oe&&(Yt=oi.sub(Ft)._perp()._unit(),bt=!bt);continue}const wi=Ft.sub(Lt)._perp(),bi=wi.x/(Math.abs(wi.x)+Math.abs(wi.y)),Ri=wi.y>0?1:0,Ai=Lt.dist(Ft);if(di+Ai>32768&&(di=0),oe){Ot=oi.sub(Ft)._perp()._unit();let ne=_T(Lt,Ft,oi,mT(Yt,Ot),oe);isNaN(ne)&&(ne=0);const ae=Ft.sub(Lt)._unit();Lt=Lt.add(ae.mult(Ge))._round(),Ft=Ft.add(ae.mult(-ne))._round(),Ge=ne,Yt=Ot,$&&this.zoom>=17&&(ge(ht,Lt)||ht.push(Lt),ge(ht,Ft)||ht.push(Ft))}const Li=Qe.vertexLength,ln=nt.length>4&&yT(Lt,Ft,oi);let Mn=xT(di,Ue,bt);if(em(this.layoutVertexArray,Lt.x,Lt.y,bi,Ri,0,0,Mn),em(this.layoutVertexArray,Lt.x,Lt.y,bi,Ri,0,1,Mn),this.wallMode){const ne=ee(ct-1,nt),ae=Q.joinNormals[ct-1];tm(this.wallVertexArray,ae,ne),tm(this.wallVertexArray,ae,ne)}if(di+=Ai,Mn=xT(di,ln,!bt),Ue=ln,em(this.layoutVertexArray,Ft.x,Ft.y,bi,Ri,0,0,Mn),em(this.layoutVertexArray,Ft.x,Ft.y,bi,Ri,0,1,Mn),this.wallMode){const ne=ee(ct,nt),ae=Q.joinNormals[ct];tm(this.wallVertexArray,ae,ne),tm(this.wallVertexArray,ae,ne)}if(Qe.vertexLength+=4,this.indexArray.emplaceBack(Li+0,Li+1,Li+2),this.indexArray.emplaceBack(Li+1,Li+3,Li+2),Qe.primitiveLength+=2,oe){const ne=$e+(ct===1?nt.length-2:ct-2),ae=ct===1?$e:ne+1;if(this.indexArray.emplaceBack(Li+1,ne,Li+3),this.indexArray.emplaceBack(ne,ae,Li+3),Qe.primitiveLength+=2,dt===void 0&&(dt=Li),!i0(oi,nt[ct],Me)){const We=ct===nt.length-1?dt:Qe.vertexLength;this.indexArray.emplaceBack(Li+2,Li+3,We),this.indexArray.emplaceBack(Li+3,We+1,We),this.indexArray.emplaceBack(Li+3,ae,We+1),Qe.primitiveLength+=3}bt=!bt}if(M){const ne=this.layoutVertexExtArray,ae=C.projectTilePoint(Lt.x,Lt.y,h),We=C.projectTilePoint(Ft.x,Ft.y,h),pt=C.upVector(h,Lt.x,Lt.y),wt=C.upVector(h,Ft.x,Ft.y);im(ne,ae,pt),im(ne,ae,pt),im(ne,We,wt),im(ne,We,wt)}}L&&($e+=nt.length-1),$&&oe&&this.zoom>=17&&(ht.length!==0&&ge(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Me,T,oe>0))}this.footprintSegments.push(at),rt.triangleCount=this.indexArray.length-rt.triangleArrayOffset,this.polygonSegments.push(rt),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=O.borders?cT:this.encodeCentroid(O,V),this.centroidData.push(V),O.borders){this.featuresOnBorder.push(O);const be=this.featuresOnBorder.length-1;for(let Me=0;Me<O.borders.length;Me++)O.borders[Me][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Me].push(be)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,p,h,w,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(e,l,f,p,h,w,this.worldview),this.maxHeight=Math.max(this.maxHeight,W)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,l)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[l].borders[e][0])}splitToSubtiles(){const e=[];for(let x=0;x<this.centroidData.length;x++){const w=this.centroidData[x],T=+(w.min.y+w.max.y>yt),I=2*T+(+(w.min.x+w.max.x>yt)^T);for(let C=0;C<w.polygonSegLen;C++){const M=w.polygonSegIdx+C;e.push({centroidIdx:x,subtile:I,polygonSegmentIdx:M,triangleSegmentIdx:this.polygonSegments[M].triangleSegIdx})}}const i=new Gs;e.sort((x,w)=>x.triangleSegmentIdx===w.triangleSegmentIdx?x.subtile-w.subtile:x.triangleSegmentIdx-w.triangleSegmentIdx);let l=0,h=0,f=0;for(const x of e){if(x.triangleSegmentIdx!==l)break;f++}const p=e.length;for(;h!==e.length;){l=e[h].triangleSegmentIdx;let x=0,w=h,T=h;for(let I=w;I<f&&e[I].subtile===x;I++)T++;for(;w!==f;){const I=e[w];x=I.subtile;const C=this.centroidData[I.centroidIdx].min.clone(),M=this.centroidData[I.centroidIdx].max.clone(),L={vertexOffset:this.segments.segments[l].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[l].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let O=w;O<T;O++){const V=e[O],$=this.polygonSegments[V.polygonSegmentIdx],W=this.centroidData[V.centroidIdx].min,Q=this.centroidData[V.centroidIdx].max,ee=this.indexArray.uint16;for(let U=$.triangleArrayOffset;U<$.triangleArrayOffset+$.triangleCount;U++)i.emplaceBack(ee[3*U],ee[3*U+1],ee[3*U+2]);L.primitiveLength+=$.triangleCount,C.x=Math.min(C.x,W.x),C.y=Math.min(C.y,W.y),M.x=Math.max(M.x,Q.x),M.y=Math.max(M.y,Q.y)}L.primitiveLength>0&&this.triangleSubSegments.push({segment:L,min:C,max:M}),w=T;for(let O=w;O<f&&e[O].subtile===e[w].subtile;O++)T++}h=f;for(let I=h;I<p&&e[I].triangleSegmentIdx===e[h].triangleSegmentIdx;I++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,l){const h=new ts;if(this.wallMode){for(const V of this.triangleSubSegments)h.segments.push(V.segment);return h}let f=0,p=0;const x=1<<e.canonical.z;if(i){const V=i.getMinMaxForTile(e);V&&(f=V.min,p=V.max)}p+=this.maxHeight;const w=e.toUnwrapped();let T;const I=[w.canonical.x/x+w.wrap,w.canonical.y/x],C=[(w.canonical.x+1)/x+w.wrap,(w.canonical.y+1)/x],M=(V,$,W)=>[V[0]*(1-W[0])+$[0]*W[0],V[1]*(1-W[1])+$[1]*W[1]],L=[],O=[];for(const V of this.triangleSubSegments){L[0]=V.min.x/yt,L[1]=V.min.y/yt,O[0]=V.max.x/yt,O[1]=V.max.y/yt;const $=M(I,C,L),W=M(I,C,O);if(new Ki([$[0],$[1],f],[W[0],W[1],p]).intersectsPrecise(l)===0){T&&(h.segments.push(T),T=void 0);continue}const Q=V.segment;T&&T.vertexOffset!==Q.vertexOffset&&(h.segments.push(T),T=void 0),T?(T.vertexLength+=Q.vertexLength,T.primitiveLength+=Q.primitiveLength):T={vertexOffset:Q.vertexOffset,primitiveLength:Q.primitiveLength,vertexLength:Q.vertexLength,primitiveOffset:Q.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&h.segments.push(T),h}encodeCentroid(e,i){const l=e.centroid(),h=i.span(),f=Math.min(7,Math.round(h.x*this.tileToMeter/10)),p=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new _t(de(l.x,1,yt-1)<<3|f,de(l.y,1,yt-1)<<3|p)}encodeBorderCentroid(e){if(!e.borders)return new _t(0,0);const i=e.borders,l=Number.MAX_VALUE;if(i[0][0]!==l||i[1][0]!==l){const h=i[0][0]!==l?0:1;return new _t(6|(i[0][0]!==l?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==l?2:3;return new _t((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==l?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=Ec,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,l=e.vertexCount+e.vertexArrayOffset,h=e.flags&Ec?cT:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||f!==h.x){for(let p=i;p<l;++p)this.centroidVertexArray.emplace(p,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,l){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(e.toUnwrapped());if(Qv(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const f=[];for(const p of this.activeReplacements){if(p.order<l)continue;const x=Math.max(1,Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z));for(const w of this.centroidData)if(!(w.flags&Ec||p.min.x>w.max.x||w.min.x>p.max.x||p.min.y>w.max.y||w.min.y>p.max.y))for(let T=0;T<w.footprintSegLen;T++){const I=this.footprintSegments[w.footprintSegIdx+T];if(f.length=0,jD(this.footprintVertices,I.vertexOffset,I.vertexCount,p.footprintTileId.canonical,e.canonical,f),sT(p.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-x)){w.flags|=Ec;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,l){let h=!1;for(let f=0;f<l.footprintSegLen;f++){const p=this.footprintSegments[l.footprintSegIdx+f];let x=0;for(const w of p.ringIndices){for(let T=x,I=w+x-1;T<w+x;I=T++){const C=this.footprintVertices.int16[2*(T+p.vertexOffset)+0],M=this.footprintVertices.int16[2*(T+p.vertexOffset)+1],L=this.footprintVertices.int16[2*(I+p.vertexOffset)+1];M>i!=L>i&&e<(this.footprintVertices.int16[2*(I+p.vertexOffset)+0]-C)*(i-M)/(L-M)+C&&(h=!h)}x=w}}return h}getHeightAtTileCoord(e,i){let l=Number.NEGATIVE_INFINITY,h=!0;const f=4*(e+yt)*yt+(i+yt);if(this.partLookup.hasOwnProperty(f)){const p=this.partLookup[f];return p?{height:p.height,hidden:!!(p.flags&Ec)}:void 0}for(const p of this.centroidData)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||this.footprintContainsPoint(e,i,p)&&p&&p.height>l&&(l=p.height,this.partLookup[f]=p,h=!!(p.flags&Ec));if(l!==Number.NEGATIVE_INFINITY)return{height:l,hidden:h};this.partLookup[f]=void 0}}function mT(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function UD(r,e,i,l){const h=e.sub(r)._perp()._unit(),f=i.sub(e)._perp()._unit();return _T(r,e,i,mT(h,f),l)}function _T(r,e,i,l,h){const f=Math.sqrt(1-l*l);return Math.min(r.dist(e)/3,e.dist(i)/3,h*f/l)}function i0(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function gT(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function yT(r,e,i){if(r.x<0||r.x>=yt||e.x<0||e.x>=yt||i.x<0||i.x>=yt)return!1;const l=i.sub(e),h=l.perp(),f=r.sub(e);return(l.x*f.x+l.y*f.y)/Math.sqrt((l.x*l.x+l.y*l.y)*(f.x*f.x+f.y*f.y))>-.866&&h.x*f.x+h.y*f.y<0}function xT(r,e,i){const l=e?2|r:-3&r;return i?1|l:-2&l}function vT(){const r=Math.PI/32,e=Math.tan(r),i=H;return i*Math.sqrt(1+2*e*e)-i}function bT(r,e,i){const l=1<<i.z,h=ye(i.x/l),f=ye((i.x+1)/l),p=Le(i.y/l),x=Le((i.y+1)/l);return function(w,T,I,C,M=0,L){const O=[];if(!w.length||!I||!C)return O;const V=(te,oe)=>{for(const ve of te)O.push({polygon:ve,bounds:oe})},$=Math.ceil(Math.log2(I)),W=Math.ceil(Math.log2(C)),Q=$-W,ee=[];for(let te=0;te<Math.abs(Q);te++)ee.push(Q>0?0:1);for(let te=0;te<Math.min($,W);te++)ee.push(0),ee.push(1);let U=w;if(U=Ng(U,T[0].y-M,T[1].y+M,1),U=Ng(U,T[0].x-M,T[1].x+M,0),!U.length)return O;const Y=[];for(ee.length?Y.push({polygons:U,bounds:T,depth:0}):V(U,T);Y.length;){const te=Y.pop(),oe=te.depth,ve=ee[oe],ge=te.bounds[0],be=te.bounds[1],Me=ve===0?ge.x:ge.y,$e=ve===0?be.x:be.y,ot=L?L(ve,Me,$e):.5*(Me+$e),Qe=Ng(te.polygons,Me-M,ot+M,ve),rt=Ng(te.polygons,ot-M,$e+M,ve);if(Qe.length){const at=[ge,new _t(ve===0?ot:be.x,ve===1?ot:be.y)];ee.length>oe+1?Y.push({polygons:Qe,bounds:at,depth:oe+1}):V(Qe,at)}if(rt.length){const at=[new _t(ve===0?ot:ge.x,ve===1?ot:ge.y),be];ee.length>oe+1?Y.push({polygons:rt,bounds:at,depth:oe+1}):V(rt,at)}}return O}(r,e,Math.ceil((f-h)/11.25),Math.ceil((p-x)/11.25),1,(w,T,I)=>{if(w===0)return .5*(T+I);{const C=Le((i.y+T/yt)/l);return(he(.5*(Le((i.y+I/yt)/l)+C))*l-i.y)*yt}})}function jD(r,e,i,l,h,f){const p=Math.pow(2,l.z-h.z);for(let x=0;x<i;x++){let w=r.int16[2*(x+e)+0],T=r.int16[2*(x+e)+1];w=(w+h.x*yt)*p-l.x*yt,T=(T+h.y*yt)*p-l.y*yt,f.push(new _t(w,T))}}let wT,TT;Ct($g,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(uT,"PartData"),Ct(hT,"FootprintSegment"),Ct(dT,"BorderCentroidData"),Ct(pT,"GroundEffect");class Jh extends _t{constructor(e,i,l){super(e,i),this.z=l}}class ST extends Jh{constructor(e,i,l,h){super(e,i,l),this.w=h}}function ET(r,e,i,l){const h=i==="x"?"y":"x",f=(l-r[i])/(e[i]-r[i]);r[h]=Math.round(r[h]+(e[h]-r[h])*f),r[i]=l,r.hasOwnProperty("z")&&(r.z=ri(r.z,e.z,f)),r.hasOwnProperty("w")&&(r.w=ri(r.w,e.w,f))}function AT(r,e,i,l){const h=i,f=l;for(const p of["x","y"]){let x=r,w=e;x[p]>=w[p]&&(x=e,w=r),x[p]<h&&w[p]>h&&ET(x,w,p,h),x[p]<f&&w[p]>f&&ET(w,x,p,f)}}function Gg(r,e,i,l,h,f){const p=[];for(let x=0;x<r.length;x++){const w=r[x];let T;const I=p.length;let C=0;for(let M=0;M<w.length-1;M++){let L=w[M],O=w[M+1],V=0;const $=C;let W,Q;f&&(V=Math.hypot(O.x-L.x,O.y-L.y),C+=V,W=L,Q=O),L.x<e&&O.x<e||(L.x<e?L=new _t(e,L.y+(e-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x<e&&(O=new _t(e,L.y+(e-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y<i&&O.y<i||(L.y<i?L=new _t(L.x+(i-L.y)/(O.y-L.y)*(O.x-L.x),i)._round():O.y<i&&(O=new _t(L.x+(i-L.y)/(O.y-L.y)*(O.x-L.x),i)._round()),L.x>=l&&O.x>=l||(L.x>=l?L=new _t(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round():O.x>=l&&(O=new _t(l,L.y+(l-L.x)/(O.x-L.x)*(O.y-L.y))._round()),L.y>=h&&O.y>=h||(L.y>=h?L=new _t(L.x+(h-L.y)/(O.y-L.y)*(O.x-L.x),h)._round():O.y>=h&&(O=new _t(L.x+(h-L.y)/(O.y-L.y)*(O.x-L.x),h)._round()),T&&L.equals(T[T.length-1])||(T=[L],p.push(T),f&&f.push({progress:{min:$+IT(W,Q,L)*V,max:1},parentIndex:x,prevPoint:W,nextPoint:Q})),T.push(O),f&&(f[f.length-1].progress.max=$+IT(W,Q,O)*V,f[f.length-1].nextPoint=Q)))))}if(f&&C>0)for(let M=I;M<p.length;M++)f[M].progress.min/=C,f[M].progress.max/=C}return p}function $D(r,e,i,l,h){if(r.length<2)return void l.push(r);const f=[];for(;e.valid();){const[T,I]=e.get();for(let C=0;C<r.length-1;C++){const M=r[C],L=r[C+1],O=Wp(M,L,T,I);if(O){const[V]=O,$=new _t(ri(M.x,L.x,V),ri(M.y,L.y,V));f.push({t:C+V,distance:0,point:$})}}e.next()}if(f.length===0)return void l.push(r);f.sort((T,I)=>T.t-I.t);let p=0,x=0,w=[];for(l.push(w);p!==r.length;){if(x===f.length){for(;p!==r.length;)w.length!==0&&w[w.length-1].equals(r[p])||w.push(r[p]),p++;break}f[x].t<=p?(w.length!==0&&w[w.length-1].equals(f[x].point)||w.push(f[x].point),Math.trunc(f[x].t),x++):(w.length!==0&&w[w.length-1].equals(r[p])||w.push(r[p]),p++)}}function IT(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function nm(r,e){return r.x*e.x+r.y*e.y}function CT(r,e){if(r.length===1){let i=0;const l=e[i++];let h;for(;!h||l.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const f=e[i],p=r[0],x=h.sub(l),w=f.sub(l),T=p.sub(l),I=nm(x,x),C=nm(x,w),M=nm(w,w),L=nm(T,x),O=nm(T,w),V=I*M-C*C,$=(M*L-C*O)/V,W=(I*O-C*L)/V,Q=l.z*(1-$-W)+h.z*$+f.z*W;if(isFinite(Q))return Q}return 1/0}{let i=1/0;for(const l of e)i=Math.min(i,l.z);return i}}function MT(r,e,i,l,h,f,p,x){const w=p*h.getElevationAt(r,e,!0,!0),T=f[0]!==0,I=T?f[1]===0?p*(f[0]/7-450):p*function(C,M,L){const O=Math.floor(M[0]/8),V=Math.floor(M[1]/8),$=10*(M[0]-8*O),W=10*(M[1]-8*V),Q=C.getElevationAt(O,V,!0,!0),ee=C.getMeterToDEM(L),U=Math.floor(.5*($*ee-1)),Y=Math.floor(.5*(W*ee-1)),te=C.tileCoordToPixel(O,V),oe=2*U+1,ve=2*Y+1,ge=function(rt,at,He,nt,Ue){return[rt.getElevationAtPixel(at,He,!0),rt.getElevationAtPixel(at+Ue,He,!0),rt.getElevationAtPixel(at,He+Ue,!0),rt.getElevationAtPixel(at+nt,He+Ue,!0)]}(C,te.x-U,te.y-Y,oe,ve),be=Math.abs(ge[0]-ge[1]),Me=Math.abs(ge[2]-ge[3]),$e=Math.abs(ge[0]-ge[2])+Math.abs(ge[1]-ge[3]),ot=Math.min(.25,.5*ee*(be+Me)/oe),Qe=Math.min(.25,.5*ee*$e/ve);return Q+Math.max(ot*$,Qe*W)}(h,f,x):w;return{base:w+(i===0?-1:i),top:T?Math.max(I+l,w+i+2):w+l}}class GD{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class HD{constructor(){this.tasks={},this.taskQueue=[],kt(["process"],this),this.invoker=new GD(this.process),this.nextId=0}add(e,i){const l=this.nextId++,h=function({type:f,isSymbolTile:p,zoom:x}){return x=x||0,f==="message"?0:f!=="maybePrepare"||p?f!=="parseTile"||p?f==="parseTile"&&p?300-x:f==="maybePrepare"&&p?400-x:500:200-x:100-x}(i);if(h===0){try{e()}finally{}return null}return this.tasks[l]={fn:e,metadata:i,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const f=this.tasks[this.taskQueue[h]];f.priority<i&&(i=f.priority,e=h)}if(e===null)return null;const l=this.taskQueue[e];return this.taskQueue.splice(e,1),l}remove(){this.invoker.remove()}}class PT{constructor(e,i,l){this.target=e,this.parent=i,this.mapId=l,this.callbacks={},this.cancelCallbacks={},kt(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new HD}send(e,i,l,h,f=!1,p){const x=Math.round(1e18*Math.random()).toString(36).substring(0,10);l&&(l.metadata=p,this.callbacks[x]=l);const w=new Set;return this.target.postMessage({id:x,type:e,hasCallback:!!l,targetMapId:h,mustQueue:f,sourceMapId:this.mapId,data:Ta(i,w)},w),{cancel:()=>{l&&delete this.callbacks[x],this.target.postMessage({id:x,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const l=i.id;if(l&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[l];delete this.cancelCallbacks[l],h&&h.cancel()}else if(i.mustQueue||hn(self)){const h=this.callbacks[l],f=this.scheduler.add(()=>this.processTask(l,i),h&&h.metadata||{type:"message"});f&&(this.cancelCallbacks[l]=f)}else this.processTask(l,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const l=this.callbacks[e];delete this.callbacks[e],l&&(i.error?l(Sa(i.error)):l(null,Sa(i.data)))}else{const l=new Set,h=i.hasCallback?(p,x)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:p?Ta(p):null,data:Ta(x,l)},l)}:()=>{},f=Sa(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,h);else if(this.parent.getWorkerSource){const p=i.type.split("."),{source:x,scope:w}=f;this.parent.getWorkerSource(i.sourceMapId,p[0],x,w)[p[1]](f,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var sm={workerUrl:"",workerClass:null,workerParams:void 0};const n0="mapboxgl_preloaded_worker_pool";class Qh{constructor(){this.active={}}acquire(e,i=Qh.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(sm.workerClass!=null?new sm.workerClass:new self.Worker(sm.workerUrl,sm.workerParams));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[n0]}numActive(){return Object.keys(this.active).length}}Qh.workerCount=2;class kd{constructor(e,i,l="Worker",h=Qh.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=Ve();const f=this.workerPool.acquire(this.id,h);for(let p=0;p<f.length;p++){const x=new kd.Actor(f[p],i,this.id);x.name=`${l} ${p}`,this.actors.push(x)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,l){Ee(this.actors,(h,f)=>{h.send(e,i,f)},l=l||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let rm,s0;function Hg(){return rm||(rm=new Qh),rm}kd.Actor=PT;class WD{constructor(e){this.module=e}createIntArray(e){const i=new Int32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,l/i.BYTES_PER_ELEMENT),l}createFloatArray(e){const i=new Float32Array(e),l=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,l/i.BYTES_PER_ELEMENT),l}createStringBuffer(e){const i=this.module.malloc(e.length+1);for(let l=0;l<e.length;++l)this.module.heapU8[i+l]=e.charCodeAt(l);return this.module.heapU8[i+e.length]=0,i}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.entranceColorRgb,l=e.facadeGlazingColorRgb,h=e.roofColorRgb,f=e.wallColorRgb,p=e.normalScale;this.module.setStyle(i[0],i[1],i[2],l[0],l[1],l[2],h[0],h[1],h[2],f[0],f[1],f[2],p[0],p[1],p[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setFacadeOptions(e,i,l){this.module.setFacadeOptions(e,i,l)}generateMesh(e,i){for(const x of e){const w=this.createStringBuffer(x.roofType),T=[0],I=[];for(const L of x.coordinates)if(Array.isArray(L)){for(const O of L)I.push(O.x),I.push(O.y);T.push(I.length)}const C=this.createIntArray(T),M=this.createFloatArray(I);this.module.addFeature(x.id,x.sourceId,x.minHeight,x.height,w,x.roofType.length,M,C,T.length-1),this.module.free(w),this.module.free(C),this.module.free(M)}for(const x of i){let w;w=x.entrances?JSON.parse(x.entrances):[];const T=this.createFloatArray(w),I=[];for(const M of x.coordinates)I.push(M.x),I.push(M.y);const C=this.createFloatArray(I);this.module.addFacade(x.sourceId,x.crossPerc,x.distanceToRoad,T,w.length,C,I.length),this.module.free(T),this.module.free(C)}if(!this.module.generateMesh()){const x=this.module.getLastError();return this.readStringBuffer(x)}const l=this.module.getMeshCount(),h=new Array(l);for(let x=0;x<l;x++){const w=this.module.getPositionsPtr(x),T=this.module.getPositionsLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T),C=this.module.getNormalsPtr(x),M=this.module.getNormalsLength(x),L=new Float32Array(this.module.heapF32.buffer,C,M),O=this.module.getColorsPtr(x),V=this.module.getColorsLength(x),$=new Uint8Array(this.module.heapU8.buffer,O,V),W=this.module.getAOPtr(x),Q=this.module.getAOLength(x),ee=new Float32Array(this.module.heapF32.buffer,W,Q),U=this.module.getIndicesPtr(x),Y=this.module.getIndicesLength(x),te=new Int32Array(this.module.heap32.buffer,U,Y),oe=this.module.getBuildingPart(x),ve=this.readStringBuffer(oe);h[x]={positions:I,normals:L,colors:$,ao:ee,indices:te,buildingPart:ve}}const f=this.module.getRingCount(),p=[];for(let x=0;x<f;x++){const w=this.module.getRingPtr(x),T=this.module.getRingLength(x),I=new Float32Array(this.module.heapF32.buffer,w,T);p.push(I)}return{meshes:h,modifiedPolygonRings:p}}}let om,r0,na,Fd,o0,Bd=null,Nd=null,DT=null,a0=null;function RT(){return hn(self)&&self.worker.dracoUrl?self.worker.dracoUrl:r0||js.DRACO_URL}function LT(){if(hn(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Fd)return Fd;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Fd=WebAssembly.validate(r)?js.MESHOPT_SIMD_URL:js.MESHOPT_URL,Fd}const Wg={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qD={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},am={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function zT(r,e,i){const l=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=l,i.json.bufferViews[l]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const l0="KHR_draco_mesh_compression";function ZD(r,e){const i=r.extensions&&r.extensions[l0];if(!i)return;const l=new na.Decoder,h=BT(e,i.bufferView),f=new na.Mesh;if(!l.DecodeArrayToMesh(h,h.byteLength,f))throw new Error("Failed to decode Draco mesh");const p=e.json.accessors[r.indices],x=Wg[p.componentType],w=p.count*x.BYTES_PER_ELEMENT,T=na._malloc(w);x===Uint16Array?l.GetTrianglesUInt16Array(f,w,T):l.GetTrianglesUInt32Array(f,w,T),zT(na.memory.buffer.slice(T,T+w),p,e),na._free(T);for(const I of Object.keys(i.attributes)){const C=l.GetAttributeByUniqueId(f,i.attributes[I]),M=e.json.accessors[r.attributes[I]],L=qD[M.componentType],O=M.count*am[M.type]*Wg[M.componentType].BYTES_PER_ELEMENT,V=na._malloc(O);l.GetAttributeDataArrayForAllPoints(f,C,na[L],O,V),zT(na.memory.buffer.slice(V,V+O),M,e),na._free(V)}l.destroy(),f.destroy(),delete r.extensions[l0]}const qg="EXT_meshopt_compression";function XD(r,e){if(!r.extensions||!r.extensions[qg])return;const i=r.extensions[qg],l=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);o0.decodeGltfBuffer(h,i.count,i.byteStride,l,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=h.buffer,delete r.extensions[qg]}const OT=1179937895,kT=new TextDecoder("utf8");function FT(r,e){return new URL(r,e).href}function YD(r,e,i,l){return fetch(FT(r.uri,l)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function BT(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function KD(r,e,i,l){if(r.uri){const h=FT(r.uri,l);return fetch(h).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[i]=f})}if(r.bufferView!==void 0){const h=BT(e,r.bufferView),f=new Blob([h],{type:r.mimeType});return createImageBitmap(f).then(p=>{e.images[i]=p})}}function NT(r,e=0,i){const l={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===OT){const I=new Uint32Array(r,e);let C=2;const M=(I[C++]>>2)-3,L=I[C++]>>2;if(C++,l.json=JSON.parse(kT.decode(I.subarray(C,C+L))),C+=L,C<M){const O=I[C++];C++;const V=e+(C<<2);l.buffers[0]=r.slice(V,V+O)}}else l.json=JSON.parse(kT.decode(new Uint8Array(r,e)));const{buffers:h,images:f,meshes:p,extensionsUsed:x,bufferViews:w}=l.json;let T=Promise.resolve();if(h){const I=[];for(let C=0;C<h.length;C++){const M=h[C];M.uri?I.push(YD(M,l,C,i)):l.buffers[C]||(l.buffers[C]=null)}T=Promise.all(I)}return T.then(()=>{const I=[],C=x&&x.includes(l0),M=x&&x.includes(qg);if(C&&I.push(function(){if(!na)return om??(om=function(L){let O,V=null;function $(){O=new Uint8Array(V.buffer)}function W(){throw new Error("Unexpected Draco error.")}const Q={a:{a:W,d:function(ee,U,Y){return O.copyWithin(ee,U,U+Y)},c:function(ee){const U=O.length,Y=Math.max(ee>>>0,Math.ceil(1.2*U)),te=Math.ceil((Y-U)/65536);try{return V.grow(te),$(),!0}catch{return!1}},b:W}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(L,Q):L.then(ee=>ee.arrayBuffer()).then(ee=>WebAssembly.instantiate(ee,Q))).then(ee=>{const{Rb:U,Qb:Y,P:te,T:oe,X:ve,Ja:ge,La:be,Qa:Me,Va:$e,Wa:ot,eb:Qe,jb:rt,f:at,e:He,yb:nt,zb:Ue,Ab:Ge,Bb:ht,Db:dt,Gb:Yt}=ee.instance.exports;V=He;const Ot=(()=>{let bt=0,ct=0,di=0,Lt=0;return Ft=>{di&&(U(Lt),U(bt),ct+=di,di=bt=0),bt||(ct+=128,bt=Y(ct));const oi=Ft.length+7&-8;let wi=bt;oi>=ct&&(di=oi,wi=Lt=Y(oi));for(let bi=0;bi<Ft.length;bi++)O[wi+bi]=Ft[bi];return wi}})();return $(),at(),{memory:He,_free:U,_malloc:Y,Mesh:class{constructor(){this.ptr=te()}destroy(){oe(this.ptr)}},Decoder:class{constructor(){this.ptr=ge()}destroy(){rt(this.ptr)}DecodeArrayToMesh(bt,ct,di){const Lt=Ot(bt),Ft=be(this.ptr,Lt,ct,di.ptr);return!!ve(Ft)}GetAttributeByUniqueId(bt,ct){return{ptr:Me(this.ptr,bt.ptr,ct)}}GetTrianglesUInt16Array(bt,ct,di){$e(this.ptr,bt.ptr,ct,di)}GetTrianglesUInt32Array(bt,ct,di){ot(this.ptr,bt.ptr,ct,di)}GetAttributeDataArrayForAllPoints(bt,ct,di,Lt,Ft){Qe(this.ptr,bt.ptr,ct.ptr,di,Lt,Ft)}},DT_INT8:nt(),DT_UINT8:Ue(),DT_INT16:Ge(),DT_UINT16:ht(),DT_UINT32:dt(),DT_FLOAT32:Yt()}})}(fetch(RT())),om.then(L=>{na=L,om=void 0}))}()),M&&I.push(function(){if(o0)return;const L=function(O){let V;const $=WebAssembly.instantiateStreaming(O,{}).then(ee=>{V=ee.instance,V.exports.__wasm_call_ctors()}),W={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},Q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(ee,U,Y,te,oe,ve){(function(ge,be,Me,$e,ot,Qe,rt){const at=ge.exports.sbrk,He=$e+3&-4,nt=at(He*ot),Ue=at(Qe.length),Ge=new Uint8Array(ge.exports.memory.buffer);Ge.set(Qe,Ue);const ht=be(nt,$e,ot,Ue,Qe.length);if(ht===0&&rt&&rt(nt,He,ot),Me.set(Ge.subarray(nt,nt+$e*ot)),at(nt-at(0)),ht!==0)throw new Error(`Malformed buffer data: ${ht}`)})(V,V.exports[Q[oe]],ee,U,Y,te,V.exports[W[ve]])}}}(fetch(LT()));return L.ready.then(()=>{o0=L})}()),f)for(let L=0;L<f.length;L++)I.push(KD(f[L],l,L,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(C&&p)for(const{primitives:L}of p)for(const O of L)ZD(O,l);if(M&&p&&w)for(const L of w)XD(L,l);return l})})}class VT{constructor(e){this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.hasPattern=!1,this.worldview=e.worldview}updateFootprints(e,i){}prepare(){return function(){if(a0!=null||DT!=null)return null;if(Nd!=null)return Nd;const e=fetch(js.BUILDING_GEN_URL);return Nd=function(i){let l,h,f,p;function x(){l=new Uint8Array(p.buffer),h=new Int32Array(p.buffer),f=new Float32Array(p.buffer)}function w(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},I={a:{a:w,f:function(C){const M=l.length,L=Math.max(C>>>0,Math.ceil(1.2*M)),O=Math.ceil((L-M)/65536);try{return p.grow(O),x(),!0}catch{return!1}},g:w,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,I):i.then(C=>C.arrayBuffer()).then(C=>WebAssembly.instantiate(C,I))).then(C=>{const M=C.instance.exports;return(0,M.g)(),p=M.f,x(),new WD({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setFacadeOptions:M.k,addFeature:M.l,addFacade:M.m,generateMesh:M.n,getLastError:M.o,getMeshCount:M.p,getPositionsPtr:M.q,getPositionsLength:M.r,getNormalsPtr:M.s,getNormalsLength:M.t,getColorsPtr:M.u,getColorsLength:M.v,getAOPtr:M.w,getAOLength:M.x,getIndicesPtr:M.y,getIndicesLength:M.z,getBuildingPart:M.A,getRingCount:M.B,getRingPtr:M.C,getRingLength:M.D,free:M.E,malloc:M.F,heapU8:l,heap32:h,heapF32:f})})}(e).then(i=>(Nd=null,a0=i,a0)).catch(i=>{Si("Could not load building-gen"),Nd=null,DT=i}),Nd}()}populate(e,i,l,h){}update(e,i,l,h,f,p,x){}isEmpty(){return!1}uploadPending(){return!1}upload(e){}destroy(){}getHeightAtTileCoord(e,i){return{height:Number.NEGATIVE_INFINITY,hidden:!0}}}let UT,jT;Ct(VT,"BuildingBucket",{omit:["layers"]});const JD=Xi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),QD=Xi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:eR}=JD,tR=Xi([{name:"a_packed",components:3,type:"Float32"}]),{members:iR}=tR,nR=Xi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:sR}=nR;class $T{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Sc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const l=this.getKey(e,i);return this.positions[l]}trim(){const e=this.width,i=this.height=mt(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,l){const h=[];let f=e.length%2==1?-e[e.length-1]*l:0,p=e[0]*l,x=!0;h.push({left:f,right:p,isDash:x,zeroLength:e[0]===0});let w=e[0];for(let T=1;T<e.length;T++){x=!x;const I=e[T];f=w*l,w+=I,p=w*l,h.push({left:f,right:p,isDash:x,zeroLength:I===0})}return h}addRoundDash(e,i,l){const h=i/2;for(let f=-l;f<=l;f++){const p=this.width*(this.nextRow+l+f);let x=0,w=e[x];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++x]);const I=Math.abs(T-w.left),C=Math.abs(T-w.right),M=Math.min(I,C);let L;const O=f/l*(h+1);if(w.isDash){const V=h-Math.abs(O);L=Math.sqrt(M*M+V*V)}else L=h-Math.sqrt(M*M+O*O);this.image.data[p+T]=Math.max(0,Math.min(255,L+128))}}}addRegularDash(e,i){for(let w=e.length-1;w>=0;--w){const T=e[w],I=e[w+1];T.zeroLength?e.splice(w,1):I&&I.isDash===T.isDash&&(I.left=T.left,e.splice(w,1))}const l=e[0],h=e[e.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const f=this.width*this.nextRow;let p=0,x=e[p];for(let w=0;w<this.width;w++){w/x.right>1&&(x=e[++p]);const T=Math.abs(w-x.left),I=Math.abs(w-x.right),C=Math.min(T,I);this.image.data[f+w]=Math.max(0,Math.min(255,(x.isDash?C:-C)+i+128))}}addDash(e,i){const l=this.getKey(e,i);if(this.positions[l])return this.positions[l];const h=i==="round",f=h?7:0,p=2*f+1;if(this.nextRow+p>this.height)return Si("LineAtlas out of space"),null;e.length===0&&e.push(1);let x=0;for(let I=0;I<e.length;I++)e[I]<0&&(Si("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),x+=e[I];if(x!==0){const I=this.width/x,C=this.getDashRanges(e,this.width,I);h?this.addRoundDash(C,I,f):this.addRegularDash(C,i==="square"?.5*I:0)}const w=this.nextRow+f;this.nextRow+=p;const T={tl:[w,f],br:[x,0]};return this.positions[l]=T,T}}Ct($T,"LineAtlas");const rR=Mi.VectorTileFeature.types,oR=Math.cos(Math.PI/180*37.5),aR=Math.cos(Math.PI/180*5);class c0{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Rp,this.layoutVertexArray2=new Ao,this.patternVertexArray=new Ao,this.indexArray=new Gs,this.programConfigurations=new u(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new ts,this.maxLineLength=0,this.zOffsetVertexArray=new Ao,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:yt/64,this.worldview=e.worldview}updateFootprints(e,i){}populate(e,i,l,h){this.hasPattern=Wv("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=je(l);const p=this.layers[0].layout.get("line-elevation-reference");if(p==="hd-road-markup")this.elevationType="road";else{const M=this.layers[0].layout.get("line-z-offset"),L=M.isConstant()&&!M.constantOr(0);this.elevationType=p!=="sea"&&p!=="ground"&&L?"none":"offset",this.elevationType==="offset"&&p==="none"&&Si(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const x=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&x!==void 0;const w=[];for(const{feature:M,id:L,index:O,sourceLayerIndex:V}of e){const $=this.layers[0]._featureFilter.needGeometry,W=Et(M,$);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),W,l))continue;const Q=f?f.evaluate(W,{},l):void 0,ee={id:L,properties:M.properties,type:M.type,sourceLayerIndex:V,index:O,geometry:$?W.geometry:Pt(M,l,h),patterns:{},sortKey:Q};w.push(ee)}f&&w.sort((M,L)=>M.sortKey-L.sortKey);const{lineAtlas:T,featureIndex:I}=i,C=this.addConstantDashes(T);for(const M of w){const{geometry:L,index:O,sourceLayerIndex:V}=M;if(C&&this.addFeatureDashes(M,T),this.hasPattern){const $=qv("line",this.layers,M,this.zoom,this.pixelRatio,i);this.patternFeatures.push($)}else this.addFeature(M,L,O,l,T.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[O].feature,L,O,V,this.index)}}addConstantDashes(e){let i=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,f=l.layout.get("line-cap").value;if(h.kind!=="constant"||f.kind!=="constant")i=!0;else{const p=f.value,x=h.value;if(!x)continue;e.addDash(x,p)}}return i}addFeatureDashes(e,i){const l=this.zoom;for(const h of this.layers){const f=h.paint.get("line-dasharray").value,p=h.layout.get("line-cap").value;if(f.kind==="constant"&&p.kind==="constant")continue;let x,w;if(f.kind==="constant"){if(x=f.value,!x)continue}else x=f.evaluate({zoom:l},e);w=p.kind==="constant"?p.value:p.evaluate({zoom:l},e),i.addDash(x,w),e.patterns[h.id]=[i.getKey(x,w)]}}update(e,i,l,h,f,p,x,w){this.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,w)}addFeatures(e,i,l,h,f,p){for(const x of this.patternFeatures)this.addFeature(x,x.geometry,x.index,i,l,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,iR)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,sR)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,QD.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,eR),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,l,h,f,p,x,w){const T=this.layers[0].layout,I=T.get("line-join").evaluate(e,{}),C=T.get("line-cap").evaluate(e,{}),M=T.get("line-miter-limit"),L=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e,this.zOffsetValue=T.get("line-z-offset").value;const O=this.layers[0].paint.get("line-width").value;if(O.kind!=="constant"&&O.isLineProgressConstant===!1&&(this.variableWidthValue=O),this.elevationType==="road"){const V=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,h,w,I,C,M,L)){const[$,W]=this.clipRuntimeLinesToTile(i,1);for(let Q=0;Q<$.length;Q++){const ee=$[Q],U=W[Q],Y={progress:{min:U.progress.min,max:U.progress.max},nextDir:this.computeSegNextDir(U,ee),prevDir:this.computeSegPrevDir(U,ee)};this.addLine(ee,e,h,I,C,M,L,Y)}this.fillNonElevatedRoadSegment(V)}}else for(const V of i)this.addLine(V,e,h,I,C,M,L);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,l,f,p,h,x,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return Gg(e,-i,-i,yt+i,yt+i)}clipRuntimeLinesToTile(e,i){const l=[];return[Gg(e,-i,-i,yt+i,yt+i,l),l]}addElevatedRoadFeature(e,i,l,h,f,p,x,w){const T=[],I=Br.getElevationFeature(e,h);if(I){const C=this.clipLinesToTile(i,1),M=this.prepareElevatedLines(C,I,l);for(const L of M)T.push({geometry:L,elevation:I,elevationTileID:l,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const C of T){const M=this.layoutVertexArray.length;this.addLine(C.geometry,e,l,f,p,x,w);const L=new co(l,C.elevationTileID);if(C.elevation)for(let O=M;O<this.layoutVertexArray.length;O++){const V=new _t(this.layoutVertexArray.int16[6*O]>>1,this.layoutVertexArray.int16[6*O+1]>>1),$=L.pointElevation(V,C.elevation,.05);this.updateHeightRange($),this.zOffsetVertexArray.emplaceBack($,0,0)}else this.fillNonElevatedRoadSegment(M)}return!0}prepareElevatedLines(e,i,l){if(i.constantHeight!=null)return e;const h=[],f=1/je(l);for(const p of e)$D(p,new Ir(i,f),0,h);return h}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,l,h,f,p,x,w){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=h==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const I=w&&w.progress.min>0,C=w&&w.progress.max<1;if(this.lineClips){let ve={min:this.lineClips.start,max:this.lineClips.end},ge=1;if(w){const $e=this.lineClips.end-this.lineClips.start;ve=function(ot,Qe,rt){return{min:eh(ot.min,Qe,rt),max:eh(ot.max,Qe,rt)}}(w.progress,{min:0,max:1},ve),$e>0&&(ge=(ve.max-ve.min)/$e)}const be=+i.properties.mapbox_clip_feature_len,Me=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(be)||Number.isNaN(Me)){for(let ot=0;ot<e.length-1;ot++)this.totalDistance+=e[ot].dist(e[ot+1]);const $e=this.totalDistance/(ve.max-ve.min);this.totalFeatureLength=Number.isFinite($e)?$e:0,this.lineClips.start=ve.min,this.lineClips.end=ve.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=be,this.distance=Me*ge,this.lineClips.start=ve.min,this.lineClips.end=ve.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=rR[i.type]==="Polygon";let L=e.length;for(;L>=2&&e[L-1].equals(e[L-2]);)L--;let O=0;for(;O<L-1&&e[O].equals(e[O+1]);)O++;if(L<(M?3:2))return;h==="bevel"&&(p=1.05);const V=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray);let $,W,Q,ee,U,Y,te,oe;w&&w.prevDir&&(Y=w.prevDir.perp()),w&&w.nextDir&&(te=w.nextDir.perp()),this.e1=this.e2=-1,M&&($=e[L-2],U=e[O].sub($)._unit()._perp());for(let ve=O;ve<L;ve++){if(Q=ve===L-1?M?e[O+1]:void 0:e[ve+1],Q&&e[ve].equals(Q))continue;U&&(ee=U),$&&(W=$),$=e[ve],oe=this.evaluateLineProgressFeatures(W?W.dist($):0),U=Q?Q.sub($)._unit()._perp():ee,ee=ee||U;const ge=W&&Q;let be=ge?h:M||T?"butt":f;const Me=ee.x*U.x+ee.y*U.y;if(T){const Ue=function(Ge){if(Ge.patternJoinNone){const ht=Ge.segmentPoints.length/2,dt=Ge.lineSoFar-Ge.segmentStart;for(let Yt=0;Yt<ht;++Yt){const Ot=Ge.segmentPoints[2*Yt+1],bt=Math.round(Ge.segmentPoints[2*Yt])+.5+.25*Ot;Ge.patternVertexArray.emplaceBack(bt,dt,Ge.segmentStart),Ge.patternVertexArray.emplaceBack(bt,dt,Ge.segmentStart)}Ge.segmentPoints.length=0}Ge.e1=Ge.e2=-1};if(ge&&Me<aR){this.updateDistance(W,$),this.addCurrentVertex($,ee,1,1,V,oe),Ue(this),this.addCurrentVertex($,U,-1,-1,V,oe);continue}if(W){if(!Q){this.updateDistance(W,$),this.addCurrentVertex($,ee,1,1,V,oe),Ue(this);continue}be="miter"}}let $e=ee.add(U);$e.x===0&&$e.y===0||$e._unit();const ot=$e.x*U.x+$e.y*U.y,Qe=ot!==0?1/ot:1/0,rt=2*Math.sqrt(2-2*ot),at=ot<oR&&W&&Q,He=ee.x*U.y-ee.y*U.x>0,nt=this.overscaling<=16?15*yt/(512*this.overscaling):0;if(ge&&be==="round"){if(Qe<x)be="miter";else if(Qe<=2){const Ue=h0($,-10,yt+10);be=this.elevationType==="offset"&&(Ue||this.hasCrossSlope)?"miter":"fakeround"}}if(be==="miter"&&Qe>p&&(be="bevel"),be==="bevel"&&(Qe>2&&(be="flipbevel"),Qe<p&&(be="miter")),W&&!(be==="miter"&&at)&&this.updateDistance(W,$),be==="miter")if(at){const Ue=$.dist(W);if(Ue>2*nt){const ht=$.sub($.sub(W)._mult(nt/Ue)._round());this.updateDistance(W,ht),this.addCurrentVertex(ht,ee,0,0,V,oe),W=ht}this.updateDistance(W,$),$e._mult(Qe),this.addCurrentVertex($,$e,0,0,V,oe);const Ge=$.dist(Q);if(Ge>2*nt){const ht=$.add(Q.sub($)._mult(nt/Ge)._round());this.updateDistance($,ht),this.addCurrentVertex(ht,U,0,0,V,oe),$=ht}}else $e._mult(Qe),this.addCurrentVertex($,$e,0,0,V,oe);else if(be==="flipbevel"){if(Qe>100)$e=U.mult(-1);else{const Ue=Qe*ee.add(U).mag()/ee.sub(U).mag();$e._perp()._mult(Ue*(He?-1:1))}this.addCurrentVertex($,$e,0,0,V,oe),this.addCurrentVertex($,$e.mult(-1),0,0,V,oe)}else if(be==="bevel"||be==="fakeround"){oe!=null&&W&&this.addCurrentVertex($,te||ee,-1,-1,V,oe);const Ue=$.dist(W)<=2*nt&&be!=="bevel",Ge=$e.mult(He?1:-1);Ge._mult(Qe);const ht=U.mult(He?-1:1),dt=ee.mult(He?-1:1),Yt=this.evaluateLineProgressFeatures(this.distance);if(oe==null&&(this.addHalfVertex($,Ge.x,Ge.y,!1,!He,0,V,Yt),Ue||this.addHalfVertex($,Ge.x+2*dt.x,Ge.y+2*dt.y,!1,He,0,V,Yt)),be==="fakeround"){const Ot=Math.round(180*rt/Math.PI/20);this.addHalfVertex($,dt.x,dt.y,!1,He,0,V,Yt);for(let bt=0;bt<Ot;bt++){let ct=bt/Ot;if(ct!==.5){const Lt=ct-.5;ct+=ct*Lt*(ct-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*Lt*Lt+(.848013+Me*(.215638*Me-1.06021)))}const di=ht.sub(dt)._mult(ct)._add(dt)._unit();this.addHalfVertex($,di.x,di.y,!1,He,0,V,Yt)}this.addHalfVertex($,ht.x,ht.y,!1,He,0,V,Yt)}Ue||oe!=null||this.addHalfVertex($,Ge.x+2*ht.x,Ge.y+2*ht.y,!1,He,0,V,Yt),oe!=null&&Q&&this.addCurrentVertex($,Y||U,1,1,V,oe)}else if(be==="butt")this.addCurrentVertex($,$e,0,0,V,oe);else if(be==="square"){if(!W){const Ue=I?0:-1;this.addCurrentVertex($,$e,Ue,Ue,V,oe)}if(this.addCurrentVertex($,$e,0,0,V,oe),W){const Ue=C?0:1;this.addCurrentVertex($,$e,Ue,Ue,V,oe)}}else if(be==="round"){if(W){const Ue=!ge&&te?te:ee;this.addCurrentVertex($,Ue,0,0,V,oe),!ge&&C||this.addCurrentVertex($,Ue,1,1,V,oe,!0)}if(Q){const Ue=!ge&&Y?Y:U;!ge&&I||this.addCurrentVertex($,Ue,-1,-1,V,oe,!0),this.addCurrentVertex($,Ue,0,0,V,oe)}}}}addVerticesTo(e,i,l,h,f,p,x,w,T,I){const C=(i.w-e.w)/this.tessellationStep|0;let M=0;const L=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const V=(i.x-e.x)/C,$=(i.y-e.y)/C,W=(i.z-e.z)/C,Q=(i.w-e.w)/C;for(let ee=1;ee<C;++ee){e.x+=V,e.y+=$,e.z+=W,this.lineSoFar+=Q,M+=Q;const U=this.evaluateLineProgressFeatures(this.prevDistance+M);this.scaledDistance=(this.prevDistance+M)/this.totalDistance,this.addHalfVertex(e,l,h,I,!1,x,T,U),this.addHalfVertex(e,f,p,I,!0,-w,T,U)}}this.lineSoFar=i.w,this.scaledDistance=L;const O=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,l,h,I,!1,x,T,O),this.addHalfVertex(i,f,p,I,!0,-w,T,O)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Si(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,l,h,f,p,x=!1){const w=i.x+i.y*l,T=i.y-i.x*l,I=i.y*h-i.x,C=-i.y-i.x*h;if(p!=null){const M=this.elevationType==="offset",L=-10,O=yt+10,V=p.zOffset,$=new ST(e.x,e.y,V,this.lineSoFar),W=!!M&&h0(e,L,O),Q=this.lineSoFar,ee=this.distance;if(this.currentVertex)if(W){const U=this.currentVertexIsOutside,Y=this.currentVertex,te=new ST(e.x,e.y,V,this.lineSoFar);if(AT(Y,te,L,O),!h0(te,L,O)){if(U){this.e1=this.e2=-1,this.distance-=Y.dist($),this.lineSoFar=Y.w;const oe=this.evaluateLineProgressFeatures(Y.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Y,w,T,x,!1,l,f,oe),this.addHalfVertex(Y,I,C,x,!0,-h,f,oe),this.prevDistance=this.distance}this.distance=this.prevDistance+Y.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Y,te,w,T,I,C,l,h,f,x),this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}}else{const U=this.currentVertex;if(this.currentVertexIsOutside){AT(U,$,L,O),this.e1=this.e2=-1,this.distance-=U.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=U.w;const Y=this.evaluateLineProgressFeatures(U.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(U,w,T,x,!1,l,f,Y),this.addHalfVertex(U,I,C,x,!0,-h,f,Y),this.prevDistance=this.distance,this.distance=ee,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(U,$,w,T,I,C,l,h,f,x)}else W||(this.addHalfVertex(e,w,T,x,!1,l,f,p),this.addHalfVertex(e,I,C,x,!0,-h,f,p));this.currentVertex=$,this.currentVertexIsOutside=W,this.lineSoFar=Q}else this.addHalfVertex(e,w,T,x,!1,l,f,p),this.addHalfVertex(e,I,C,x,!0,-h,f,p)}addHalfVertex({x:e,y:i},l,h,f,p,x,w,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),p||this.segmentPoints.push(this.lineSoFar-this.segmentStart,x)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(p?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(x===0?0:x<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=ri(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),p?this.e2=I:this.e1=I,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function h0(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let GT,HT;function WT(r,e,i){return e*(yt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Ct(c0,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const qT=(r,e,i)=>(1-i)*r+i*e;function ZT(r,e){return 1/WT(r,1,e.tileZoom)}function XT(r,e,i,l){return r.translatePosMatrix(l||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const YT=r=>{const e=[];KT(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const l=r.layout.get("line-join").constantOr("miter")==="none",h=!!r.paint.get("line-pattern").constantOr(1);return l&&h&&e.push("LINE_JOIN_NONE"),e};function KT(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let u0;const JT=()=>u0||(u0={layout:GT||(GT=new Kn({"line-cap":new St(Re.layout_line["line-cap"]),"line-join":new St(Re.layout_line["line-join"]),"line-miter-limit":new lt(Re.layout_line["line-miter-limit"]),"line-round-limit":new lt(Re.layout_line["line-round-limit"]),"line-sort-key":new St(Re.layout_line["line-sort-key"]),"line-z-offset":new St(Re.layout_line["line-z-offset"]),"line-elevation-reference":new lt(Re.layout_line["line-elevation-reference"]),"line-cross-slope":new lt(Re.layout_line["line-cross-slope"]),visibility:new lt(Re.layout_line.visibility),"line-width-unit":new lt(Re.layout_line["line-width-unit"])})),paint:HT||(HT=new Kn({"line-opacity":new St(Re.paint_line["line-opacity"]),"line-color":new St(Re.paint_line["line-color"]),"line-translate":new lt(Re.paint_line["line-translate"]),"line-translate-anchor":new lt(Re.paint_line["line-translate-anchor"]),"line-width":new St(Re.paint_line["line-width"]),"line-gap-width":new St(Re.paint_line["line-gap-width"]),"line-offset":new St(Re.paint_line["line-offset"]),"line-blur":new St(Re.paint_line["line-blur"]),"line-dasharray":new St(Re.paint_line["line-dasharray"]),"line-pattern":new St(Re.paint_line["line-pattern"]),"line-pattern-cross-fade":new lt(Re.paint_line["line-pattern-cross-fade"]),"line-gradient":new yl(Re.paint_line["line-gradient"]),"line-trim-offset":new lt(Re.paint_line["line-trim-offset"]),"line-trim-fade-range":new lt(Re.paint_line["line-trim-fade-range"]),"line-trim-color":new lt(Re.paint_line["line-trim-color"]),"line-emissive-strength":new lt(Re.paint_line["line-emissive-strength"]),"line-border-width":new St(Re.paint_line["line-border-width"]),"line-border-color":new St(Re.paint_line["line-border-color"]),"line-occlusion-opacity":new lt(Re.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},u0);class lR extends St{possiblyEvaluate(e,i){return i=new gn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,l,h){return i=Fe({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,l,h)}}let lm;function QT(r,e){return e>0?e+2*r:r}const cR=Xi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),hR=Xi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),uR=Xi([{name:"a_projected_pos",components:4,type:"Float32"}],4);Xi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dR=Xi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),fR=Xi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),pR=Xi([{name:"a_texb",components:2,type:"Uint16"}]),mR=Xi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),_R=Xi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const eS=Xi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gR=Xi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Xi([{name:"triangle",components:3,type:"Uint16"}]),Xi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Xi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Xi([{type:"Float32",name:"offsetX"}]),Xi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Vs=24;function yR(r,e,i){return r.sections.forEach(l=>{l.text=function(h,f,p){const x=f.layout.get("text-transform").evaluate(p,{});return x==="uppercase"?h=h.toLocaleUpperCase():x==="lowercase"&&(h=h.toLocaleLowerCase()),Qo.applyArabicShaping&&(h=Qo.applyArabicShaping(h)),h}(l.text,e,i)}),r}const cm={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function xR(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function vR(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}var tS,d0,iS,f0={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function bR(){return tS||(tS=1,f0.read=function(r,e,i,l,h){var f,p,x=8*h-l-1,w=(1<<x)-1,T=w>>1,I=-7,C=i?h-1:0,M=i?-1:1,L=r[e+C];for(C+=M,f=L&(1<<-I)-1,L>>=-I,I+=x;I>0;f=256*f+r[e+C],C+=M,I-=8);for(p=f&(1<<-I)-1,f>>=-I,I+=l;I>0;p=256*p+r[e+C],C+=M,I-=8);if(f===0)f=1-T;else{if(f===w)return p?NaN:1/0*(L?-1:1);p+=Math.pow(2,l),f-=T}return(L?-1:1)*p*Math.pow(2,f-l)},f0.write=function(r,e,i,l,h,f){var p,x,w,T=8*f-h-1,I=(1<<T)-1,C=I>>1,M=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,L=l?0:f-1,O=l?1:-1,V=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(x=isNaN(e)?1:0,p=I):(p=Math.floor(Math.log(e)/Math.LN2),e*(w=Math.pow(2,-p))<1&&(p--,w*=2),(e+=p+C>=1?M/w:M*Math.pow(2,1-C))*w>=2&&(p++,w/=2),p+C>=I?(x=0,p=I):p+C>=1?(x=(e*w-1)*Math.pow(2,h),p+=C):(x=e*Math.pow(2,C-1)*Math.pow(2,h),p=0));h>=8;r[i+L]=255&x,L+=O,x/=256,h-=8);for(p=p<<h|x,T+=h;T>0;r[i+L]=255&p,L+=O,p/=256,T-=8);r[i+L-O]|=128*V}),f0}function nS(){if(iS)return d0;iS=1,d0=e;var r=bR();function e(U){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(U)?U:new Uint8Array(U||0),this.pos=0,this.type=0,this.length=this.buf.length}e.Varint=0,e.Fixed64=1,e.Bytes=2,e.Fixed32=5;var i=4294967296,l=1/i,h=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function f(U){return U.type===e.Bytes?U.readVarint()+U.pos:U.pos+1}function p(U,Y,te){return te?4294967296*Y+(U>>>0):4294967296*(Y>>>0)+(U>>>0)}function x(U,Y,te){var oe=Y<=16383?1:Y<=2097151?2:Y<=268435455?3:Math.floor(Math.log(Y)/(7*Math.LN2));te.realloc(oe);for(var ve=te.pos-1;ve>=U;ve--)te.buf[ve+oe]=te.buf[ve]}function w(U,Y){for(var te=0;te<U.length;te++)Y.writeVarint(U[te])}function T(U,Y){for(var te=0;te<U.length;te++)Y.writeSVarint(U[te])}function I(U,Y){for(var te=0;te<U.length;te++)Y.writeFloat(U[te])}function C(U,Y){for(var te=0;te<U.length;te++)Y.writeDouble(U[te])}function M(U,Y){for(var te=0;te<U.length;te++)Y.writeBoolean(U[te])}function L(U,Y){for(var te=0;te<U.length;te++)Y.writeFixed32(U[te])}function O(U,Y){for(var te=0;te<U.length;te++)Y.writeSFixed32(U[te])}function V(U,Y){for(var te=0;te<U.length;te++)Y.writeFixed64(U[te])}function $(U,Y){for(var te=0;te<U.length;te++)Y.writeSFixed64(U[te])}function W(U,Y){return(U[Y]|U[Y+1]<<8|U[Y+2]<<16)+16777216*U[Y+3]}function Q(U,Y,te){U[te]=Y,U[te+1]=Y>>>8,U[te+2]=Y>>>16,U[te+3]=Y>>>24}function ee(U,Y){return(U[Y]|U[Y+1]<<8|U[Y+2]<<16)+(U[Y+3]<<24)}return e.prototype={destroy:function(){this.buf=null},readFields:function(U,Y,te){for(te=te||this.length;this.pos<te;){var oe=this.readVarint(),ve=oe>>3,ge=this.pos;this.type=7&oe,U(ve,Y,this),this.pos===ge&&this.skip(oe)}return Y},readMessage:function(U,Y){return this.readFields(U,Y,this.readVarint()+this.pos)},readFixed32:function(){var U=W(this.buf,this.pos);return this.pos+=4,U},readSFixed32:function(){var U=ee(this.buf,this.pos);return this.pos+=4,U},readFixed64:function(){var U=W(this.buf,this.pos)+W(this.buf,this.pos+4)*i;return this.pos+=8,U},readSFixed64:function(){var U=W(this.buf,this.pos)+ee(this.buf,this.pos+4)*i;return this.pos+=8,U},readFloat:function(){var U=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,U},readDouble:function(){var U=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,U},readVarint:function(U){var Y,te,oe=this.buf;return Y=127&(te=oe[this.pos++]),te<128?Y:(Y|=(127&(te=oe[this.pos++]))<<7,te<128?Y:(Y|=(127&(te=oe[this.pos++]))<<14,te<128?Y:(Y|=(127&(te=oe[this.pos++]))<<21,te<128?Y:function(ve,ge,be){var Me,$e,ot=be.buf;if(Me=(112&($e=ot[be.pos++]))>>4,$e<128||(Me|=(127&($e=ot[be.pos++]))<<3,$e<128)||(Me|=(127&($e=ot[be.pos++]))<<10,$e<128)||(Me|=(127&($e=ot[be.pos++]))<<17,$e<128)||(Me|=(127&($e=ot[be.pos++]))<<24,$e<128)||(Me|=(1&($e=ot[be.pos++]))<<31,$e<128))return p(ve,Me,ge);throw new Error("Expected varint not more than 10 bytes")}(Y|=(15&(te=oe[this.pos]))<<28,U,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var U=this.readVarint();return U%2==1?(U+1)/-2:U/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var U=this.readVarint()+this.pos,Y=this.pos;return this.pos=U,U-Y>=12&&h?function(te,oe,ve){return h.decode(te.subarray(oe,ve))}(this.buf,Y,U):function(te,oe,ve){for(var ge="",be=oe;be<ve;){var Me,$e,ot,Qe=te[be],rt=null,at=Qe>239?4:Qe>223?3:Qe>191?2:1;if(be+at>ve)break;at===1?Qe<128&&(rt=Qe):at===2?(192&(Me=te[be+1]))==128&&(rt=(31&Qe)<<6|63&Me)<=127&&(rt=null):at===3?($e=te[be+2],(192&(Me=te[be+1]))==128&&(192&$e)==128&&((rt=(15&Qe)<<12|(63&Me)<<6|63&$e)<=2047||rt>=55296&&rt<=57343)&&(rt=null)):at===4&&($e=te[be+2],ot=te[be+3],(192&(Me=te[be+1]))==128&&(192&$e)==128&&(192&ot)==128&&((rt=(15&Qe)<<18|(63&Me)<<12|(63&$e)<<6|63&ot)<=65535||rt>=1114112)&&(rt=null)),rt===null?(rt=65533,at=1):rt>65535&&(rt-=65536,ge+=String.fromCharCode(rt>>>10&1023|55296),rt=56320|1023&rt),ge+=String.fromCharCode(rt),be+=at}return ge}(this.buf,Y,U)},readBytes:function(){var U=this.readVarint()+this.pos,Y=this.buf.subarray(this.pos,U);return this.pos=U,Y},readPackedVarint:function(U,Y){if(this.type!==e.Bytes)return U.push(this.readVarint(Y));var te=f(this);for(U=U||[];this.pos<te;)U.push(this.readVarint(Y));return U},readPackedSVarint:function(U){if(this.type!==e.Bytes)return U.push(this.readSVarint());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readSVarint());return U},readPackedBoolean:function(U){if(this.type!==e.Bytes)return U.push(this.readBoolean());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readBoolean());return U},readPackedFloat:function(U){if(this.type!==e.Bytes)return U.push(this.readFloat());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readFloat());return U},readPackedDouble:function(U){if(this.type!==e.Bytes)return U.push(this.readDouble());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readDouble());return U},readPackedFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed32());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readFixed32());return U},readPackedSFixed32:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed32());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readSFixed32());return U},readPackedFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readFixed64());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readFixed64());return U},readPackedSFixed64:function(U){if(this.type!==e.Bytes)return U.push(this.readSFixed64());var Y=f(this);for(U=U||[];this.pos<Y;)U.push(this.readSFixed64());return U},skip:function(U){var Y=7&U;if(Y===e.Varint)for(;this.buf[this.pos++]>127;);else if(Y===e.Bytes)this.pos=this.readVarint()+this.pos;else if(Y===e.Fixed32)this.pos+=4;else{if(Y!==e.Fixed64)throw new Error("Unimplemented type: "+Y);this.pos+=8}},writeTag:function(U,Y){this.writeVarint(U<<3|Y)},realloc:function(U){for(var Y=this.length||16;Y<this.pos+U;)Y*=2;if(Y!==this.length){var te=new Uint8Array(Y);te.set(this.buf),this.buf=te,this.length=Y}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(U){this.realloc(4),Q(this.buf,U,this.pos),this.pos+=4},writeSFixed32:function(U){this.realloc(4),Q(this.buf,U,this.pos),this.pos+=4},writeFixed64:function(U){this.realloc(8),Q(this.buf,-1&U,this.pos),Q(this.buf,Math.floor(U*l),this.pos+4),this.pos+=8},writeSFixed64:function(U){this.realloc(8),Q(this.buf,-1&U,this.pos),Q(this.buf,Math.floor(U*l),this.pos+4),this.pos+=8},writeVarint:function(U){(U=+U||0)>268435455||U<0?function(Y,te){var oe,ve;if(Y>=0?(oe=Y%4294967296|0,ve=Y/4294967296|0):(ve=~(-Y/4294967296),4294967295^(oe=~(-Y%4294967296))?oe=oe+1|0:(oe=0,ve=ve+1|0)),Y>=18446744073709552e3||Y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");te.realloc(10),function(ge,be,Me){Me.buf[Me.pos++]=127&ge|128,ge>>>=7,Me.buf[Me.pos++]=127&ge|128,ge>>>=7,Me.buf[Me.pos++]=127&ge|128,ge>>>=7,Me.buf[Me.pos++]=127&ge|128,Me.buf[Me.pos]=127&(ge>>>=7)}(oe,0,te),function(ge,be){var Me=(7&ge)<<4;be.buf[be.pos++]|=Me|((ge>>>=3)?128:0),ge&&(be.buf[be.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(be.buf[be.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(be.buf[be.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(be.buf[be.pos++]=127&ge|((ge>>>=7)?128:0),ge&&(be.buf[be.pos++]=127&ge)))))}(ve,te)}(U,this):(this.realloc(4),this.buf[this.pos++]=127&U|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=127&(U>>>=7)|(U>127?128:0),U<=127||(this.buf[this.pos++]=U>>>7&127))))},writeSVarint:function(U){this.writeVarint(U<0?2*-U-1:2*U)},writeBoolean:function(U){this.writeVarint(!!U)},writeString:function(U){U=String(U),this.realloc(4*U.length),this.pos++;var Y=this.pos;this.pos=function(oe,ve,ge){for(var be,Me,$e=0;$e<ve.length;$e++){if((be=ve.charCodeAt($e))>55295&&be<57344){if(!Me){be>56319||$e+1===ve.length?(oe[ge++]=239,oe[ge++]=191,oe[ge++]=189):Me=be;continue}if(be<56320){oe[ge++]=239,oe[ge++]=191,oe[ge++]=189,Me=be;continue}be=Me-55296<<10|be-56320|65536,Me=null}else Me&&(oe[ge++]=239,oe[ge++]=191,oe[ge++]=189,Me=null);be<128?oe[ge++]=be:(be<2048?oe[ge++]=be>>6|192:(be<65536?oe[ge++]=be>>12|224:(oe[ge++]=be>>18|240,oe[ge++]=be>>12&63|128),oe[ge++]=be>>6&63|128),oe[ge++]=63&be|128)}return ge}(this.buf,U,this.pos);var te=this.pos-Y;te>=128&&x(Y,te,this),this.pos=Y-1,this.writeVarint(te),this.pos+=te},writeFloat:function(U){this.realloc(4),r.write(this.buf,U,this.pos,!0,23,4),this.pos+=4},writeDouble:function(U){this.realloc(8),r.write(this.buf,U,this.pos,!0,52,8),this.pos+=8},writeBytes:function(U){var Y=U.length;this.writeVarint(Y),this.realloc(Y);for(var te=0;te<Y;te++)this.buf[this.pos++]=U[te]},writeRawMessage:function(U,Y){this.pos++;var te=this.pos;U(Y,this);var oe=this.pos-te;oe>=128&&x(te,oe,this),this.pos=te-1,this.writeVarint(oe),this.pos+=oe},writeMessage:function(U,Y,te){this.writeTag(U,e.Bytes),this.writeRawMessage(Y,te)},writePackedVarint:function(U,Y){Y.length&&this.writeMessage(U,w,Y)},writePackedSVarint:function(U,Y){Y.length&&this.writeMessage(U,T,Y)},writePackedBoolean:function(U,Y){Y.length&&this.writeMessage(U,M,Y)},writePackedFloat:function(U,Y){Y.length&&this.writeMessage(U,I,Y)},writePackedDouble:function(U,Y){Y.length&&this.writeMessage(U,C,Y)},writePackedFixed32:function(U,Y){Y.length&&this.writeMessage(U,L,Y)},writePackedSFixed32:function(U,Y){Y.length&&this.writeMessage(U,O,Y)},writePackedFixed64:function(U,Y){Y.length&&this.writeMessage(U,V,Y)},writePackedSFixed64:function(U,Y){Y.length&&this.writeMessage(U,$,Y)},writeBytesField:function(U,Y){this.writeTag(U,e.Bytes),this.writeBytes(Y)},writeFixed32Field:function(U,Y){this.writeTag(U,e.Fixed32),this.writeFixed32(Y)},writeSFixed32Field:function(U,Y){this.writeTag(U,e.Fixed32),this.writeSFixed32(Y)},writeFixed64Field:function(U,Y){this.writeTag(U,e.Fixed64),this.writeFixed64(Y)},writeSFixed64Field:function(U,Y){this.writeTag(U,e.Fixed64),this.writeSFixed64(Y)},writeVarintField:function(U,Y){this.writeTag(U,e.Varint),this.writeVarint(Y)},writeSVarintField:function(U,Y){this.writeTag(U,e.Varint),this.writeSVarint(Y)},writeStringField:function(U,Y){this.writeTag(U,e.Bytes),this.writeString(Y)},writeFloatField:function(U,Y){this.writeTag(U,e.Fixed32),this.writeFloat(Y)},writeDoubleField:function(U,Y){this.writeTag(U,e.Fixed64),this.writeDouble(Y)},writeBooleanField:function(U,Y){this.writeVarintField(U,!!Y)}},d0}var Zg=fa(nS());const p0=3;function wR(r,e,i){e.glyphs=[],r===1&&i.readMessage(TR,e)}function TR(r,e,i){if(r===3){const{id:l,bitmap:h,width:f,height:p,left:x,top:w,advance:T}=i.readMessage(SR,{});e.glyphs.push({id:l,bitmap:new Sc({width:f+2*p0,height:p+2*p0},h),metrics:{width:f,height:p,left:x,top:w,advance:T}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function SR(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const ER=p0,Nr={horizontal:1,vertical:2,horizontalOnly:3};class hm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const l=new hm;return l.scale=e||1,l.fontStack=i,l}static forImage(e){const i=new hm;return i.image=e,i}}class Vd{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,l){const h=new Vd;for(let f=0;f<e.sections.length;f++){const p=e.sections[f];p.image?h.addImageSection(p,l):h.addTextSection(p,i)}return h}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,l){let h="";for(let f=0;f<i.length;f++){const p=i.charCodeAt(f+1)||null,x=i.charCodeAt(f-1)||null;h+=!l&&(p&&og(p)&&!cm[i[f+1]]||x&&og(x)&&!cm[i[f-1]])||!cm[i[f]]?i[f]:cm[i[f]]}return h}(this.text,e)}trim(){let e=0;for(let l=0;l<this.text.length&&Xg[this.text.charCodeAt(l)];l++)e++;let i=this.text.length;for(let l=this.text.length-1;l>=0&&l>=e&&Xg[this.text.charCodeAt(l)];l--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const l=new Vd;return l.text=this.text.substring(e,i),l.sectionIndex=this.sectionIndex.slice(e,i),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(hm.forText(e.scale,e.fontStack||i));const l=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(l)}addImageSection(e,i){const l=e.image?e.image.getPrimary():null;if(!l)return void Si("Can't add FormattedSection with an empty image.");l.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(hm.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Si("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function m0(r,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V=1){const $=Vd.fromFeature(r,h,V);C===Nr.vertical&&$.verticalizePunctuation(M);let W=[];const Q=function(oe,ve,ge,be,Me,$e){if(!oe)return[];const ot=[],Qe=function(nt,Ue,Ge,ht,dt,Yt){let Ot=0;for(let bt=0;bt<nt.length();bt++){const ct=nt.getSection(bt);Ot+=sS(nt.getCodePoint(bt),ct,ht,dt,Ue,Yt)}return Ot/Math.max(1,Math.ceil(Ot/Ge))}(oe,ve,ge,be,Me,$e),rt=oe.text.indexOf("​")>=0;let at=0;for(let nt=0;nt<oe.length();nt++){const Ue=oe.getSection(nt),Ge=oe.getCodePoint(nt);if(Xg[Ge]||(at+=sS(Ge,Ue,be,Me,ve,$e)),nt<oe.length()-1){const ht=!((He=Ge)<11904||!(ti["Bopomofo Extended"](He)||ti.Bopomofo(He)||ti["CJK Compatibility Forms"](He)||ti["CJK Compatibility Ideographs"](He)||ti["CJK Compatibility"](He)||ti["CJK Radicals Supplement"](He)||ti["CJK Strokes"](He)||ti["CJK Symbols and Punctuation"](He)||ti["CJK Unified Ideographs Extension A"](He)||ti["CJK Unified Ideographs"](He)||ti["Enclosed CJK Letters and Months"](He)||ti["Halfwidth and Fullwidth Forms"](He)||ti.Hiragana(He)||ti["Ideographic Description Characters"](He)||ti["Kangxi Radicals"](He)||ti["Katakana Phonetic Extensions"](He)||ti.Katakana(He)||ti["Vertical Forms"](He)||ti["Yi Radicals"](He)||ti["Yi Syllables"](He)));(AR[Ge]||ht||Ue.image)&&ot.push(oS(nt+1,at,Qe,ot,IR(Ge,oe.getCodePoint(nt+1),ht&&rt),!1))}}var He;return aS(oS(oe.length(),at,Qe,ot,0,!0))}($,T,f,e,l,L),{processBidirectionalText:ee,processStyledBidirectionalText:U}=Qo;if(ee&&$.sections.length===1){const oe=ee($.toString(),Q);for(const ve of oe){const ge=new Vd;ge.text=ve,ge.sections=$.sections;for(let be=0;be<ve.length;be++)ge.sectionIndex.push(0);W.push(ge)}}else if(U){const oe=U($.text,$.sectionIndex,Q);for(const ve of oe){const ge=new Vd;ge.text=ve[0],ge.sectionIndex=ve[1],ge.sections=$.sections,W.push(ge)}}else W=function(oe,ve){const ge=[],be=oe.text;let Me=0;for(const $e of ve)ge.push(oe.substring(Me,$e)),Me=$e;return Me<be.length&&ge.push(oe.substring(Me,be.length)),ge}($,Q);const Y=[],te={positionedLines:Y,text:$.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(oe,ve,ge,be,Me,$e,ot,Qe,rt,at,He,nt){let Ue=0,Ge=0,ht=0;const dt=Qe==="right"?1:Qe==="left"?0:.5;let Yt=!1;for(const Ft of Me){const oi=Ft.getSections();for(const wi of oi){if(wi.image)continue;const bi=ve[wi.fontStack];if(bi&&(Yt=bi.ascender!==void 0&&bi.descender!==void 0,!Yt))break}if(!Yt)break}let Ot=0;for(const Ft of Me){Ft.trim();const oi=Ft.getMaxScale(),wi=(oi-1)*Vs,bi={positionedGlyphs:[],lineOffset:0};oe.positionedLines[Ot]=bi;const Ri=bi.positionedGlyphs;let Ai=0;if(!Ft.length()){Ge+=$e,++Ot;continue}let Li=0,ln=0;for(let ne=0;ne<Ft.length();ne++){const ae=Ft.getSection(ne),We=Ft.getSectionIndex(ne),pt=Ft.getCodePoint(ne);let wt=ae.scale,vt=null,Dt=null,si=null,ki=Vs,Fi=0;rt===Nr.vertical&&((bt=pt)===12312||bt===12313||bt===12316||bt===12540||bt===12448)&&(rt=Nr.horizontal);const Ii=!(rt===Nr.horizontal||!He&&!Sp(pt)||He&&(Xg[pt]||Iv(pt)));if(ae.image){const dn=be.get(ae.image.toString());if(!dn)continue;si=ae.image,oe.iconsInText=oe.iconsInText||!0,Dt=dn.paddedRect;const Sn=dn.displaySize;wt=wt*Vs/nt,vt={width:Sn[0],height:Sn[1],left:0,top:-3,advance:Ii?Sn[1]:Sn[0],localGlyph:!1},Fi=Yt?-vt.height*wt:oi*Vs-17-Sn[1]*wt,ki=vt.advance;const Bi=(Ii?Sn[0]:Sn[1])*wt-Vs*oi;Bi>0&&Bi>Ai&&(Ai=Bi)}else{const dn=ge[ae.fontStack];if(!dn)continue;dn[pt]&&(Dt=dn[pt]);const Sn=ve[ae.fontStack];if(!Sn)continue;const Bi=Sn.glyphs[pt];if(!Bi)continue;if(vt=Bi.metrics,ki=pt!==8203?Vs:0,Yt){const Zn=Sn.ascender!==void 0?Math.abs(Sn.ascender):0,Pn=Sn.descender!==void 0?Math.abs(Sn.descender):0,cn=(Zn+Pn)*wt;Li<cn&&(Li=cn,ln=(Zn-Pn)/2*wt),Fi=-Zn*wt}else Fi=(oi-wt)*Vs-17}Ii?(oe.verticalizable=!0,Ri.push({glyph:pt,image:si,x:Ue,y:Ge+Fi,vertical:Ii,scale:wt,localGlyph:vt.localGlyph,fontStack:ae.fontStack,sectionIndex:We,metrics:vt,rect:Dt}),Ue+=ki*wt+at):(Ri.push({glyph:pt,image:si,x:Ue,y:Ge+Fi,vertical:Ii,scale:wt,localGlyph:vt.localGlyph,fontStack:ae.fontStack,sectionIndex:We,metrics:vt,rect:Dt}),Ue+=vt.advance*wt+at)}Ri.length!==0&&(ht=Math.max(Ue-at,ht),Yt?lS(Ri,dt,Ai,ln,$e*oi/2):lS(Ri,dt,Ai,0,$e/2)),Ue=0;const Mn=$e*oi+Ai;bi.lineOffset=Math.max(Ai,wi),Ge+=Mn,++Ot}var bt;const ct=Ge,{horizontalAlign:di,verticalAlign:Lt}=_0(ot);(function(Ft,oi,wi,bi,Ri,Ai){const Li=(oi-wi)*Ri,ln=-Ai*bi;for(const Mn of Ft)for(const ne of Mn.positionedGlyphs)ne.x+=Li,ne.y+=ln})(oe.positionedLines,dt,di,Lt,ht,ct),oe.top+=-Lt*ct,oe.bottom=oe.top+ct,oe.left+=-di*ht,oe.right=oe.left+ht,oe.hasBaseline=Yt}(te,e,i,l,W,p,x,w,C,T,M,O),!function(oe){for(const ve of oe)if(ve.positionedGlyphs.length!==0)return!1;return!0}(Y))return te}const Xg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},AR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function sS(r,e,i,l,h,f){if(e.image){const p=l.get(e.image.toString());return p?p.displaySize[0]*e.scale*Vs/f+h:0}{const p=i[e.fontStack],x=p&&p.glyphs[r];return x?x.metrics.advance*e.scale+h:0}}function rS(r,e,i,l){const h=Math.pow(r-e,2);return l?r<e?h/2:2*h:h+Math.abs(i)*i}function IR(r,e,i){let l=0;return r===10&&(l-=1e4),i&&(l+=150),r!==40&&r!==65288||(l+=50),e!==41&&e!==65289||(l+=50),l}function oS(r,e,i,l,h,f){let p=null,x=rS(e,i,h,f);for(const w of l){const T=rS(e-w.x,i,h,f)+w.badness;T<=x&&(p=w,x=T)}return{index:r,x:e,priorBreak:p,badness:x}}function aS(r){return r?aS(r.priorBreak).concat(r.index):[]}function _0(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function lS(r,e,i,l,h){if(!(e||i||l||h))return;const f=r.length-1,p=r[f],x=(p.x+p.metrics.advance*p.scale)*e;for(let w=0;w<=f;w++)r[w].x-=x,r[w].y+=i+l+h}function cS(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function CR(r,e,i,l){const{horizontalAlign:h,verticalAlign:f}=_0(l),p=i[0]-r.displaySize[0]*h,x=i[1]-r.displaySize[1]*f;return{imagePrimary:r,imageSecondary:e,top:x,bottom:x+r.displaySize[1],left:p,right:p+r.displaySize[0]}}function hS(r,e,i,l,h,f){const p=r.imagePrimary;let x;if(p.content){const $=p.content,W=p.pixelRatio||1;x=[$[0]/W,$[1]/W,p.displaySize[0]-$[2]/W,p.displaySize[1]-$[3]/W]}const w=e.left*f,T=e.right*f;let I,C,M,L;i==="width"||i==="both"?(L=h[0]+w-l[3],C=h[0]+T+l[1]):(L=h[0]+(w+T-p.displaySize[0])/2,C=L+p.displaySize[0]);const O=e.top*f,V=e.bottom*f;return i==="height"||i==="both"?(I=h[1]+O-l[0],M=h[1]+V+l[2]):(I=h[1]+(O+V-p.displaySize[1])/2,M=I+p.displaySize[1]),{imagePrimary:p,imageSecondary:void 0,top:I,right:C,bottom:M,left:L,collisionPadding:x}}function uS(r){return!r.imagePrimary.stretchX}function dS(r){return!r.imagePrimary.stretchY}function fS(r){return{width:r.right-r.left,height:r.bottom-r.top}}const ka=128;function pS(r,e,i){const{expression:l}=e;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new gn(r+1,{worldview:i}))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:f}=l;let p=0;for(;p<h.length&&h[p]<=r;)p++;p=Math.max(0,p-1);let x=p;for(;x<h.length&&h[x]<r+1;)x++;x=Math.min(h.length-1,x);const w=h[p],T=h[x];return l.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:f}:{kind:"camera",minZoom:w,maxZoom:T,minSize:l.evaluate(new gn(w,{worldview:i})),maxSize:l.evaluate(new gn(T,{worldview:i})),interpolationType:f}}}function g0(r,{uSize:e,uSizeT:i},{lowerSize:l,upperSize:h}){return r.kind==="source"?l/ka:r.kind==="composite"?ri(l/ka,h/ka,i):e}function um(r,e,i=1){let l=0,h=0;if(r.kind==="constant")h=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:f,minZoom:p,maxZoom:x}=r,w=f?de(Fr.interpolationFactor(f,e,p,x),0,1):0;r.kind==="camera"?h=ri(r.minSize,r.maxSize,w)*i:l=w*i}return{uSizeT:l,uSize:h}}class Tl extends _t{constructor(e,i,l,h,f){super(e,i),this.angle=h,this.z=l,f!==void 0&&(this.segment=f)}clone(){return new Tl(this.x,this.y,this.z,this.angle,this.segment)}}function mS(r,e,i,l,h){if(e.segment===void 0)return!0;let f=e,p=e.segment+1,x=0;for(;x>-i/2;){if(p--,p<0)return!1;x-=r[p].dist(f),f=r[p]}x+=r[p].dist(r[p+1]),p++;const w=[];let T=0;for(;x<i/2;){const I=r[p],C=r[p+1];if(!C)return!1;let M=r[p-1].angleTo(I)-I.angleTo(C);for(M=Math.abs((M+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:M}),T+=M;x-w[0].distance>l;)T-=w.shift().angleDelta;if(T>h)return!1;p++,x+=I.dist(C)}return!0}function _S(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function gS(r,e,i){return r?.6*e*i:0}function yS(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function MR(r,e,i,l,h,f){const p=gS(i,h,f),x=yS(i,l)*f;let w=0;const T=_S(r)/2;for(let I=0;I<r.length-1;I++){const C=r[I],M=r[I+1],L=C.dist(M);if(w+L>T){const O=(T-w)/L,V=ri(C.x,M.x,O),$=ri(C.y,M.y,O),W=new Tl(V,$,0,M.angleTo(C),I);return!p||mS(r,W,x,p,e)?W:void 0}w+=L}}function PR(r,e,i,l,h,f,p,x,w){const T=gS(l,f,p),I=yS(l,h),C=I*p,M=r[0].x===0||r[0].x===w||r[0].y===0||r[0].y===w;return e-C<e/4&&(e=C+e/4),xS(r,M?e/2*x%e:(I/2+2*f)*p*x%e,e,T,i,C,M,!1,w)}function xS(r,e,i,l,h,f,p,x,w){const T=f/2,I=_S(r);let C=0,M=e-i,L=[];for(let O=0;O<r.length-1;O++){const V=r[O],$=r[O+1],W=V.dist($),Q=$.angleTo(V);for(;M+i<C+W;){M+=i;const ee=(M-C)/W,U=ri(V.x,$.x,ee),Y=ri(V.y,$.y,ee);if(U>=0&&U<w&&Y>=0&&Y<w&&M-T>=0&&M+T<=I){const te=new Tl(U,Y,0,Q,O);l&&!mS(r,te,f,l,h)||L.push(te)}}C+=W}return x||L.length||p||(L=xS(r,C/2,i,l,h,f,p,!0,w)),L}function vS(r){let e=0,i=0;for(const p of r)e+=p.w*p.h,i=Math.max(i,p.w);r.sort((p,x)=>x.h-p.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,f=0;for(const p of r)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(p.w>w.w||p.h>w.h)){if(p.x=w.x,p.y=w.y,f=Math.max(f,p.y+p.h),h=Math.max(h,p.x+p.w),p.w===w.w&&p.h===w.h){const T=l.pop();x<l.length&&(l[x]=T)}else p.h===w.h?(w.x+=p.w,w.w-=p.w):p.w===w.w?(w.y+=p.h,w.h-=p.h):(l.push({x:w.x+p.w,y:w.y,w:w.w-p.w,h:p.h}),w.y+=p.h,w.h-=p.h);break}}return{w:h,h:f,fill:e/(h*f)||0}}Ct(Tl,"Anchor");const eu=1;class dm{static getImagePositionScale(e,i,l){if(i&&e&&e.options&&e.options.transform){const h=e.options.transform;return{x:h.a,y:h.d}}return{x:l,y:l}}constructor(e,i,l,h){this.paddedRect=e;const{pixelRatio:f,version:p,stretchX:x,stretchY:w,content:T,sdf:I,usvg:C}=i;this.pixelRatio=f,this.stretchX=x,this.stretchY=w,this.content=T,this.version=p,this.padding=l,this.sdf=I,this.usvg=C,this.scale=dm.getImagePositionScale(h,C,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function y0(r,e,i){const l=qo.parse(r),h=function(f,p,x=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*x[0])+2*p,h:(f.data?f.data.height:f.height*x[1])+2*p}}(e,i,[l.options.transform.a,l.options.transform.d]);return{bin:h,imagePosition:new dm(h,e,i,l),imageVariant:l}}class bS{constructor(e,i,l){const h=new Map,f=new Map;this.haveRenderCallbacks=[];const p=[];this.addImages(e,h,eu,p),this.addImages(i,f,2,p);const{w:x,h:w}=vS(p),T=new Zs({width:x||1,height:w||1});for(const[I,C]of e.entries()){const M=h.get(I).paddedRect;Zs.copy(C.data,T,{x:0,y:0},{x:M.x+eu,y:M.y+eu},C.data,l,C.sdf)}for(const[I,C]of i.entries()){const M=f.get(I),L=M.paddedRect;let O=M.padding;const V=L.x+O,$=L.y+O,W=C.data.width,Q=C.data.height;O=O>1?O-1:O,Zs.copy(C.data,T,{x:0,y:0},{x:V,y:$},C.data,l),Zs.copy(C.data,T,{x:0,y:Q-O},{x:V,y:$-O},{width:W,height:O},l),Zs.copy(C.data,T,{x:0,y:0},{x:V,y:$+Q},{width:W,height:O},l),Zs.copy(C.data,T,{x:W-O,y:0},{x:V-O,y:$},{width:O,height:Q},l),Zs.copy(C.data,T,{x:0,y:0},{x:V+W,y:$},{width:O,height:Q},l),Zs.copy(C.data,T,{x:W-O,y:Q-O},{x:V-O,y:$-O},{width:O,height:O},l),Zs.copy(C.data,T,{x:0,y:Q-O},{x:V+W,y:$-O},{width:O,height:O},l),Zs.copy(C.data,T,{x:0,y:0},{x:V+W,y:$+Q},{width:O,height:O},l),Zs.copy(C.data,T,{x:W-O,y:0},{x:V-O,y:$+Q},{width:O,height:O},l)}this.lut=l,this.image=T,this.iconPositions=h,this.patternPositions=f}addImages(e,i,l,h){for(const[f,p]of e.entries()){const{bin:x,imagePosition:w,imageVariant:T}=y0(f,p,l);i.set(f,w),h.push(x),p.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(e,i,l){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,l)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,l);for(const h of e.getUpdatedImages(l)){for(const f of this.iconPositions.keys()){const p=qo.parse(f);if(Sr.isEqual(p.id,h)){const x=e.getImage(h,l);this.patchUpdatedImage(this.iconPositions.get(f),x,i)}}for(const f of this.patternPositions.keys()){const p=qo.parse(f);if(Sr.isEqual(p.id,h)){const x=e.getImage(h,l);this.patchUpdatedImage(this.patternPositions.get(f),x,i)}}}}patchUpdatedImage(e,i,l){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,f]=e.tl,p=e.sdf;if(this.lut||p){const x={width:i.data.width,height:i.data.height},w=new Zs(x);Zs.copy(i.data,w,{x:0,y:0},{x:0,y:0},x,this.lut,p),l.update(w,{position:{x:h,y:f}})}else l.update(i.data,{position:{x:h,y:f}})}}Ct(dm,"ImagePosition"),Ct(bS,"ImageAtlas");const Yg=1e20;function wS(r,e,i,l,h,f,p,x,w){for(let T=e;T<e+l;T++)TS(r,i*f+T,f,h,p,x,w);for(let T=i;T<i+h;T++)TS(r,T*f+e,1,l,p,x,w)}function TS(r,e,i,l,h,f,p){f[0]=0,p[0]=-1e20,p[1]=Yg,h[0]=r[e];for(let x=1,w=0,T=0;x<l;x++){h[x]=r[e+x*i];const I=x*x;do{const C=f[w];T=(h[x]-h[C]+I-C*C)/(x-C)/2}while(T<=p[w]&&--w>-1);w++,f[w]=x,p[w]=T,p[w+1]=Yg}for(let x=0,w=0;x<l;x++){for(;p[w+1]<x;)w++;const T=f[w],I=x-T;r[e+x*i]=h[T]+I*I}}const sa=2,x0={none:0,ideographs:1,all:2};class Ud{constructor(e,i,l){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=l,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,l){const h=[],f=this.urls[i]||js.GLYPHS_URL;for(const p in e)for(const x of e[p])h.push({stack:p,id:x});Ee(h,({stack:p,id:x},w)=>{let T=this.entries[p];T||(T=this.entries[p]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let I=T.glyphs[x];if(I!==void 0)return void w(null,{stack:p,id:x,glyph:I});if(I=this._tinySDF(T,p,x),I)return T.glyphs[x]=I,void w(null,{stack:p,id:x,glyph:I});const C=Math.floor(x/256);if(256*C>65535)return Si("glyphs > 65535 not supported"),void w(null,{stack:p,id:x,glyph:I});if(T.ranges[C])return void w(null,{stack:p,id:x,glyph:I});let M=T.requests[C];M||(M=T.requests[C]=[],Ud.loadGlyphRange(p,C,f,this.requestManager,(L,O)=>{if(O){T.ascender=O.ascender,T.descender=O.descender;for(const V in O.glyphs)this._doesCharSupportLocalGlyph(+V)||(T.glyphs[+V]=O.glyphs[+V]);T.ranges[C]=!0}for(const V of M)V(L,O);delete T.requests[C]})),M.push((L,O)=>{L?w(L):O&&w(null,{stack:p,id:x,glyph:O.glyphs[x]||null})})},(p,x)=>{if(p)l(p);else if(x){const w={};for(const{stack:T,id:I,glyph:C}of x)w[T]===void 0&&(w[T]={}),w[T].glyphs===void 0&&(w[T].glyphs={}),w[T].glyphs[I]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},w[T].ascender=this.entries[T].ascender,w[T].descender=this.entries[T].descender;l(null,w)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==x0.none&&(this.localGlyphMode===x0.all?!!this.localFontFamily:!!this.localFontFamily&&(ti["CJK Unified Ideographs"](e)||ti["Hangul Syllables"](e)||ti.Hiragana(e)||ti.Katakana(e)||ti["CJK Symbols and Punctuation"](e)||ti["CJK Unified Ideographs Extension A"](e)||ti["CJK Unified Ideographs Extension B"](e)||ti.Osage(e)))}_tinySDF(e,i,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let f=e.tinySDF;if(!f){let V="400";/bold/i.test(i)?V="900":/medium/i.test(i)?V="500":/light/i.test(i)&&(V="200"),f=e.tinySDF=new Ud.TinySDF({fontFamily:h,fontWeight:V,fontSize:24*sa,buffer:3*sa,radius:8*sa}),f.fontWeight=V}if(this.localGlyphs[f.fontWeight][l])return this.localGlyphs[f.fontWeight][l];const p=String.fromCodePoint(l),{data:x,width:w,height:T,glyphWidth:I,glyphHeight:C,glyphLeft:M,glyphTop:L,glyphAdvance:O}=f.draw(p);return this.localGlyphs[f.fontWeight][l]={id:l,bitmap:new Sc({width:w,height:T},x),metrics:{width:I/sa,height:C/sa,left:M/sa,top:L/sa-27,advance:O/sa,localGlyph:!0}}}}Ud.loadGlyphRange=function(r,e,i,l,h){const f=256*e,p=f+255,x=l.transformRequest(l.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${f}-${p}`),ah.Glyphs);lh(x,(w,T)=>{if(w)h(w);else if(T){const I={},C=function(M){return new Zg(M).readFields(wR,{})}(T);for(const M of C.glyphs)I[M.id]=M;h(null,{glyphs:I,ascender:C.ascender,descender:C.descender})}})},Ud.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:f="normal",fontStyle:p="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=i;const x=this.size=r+4*e,w=this._createCanvas(x),T=this.ctx=w.getContext("2d",{willReadFrequently:!0});T.font=`${p} ${f} ${r}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:f}=this.ctx.measureText(r),p=Math.ceil(i),x=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-h))),w=Math.min(this.size-this.buffer,p+Math.ceil(l)),T=x+2*this.buffer,I=w+2*this.buffer,C=Math.max(T*I,0),M=new Uint8ClampedArray(C),L={data:M,width:T,height:I,glyphWidth:x,glyphHeight:w,glyphTop:p,glyphLeft:0,glyphAdvance:e};if(x===0||w===0)return L;const{ctx:O,buffer:V,gridInner:$,gridOuter:W}=this;O.clearRect(V,V,x,w),O.fillText(r,V,V+p);const Q=O.getImageData(V,V,x,w);W.fill(Yg,0,C),$.fill(0,0,C);for(let ee=0;ee<w;ee++)for(let U=0;U<x;U++){const Y=Q.data[4*(ee*x+U)+3]/255;if(Y===0)continue;const te=(ee+V)*T+U+V;if(Y===1)W[te]=0,$[te]=Yg;else{const oe=.5-Y;W[te]=oe>0?oe*oe:0,$[te]=oe<0?oe*oe:0}}wS(W,0,0,T,I,T,this.f,this.v,this.z),wS($,V,V,x,w,T,this.f,this.v,this.z);for(let ee=0;ee<C;ee++){const U=Math.sqrt(W[ee])-Math.sqrt($[ee]);M[ee]=Math.round(255-255*(U/this.radius+this.cutoff))}return L}};const tu=eu;function SS(r,e){return r+e[1]-e[0]}function ES(r,e,i,l,h=1){const f=[],p=r.imagePrimary,x=p.pixelRatio,w=p.paddedRect.w-2*tu,T=p.paddedRect.h-2*tu,I=(r.right-r.left)*h,C=(r.bottom-r.top)*h,M=p.stretchX||[[0,w]],L=p.stretchY||[[0,T]],O=M.reduce(SS,0),V=L.reduce(SS,0),$=w-O,W=T-V;let Q=0,ee=O,U=0,Y=V,te=0,oe=$,ve=0,ge=W;if(p.content&&l){const Me=p.content;Q=Kg(M,0,Me[0]),U=Kg(L,0,Me[1]),ee=Kg(M,Me[0],Me[2]),Y=Kg(L,Me[1],Me[3]),te=Me[0]-Q,ve=Me[1]-U,oe=Me[2]-Me[0]-ee,ge=Me[3]-Me[1]-Y}const be=(Me,$e,ot,Qe)=>{const rt=Jg(Me.stretch-Q,ee,I,r.left*h),at=Qg(Me.fixed-te,oe,Me.stretch,O),He=Jg($e.stretch-U,Y,C,r.top*h),nt=Qg($e.fixed-ve,ge,$e.stretch,V),Ue=Jg(ot.stretch-Q,ee,I,r.left*h),Ge=Qg(ot.fixed-te,oe,ot.stretch,O),ht=Jg(Qe.stretch-U,Y,C,r.top*h),dt=Qg(Qe.fixed-ve,ge,Qe.stretch,V),Yt=new _t(rt,He),Ot=new _t(Ue,He),bt=new _t(Ue,ht),ct=new _t(rt,ht),di=new _t(at/x,nt/x),Lt=new _t(Ge/x,dt/x),Ft=e*Math.PI/180;if(Ft){const Li=Math.sin(Ft),ln=Math.cos(Ft),Mn=[ln,-Li,Li,ln];Yt._matMult(Mn),Ot._matMult(Mn),ct._matMult(Mn),bt._matMult(Mn)}const oi=Me.stretch+Me.fixed,wi=ot.stretch+ot.fixed,bi=$e.stretch+$e.fixed,Ri=Qe.stretch+Qe.fixed,Ai=r.imageSecondary;return{tl:Yt,tr:Ot,bl:ct,br:bt,texPrimary:{x:p.paddedRect.x+tu+oi,y:p.paddedRect.y+tu+bi,w:wi-oi,h:Ri-bi},texSecondary:Ai?{x:Ai.paddedRect.x+tu+oi,y:Ai.paddedRect.y+tu+bi,w:wi-oi,h:Ri-bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:di,pixelOffsetBR:Lt,minFontScaleX:oe/x/I,minFontScaleY:ge/x/C,isSDF:i}};if(l&&(p.stretchX||p.stretchY)){const Me=AS(M,$,O),$e=AS(L,W,V);for(let ot=0;ot<Me.length-1;ot++){const Qe=Me[ot],rt=Me[ot+1];for(let at=0;at<$e.length-1;at++)f.push(be(Qe,$e[at],rt,$e[at+1]))}}else f.push(be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return f}function Kg(r,e,i){let l=0;for(const h of r)l+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return l}function AS(r,e,i){const l=[{fixed:-1,stretch:0}];for(const[h,f]of r){const p=l[l.length-1];l.push({fixed:h-p.stretch,stretch:p.stretch}),l.push({fixed:h-p.stretch,stretch:p.stretch+(f-h)})}return l.push({fixed:e+tu,stretch:i}),l}function Jg(r,e,i,l){return r/e*i+l}function Qg(r,e,i,l){return r-e*i/l}function DR(r,e,i,l){const h=e+r.positionedLines[l].lineOffset;return l===0?i+h/2:i+(h+(e+r.positionedLines[l-1].lineOffset))/2}function RR(r,e=1,i=!1){let l=1/0,h=1/0,f=-1/0,p=-1/0;const x=r[0];for(let L=0;L<x.length;L++){const O=x[L];(!L||O.x<l)&&(l=O.x),(!L||O.y<h)&&(h=O.y),(!L||O.x>f)&&(f=O.x),(!L||O.y>p)&&(p=O.y)}const w=Math.min(f-l,p-h);let T=w/2;const I=new Zu([],LR);if(w===0)return new _t(l,h);for(let L=l;L<f;L+=w)for(let O=h;O<p;O+=w)I.push(new jd(L+T,O+T,T,r));let C=function(L){let O=0,V=0,$=0;const W=L[0];for(let Q=0,ee=W.length,U=ee-1;Q<ee;U=Q++){const Y=W[Q],te=W[U],oe=Y.x*te.y-te.x*Y.y;V+=(Y.x+te.x)*oe,$+=(Y.y+te.y)*oe,O+=3*oe}return new jd(V/O,$/O,0,L)}(r),M=I.length;for(;I.length;){const L=I.pop();(L.d>C.d||!C.d)&&(C=L,i&&console.log("found best %d after %d probes",Math.round(1e4*L.d)/1e4,M)),L.max-C.d<=e||(T=L.h/2,I.push(new jd(L.p.x-T,L.p.y-T,T,r)),I.push(new jd(L.p.x+T,L.p.y-T,T,r)),I.push(new jd(L.p.x-T,L.p.y+T,T,r)),I.push(new jd(L.p.x+T,L.p.y+T,T,r)),M+=4)}return i&&(console.log(`num probes: ${M}`),console.log(`best distance: ${C.d}`)),C.p}function LR(r,e){return e.max-r.max}class jd{constructor(e,i,l,h){this.p=new _t(e,i),this.h=l,this.d=function(f,p){let x=!1,w=1/0;for(let T=0;T<p.length;T++){const I=p[T];for(let C=0,M=I.length,L=M-1;C<M;L=C++){const O=I[C],V=I[L];O.y>f.y!=V.y>f.y&&f.x<(V.x-O.x)*(f.y-O.y)/(V.y-O.y)+O.x&&(x=!x),w=Math.min(w,Dd(f,O,V))}}return(x?1:-1)*Math.sqrt(w)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const zR=Object.keys,v0=Number.POSITIVE_INFINITY,OR=Math.sqrt(2);function IS(r,[e,i]){let l=0,h=0;if(i===v0){e<0&&(e=0);const f=e/OR;switch(r){case"top-right":case"top-left":h=f-7;break;case"bottom-right":case"bottom-left":h=7-f;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(r){case"top-right":case"bottom-right":l=-f;break;case"top-left":case"bottom-left":l=f;break;case"left":l=e;break;case"right":l=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(r){case"top-right":case"bottom-right":case"right":l=-e;break;case"top-left":case"bottom-left":case"left":l=e}}return[l,h]}function ey(r,e,i,l,h,f,p,x,w){if(!e||!e.usvg)return;const T=fS(l),I=fS(h),C=f!=="both"&&f!=="width"||!uS(l)?1:I.width/T.width,M=f!=="both"&&f!=="height"||!dS(l)?1:I.height/T.height;i.scaleSelf(C,M);const L=i.toString();p.set(L,i),x.set(L,e);const{imagePosition:O}=y0(L,e,eu);w.set(L,O)}function CS(r,e,i,l,h,f,p,x,w){if(!r)return;const T=function(I,C,M,L,O,V){if(I.kind==="camera")return I.maxSize;if(I.kind==="composite"){const $=C.possiblyEvaluate(new gn(I.maxZoom,{worldview:V}),M).evaluate(O,{},M),W=C.possiblyEvaluate(new gn(I.minZoom,{worldview:V}),M).evaluate(O,{},M);return Math.max($,W)}return C.possiblyEvaluate(new gn(L,{worldview:V})).evaluate(O,{},M)}(e,i,l,h,f,w);return r.scaleSelf(T*x*p)}function MS(r,e,i,l,h,f,p,x,w){return{iconPrimary:CS(r.getPrimary(),e,i,l,h,f,p,x,w),iconSecondary:CS(r.getSecondary(),e,i,l,h,f,p,x,w)}}function kR(r,e,i){if(!e)return;const l=i.get(r.toString()),h=i.get(e.toString());h&&(l.paddedRect.w===h.paddedRect.w&&l.paddedRect.h===h.paddedRect.h||Si(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),l.usvg!==h.usvg&&Si(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function PS(r,e,i,l){if(!r)return;const h=e.get(i.toString());if(r.imagePrimary=h,l){const f=e.get(l.toString());r.imageSecondary=f}}function FR(r,e){for(const i in r.horizontal)DS(r.horizontal[i],e);DS(r.vertical,e)}function DS(r,e){if(r){for(const i of r.positionedLines)for(const l of i.positionedGlyphs)if(l.image!==null){const h=l.image.toString();l.rect=e.get(h).paddedRect}}}function b0(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function BR(r,e,i,l,h,f,p,x,w){const T=w0(f.horizontal)||f.vertical,I=i.get("icon-text-fit-padding").evaluate(l,{},h);let C,M=e;return e&&w!=="none"&&(r.allowVerticalPlacement&&f.vertical&&(C=hS(e,f.vertical,w,I,x,p)),T&&(M=hS(e,T,w,I,x,p))),{defaultShapedIcon:M,verticallyShapedIcon:C}}function NR(r,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W,Q,ee){let U=p.textMaxSize.evaluate(e,{},M);U===void 0?U=x*p.textScaleFactor:U*=p.textScaleFactor;const Y=r.layers[0].layout,te=w0(i.horizontal)||i.vertical,oe=L.name==="globe",ve=Vs,ge=r.tilePixelRatio*U/ve,be=(at=r.overscaling,r.zoom>18&&at>2&&(at>>=1),Math.max(yt/(512*at),1)*Y.get("symbol-spacing")),Me=Y.get("text-padding")*r.tilePixelRatio,$e=Y.get("icon-padding")*r.tilePixelRatio,ot=Yi(Y.get("text-max-angle")),Qe=Y.get("icon-rotation-alignment")==="map"&&ee!=="point",rt=be/2;var at;r.hasAnyIconTextFit===!1&&$!=="none"&&(r.hasAnyIconTextFit=!0);const He=e.properties?+e.properties[Oi]:null,nt=He&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(He):65535,Ue=(Ge,ht,dt)=>{if(ht.x<0||ht.x>=yt||ht.y<0||ht.y>=yt)return;let Yt=null;if(oe){const{x:Ot,y:bt,z:ct}=L.projectTilePoint(ht.x,ht.y,dt);Yt={anchor:new Tl(Ot,bt,ct,0,void 0),up:L.upVector(dt,ht.x,ht.y)}}(function(Ot,bt,ct,di,Lt,Ft,oi,wi,bi,Ri,Ai,Li,ln,Mn,ne,ae,We,pt,wt,vt,Dt,si,ki,Fi,Ii,dn,Sn,Bi,Zn){const Pn=Ot.addToLineVertexArray(bt,di);let cn,as,On,En,Dn,_n,Pi,yn=0,Xn=0,ii=0,Gi=0,kn=-1,ns=-1;const Un={};let ws=hh("");const xn=ct?ct.anchor:bt,gs=Bi!=="none";let Cr=0,Xs=0;if(bi._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Ts=bi.layout.get("text-offset").evaluate(Dt,{},Ii);Cr=Ts[0]*Vs,Xs=Ts[1]*Vs}else Cr=bi.layout.get("text-radial-offset").evaluate(Dt,{},Ii)*Vs,Xs=v0;if(Ot.allowVerticalPlacement&&Lt.vertical){const Ts=Lt.vertical;if(ne)_n=T0(Ts),wi&&(Pi=T0(wi));else{const Rs=bi.layout.get("text-rotate").evaluate(Dt,{},Ii)+90;On=ty(Ri,xn,bt,Ai,Li,ln,Ts,Mn,Rs,ae),wi&&(En=ty(Ri,xn,bt,Ai,Li,ln,wi,pt,Rs))}}if(Ft){const Ts=Ot.iconSizeData,Rs=bi.layout.get("icon-rotate").evaluate(Dt,{},Ii),Ys=ES(Ft,Rs,ki,gs,si.iconScaleFactor),ur=wi?ES(wi,Rs,ki,gs,si.iconScaleFactor):void 0;as=ty(Ri,xn,bt,Ai,Li,ln,Ft,pt,Rs,null),yn=4*Ys.length;let sr=null;Ts.kind==="source"?(sr=[ka*bi.layout.get("icon-size").evaluate(Dt,{},Ii)*si.iconScaleFactor],sr[0]>Ac&&Si(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${fm}. Reduce your "icon-size".`)):Ts.kind==="composite"&&(sr=[ka*si.compositeIconSizes[0].evaluate(Dt,{},Ii)*si.iconScaleFactor,ka*si.compositeIconSizes[1].evaluate(Dt,{},Ii)*si.iconScaleFactor],(sr[0]>Ac||sr[1]>Ac)&&Si(`${Ot.layerIds[0]}: Value for "icon-size" is >= ${fm}. Reduce your "icon-size".`)),Ot.addSymbols(Ot.icon,Ys,sr,vt,wt,Dt,void 0,ct,bt,Pn.lineStartIndex,Pn.lineLength,-1,Fi,Ii,dn,Sn),kn=Ot.icon.placedSymbolArray.length-1,ur&&(Xn=4*ur.length,Ot.addSymbols(Ot.icon,ur,sr,vt,wt,Dt,Nr.vertical,ct,bt,Pn.lineStartIndex,Pn.lineLength,-1,Fi,Ii,dn,Sn),ns=Ot.icon.placedSymbolArray.length-1)}for(const Ts in Lt.horizontal){const Rs=Ts,Ys=Lt.horizontal[Rs];cn||(ws=hh(Ys.text),ne?Dn=T0(Ys):cn=ty(Ri,xn,bt,Ai,Li,ln,Ys,Mn,bi.layout.get("text-rotate").evaluate(Dt,{},Ii),ae));const ur=Ys.positionedLines.length===1;if(ii+=RS(Ot,ct,bt,Ys,oi,bi,ne,Dt,ae,Pn,Lt.vertical?Nr.horizontal:Nr.horizontalOnly,ur?zR(Lt.horizontal):[Rs],Un,kn,si,Fi,Ii,dn),ur)break}Lt.vertical&&(Gi+=RS(Ot,ct,bt,Lt.vertical,oi,bi,ne,Dt,ae,Pn,Nr.vertical,["vertical"],Un,ns,si,Fi,Ii,dn));let Ws=-1;const Mr=(Ts,Rs)=>Ts?Math.max(Ts,Rs):Rs;Ws=Mr(Dn,Ws),Ws=Mr(_n,Ws),Ws=Mr(Pi,Ws);const Fa=Ws>-1?1:0;Ot.glyphOffsetArray.length>=65535&&Si("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Dt.sortKey!==void 0&&Ot.addToSortKeyRanges(Ot.symbolInstances.length,Dt.sortKey),Ot.symbolInstances.emplaceBack(bt.x,bt.y,xn.x,xn.y,xn.z,Un.right>=0?Un.right:-1,Un.center>=0?Un.center:-1,Un.left>=0?Un.left:-1,Un.vertical>=0?Un.vertical:-1,kn,ns,ws,cn!==void 0?cn:Ot.collisionBoxArray.length,cn!==void 0?cn+1:Ot.collisionBoxArray.length,On!==void 0?On:Ot.collisionBoxArray.length,On!==void 0?On+1:Ot.collisionBoxArray.length,as!==void 0?as:Ot.collisionBoxArray.length,as!==void 0?as+1:Ot.collisionBoxArray.length,En||Ot.collisionBoxArray.length,En?En+1:Ot.collisionBoxArray.length,Ai,ii,Gi,yn,Xn,Fa,0,Cr,Xs,Ws,0,gs?1:0,Zn)})(r,ht,Yt,Ge,i,l,f,h,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Me,Q,T,0,$e,Qe,W,e,p,I,C,M,O,V,$,nt)};if(ee==="line")for(const Ge of Gg(e.geometry,0,0,yt,yt)){const ht=PR(Ge,be,ot,i.vertical||te,l,ve,ge,r.overscaling,yt);for(const dt of ht)te&&VR(r,te.text,rt,dt)||Ue(Ge,dt,M)}else if(ee==="line-center"){for(const Ge of e.geometry)if(Ge.length>1){const ht=MR(Ge,ot,i.vertical||te,l,ve,ge);ht&&Ue(Ge,ht,M)}}else if(e.type==="Polygon")for(const Ge of Bg(e.geometry,0)){const ht=RR(Ge,16);Ue(Ge[0],new Tl(ht.x,ht.y,0,0,void 0),M)}else if(e.type==="LineString")for(const Ge of e.geometry)Ue(Ge,new Tl(Ge[0].x,Ge[0].y,0,0,void 0),M);else if(e.type==="Point")for(const Ge of e.geometry)for(const ht of Ge)Ue([ht],new Tl(ht.x,ht.y,0,0,void 0),M)}const fm=255,Ac=fm*ka;function RS(r,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$,W){const Q=function(Y,te,oe,ve,ge,be,Me,$e){const ot=[];if(te.positionedLines.length===0)return ot;const Qe=ve.layout.get("text-rotate").evaluate(be,{})*Math.PI/180,rt=function(Ge){const ht=Ge[0],dt=Ge[1],Yt=ht*dt;return Yt>0?[ht,-dt]:Yt<0?[-ht,dt]:ht===0?[dt,ht]:[dt,-ht]}(oe);let at=Math.abs(te.top-te.bottom);for(const Ge of te.positionedLines)at-=Ge.lineOffset;const He=te.positionedLines.length,nt=at/He;let Ue=te.top-oe[1];for(let Ge=0;Ge<He;++Ge){const ht=te.positionedLines[Ge];Ue=DR(te,nt,Ue,Ge);for(const dt of ht.positionedGlyphs){if(!dt.rect)continue;const Yt=dt.rect||{};let Ot=ER+1,bt=!0,ct=1,di=0;if(dt.image){const Dt=Me.get(dt.image.toString());if(!Dt)continue;if(Dt.sdf){Si("SDF images are not supported in formatted text and will be ignored.");continue}bt=!1,ct=Dt.pixelRatio,Ot=eu/ct}const Lt=(ge||$e)&&dt.vertical,Ft=dt.metrics.advance*dt.scale/2,oi=dt.metrics,wi=dt.rect;if(wi===null)continue;$e&&te.verticalizable&&(di=dt.image?Ft-dt.metrics.width*dt.scale/2:0);const bi=ge?[dt.x+Ft,dt.y]:[0,0];let Ri=[0,0],Ai=[0,0],Li=!1;ge||(Lt?(Ai=[dt.x+Ft+rt[0],dt.y+rt[1]-di],Li=!0):Ri=[dt.x+Ft+oe[0],dt.y+oe[1]-di]);const ln=wi.w*dt.scale/(ct*(dt.localGlyph?sa:1)),Mn=wi.h*dt.scale/(ct*(dt.localGlyph?sa:1));let ne,ae,We,pt;if(Lt){const Dt=dt.y-Ue,si=new _t(-Ft,Ft-Dt),ki=-Math.PI/2,Fi=new _t(...Ai);ne=new _t(-Ft+Ri[0],Ri[1]),ne._rotateAround(ki,si)._add(Fi),ne.x+=-Dt+Ft,ne.y-=(oi.left-Ot)*dt.scale;const Ii=dt.image?oi.advance*dt.scale:Vs*dt.scale,dn=String.fromCodePoint(dt.glyph);xR(dn)?ne.x+=(1-Ot)*dt.scale:vR(dn)?ne.x+=Ii-oi.height*dt.scale+(-Ot-1)*dt.scale:ne.x+=dt.image||oi.width+2*Ot===wi.w&&oi.height+2*Ot===wi.h?(Ii-Mn)/2:(Ii-(oi.height+2*Ot)*dt.scale)/2,ae=new _t(ne.x,ne.y-ln),We=new _t(ne.x+Mn,ne.y),pt=new _t(ne.x+Mn,ne.y-ln)}else{const Dt=(oi.left-Ot)*dt.scale-Ft+Ri[0],si=(-oi.top-Ot)*dt.scale+Ri[1],ki=Dt+ln,Fi=si+Mn;ne=new _t(Dt,si),ae=new _t(ki,si),We=new _t(Dt,Fi),pt=new _t(ki,Fi)}if(Qe){let Dt;Dt=ge?new _t(0,0):Li?new _t(rt[0],rt[1]):new _t(oe[0],oe[1]),ne._rotateAround(Qe,Dt),ae._rotateAround(Qe,Dt),We._rotateAround(Qe,Dt),pt._rotateAround(Qe,Dt)}const wt=new _t(0,0),vt=new _t(0,0);ot.push({tl:ne,tr:ae,bl:We,br:pt,texPrimary:Yt,texSecondary:void 0,writingMode:te.writingMode,glyphOffset:bi,sectionIndex:dt.sectionIndex,isSDF:bt,pixelOffsetTL:wt,pixelOffsetBR:vt,minFontScaleX:0,minFontScaleY:0})}}return ot}(0,l,w,f,p,x,h,r.allowVerticalPlacement),ee=r.textSizeData;let U=null;ee.kind==="source"?(U=[ka*f.layout.get("text-size").evaluate(x,{},$)*O.textScaleFactor],U[0]>Ac&&Si(`${r.layerIds[0]}: Value for "text-size" is >= ${fm}. Reduce your "text-size".`)):ee.kind==="composite"&&(U=[ka*O.compositeTextSizes[0].evaluate(x,{},$)*O.textScaleFactor,ka*O.compositeTextSizes[1].evaluate(x,{},$)*O.textScaleFactor],(U[0]>Ac||U[1]>Ac)&&Si(`${r.layerIds[0]}: Value for "text-size" is >= ${fm}. Reduce your "text-size".`)),r.addSymbols(r.text,Q,U,w,p,x,I,e,i,T.lineStartIndex,T.lineLength,L,V,$,W,!1);for(const Y of C)M[Y]=r.text.placedSymbolArray.length-1;return 4*Q.length}function w0(r){for(const e in r)return r[e];return null}function ty(r,e,i,l,h,f,p,x,w,T){let I=p.top,C=p.bottom,M=p.left,L=p.right;if(cS(p)&&p.collisionPadding){const O=p.collisionPadding;M-=O[0],I-=O[1],L+=O[2],C+=O[3]}if(w){const O=new _t(M,I),V=new _t(L,I),$=new _t(M,C),W=new _t(L,C),Q=Yi(w);let ee=new _t(0,0);T&&(ee=new _t(T[0],T[1])),O._rotateAround(Q,ee),V._rotateAround(Q,ee),$._rotateAround(Q,ee),W._rotateAround(Q,ee),M=Math.min(O.x,V.x,$.x,W.x),L=Math.max(O.x,V.x,$.x,W.x),I=Math.min(O.y,V.y,$.y,W.y),C=Math.max(O.y,V.y,$.y,W.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,I,L,C,x,l,h,f),r.length-1}function T0(r){cS(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function VR(r,e,i,l){const h=r.compareText;if(e in h){const f=h[e];for(let p=f.length-1;p>=0;p--)if(l.dist(f[p])<i)return!0}else h[e]=[];return h[e].push(l),!1}function LS(r,e){const i=r.fovAboveCenter,l=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,h=(r._camera.position[2]*r.worldSize-l)/Math.cos(r._pitch),f=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let p=Math.sin(r._pitch)*f+h;const x=h*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let w=Math.max(r.zoom-17,0);r.isOrthographic&&(w/=10),p*=1+w}return Math.min(1.01*p,x)}function pm(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),l=r.x*i,h=(r.x+1)*i,f=r.y*i,p=(r.y+1)*i,x=ye(l),w=ye(h),T=Le(f),I=Le(p),C=e.project(x,T),M=e.project(w,T),L=e.project(w,I),O=e.project(x,I);let V=Math.min(C.x,M.x,L.x,O.x),$=Math.min(C.y,M.y,L.y,O.y),W=Math.max(C.x,M.x,L.x,O.x),Q=Math.max(C.y,M.y,L.y,O.y);const ee=i/16;function U(te,oe,ve,ge,be,Me){const $e=(ve+be)/2,ot=(ge+Me)/2,Qe=e.project(ye($e),Le(ot)),rt=Math.max(0,V-Qe.x,$-Qe.y,Qe.x-W,Qe.y-Q);V=Math.min(V,Qe.x),W=Math.max(W,Qe.x),$=Math.min($,Qe.y),Q=Math.max(Q,Qe.y),rt>ee&&(U(te,Qe,ve,ge,$e,ot),U(Qe,oe,$e,ot,be,Me))}U(C,M,l,f,h,f),U(M,L,h,f,h,p),U(L,O,h,p,l,p),U(O,C,l,p,l,f),V-=ee,$-=ee,W+=ee,Q+=ee;const Y=1/Math.max(W-V,Q-$);return{scale:Y,x:V*Y,y:$*Y,x2:W*Y,y2:Q*Y,projection:e}}function zS(r,{x:e,y:i},l=0){return new _t(((e-l)*r.scale-r.x)*yt,(i*r.scale-r.y)*yt)}const UR=pe(new Float32Array(16));class Ic{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new K(0,0)}projectTilePoint(e,i,l){return{x:e,y:i,z:0}}locationPoint(e,i,l,h=!0){return e._coordinatePoint(e.locationCoordinate(i,l),h)}pixelsPerMeter(e,i){return _e(1,e)*i}pixelSpaceConversion(e,i,l){return 1}farthestPixelDistance(e){return LS(e,e.pixelsPerMeter)}pointCoordinate(e,i,l,h){const f=e.horizonLineFromTop(!1),p=new _t(i,Math.max(f,l));return e.rayIntersectionCoordinate(e.pointRayIntersection(p,h))}pointCoordinate3D(e,i,l){const h=new _t(i,l);if(e.elevation)return e.elevation.pointCoordinate(h);{const f=this.pointCoordinate(e,h.x,h.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const l=e.horizonLineFromTop();return i.y<l}createInversionMatrix(e,i){return UR}createTileMatrix(e,i,l){let h,f,p;const x=l.canonical,w=pe(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=pm(x,this);h=1,f=T.x+l.wrap*T.scale,p=T.y,Pe(w,w,[h/T.scale,h/T.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(x.z),f=(x.x+Math.pow(2,x.z)*l.wrap)*h,p=x.y*h;return Je(w,w,[f,p,0]),Pe(w,w,[h/yt,h/yt,1]),w}upVector(e,i,l){return[0,0,1]}upVectorScale(e,i,l){return{metersToTile:1}}}class jR extends Ic{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,l]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Yi(i));this.n=(h+Math.sin(Yi(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:l,c:h,r0:f}=this,p=Yi(e-this.center[0]),x=Yi(i),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(p*l),y:w*Math.cos(p*l)-f,z:0}}unproject(e,i){const{n:l,c:h,r0:f}=this,p=f+i;let x=Math.atan2(e,Math.abs(p))*Math.sign(p);p*l<0&&(x-=Math.PI*Math.sign(e)*Math.sign(p));const w=Yi(this.center[0])*l;x=ke(x,-Math.PI-w,Math.PI-w);const T=de(Ne(x/l)+this.center[0],-180,180),I=Math.asin(de((h-(e*e+p*p)*l*l)/(2*l),-1,1)),C=de(Ne(I),-85.051129,qe);return new K(T,C)}}const mm=1.340264,_m=-.081106,gm=893e-6,ym=.003796,iy=Math.sqrt(3)/2;class $R extends Ic{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const l=Math.asin(iy*Math.sin(i)),h=l*l,f=h*h*h;return{x:.5*(e*Math.cos(l)/(iy*(mm+3*_m*h+f*(7*gm+9*ym*h)))/Math.PI+.5),y:1-.5*(l*(mm+_m*h+f*(gm+ym*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=l*l,f=h*h*h;for(let I,C,M,L=0;L<12&&(C=l*(mm+_m*h+f*(gm+ym*h))-i,M=mm+3*_m*h+f*(7*gm+9*ym*h),I=C/M,l=de(l-I,-Math.PI/3,Math.PI/3),h=l*l,f=h*h*h,!(Math.abs(I)<1e-12));++L);const p=iy*e*(mm+3*_m*h+f*(7*gm+9*ym*h))/Math.cos(l),x=Math.asin(Math.sin(l)/iy),w=de(180*p/Math.PI,-180,180),T=de(180*x/Math.PI,-85.051129,qe);return new K(w,T)}}class GR extends Ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const l=360*(e-.5),h=de(360*(.5-i),-85.051129,qe);return new K(l,h)}}const $d=Math.PI/2;function ny(r){return Math.tan(($d+r)/2)}class HR extends Ic{constructor(e){super(e),this.center=e.center||[0,30];const[i,l]=this.parallels=e.parallels||[30,30];let h=Yi(i),f=Yi(l);this.southernCenter=h+f<0,this.southernCenter&&(h=-h,f=-f);const p=Math.cos(h),x=ny(h);this.n=h===f?Math.sin(h):Math.log(p/Math.cos(f))/Math.log(ny(f)/x),this.f=p*Math.pow(ny(h),this.n)/this.n}project(e,i){i=Yi(i),this.southernCenter&&(i=-i),e=Yi(e-this.center[0]);const l=1e-6,{n:h,f}=this;f>0?i<-$d+l&&(i=-$d+l):i>$d-l&&(i=$d-l);const p=f/Math.pow(ny(i),h);let x=p*Math.sin(h*e),w=f-p*Math.cos(h*e);return x=.5*(x/Math.PI+.5),w=.5*(w/Math.PI+.5),{x,y:this.southernCenter?w:1-w,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:l,f:h}=this,f=h-i,p=Math.sign(f),x=Math.sign(l)*Math.sqrt(e*e+f*f);let w=Math.atan2(e,Math.abs(f))*p;f*l<0&&(w-=Math.PI*Math.sign(e)*p);const T=de(Ne(w/l)+this.center[0],-180,180),I=de(Ne(2*Math.atan(Math.pow(h/x,1/l))-$d),-85.051129,qe);return new K(T,this.southernCenter?-I:I)}}class OS extends Ic{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:ue(e),y:he(i),z:0}}unproject(e,i){const l=ye(e),h=Le(i);return new K(l,h)}}const kS=Yi(qe);class WR extends Ic{project(e,i){const l=(i=Yi(i))*i,h=l*l;return{x:.5*((e=Yi(e))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let l=i=(2*(1-i)-1)*Math.PI,h=25,f=0,p=l*l;do{p=l*l;const T=p*p;f=(l*(1.007226+p*(.015085+T*(.028874*p-.044475-.005916*T)))-i)/(1.007226+p*(.045255+T*(.259866*p-.311325-.005916*11*T))),l=de(l-f,-kS,kS)}while(Math.abs(f)>1e-6&&--h>0);p=l*l;const x=de(Ne(e/(.8707+p*(p*(p*p*p*(.003971-.001529*p)-.013791)-.131979))),-180,180),w=Ne(l);return new K(x,w)}}const FS=Yi(qe);class qR extends Ic{project(e,i){i=Yi(i),e=Yi(e);const l=Math.cos(i),h=2/Math.PI,f=Math.acos(l*Math.cos(e/2)),p=Math.sin(f)/f,x=.5*(e*h+2*l*Math.sin(e/2)/p)||0,w=.5*(i+Math.sin(i)/p)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(e,i){let l=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,f=25;const p=1e-6;let x=0,w=0;do{const T=Math.cos(h),I=Math.sin(h),C=2*I*T,M=I*I,L=T*T,O=Math.cos(l/2),V=Math.sin(l/2),$=2*O*V,W=V*V,Q=1-L*O*O,ee=Q?1/Q:0,U=Q?Math.acos(T*O)*Math.sqrt(1/Q):0,Y=.5*(2*U*T*V+2*l/Math.PI)-e,te=.5*(U*I+h)-i,oe=.5*ee*(L*W+U*T*O*M)+1/Math.PI,ve=ee*($*C/4-U*I*V),ge=.125*ee*(C*V-U*I*L*$),be=.5*ee*(M*O+U*W*T)+.5,Me=ve*ge-be*oe;x=(te*ve-Y*be)/Me,w=(Y*ge-te*oe)/Me,l=de(l-x,-Math.PI,Math.PI),h=de(h-w,-FS,FS)}while((Math.abs(x)>p||Math.abs(w)>p)&&--f>0);return new K(Ne(l),Ne(h))}}class BS extends Ic{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Yi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:l,cosPhi:h}=this;return{x:Yi(e)*h*l+.5,y:-Math.sin(Yi(i))/h*l+.5,z:0}}unproject(e,i){const{scale:l,cosPhi:h}=this,f=-(i-.5)/l,p=de(Ne((e-.5)/l)/h,-180,180),x=Math.asin(de(f*h,-1,1)),w=de(Ne(x),-85.051129,qe);return new K(p,w)}}class ZR extends OS{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,l){const h=qp(e,i,l);return fn(h,h,Og(za(l))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i,l){const h=j(i.lat,i.lng),f=Zi([],h),p=l?e._centerAltitude+l:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;ss(h,h,f,_e(1,0)*yt*p);const x=pe(new Float64Array(16));return Ie(x,e.pixelMatrix,e.globeMatrix),fn(h,h,x),new _t(h[0],h[1])}pixelsPerMeter(e,i){return _e(1,0)*i}pixelSpaceConversion(e,i,l){const h=_e(1,e)*i,f=ri(_e(1,45)*i,h,l);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,l){const h=Vv(za(l.canonical));return Ie(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:l}=e,h=Og(za(i));return tt(h,h,Yi(l.lng)),Oe(h,h,Yi(l.lat)),Pe(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,l,h){return vw(e,i,l,!0)||new Te(0,0)}pointCoordinate3D(e,i,l){const h=this.pointCoordinate(e,i,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!vw(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,f){const p=h.cameraToCenterDistance,x=h._centerAltitude*f,w=h._camera,T=h._camera.forward(),I=yi([],Ui([],T,-p),[0,0,x]),C=h.worldSize/(2*Math.PI),M=[0,0,-C],L=h.width/h.height,O=Math.tan(h.fovAboveCenter),V=Ui([],w.up(),O),$=Ui([],w.right(),O*L),W=Zi([],yi([],yi([],T,V),$)),Q=[];let ee;if(new Ln(I,W).closestPointOnSphere(M,C,Q)){const U=yi([],Q,M),Y=Ce([],U,I);ee=Math.cos(h.fovAboveCenter)*gi(Y)}else{const U=Ce([],I,M),Y=Ce([],M,I);Zi(Y,Y);const te=gi(U)-C;ee=Math.sqrt(te*(te+2*C));const oe=Math.acos(ee/(C+te))-Math.acos(en(T,Y));ee*=Math.cos(oe)}return 1.01*ee}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),l=Tc(e.zoom);if(l>0){const h=LS(e,_e(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),p=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ri(i,h+f*(1-Math.cos(p)),Math.pow(l,10))}return i}upVector(e,i,l){return qp(i,l,e,1)}upVectorScale(e){return{metersToTile:Rg(zg(za(e)))}}}function NS(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new OS(r);case"equirectangular":return new GR(r);case"naturalEarth":return new WR(r);case"equalEarth":return new $R(r);case"winkelTripel":return new qR(r);case"albers":return i?new BS(r):new jR(r);case"lambertConformalConic":return i?new BS(r):new HR(r);case"globe":return new ZR(r)}throw new Error(`Invalid projection name: ${r.name}`)}const XR=Mi.VectorTileFeature.types,YR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function sy(r,e,i,l,h,f,p,x,w,T,I,C,M){const L=x?Math.min(Ac,Math.round(x[0])):0,O=x?Math.min(Ac,Math.round(x[1])):0;r.emplaceBack(e,i,Math.round(32*l),Math.round(32*h),f,p,(L<<1)+(w?1:0),O,16*T,16*I,256*C,256*M)}function ry(r,e,i){r.emplaceBack(e,i)}function oy(r,e,i,l,h,f,p){r.emplaceBack(e,i,l,h,f,p)}const ay=(r,e,i,l)=>{for(let h=0;h<e;h++)r.emplaceBack(i[0],i[1],i[2],l[0],l[1],l[2])};function ly(r,e,i,l,h){r.emplaceBack(e,i,l,h),r.emplaceBack(e,i,l,h),r.emplaceBack(e,i,l,h),r.emplaceBack(e,i,l,h)}function KR(r){for(const e of r.sections)if(Mv(e.text))return!0;return!1}class S0{constructor(e){this.layoutVertexArray=new pc,this.indexArray=new Gs,this.programConfigurations=e,this.segments=new ts,this.dynamicLayoutVertexArray=new $s,this.opacityVertexArray=new _c,this.placedSymbolArray=new yg,this.iconTransitioningVertexArray=new Ma,this.globeExtVertexArray=new mc,this.zOffsetVertexArray=new Ia,this.orientationVertexArray=new kp}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,l,h,f){this.isEmpty()||(l&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,cR.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,uR.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,YR,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pR.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,hR.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,dR.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,fR.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ct(S0,"SymbolBuffers");class E0{constructor(e,i,l){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new l,this.segments=new ts,this.collisionVertexArray=new Fh,this.collisionVertexArrayExt=new $s}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mR.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,_R.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(E0,"CollisionBuffers");class cy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.lut=e.lut,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(p=>p.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=pe([]),this.placementViewportMatrix=pe([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.textSizeData=pS(this.zoom,i["text-size"],this.worldview),this.iconSizeData=pS(this.zoom,i["icon-size"],this.worldview);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),f=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(p=>Nr[p]),this.stateDependentLayerIds=this.layers.filter(p=>p.isStateDependent()).map(p=>p.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0}createArrays(){this.text=new S0(new u(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new S0(new u(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Vp,this.lineVertexArray=new bg,this.symbolInstances=new vg}calculateGlyphDependencies(e,i,l,h,f){for(const p of e){const x=p.codePointAt(0);if(x===void 0)break;if(i[x]=!0,h&&f&&x<=65535){const w=cm[p];w&&(i[w.charCodeAt(0)]=!0)}}}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Qv(this.activeReplacements,l)&&(this.activeReplacements=l,!0)}populate(e,i,l,h){const f=this.layers[0],p=f.layout,x=this.projection.name==="globe",w=p.get("text-font"),T=p.get("text-field"),I=p.get("icon-image"),[C,M]=p.get("icon-size-scale-range"),L=de(i.scaleFactor||1,C,M),O=(T.value.kind!=="constant"||T.value.value instanceof ar&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),V=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,$=p.get("symbol-sort-key");if(this.features=[],!O&&!V)return;const W=i.iconDependencies,Q=i.glyphDependencies,ee=i.availableImages,U=new gn(this.zoom,{worldview:this.worldview});for(const{feature:Y,id:te,index:oe,sourceLayerIndex:ve}of e){const ge=f._featureFilter.needGeometry,be=Et(Y,ge);if(!f._featureFilter.filter(U,be,l))continue;if(ge||(be.geometry=Pt(Y,l,h)),x&&Y.type!==1&&l.z<=5){const rt=be.geometry,at=.98078528056,He=(nt,Ue)=>en(qp(nt.x,nt.y,l,1),qp(Ue.x,Ue.y,l,1))<at;for(let nt=0;nt<rt.length;nt++)rt[nt]=ft(rt[nt],He)}let Me,$e;if(O){const rt=f.getValueAndResolveTokens("text-field",be,l,ee),at=ar.factory(rt);KR(at)&&(this.hasRTLText=!0),(!this.hasRTLText||cc()==="unavailable"||this.hasRTLText&&Qo.isParsed())&&(Me=yR(at,f,be))}if(V){const rt=f.getValueAndResolveTokens("icon-image",be,l,ee);$e=typeof rt=="string"?gr.build(rt):rt}if(!Me&&!$e)continue;const ot=this.sortFeaturesByKey?$.evaluate(be,{},l):void 0,Qe={id:te,text:Me,icon:$e,index:oe,sourceLayerIndex:ve,geometry:be.geometry,properties:Y.properties,type:XR[Y.type],sortKey:ot};if(this.features.push(Qe),$e){const rt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:at,iconSecondary:He}=MS($e,this.iconSizeData,rt["icon-size"],l,this.zoom,Qe,this.pixelRatio,L,this.worldview),nt=at.id.toString();if(W.has(nt)?W.get(nt).push(at):W.set(nt,[at]),He){const Ue=He.id.toString();W.has(Ue)?W.get(Ue).push(He):W.set(Ue,[He])}}if(Me){const rt=w.evaluate(be,{},l).join(","),at=p.get("text-rotation-alignment")==="map"&&p.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Nr.vertical)>=0;for(const He of Me.sections)if(He.image){const nt=He.image.getPrimary().scaleSelf(this.pixelRatio),Ue=nt.id.toString(),Ge=W.get(Ue)||[];Ge.push(nt),W.set(Ue,Ge)}else{const nt=Dh(Me.toString()),Ue=He.fontStack||rt,Ge=Q[Ue]=Q[Ue]||{};this.calculateGlyphDependencies(He.text,Ge,at,this.allowVerticalPlacement,nt)}}}if(p.get("symbol-placement")==="line"&&(this.features=function(Y){const te={},oe={},ve=[];let ge=0;function be(Qe){ve.push(Y[Qe]),ge++}function Me(Qe,rt,at){const He=oe[Qe];return delete oe[Qe],oe[rt]=He,ve[He].geometry[0].pop(),ve[He].geometry[0]=ve[He].geometry[0].concat(at[0]),He}function $e(Qe,rt,at){const He=te[rt];return delete te[rt],te[Qe]=He,ve[He].geometry[0].shift(),ve[He].geometry[0]=at[0].concat(ve[He].geometry[0]),He}function ot(Qe,rt,at){const He=at?rt[0][rt[0].length-1]:rt[0][0];return`${Qe}:${He.x}:${He.y}`}for(let Qe=0;Qe<Y.length;Qe++){const rt=Y[Qe],at=rt.geometry,He=rt.text?rt.text.toString():null;if(!He){be(Qe);continue}const nt=ot(He,at),Ue=ot(He,at,!0);if(nt in oe&&Ue in te&&oe[nt]!==te[Ue]){const Ge=$e(nt,Ue,at),ht=Me(nt,Ue,ve[Ge].geometry);delete te[nt],delete oe[Ue],oe[ot(He,ve[ht].geometry,!0)]=ht,ve[Ge].geometry=null}else nt in oe?Me(nt,Ue,at):Ue in te?$e(nt,Ue,at):(be(Qe),te[nt]=ge-1,oe[Ue]=ge-1)}return ve.filter(Qe=>Qe.geometry)}(this.features)),p.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Y of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Y.id,this.elevationFeatures.length),this.elevationFeatures.push(Y)}}else p.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Y,te)=>Y.sortKey-te.sortKey)}update(e,i,l,h,f,p,x){this.text.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,l,h,p,x,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const l=je(e),h=1/l;let f=!1,p=!1;for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x),T=_i(1,0,0),I=_i(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:M,numIconVertices:L,numVerticalIconVertices:O}=w,V=C>0||M>0,$=L>0,W=this.elevationFeatures[w.elevationFeatureIndex];if(W){const Q=new _t(w.tileAnchorX,w.tileAnchorY),ee=.075+W.pointElevation(Q);w.zOffset!==ee&&(i=!0,w.zOffset=ee);const U=W.computeSlopeNormal(Q,h),Y=zs(Gt(),_i(0,0,1),U);Ks(T,T,Y),Ks(I,I,Y),T[2]*=l,I[2]*=l,T[0]===1&&T[1]===0&&T[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(f=f||V,p=p||$)}if(V&&(ay(this.text.orientationVertexArray,C,T,I),ay(this.text.orientationVertexArray,M,T,I)),$){const{placedIconSymbolIndex:Q,verticalPlacedIconSymbolIndex:ee}=w;Q>=0&&ay(this.icon.orientationVertexArray,L,T,I),ee>=0&&ay(this.icon.orientationVertexArray,O,T,I)}}f||(this.text.orientationVertexArray=void 0),p||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,p,x)=>{l+=p,l>f.length&&f.resize(l);for(let w=-p;w<0;w++)f.emplace(w+l,x)},i=(f,p,x)=>{h+=p,h>f.length&&f.resize(h);for(let w=-p;w<0;w++)f.emplace(w+h,x)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let l=0,h=0;for(let f=0;f<this.symbolInstances.length;f++){const p=this.symbolInstances.get(f),{numHorizontalGlyphVertices:x,numVerticalGlyphVertices:w,numIconVertices:T}=p,I=p.zOffset,C=T>0;if((x>0||w>0)&&(e(this.text.zOffsetVertexArray,x,I),e(this.text.zOffsetVertexArray,w,I)),C){const{placedIconSymbolIndex:M,verticalPlacedIconSymbolIndex:L}=p;M>=0&&i(this.icon.zOffsetVertexArray,T,I),L>=0&&i(this.icon.zOffsetVertexArray,p.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=NS(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const l=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:f}of i)this.lineVertexArray.emplaceBack(h,f);return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(e,i,l,h,f,p,x,w,T,I,C,M,L,O,V,$){const W=e.indexArray,Q=e.layoutVertexArray,ee=e.globeExtVertexArray,U=e.segments.prepareSegment(4*i.length,Q,W,this.canOverlap?p.sortKey:void 0),Y=this.glyphOffsetArray.length,te=U.vertexLength,oe=this.allowVerticalPlacement&&x===Nr.vertical?Math.PI/2:0,ve=p.text&&p.text.sections;for(let be=0;be<i.length;be++){const{tl:Me,tr:$e,bl:ot,br:Qe,texPrimary:rt,texSecondary:at,pixelOffsetTL:He,pixelOffsetBR:nt,minFontScaleX:Ue,minFontScaleY:Ge,glyphOffset:ht,isSDF:dt,sectionIndex:Yt}=i[be],Ot=U.vertexLength,bt=ht[1];if(sy(Q,T.x,T.y,Me.x,bt+Me.y,rt.x,rt.y,l,dt,He.x,He.y,Ue,Ge),sy(Q,T.x,T.y,$e.x,bt+$e.y,rt.x+rt.w,rt.y,l,dt,nt.x,He.y,Ue,Ge),sy(Q,T.x,T.y,ot.x,bt+ot.y,rt.x,rt.y+rt.h,l,dt,He.x,nt.y,Ue,Ge),sy(Q,T.x,T.y,Qe.x,bt+Qe.y,rt.x+rt.w,rt.y+rt.h,l,dt,nt.x,nt.y,Ue,Ge),w){const{x:ct,y:di,z:Lt}=w.anchor,[Ft,oi,wi]=w.up;oy(ee,ct,di,Lt,Ft,oi,wi),oy(ee,ct,di,Lt,Ft,oi,wi),oy(ee,ct,di,Lt,Ft,oi,wi),oy(ee,ct,di,Lt,Ft,oi,wi),ly(e.dynamicLayoutVertexArray,ct,di,Lt,oe)}else ly(e.dynamicLayoutVertexArray,T.x,T.y,T.z,oe);if($){const ct=at||rt;ry(e.iconTransitioningVertexArray,ct.x,ct.y),ry(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y),ry(e.iconTransitioningVertexArray,ct.x,ct.y+ct.h),ry(e.iconTransitioningVertexArray,ct.x+ct.w,ct.y+ct.h)}W.emplaceBack(Ot,Ot+1,Ot+2),W.emplaceBack(Ot+1,Ot+2,Ot+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ht[0]),be!==i.length-1&&Yt===i[be+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,p,p.index,{},L,O,V,ve&&ve[Yt],this.worldview)}const ge=w?w.anchor:T;e.placedSymbolArray.emplaceBack(ge.x,ge.y,ge.z,T.x,T.y,Y,this.glyphOffsetArray.length-Y,te,I,C,T.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,0,0,M,0)}_commitLayoutVertex(e,i,l,h,f,p,x){e.emplaceBack(i,l,h,f,p,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(e,i,l,h,f,p,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),T=w.vertexLength,I=x.tileAnchorX,C=x.tileAnchorY;for(let L=0;L<4;L++)l.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(l.collisionVertexArrayExt,i,e.padding,x.zOffset),this._commitLayoutVertex(l.layoutVertexArray,h,f,p,I,C,new _t(e.x1,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,p,I,C,new _t(e.x2,e.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,f,p,I,C,new _t(e.x2,e.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,f,p,I,C,new _t(e.x1,e.y2)),w.vertexLength+=4;const M=l.indexArray;M.emplaceBack(T,T+1),M.emplaceBack(T+1,T+2),M.emplaceBack(T+2,T+3),M.emplaceBack(T+3,T),w.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,l,h,f,p){for(let x=h;x<f;x++){const w=l.get(x),T=this.getSymbolInstanceTextSize(e,p,i,x);this._addCollisionDebugVertices(w,T,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}_addIconDebugCollisionBoxes(e,i,l,h,f,p){for(let x=h;x<f;x++){const w=l.get(x),T=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._addCollisionDebugVertices(w,T,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,p)}}generateCollisionDebugBuffers(e,i,l){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new E0(wd,eS.members,Ma),this.iconCollisionBox=new E0(wd,eS.members,Ma);const h=um(this.iconSizeData,e),f=um(this.textSizeData,e,l);for(let p=0;p<this.symbolInstances.length;p++){const x=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(f,e,i,x.textBoxStartIndex,x.textBoxEndIndex,x),this._addTextDebugCollisionBoxes(f,e,i,x.verticalTextBoxStartIndex,x.verticalTextBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,i,x.iconBoxStartIndex,x.iconBoxEndIndex,x),this._addIconDebugCollisionBoxes(h,e,i,x.verticalIconBoxStartIndex,x.verticalIconBoxEndIndex,x)}}getSymbolInstanceTextSize(e,i,l,h){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),p=g0(this.textSizeData,e,f)/Vs;return this.tilePixelRatio*p}getSymbolInstanceIconSize(e,i,l){const h=this.icon.placedSymbolArray.get(l),f=g0(this.iconSizeData,e,h);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,l,h){e.emplaceBack(i,-l,-l,h),e.emplaceBack(i,l,-l,h),e.emplaceBack(i,l,l,h),e.emplaceBack(i,-l,l,h)}_updateTextDebugCollisionBoxes(e,i,l,h,f,p,x){for(let w=h;w<f;w++){const T=l.get(w),I=this.getSymbolInstanceTextSize(e,p,i,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}_updateIconDebugCollisionBoxes(e,i,l,h,f,p,x){for(let w=h;w<f;w++){const T=l.get(w),I=this.getSymbolInstanceIconSize(e,i,p.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,T.padding,p.zOffset)}}updateCollisionDebugBuffers(e,i,l,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=um(this.iconSizeData,e,h),p=um(this.textSizeData,e,l);for(let x=0;x<this.symbolInstances.length;x++){const w=this.symbolInstances.get(x);this._updateTextDebugCollisionBoxes(p,e,i,w.textBoxStartIndex,w.textBoxEndIndex,w,l),this._updateTextDebugCollisionBoxes(p,e,i,w.verticalTextBoxStartIndex,w.verticalTextBoxEndIndex,w,l),this._updateIconDebugCollisionBoxes(f,e,i,w.iconBoxStartIndex,w.iconBoxEndIndex,w,h),this._updateIconDebugCollisionBoxes(f,e,i,w.verticalIconBoxStartIndex,w.verticalIconBoxEndIndex,w,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,l,h,f,p,x,w,T){const I={};if(i<l){const{x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U,featureIndex:Y}=e.get(i);I.textBox={x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U},I.textFeatureIndex=Y}if(h<f){const{x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U,featureIndex:Y}=e.get(h);I.verticalTextBox={x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U},I.verticalTextFeatureIndex=Y}if(p<x){const{x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U,featureIndex:Y}=e.get(p);I.iconBox={x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U},I.iconFeatureIndex=Y}if(w<T){const{x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U,featureIndex:Y}=e.get(w);I.verticalIconBox={x1:C,y1:M,x2:L,y2:O,padding:V,projectedAnchorX:$,projectedAnchorY:W,projectedAnchorZ:Q,tileAnchorX:ee,tileAnchorY:U},I.verticalIconFeatureIndex=Y}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const l=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const l=e.placedSymbolArray.get(i),h=l.vertexStartIndex+4*l.numGlyphs;for(let f=l.vertexStartIndex;f<h;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),l=Math.cos(e),h=[],f=[],p=[];for(let x=0;x<this.symbolInstances.length;++x){p.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(i*w.tileAnchorX+l*w.tileAnchorY)),f.push(w.featureIndex)}return p.sort((x,w)=>h[x]-h[w]||f[w]-f[x]),p}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===i?l.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const l=this.symbolInstances.get(i);this.featureSortOrder.push(l.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:p,verticalPlacedTextSymbolIndex:x,placedIconSymbolIndex:w,verticalPlacedIconSymbolIndex:T}=l;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),f>=0&&f!==h&&this.addIndicesForPlacedSymbol(this.text,f),p>=0&&p!==f&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),x>=0&&this.addIndicesForPlacedSymbol(this.text,x),w>=0&&this.addIndicesForPlacedSymbol(this.icon,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let VS,US,A0;Ct(cy,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),cy.addDynamicAttributes=ly;class jS{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Hl,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(jS,"FormatSectionOverride",{omit:["defaultValue"]});const I0=()=>A0||(A0={layout:VS||(VS=new Kn({"symbol-placement":new lt(Re.layout_symbol["symbol-placement"]),"symbol-spacing":new lt(Re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new lt(Re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new St(Re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new lt(Re.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new lt(Re.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new lt(Re.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new lt(Re.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new lt(Re.layout_symbol["icon-ignore-placement"]),"icon-optional":new lt(Re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new lt(Re.layout_symbol["icon-rotation-alignment"]),"icon-size":new St(Re.layout_symbol["icon-size"]),"icon-size-scale-range":new lt(Re.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new St(Re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new St(Re.layout_symbol["icon-text-fit-padding"]),"icon-image":new St(Re.layout_symbol["icon-image"]),"icon-rotate":new St(Re.layout_symbol["icon-rotate"]),"icon-padding":new lt(Re.layout_symbol["icon-padding"]),"icon-keep-upright":new lt(Re.layout_symbol["icon-keep-upright"]),"icon-offset":new St(Re.layout_symbol["icon-offset"]),"icon-anchor":new St(Re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new lt(Re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new lt(Re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new lt(Re.layout_symbol["text-rotation-alignment"]),"text-field":new St(Re.layout_symbol["text-field"]),"text-font":new St(Re.layout_symbol["text-font"]),"text-size":new St(Re.layout_symbol["text-size"]),"text-size-scale-range":new lt(Re.layout_symbol["text-size-scale-range"]),"text-max-width":new St(Re.layout_symbol["text-max-width"]),"text-line-height":new St(Re.layout_symbol["text-line-height"]),"text-letter-spacing":new St(Re.layout_symbol["text-letter-spacing"]),"text-justify":new St(Re.layout_symbol["text-justify"]),"text-radial-offset":new St(Re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new lt(Re.layout_symbol["text-variable-anchor"]),"text-anchor":new St(Re.layout_symbol["text-anchor"]),"text-max-angle":new lt(Re.layout_symbol["text-max-angle"]),"text-writing-mode":new lt(Re.layout_symbol["text-writing-mode"]),"text-rotate":new St(Re.layout_symbol["text-rotate"]),"text-padding":new lt(Re.layout_symbol["text-padding"]),"text-keep-upright":new lt(Re.layout_symbol["text-keep-upright"]),"text-transform":new St(Re.layout_symbol["text-transform"]),"text-offset":new St(Re.layout_symbol["text-offset"]),"text-allow-overlap":new lt(Re.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new lt(Re.layout_symbol["text-ignore-placement"]),"text-optional":new lt(Re.layout_symbol["text-optional"]),visibility:new lt(Re.layout_symbol.visibility)})),paint:US||(US=new Kn({"icon-opacity":new St(Re.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new St(Re.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new St(Re.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new St(Re.paint_symbol["text-emissive-strength"]),"icon-color":new St(Re.paint_symbol["icon-color"]),"icon-halo-color":new St(Re.paint_symbol["icon-halo-color"]),"icon-halo-width":new St(Re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new St(Re.paint_symbol["icon-halo-blur"]),"icon-translate":new lt(Re.paint_symbol["icon-translate"]),"icon-translate-anchor":new lt(Re.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new lt(Re.paint_symbol["icon-image-cross-fade"]),"text-opacity":new St(Re.paint_symbol["text-opacity"]),"text-occlusion-opacity":new St(Re.paint_symbol["text-occlusion-opacity"]),"text-color":new St(Re.paint_symbol["text-color"],{runtimeType:Er,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new St(Re.paint_symbol["text-halo-color"]),"text-halo-width":new St(Re.paint_symbol["text-halo-width"]),"text-halo-blur":new St(Re.paint_symbol["text-halo-blur"]),"text-translate":new lt(Re.paint_symbol["text-translate"]),"text-translate-anchor":new lt(Re.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new lt(Re.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new lt(Re.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new lt(Re.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new lt(Re.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new St(Re.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},A0);class hy extends nr{constructor(e,i,l,h){super(e,I0(),i,l,h),this._colorAdjustmentMatrix=pe([]),this.hasInitialOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const f of l)h.indexOf(f)<0&&h.push(f);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,l,h){return this._saturation===e&&this._contrast===i&&this._brightnessMin===l&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(f,p,x,w){f=er(f),p=mr(p);const T=we(),I=f/3,C=1-2*I,M=[C,I,I,0,I,C,I,0,I,I,C,0,0,0,0,1],L=.5-.5*p,O=w-x;return Ie(T,[O,0,0,0,0,O,0,0,0,0,O,0,x,x,x,1],[p,0,0,0,0,p,0,0,0,0,p,0,L,L,L,1]),Ie(T,T,M),T}(e,i,l,h),this._saturation=e,this._contrast=i,this._brightnessMin=l,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,l,h){const f=this.layout.get(e).evaluate(i,{},l,h),p=this._unevaluatedLayout._values[e];return p.isDataDriven()||dd(p.value)||!f?f:function(x,w){return w.replace(/{([^{}]+)}/g,(T,I)=>I in x?String(x[I]):"")}(i.properties,f)}createBucket(e){return new cy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of I0().paint.overridableProperties){if(!hy.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),l=new jS(i),h=new oc(l,i.property.specification,this.scope,this.options);let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new Mh("source",h):new Ph("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new hc(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,l){return!(!this.layout||i.isDataDriven()||l.isDataDriven())&&hy.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const l=e.get("text-field"),h=I0().paint.properties[i];let f=!1;const p=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(f=!0)};if(l.value.kind==="constant"&&l.value.value instanceof ar)p(l.value.value.sections);else if(l.value.kind==="source"){const x=T=>{f||(T instanceof ci&&It(T.value)===dh?p(T.value.sections):T instanceof ql?p(T.sections):T.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,l){return{config:new vc(this,{zoom:i,lut:l}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let $S,GS,HS,WS;var C0=Xi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function M0(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function P0(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class D0{constructor(e,i,l,h){this.context=e,this.format=l,this.useMipmap=h&&h.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(e,i){const l=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,h=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:p}=f,{x,y:w}=i&&i.position?i.position:{x:0,y:0},T=x+l,I=w+h;!this.size||this.size[0]===T&&this.size[1]===I||(p.bindTexture(p.TEXTURE_2D,null),p.deleteTexture(this.texture),this.texture=p.createTexture(),this.size=null),p.bindTexture(p.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===p.RGBA8&&(!i||i.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&T>0&&I>0){const M=this.useMipmap?Math.floor(Math.log2(Math.max(T,I)))+1:1;p.texStorage2D(p.TEXTURE_2D,M,this.format,T,I),this.size=[T,I]}if(this.size)if(C)p.texSubImage2D(p.TEXTURE_2D,0,x,w,M0(this.format),P0(this.format),e);else{const M=e.data;M&&p.texSubImage2D(p.TEXTURE_2D,0,x,w,l,h,M0(this.format),P0(this.format),M)}this.useMipmap&&p.generateMipmap(p.TEXTURE_2D)}bind(e,i,l=!1){const{context:h}=this,{gl:f}=h;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!l?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,l,h,f){const{context:p}=this,{gl:x}=p;x.bindTexture(x.TEXTURE_2D,this.texture),i!==this.magFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,this.useMipmap?e===x.NEAREST?x.NEAREST_MIPMAP_NEAREST:x.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),l!==this.wrapS&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,l),this.wrapS=l),h!==this.wrapT&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,h),this.wrapT=h),f!==this.compareMode&&(f?(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.COMPARE_REF_TO_TEXTURE),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_FUNC,f)):x.texParameteri(x.TEXTURE_2D,x.TEXTURE_COMPARE_MODE,x.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class uy{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}function dy(r,e,i,l,h,f,p,x){const w=[r,e,1,i,l,1,h,f,1],T=[p,x,1],I=ie([],w),[C,M,L]=pr(T,T,I);return se(w,w,[C,0,0,0,M,0,0,0,L])}function qS(r,e,i,l,h,f,p,x){const w=function(T,I,C,M,L,O,V,$){const W=dy(0,0,1,0,1,1,0,1),Q=dy(T,I,C,M,L,O,V,$);return se(Q,Q,ie([],W))}(r,e,i,l,h,f,p,x);return[w[2]/w[8]/yt,w[5]/w[8]/yt]}function fy(r){return[r[0],Math.min(Math.max(r[1],-85.051129),qe)]}class ZS extends sl{constructor(e,i,l,h){super(),this.id=e,this.dispatcher=l,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new nl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Gf(this.map._requestManager.transformRequest(this.url,ah.Image),(l,h)=>{this._imageRequest=null,this._loaded=!0,l?this.fire(new Nu(l)):h&&(this.image=h instanceof HTMLImageElement?no.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new uy(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new nl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof uy||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],l=e[0][1];for(const f of e)f[1]>l&&(l=f[1]),f[1]<i&&(i=f[1]);const h=(l+i)/2;if(h>qe?this.onNorthPole=!0:h<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(Te.fromLngLat);this.tileID=function(p){let x=1/0,w=1/0,T=-1/0,I=-1/0;for(const V of p)x=Math.min(x,V.x),w=Math.min(w,V.y),T=Math.max(T,V.x),I=Math.max(I,V.y);const C=Math.max(T-x,I-w),M=Math.max(0,Math.floor(-Math.log(C)/Math.LN2)),L=Math.pow(2,M);let O=Math.floor((x+T)/2*L);return O>1&&(O-=1),new Xh(M,O,Math.floor((w+I)/2*L))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new nl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const W in this.tiles){const Q=this.tiles[W];Q.state!=="loaded"&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=pm(new Xh(0,0,0),this.map.transform.projection),l=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(W){const Q=W[1].x-W[0].x,ee=W[1].y-W[0].y,U=W[2].x-W[1].x,Y=W[2].y-W[1].y,te=W[3].x-W[2].x,oe=W[3].y-W[2].y,ve=W[0].x-W[3].x,ge=W[0].y-W[3].y,be=Q*Y-U*ee,Me=U*oe-te*Y,$e=te*ge-ve*oe,ot=ve*ee-Q*ge;return be>0&&Me>0&&$e>0&&ot>0||be<0&&Me<0&&$e<0&&ot<0}(l))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=pm(this.tileID,this.map.transform.projection),[f,p,x,w]=this.coordinates.map(W=>{const Q=h.projection.project(W[0],W[1]);return zS(h,Q)._round()});this.perspectiveTransform=qS(f.x,f.y,p.x,p.y,x.x,x.y,w.x,w.y);const T=this._boundsArray=new dc;T.emplaceBack(f.x,f.y,0,0),T.emplaceBack(p.x,p.y,yt,0),T.emplaceBack(w.x,w.y,0,yt),T.emplaceBack(x.x,x.y,yt,yt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(T,C0.members),this.boundsSegments=ts.simpleSegment(0,0,4,2);const I=[],C=[fy((M=this.coordinates)[0]),fy(M[1]),fy(M[2]),fy(M[3])];var M;const[L,O,V,$]=function(W){let Q=W[0][0],ee=Q,U=W[0][1],Y=U;for(let te=1;te<W.length;te++)W[te][0]<Q?Q=W[te][0]:W[te][0]>ee&&(ee=W[te][0]),W[te][1]<U?U=W[te][1]:W[te][1]>Y&&(Y=W[te][1]);return[Q,U,ee-Q,Y-U]}(C);{const W=new dc,[Q,ee,U,Y]=function(He){let nt=He[0].x,Ue=nt,Ge=He[0].y,ht=Ge;for(let dt=1;dt<He.length;dt++)He[dt].x<nt?nt=He[dt].x:He[dt].x>Ue&&(Ue=He[dt].x),He[dt].y<Ge?Ge=He[dt].y:He[dt].y>ht&&(ht=He[dt].y);return[nt,Ge,Ue-nt,ht-Ge]}(l),te=He=>[(He.x-Q)/U,(He.y-ee)/Y],[oe,ve,ge,be]=l.map(te),Me=function(He,nt,Ue,Ge,ht,dt,Yt,Ot){const bt=dy(0,0,1,0,1,1,0,1);return se(bt,bt,ie([],dy(He,nt,Ue,Ge,ht,dt,Yt,Ot)))}(oe[0],oe[1],ve[0],ve[1],ge[0],ge[1],be[0],be[1]);this.elevatedGlobePerspectiveTransform=qS(oe[0],oe[1],ve[0],ve[1],ge[0],ge[1],be[0],be[1]);const $e=(He,nt)=>{I.push(He.lng);const Ue=Math.round((He.lng-L)/V*yt),Ge=Math.round((He.lat-O)/$*yt),ht=te(nt),dt=pr([],[ht[0],ht[1],1],Me),Yt=Math.round(dt[0]/dt[2]*yt),Ot=Math.round(dt[1]/dt[2]*yt);W.emplaceBack(Ue,Ge,Yt,Ot)},ot=l[3].x-l[0].x,Qe=l[3].y-l[0].y,rt=l[2].x-l[1].x,at=l[2].y-l[1].y;for(let He=0;He<65;He++){const nt=He/64,Ue=[l[0].x+nt*ot,l[0].y+nt*Qe],Ge=[l[1].x+nt*rt,l[1].y+nt*at],ht=Ge[0]-Ue[0],dt=Ge[1]-Ue[1];for(let Yt=0;Yt<65;Yt++){const Ot=Yt/64,bt={x:Ue[0]+ht*Ot,y:Ue[1]+dt*Ot};$e(i.projection.unproject(bt.x,bt.y),bt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(W,C0.members)}{this.maxLongitudeTriangleSize=0;let W=[],Q=new Gs;const ee=(U,Y,te)=>{Q.emplaceBack(U,Y,te);const oe=I[U],ve=I[Y],ge=I[te],be=Math.min(Math.min(oe,ve),ge),Me=Math.max(Math.max(oe,ve),ge)-be;Me>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Me),W.push(be+Me/2)};for(let U=0;U<64;U++)for(let Y=0;Y<64;Y++){const te=65*U+Y,oe=te+1,ve=te+65,ge=ve+1;ee(te,ve,oe),ee(oe,ve,ge)}[W,Q]=function(U,Y){const te=Array.from({length:U.length},(ge,be)=>be);te.sort((ge,be)=>U[ge]-U[be]);const oe=[],ve=new Gs;for(let ge=0;ge<te.length;ge++){const be=te[ge];oe.push(U[be]);const Me=3*be,$e=Me+1;ve.emplaceBack(Y.uint16[Me],Y.uint16[$e],Y.uint16[$e+1])}return[oe,ve]}(W,Q),this.elevatedGlobeTrianglesCenterLongitudes=W,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Q)}this.elevatedGlobeSegments=ts.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,V/yt,0,$/yt,0,0,O,L,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,l=i.gl;!this._dirty||this.texture instanceof uy||(this.texture?this.texture.update(this.image):(this.texture=new D0(i,this.image,l.RGBA8),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const l=this.elevatedGlobeTrianglesCenterLongitudes;let h=(f=e+180)+360*Math.round((l[0]-f)/360);var f;const p=new ts,x=(C,M)=>{p.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:M,sortKey:void 0,vaos:{}})},w=.51*this.maxLongitudeTriangleSize;if(Math.abs(l[0]-h)<=w){const C=Bs(l,0,l.length,h+w);return C===l.length||x(C,Wn(l,C+1,l.length,h+360-w)-C),p}h<l[0]&&(h+=360);const T=Wn(l,0,l.length,h-w);if(T===l.length)return x(0,l.length),p;x(0,T-0);const I=Bs(l,T+1,l.length,h+w);return I!==l.length&&x(I,l.length-I),p}}const JR=(Math.pow(256,2)-1)/16907520;class XS extends nr{constructor(e,i,l,h){super(e,{layout:HS||(HS=new Kn({visibility:new lt(Re.layout_raster.visibility)})),paint:WS||(WS=new Kn({"raster-opacity":new lt(Re.paint_raster["raster-opacity"]),"raster-color":new yl(Re.paint_raster["raster-color"]),"raster-color-mix":new lt(Re.paint_raster["raster-color-mix"]),"raster-color-range":new lt(Re.paint_raster["raster-color-range"]),"raster-hue-rotate":new lt(Re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new lt(Re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new lt(Re.paint_raster["raster-brightness-max"]),"raster-saturation":new lt(Re.paint_raster["raster-saturation"]),"raster-contrast":new lt(Re.paint_raster["raster-contrast"]),"raster-resampling":new lt(Re.paint_raster["raster-resampling"]),"raster-fade-duration":new lt(Re.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new lt(Re.paint_raster["raster-emissive-strength"]),"raster-array-band":new lt(Re.paint_raster["raster-array-band"]),"raster-elevation":new lt(Re.paint_raster["raster-elevation"]),"raster-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof ZS&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[l,h]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(l)&&isNaN(h)||l===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=Zp({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:l,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[l,h])}}let YS,KS,JS,QS,eE;class tE extends nr{constructor(e,i,l,h){super(e,{layout:YS||(YS=new Kn({visibility:new lt(Re["layout_raster-particle"].visibility)})),paint:KS||(KS=new Kn({"raster-particle-array-band":new lt(Re["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new lt(Re["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new yl(Re["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new lt(Re["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new lt(Re["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new lt(Re["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new lt(Re["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new lt(Re["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},i,l,h),this._updateColorRamp(),this.lastInvalidatedAt=no.now()}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Zp({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=no.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class QR extends nr{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function R0(r,e,i){const l=[0,0,1],h=Kt([]);return Ci(h,h,i?-Yi(r)+Math.PI:Yi(r)),Vt(h,h,-Yi(e)),Ks(l,l,h),Zi(l,l)}function iE(r,e){const i=py(r.projection,r.zoom,r.width,r.height),l=function(f,p,x,w,T){const I=new K(x.lng-180*Cc,x.lat),C=new K(x.lng+180*Cc,x.lat),M=f.project(I.lng,I.lat),L=f.project(C.lng,C.lat),O=-Math.atan2(L.y-M.y,L.x-M.x),V=Te.fromLngLat(x);V.y=de(V.y,-1+Cc,1-Cc);const $=V.toLngLat(),W=f.project($.lng,$.lat),Q=Te.fromLngLat($);Q.x+=Cc;const ee=Q.toLngLat(),U=f.project(ee.lng,ee.lat),Y=sE(U.x-W.x,U.y-W.y,O),te=Te.fromLngLat($);te.y+=Cc;const oe=te.toLngLat(),ve=f.project(oe.lng,oe.lat),ge=sE(ve.x-W.x,ve.y-W.y,O),be=Math.abs(Y.x)/Math.abs(ge.y),Me=pe([]);xt(Me,Me,-O*(1-(T?0:w)));const $e=pe([]);return Pe($e,$e,[1,1-(1-be)*w,1]),$e[4]=-ge.x/ge.y*w,xt($e,$e,O),Ie($e,Me,$e),$e}(r.projection,0,r.center,i,e),h=nE(r);return Pe(l,l,[h,h,1]),l}function nE(r){const e=r.projection,i=py(r.projection,r.zoom,r.width,r.height),l=L0(e,r.center),h=L0(e,K.convert(e.center));return Math.pow(2,l*i+(1-i)*h)}function py(r,e,i,l,h=1/0){const f=r.range;if(!f)return 0;const p=Math.min(h,Math.max(i,l)),x=Math.log(p/1024)/Math.LN2;return Se(f[0]+x,f[1]+x,e)}const Cc=1/4e4;function L0(r,e){const i=de(e.lat,-85.051129,qe),l=new K(e.lng-180*Cc,i),h=new K(e.lng+180*Cc,i),f=r.project(l.lng,i),p=r.project(h.lng,i),x=Te.fromLngLat(l),w=Te.fromLngLat(h),T=p.x-f.x,I=p.y-f.y,C=w.x-x.x,M=w.y-x.y,L=Math.sqrt((C*C+M*M)/(T*T+I*I));return Math.log(L)/Math.LN2}function sE(r,e,i){const l=Math.cos(i),h=Math.sin(i);return{x:r*l-e*h,y:r*h+e*l}}function rE(r,e,i){pe(r),xt(r,r,Yi(e[2])),Oe(r,r,Yi(e[0])),tt(r,r,Yi(e[1])),Pe(r,r,i),Ie(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function my(r,e,i,l,h,f,p,x){const w=[i[0]-e[0],i[1]-e[1],0],T=[l[0]-e[0],l[1]-e[1],0];if(gi(w)<1e-12||gi(T)<1e-12)return Kt(r);const I=es([],w,T);Zi(I,I),$t(T,l,e),w[2]=(f-h)*x,T[2]=(p-h)*x;const C=w;return es(C,w,T),Zi(C,C),zs(r,I,C)}function z0(r,e,i=!1){const l=Tc(e.zoom),h=function(f,p,x){const w=p.worldSize,T=[f[12],f[13],f[14]],I=Le(T[1]/w),C=ye(T[0]/w),M=pe([]),L=_e(1,I)*w,O=_e(1,0)*w*st(I,p.zoom),V=1/Uv(w);let $=O*V;if(x){const U=py(p.projection,p.zoom,p.width,p.height,1024);$=V*p.projection.pixelSpaceConversion(p.center.lat,w,U)}const W=j(I,C);yi(W,W,Ui([],Zi([],W),L*$*T[2]));const Q=function(U){const Y=[U[0],U[1],U[2]];let te=[0,1,0];const oe=es([],te,Y);return es(te,Y,oe),Fs(te)===0&&(te=[0,1,0],es(oe,Y,te)),Zi(oe,oe),Zi(te,te),Zi(Y,Y),[oe[0],oe[1],oe[2],0,te[0],te[1],te[2],0,Y[0],Y[1],Y[2],0,U[0],U[1],U[2],1]}(W);Pe(M,M,[$,$,$*L]),Je(M,M,[-T[0],-T[1],-T[2]]);const ee=Ie([],p.globeMatrix,Q);return Ie(ee,ee,M),Ie(ee,ee,f),ee}(r,e,i);if(l>0){const f=function(p,x){const w=x.worldSize,T=_e(1,0)*w*st(x.center.lat,x.zoom)/Uv(w),I=_e(1,x.center.lat)*w,C=pe([]);return tt(C,C,Yi(x.center.lng)),Oe(C,C,Yi(x.center.lat)),Je(C,C,[0,0,v]),Pe(C,C,[T,T,T*I]),Je(C,C,[x.point.x-.5*w,x.point.y-.5*w,0]),Ie(C,C,p),Ie(C,x.globeMatrix,C)}(r,e);return function(p,x,w){const T=(O,V,$)=>{const W=gi(O),Q=gi(V),ee=wl(O,V,$);return Ui(ee,ee,1/gi(ee)*ri(W,Q,$))},I=T([p[0],p[1],p[2]],[x[0],x[1],x[2]],w),C=T([p[4],p[5],p[6]],[x[4],x[5],x[6]],w),M=T([p[8],p[9],p[10]],[x[8],x[9],x[10]],w),L=wl([p[12],p[13],p[14]],[x[12],x[13],x[14]],w);return[I[0],I[1],I[2],0,C[0],C[1],C[2],0,M[0],M[1],M[2],0,L[0],L[1],L[2],1]}(h,f,l)}return h}function oE(r,e,i,l){const h=Ki.projectAabbCorners(l,i);let f=Number.MAX_VALUE,p=-1;for(let T=0;T<h.length;++T){const I=h[T];I[0]=(.5*I[0]+.5)*e.width,I[1]=(.5-.5*I[1])*e.height,I[2]<f&&(p=T,f=I[2])}const x=T=>new _t(h[T][0],h[T][1]);let w;switch(p){case 0:case 6:w=[x(1),x(5),x(4),x(7),x(3),x(2),x(1)];break;case 1:case 7:w=[x(0),x(4),x(5),x(6),x(2),x(3),x(0)];break;case 3:case 5:w=[x(1),x(0),x(4),x(7),x(6),x(2),x(1)];break;default:w=[x(1),x(5),x(6),x(7),x(3),x(0),x(1)]}if(xr(r,w))return f}const eL=Xi([{name:"a_pos_3f",components:3,type:"Float32"}]),tL=Xi([{name:"a_color_3f",components:3,type:"Float32"}]),iL=Xi([{name:"a_color_4f",components:4,type:"Float32"}]),nL=Xi([{name:"a_uv_2f",components:2,type:"Float32"}]),sL=Xi([{name:"a_normal_3f",components:3,type:"Float32"}]),rL=Xi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),oL=Xi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]),aE={None:0,Model:1,Symbol:2,FillExtrusion:4};class _y{constructor(e,i,l,h){this.message=(e?`${e}: `:"")+l,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function O0(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class lE{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class cE{constructor(){this.instancedDataArray=new gc,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class k0{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs}updateFootprints(e,i){}populate(e,i,l,h){this.tileToMeter=je(l);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:p,id:x,index:w,sourceLayerIndex:T}of e){const I=x??(p.properties&&p.properties.hasOwnProperty("id")?p.properties.id:void 0),C=Et(p,f);if(!this.layers[0]._featureFilter.filter(new gn(this.zoom,{worldview:this.worldview}),C,l))continue;const M={id:I,sourceLayerIndex:T,index:w,geometry:f?C.geometry:Pt(p,l,h),properties:p.properties,type:p.type,patterns:{}},L=this.addFeature(M,M.geometry,C);L&&i.featureIndex.insert(p,M.geometry,w,T,this.index,this.instancesPerModel[L].instancedDataArray.length,yt/32)}this.lookup=null}update(e,i,l,h){for(const f in this.instancesPerModel){const p=this.instancesPerModel[f];for(const x in e)p.idToFeaturesIndex.hasOwnProperty(x)&&(this.evaluate(p.features[p.idToFeaturesIndex[x]],e[x],p,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];for(const h of l.features){const f=this.layers[0],p=h.feature,x=this.canonical,w=f.paint.get("model-rotation").evaluate(p,{},x),T=f.paint.get("model-scale").evaluate(p,{},x),I=f.paint.get("model-translation").evaluate(p,{},x);Js(h.rotation,w)&&Js(h.scale,T)&&Js(h.translation,I)||(this.evaluate(h,h.featureStates,l,!0),e=!0)}}return e}updateReplacement(e,i,l,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Qv(this.activeReplacements,f))return!1;this.activeReplacements=f;let p=!1;for(const x in this.instancesPerModel){const w=this.instancesPerModel[x],T=w.instancedDataArray;for(const I of w.features){const C=I.instancedDataOffset,M=I.instancedDataCount;for(let L=0;L<M;L++){const O=16*(L+C);let V=T.float32[O+0];const $=V>yt;V=$?V-yt:V;const W=Math.floor(V),Q=T.float32[O+1];let ee=!1;for(const U of this.activeReplacements)if(!tT(U,l,aE.Model,h)&&!(U.min.x>W||W>U.max.x||U.min.y>Q||Q>U.max.y)&&(ee=aT(oT(W,Q,e.canonical,U.footprintTileId.canonical),U.footprint),ee))break;T.float32[O]=ee?V+yt:V,p=p||ee!==$}}}return p}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length<0||l.instancedDataArray.length===0||(l.instancedDataBuffer?l.instancedDataBuffer.updateData(l.instancedDataArray):l.instancedDataBuffer=e.createVertexBuffer(l.instancedDataArray,rL.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const l=this.instancesPerModel[i];l.instancedDataArray.length!==0&&l.instancedDataBuffer&&l.instancedDataBuffer.destroy()}const e=this.layers[0].modelManager;if(e&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)e.removeModel(i,"",!0)}addFeature(e,i,l){const h=this.layers[0],f=h.layout.get("model-id").evaluate(l,{},this.canonical);if(!f)return Si(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),f;(O0(f,!1)||this.styleDefinedModelURLs[f]!==void 0)&&(this.modelUris.includes(f)||this.modelUris.push(f)),this.instancesPerModel[f]||(this.instancesPerModel[f]=new cE);const p=this.instancesPerModel[f],x=p.instancedDataArray,w=new lE(l,x.length);for(const T of i)for(const I of T){if(I.x<0||I.x>=yt||I.y<0||I.y>=yt)continue;const C=(this.lookupDim-1)/yt,M=this.lookupDim*(I.y*C|0)+I.x*C|0;if(this.lookup){if(this.lookup[M]!==0)continue;this.lookup[M]=1}this.instanceCount++;const L=x.length;x.resize(L+1),p.instancesEvaluatedElevation.push(0),x.float32[16*L]=I.x,x.float32[16*L+1]=I.y}return w.instancedDataCount=p.instancedDataArray.length-w.instancedDataOffset,w.instancedDataCount>0&&(e.id&&(p.idToFeaturesIndex[e.id]=p.features.length),p.features.push(w),this.evaluate(w,{},p,!1)),f}getModelUris(){return this.modelUris}evaluate(e,i,l,h){const f=this.layers[0],p=e.feature,x=this.canonical,w=e.rotation=f.paint.get("model-rotation").evaluate(p,i,x),T=e.scale=f.paint.get("model-scale").evaluate(p,i,x),I=e.translation=f.paint.get("model-translation").evaluate(p,i,x),C=f.paint.get("model-color").evaluate(p,i,x);C.a=f.paint.get("model-color-mix-intensity").evaluate(p,i,x);const M=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),rE(M,w,T);const L=Math.round(100*C.a)+C.b/1.05;for(let O=0;O<e.instancedDataCount;++O){const V=e.instancedDataOffset+O,$=16*V,W=l.instancedDataArray.float32;let Q=0;h&&(Q=W[$+6]-l.instancesEvaluatedElevation[V]);const ee=0|W[$+1];W[$]=(0|W[$])+C.r/1.05,W[$+1]=ee+C.g/1.05,W[$+2]=L,W[$+3]=1/(x.z>10?this.tileToMeter:je(x,ee)),W[$+4]=I[0],W[$+5]=I[1],W[$+6]=I[2]+Q,W[$+7]=M[0],W[$+8]=M[1],W[$+9]=M[2],W[$+10]=M[4],W[$+11]=M[5],W[$+12]=M[6],W[$+13]=M[8],W[$+14]=M[9],W[$+15]=M[10],l.instancesEvaluatedElevation[V]=I[2]}}}let hE,uE;Ct(k0,"ModelBucket",{omit:["layers"]}),Ct(cE,"PerModelAttributes"),Ct(lE,"ModelFeature");const iu=64,Gd={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function dE(r,e,i,l,h,f,p,x,w,T=!1){const I=i.zoom,C=i.project(l),M=st(l.lat,I),L=1/M;pe(r),Je(r,r,[C.x+p[0]*L,C.y+p[1]*L,p[2]]);let O=1,V=1;const $=i.worldSize;if(T){if(i.projection.name==="mercator"){let U=0;i.elevation&&(U=i.elevation.getAtPointOrZero(new Te(C.x/$,C.y/$),0));const Y=Qt([],[C.x,C.y,U,1],i.projMatrix)[3]/i.cameraToCenterDistance;O=Y,V=Y*st(i.center.lat,I)}else if(i.projection.name==="globe"){const U=z0(r,i),Y=[0,0,0,1];Qt(Y,Y,Ie([],i.projMatrix,U));const te=Y[3]/i.cameraToCenterDistance,oe=Tc(I),ve=i.projection.pixelsPerMeter(l.lat,$)*st(l.lat,I),ge=i.projection.pixelsPerMeter(i.center.lat,$)*st(i.center.lat,I);O=te/ri(ve,Xe(i.center.lat),oe),V=te*M/ve,O*=ge,V*=ge}}else O=L;Pe(r,r,[O,O,V]);const W=[...r],Q=e.orientation,ee=[];if(rE(ee,[Q[0]+h[0],Q[1]+h[1],Q[2]+h[2]],f),Ie(r,W,ee),x&&i.elevation){let U=0;const Y=[];if(w&&i.elevation){U=function(oe,ve,ge,be,Me){const $e=ve.elevation;if(!$e)return 0;const ot=Ki.projectAabbCorners(ge,be),Qe=_e(1,Me.lat)*ve.worldSize,rt=function(ct,di){const Lt=[0,0,1],Ft=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const oi of Ft){const wi=ct[oi.corners[0]],bi=ct[oi.corners[1]],Ri=ct[oi.corners[2]],Ai=[bi[0]-wi[0],bi[1]-wi[1],di*(bi[2]-wi[2])],Li=es(Ai,Ai,[Ri[0]-wi[0],Ri[1]-wi[1],di*(Ri[2]-wi[2])]);Zi(Li,Li),oi.dotProductWithUp=en(Li,Lt)}return Ft.sort((oi,wi)=>oi.dotProductWithUp-wi.dotProductWithUp),Ft[0].corners}(ot,Qe),at=ot[rt[0]],He=ot[rt[1]],nt=ot[rt[2]],Ue=ot[rt[3]],Ge=$e.getAtPointOrZero(new Te(at[0]/ve.worldSize,at[1]/ve.worldSize),0),ht=$e.getAtPointOrZero(new Te(He[0]/ve.worldSize,He[1]/ve.worldSize),0),dt=$e.getAtPointOrZero(new Te(nt[0]/ve.worldSize,nt[1]/ve.worldSize),0),Yt=$e.getAtPointOrZero(new Te(Ue[0]/ve.worldSize,Ue[1]/ve.worldSize),0),Ot=(Ge+Yt)/2,bt=(ht+dt)/2;return Ot>bt?ht<dt?my(oe,He,Ue,at,ht,Yt,Ge,Qe):my(oe,nt,at,Ue,dt,Ge,Yt,Qe):Ge<Yt?my(oe,at,He,nt,Ge,ht,dt,Qe):my(oe,Ue,nt,He,Yt,dt,ht,Qe),Math.max(Ot,bt)}(Y,i,e.aabb,r,l);const te=Ie([],Wt([],Y),ee);Ie(r,W,te)}else U=i.elevation.getAtPointOrZero(new Te(C.x/$,C.y/$),0);U!==0&&(r[14]+=U)}}function xm(r,e,i=!1){r.uploaded||(r.gfxTexture=new D0(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function aL(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,eL.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,sL.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,nL.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?tL:iL).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,oL.members,!0)),r.segments=ts.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const l=r.material;l.pbrMetallicRoughness.baseColorTexture&&xm(l.pbrMetallicRoughness.baseColorTexture,e),l.pbrMetallicRoughness.metallicRoughnessTexture&&xm(l.pbrMetallicRoughness.metallicRoughnessTexture,e),l.normalTexture&&xm(l.normalTexture,e),l.occlusionTexture&&xm(l.occlusionTexture,e,i),l.emissionTexture&&xm(l.emissionTexture,e)}function F0(r,e,i){if(r.meshes)for(const l of r.meshes)aL(l,e,i);if(r.children)for(const l of r.children)F0(l,e,i)}function gy(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)gy(e)}function B0(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)B0(i)}class Hd{constructor(e,i,l){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=l}static create(e,i,l){const h=l||e.findDEMTileFor(i);if(!h||!h.dem)return;const f=h.dem,p=h.tileID,x=1<<i.canonical.z-p.canonical.z;return new Hd(h,f.dim/yt/x,[(i.canonical.x/x-p.canonical.x)*f.dim,(i.canonical.y/x-p.canonical.y)*f.dim])}tileCoordToPixel(e,i){const l=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(l);return new _t(h,f)}getElevationAt(e,i,l,h){const f=e*this._scale+this._offset[0],p=i*this._scale+this._offset[1],x=Math.floor(f),w=Math.floor(p),T=this._dem;return h=!!h,l?ri(ri(T.get(x,w,h),T.get(x,w+1,h),p-w),ri(T.get(x+1,w,h),T.get(x+1,w+1,h),p-w),f-x):T.get(x,w,h)}getElevationAtPixel(e,i,l){return this._dem.get(e,i,!!l)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*_e(1,e)*this._dem.stride}}const N0=new Float32Array(262144),nu=new Uint8Array(262144);function fE(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,fE(i));return e}function pE(r,e,i){if(r.meshes)for(const l of r.meshes){if(l.aabb.min[0]===1/0)continue;const h=Ki.applyTransform(l.aabb,r.matrix);i.insert(e,h.min[0],h.min[1],h.max[0],h.max[1])}if(r.children)for(const l of r.children)pE(l,e,i)}const mE=["","wall","door","roof","window","lamp","logo"];class _E{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:fE(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ki([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ki([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const l of this.node.meshes)this.node.lightMeshIndex!==e&&(l.transformedAabb=Ki.applyTransformFast(l.aabb,this.node.matrix),i.encapsulate(l.transformedAabb)),e++;this.aabb=i}return this.aabb}}class yy{constructor(e,i,l,h,f,p,x,w){this.id=l,this.layers=e,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Gd.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Gd.HasMapboxMeshFeatures),f&&(this.modelTraits|=Gd.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=p,this.worldview=w,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new _E(T)),pE(T,x.featureIndexArray.length,x.grid),x.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,x.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(e,i){for(const l of this.getNodesInfo()){const h=l.node;h.footprint&&i.push({footprint:h.footprint,id:e})}}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const l=i?this.stateDependentLayers:this.layers;if(!jo(e,this.states))for(const h of l)this.evaluate(h,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const l of i){const h=l.node;this.uploaded?this.updatePbrBuffer(h):F0(h,e,!0)}for(const l of i)gy(l.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const l of e.meshes)l.pbrBuffer&&(l.pbrBuffer.updateData(l.featureArray),i=!0);return i}needsReEvaluation(e,i,l){const h=e.transform.projectionOptions,f=e.style.getBrightness(),p=this.brightness!==f;if(!this.uploaded||this.dirty||h.name!==this.projection.name||vm(l.paint.get("model-color").value,p)||vm(l.paint.get("model-color-mix-intensity").value,p)||vm(l.paint.get("model-roughness").value,p)||vm(l.paint.get("model-emissive-strength").value,p)||vm(l.paint.get("model-height-based-emissive-strength-multiplier").value,p)){this.projection=h,this.brightness=f;const x=this.getNodesInfo();for(const w of x)w.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const l=this.getNodesInfo(),h=this.id.canonical;for(const f of l){const p=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(p,{},h),f.evaluatedScale=i.paint.get("model-scale").evaluate(p,{},h)}}evaluate(e,i){const l=this.getNodesInfo();for(const h of l){if(!h.node.meshes)continue;const f=h.feature,p=i&&i[f.id];if(jo(p,h.state))continue;h.state=structuredClone(p);const x=h.node.meshes&&h.node.meshes[0].featureData,w=h.evaluatedColor[2],T=h.evaluatedRMEA[2],I=this.id.canonical;if(h.hasTranslucentParts=!1,x){for(let C=0;C<mE.length;C++){const M=mE[C];M.length&&(f.properties.part=M);const L=e.paint.get("model-color").evaluate(f,p,I).toPremultipliedRenderColor(null),O=e.paint.get("model-color-mix-intensity").evaluate(f,p,I);h.evaluatedColor[C]=[L.r,L.g,L.b,O],h.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(f,p,I),h.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I),h.evaluatedRMEA[C][3]=L.a,h.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,p,I),!h.hasTranslucentParts&&L.a<1&&(h.hasTranslucentParts=!0)}delete f.properties.part,cL(h,w!==h.evaluatedColor[2]||T!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,p,I);h.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,p,I),h.evaluatedScale=e.paint.get("model-scale").evaluate(f,p,I),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,l,h){const f=e.findDEMTileFor(l);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const p=Hd.create(e,l,f);if(!p)return;this.modelTraits&Gd.HasMapboxMeshFeatures&&this.updateDEM(e,p,l,h);for(const x of this.getNodesInfo()){const w=x.node;if(!w.footprint||!w.footprint.vertices||!w.footprint.vertices.length)continue;const T=w.footprint.vertices;let I=p.getElevationAt(T[0].x,T[0].y,!0,!0);for(let C=1;C<T.length;C++)I=Math.min(I,p.getElevationAt(T[C].x,T[C].y,!0,!0));w.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,l,h){let f=i._dem._modifiedForSources[h];if(f===void 0&&(i._dem._modifiedForSources[h]=[],f=i._dem._modifiedForSources[h]),f.includes(l.canonical))return;const p=i._dem.dim;f.push(l.canonical);let x=!1;for(const w of this.getNodesInfo()){const T=w.node;if(!T.footprint||!T.footprint.grid)continue;const I=T.footprint.grid,C=i.tileCoordToPixel(I.min.x,I.min.y),M=i.tileCoordToPixel(I.max.x,I.max.y),L=Math.min(Math.min(p-M.y,C.x),Math.min(C.y,p-M.x));if(L<0)continue;const O=de(L,2,5);let V=Math.max(0,C.x-O),$=Math.max(0,C.y-O),W=Math.min(M.x+O,p-1),Q=Math.min(M.y+O,p-1);for(let te=$;te<=Q;++te)for(let oe=V;oe<=W;++oe)nu[te*p+oe]=255;let ee=0,U=0;for(let te=0;te<I.cellsY;++te)for(let oe=0;oe<I.cellsX;++oe){if(!I.cells[te*I.cellsX+oe])continue;const ve=i.tileCoordToPixel(I.min.x+oe/I.xScale,I.min.y+te/I.yScale),ge=i.tileCoordToPixel(I.min.x+(oe+1)/I.xScale,I.min.y+(te+1)/I.yScale);for(let be=ve.y;be<=Math.min(ge.y+1,p-1);++be)for(let Me=ve.x;Me<=Math.min(ge.x+1,p-1);++Me)nu[be*p+Me]===255&&(nu[be*p+Me]=0,ee+=i.getElevationAtPixel(Me,be),U++)}const Y=ee/U;V=Math.max(1,C.x-O),$=Math.max(1,C.y-O),W=Math.min(M.x+O,p-2),Q=Math.min(M.y+O,p-2),x=!0;for(let te=$;te<=Q;++te)for(let oe=V;oe<=W;++oe)nu[te*p+oe]===0&&(N0[te*p+oe]=i._dem.set(oe,te,Y));for(let te=1;te<O;++te){V=Math.max(1,C.x-te),$=Math.max(1,C.y-te),W=Math.min(M.x+te,p-2),Q=Math.min(M.y+te,p-2);for(let oe=$;oe<=Q;++oe)for(let ve=V;ve<=W;++ve){const ge=oe*p+ve;if(nu[ge]===255){let be=0,Me=0,$e=-1,ot=-1;for(let Qe=-1;Qe<=1;++Qe)for(let rt=-1;rt<=1;++rt){const at=(oe+Qe)*p+ve+rt;if(nu[at]>=te)continue;const He=N0[at],nt=Math.abs(He);nt>Me&&(be=He,Me=nt,$e=rt,ot=Qe)}if(Me>.1){const Qe=1-(te+.5*Math.abs($e*ot))/O;let rt=i._dem.get(ve,oe)+be*Qe;const at=i._dem.get(ve+$e,oe+ot),He=i._dem.get(ve-$e,oe-ot,!0);(rt-at)*(rt-He)>0&&(rt=(at+He)/2),N0[ge]=i._dem.set(ve,oe,rt),nu[ge]=te}}}}}x&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=no.now())}setFilter(e){this.filter=e?Ap(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new gn(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)gy(i.node),B0(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const l=i.getReplacementRegionsForTile(e.toUnwrapped());for(const h of this.getNodesInfo()){const f=h.node.footprint;h.hiddenByReplacement=!!f&&!l.find(p=>p.footprint===f)}}getHeightAtTileCoord(e,i){const l=[],h=[0,0,0],f=pe([]);for(const p of this.getNodesInfo()){const x=p.node.meshes[0],w=x.transformedAabb;if(e<w.min[0]||i<w.min[1]||e>w.max[0]||i>w.max[1])continue;if(p.node.hidden===!0)return{height:1/0,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};Ae(f,p.node.matrix),h[0]=e,h[1]=i,fn(h,h,f);const T=(h[0]-x.aabb.min[0])/(x.aabb.max[0]-x.aabb.min[0])*iu|0,I=Math.min(63,(h[1]-x.aabb.min[1])/(x.aabb.max[1]-x.aabb.min[1])*iu|0)*iu+Math.min(63,T),C=x.heightmap[I];if(!(C<0&&p.node.footprint))return p.hiddenByReplacement?void 0:{height:C,maxHeight:p.feature.properties.height,hidden:!1,verticalScale:p.evaluatedScale[2]};if(p.node.footprint.grid.query(new _t(e,i),new _t(e,i),l),l.length>0)return{height:void 0,maxHeight:p.feature.properties.height,hidden:p.hiddenByReplacement,verticalScale:p.evaluatedScale[2]}}}}function vm(r,e){return r instanceof Mh&&!r.isLightConstant&&e}function lL(r,e,i,l,h,f,p,x){let w=(61440&e|(61440&e)>>4)>>8,T=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(w=ri(w,255*i[0],i[3]),T=ri(T,255*i[1],i[3]),I=ri(I,255*i[2],i[3]));const C=w<<8|T,M=I<<8|Math.floor(255*l[3]),L=function(te){const oe=de(te,0,2);return Math.min(Math.round(.5*oe*255),255)}(l[2])<<8|15*l[0]<<4|15*l[1],O=de(h[0],0,1),V=de(h[1],0,1),$=de(h[2],0,1),W=de(h[3],0,1);let Q,ee,U,Y;if(O!==V&&p!==f&&V!==O){const te=p-f;ee=1/(te*(V-O)),U=-(f+te*O)/(te*(V-O));const oe=de(h[4],-1,1);Y=Math.pow(10,oe),Q=255*$<<8|255*W}else Q=65535,ee=0,U=1,Y=1;if(r.emplaceBack(C,M,L,Q,ee,U,Y),x){const te=x.length;x.clear();for(let oe=0;oe<te;oe++)x.emplaceBack(C,M,L,Q,ee,U,Y)}}function cL(r,e,i){const l=r.node;let h=0;const f=i&Gd.HasMeshoptCompression;for(const p of l.meshes){if(l.lights&&l.lightMeshIndex===h||!p.featureData)continue;p.featureArray=new Uh,p.featureArray.reserve(p.featureData.length);let x=e;for(const w of p.featureData){const T=f?65535&w:w>>16&65535,I=f?w>>16&65535:65535&w,C=(15&I)<8?15&I:0,M=r.evaluatedRMEA[C],L=r.evaluatedColor[C],O=r.emissionHeightBasedParams[C];let V;if(x&&C===2&&l.lights&&(V=new Uh,V.resize(10*l.lights.length)),lL(p.featureArray,T,L,M,O,p.aabb.min[2],p.aabb.max[2],V),V&&x){x=!1;const $=l.meshes[l.lightMeshIndex];$.featureArray=V,$.featureArray._trim()}}p.featureArray._trim(),h++}}function gE(r,e,i,l){const h=1<<r.z;e.lat=Le((l/yt+r.y)/h),e.lng=ye((i/yt+r.x)/h)}function hL(r,e,i,l){const h=r.getNodesInfo()[e];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let f=Number.MAX_VALUE;const p=h.node,x=i.tile,w=l.calculatePosMatrix(x.tileID.toUnwrapped(),l.worldSize),T=h.evaluatedScale;let I=0;l.elevation&&p.elevation&&(I=p.elevation*l.elevation.exaggeration()),Je(w,w,[(p.anchor?p.anchor[0]:0)*(T[0]-1),(p.anchor?p.anchor[1]:0)*(T[1]-1),I]),Pe(w,w,T);const C=i.queryGeometry,M=C.isPointQuery()?C.screenBounds:C.screenGeometry,L=function(V){const $=Ie([],w,V.matrix);Ie($,l.expandedFarZProjMatrix,$);for(let W=0;W<V.meshes.length;++W){const Q=V.meshes[W];if(W===V.lightMeshIndex)continue;const ee=oE(M,l,$,Q.aabb);ee!=null&&(f=Math.min(ee,f))}if(V.children)for(const W of V.children)L(W)};if(L(p),f===Number.MAX_VALUE)return;const O=new K(0,0);return gE(x.tileID.canonical,O,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:f,position:O,feature:h.feature}}Ct(yy,"Tiled3dModelBucket",{omit:["layers"]}),Ct(_E,"Tiled3dModelFeature");const uL={circle:class extends nr{constructor(r,e,i,l){super(r,{layout:mw||(mw=new Kn({"circle-sort-key":new St(Re.layout_circle["circle-sort-key"]),"circle-elevation-reference":new lt(Re.layout_circle["circle-elevation-reference"]),visibility:new lt(Re.layout_circle.visibility)})),paint:_w||(_w=new Kn({"circle-radius":new St(Re.paint_circle["circle-radius"]),"circle-color":new St(Re.paint_circle["circle-color"]),"circle-blur":new St(Re.paint_circle["circle-blur"]),"circle-opacity":new St(Re.paint_circle["circle-opacity"]),"circle-translate":new lt(Re.paint_circle["circle-translate"]),"circle-translate-anchor":new lt(Re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new lt(Re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new lt(Re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new St(Re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new St(Re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new St(Re.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new lt(Re.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}createBucket(r){return new Kr(r)}queryRadius(r){const e=r;return Ld("circle-radius",this,e)+Ld("circle-stroke-width",this,e)+Pg(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,l,h,f,p,x){const w=pw(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Mw(r,l,f,p,x,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",w,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const l=Cw(this);return{config:new vc(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends nr{createBucket(r){return new Dw(r)}constructor(r,e,i,l){super(r,{layout:Rw||(Rw=new Kn({visibility:new lt(Re.layout_heatmap.visibility)})),paint:Lw||(Lw=new Kn({"heatmap-radius":new St(Re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new St(Re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new lt(Re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new yl(Re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new lt(Re.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Ld("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,l,h,f,p,x){const w=this.paint.get("heatmap-radius").evaluate(e,i);return Mw(r,l,f,p,x,!0,!0,new _t(0,0),w)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new vc(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends nr{constructor(r,e,i,l){super(r,{layout:zw||(zw=new Kn({visibility:new lt(Re.layout_hillshade.visibility)})),paint:Ow||(Ow=new Kn({"hillshade-illumination-direction":new lt(Re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new lt(Re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new lt(Re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new lt(Re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new lt(Re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new lt(Re.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new lt(Re.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends nr{constructor(r,e,i,l){super(r,{layout:Yw||(Yw=new Kn({"fill-sort-key":new St(Re.layout_fill["fill-sort-key"]),visibility:new lt(Re.layout_fill.visibility),"fill-elevation-reference":new lt(Re.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new St(Re.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Kw||(Kw=new Kn({"fill-antialias":new lt(Re.paint_fill["fill-antialias"]),"fill-opacity":new St(Re.paint_fill["fill-opacity"]),"fill-color":new St(Re.paint_fill["fill-color"]),"fill-outline-color":new St(Re.paint_fill["fill-outline-color"]),"fill-translate":new lt(Re.paint_fill["fill-translate"]),"fill-translate-anchor":new lt(Re.paint_fill["fill-translate-anchor"]),"fill-pattern":new St(Re.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new lt(Re.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new lt(Re.paint_fill["fill-emissive-strength"]),"fill-z-offset":new St(Re.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new St(Re.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new St(Re.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new vc(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Yv(r)}queryRadius(){return Pg(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,l,h,f){return!r.queryGeometry.isAboveHorizon&&ho(fw(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),l)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends nr{constructor(r,e,i,l){super(r,{layout:wT||(wT=new Kn({visibility:new lt(Re["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new lt(Re["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:TT||(TT=new Kn({"fill-extrusion-opacity":new lt(Re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new St(Re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new lt(Re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new lt(Re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new St(Re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new lt(Re["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new St(Re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new St(Re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new lt(Re["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new lt(Re["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new lt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new lt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new lt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new lt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new lt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new lt(Re["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new lt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new lt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new St(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new St(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new lt(Re["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new lt(Re["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new lt(Re["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new lt(Re["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new St(Re["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new St(Re["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new lt(Re["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new $g(r)}queryRadius(){return Pg(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,l,h,f,p,x,w){const T=pw(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),M=[0,0],L=x&&f.elevation,O=f.elevation?f.elevation.exaggeration():1,V=r.tile.getBucket(this);if(L&&V instanceof $g){const U=V.centroidVertexArray,Y=w+1;Y<U.length&&(M[0]=U.geta_centroid_pos0(Y),M[1]=U.geta_centroid_pos1(Y))}if(M[0]===0&&M[1]===1)return!1;f.projection.name==="globe"&&(l=bT([l],[new _t(0,0),new _t(yt,yt)],r.tileID.canonical).map(U=>U.polygon).flat());const $=L?x:null,[W,Q]=function(U,Y,te,oe,ve,ge,be,Me,$e,ot,Qe){return U.projection.name==="globe"?function(rt,at,He,nt,Ue,Ge,ht,dt,Yt,Ot,bt){const ct=[],di=[],Lt=rt.projection.upVectorScale(bt,rt.center.lat,rt.worldSize).metersToTile,Ft=[0,0,0,1],oi=[0,0,0,1],wi=(Ri,Ai,Li,ln)=>{Ri[0]=Ai,Ri[1]=Li,Ri[2]=ln,Ri[3]=1},bi=vT();He>0&&(He+=bi),nt+=bi;for(const Ri of at){const Ai=[],Li=[];for(const ln of Ri){const Mn=ln.x+Ue.x,ne=ln.y+Ue.y,ae=rt.projection.projectTilePoint(Mn,ne,bt),We=rt.projection.upVector(bt,ln.x,ln.y);let pt=He,wt=nt;if(ht){const vt=MT(Mn,ne,He,nt,ht,dt,Yt,Ot);pt+=vt.base,wt+=vt.top}He!==0?wi(Ft,ae.x+We[0]*Lt*pt,ae.y+We[1]*Lt*pt,ae.z+We[2]*Lt*pt):wi(Ft,ae.x,ae.y,ae.z),wi(oi,ae.x+We[0]*Lt*wt,ae.y+We[1]*Lt*wt,ae.z+We[2]*Lt*wt),fn(Ft,Ft,Ge),fn(oi,oi,Ge),Ai.push(new Jh(Ft[0],Ft[1],Ft[2])),Li.push(new Jh(oi[0],oi[1],oi[2]))}ct.push(Ai),di.push(Li)}return[ct,di]}(U,Y,te,oe,ve,ge,be,Me,$e,ot,Qe):be?function(rt,at,He,nt,Ue,Ge,ht,dt,Yt){const Ot=[],bt=[],ct=[0,0,0,1];for(const di of rt){const Lt=[],Ft=[];for(const oi of di){const wi=oi.x+nt.x,bi=oi.y+nt.y,Ri=MT(wi,bi,at,He,Ge,ht,dt,Yt);ct[0]=wi,ct[1]=bi,ct[2]=Ri.base,ct[3]=1,Qt(ct,ct,Ue),ct[3]=Math.max(ct[3],1e-5);const Ai=new Jh(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);ct[0]=wi,ct[1]=bi,ct[2]=Ri.top,ct[3]=1,Qt(ct,ct,Ue),ct[3]=Math.max(ct[3],1e-5);const Li=new Jh(ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]);Lt.push(Ai),Ft.push(Li)}Ot.push(Lt),bt.push(Ft)}return[Ot,bt]}(Y,te,oe,ve,ge,be,Me,$e,ot):function(rt,at,He,nt,Ue){const Ge=[],ht=[],dt=Ue[8]*at,Yt=Ue[9]*at,Ot=Ue[10]*at,bt=Ue[11]*at,ct=Ue[8]*He,di=Ue[9]*He,Lt=Ue[10]*He,Ft=Ue[11]*He;for(const oi of rt){const wi=[],bi=[];for(const Ri of oi){const Ai=Ri.x+nt.x,Li=Ri.y+nt.y,ln=Ue[0]*Ai+Ue[4]*Li+Ue[12],Mn=Ue[1]*Ai+Ue[5]*Li+Ue[13],ne=Ue[2]*Ai+Ue[6]*Li+Ue[14],ae=Ue[3]*Ai+Ue[7]*Li+Ue[15],We=ln+dt,pt=Mn+Yt,wt=ne+Ot,vt=Math.max(ae+bt,1e-5),Dt=ln+ct,si=Mn+di,ki=ne+Lt,Fi=Math.max(ae+Ft,1e-5);wi.push(new Jh(We/vt,pt/vt,wt/vt)),bi.push(new Jh(Dt/Fi,si/Fi,ki/Fi))}Ge.push(wi),ht.push(bi)}return[Ge,ht]}(Y,te,oe,ve,ge)}(f,l,C,I,T,p,$,M,O,f.center.lat,r.tileID.canonical),ee=r.queryGeometry;return function(U,Y,te){let oe=1/0;ho(te,Y)&&(oe=CT(te,Y[0]));for(let ve=0;ve<Y.length;ve++){const ge=Y[ve],be=U[ve];for(let Me=0;Me<ge.length-1;Me++){const $e=ge[Me],ot=[$e,ge[Me+1],be[Me+1],be[Me],$e];xr(te,ot)&&(oe=Math.min(oe,CT(te,ot)))}}return oe!==1/0&&oe}(W,Q,ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},building:class extends nr{constructor(r,e,i,l){super(r,{layout:UT||(UT=new Kn({visibility:new lt(Re.layout_building.visibility),"building-roof-shape":new St(Re.layout_building["building-roof-shape"]),"building-height":new St(Re.layout_building["building-height"]),"building-base":new St(Re.layout_building["building-base"])})),paint:jT||(jT=new Kn({"building-opacity":new lt(Re.paint_building["building-opacity"]),"building-ambient-occlusion-wall-intensity":new lt(Re.paint_building["building-ambient-occlusion-wall-intensity"]),"building-ambient-occlusion-ground-intensity":new lt(Re.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new lt(Re.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new lt(Re.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new lt(Re.paint_building["building-vertical-scale"]),"building-cast-shadows":new lt(Re.paint_building["building-cast-shadows"]),"building-color":new St(Re.paint_building["building-color"]),"building-emissive-strength":new St(Re.paint_building["building-emissive-strength"]),"building-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new VT(r)}},line:class extends nr{constructor(r,e,i,l){const h=JT();super(r,h,e,i,l),h.layout&&(this.layout=new gl(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof wh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(lm)return lm;const i=JT();return lm=new lR(i.paint.properties["line-width"].specification),lm.useIntegerZoom=!0,lm})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new c0(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const l=YT(this);return{config:new vc(this,{zoom:e,lut:i}),defines:l,overrideFog:!1}}queryRadius(r){const e=r,i=QT(Ld("line-width",this,e),Ld("line-gap-width",this,e)),l=Ld("line-offset",this,e);return i/2+Math.abs(l)+Pg(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,l,h,f){if(r.queryGeometry.isAboveHorizon)return!1;const p=fw(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,r.pixelToTileUnitsFactor),x=r.pixelToTileUnitsFactor/2*QT(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),w=this.paint.get("line-offset").evaluate(e,i);return w&&(l=function(T,I){const C=[],M=new _t(0,0);for(let L=0;L<T.length;L++){const O=T[L],V=[];for(let $=0;$<O.length;$++){const W=O[$],Q=O[$+1],ee=$===0?M:W.sub(O[$-1])._unit()._perp(),U=$===O.length-1?M:Q.sub(W)._unit()._perp(),Y=ee._add(U)._unit();Y._mult(1/(Y.x*U.x+Y.y*U.y)),V.push(Y._mult(I)._add(W))}C.push(V)}return C}(l,w*r.pixelToTileUnitsFactor)),function(T,I,C){for(let M=0;M<I.length;M++){const L=I[M];if(T.length>=3){for(let O=0;O<L.length;O++)if(Mo(T,L[O]))return!0}if(Ra(T,L,C))return!0}return!1}(p,l,x)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:hy,background:class extends nr{constructor(r,e,i,l){super(r,{layout:$S||($S=new Kn({visibility:new lt(Re.layout_background.visibility)})),paint:GS||(GS=new Kn({"background-pitch-alignment":new lt(Re.paint_background["background-pitch-alignment"]),"background-color":new lt(Re.paint_background["background-color"]),"background-pattern":new lt(Re.paint_background["background-pattern"]),"background-opacity":new lt(Re.paint_background["background-opacity"]),"background-emissive-strength":new lt(Re.paint_background["background-emissive-strength"]),"background-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:XS,"raster-particle":tE,sky:class extends nr{constructor(r,e,i,l){super(r,{layout:JS||(JS=new Kn({visibility:new lt(Re.layout_sky.visibility)})),paint:QS||(QS=new Kn({"sky-type":new lt(Re.paint_sky["sky-type"]),"sky-atmosphere-sun":new lt(Re.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new lt(Re.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new lt(Re.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new lt(Re.paint_sky["sky-gradient-radius"]),"sky-gradient":new yl(Re.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new lt(Re.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new lt(Re.paint_sky["sky-atmosphere-color"]),"sky-opacity":new lt(Re.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Zp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const l=this.paint.get("sky-atmosphere-sun"),h=!l,f=r.style.light,p=f.properties.get("position");return h&&f.properties.get("anchor")==="viewport"&&Si("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?R0(p.azimuthal,90-p.polar,e):R0(l[0],90-l[1],e)}const i=this.paint.get("sky-gradient-center");return R0(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends nr{constructor(r,e,i,l){super(r,{paint:eE||(eE=new Kn({}))},e,null)}},model:class extends nr{constructor(r,e,i,l){super(r,{layout:hE||(hE=new Kn({visibility:new lt(Re.layout_model.visibility),"model-id":new St(Re.layout_model["model-id"])})),paint:uE||(uE=new Kn({"model-opacity":new St(Re.paint_model["model-opacity"]),"model-rotation":new St(Re.paint_model["model-rotation"]),"model-scale":new St(Re.paint_model["model-scale"]),"model-translation":new St(Re.paint_model["model-translation"]),"model-color":new St(Re.paint_model["model-color"]),"model-color-mix-intensity":new St(Re.paint_model["model-color-mix-intensity"]),"model-type":new lt(Re.paint_model["model-type"]),"model-cast-shadows":new lt(Re.paint_model["model-cast-shadows"]),"model-receive-shadows":new lt(Re.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new lt(Re.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new St(Re.paint_model["model-emissive-strength"]),"model-roughness":new St(Re.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new St(Re.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new lt(Re.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new lt(Re.paint_model["model-front-cutoff"]),"model-color-use-theme":new St({type:"string",default:"default","property-type":"data-driven"})}))},e,i,l),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new k0(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof yy?yt-1:0}queryIntersectsFeature(r,e,i,l,h,f){if(!this.modelManager)return!1;const p=this.modelManager,x=r.tile.getBucket(this);if(!(x&&x instanceof k0))return!1;for(const w in x.instancesPerModel){const T=x.instancesPerModel[w],I=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(I)){const C=T.features[T.idToFeaturesIndex[I]],M=p.getModel(w,this.scope);if(!M)return!1;let L=we();const O=new K(0,0),V=x.canonical;let $=Number.MAX_VALUE;for(let W=0;W<C.instancedDataCount;++W){const Q=16*(C.instancedDataOffset+W),ee=T.instancedDataArray.float32,U=[ee[Q+4],ee[Q+5],ee[Q+6]];gE(V,O,ee[Q],0|ee[Q+1]),dE(L,M,f,O,C.rotation,C.scale,U,!1,!1,!1),f.projection.name==="globe"&&(L=z0(L,f));const Y=Ie([],f.projMatrix,L),te=r.queryGeometry,oe=oE(te.isPointQuery()?te.screenBounds:te.screenGeometry,f,Y,M.aabb);oe!=null&&($=Math.min(oe,$))}return $!==Number.MAX_VALUE&&$}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ph}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends nr{constructor(r,e,i,l){super(r,{layout:Jw||(Jw=new Kn({"clip-layer-types":new lt(Re.layout_clip["clip-layer-types"]),"clip-layer-scope":new lt(Re.layout_clip["clip-layer-scope"])})),paint:Qw||(Qw=new Kn({}))},e,i,l)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new eT(r)}is3D(r){return!0}}},V0=new rn(0,0,0),U0={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},j0={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},xy={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},dL={PAINT_ORDER_FILL_AND_STROKE:1},bm={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},yE={MASK_TYPE_LUMINANCE:1};function fL(r,e,i){r===1&&e.icons.push(function(l,h){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:p}=f;if(p.content_area){const{content_area:x}=p;x.top==null&&(x.top=x.left),x.width==null&&(x.width=f.usvg_tree.width),x.height==null&&(x.height=x.width)}return p.stretch_x&&p.stretch_x.length&&xE(p,"x"),p.stretch_y&&p.stretch_y.length&&xE(p,"y"),f}(l.readFields(pL,{name:void 0},h))}(i,i.readVarint()+i.pos))}function xE(r,e){const i=[],l=r[`stretch_${e}`];let h=null;for(let f=0;f<l.length;f++)h===null?h=i.length===0?l[0]:i[i.length-1][1]+l[f]:(i.push([h,h+l[f]]),h=null);r[`stretch_${e}_areas`]=i}function pL(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(l,h){return l.readFields(mL,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(l,h){return l.readFields(yL,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function mL(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=function(l,h){return l.readFields(_L,{left:0},h)}(i,i.readVarint()+i.pos):r===4&&e.variables.push(function(l,h){return l.readFields(gL,{name:void 0},h)}(i,i.readVarint()+i.pos))}function _L(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function gL(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=wy(i.readVarint()),e.value="rgb_color")}function yL(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(vy(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(l,h){return l.readFields(EL,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(l,h){return l.readFields(IL,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(l,h){return l.readFields(CL,{children:[]},h)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(l,h){const f=l.readFields(ML,{left:0,width:20,mask_type:yE.MASK_TYPE_LUMINANCE,children:[]},h);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(i,i.readVarint()+i.pos))}function vy(r,e){return r.readFields(xL,{},e)}function xL(r,e,i){r===1?(e.group=function(l,h){return l.readFields(vL,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(l,h){return l.readFields(wL,{paint_order:1,commands:[],step:1,diffs:[],rule:U0.PATH_RULE_NON_ZERO},h)}(i,i.readVarint()+i.pos),e.node="path")}function vL(r,e,i){r===1?e.transform=by(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(vy(i,i.readVarint()+i.pos))}function by(r,e){return r.readFields(bL,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function bL(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function wL(r,e,i){r===1?e.fill=function(l,h){return l.readFields(TL,{rgb_color:V0,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(l,h){return l.readFields(SL,{rgb_color:V0,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function TL(r,e,i){r===1?(e.rgb_color=wy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function wy(r){return new rn((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function SL(r,e,i){r===1?(e.rgb_color=wy(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function EL(r,e,i){r===1?e.transform=by(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(vE(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function vE(r,e){return r.readFields(AL,{offset:0,opacity:255,rgb_color:V0},e)}function AL(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=wy(i.readVarint()))}function IL(r,e,i){r===1?e.transform=by(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(vE(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function CL(r,e,i){r===1?e.transform=by(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(vy(i,i.readVarint()+i.pos))}function ML(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(vy(i,i.readVarint()+i.pos))}class PL{static calculate(e={},i=[]){const l=new Map,h=new Map;if(Object.keys(e).length===0)return l;i.forEach(f=>{h.set(f.name,f.rgb_color||new rn(0,0,0))});for(const[f,p]of Object.entries(e))h.has(f)?l.set(h.get(f).toString(),p):console.warn(`Ignoring unknown image variable "${f}"`);return l}}function Wd(r,e=255,i){const l=e/255,h=r.toString(),f=i.has(h)?i.get(h).clone():r.clone();return f.a*=l,f.toString()}function wm(r,e){if(!Ou()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}function DL(r,e){const i=PL.calculate(e.params,r.metadata?r.metadata.variables:[]),l=r.usvg_tree,h=l.width,f=l.height,p=e.transform?e.transform:new DOMMatrix,x=Math.max(1,Math.round(h*p.a)),w=Math.max(1,Math.round(f*p.d)),T=new DOMMatrix([x/h,0,0,w/f,0,0]),I=wm(x,w).getContext("2d");return $0(I,T,l,l,i),I.getImageData(0,0,x,w)}function $0(r,e,i,l,h){for(const f of l.children)bE(r,e,i,f,h)}function bE(r,e,i,l,h){l.group?(r.save(),function(f,p,x,w,T){const I=w.mask_idx!=null?x.masks[w.mask_idx]:null,C=w.clip_path_idx!=null?x.clip_paths[w.clip_path_idx]:null;if(w.transform&&(p=qd(w.transform).preMultiplySelf(p)),!function(O,V,$){return O.opacity!==255||V||$}(w,C!=null,I!=null))return void $0(f,p,x,w,T);const M=wm(f.canvas.width,f.canvas.height),L=M.getContext("2d");$0(L,p,x,w,T),C&&CE(L,p,x,C),I&&ME(L,p,x,I,T),f.globalAlpha=w.opacity/255,f.drawImage(M,0,0)}(r,e,i,l.group,h),r.restore()):l.path&&(r.save(),function(f,p,x,w,T){f.setTransform(p),w.paint_order===dL.PAINT_ORDER_FILL_AND_STROKE?(wE(f,x,w,T),SE(f,x,w,T)):(SE(f,x,w,T),wE(f,x,w,T))}(r,e,i,l.path,h),r.restore())}function wE(r,e,i,l){const h=i.fill;if(!h)return;const f=h.opacity/255;switch(r.save(),r.beginPath(),PE(i,r),h.paint){case"rgb_color":r.fillStyle=Wd(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":{const p=e.linear_gradients[h.linear_gradient_idx];p.transform&&r.setTransform(qd(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=EE(r,p,f,l);break}case"radial_gradient_idx":{const p=e.radial_gradients[h.radial_gradient_idx];p.transform&&r.setTransform(qd(p.transform).preMultiplySelf(r.getTransform())),r.fillStyle=AE(r,p,f,l)}}r.fill(TE(i)),r.restore()}function TE(r){return r.rule===U0.PATH_RULE_NON_ZERO?"nonzero":r.rule===U0.PATH_RULE_EVEN_ODD?"evenodd":void 0}function SE(r,e,i,l){const h=i.stroke;if(!h)return;const f=DE(i);r.lineWidth=h.width,r.miterLimit=h.miterlimit,r.setLineDash(h.dasharray),r.lineDashOffset=h.dashoffset;const p=h.opacity/255;switch(h.paint){case"rgb_color":r.strokeStyle=Wd(h.rgb_color,h.opacity,l);break;case"linear_gradient_idx":r.strokeStyle=EE(r,e.linear_gradients[h.linear_gradient_idx],p,l,!0);break;case"radial_gradient_idx":r.strokeStyle=AE(r,e.radial_gradients[h.radial_gradient_idx],p,l,!0)}switch(h.linejoin){case xy.LINE_JOIN_MITER_CLIP:case xy.LINE_JOIN_MITER:r.lineJoin="miter";break;case xy.LINE_JOIN_ROUND:r.lineJoin="round";break;case xy.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(h.linecap){case j0.LINE_CAP_BUTT:r.lineCap="butt";break;case j0.LINE_CAP_ROUND:r.lineCap="round";break;case j0.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(f)}function EE(r,e,i,l,h=!1){if(e.stops.length===1){const M=e.stops[0];return Wd(M.rgb_color,M.opacity*i,l)}const{x1:f,y1:p,x2:x,y2:w}=e;let T=new DOMPoint(f,p),I=new DOMPoint(x,w);if(h){const M=qd(e.transform);T=M.transformPoint(T),I=M.transformPoint(I)}const C=r.createLinearGradient(T.x,T.y,I.x,I.y);for(const M of e.stops)C.addColorStop(M.offset,Wd(M.rgb_color,M.opacity*i,l));return C}function AE(r,e,i,l,h=!1){if(e.stops.length===1){const W=e.stops[0];return Wd(W.rgb_color,W.opacity*i,l)}const f=qd(e.transform),{fx:p,fy:x,fr:w,cx:T,cy:I,r:C}=e;let M=new DOMPoint(p,x),L=new DOMPoint(T,I),O=w,V=C;if(h){M=f.transformPoint(M),L=f.transformPoint(L);const W=(f.a+f.d)/2;O=w*W,V=e.r*W}const $=r.createRadialGradient(M.x,M.y,O,L.x,L.y,V);for(const W of e.stops)$.addColorStop(W.offset,Wd(W.rgb_color,W.opacity*i,l));return $}function IE(r,e,i,l){const h=l.transform?qd(l.transform).preMultiplySelf(e):e,f=wm(r.canvas.width,r.canvas.height),p=f.getContext("2d");for(const w of l.children)if(w.group)IE(p,h,i,w.group);else if(w.path){const T=w.path,I=new Path2D;I.addPath(DE(T),h),p.fill(I,TE(T))}const x=l.clip_path_idx!=null?i.clip_paths[l.clip_path_idx]:null;x&&CE(p,h,i,x),r.globalCompositeOperation="source-over",r.drawImage(f,0,0)}function CE(r,e,i,l){const h=wm(r.canvas.width,r.canvas.height);IE(h.getContext("2d"),e,i,l),r.globalCompositeOperation="destination-in",r.drawImage(h,0,0)}function ME(r,e,i,l,h){if(l.children.length===0)return;const f=l.mask_idx!=null?i.masks[l.mask_idx]:null;f&&ME(r,e,i,f,h);const p=r.canvas.width,x=r.canvas.height,w=wm(p,x),T=w.getContext("2d"),I=l.width,C=l.height,M=l.left,L=l.top,O=new Path2D,V=new Path2D;V.rect(M,L,I,C),O.addPath(V,e),T.clip(O);for(const Q of l.children)bE(T,e,i,Q,h);const $=T.getImageData(0,0,p,x),W=$.data;if(l.mask_type===yE.MASK_TYPE_LUMINANCE)for(let Q=0;Q<W.length;Q+=4)W[Q+3]=W[Q+3]/255*(.2126*W[Q]+.7152*W[Q+1]+.0722*W[Q+2]);T.putImageData($,0,0),r.globalCompositeOperation="destination-in",r.drawImage(w,0,0)}function qd(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function PE(r,e){const i=r.step;let l=r.diffs[0]*i,h=r.diffs[1]*i;e.moveTo(l,h);for(let f=0,p=2;f<r.commands.length;f++)switch(r.commands[f]){case bm.PATH_COMMAND_MOVE:l+=r.diffs[p++]*i,h+=r.diffs[p++]*i,e.moveTo(l,h);break;case bm.PATH_COMMAND_LINE:l+=r.diffs[p++]*i,h+=r.diffs[p++]*i,e.lineTo(l,h);break;case bm.PATH_COMMAND_QUAD:{const x=l+r.diffs[p++]*i,w=h+r.diffs[p++]*i;l=x+r.diffs[p++]*i,h=w+r.diffs[p++]*i,e.quadraticCurveTo(x,w,l,h);break}case bm.PATH_COMMAND_CUBIC:{const x=l+r.diffs[p++]*i,w=h+r.diffs[p++]*i,T=x+r.diffs[p++]*i,I=w+r.diffs[p++]*i;l=T+r.diffs[p++]*i,h=I+r.diffs[p++]*i,e.bezierCurveTo(x,w,T,I,l,h);break}case bm.PATH_COMMAND_CLOSE:e.closePath()}return e}function DE(r){return PE(r,new Path2D)}class Ty{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ct(Ty,"LRUCache");class G0{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new Zs(e,e.data)}getFromCache(e,i,l){return this.cacheMap.has(l)||this.cacheMap.set(l,new Ty(150)),this.cacheMap.get(l).get(xl(e.toString(),i))}setInCache(e,i,l,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new Ty(150));const f=this.cacheDependenciesMap.get(h),p=xl(e.id.toString(),l);f.get(p)||f.set(p,new Set);const x=this.cacheMap.get(h),w=e.toString();f.get(p).add(w),x.put(xl(e.toString(),l),i)}removeImagesFromCacheByIds(e,i,l=0){if(!this.cacheMap.has(l)||!this.cacheDependenciesMap.has(l))return;const h=this.cacheMap.get(l),f=this.cacheDependenciesMap.get(l);for(const p of e){const x=xl(p.toString(),i);if(f.has(x)){for(const w of f.get(x))h.delete(w);f.delete(x)}}}rasterize(e,i,l,h,f=DL){const p=this.getFromCache(e,l,h);if(p)return p.clone();const x=f(i.icon,e.options),w=G0._getImage(x);return this.setInCache(e,w,l,h),w.clone()}}class RE{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const l=this.toIdx(e,i);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function LE(r,e,i,l){let h=0,f=Number.MAX_VALUE;for(let p=0;p<3;p++)if(Math.abs(l[p])<1e-15){if(i[p]<r[p]||i[p]>e[p])return null}else{const x=1/l[p];let w=(r[p]-i[p])*x,T=(e[p]-i[p])*x;if(w>T){const I=w;w=T,T=I}if(w>h&&(h=w),T<f&&(f=T),h>f)return null}return h}function zE(r,e,i,l,h,f,p,x,w,T,I){const C=l-r,M=h-e,L=f-i,O=p-r,V=x-e,$=w-i,W=I[1]*$-I[2]*V,Q=I[2]*O-I[0]*$,ee=I[0]*V-I[1]*O,U=C*W+M*Q+L*ee;if(Math.abs(U)<1e-15)return null;const Y=1/U,te=T[0]-r,oe=T[1]-e,ve=T[2]-i,ge=(te*W+oe*Q+ve*ee)*Y;if(ge<0||ge>1)return null;const be=oe*L-ve*M,Me=ve*C-te*L,$e=te*M-oe*C,ot=(I[0]*be+I[1]*Me+I[2]*$e)*Y;return ot<0||ge+ot>1?null:(O*be+V*Me+$*$e)*Y}function OE(r,e,i){return(r-e)/(i-e)}function kE(r,e,i,l,h,f,p,x,w){const T=1<<i,I=f-l,C=p-h,M=(r+1)/T*I+l,L=(e+0)/T*C+h,O=(e+1)/T*C+h;x[0]=(r+0)/T*I+l,x[1]=L,w[0]=M,w[1]=O}class FE{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const p=Math.ceil(Math.log2(f.dim/8)),x=[];let w=Math.ceil(Math.pow(2,p));const T=1/w,I=(L,O,V,$,W)=>{const Q=$?1:0,ee=(L+1)*V-Q,U=O*V,Y=(O+1)*V-Q;W[0]=L*V,W[1]=U,W[2]=ee,W[3]=Y};let C=new RE(w);const M=[];for(let L=0;L<w*w;L++){I(L%w,Math.floor(L/w),T,!1,M);const O=Mc(M[0],M[1],f),V=Mc(M[2],M[1],f),$=Mc(M[2],M[3],f),W=Mc(M[0],M[3],f);C.minimums.push(Math.min(O,V,$,W)),C.maximums.push(Math.max(O,V,$,W)),C.leaves.push(1)}for(x.push(C),w/=2;w>=1;w/=2){const L=x[x.length-1];C=new RE(w);for(let O=0;O<w*w;O++){I(O%w,Math.floor(O/w),2,!0,M);const V=L.getElevation(M[0],M[1]),$=L.getElevation(M[2],M[1]),W=L.getElevation(M[2],M[3]),Q=L.getElevation(M[0],M[3]),ee=L.isLeaf(M[0],M[1]),U=L.isLeaf(M[2],M[1]),Y=L.isLeaf(M[2],M[3]),te=L.isLeaf(M[0],M[3]),oe=Math.min(V.min,$.min,W.min,Q.min),ve=Math.max(V.max,$.max,W.max,Q.max),ge=ee&&U&&Y&&te;C.maximums.push(ve),C.minimums.push(oe),C.leaves.push(ve-oe<=5&&ge?1:0)}x.push(C)}return x}(this.dem),l=i.length-1,h=i[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,l,0)}raycastRoot(e,i,l,h,f,p,x=1){return LE([e,i,-100],[l,h,this.maximums[0]*x],f,p)}raycast(e,i,l,h,f,p,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(e,i,l,h,f,p,x);if(w==null)return null;const T=[],I=[],C=[],M=[],L=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;L.length>0;){const{idx:O,t:V,nodex:$,nodey:W,depth:Q}=L.pop();if(this.leaves[O]){kE($,W,Q,e,i,l,h,C,M);const U=1<<Q,Y=($+0)/U,te=($+1)/U,oe=(W+0)/U,ve=(W+1)/U,ge=Mc(Y,oe,this.dem)*x,be=Mc(te,oe,this.dem)*x,Me=Mc(te,ve,this.dem)*x,$e=Mc(Y,ve,this.dem)*x,ot=zE(C[0],C[1],ge,M[0],C[1],be,M[0],M[1],Me,f,p),Qe=zE(M[0],M[1],Me,C[0],M[1],$e,C[0],C[1],ge,f,p),rt=Math.min(ot!==null?ot:Number.MAX_VALUE,Qe!==null?Qe:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const at=ss([],f,p,V);if(BE(ge,be,$e,Me,OE(at[0],C[0],M[0]),OE(at[1],C[1],M[1]))>=at[2])return V}continue}let ee=0;for(let U=0;U<this._siblingOffset.length;U++){kE(($<<1)+this._siblingOffset[U][0],(W<<1)+this._siblingOffset[U][1],Q+1,e,i,l,h,C,M),C[2]=-100,M[2]=this.maximums[this.childOffsets[O]+U]*x;const Y=LE(C,M,f,p);if(Y!=null){const te=Y;T[U]=te;let oe=!1;for(let ve=0;ve<ee&&!oe;ve++)te>=T[I[ve]]&&(I.splice(ve,0,U),oe=!0);oe||(I[ee]=U),ee++}}for(let U=0;U<ee;U++){const Y=I[U];L.push({idx:this.childOffsets[O]+Y,t:T[Y],nodex:($<<1)+this._siblingOffset[Y][0],nodey:(W<<1)+this._siblingOffset[Y][1],depth:Q+1})}}return null}_addNode(e,i,l){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,l,h,f){if(e[h].isLeaf(i,l)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const p=h-1,x=e[p];let w=0,T=0;for(let I=0;I<this._siblingOffset.length;I++){const C=2*i+this._siblingOffset[I][0],M=2*l+this._siblingOffset[I][1],L=x.getElevation(C,M),O=x.isLeaf(C,M),V=this._addNode(L.min,L.max,O);O&&(w|=1<<I),T||(T=V)}for(let I=0;I<this._siblingOffset.length;I++)w&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*l+this._siblingOffset[I][1],p,T+I)}}function BE(r,e,i,l,h,f){return ri(ri(r,i,f),ri(e,l,f),h)}function Mc(r,e,i){const l=i.dim,h=de(r*l-.5,0,l-1),f=de(e*l-.5,0,l-1),p=Math.floor(h),x=Math.floor(f),w=Math.min(p+1,l-1),T=Math.min(x+1,l-1);return BE(i.get(p,x),i.get(w,x),i.get(p,T),i.get(w,T),h-p,f-x)}const RL={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function LL(r,e,i){return(256*r*256+256*e+i)/10-1e4}function zL(r,e,i){return 256*r+e+i/256-32768}class Sy{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,l,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(l&&l!=="mapbox"&&l!=="terrarium")return void Si(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,p=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let w=0;w<f;w++)p[this._idx(-1,w)]=p[this._idx(0,w)],p[this._idx(f,w)]=p[this._idx(f-1,w)],p[this._idx(w,-1)]=p[this._idx(w,0)],p[this._idx(w,f)]=p[this._idx(w,f-1)];p[this._idx(-1,-1)]=p[this._idx(0,0)],p[this._idx(f,-1)]=p[this._idx(f-1,0)],p[this._idx(-1,f)]=p[this._idx(0,f-1)],p[this._idx(f,f)]=p[this._idx(f-1,f-1)]}const x=l==="terrarium"?zL:LL;for(let w=0;w<p.length;++w){const T=4*w;this.floatView[w]=x(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=no.now()}_buildQuadTree(){this._tree=new FE(this)}get(e,i,l=!1){l&&(e=de(e,-1,this.dim),i=de(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,l){const h=this._idx(e,i),f=this.floatView[h];return this.floatView[h]=l,l-f}static getUnpackVector(e){return RL[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const l=[0,0,0,0],h=Sy.getUnpackVector(i);let f=Math.floor((e+h[3])/h[2]);return l[2]=f%256,f=Math.floor(f/256),l[1]=f%256,f=Math.floor(f/256),l[0]=f,l}getPixels(){return new Bw({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,l){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,f=i*this.dim+this.dim,p=l*this.dim,x=l*this.dim+this.dim;switch(i){case-1:h=f-1;break;case 1:f=h+1}switch(l){case-1:p=x-1;break;case 1:x=p+1}const w=-i*this.dim,T=-l*this.dim;for(let I=p;I<x;I++)for(let C=h;C<f;C++){const M=4*this._idx(C,I),L=4*this._idx(C+w,I+T);this.pixels[M+0]=e.pixels[L+0],this.pixels[M+1]=e.pixels[L+1],this.pixels[M+2]=e.pixels[L+2],this.pixels[M+3]=e.pixels[L+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function OL(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(l,h){return l.readFields(VL,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function kL(r,e,i){r===1?(e.delta_filter=function(l,h){return l.readFields(FL,{blockSize:0},h)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function FL(r,e,i){r===1&&(e.blockSize=i.readVarint())}function BL(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function NL(r,e,i){let l=0,h=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(f,p){return f.readFields(kL,{},p)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(f,p){return f.readFields(BL,{},p)}(i,i.readVarint()+i.pos):r===5?h=i.readFloat():r===6?l=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=h),e.scale===0&&(e.scale=l)}function VL(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(l,h){return l.readFields(NL,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function UL(r,e,i){if(r===2)(function(l,h,f){l.readFields(jL,f,h)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function jL(r,e,i){if(r===1){let l=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)e[l++]=i.readVarint()}}function $L(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let l=2;l>=1;l--){const h=l===1?1:0,f=l===2?1:0;for(let p=0;p<e[0];p++){const x=e[1]*p;for(let w=h;w<e[1];w++){const T=e[2]*(w+x);for(let I=f;I<e[2];I++){const C=e[3]*(I+T);for(let M=0;M<e[3];M++){const L=C+M;r[L]+=r[L-i]}}}}i*=e[l]}return r}function GL(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function HL(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const l=r[i],h=r[i+1];r[i]=(240&l)>>4|(61440&l)>>8|(240&h)<<4|61440&h,r[i+1]=15&l|(3840&l)>>4|(15&h)<<8|(3840&h)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const l=r[i],h=r[i+1],f=r[i+2],p=r[i+3];r[i+0]=(192&l)>>6|(192&h)>>4|(192&f)>>2|192&p,r[i+1]=(48&l)>>4|(48&h)>>2|48&f|(48&p)<<2,r[i+2]=(12&l)>>2|12&h|(12&f)<<2|(12&p)<<4,r[i+3]=3&l|(3&h)<<2|(3&f)<<4|(3&p)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ct(Sy,"DEMData"),Ct(FE,"DemMinMaxQuadTree",{omit:["dem"]});var uo=Uint8Array,Tm=Uint16Array,WL=Int32Array,NE=new uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),VE=new uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),qL=new uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),UE=function(r,e){for(var i=new Tm(31),l=0;l<31;++l)i[l]=e+=1<<r[l-1];var h=new WL(i[30]);for(l=1;l<30;++l)for(var f=i[l];f<i[l+1];++f)h[f]=f-i[l]<<5|l;return{b:i,r:h}},jE=UE(NE,2),$E=jE.b,ZL=jE.r;$E[28]=258,ZL[258]=28;for(var XL=UE(VE,0).b,GE=new Tm(32768),Cs=0;Cs<32768;++Cs){var Zd=(43690&Cs)>>1|(21845&Cs)<<1;GE[Cs]=((65280&(Zd=(61680&(Zd=(52428&Zd)>>2|(13107&Zd)<<2))>>4|(3855&Zd)<<4))>>8|(255&Zd)<<8)>>1}var Sm=function(r,e,i){for(var l=r.length,h=0,f=new Tm(e);h<l;++h)r[h]&&++f[r[h]-1];var p,x=new Tm(e);for(h=1;h<e;++h)x[h]=x[h-1]+f[h-1]<<1;p=new Tm(1<<e);var w=15-e;for(h=0;h<l;++h)if(r[h])for(var T=h<<4|r[h],I=e-r[h],C=x[r[h]-1]++<<I,M=C|(1<<I)-1;C<=M;++C)p[GE[C]>>w]=T;return p},Em=new uo(288);for(Cs=0;Cs<144;++Cs)Em[Cs]=8;for(Cs=144;Cs<256;++Cs)Em[Cs]=9;for(Cs=256;Cs<280;++Cs)Em[Cs]=7;for(Cs=280;Cs<288;++Cs)Em[Cs]=8;var HE=new uo(32);for(Cs=0;Cs<32;++Cs)HE[Cs]=5;var YL=Sm(Em,9),KL=Sm(HE,5),H0=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},ra=function(r,e,i){var l=e/8|0;return(r[l]|r[l+1]<<8)>>(7&e)&i},W0=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},JL=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],oa=function(r,e,i){var l=new Error(e||JL[r]);if(l.code=r,Error.captureStackTrace&&Error.captureStackTrace(l,oa),!i)throw l;return l},QL=new uo(0),ez=typeof TextDecoder<"u"&&new TextDecoder;try{ez.decode(QL,{stream:!0})}catch{}const tz={gzip_data:"gzip"};class Po extends Error{constructor(e){super(e),this.name="MRTError"}}const iz={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},WE={uint32:1,uint16:2,uint8:4},nz={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let q0;class Ey{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Po(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),l=new DataView(e);if(i[0]!==13)throw new Po("File is not a valid MRT.");return l.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),l=this.getHeaderLength(e);if(i.length<l)throw new Po(`Expected header with length >= ${l} but got buffer of length ${i.length}`);const h=function(f,p){return f.readFields(OL,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0)}(new q0(i.subarray(0,l)));if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new Po(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const f of h.layers)this.layers[f.name]=new qE(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],l=this.getLayer(e.layerName);for(let h of e.blockIndices){const f=l.dataIndex[h],p=f.firstByte-e.firstByte,x=f.lastByte-e.firstByte;if(l._blocksInProgress.has(h))continue;const w={layerName:l.name,firstByte:p,lastByte:x,pixelFormat:l.pixelFormat,blockIndex:h,blockShape:[f.bands.length].concat(l.bandShape),buffer:l.buffer,codec:f.codec.codec,filters:f.filters.map(T=>T.filter)};l._blocksInProgress.add(h),i.push(w)}return new ZE(i,()=>{i.forEach(h=>l._blocksInProgress.delete(h.blockIndex))},(h,f)=>{if(i.forEach(p=>l._blocksInProgress.delete(p.blockIndex)),h)throw h;f.forEach(p=>{this.getLayer(p.layerName).processDecodedData(p)})})}}class qE{constructor({version:e,name:i,units:l,tileSize:h,pixelFormat:f,buffer:p,dataIndex:x},w){if(this.version=e,this.version!==1)throw new Po(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=l,this.tileSize=h,this.buffer=p,this.pixelFormat=iz[f],this.dataIndex=x,this.bandShape=[h+2*p,h+2*p,WE[this.pixelFormat]],this._decodedBlocks=new Ty(w?w.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return WE[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[l,h]of this.dataIndex.entries()){for(const[f,p]of h.bands.entries())if(p===e)return{bandIndex:i+f,blockIndex:l,blockBandIndex:f};i+=h.bands.length}break;case"number":for(const[l,h]of this.dataIndex.entries()){if(e>=i&&e<i+h.bands.length)return{bandIndex:e,blockIndex:l,blockBandIndex:e-i};i+=h.bands.length}break;default:throw new Po(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,l=-1/0;const h=[],f=new Set;for(const p of e){const{blockIndex:x}=this.getBlockForBand(p);if(x<0)throw new Po(`Invalid band: ${JSON.stringify(p)}`);const w=this.dataIndex[x];h.includes(x)||h.push(x),f.add(x),i=Math.min(i,w.firstByte),l=Math.max(l,w.lastByte)}if(f.size>this.cacheSize)throw new Po(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:l,blockIndices:h}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:l}=this.getBlockForBand(e);if(i<0)throw new Po(`Band not found: ${JSON.stringify(e)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new Po(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],p=this.bandShape.reduce((T,I)=>T*I,1),x=l*p,w=h.subarray(x,x+p);return{data:w,bytes:new Uint8Array(w.buffer).subarray(w.byteOffset,w.byteOffset+w.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}Ey.setPbf=function(r){q0=r};class ZE{constructor(e,i,l){this.tasks=e,this._onCancel=i,this._onComplete=l,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}function su(r,e){const i=r.json.bufferViews[e.bufferView],l=Wg[e.componentType];return new l(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==am[e.type]*l.BYTES_PER_ELEMENT?i.byteStride/l.BYTES_PER_ELEMENT:am[e.type]))}function Z0(r,e,i,l){const h=Wg[e.componentType],f=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),p=r.json.bufferViews[e.bufferView],x=p.byteStride?p.byteStride/h.BYTES_PER_ELEMENT:am[e.type],w=i.float32,T=w.length/i.capacity;for(let I=0,C=0;I<e.count*x;I+=x,C+=T)for(let M=0;M<T;M++)w[C+M]=l[I+M]*f;i._trim()}function sz(r,e,i){const l=r.indices,h=r.attributes,f={};f.indexArray=new Gs;const p=e.json.accessors[l],x=p.count/3;f.indexArray.reserve(x);const w=su(e,p);for(let M=0;M<x;M++)f.indexArray.emplaceBack(w[3*M],w[3*M+1],w[3*M+2]);f.indexArray._trim(),f.vertexArray=new Ao;const T=e.json.accessors[h.POSITION];f.vertexArray.reserve(T.count);const I=su(e,T);for(let M=0;M<T.count;M++)f.vertexArray.emplaceBack(I[3*M],I[3*M+1],I[3*M+2]);if(f.vertexArray._trim(),f.aabb=new Ki(T.min,T.max),f.centroid=function(M,L){const O=[0,0,0],V=M.length;if(V>0){for(let $=0;$<V;$++){const W=3*M[$];O[0]+=L[W],O[1]+=L[W+1],O[2]+=L[W+2]}O[0]/=V,O[1]/=V,O[2]/=V}return O}(w,I),h.COLOR_0!==void 0){const M=e.json.accessors[h.COLOR_0],L=am[M.type],O=su(e,M);f.colorArray=L===3?new Ao:new $s,f.colorArray.resize(M.count),Z0(e,M,f.colorArray,O)}if(h.NORMAL!==void 0){f.normalArray=new Ao;const M=e.json.accessors[h.NORMAL];f.normalArray.resize(M.count);const L=su(e,M);Z0(e,M,f.normalArray,L)}if(h.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new vl;const M=e.json.accessors[h.TEXCOORD_0];f.texcoordArray.resize(M.count);const L=su(e,M);Z0(e,M,f.texcoordArray,L)}if(h._FEATURE_ID_RGBA4444!==void 0){const M=e.json.accessors[h._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=su(e,M))}h._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(su(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer));const C=r.material;return f.material=function(M,L){const{emissiveFactor:O=[0,0,0],alphaMode:V="OPAQUE",alphaCutoff:$=.5,normalTexture:W,occlusionTexture:Q,emissiveTexture:ee,doubleSided:U}=M,{baseColorFactor:Y=[1,1,1,1],metallicFactor:te=1,roughnessFactor:oe=1,baseColorTexture:ve,metallicRoughnessTexture:ge}=M.pbrMetallicRoughness||{},be=Q?L[Q.index]:void 0;if(Q&&Q.extensions&&Q.extensions.KHR_texture_transform&&be){const Me=Q.extensions.KHR_texture_transform;be.offsetScale=[Me.offset[0],Me.offset[1],Me.scale[0],Me.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new rn(...Y),metallicFactor:te,roughnessFactor:oe,baseColorTexture:ve?L[ve.index]:void 0,metallicRoughnessTexture:ge?L[ge.index]:void 0},doubleSided:U,emissiveFactor:new rn(...O),alphaMode:V,alphaCutoff:$,normalTexture:W?L[W.index]:void 0,occlusionTexture:be,emissionTexture:ee?L[ee.index]:void 0,defined:M.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},i),f}function XE(r,e,i){const{matrix:l,rotation:h,translation:f,scale:p,mesh:x,extras:w,children:T}=r,I={};if(I.matrix=l||function(C,M,L,O){var V=M[0],$=M[1],W=M[2],Q=M[3],ee=V+V,U=$+$,Y=W+W,te=V*ee,oe=V*U,ve=V*Y,ge=$*U,be=$*Y,Me=W*Y,$e=Q*ee,ot=Q*U,Qe=Q*Y,rt=O[0],at=O[1],He=O[2];return C[0]=(1-(ge+Me))*rt,C[1]=(oe+Qe)*rt,C[2]=(ve-ot)*rt,C[3]=0,C[4]=(oe-Qe)*at,C[5]=(1-(te+Me))*at,C[6]=(be+$e)*at,C[7]=0,C[8]=(ve+ot)*He,C[9]=(be-$e)*He,C[10]=(1-(te+ge))*He,C[11]=0,C[12]=L[0],C[13]=L[1],C[14]=L[2],C[15]=1,C}([],h||[0,0,0,1],f||[0,0,0],p||[1,1,1]),x!==void 0){I.meshes=i[x];const C=I.anchor=[0,0];for(const M of I.meshes){const{min:L,max:O}=M.aabb;C[0]+=L[0]+O[0],C[1]+=L[1]+O[1]}C[0]=Math.floor(C[0]/I.meshes.length/2),C[1]=Math.floor(C[1]/I.meshes.length/2)}if(w&&(w.id&&(I.id=w.id),w.lights&&(I.lights=function(C){if(!C.length)return[];const M=function(W){const Q=atob(W),ee=new Uint8Array(Q.length);for(let U=0;U<Q.length;U++)ee[U]=Q.codePointAt(U);return ee}(C),L=[],O=M.length/24,V=new Uint16Array(M.buffer),$=new Float32Array(M.buffer);for(let W=0;W<O;W++){const Q=V[2*W*6]/30,ee=V[2*W*6+1]/30,U=V[2*W*6+10]/100,Y=$[6*W+1],te=$[6*W+2],oe=$[6*W+3],ve=$[6*W+4],ge=oe-Y,be=ve-te,Me=Math.hypot(ge,be);L.push({pos:[Y+.5*ge,te+.5*be,ee],normal:[be/Me,-ge/Me,0],width:Me,height:Q,depth:U,points:[Y,te,oe,ve]})}return L}(w.lights))),T){const C=[];for(const M of T)C.push(XE(e.json.nodes[M],e,i));I.children=C}return I}function rz(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new Kv(r.vertices,r.indices,8,256),[i,l]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:l}}function oz(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const l=[];for(const p of i){if(!Array.isArray(p)||p.length!==2)continue;const x=p[0],w=p[1];typeof x=="number"&&typeof w=="number"&&l.push(new _t(x,w))}if(l.length<3)return null;l.length>1&&l[l.length-1].equals(l[0])&&l.pop();let h=0;for(let p=0;p<l.length;p++){const x=l[p],w=l[(p+1)%l.length],T=l[(p+2)%l.length];h+=(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)}h>0&&l.reverse();const f=Xp(l.flatMap(p=>[p.x,p.y]),[]);return f.length===0?null:{vertices:l,indices:f}}function az(r,e){const i=[],l=[];let h=0;const f=[];for(const p of r){h=i.length;const x=p.vertexArray.float32,w=p.indexArray.uint16;for(let T=0;T<p.vertexArray.length;T++)f[0]=x[3*T+0],f[1]=x[3*T+1],f[2]=x[3*T+2],fn(f,f,e),i.push(new _t(f[0],f[1]));for(let T=0;T<3*p.indexArray.length;T++)l.push(w[T]+h)}if(l.length%3!=0)return null;for(let p=0;p<l.length;p+=3){const x=i[l[p+0]],w=i[l[p+1]],T=i[l[p+2]];(x.x-w.x)*(T.y-w.y)-(T.x-w.x)*(x.y-w.y)>0&&([l[p+1],l[p+2]]=[l[p+2],l[p+1]])}return{vertices:i,indices:l}}function YE(r){const e=function(w,T){const I=[],C=WebGL2RenderingContext;if(w.json.textures)for(const M of w.json.textures){const L={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};M.sampler!==void 0&&Object.assign(L,w.json.samplers[M.sampler]),I.push({image:T[M.source],sampler:L,uploaded:!1})}return I}(r,r.images),i=function(w,T){const I=[];for(const C of w.json.meshes){const M=[];for(const L of C.primitives)M.push(sz(L,w,T));I.push(M)}return I}(r,e),{scenes:l,scene:h,nodes:f}=r.json,p=l?l[h||0].nodes:f,x=[];for(const w of p)x.push(XE(f[w],r,i));return function(w,T,I){const C={},M=new Set;for(let L=0;L<w.length;L++){const O=I[T[L]];if(!O.extras)continue;const V=O.extras["mapbox:footprint:version"],$=O.extras["mapbox:footprint:id"];(V||$)&&M.add(L),V==="1.0.0"&&$&&(C[$]=L)}for(let L=0;L<w.length;L++){if(M.has(L))continue;const O=w[L],V=I[T[L]];if(!V.extras)continue;let $=null;O.id in C&&($=az(w[C[O.id]].meshes,O.matrix)),$||($=oz(V)),$&&(O.footprint=rz($))}if(M.size>0){const L=Array.from(M.values()).sort((O,V)=>O-V);for(let O=L.length-1;O>=0;O--)w.splice(L[O],1)}}(x,p,r.json.nodes),x}function lz(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,l=r.aabb.min[1]-1,h=iu/(r.aabb.max[0]-i+2),f=iu/(r.aabb.max[1]-l+2);for(let p=0;p<e.length;p+=3){const x=e[p+2],w=(e[p+0]-i)*h|0,T=(e[p+1]-l)*f|0;x>r.heightmap[T*iu+w]&&(r.heightmap[T*iu+w]=x)}}function cz(r,e){const i={};i.indexArray=new Gs,i.indexArray.reserve(4*r.length),i.vertexArray=new Ao,i.vertexArray.reserve(10*r.length),i.colorArray=new $s,i.vertexArray.reserve(10*r.length);let l=0;for(const p of r){const x=Math.min(10,Math.max(4,1.3*p.height))*e,w=[-p.normal[1],p.normal[0],0],T=Math.min(.29,.1*p.width/p.depth),I=p.width-2*p.depth*e*(T+.01),C=ss([],p.pos,w,I/2),M=ss([],p.pos,w,-I/2),L=[C[0],C[1],C[2]+p.height],O=[M[0],M[1],M[2]+p.height],V=ss([],p.normal,w,T);Ui(V,V,x);const $=ss([],p.normal,w,-T);Ui($,$,x),yi(V,C,V),yi($,M,$),C[2]+=.1,M[2]+=.1,i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(L[0],L[1],L[2]),i.vertexArray.emplaceBack(O[0],O[1],O[2]),i.vertexArray.emplaceBack(C[0],C[1],C[2]),i.vertexArray.emplaceBack(M[0],M[1],M[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack($[0],$[1],$[2]);const W=I/x/2;i.colorArray.emplaceBack(-W-T,-1,W,.8),i.colorArray.emplaceBack(W+T,-1,W,.8),i.colorArray.emplaceBack(-W,0,W,1.3),i.colorArray.emplaceBack(W,0,W,1.3),i.colorArray.emplaceBack(W+T,-.8,W,.7),i.colorArray.emplaceBack(W+T,-.8,W,.7),i.colorArray.emplaceBack(0,0,W,1.3),i.colorArray.emplaceBack(0,0,W,1.3),i.colorArray.emplaceBack(W+T,-1.2,W,.8),i.colorArray.emplaceBack(W+T,-1.2,W,.8),i.indexArray.emplaceBack(6+l,4+l,8+l),i.indexArray.emplaceBack(7+l,9+l,5+l),i.indexArray.emplaceBack(0+l,1+l,2+l),i.indexArray.emplaceBack(1+l,3+l,2+l),l+=10}const h={defined:!0};h.emissiveFactor=rn.black;const f={};return f.baseColorFactor=rn.white,h.pbrMetallicRoughness=f,i.material=h,i.aabb=new Ki([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Ey.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(l=>{const{layerName:h,firstByte:f,lastByte:p,pixelFormat:x,blockShape:w,blockIndex:T,filters:I,codec:C}=l,M=i.subarray(f,p+1),L=new Uint32Array(w[0]*w[1]*w[2]);let O;if(C!=="gzip_data")throw new Po(`Unhandled codec: ${C}`);return O=function(V,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve(((U=function(oe){oe[0]==31&&oe[1]==139&&oe[2]==8||oa(6,"invalid gzip data");var ve=oe[3],ge=10;4&ve&&(ge+=2+(oe[10]|oe[11]<<8));for(var be=(ve>>3&1)+(ve>>4&1);be>0;be-=!oe[ge++]);return ge+(2&ve)}(ee=V))+8>ee.length&&oa(6,"invalid gzip data"),function(oe,ve,ge,be){var Me=oe.length;if(!Me||ve.f&&!ve.l)return ge||new uo(0);var $e=!ge,ot=$e||ve.i!=2,Qe=ve.i;$e&&(ge=new uo(3*Me));var rt,at,He=function(as){var On=ge.length;if(as>On){var En=new uo(Math.max(2*On,as));En.set(ge),ge=En}},nt=ve.f||0,Ue=ve.p||0,Ge=ve.b||0,ht=ve.l,dt=ve.d,Yt=ve.m,Ot=ve.n,bt=8*Me;do{if(!ht){nt=ra(oe,Ue,1);var ct=ra(oe,Ue+1,3);if(Ue+=3,!ct){var di=oe[(ne=4+((Ue+7)/8|0))-4]|oe[ne-3]<<8,Lt=ne+di;if(Lt>Me){Qe&&oa(0);break}ot&&He(Ge+di),ge.set(oe.subarray(ne,Lt),Ge),ve.b=Ge+=di,ve.p=Ue=8*Lt,ve.f=nt;continue}if(ct==1)ht=YL,dt=KL,Yt=9,Ot=5;else if(ct==2){var Ft=ra(oe,Ue,31)+257,oi=ra(oe,Ue+10,15)+4,wi=Ft+ra(oe,Ue+5,31)+1;Ue+=14;for(var bi=new uo(wi),Ri=new uo(19),Ai=0;Ai<oi;++Ai)Ri[qL[Ai]]=ra(oe,Ue+3*Ai,7);Ue+=3*oi;var Li=H0(Ri),ln=(1<<Li)-1,Mn=Sm(Ri,Li);for(Ai=0;Ai<wi;){var ne,ae=Mn[ra(oe,Ue,ln)];if(Ue+=15&ae,(ne=ae>>4)<16)bi[Ai++]=ne;else{var We=0,pt=0;for(ne==16?(pt=3+ra(oe,Ue,3),Ue+=2,We=bi[Ai-1]):ne==17?(pt=3+ra(oe,Ue,7),Ue+=3):ne==18&&(pt=11+ra(oe,Ue,127),Ue+=7);pt--;)bi[Ai++]=We}}var wt=bi.subarray(0,Ft),vt=bi.subarray(Ft);Yt=H0(wt),Ot=H0(vt),ht=Sm(wt,Yt),dt=Sm(vt,Ot)}else oa(1);if(Ue>bt){Qe&&oa(0);break}}ot&&He(Ge+131072);for(var Dt=(1<<Yt)-1,si=(1<<Ot)-1,ki=Ue;;ki=Ue){var Fi=(We=ht[W0(oe,Ue)&Dt])>>4;if((Ue+=15&We)>bt){Qe&&oa(0);break}if(We||oa(2),Fi<256)ge[Ge++]=Fi;else{if(Fi==256){ki=Ue,ht=null;break}var Ii=Fi-254;Fi>264&&(Ii=ra(oe,Ue,(1<<(Bi=NE[Ai=Fi-257]))-1)+$E[Ai],Ue+=Bi);var dn=dt[W0(oe,Ue)&si],Sn=dn>>4;if(dn||oa(3),Ue+=15&dn,vt=XL[Sn],Sn>3){var Bi=VE[Sn];vt+=W0(oe,Ue)&(1<<Bi)-1,Ue+=Bi}if(Ue>bt){Qe&&oa(0);break}ot&&He(Ge+131072);var Zn=Ge+Ii;if(Ge<vt){var Pn=0-vt,cn=Math.min(vt,Zn);for(Pn+Ge<0&&oa(3);Ge<cn;++Ge)ge[Ge]=(void 0)[Pn+Ge]}for(;Ge<Zn;++Ge)ge[Ge]=ge[Ge-vt]}}ve.l=ht,ve.p=ki,ve.b=Ge,ve.f=nt,ht&&(nt=1,ve.m=Yt,ve.d=dt,ve.n=Ot)}while(!nt);return Ge!=ge.length&&$e?(rt=ge,((at=Ge)==null||at>rt.length)&&(at=rt.length),new uo(rt.subarray(0,at))):ge.subarray(0,Ge)}(ee.subarray(U,-8),{i:2},new uo(((W=ee)[(Q=W.length)-4]|W[Q-3]<<8|W[Q-2]<<16|W[Q-1]<<24)>>>0))));var W,Q,ee,U;const Y=tz[$];if(!Y)throw new Error(`Unhandled codec: ${$}`);const te=new globalThis.DecompressionStream(Y);return new Response(new Blob([V]).stream().pipeThrough(te)).arrayBuffer().then(oe=>new Uint8Array(oe))}(M,C).then(V=>(function($,W){$.readFields(UL,W)}(new q0(V),L),new nz[x](L.buffer))),O.then(V=>{for(let $=I.length-1;$>=0;$--)switch(I[$]){case"delta_filter":$L(V,w);break;case"zigzag_filter":GL(V);break;case"bitshuffle_filter":HL(V,x);break;default:throw new Po(`Unhandled filter "${I[$]}"`)}return{layerName:h,blockIndex:T,data:V}}).catch(V=>{throw V})}))},Ct(ZE,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ct(Ey,"MapboxRasterTile"),Ct(qE,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class KE{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const l=e[i];this._stringToNumber[l]=i,this._numberToString[i]=l}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const hz=["id","tile","layer","source","sourceLayer","state"];class Xd{constructor(e,i,l,h,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=l,this._y=h,this.properties=e.properties,this.id=f}clone(){const e=new Xd(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of hz)this[i]!==void 0&&(e[i]=this[i]);return e}}class JE{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Yo(yt,16,0),this.featureIndexArray=new Tg,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,l,h,f,p=0,x=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,f,p);const T=this.grid;for(let I=0;I<i.length;I++){const C=i[I],M=[1/0,1/0,-1/0,-1/0];for(let L=0;L<C.length;L++){const O=C[L];M[0]=Math.min(M[0],O.x),M[1]=Math.min(M[1],O.y),M[2]=Math.max(M[2],O.x),M[3]=Math.max(M[3],O.y)}x!==0&&(M[0]-=x,M[1]-=x,M[2]+=x,M[3]+=x),M[0]<yt&&M[1]<yt&&M[2]>=0&&M[3]>=0&&T.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Mi.VectorTile(new Zg(this.rawTileData)).layers,this.sourceLayerCoder=new KE(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:l,transform:h,tileTransform:f,pixelPosMatrix:p,availableImages:x,worldview:w}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=l.bufferedTilespaceBounds,I=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(O,V,$,W)=>wc(l.bufferedTilespaceGeometry,O,V,$,W));I.sort(uz);let C=null;h.elevation&&I.length>0&&(C=Hd.create(h.elevation,this.tileID));const M={};let L;for(let O=0;O<I.length;O++){const V=I[O];if(V===L)continue;L=V;const $=this.featureIndexArray.get(V);let W=null;this.is3DTile?this.loadMatchingModelFeature(M,$,e,l,h,w):this.loadMatchingFeature(M,$,e,x,w,(Q,ee,U,Y=0)=>(W||(W=Pt(Q,this.tileID.canonical,f)),ee.queryIntersectsFeature(l,Q,U,W,this.z,h,p,C,Y)))}return M}loadMatchingFeature(e,i,l,h,f,p){const{featureIndex:x,bucketIndex:w,sourceLayerIndex:T,layoutVertexArrayOffset:I}=i,C=this.bucketLayerIDs[w],M=l.layers,L=Object.keys(M);if(L.length&&!mi(L,C))return;const O=l.sourceCache,V=this.sourceLayerCoder.decode(T),$=this.vtLayers[V].feature(x),W=this.getId($,V);for(let Q=0;Q<C.length;Q++){const ee=C[Q];if(!M[ee])continue;const{styleLayer:U,targets:Y}=M[ee];let te={};W!==void 0&&(te=O.getFeatureState(U.sourceLayer,W));const oe=!p||p($,U,te,I);if(!oe)continue;const ve=new Xd($,this.z,this.x,this.y,W);ve.tile=this.tileID.canonical,ve.state=te;let ge=this.serializedLayersCache.get(ee);ge||(ge=U.serialize(),ge.id=ee,this.serializedLayersCache.set(ee,ge)),ve.source=ge.source,ve.sourceLayer=ge["source-layer"],ve.layer=Fe({},ge),ve.layer.paint=QE(ge.paint,U.paint,$,te,h),ve.layer.layout=QE(ge.layout,U.layout,$,te,h);let be=!1;for(const Me of Y){this.updateFeatureProperties(ve,Me);const{filter:$e}=Me;if($e){if($.properties=ve.properties,$e.needGeometry){const ot=Et($,!0);if(!$e.filter(new gn(this.tileID.overscaledZ,{worldview:f}),ot,this.tileID.canonical))continue}else if(!$e.filter(new gn(this.tileID.overscaledZ,{worldview:f}),$))continue}be=!0,Me.targetId&&this.addFeatureVariant(ve,Me)}be&&this.appendToResult(e,ee,x,ve,oe)}}loadMatchingModelFeature(e,i,l,h,f,p){const{featureIndex:x,bucketIndex:w}=i,T=this.bucketLayerIDs[w],I=l.layers,C=Object.keys(I);if(!C.length||mi(C,T))for(let M=0;M<T.length;M++){const L=T[M],{styleLayer:O,targets:V}=I[L];if(O.type!=="model")continue;const $=h.tile,W=$.getBucket(O);if(!(W&&W instanceof yy))continue;const Q=hL(W,x,h,f);if(!Q)continue;const{z:ee,x:U,y:Y}=$.tileID.canonical,{feature:te,intersectionZ:oe,position:ve}=Q;let ge={};te.id!==void 0&&(ge=l.sourceCache.getFeatureState(O.sourceLayer,te.id));const be=new Xd({},ee,U,Y,te.id);be.tile=this.tileID.canonical,be.state=ge,be.properties=te.properties,be.geometry={type:"Point",coordinates:[ve.lng,ve.lat]};let Me=this.serializedLayersCache.get(L);Me||(Me=O.serialize(),Me.id=L,this.serializedLayersCache.set(L,Me)),be.source=Me.source,be.sourceLayer=Me["source-layer"],be.layer=Fe({},Me);let $e=!1;for(const ot of V){this.updateFeatureProperties(be,ot);const{filter:Qe}=ot;if(Qe){if(te.properties=be.properties,Qe.needGeometry){if(!Qe.filter(new gn(this.tileID.overscaledZ,{worldview:p}),te,this.tileID.canonical))continue}else if(!Qe.filter(new gn(this.tileID.overscaledZ,{worldview:p}),te))continue}$e=!0,ot.targetId&&this.addFeatureVariant(be,ot)}$e&&this.appendToResult(e,L,x,be,oe)}}updateFeatureProperties(e,i,l){if(i.properties){const h={};for(const f in i.properties){const p=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,l);p!=null&&(h[f]=p)}e.properties=h}}addFeatureVariant(e,i,l){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(h)}appendToResult(e,i,l,h,f){let p=e[i];p===void 0&&(p=e[i]=[]),p.push({featureIndex:l,feature:h,intersectionZ:f})}lookupSymbolFeatures(e,i,l,h,f,p){const x={};this.loadVTLayers();for(const w of e)this.loadMatchingFeature(x,{bucketIndex:i,sourceLayerIndex:l,featureIndex:w,layoutVertexArrayOffset:0},h,f,p);return x}loadFeature(e){const{featureIndex:i,sourceLayerIndex:l}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),f=this.vtFeatures[h];if(f[i])return f[i];const p=this.vtLayers[h].feature(i);return f[i]=p,p}hasLayer(e){for(const i of this.bucketLayerIDs)for(const l of i)if(e===l)return!0;return!1}getId(e,i){let l=e.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const f=Xo(h);if(f.result!=="success"){const p=f.value.map(x=>`${x.key}: ${x.message}`).join(", ");return void Si(`Failed to create expression for promoteId: ${p}`)}this.promoteIdExpression=f.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new gh),l=this.promoteIdExpression.evaluate({zoom:0},e)}else l=e.properties[h];typeof l=="boolean"&&(l=Number(l))}return l}}function QE(r,e,i,l,h){return Bt(r,(f,p)=>{const x=e instanceof gl?e.get(p):null;return x&&x.evaluate?x.evaluate(i,l,void 0,h):x})}function uz(r,e){return e-r}Ct(JE,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const e2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class X0{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,l]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=l>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const f=e2[15&l];if(!f)throw new Error("Unrecognized array type.");const[p]=new Uint16Array(e,2,1),[x]=new Uint32Array(e,4,1);return new X0(x,p,f,e)}constructor(e,i=64,l=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=l,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=e2.indexOf(this.ArrayType),p=2*e*this.ArrayType.BYTES_PER_ELEMENT,x=e*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-x%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${l}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+p+x+w),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+x+w,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const l=this._pos>>1;return this.ids[l]=l,this.coords[this._pos++]=e,this.coords[this._pos++]=i,l}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Y0(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,l,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:p,nodeSize:x}=this,w=[0,f.length-1,0],T=[];for(;w.length;){const I=w.pop()||0,C=w.pop()||0,M=w.pop()||0;if(C-M<=x){for(let $=M;$<=C;$++){const W=p[2*$],Q=p[2*$+1];W>=e&&W<=l&&Q>=i&&Q<=h&&T.push(f[$])}continue}const L=M+C>>1,O=p[2*L],V=p[2*L+1];O>=e&&O<=l&&V>=i&&V<=h&&T.push(f[L]),(I===0?e<=O:i<=V)&&(w.push(M),w.push(L-1),w.push(1-I)),(I===0?l>=O:h>=V)&&(w.push(L+1),w.push(C),w.push(1-I))}return T}within(e,i,l){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:f,nodeSize:p}=this,x=[0,h.length-1,0],w=[],T=l*l;for(;x.length;){const I=x.pop()||0,C=x.pop()||0,M=x.pop()||0;if(C-M<=p){for(let $=M;$<=C;$++)i2(f[2*$],f[2*$+1],e,i)<=T&&w.push(h[$]);continue}const L=M+C>>1,O=f[2*L],V=f[2*L+1];i2(O,V,e,i)<=T&&w.push(h[L]),(I===0?e-l<=O:i-l<=V)&&(x.push(M),x.push(L-1),x.push(1-I)),(I===0?e+l>=O:i+l>=V)&&(x.push(L+1),x.push(C),x.push(1-I))}return w}}function Y0(r,e,i,l,h,f){if(h-l<=i)return;const p=l+h>>1;t2(r,e,p,l,h,f),Y0(r,e,i,l,p-1,1-f),Y0(r,e,i,p+1,h,1-f)}function t2(r,e,i,l,h,f){for(;h>l;){if(h-l>600){const T=h-l+1,I=i-l+1,C=Math.log(T),M=.5*Math.exp(2*C/3),L=.5*Math.sqrt(C*M*(T-M)/T)*(I-T/2<0?-1:1);t2(r,e,i,Math.max(l,Math.floor(i-I*M/T+L)),Math.min(h,Math.floor(i+(T-I)*M/T+L)),f)}const p=e[2*i+f];let x=l,w=h;for(Am(r,e,l,i),e[2*h+f]>p&&Am(r,e,l,h);x<w;){for(Am(r,e,x,w),x++,w--;e[2*x+f]<p;)x++;for(;e[2*w+f]>p;)w--}e[2*l+f]===p?Am(r,e,l,w):(w++,Am(r,e,w,h)),w<=i&&(l=w+1),i<=w&&(h=w-1)}}function Am(r,e,i,l){K0(r,i,l),K0(e,2*i,2*l),K0(e,2*i+1,2*l+1)}function K0(r,e,i){const l=r[e];r[e]=r[i],r[i]=l}function i2(r,e,i,l){const h=r-i,f=e-l;return h*h+f*f}n.$=Ns,n.A=nl,n.B=qo,n.C=xl,n.D=kd,n.E=sl,n.F=2,n.G=dm,n.H=vS,n.I=Sr,n.J=ga,n.K=class extends _y{},n.L=ol,n.M=ao,n.N=Ih,n.O=Ah,n.P=_t,n.Q=vp,n.R=ah,n.S=dd,n.T=D0,n.U=_d,n.V=_y,n.W=ng,n.X=Xo,n.Y=Qu,n.Z=nc,n._=ic,n.a=function(r){return js.API_CDN_URL_REGEX.test(r)},n.a$=Ve,n.a0=rl,n.a1=gd,n.a2=Ch,n.a3=xp,n.a4=function(r){const e=r.value;let i=[];if(!e)return i;const l=ga(e);return l!=="string"?(i=i.concat([new _y(r.key,e,`string expected, "${l}" found`)]),i):(O0(e,!0)||(i=i.concat([new _y(r.key,e,`invalid url "${e}"`)])),i)},n.a5=Re,n.a6=cg,n.a7=Kn,n.a8=lt,n.a9=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return Bn(r.expression.evaluate(e))}interpolate(r,e,i){return{x:ri(r.x,e.x,i),y:ri(r.y,e.y,i),z:ri(r.z,e.z,i),azimuthal:ri(r.azimuthal,e.azimuthal,i),polar:ri(r.polar,e.polar,i)}}},n.aA=Qt,n.aB=v,n.aC=Mo,n.aD=ue,n.aE=Be,n.aF=function(r,e){const i={};for(let l=0;l<e.length;l++){const h=e[l];h in r&&(i[h]=r[h])}return i},n.aG=re,n.aH=he,n.aI=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,l){const h=this.entries[r]=this.entries[r]||{callbacks:[]};if(h.result){const[f,p]=h.result;return this.scheduler?this.scheduler.add(()=>{l(f,p)},e):l(f,p),()=>{}}return h.callbacks.push(l),h.cancel||(h.cancel=i((f,p)=>{h.result=[f,p];for(const x of h.callbacks)this.scheduler?this.scheduler.add(()=>{x(f,p)},e):x(f,p);setTimeout(()=>delete this.entries[r],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(f=>f!==l),h.callbacks.length||(h.cancel(),delete this.entries[r]))}}},n.aJ=function(r,e,i){const l=JSON.stringify(r.request);return r.data&&(this.deduped.entries[l]={result:[null,r.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const f=lh(r.request,(p,x,w,T)=>{p?h(p):x&&h(null,{vectorTile:i?void 0:new Mi.VectorTile(new Zg(x)),rawData:x,cacheControl:w,expires:T})});return()=>{f.cancel(),h()}},e)},n.aK=function(r){jf++,jf>Go&&(r.getActor().send("enforceCacheSizeLimit",so),jf=0)},n.aL=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},n.aM=hr,n.aN=XS,n.aO=tE,n.aP=ZS,n.aQ=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let l=0;l<r.length;l++){const h=document.createElement("source");Qx(r[l])||(i.crossOrigin="Anonymous"),h.src=r[l],i.appendChild(h)}return{cancel:()=>{}}},n.aR=uy,n.aS=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>NT(e,0,r))},n.aT=YE,n.aU=class{constructor(r,e,i,l){this.id=r,this.position=e!=null?new K(e[0],e[1]):new K(0,0),this.orientation=i??[0,0,0],this.nodes=l,this.uploaded=!1,this.aabb=new Ki([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(Ie(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const l=Ki.applyTransformFast(i.aabb,r.matrix);this.aabb.encapsulate(l)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=pe([]);for(const e of this.nodes)this._applyTransformations(e,r)}computeModelMatrix(r,e,i,l,h,f,p=!1){dE(this.matrix,this,r.transform,this.position,e,i,l,h,f,p)}upload(r){if(!this.uploaded){for(const e of this.nodes)F0(e,r);for(const e of this.nodes)gy(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)B0(r)}},n.aV=kt,n.aW=pm,n.aX=ye,n.aY=Le,n.aZ=dc,n.a_=Gs,n.aa=gn,n.ab=Ph,n.ac=Te,n.ad=fn,n.ae=gi,n.af=Se,n.ag=gl,n.ah=Tc,n.ai=ri,n.aj=yt,n.ak=Uu,n.al=Yi,n.am=rn,n.an=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,l]){const h=Bn([1,i,l]);return{x:h.x,y:h.y,z:h.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:ri(r.x,e.x,i),y:ri(r.y,e.y,i),z:ri(r.z,e.z,i)}}},n.ao=function(r,e,i=0,l=!0){const h=new _t(i,i),f=r.sub(h),p=e.add(h),x=[f,new _t(p.x,f.y),p,new _t(f.x,p.y)];return l&&x.push(f.clone()),x},n.ap=function(r,e){const i=[];for(let l=0;l<r.length;l++){const h=ke(l-1,-1,r.length-1),f=ke(l+1,-1,r.length-1),p=r[l],x=r[f],w=r[h].sub(p).unit(),T=x.sub(p).unit(),I=T.angleWithSep(w.x,w.y),C=w.add(T).unit().mult(-1*e/Math.sin(I/2));i.push(p.add(C))}return i},n.aq=zS,n.ar=wc,n.as=function(r,e,i=0){return _i(((e.x-i)*r.scale-r.x)*yt,(e.y*r.scale-r.y)*yt,ze(e.z,e.y))},n.at=Ce,n.au=Zi,n.av=Ln,n.aw=WT,n.ax=function(r){let e=1/0,i=1/0,l=-1/0,h=-1/0;for(const f of r)e=Math.min(e,f.x),i=Math.min(i,f.y),l=Math.max(l,f.x),h=Math.max(h,f.y);return{min:new _t(e,i),max:new _t(l,h)}},n.ay=de,n.az=Ie,n.b=function(r){return js.API_FONTS_REGEX.test(r)},n.b$=function(r,e,i){i*=.5;var l=e[0],h=e[1],f=e[2],p=e[3],x=Math.sin(i),w=Math.cos(i);return r[0]=l*w+h*x,r[1]=h*w-l*x,r[2]=f*w+p*x,r[3]=p*w-f*x,r},n.b0=Ed,n.b1=cy,n.b2=function(){Qo.isLoading()||Qo.isLoaded()||cc()!=="deferred"||lg()},n.b3=Ap,n.b4=Et,n.b5=Xd,n.b6=Ji,n.b7=c0,n.b8=Yv,n.b9=Pt,n.bA=function(r,e){const{x:i,y:l}=r.point,h=Ew(i,l,r.worldSize/r._pixelsPerMercatorPixel,0,0);return Ie(h,h,Vv(za(e)))},n.bB=N,n.bC=function(r){return r[0]=0,r[1]=0,r[2]=0,r},n.bD=function(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])},n.bE=ss,n.bF=es,n.bG=en,n.bH=um,n.bI=Nr,n.bJ=g0,n.bK=function(r,e,i,l,h){const f=5*e+2;r.float32[f+0]=i,r.float32[f+1]=l,r.float32[f+2]=h},n.bL=ly,n.bM=Gg,n.bN=xr,n.bO=Vs,n.bP=tT,n.bQ=aE,n.bR=oT,n.bS=aT,n.bT=_0,n.bU=IS,n.bV=b0,n.bW=X0,n.bX=ke,n.bY=Ui,n.bZ=gt,n.b_=Kt,n.ba=ea,n.bb=Vh,n.bc=xw,n.bd=ts,n.be=Xp,n.bf=C0,n.bg=function(r,e){const i=Tc(e.zoom);if(i===0)return za(r);const l=Lg(r),h=Nv(l),f=ue(l.getWest())*e.worldSize,p=ue(l.getEast())*e.worldSize,x=he(l.getNorth())*e.worldSize,w=he(l.getSouth())*e.worldSize,T=[f,x,0],I=[p,x,0],C=[f,w,0],M=[p,w,0],L=Ae([],e.globeMatrix);return fn(T,T,L),fn(I,I,L),fn(C,C,L),fn(M,M,L),h[0]=wl(h[0],C,i),h[1]=wl(h[1],M,i),h[2]=wl(h[2],I,i),h[3]=wl(h[3],T,i),Ki.fromPoints(h)},n.bh=Og,n.bi=Ae,n.bj=qp,n.bk=wl,n.bl=Oh,n.bm=tD,n.bn=Tt,n.bo=Je,n.bp=Ey,n.bq=Zg,n.br=lh,n.bs=function(r,e){const i=[];for(const l in r)l in e||i.push(l);return i},n.bt=Ee,n.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.bv=jo,n.bw=function(r){var e=new B(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},n.bx=pe,n.by=xt,n.bz=we,n.c=Ru,n.c$=Hg,n.c0=Vt,n.c1=Yn,n.c2=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},n.c3=Wt,n.c4=function(r,e,i,l,h){var f,p=1/Math.tan(e/2);return r[0]=p/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=p,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+l)*(f=1/(l-h)),r[14]=2*h*l*f):(r[10]=-1,r[14]=-2*l),r},n.c5=function(r,e,i,l,h,f,p){var x=1/(e-i),w=1/(l-h),T=1/(f-p);return r[0]=-2*x,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*w,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(e+i)*x,r[13]=(h+l)*w,r[14]=(p+f)*T,r[15]=1,r},n.c6=_e,n.c7=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},n.c8=Md,n.c9=Gh,n.cA=py,n.cB=Zt,n.cC=iE,n.cD=function(r){const e=iE(r,!0);return N([],[e[0],e[1],e[4],e[5]])},n.cE=Pe,n.cF=Tn,n.cG=Oe,n.cH=function(r){const{x:e,y:i}=r.point,{lng:l,lat:h}=r._center;return Ew(e,i,r.worldSize,l,h)},n.cI=xi,n.cJ=Ne,n.cK=zd,n.cL=S,n.cM=function(r,e,i){let l=0;for(let h=0;h<2;++h)r[h]>0&&(l+=(r[h]-0)*(r[h]-0)),e[h]<0&&(l+=(0-e[h])*(0-e[h]));return l},n.cN=function(r){return r*r*r*r*r},n.cO=fe,n.cP=45,n.cQ=Pd,n.cR=function(r,e,i){const l=Math.sqrt(r*r+e*e+i*i),h=l>0?Math.acos(i/l)*Qc:0;let f=r!==0||e!==0?Math.atan2(-e,-r)*Qc+90:0;return f<0&&(f+=360),[l,f,h]},n.cS=_i,n.cT=Bn,n.cU=je,n.cV=yi,n.cW=Ki,n.cX=$t,n.cY=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},n.cZ=O0,n.c_=function(r,e){return r.readFields(fL,{icons:[]},e)},n.ca=us,n.cb=Io,n.cc=yc,n.cd=K,n.ce=NS,n.cf=function(){var r=new B(4);return B!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},n.cg=function(r,e,i){var l=e[0],h=e[1],f=e[2],p=e[3],x=Math.sin(i),w=Math.cos(i);return r[0]=l*w+f*x,r[1]=h*w+p*x,r[2]=l*-x+f*w,r[3]=h*-x+p*w,r},n.ch=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},n.ci=Js,n.cj=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},n.ck=wn,n.cl=Ks,n.cm=yw,n.cn=Vn,n.co=nE,n.cp=Xh,n.cq=ww,n.cr=function(r,e,i,l,h,f,p,x,w){if(w.name==="globe")return ww(r,e,new Xh(i,l,h),!1);const T=pm({z:i,x:l,y:h},w);return new Ki([(f+T.x/T.scale)*e,e*(T.y/T.scale),p],[(f+T.x2/T.scale)*e,e*(T.y2/T.scale),x])},n.cs=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},n.ct=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},n.cu=function(r){const e=Math.round((r+45+360)%360/90)%4;return q[e]},n.cv=qe,n.cw=zt,n.cx=A,n.cy=function(r){const e=pe(new Float64Array(16));Ie(e,r.pixelMatrix,r.globeMatrix);const i=[0,z,0],l=[0,F,0];return fn(i,i,e),fn(l,l,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!jv(r,new K(r.center.lat,90)),l[0]>0&&l[0]<=r.width&&l[1]>0&&l[1]<=r.height&&!jv(r,new K(r.center.lat,-90))]},n.cz=function(r,e){const{scale:i}=r.tileTransform,l=i*yt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(h,f,p){var x=f[1],w=f[2],T=f[3],I=p[0],C=p[1];return h[0]=f[0]*I,h[1]=x*I,h[2]=w*C,h[3]=T*C,h}(new Float32Array(4),e.inverseAdjustmentMatrix,[l,l])},n.d=function(r){return js.API_TILEJSON_REGEX.test(r)},n.d$=Np,n.d0=Ud,n.d1=x0,n.d2=ku,n.d3=_l,n.d4=Hr,n.d5=hh,n.d6=ui,n.d7=function(r){const e=r.indexOf(Lh);return e>=0?r.slice(0,e):r},n.d8=function(r){return r.indexOf(Lh)>=0},n.d9=function(r){const e=r.lastIndexOf(Lh);return e>=0?r.slice(e+1):""},n.dA=Sw,n.dB=mr,n.dC=er,n.dD=256,n.dE=function(r,e){const i=[0,0,0];return fn(i,i,Og(za(e.canonical))),fn(i,i,r),i},n.dF=r=>({u_matrix:new yc(r),u_texsize:new Io(r),u_pixels_to_tile_units:new Hh(r),u_device_pixel_ratio:new us(r),u_width_scale:new us(r),u_floor_width_scale:new us(r),u_image:new Md(r),u_units_to_pixels:new Io(r),u_tile_units_to_pixels:new us(r),u_alpha_discard_threshold:new us(r),u_trim_offset:new Io(r),u_trim_fade_range:new Io(r),u_trim_color:new Pd(r),u_emissive_strength:new us(r),u_zbias_factor:new us(r),u_tile_to_meter:new us(r),u_ground_shadow_factor:new Gh(r),u_pattern_transition:new us(r)}),n.dG=r=>({u_matrix:new yc(r),u_pixels_to_tile_units:new Hh(r),u_device_pixel_ratio:new us(r),u_width_scale:new us(r),u_floor_width_scale:new us(r),u_units_to_pixels:new Io(r),u_dash_image:new Md(r),u_gradient_image:new Md(r),u_image_height:new us(r),u_texsize:new Io(r),u_tile_units_to_pixels:new us(r),u_alpha_discard_threshold:new us(r),u_trim_offset:new Io(r),u_trim_fade_range:new Io(r),u_trim_color:new Pd(r),u_emissive_strength:new us(r),u_zbias_factor:new us(r),u_tile_to_meter:new us(r),u_ground_shadow_factor:new Gh(r)}),n.dH=r=>({u_camera_to_center_distance:new us(r),u_extrude_scale:new Hh(r),u_device_pixel_ratio:new us(r),u_matrix:new yc(r),u_inv_rot_matrix:new yc(r),u_merc_center:new Io(r),u_tile_id:new Gh(r),u_zoom_transition:new us(r),u_up_dir:new Gh(r),u_emissive_strength:new us(r)}),n.dI=zp,n.dJ=gR,n.dK=Cw,n.dL=(r,e,i,l,h,f)=>{const p=r.transform,x=p.projection.name==="globe";let w;if(f.paint.get("circle-pitch-alignment")==="map")if(x){const I=Sw(p.zoom,e.canonical)*p._pixelsPerMercatorPixel;w=Float32Array.from([I,0,0,I])}else w=p.calculatePixelsToTileUnitsMatrix(i);else w=new Float32Array([p.pixelsToGLUnits[0],0,0,p.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(p.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:no.devicePixelRatio,u_extrude_scale:w,u_inv_rot_matrix:oD,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(x){T.u_inv_rot_matrix=l,T.u_merc_center=h,T.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],T.u_zoom_transition=Tc(p.zoom);const I=h[0]*yt,C=h[1]*yt;T.u_up_dir=p.projection.upVector(new Xh(0,0,0),I,C)}return T},n.dM=YT,n.dN=gr,n.dO=(r,e,i,l,h,f,p,x,w,T)=>{const I=r.transform,C=I.pitch<15?qT(.07,.7,de((14-I.zoom)/5,0,1)):.07,M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:XT(r,e,i,l),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_width_scale:f,u_floor_width_scale:p,u_image:0,u_tile_units_to_pixels:ZT(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:x,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:C,u_tile_to_meter:je(e.tileID.canonical,0),u_ground_shadow_factor:w,u_pattern_transition:T}},n.dP=(r,e,i,l,h,f,p,x,w,T)=>{const I=r.transform,C=I.calculatePixelsToTileUnitsMatrix(e),M=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",L=I.pitch<15?qT(.07,.7,de((14-I.zoom)/5,0,1)):.07;return{u_matrix:XT(r,e,i,l),u_pixels_to_tile_units:C,u_device_pixel_ratio:f,u_width_scale:p,u_floor_width_scale:x,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:KT(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ZT(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:w,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(M?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:L,u_tile_to_meter:je(e.tileID.canonical,0),u_ground_shadow_factor:T}},n.dQ=mt,n.dR=Zp,n.dS=ze,n.dT=QP,n.dU=$g,n.dV=vT,n.dW=Ec,n.dX=450,n.dY=7,n.dZ=JR,n.d_=Xi,n.da=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},n.db=function(r,e,i,l){return r.type==="custom"?new QR(r,e):new uL[r.type](r,e,i,l)},n.dc=li,n.dd=function(r){const e=r.indexOf(Lh);return e>=0?r.slice(e+1):""},n.de=class extends Xd{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},n.df=md,n.dg=$l,n.dh=function(r){return r({pluginStatus:cr,pluginURL:Jo}),md.on("pluginStateChange",r),r},n.di=Mg,n.dj=class extends ta{constructor(r){super(r),this.current=$p}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let l=0;l<9;l++)if(i[l]!==this.current[l]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},n.dk=J,n.dl=function(r,e,i){const l=Tc(i.zoom),h=r.style.map._antialias,f=r.terrain&&r.terrain.exaggeration()>0;return l===0&&!h&&!f},n.dm=function(r){const e=r.pixelsPerMeter,i=e/_e(1,r.center.lat),l=pe(new Float64Array(16));return Je(l,l,[r.point.x,r.point.y,0]),Pe(l,l,[i,i,e]),Float32Array.from(l)},n.dn=Lg,n.dp=function(r){const e=qe-5;r=de(r,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Yi(r))),3);return Math.round(i*(k.length-1))},n.dq=function(r,e,i,l){const h=e.getNorth(),f=e.getSouth(),p=e.getWest(),x=e.getEast(),w=1<<r.z,T=x-p,I=h-f,C=T/D,M=-I/k[i],L=[0,C,0,M,0,0,h,p,0];if(r.z>0){const O=180/l;se(L,L,[O/T+1,0,0,0,O/I+1,0,-.5*O/C,.5*O/M,1])}return L[2]=w,L[5]=r.x,L[8]=r.y,L},n.dr=za,n.ds=function(r,e,i){const l=pe(new Float64Array(16)),h=(e/(1<<r)-.5)*Math.PI*2;return tt(l,i.globeMatrix,h),Float32Array.from(l)},n.dt=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,l=1<<i,h=Math.floor(r.x),f=Math.floor((r.x-h)*l),p=Math.floor(r.y*l),x=this.findDEMTileFor(new hr(i,h,i,f,p));return!(!x||!x.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const l=this._source();if(!l||r.y<0||r.y>1)return e;const h=l.getSource().maxzoom,f=1<<h,p=Math.floor(r.x),x=r.x-p,w=new hr(h,p,h,Math.floor(x*f),Math.floor(r.y*f)),T=this.findDEMTileFor(w);if(!T||!T.dem)return e;const I=T.dem,C=1<<T.tileID.canonical.z,M=(x*C-T.tileID.canonical.x)*I.dim,L=(r.y*C-T.tileID.canonical.y)*I.dim,O=Math.floor(M),V=Math.floor(L);return(i?this.exaggeration():1)*ri(ri(I.get(O,V),I.get(O,V+1),L-V),ri(I.get(O+1,V),I.get(O+1,V+1),L-V),M-O)}getAtTileOffset(r,e,i){const l=1<<r.canonical.z;return this.getAtPointOrZero(new Te(r.wrap+(r.canonical.x+e/yt)/l,(r.canonical.y+i/yt)/l))}getAtTileOffsetFunc(r,e,i,l){return h=>{const f=this.getAtTileOffset(r,h.x,h.y),p=l.upVector(r.canonical,h.x,h.y);return Ui(p,p,f*l.upVectorScale(r.canonical,e,i).metersToTile),p}}getForTilePoints(r,e,i,l){if(this.isUsingMockSource())return!1;const h=Hd.create(this,r,l);return!!h&&(e.forEach(f=>{f[2]=this.exaggeration()*h.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,l=e.tileID,h=1<<r.canonical.z-l.canonical.z;let f=r.canonical.x/h-l.canonical.x,p=r.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<r.canonical.z-l.canonical.z&&!i.leaves[x];w++){f*=2,p*=2;const T=2*Math.floor(p)+Math.floor(f);x=i.childOffsets[x]+T,f%=1,p%=1}return{min:this.exaggeration()*i.minimums[x],max:this.exaggeration()*i.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,l=Number.MIN_VALUE;for(const h of r){const f=this.getMinMaxForTile(h.tileID);f&&(i=Math.min(i,f.min),l=Math.max(l,f.max),e=!0)}return e?{min:i,max:l}:null}},n.du=Bw,n.dv=Rg,n.dw=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},n.dx=X,n.dy=function(r,e){var i=Math.sin(e),l=Math.cos(e);return r[0]=l,r[1]=i,r[2]=0,r[3]=-i,r[4]=l,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},n.dz=pr,n.e=js,n.e$=KE,n.e0=256,n.e1=Vv,n.e2=Ao,n.e3=tt,n.e4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},n.e5=Pa,n.e6=Nh,n.e7=J_,n.e8=function(r,e,i,l,h){return de((r-e)/(i-e)*(h-l)+l,l,h)},n.e9=Ci,n.eA=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},n.eB=Ze,n.eC=j,n.eD=Fs,n.eE=function(r,e,i,l){return r[0]=e,r[1]=i,r[2]=l,r},n.eF=function([r,e,i]){const l=Math.hypot(r,e,i),h=Math.atan2(r,i),f=.5*Math.PI-Math.acos(-e/l);return new K(Ne(h),Ne(f))},n.eG=Nt,n.eH=L0,n.eI=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(rs==null){const l=i.navigator?i.navigator.userAgent:null;rs=!!i.safari||!(!l||!(/\b(iPad|iPhone|iPod)\b/.test(l)||l.match("Safari")&&!l.match("Chrome")))}return rs}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.eJ=function(r,e){so=r,Go=e},n.eK=jv,n.eL=Aw,n.eM=function(r){const e=[0,0,0],i=pe(new Float64Array(16));return Ie(i,r.pixelMatrix,r.globeMatrix),fn(e,e,i),new _t(e[0],e[1])},n.eN=function(){const r=rm;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(n0),rm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.eO=function(){Hg().acquire(n0)},n.eP=cc,n.eQ=function(r,e,i=!1){if(cr===Ar.deferred||cr===Ar.loading||cr===Ar.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Jo=no.resolveURL(r),cr=Ar.deferred,Ep=e,pd(),i||lg()},n.eR=function(r){Fd=no.resolveURL(r),Bd||(Bd=new kd(Hg(),new sl)),Bd.broadcast("setMeshoptUrl",Fd)},n.eS=LT,n.eT=function(r){r0=no.resolveURL(r),Bd||(Bd=new kd(Hg(),new sl)),Bd.broadcast("setDracoUrl",r0)},n.eU=RT,n.eV=sm,n.eW=function(r){const e=Qa();if(!e)return;const i=e.delete($o);r&&i.then(()=>r()).catch(r)},n.eX=Qh,n.eY=Ct,n.eZ=Sc,n.e_=sa,n.ea=function(r,e){var i=e[0],l=e[1],h=e[2],f=e[3],p=e[4],x=e[5],w=e[6],T=e[7],I=e[8],C=I*p-x*T,M=-I*f+x*w,L=T*f-p*w,O=i*C+l*M+h*L;return O?(r[0]=C*(O=1/O),r[1]=(-I*l+h*T)*O,r[2]=(x*l-h*p)*O,r[3]=M*O,r[4]=(I*i-h*w)*O,r[5]=(-x*i+h*f)*O,r[6]=L*O,r[7]=(-T*i+l*w)*O,r[8]=(p*i-l*f)*O,r):null},n.eb=Is,n.ec=st,n.ed=z0,n.ee=function(r,e){if(r===e){var i=e[1],l=e[2],h=e[3],f=e[6],p=e[7],x=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=l,r[9]=f,r[11]=e[14],r[12]=h,r[13]=p,r[14]=x}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},n.ef=jt,n.eg=[1,1,1],n.eh=class{constructor(r,e,i,l){this.context=r,this.format=l,this.size=i,this.texture=r.gl.createTexture();const[h,f,p]=this.size,{gl:x}=r;x.bindTexture(x.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),x.texImage3D(x.TEXTURE_3D,0,this.format,h,f,p,0,M0(this.format),P0(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:l}=i;l.bindTexture(l.TEXTURE_3D,this.texture),r!==this.minFilter&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MAG_FILTER,r),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_S,e),l.texParameteri(l.TEXTURE_3D,l.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},n.ei=Hd,n.ej=function(r,e,i,l){var h=new B(4);return h[0]=r,h[1]=e,h[2]=i,h[3]=l,h},n.ek=Rt,n.el=function(r,e,i,l){var h=e[0],f=e[1],p=e[2],x=e[3];return r[0]=h+l*(i[0]-h),r[1]=f+l*(i[1]-f),r[2]=p+l*(i[2]-p),r[3]=x+l*(i[3]-x),r},n.em=Gd,n.en=Ma,n.eo=vl,n.ep=function(r,e,i,l,h,f,p,x,w,T,I,C,M,L,O,V){var $=new B(16);return $[0]=r,$[1]=e,$[2]=i,$[3]=l,$[4]=h,$[5]=f,$[6]=p,$[7]=x,$[8]=w,$[9]=T,$[10]=I,$[11]=C,$[12]=M,$[13]=L,$[14]=O,$[15]=V,$},n.eq=H,n.er=Td,n.es=Fp,n.et=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new _t(1/0,1/0),max:new _t(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=nT(new _t(0,0),new _t(yt,yt),r),l=[];if(e&&!Jv(i,this._globalClipBounds))return l;for(const h of this._activeRegions){if(h.hiddenByOverlap||!Jv(i,h))continue;const f=zD(h.min,h.max,r);l.push({min:f.min,max:f.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return l}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const l of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(l).buckets[e.layer];h&&h.updateFootprints(l.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),l=r.getClipMask(),h=r.getClipScope();for(const f of e){if(!f.footprint)continue;const p=nT(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:p.min,max:p.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:l,clipScope:h})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ug(e.min,i.min)||Ug(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(l,h){const f=(p,x)=>p+x;return l.length-h.length||l.reduce(f,"").localeCompare(h.reduce(f,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],l=this._prevRegions[e];r=i.priority!==l.priority||!iT(i,l)||i.order!==l.order||i.clipMask!==l.clipMask||!jo(i.clipScope,l.clipScope),++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==Vg&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const l=this._activeRegions;if(i>=l.length)return i;const h=l[i].priority;for(;i<l.length&&l[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,l=e(i);for(;i!==l;){let h=i;const f=i;for(;h!==l;){const p=this._activeRegions[h];p.hiddenByOverlap=!1;for(let x=0;x<f;x++){const w=this._activeRegions[x];if(!w.hiddenByOverlap&&p.order===Vg&&Jv(p,w)&&(p.hiddenByOverlap=rT(p.footprint,p.tileId,w.footprint,w.tileId),p.hiddenByOverlap))break}++h}i=l,l=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},n.eu=Vg,n.ev=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new ea,l=new Gs,h=[],f=r+1+2,p=e[0]+1,x=e[0]+1+(1+e.length),w=(T,I,C)=>{let M=T===f-1?T-2:T===0?T:T-1;return M+=C?24575:0,[M,I]};for(let T=0;T<f;++T)i.emplaceBack(...w(T,0,!0));for(let T=0;T<p;++T)for(let I=0;I<f;++I)i.emplaceBack(...w(I,T,(I===0||I===f-1)&&!0));for(let T=0;T<e.length;++T){const I=e[T];for(let C=0;C<f;++C)i.emplaceBack(...w(C,I,!0))}for(let T=0;T<e.length;++T){const I=l.length,C=e[T]+1+2,M=new Gs;for(let V=0;V<C-1;V++){const $=V===C-2,W=$?f*(x-e.length+T-V):f;for(let Q=0;Q<f-1;Q++){const ee=V*f+Q;V===0||$||Q===0||Q===f-2?(M.emplaceBack(ee+1,ee,ee+W),M.emplaceBack(ee+W,ee+W+1,ee+1)):(l.emplaceBack(ee+1,ee,ee+W),l.emplaceBack(ee+W,ee+W+1,ee+1))}}const L=ts.simpleSegment(0,I,i.length,l.length-I);for(let V=0;V<M.uint16.length;V+=3)l.emplaceBack(M.uint16[V],M.uint16[V+1],M.uint16[V+2]);const O=ts.simpleSegment(0,I,i.length,l.length-I);h.push({withoutSkirts:L,withSkirts:O})}return{vertices:i,indices:l,segments:h}}_createGrid(r){const e=this._fillGridMeshWithLods(D,k);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,xw.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new Gs;for(let p=0;p<=D;p++)e.emplaceBack(0,p+1,p+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Pa,l=new Pa,h=new Pa,f=new Pa;this._poleSegments=[];for(let p=0,x=0;p<S;p++){const w=360/(1<<p);i.emplaceBack(0,-v,0,.5,0),l.emplaceBack(0,-v,0,.5,1),h.emplaceBack(0,-v,0,.5,.5),f.emplaceBack(0,-v,0,.5,.5);for(let T=0;T<=D;T++){let I=T/D,C=0;const M=ri(0,w,I),[L,O,V]=G(sD,rD,M,v);i.emplaceBack(L,O,V,I,C),l.emplaceBack(L,O,V,I,1-C);const $=Yi(M);I=.5+.5*Math.sin($),C=.5+.5*Math.cos($),h.emplaceBack(L,O,V,I,C),f.emplaceBack(L,O,V,I,1-C)}this._poleSegments.push(ts.simpleSegment(x,0,66,64)),x+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Dg,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(l,Dg,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,Dg,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(f,Dg,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},n.ew=le,n.ex=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.ey=xe,n.ez=De,n.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},n.f0=JE,n.f1=$T,n.f2=Oi,n.f3="hd_road_elevation",n.f4=Br,n.f5=Bt,n.f6=Kh,n.f7=y0,n.f8=eu,n.f9=function(r,e,i,l,h,f,p,x=1,w,T,I){r.createArrays(),r.tilePixelRatio=yt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const C=r.layers[0].layout,M=r.layers[0]._unevaluatedLayout._values,L={};L.scaleFactor=x,L.textSizeScaleRange=C.get("text-size-scale-range"),L.iconSizeScaleRange=C.get("icon-size-scale-range");const[O,V]=L.textSizeScaleRange,[$,W]=L.iconSizeScaleRange;L.textScaleFactor=de(L.scaleFactor,O,V),L.iconScaleFactor=de(L.scaleFactor,$,W);const Q=M["text-size"],ee=M["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:ge,maxZoom:be}=r.textSizeData;L.compositeTextSizes=[Q.possiblyEvaluate(new gn(ge,{worldview:I}),f),Q.possiblyEvaluate(new gn(be,{worldview:I}),f)]}if(r.iconSizeData.kind==="composite"){const{minZoom:ge,maxZoom:be}=r.iconSizeData;L.compositeIconSizes=[ee.possiblyEvaluate(new gn(ge,{worldview:I}),f),ee.possiblyEvaluate(new gn(be,{worldview:I}),f)]}L.layoutTextSize=Q.possiblyEvaluate(new gn(p+1,{worldview:I}),f),L.layoutIconSize=ee.possiblyEvaluate(new gn(p+1,{worldview:I}),f),L.textMaxSize=Q.possiblyEvaluate(new gn(18,{worldview:I}),f);const U=C.get("symbol-placement"),Y=C.get("text-rotation-alignment")==="map"&&U!=="point",te=C.get("text-size");let oe=!1;const ve=[];for(const ge of r.features){const be=C.get("text-font").evaluate(ge,{},f).join(","),Me=te.evaluate(ge,{},f)*L.textScaleFactor,$e=L.layoutTextSize.evaluate(ge,{},f)*L.textScaleFactor,ot=L.layoutIconSize.evaluate(ge,{},f)*L.iconScaleFactor,Qe={horizontal:{},vertical:void 0},rt=ge.text;let at,He=[0,0];if(rt){const oi=rt.toString(),wi=C.get("text-letter-spacing").evaluate(ge,{},f)*Vs,bi=C.get("text-line-height").evaluate(ge,{},f)*Vs,Ri=Ev(oi)?wi:0,Ai=C.get("text-anchor").evaluate(ge,{},f),Li=C.get("text-variable-anchor");if(!Li){const We=C.get("text-radial-offset").evaluate(ge,{},f);if(We)He=IS(Ai,[We*Vs,v0]);else{const pt=C.get("text-offset").evaluate(ge,{},f);He=[pt[0]*Vs,pt[1]*Vs]}}let ln=Y?"center":C.get("text-justify").evaluate(ge,{},f);const Mn=U==="point",ne=Mn?C.get("text-max-width").evaluate(ge,{},f)*Vs:1/0,ae=We=>{r.allowVerticalPlacement&&Dh(oi)&&(Qe.vertical=m0(rt,e,i,h,be,ne,bi,Ai,We,Ri,He,Nr.vertical,!0,$e,Me,w))};if(!Y&&Li){const We=ln==="auto"?Li.map(wt=>b0(wt)):[ln];let pt=!1;for(let wt=0;wt<We.length;wt++){const vt=We[wt];if(!Qe.horizontal[vt])if(pt)Qe.horizontal[vt]=Qe.horizontal[0];else{const Dt=m0(rt,e,i,h,be,ne,bi,"center",vt,Ri,He,Nr.horizontal,!1,$e,Me,w);Dt&&(Qe.horizontal[vt]=Dt,pt=Dt.positionedLines.length===1)}}ae("left")}else{if(ln==="auto"&&(ln=b0(Ai)),Mn||C.get("text-writing-mode").indexOf("horizontal")>=0||!Dh(oi)){const We=m0(rt,e,i,h,be,ne,bi,Ai,ln,Ri,He,Nr.horizontal,!1,$e,Me,w);We&&(Qe.horizontal[ln]=We)}ae(Mn?"left":ln)}}let nt,Ue,Ge,ht,dt,Yt,Ot=!1;const bt=C.get("icon-text-fit").evaluate(ge,{},f);if(ge.icon&&ge.icon.hasPrimary()){const oi=MS(ge.icon,r.iconSizeData,M["icon-size"],f,r.zoom,ge,w,L.iconScaleFactor,I);nt=oi.iconPrimary,Ge=oi.iconSecondary;const wi=nt.toString();if(Ue=l.get(wi),Ue&&(dt=C.get("icon-offset").evaluate(ge,{},f),Yt=C.get("icon-anchor").evaluate(ge,{},f),at=CR(h.get(wi),Ge?h.get(Ge.toString()):void 0,dt,Yt),Ot=Ue.sdf,r.sdfIcons===void 0?r.sdfIcons=Ue.sdf:r.sdfIcons!==Ue.sdf&&Si("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ue.pixelRatio!==r.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),Ge){const bi=Ge.toString();ht=l.get(bi)}}oe=oe||!(!ge.icon||!ge.icon.hasSecondary());const ct=w0(Qe.horizontal)||Qe.vertical;r.iconsInText||(r.iconsInText=!!ct&&ct.iconsInText);const di=$e*L.textScaleFactor/Vs,{defaultShapedIcon:Lt,verticallyShapedIcon:Ft}=BR(r,at,C,ge,f,Qe,di,dt,bt);bt!=="none"&&at&&(uS(at)||dS(at))&&(ey(0,Ue,nt,at,Lt,bt,T,l,h),ey(0,ht,Ge,at,Lt,bt,T,l,h),Ft&&(ey(0,Ue,nt,at,Ft,bt,T,l,h),ey(0,ht,Ge,at,Ft,bt,T,l,h))),at=Lt,ve.push({feature:ge,shapedTextOrientations:Qe,shapedText:ct,shapedIcon:at,iconPrimary:nt,iconSecondary:Ge,iconOffset:dt,iconAnchor:Yt,verticallyShapedIcon:Ft,layoutTextSize:$e,layoutIconSize:ot,textOffset:He,isSDFIcon:Ot,iconTextFit:bt})}return{featureData:ve,sizes:L,hasAnySecondaryIcon:oe,textAlongLine:Y,symbolPlacement:U}},n.fa=bS,n.fb=function(r,e,i,l,h,f,p,x,w,T){const{featureData:I,hasAnySecondaryIcon:C,sizes:M,textAlongLine:L,symbolPlacement:O}=e;for(const V of I){const{shapedIcon:$,verticallyShapedIcon:W,feature:Q,shapedTextOrientations:ee,shapedText:U,layoutTextSize:Y,textOffset:te,isSDFIcon:oe,iconPrimary:ve,iconSecondary:ge,iconTextFit:be,iconOffset:Me}=V;PS($,T.iconPositions,ve,ge),PS(W,T.iconPositions,ve,ge),FR(ee,T.iconPositions),kR(ve,ge,T.iconPositions),(U||$)&&NR(r,Q,ee,$,W,w,M,Y,0,te,oe,l,h,p,x,C,be,Me,L,O)}i&&r.generateCollisionDebugBuffers(f,r.collisionBoxArray,M.textScaleFactor)},n.fc=Mi,n.fd=Sy,n.fe=Ka,n.ff=vi,n.fg=nS,n.fh=fa,n.fi=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==OT){const i=new Uint32Array(r,0,7),[,,l,h,f,p]=i;e=i.byteLength+h+f+p+f,(l!==r.byteLength||e>=r.byteLength)&&Si("Invalid b3dm header information.")}return NT(r,e)},n.fj=function(r,e){const i=YE(r);for(const l of i){for(const h of l.meshes)lz(h);l.lights&&(l.lightMeshIndex=l.meshes.length,l.meshes.push(cz(l.lights,e)))}return i},n.fk=yy,n.fl=hn,n.fm=PT,n.fn=Qo,n.fo=Ar,n.fp=function(r){Ul(),To?.then(e=>{e.keys().then(i=>{for(let l=0;l<i.length-r;l++)e.delete(i[l]).catch(h=>Si(h.message))}).catch(i=>Si(i.message))}).catch(e=>Si(e.message))},n.g=function(r,e){return $l(Fe(r,{method:"GET"}),e)},n.h=Fe,n.i=function(r){return js.API_STYLE_REGEX.test(r)&&!Ru(r)},n.j=function(r){return r.indexOf("mapbox:")===0},n.k=pa,n.l=$f,n.m=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},n.n=function(r,e){return $l(Fe(r,{type:"json"}),e)},n.o=Gf,n.p=function(r,e){return $l(Fe(r,{method:"POST"}),e)},n.q=no,n.r=Zs,n.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=Ou,n.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},n.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},n.w=Si,n.x=function(){return s0||(s0=new Qh),s0},n.y=G0,n.z=Nu}),b(["./shared"],function(n){function R(Ne){const q=Ne?Ne.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function B(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let J="[";for(const le of Ne)J+=`${B(le)},`;return`${J}]`}let q="{";for(const J of Object.keys(Ne).sort())q+=`${J}:${B(Ne[J])},`;return`${q}}`}function N(Ne){let q="";for(const J of n.bu)q+=`/${B(Ne[J])}`;return q}class X{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,J){this._layerConfigs={},this._layers={},this.update(q,[],J)}update(q,J,le){this._options=le;for(const de of q)this._layerConfigs[de.id]=de,(this._layers[de.id]=n.db(de,this.scope,null,this._options)).compileFilter(le),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of J)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const xe=function(de,Se){const ke={};for(let Fe=0;Fe<de.length;Fe++){const et=de[Fe];let Ve=Se&&Se[et.id];Ve||(et.type==="symbol"?Ve=et.id:(Ve=N(et),et.type==="line"&&et.paint&&function kt(Bt){return typeof Bt=="string"&&Bt==="line-progress"||(Array.isArray(Bt)?Bt.some(kt):!(!Bt||typeof Bt!="object")&&Object.values(Bt).some(kt))}(et.paint["line-width"])&&(Ve+=`/${B(et.paint["line-width"])}`))),Se&&(Se[et.id]=Ve);let mt=ke[Ve];mt||(mt=ke[Ve]=[]),mt.push(et)}const Ee=[];for(const Fe in ke)Ee.push(ke[Fe]);return Ee}(Object.values(this._layerConfigs),this.keyCache);for(const de of xe){const Se=de.map(mt=>this._layers[mt.id]),ke=Se[0];if(ke.visibility==="none")continue;const Ee=ke.source||"";let Fe=this.familiesBySource[Ee];Fe||(Fe=this.familiesBySource[Ee]={});const et=ke.sourceLayer||"_geojsonTileLayer";let Ve=Fe[et];Ve||(Ve=Fe[et]=[]),Ve.push(Se)}}}const ie=1*n.e_;class se{constructor(q){const J={},le=[];for(const ke in q){const Ee=q[ke],Fe=J[ke]={};for(const et in Ee.glyphs){const Ve=Ee.glyphs[+et];if(!Ve||Ve.bitmap.width===0||Ve.bitmap.height===0)continue;const mt=Ve.metrics.localGlyph?ie:1,kt={x:0,y:0,w:Ve.bitmap.width+2*mt,h:Ve.bitmap.height+2*mt};le.push(kt),Fe[et]=kt}}const{w:xe,h:de}=n.H(le),Se=new n.eZ({width:xe||1,height:de||1});for(const ke in q){const Ee=q[ke];for(const Fe in Ee.glyphs){const et=Ee.glyphs[+Fe];if(!et||et.bitmap.width===0||et.bitmap.height===0)continue;const Ve=J[ke][Fe],mt=et.metrics.localGlyph?ie:1;n.eZ.copy(et.bitmap,Se,{x:0,y:0},{x:Ve.x+mt,y:Ve.y+mt},et.bitmap)}}this.image=Se,this.positions=J}}n.eY(se,"GlyphAtlas");class we{constructor(q){this.tileID=new n.aM(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.lut=q.lut,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.request&&q.request.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=n.aW(q.tileID.canonical,q.projection),this.projection=q.projection,this.worldview=q.worldview,this.localizableLayerIds=q.localizableLayerIds,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster,this.tessellationStep=q.tessellationStep,this.scaleFactor=q.scaleFactor,this.worldview=q.worldview}parse(q,J,le,xe,de,Se){this.status="parsing",this.data=q,this.collisionBoxArray=new n.b0;const ke=new n.e$(Object.keys(q.layers).sort()),Ee=new n.f0(this.tileID,this.promoteId);Ee.bucketLayerIDs=[];const Fe={},et=new n.f1(256,256),Ve={featureIndex:Ee,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:et,availableImages:le,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},mt=[],kt=J.familiesBySource[this.source];for(const li in kt){const ui=q.layers[li];if(!ui)continue;let mi=!1,zi=!1,Si=!1;for(const hn of kt[li])hn[0].type==="symbol"?mi=!0:zi=!0,hn[0].is3D()&&hn[0].type!=="model"&&(Si=!0);if(this.extraShadowCaster&&!Si||this.isSymbolTile===!0&&!mi||this.isSymbolTile===!1&&!zi)continue;ui.version===1&&n.w(`Vector tile source "${this.source}" layer "${li}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const bn=ke.encode(li),Fn=[];let Bn=!1;for(let hn=0,Ji=0;hn<ui.length;hn++){const rs=ui.feature(hn),Yn=Ee.getId(rs,li);if(this.localizableLayerIds&&this.localizableLayerIds.has(li)){const Wn=rs.properties?rs.properties.worldview:null;if(this.worldview&&typeof Wn=="string")if(Wn==="all")rs.properties.$localized=!0;else{if(!Wn.split(",").includes(this.worldview))continue;rs.properties.$localized=!0,rs.properties.worldview=this.worldview}}!Bn&&rs.properties&&rs.properties.hasOwnProperty(n.f2)&&(Bn=!0),Fn.push({feature:rs,id:Yn,index:Ji,sourceLayerIndex:bn}),Ji++}Bn&&!Ve.elevationFeatures&&q.layers.hasOwnProperty(n.f3)&&(Ve.elevationFeatures=n.f4.parseFrom(q.layers[n.f3],this.canonical));for(const hn of kt[li]){const Ji=hn[0];if(this.extraShadowCaster&&(!Ji.is3D()||Ji.type==="model")||this.isSymbolTile!==void 0&&Ji.type==="symbol"!==this.isSymbolTile||Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility==="none")continue;pe(hn,this.zoom,Ve.brightness,le,this.worldview);const rs=Fe[Ji.id]=Ji.createBucket({index:Ee.bucketLayerIDs.length,layers:hn,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:bn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:xe,worldview:this.worldview});Ee.bucketLayerIDs.push(hn.map(Wn=>n.C(Wn.id,Wn.scope)));let Yn=rs.prepare?rs.prepare():null;Yn!=null?(Yn=Yn.then(()=>rs.populate(Fn,Ve,this.tileID.canonical,this.tileTransform)),mt.push(Yn)):rs.populate(Fn,Ve,this.tileID.canonical,this.tileTransform)}}const Bt=()=>{let li,ui,mi,zi,Si,bn;et.trim();const Fn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Bn=()=>{if(li)return this.status="done",Se(li);if(this.extraShadowCaster)this.status="done",Se(null,{buckets:Object.values(Fe).filter(Ji=>!Ji.isEmpty()),featureIndex:Ee,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ve.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(ui&&mi&&zi){const Ji=new se(ui),rs=new Map;for(const[Bs,mr]of mi.entries()){const{imagePosition:er}=n.f7(Bs,mr,n.f8);rs.set(Bs,er)}const Yn={};for(const Bs in Fe){const mr=Fe[Bs];mr instanceof n.b1&&(pe(mr.layers,this.zoom,Ve.brightness,le,this.worldview),Yn[Bs]=n.f9(mr,ui,Ji.positions,mi,rs,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Si,this.worldview))}const Wn={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(de,mi,Si,()=>{Wn.iconsPending=!1,hn(Yn,Ji,Wn)}),this.rasterizeIfNeeded(de,zi,bn,()=>{Wn.patternsPending=!1,hn(Yn,Ji,Wn)})}},hn=(Ji,rs,Yn,Wn)=>{if(Yn.iconsPending||Yn.patternsPending)return;const Bs=new n.fa(mi,zi,this.lut);for(const mr in Fe){const er=Fe[mr];if(mr in Ji)n.fb(er,Ji[mr],this.showCollisionBoxes,le,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,mi,Bs);else if(er.hasPattern&&(er instanceof n.b7||er instanceof n.b8||er instanceof n.dU)){pe(er.layers,this.zoom,Ve.brightness,le,this.worldview);const eh=Object.fromEntries(Bs.patternPositions);er.addFeatures(Ve,this.tileID.canonical,eh,le,this.tileTransform,this.brightness)}}this.status="done",Se(null,{buckets:Object.values(Fe).filter(mr=>!mr.isEmpty()),featureIndex:Ee,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:rs.image,lineAtlas:et,imageAtlas:Bs,brightness:Ve.brightness})};if(!this.extraShadowCaster){const Ji=n.f5(Ve.glyphDependencies,Wn=>Object.keys(Wn).map(Number));Object.keys(Ji).length?de.send("getGlyphs",{uid:this.uid,stacks:Ji,scope:this.scope},(Wn,Bs)=>{li||(li=Wn,ui=Bs,Bn())},void 0,!1,Fn):ui={};const rs=Array.from(Ve.iconDependencies.keys()).map(Wn=>n.I.parse(Wn));rs.length?de.send("getImages",{images:rs,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Wn,Bs)=>{li||(li=Wn,mi=new Map,Si=this.updateImageMapAndGetImageTaskQueue(mi,Bs,Ve.iconDependencies),Bn())},void 0,!1,Fn):(mi=new Map,Si=new Map);const Yn=Array.from(Ve.patternDependencies.keys()).map(Wn=>n.I.parse(Wn));Yn.length?de.send("getImages",{images:Yn,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Wn,Bs)=>{li||(li=Wn,zi=new Map,bn=this.updateImageMapAndGetImageTaskQueue(zi,Bs,Ve.patternDependencies),Bn())},void 0,!1,Fn):(zi=new Map,bn=new Map)}if(Ve.elevationFeatures&&Ve.elevationFeatures.length>0){const Ji=[];for(const Yn of Object.values(Fe))if(Yn instanceof n.b8){const Wn=Yn.getUnevaluatedPortalGraph();Wn&&Ji.push(Wn)}const rs=n.f6.evaluate(Ji);for(const Yn of Object.values(Fe))if(Yn instanceof n.b8){const Wn=q.layers[ke.decode(Yn.sourceLayerIndex)];Yn.setEvaluatedPortalGraph(rs,Wn,this.tileID.canonical,Ve.availableImages,Ve.brightness)}}Bn()};mt.length>0?Promise.allSettled(mt).then(Bt).catch(Se):Bt()}rasterizeIfNeeded(q,J,le,xe){Array.from(J.values()).some(de=>de.usvg)?this.rasterize(q,J,le,xe):xe()}updateImageMapAndGetImageTaskQueue(q,J,le){const xe=new Map;for(const de of J.keys()){const Se=le.get(de)||[];for(const ke of Se){const Ee=ke.toString(),Fe=J.get(ke.id.toString());Fe.usvg?xe.has(Ee)||(xe.set(Ee,ke),q.set(Ee,Object.assign({},Fe))):q.set(Ee,Fe)}}return xe}rasterize(q,J,le,xe){this.rasterizeTask=q.send("rasterizeImages",{scope:this.scope,tasks:le},(de,Se)=>{if(!de)for(const[ke,Ee]of Se.entries()){const Fe=Object.assign(J.get(ke),{data:Ee});J.set(ke,Fe)}xe()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function pe(Ne,q,J,le,xe){const de=new n.aa(q,{brightness:J,worldview:xe});for(const Se of Ne)Se.recalculate(de,le)}class Ae extends n.E{constructor(q,J,le,xe,de,Se,ke){super(),this.actor=q,this.layerIndex=J,this.availableImages=le,this.availableModels=xe,this.loadVectorData=Se||n.aJ,this.loading={},this.loaded={},this.deduped=new n.aI(q.scheduler),this.isSpriteLoaded=de,this.scheduler=q.scheduler,this.brightness=ke}loadTile(q,J){const le=q.uid,xe=q&&q.request,de=xe&&xe.collectResourceTiming,Se=this.loading[le]=new we(q);Se.abort=this.loadVectorData(q,(ke,Ee)=>{const Fe=!this.loading[le];if(delete this.loading[le],Se.cancelRasterize(),Fe||ke||!Ee)return Se.status="done",Fe||(this.loaded[le]=Se),J(ke);const et=Ee.rawData,Ve={};Ee.expires&&(Ve.expires=Ee.expires),Ee.cacheControl&&(Ve.cacheControl=Ee.cacheControl),Se.vectorTile=Ee.vectorTile||new n.fc.VectorTile(new n.bq(et));const mt=()=>{Se.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(kt,Bt)=>{if(kt||!Bt)return J(kt);const li={};if(de){const ui=R(xe);ui.length>0&&(li.resourceTiming=JSON.parse(JSON.stringify(ui)))}J(null,n.h({rawTileData:et.slice(0)},Bt,Ve,li))})};this.isSpriteLoaded?mt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(mt,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):mt()}),this.loaded=this.loaded||{},this.loaded[le]=Se})}reloadTile(q,J){const le=this.loaded,xe=q.uid;if(le&&le[xe]){const de=le[xe];de.scaleFactor=q.scaleFactor,de.showCollisionBoxes=q.showCollisionBoxes,de.projection=q.projection,de.brightness=q.brightness,de.tileTransform=n.aW(q.tileID.canonical,q.projection),de.extraShadowCaster=q.extraShadowCaster,de.lut=q.lut,de.worldview=q.worldview;const Se=(ke,Ee)=>{const Fe=de.reloadCallback;Fe&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Fe)),J(ke,Ee)};de.status==="parsing"?de.reloadCallback=Se:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Se):Se())}else J(null,void 0)}abortTile(q,J){const le=q.uid,xe=this.loading[le];xe&&(xe.abort&&xe.abort(),delete this.loading[le]),J()}removeTile(q,J){const le=this.loaded,xe=q.uid;le&&le[xe]&&delete le[xe],J()}}class Ie{loadTile(q,J){const{uid:le,encoding:xe,rawImageData:de,padding:Se}=q,ke=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,Se):de;J(null,new n.fd(le,ke,xe,Se<1))}reloadTile(q,J){J(null,null)}abortTile(q,J){J()}removeTile(q,J){J()}getImageData(q,J){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const le=this.offscreenCanvasContext.getImageData(-J,-J,q.width+2*J,q.height+2*J);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),le}}n.bp.setPbf(n.bq);class Je{constructor(q){this._mrt=new n.bp(q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=q.uid,this.tileID=q.tileID,this.source=q.source}parse(q,J){const le=this._mrt;this.status="parsing",this._entireBuffer=q;try{le.parseHeader(q),this._isHeaderLoaded=!0;const xe=[];for(const de in le.layers){const Se=le.getLayer(de),ke=Se.getDataRange(Se.getBandList()),Ee=le.createDecodingTask(ke),Fe=q.slice(ke.firstByte,ke.lastByte+1),et=n.bp.performDecoding(Fe,Ee).then(Ve=>Ee.complete(null,Ve)).catch(Ve=>Ee.complete(Ve,null));xe.push(et)}Promise.allSettled(xe).then(()=>J(null,le)).catch(de=>J(de))}catch(xe){J(xe)}}}class Pe{constructor(q){this.actor=q,this.loading={},this.loaded={}}loadTile(q,J){const le=q.uid,xe=q.request,de=this.loading[le]=new Je(q),{cancel:Se}=n.br(xe,(ke,Ee,Fe,et)=>{const Ve=!this.loading[le];if(delete this.loading[le],Ve||ke||!Ee)return de.status="done",Ve||(this.loaded[le]=de),J(ke);de.parse(Ee,(mt,kt)=>{if(mt||!kt)return J(mt);J(null,kt,Fe,et)}),this.loaded[le]=de});de.abort=Se}reloadTile(q,J){J(null,void 0)}abortTile(q,J){const le=q.uid,xe=this.loading[le];xe&&(xe.abort&&xe.abort(),delete this.loading[le]),J()}removeTile(q,J){const le=q.uid;this.loaded[le]&&delete this.loaded[le],J()}decodeRasterArray(q,J){n.bp.performDecoding(q.buffer,q.task).then(le=>J(null,le)).catch(le=>J(le))}}const Oe=n.fc.VectorTileFeature.prototype.toGeoJSON;class tt{constructor(q){this._feature=q,this.extent=n.aj,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){const q=[];for(const J of this._feature.geometry)q.push([new n.P(J[0],J[1])]);return q}{const q=[];for(const J of this._feature.geometry){const le=[];for(const xe of J)le.push(new n.P(xe[0],xe[1]));q.push(le)}return q}}toGeoJSON(q,J,le){return Oe.call(this,q,J,le)}}class xt{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=n.aj,this.length=q.length,this._features=q}feature(q){return new tt(this._features[q])}}class Tt{constructor(q,J){this.name=q,this.extent=n.aj,this.length=J.length,this._features=J}feature(q){return new tt(this._features[q])}}class At extends xt{constructor(q){super([]),this.layers={};for(const J in q)this.layers[J]=new Tt(J,q[J])}}const Wt=64/4096,Zt=128;class jt{constructor(){this.features=new Map}clear(){this.features.clear()}load(q=[],J){for(const le of q){const xe=le.id;if(xe==null)continue;let de=this.features.get(xe);de&&this.updateCache(de,J),le.geometry?(de=gi(le),this.updateCache(de,J),this.features.set(xe,de)):this.features.delete(xe),this.updateCache(de,J)}}updateCache(q,J){for(const{canonical:le,uid:xe}of Object.values(J)){const{z:de,x:Se,y:ke}=le;pi(q,Math.pow(2,de),Se,ke)&&delete J[xe]}}getTile(q,J,le){const xe=Math.pow(2,q),de=[];for(const Se of this.features.values())pi(Se,xe,J,le)&&de.push(xi(Se,xe,J,le));return{features:de}}getFeatures(){return[...this.features.values()]}}function pi({minX:Ne,minY:q,maxX:J,maxY:le},xe,de,Se){return Ne<(de+1+Wt)/xe&&q<(Se+1+Wt)/xe&&J>(de-Wt)/xe&&le>(Se-Wt)/xe}function gi(Ne){const{id:q,geometry:J,properties:le}=Ne;if(!J)return;if(J.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:xe,coordinates:de}=J,Se={id:q,type:1,geometry:[],tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},ke=Se.geometry;if(xe==="Point")_i(de,ke,Se);else if(xe==="MultiPoint")for(const Ee of de)_i(Ee,ke,Se);else if(xe==="LineString")Se.type=2,yi(de,ke,Se);else if(xe==="MultiLineString")Se.type=2,$t(de,ke,Se);else if(xe==="Polygon")Se.type=3,$t(de,ke,Se,!0);else{if(xe!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Se.type=3;for(const Ee of de)$t(Ee,ke,Se,!0)}return Se}function _i([Ne,q],J,le){const xe=n.aD(Ne);let de=n.aH(q);de=de<0?0:de>1?1:de,J.push(xe,de),le.minX=Math.min(le.minX,xe),le.minY=Math.min(le.minY,de),le.maxX=Math.max(le.maxX,xe),le.maxY=Math.max(le.maxY,de)}function yi(Ne,q,J,le=!1,xe=!1){const de=[];for(const Se of Ne)_i(Se,de,J);q.push(de),le&&function(Se,ke){let Ee=0;for(let Fe=0,et=Se.length,Ve=et-2;Fe<et;Ve=Fe,Fe+=2)Ee+=(Se[Fe]-Se[Ve])*(Se[Fe+1]+Se[Ve+1]);if(Ee>0===ke)for(let Fe=0,et=Se.length;Fe<et/2;Fe+=2){const Ve=Se[Fe],mt=Se[Fe+1];Se[Fe]=Se[et-2-Fe],Se[Fe+1]=Se[et-1-Fe],Se[et-2-Fe]=Ve,Se[et-1-Fe]=mt}}(de,xe)}function $t(Ne,q,J,le=!1){for(let xe=0;xe<Ne.length;xe++)yi(Ne[xe],q,J,le,xe===0)}function xi(Ne,q,J,le){const{id:xe,type:de,geometry:Se,tags:ke}=Ne,Ee=[];if(de===1)(function(Fe,et,Ve,mt,kt){for(let Bt=0;Bt<Fe.length;Bt+=2){const li=Math.round(n.aj*(Fe[Bt+0]*et-Ve)),ui=Math.round(n.aj*(Fe[Bt+1]*et-mt));kt.push([li,ui])}})(Se,q,J,le,Ee);else for(const Fe of Se)hi(Fe,q,J,le,Ee);return{id:xe,type:de,geometry:Ee,tags:ke}}function hi(Ne,q,J,le,xe){const Se=n.aj+Zt;let ke;for(let Ee=0;Ee<Ne.length-2;Ee+=2){let Fe=Math.round(n.aj*(Ne[Ee+0]*q-J)),et=Math.round(n.aj*(Ne[Ee+1]*q-le)),Ve=Math.round(n.aj*(Ne[Ee+2]*q-J)),mt=Math.round(n.aj*(Ne[Ee+3]*q-le));const kt=Ve-Fe,Bt=mt-et;Fe<-128&&Ve<-128||(Fe<-128?(et+=Math.round(Bt*((-128-Fe)/kt)),Fe=-128):Ve<-128&&(mt=et+Math.round(Bt*((-128-Fe)/kt)),Ve=-128),et<-128&&mt<-128||(et<-128?(Fe+=Math.round(kt*((-128-et)/Bt)),et=-128):mt<-128&&(Ve=Fe+Math.round(kt*((-128-et)/Bt)),mt=-128),Fe>=Se&&Ve>=Se||(Fe>=Se?(et+=Math.round(Bt*((Se-Fe)/kt)),Fe=Se):Ve>=Se&&(mt=et+Math.round(Bt*((Se-Fe)/kt)),Ve=Se),et>=Se&&mt>=Se||(et>=Se?(Fe+=Math.round(kt*((Se-et)/Bt)),et=Se):mt>=Se&&(Ve=Fe+Math.round(kt*((Se-et)/Bt)),mt=Se),ke&&Fe===ke[ke.length-1][0]&&et===ke[ke.length-1][1]||(ke=[[Fe,et]],xe.push(ke)),ke.push([Ve,mt])))))}}var sn,Ui,ss,jn={exports:{}},Fs=function(){if(ss)return jn.exports;ss=1;var Ne=n.fg(),q=function(){if(Ui)return sn;Ui=1;var et=n.fe(),Ve=n.ff().VectorTileFeature;function mt(Bt,li){this.options=li||{},this.features=Bt,this.length=Bt.length}function kt(Bt,li){this.id=typeof Bt.id=="number"?Bt.id:void 0,this.type=Bt.type,this.rawGeometry=Bt.type===1?[Bt.geometry]:Bt.geometry,this.properties=Bt.tags,this.extent=li||4096}return sn=mt,mt.prototype.feature=function(Bt){return new kt(this.features[Bt],this.options.extent)},kt.prototype.loadGeometry=function(){var Bt=this.rawGeometry;this.geometry=[];for(var li=0;li<Bt.length;li++){for(var ui=Bt[li],mi=[],zi=0;zi<ui.length;zi++)mi.push(new et(ui[zi][0],ui[zi][1]));this.geometry.push(mi)}return this.geometry},kt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Bt=this.geometry,li=1/0,ui=-1/0,mi=1/0,zi=-1/0,Si=0;Si<Bt.length;Si++)for(var bn=Bt[Si],Fn=0;Fn<bn.length;Fn++){var Bn=bn[Fn];li=Math.min(li,Bn.x),ui=Math.max(ui,Bn.x),mi=Math.min(mi,Bn.y),zi=Math.max(zi,Bn.y)}return[li,mi,ui,zi]},kt.prototype.toGeoJSON=Ve.prototype.toGeoJSON,sn}();function J(et){var Ve=new Ne;return function(mt,kt){for(var Bt in mt.layers)kt.writeMessage(3,le,mt.layers[Bt])}(et,Ve),Ve.finish()}function le(et,Ve){var mt;Ve.writeVarintField(15,et.version||1),Ve.writeStringField(1,et.name||""),Ve.writeVarintField(5,et.extent||4096);var kt={keys:[],values:[],keycache:{},valuecache:{}};for(mt=0;mt<et.length;mt++)kt.feature=et.feature(mt),Ve.writeMessage(2,xe,kt);var Bt=kt.keys;for(mt=0;mt<Bt.length;mt++)Ve.writeStringField(3,Bt[mt]);var li=kt.values;for(mt=0;mt<li.length;mt++)Ve.writeMessage(4,Fe,li[mt])}function xe(et,Ve){var mt=et.feature;mt.id!==void 0&&Ve.writeVarintField(1,mt.id),Ve.writeMessage(2,de,et),Ve.writeVarintField(3,mt.type),Ve.writeMessage(4,Ee,mt)}function de(et,Ve){var mt=et.feature,kt=et.keys,Bt=et.values,li=et.keycache,ui=et.valuecache;for(var mi in mt.properties){var zi=mt.properties[mi],Si=li[mi];if(zi!==null){Si===void 0&&(kt.push(mi),li[mi]=Si=kt.length-1),Ve.writeVarint(Si);var bn=typeof zi;bn!=="string"&&bn!=="boolean"&&bn!=="number"&&(zi=JSON.stringify(zi));var Fn=bn+":"+zi,Bn=ui[Fn];Bn===void 0&&(Bt.push(zi),ui[Fn]=Bn=Bt.length-1),Ve.writeVarint(Bn)}}}function Se(et,Ve){return(Ve<<3)+(7&et)}function ke(et){return et<<1^et>>31}function Ee(et,Ve){for(var mt=et.loadGeometry(),kt=et.type,Bt=0,li=0,ui=mt.length,mi=0;mi<ui;mi++){var zi=mt[mi],Si=1;kt===1&&(Si=zi.length),Ve.writeVarint(Se(1,Si));for(var bn=kt===3?zi.length-1:zi.length,Fn=0;Fn<bn;Fn++){Fn===1&&kt!==1&&Ve.writeVarint(Se(2,bn-1));var Bn=zi[Fn].x-Bt,hn=zi[Fn].y-li;Ve.writeVarint(ke(Bn)),Ve.writeVarint(ke(hn)),Bt+=Bn,li+=hn}kt===3&&Ve.writeVarint(Se(7,1))}}function Fe(et,Ve){var mt=typeof et;mt==="string"?Ve.writeStringField(1,et):mt==="boolean"?Ve.writeBooleanField(7,et):mt==="number"&&(et%1!=0?Ve.writeDoubleField(3,et):et<0?Ve.writeSVarintField(6,et):Ve.writeVarintField(5,et))}return jn.exports=J,jn.exports.fromVectorTileJs=J,jn.exports.fromGeojsonVt=function(et,Ve){Ve=Ve||{};var mt={};for(var kt in et)mt[kt]=new q(et[kt].features,Ve),mt[kt].name=kt,mt[kt].version=Ve.version,mt[kt].extent=Ve.extent;return J({layers:mt})},jn.exports.GeoJSONWrapper=q,jn.exports}(),Is=n.fh(Fs);const Zi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},en=Math.fround||(es=new Float32Array(1),Ne=>(es[0]=+Ne,es[0]));var es;const xs=3,fn=5,pr=6;class Ks{constructor(q){this.options=Object.assign(Object.create(Zi),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:J,minZoom:le,maxZoom:xe}=this.options;J&&console.time("total time");const de=`prepare ${q.length} points`;J&&console.time(de),this.points=q;const Se=[];for(let Ee=0;Ee<q.length;Ee++){const Fe=q[Ee];if(!Fe.geometry)continue;const[et,Ve]=Fe.geometry.coordinates,mt=en(Ze(et)),kt=en(gt(Ve));Se.push(mt,kt,1/0,Ee,-1,1),this.options.reduce&&Se.push(0)}let ke=this.trees[xe+1]=this._createTree(Se);J&&console.timeEnd(de);for(let Ee=xe;Ee>=le;Ee--){const Fe=+Date.now();ke=this.trees[Ee]=this._createTree(this._cluster(ke,Ee)),J&&console.log("z%d: %d clusters in %dms",Ee,ke.numItems,+Date.now()-Fe)}return J&&console.timeEnd("total time"),this}getClusters(q,J){let le=((q[0]+180)%360+360)%360-180;const xe=Math.max(-90,Math.min(90,q[1]));let de=q[2]===180?180:((q[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)le=-180,de=180;else if(le>de){const Ve=this.getClusters([le,xe,180,Se],J),mt=this.getClusters([-180,xe,de,Se],J);return Ve.concat(mt)}const ke=this.trees[this._limitZoom(J)],Ee=ke.range(Ze(le),gt(Se),Ze(de),gt(xe)),Fe=ke.data,et=[];for(const Ve of Ee){const mt=this.stride*Ve;et.push(Fe[mt+fn]>1?Js(Fe,mt,this.clusterProps):this.points[Fe[mt+xs]])}return et}getChildren(q){const J=this._getOriginId(q),le=this._getOriginZoom(q),xe="No cluster with the specified id.",de=this.trees[le];if(!de)throw new Error(xe);const Se=de.data;if(J*this.stride>=Se.length)throw new Error(xe);const ke=this.options.radius/(this.options.extent*Math.pow(2,le-1)),Ee=de.within(Se[J*this.stride],Se[J*this.stride+1],ke),Fe=[];for(const et of Ee){const Ve=et*this.stride;Se[Ve+4]===q&&Fe.push(Se[Ve+fn]>1?Js(Se,Ve,this.clusterProps):this.points[Se[Ve+xs]])}if(Fe.length===0)throw new Error(xe);return Fe}getLeaves(q,J,le){const xe=[];return this._appendLeaves(xe,q,J=J||10,le=le||0,0),xe}getTile(q,J,le){const xe=this.trees[this._limitZoom(q)],de=Math.pow(2,q),{extent:Se,radius:ke}=this.options,Ee=ke/Se,Fe=(le-Ee)/de,et=(le+1+Ee)/de,Ve={features:[]};return this._addTileFeatures(xe.range((J-Ee)/de,Fe,(J+1+Ee)/de,et),xe.data,J,le,de,Ve),J===0&&this._addTileFeatures(xe.range(1-Ee/de,Fe,1,et),xe.data,de,le,de,Ve),J===de-1&&this._addTileFeatures(xe.range(0,Fe,Ee/de,et),xe.data,-1,le,de,Ve),Ve.features.length?Ve:null}getClusterExpansionZoom(q){let J=this._getOriginZoom(q)-1;for(;J<=this.options.maxZoom;){const le=this.getChildren(q);if(J++,le.length!==1)break;q=le[0].properties.cluster_id}return J}_appendLeaves(q,J,le,xe,de){const Se=this.getChildren(J);for(const ke of Se){const Ee=ke.properties;if(Ee&&Ee.cluster?de+Ee.point_count<=xe?de+=Ee.point_count:de=this._appendLeaves(q,Ee.cluster_id,le,xe,de):de<xe?de++:q.push(ke),q.length===le)break}return de}_createTree(q){const J=new n.bW(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let le=0;le<q.length;le+=this.stride)J.add(q[le],q[le+1]);return J.finish(),J.data=q,J}_addTileFeatures(q,J,le,xe,de,Se){for(const ke of q){const Ee=ke*this.stride,Fe=J[Ee+fn]>1;let et,Ve,mt;if(Fe)et=Ce(J,Ee,this.clusterProps),Ve=J[Ee],mt=J[Ee+1];else{const li=this.points[J[Ee+xs]];et=li.properties;const[ui,mi]=li.geometry.coordinates;Ve=Ze(ui),mt=gt(mi)}const kt={type:1,geometry:[[Math.round(this.options.extent*(Ve*de-le)),Math.round(this.options.extent*(mt*de-xe))]],tags:et};let Bt;Bt=Fe||this.options.generateId?J[Ee+xs]:this.points[J[Ee+xs]].id,Bt!==void 0&&(kt.id=Bt),Se.features.push(kt)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,J){const{radius:le,extent:xe,reduce:de,minPoints:Se}=this.options,ke=le/(xe*Math.pow(2,J)),Ee=q.data,Fe=[],et=this.stride;for(let Ve=0;Ve<Ee.length;Ve+=et){if(Ee[Ve+2]<=J)continue;Ee[Ve+2]=J;const mt=Ee[Ve],kt=Ee[Ve+1],Bt=q.within(Ee[Ve],Ee[Ve+1],ke),li=Ee[Ve+fn];let ui=li;for(const mi of Bt){const zi=mi*et;Ee[zi+2]>J&&(ui+=Ee[zi+fn])}if(ui>li&&ui>=Se){let mi,zi=mt*li,Si=kt*li,bn=-1;const Fn=(Ve/et<<5)+(J+1)+this.points.length;for(const Bn of Bt){const hn=Bn*et;if(Ee[hn+2]<=J)continue;Ee[hn+2]=J;const Ji=Ee[hn+fn];zi+=Ee[hn]*Ji,Si+=Ee[hn+1]*Ji,Ee[hn+4]=Fn,de&&(mi||(mi=this._map(Ee,Ve,!0),bn=this.clusterProps.length,this.clusterProps.push(mi)),de(mi,this._map(Ee,hn)))}Ee[Ve+4]=Fn,Fe.push(zi/ui,Si/ui,1/0,Fn,-1,ui),de&&Fe.push(bn)}else{for(let mi=0;mi<et;mi++)Fe.push(Ee[Ve+mi]);if(ui>1)for(const mi of Bt){const zi=mi*et;if(!(Ee[zi+2]<=J)){Ee[zi+2]=J;for(let Si=0;Si<et;Si++)Fe.push(Ee[zi+Si])}}}}return Fe}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,J,le){if(q[J+fn]>1){const Se=this.clusterProps[q[J+pr]];return le?Object.assign({},Se):Se}const xe=this.points[q[J+xs]].properties,de=this.options.map(xe);return le&&de===xe?Object.assign({},de):de}}function Js(Ne,q,J){return{type:"Feature",id:Ne[q+xs],properties:Ce(Ne,q,J),geometry:{type:"Point",coordinates:[(le=Ne[q],360*(le-.5)),Rt(Ne[q+1])]}};var le}function Ce(Ne,q,J){const le=Ne[q+fn],xe=le>=1e4?`${Math.round(le/1e3)}k`:le>=1e3?Math.round(le/100)/10+"k":le,de=Ne[q+pr],Se=de===-1?{}:Object.assign({},J[de]);return Object.assign(Se,{cluster:!0,cluster_id:Ne[q+xs],point_count:le,point_count_abbreviated:xe})}function Ze(Ne){return Ne/360+.5}function gt(Ne){const q=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function Rt(Ne){const q=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function zt(Ne,q,J,le){let xe=le;const de=q+(J-q>>1);let Se,ke=J-q;const Ee=Ne[q],Fe=Ne[q+1],et=Ne[J],Ve=Ne[J+1];for(let mt=q+3;mt<J;mt+=3){const kt=Nt(Ne[mt],Ne[mt+1],Ee,Fe,et,Ve);if(kt>xe)Se=mt,xe=kt;else if(kt===xe){const Bt=Math.abs(mt-de);Bt<ke&&(Se=mt,ke=Bt)}}xe>le&&(Se-q>3&&zt(Ne,q,Se,le),Ne[Se+2]=xe,J-Se>3&&zt(Ne,Se,J,le))}function Nt(Ne,q,J,le,xe,de){let Se=xe-J,ke=de-le;if(Se!==0||ke!==0){const Ee=((Ne-J)*Se+(q-le)*ke)/(Se*Se+ke*ke);Ee>1?(J=xe,le=de):Ee>0&&(J+=Se*Ee,le+=ke*Ee)}return Se=Ne-J,ke=q-le,Se*Se+ke*ke}function Qt(Ne,q,J,le){const xe={id:Ne??null,type:q,geometry:J,tags:le,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")Gt(xe,J);else if(q==="Polygon")Gt(xe,J[0]);else if(q==="MultiLineString")for(const de of J)Gt(xe,de);else if(q==="MultiPolygon")for(const de of J)Gt(xe,de[0]);return xe}function Gt(Ne,q){for(let J=0;J<q.length;J+=3)Ne.minX=Math.min(Ne.minX,q[J]),Ne.minY=Math.min(Ne.minY,q[J+1]),Ne.maxX=Math.max(Ne.maxX,q[J]),Ne.maxY=Math.max(Ne.maxY,q[J+1])}function Kt(Ne,q,J,le){if(!q.geometry)return;const xe=q.geometry.coordinates;if(xe&&xe.length===0)return;const de=q.geometry.type,Se=Math.pow(J.tolerance/((1<<J.maxZoom)*J.extent),2);let ke=[],Ee=q.id;if(J.promoteId?Ee=q.properties[J.promoteId]:J.generateId&&(Ee=le||0),de==="Point")Vt(xe,ke);else if(de==="MultiPoint")for(const Fe of xe)Vt(Fe,ke);else if(de==="LineString")Ci(xe,ke,Se,!1);else if(de==="MultiLineString"){if(J.lineMetrics){for(const Fe of xe)ke=[],Ci(Fe,ke,Se,!1),Ne.push(Qt(Ee,"LineString",ke,q.properties));return}Jt(xe,ke,Se,!1)}else if(de==="Polygon")Jt(xe,ke,Se,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Fe of q.geometry.geometries)Kt(Ne,{id:Ee,geometry:Fe,properties:q.properties},J,le);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Fe of xe){const et=[];Jt(Fe,et,Se,!0),ke.push(et)}}Ne.push(Qt(Ee,de,ke,q.properties))}function Vt(Ne,q){q.push(Ti(Ne[0]),Vi(Ne[1]),0)}function Ci(Ne,q,J,le){let xe,de,Se=0;for(let Ee=0;Ee<Ne.length;Ee++){const Fe=Ti(Ne[Ee][0]),et=Vi(Ne[Ee][1]);q.push(Fe,et,0),Ee>0&&(Se+=le?(xe*et-Fe*de)/2:Math.sqrt(Math.pow(Fe-xe,2)+Math.pow(et-de,2))),xe=Fe,de=et}const ke=q.length-3;q[2]=1,zt(q,0,ke,J),q[ke+2]=1,q.size=Math.abs(Se),q.start=0,q.end=q.size}function Jt(Ne,q,J,le){for(let xe=0;xe<Ne.length;xe++){const de=[];Ci(Ne[xe],de,J,le),q.push(de)}}function Ti(Ne){return Ne/360+.5}function Vi(Ne){const q=Math.sin(Ne*Math.PI/180),J=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return J<0?0:J>1?1:J}function ji(Ne,q,J,le,xe,de,Se,ke){if(le/=q,de>=(J/=q)&&Se<le)return Ne;if(Se<J||de>=le)return null;const Ee=[];for(const Fe of Ne){const et=Fe.geometry;let Ve=Fe.type;const mt=xe===0?Fe.minX:Fe.minY,kt=xe===0?Fe.maxX:Fe.maxY;if(mt>=J&&kt<le){Ee.push(Fe);continue}if(kt<J||mt>=le)continue;let Bt=[];if(Ve==="Point"||Ve==="MultiPoint")$n(et,Bt,J,le,xe);else if(Ve==="LineString")wn(et,Bt,J,le,xe,!1,ke.lineMetrics);else if(Ve==="MultiLineString")Hn(et,Bt,J,le,xe,!1);else if(Ve==="Polygon")Hn(et,Bt,J,le,xe,!0);else if(Ve==="MultiPolygon")for(const li of et){const ui=[];Hn(li,ui,J,le,xe,!0),ui.length&&Bt.push(ui)}if(Bt.length){if(ke.lineMetrics&&Ve==="LineString"){for(const li of Bt)Ee.push(Qt(Fe.id,Ve,li,Fe.tags));continue}Ve!=="LineString"&&Ve!=="MultiLineString"||(Bt.length===1?(Ve="LineString",Bt=Bt[0]):Ve="MultiLineString"),Ve!=="Point"&&Ve!=="MultiPoint"||(Ve=Bt.length===3?"Point":"MultiPoint"),Ee.push(Qt(Fe.id,Ve,Bt,Fe.tags))}}return Ee.length?Ee:null}function $n(Ne,q,J,le,xe){for(let de=0;de<Ne.length;de+=3){const Se=Ne[de+xe];Se>=J&&Se<=le&&vs(q,Ne[de],Ne[de+1],Ne[de+2])}}function wn(Ne,q,J,le,xe,de,Se){let ke=zs(Ne);const Ee=xe===0?Os:wr;let Fe,et,Ve=Ne.start;for(let ui=0;ui<Ne.length-3;ui+=3){const mi=Ne[ui],zi=Ne[ui+1],Si=Ne[ui+2],bn=Ne[ui+3],Fn=Ne[ui+4],Bn=xe===0?mi:zi,hn=xe===0?bn:Fn;let Ji=!1;Se&&(Fe=Math.sqrt(Math.pow(mi-bn,2)+Math.pow(zi-Fn,2))),Bn<J?hn>J&&(et=Ee(ke,mi,zi,bn,Fn,J),Se&&(ke.start=Ve+Fe*et)):Bn>le?hn<le&&(et=Ee(ke,mi,zi,bn,Fn,le),Se&&(ke.start=Ve+Fe*et)):vs(ke,mi,zi,Si),hn<J&&Bn>=J&&(et=Ee(ke,mi,zi,bn,Fn,J),Ji=!0),hn>le&&Bn<=le&&(et=Ee(ke,mi,zi,bn,Fn,le),Ji=!0),!de&&Ji&&(Se&&(ke.end=Ve+Fe*et),q.push(ke),ke=zs(Ne)),Se&&(Ve+=Fe)}let mt=Ne.length-3;const kt=Ne[mt],Bt=Ne[mt+1],li=xe===0?kt:Bt;li>=J&&li<=le&&vs(ke,kt,Bt,Ne[mt+2]),mt=ke.length-3,de&&mt>=3&&(ke[mt]!==ke[0]||ke[mt+1]!==ke[1])&&vs(ke,ke[0],ke[1],ke[2]),ke.length&&q.push(ke)}function zs(Ne){const q=[];return q.size=Ne.size,q.start=Ne.start,q.end=Ne.end,q}function Hn(Ne,q,J,le,xe,de){for(const Se of Ne)wn(Se,q,J,le,xe,de,!1)}function vs(Ne,q,J,le){Ne.push(q,J,le)}function Os(Ne,q,J,le,xe,de){const Se=(de-q)/(le-q);return vs(Ne,de,J+(xe-J)*Se,1),Se}function wr(Ne,q,J,le,xe,de){const Se=(de-J)/(xe-J);return vs(Ne,q+(le-q)*Se,de,1),Se}function wo(Ne,q){const J=[];for(let le=0;le<Ne.length;le++){const xe=Ne[le],de=xe.type;let Se;if(de==="Point"||de==="MultiPoint"||de==="LineString")Se=Ds(xe.geometry,q);else if(de==="MultiLineString"||de==="Polygon"){Se=[];for(const ke of xe.geometry)Se.push(Ds(ke,q))}else if(de==="MultiPolygon"){Se=[];for(const ke of xe.geometry){const Ee=[];for(const Fe of ke)Ee.push(Ds(Fe,q));Se.push(Ee)}}J.push(Qt(xe.id,de,Se,xe.tags))}return J}function Ds(Ne,q){const J=[];J.size=Ne.size,Ne.start!==void 0&&(J.start=Ne.start,J.end=Ne.end);for(let le=0;le<Ne.length;le+=3)J.push(Ne[le]+q,Ne[le+1],Ne[le+2]);return J}function Qs(Ne,q){if(Ne.transformed)return Ne;const J=1<<Ne.z,le=Ne.x,xe=Ne.y;for(const de of Ne.features){const Se=de.geometry,ke=de.type;if(de.geometry=[],ke===1)for(let Ee=0;Ee<Se.length;Ee+=2)de.geometry.push(An(Se[Ee],Se[Ee+1],q,J,le,xe));else for(let Ee=0;Ee<Se.length;Ee++){const Fe=[];for(let et=0;et<Se[Ee].length;et+=2)Fe.push(An(Se[Ee][et],Se[Ee][et+1],q,J,le,xe));de.geometry.push(Fe)}}return Ne.transformed=!0,Ne}function An(Ne,q,J,le,xe,de){return[Math.round(J*(Ne*le-xe)),Math.round(J*(q*le-de))]}function fa(Ne,q,J,le,xe){const de=q===xe.maxZoom?0:xe.tolerance/((1<<q)*xe.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:J,y:le,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const ke of Ne)Vl(Se,ke,de,xe);return Se}function Vl(Ne,q,J,le){const xe=q.geometry,de=q.type,Se=[];if(Ne.minX=Math.min(Ne.minX,q.minX),Ne.minY=Math.min(Ne.minY,q.minY),Ne.maxX=Math.max(Ne.maxX,q.maxX),Ne.maxY=Math.max(Ne.maxY,q.maxY),de==="Point"||de==="MultiPoint")for(let ke=0;ke<xe.length;ke+=3)Se.push(xe[ke],xe[ke+1]),Ne.numPoints++,Ne.numSimplified++;else if(de==="LineString")Tr(Se,xe,Ne,J,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let ke=0;ke<xe.length;ke++)Tr(Se,xe[ke],Ne,J,de==="Polygon",ke===0);else if(de==="MultiPolygon")for(let ke=0;ke<xe.length;ke++){const Ee=xe[ke];for(let Fe=0;Fe<Ee.length;Fe++)Tr(Se,Ee[Fe],Ne,J,!0,Fe===0)}if(Se.length){let ke=q.tags||null;if(de==="LineString"&&le.lineMetrics){ke={};for(const Fe in q.tags)ke[Fe]=q.tags[Fe];ke.mapbox_clip_start=xe.start/xe.size,ke.mapbox_clip_end=xe.end/xe.size}const Ee={geometry:Se,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:ke};q.id!==null&&(Ee.id=q.id),Ne.features.push(Ee)}}function Tr(Ne,q,J,le,xe,de){const Se=le*le;if(le>0&&q.size<(xe?Se:le))return void(J.numPoints+=q.length/3);const ke=[];for(let Ee=0;Ee<q.length;Ee+=3)(le===0||q[Ee+2]>Se)&&(J.numSimplified++,ke.push(q[Ee],q[Ee+1])),J.numPoints++;xe&&function(Ee,Fe){let et=0;for(let Ve=0,mt=Ee.length,kt=mt-2;Ve<mt;kt=Ve,Ve+=2)et+=(Ee[Ve]-Ee[kt])*(Ee[Ve+1]+Ee[kt+1]);if(et>0===Fe)for(let Ve=0,mt=Ee.length;Ve<mt/2;Ve+=2){const kt=Ee[Ve],Bt=Ee[Ve+1];Ee[Ve]=Ee[mt-2-Ve],Ee[Ve+1]=Ee[mt-1-Ve],Ee[mt-2-Ve]=kt,Ee[mt-1-Ve]=Bt}}(ke,de),Ne.push(ke)}const Vf={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Du{constructor(q,J){const le=(J=this.options=function(de,Se){for(const ke in Se)de[ke]=Se[ke];return de}(Object.create(Vf),J)).debug;if(le&&console.time("preprocess data"),J.maxZoom<0||J.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(J.promoteId&&J.generateId)throw new Error("promoteId and generateId cannot be used together.");let xe=function(de,Se){const ke=[];if(de.type==="FeatureCollection")for(let Ee=0;Ee<de.features.length;Ee++)Kt(ke,de.features[Ee],Se,Ee);else Kt(ke,de.type==="Feature"?de:{geometry:de},Se);return ke}(q,J);this.tiles={},this.tileCoords=[],le&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",J.indexMaxZoom,J.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),xe=function(de,Se){const ke=Se.buffer/Se.extent;let Ee=de;const Fe=ji(de,1,-1-ke,ke,0,-1,2,Se),et=ji(de,1,1-ke,2+ke,0,-1,2,Se);return(Fe||et)&&(Ee=ji(de,1,-ke,1+ke,0,-1,2,Se)||[],Fe&&(Ee=wo(Fe,1).concat(Ee)),et&&(Ee=Ee.concat(wo(et,-1)))),Ee}(xe,J),xe.length&&this.splitTile(xe,0,0,0),le&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,J,le,xe,de,Se,ke){const Ee=[q,J,le,xe],Fe=this.options,et=Fe.debug;for(;Ee.length;){xe=Ee.pop(),le=Ee.pop(),J=Ee.pop(),q=Ee.pop();const Ve=1<<J,mt=Ka(J,le,xe);let kt=this.tiles[mt];if(!kt&&(et>1&&console.time("creation"),kt=this.tiles[mt]=fa(q,J,le,xe,Fe),this.tileCoords.push({z:J,x:le,y:xe}),et)){et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",J,le,xe,kt.numFeatures,kt.numPoints,kt.numSimplified),console.timeEnd("creation"));const Ji=`z${J}`;this.stats[Ji]=(this.stats[Ji]||0)+1,this.total++}if(kt.source=q,de==null){if(J===Fe.indexMaxZoom||kt.numPoints<=Fe.indexMaxPoints)continue}else{if(J===Fe.maxZoom||J===de)continue;if(de!=null){const Ji=de-J;if(le!==Se>>Ji||xe!==ke>>Ji)continue}}if(kt.source=null,q.length===0)continue;et>1&&console.time("clipping");const Bt=.5*Fe.buffer/Fe.extent,li=.5-Bt,ui=.5+Bt,mi=1+Bt;let zi=null,Si=null,bn=null,Fn=null,Bn=ji(q,Ve,le-Bt,le+ui,0,kt.minX,kt.maxX,Fe),hn=ji(q,Ve,le+li,le+mi,0,kt.minX,kt.maxX,Fe);q=null,Bn&&(zi=ji(Bn,Ve,xe-Bt,xe+ui,1,kt.minY,kt.maxY,Fe),Si=ji(Bn,Ve,xe+li,xe+mi,1,kt.minY,kt.maxY,Fe),Bn=null),hn&&(bn=ji(hn,Ve,xe-Bt,xe+ui,1,kt.minY,kt.maxY,Fe),Fn=ji(hn,Ve,xe+li,xe+mi,1,kt.minY,kt.maxY,Fe),hn=null),et>1&&console.timeEnd("clipping"),Ee.push(zi||[],J+1,2*le,2*xe),Ee.push(Si||[],J+1,2*le,2*xe+1),Ee.push(bn||[],J+1,2*le+1,2*xe),Ee.push(Fn||[],J+1,2*le+1,2*xe+1)}}getTile(q,J,le){q=+q,J=+J,le=+le;const xe=this.options,{extent:de,debug:Se}=xe;if(q<0||q>24)return null;const ke=1<<q,Ee=Ka(q,J=J+ke&ke-1,le);if(this.tiles[Ee])return Qs(this.tiles[Ee],de);Se>1&&console.log("drilling down to z%d-%d-%d",q,J,le);let Fe,et=q,Ve=J,mt=le;for(;!Fe&&et>0;)et--,Ve>>=1,mt>>=1,Fe=this.tiles[Ka(et,Ve,mt)];return Fe&&Fe.source?(Se>1&&(console.log("found parent tile z%d-%d-%d",et,Ve,mt),console.time("drilling down")),this.splitTile(Fe.source,et,Ve,mt,q,J,le),Se>1&&console.timeEnd("drilling down"),this.tiles[Ee]?Qs(this.tiles[Ee],de):null):null}}function Ka(Ne,q,J){return 32*((1<<Ne)*J+q)+Ne}function _t(Ne,q){const J=Ne.tileID.canonical;if(!this._geoJSONIndex)return void q(null,null);const le=this._geoJSONIndex.getTile(J.z,J.x,J.y);if(!le)return void q(null,null);const xe=Ee=>Ee.tags&&"3d_elevation_id"in Ee.tags&&"source"in Ee.tags&&Ee.tags.source==="elevation",de=le.features.filter(Ee=>xe(Ee));let Se;if(de.length>0){const Ee=le.features.filter(Fe=>!xe(Fe));Se=new At({_geojsonTileLayer:Ee,hd_road_elevation:de})}else Se=new xt(le.features);let ke=Is(Se);ke.byteOffset===0&&ke.byteLength===ke.buffer.byteLength||(ke=new Uint8Array(ke)),q(null,{vectorTile:Se,rawData:ke.buffer})}class jo extends Ae{constructor(q,J,le,xe,de,Se,ke){super(q,J,le,xe,de,_t,ke),Se&&(this.loadGeoJSON=Se),this._dynamicIndex=new jt}loadData(q,J){const le=q&&q.request,xe=le&&le.collectResourceTiming;this.loadGeoJSON(q,(de,Se)=>{if(de||!Se)return J(de);if(typeof Se!="object")return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{try{if(q.filter){const Ee=n.X(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(Fe=>`${Fe.key}: ${Fe.message}`).join(", "));Se.features=Se.features.filter(Fe=>Ee.value.evaluate({zoom:0},Fe))}q.dynamic?(Se.type==="Feature"&&(Se={type:"FeatureCollection",features:[Se]}),q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Se.features,this.loaded),q.cluster&&(Se.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=q.cluster?new Ks(function({superclusterOptions:Ee,clusterProperties:Fe}){if(!Fe||!Ee)return Ee;const et={},Ve={},mt={accumulated:null,zoom:0},kt={properties:null},Bt=Object.keys(Fe);for(const li of Bt){const[ui,mi]=Fe[li],zi=n.X(mi),Si=n.X(typeof ui=="string"?[ui,["accumulated"],["get",li]]:ui);et[li]=zi.value,Ve[li]=Si.value}return Ee.map=li=>{kt.properties=li;const ui={};for(const mi of Bt)ui[mi]=et[mi].evaluate(mt,kt);return ui},Ee.reduce=(li,ui)=>{kt.properties=ui;for(const mi of Bt)mt.accumulated=li[mi],li[mi]=Ve[mi].evaluate(mt,kt)},Ee}(q)).load(Se.features):q.dynamic?this._dynamicIndex:function(Ee,Fe){return new Du(Ee,Fe)}(Se,q.geojsonVtOptions)}catch(Ee){return J(Ee)}const ke={};if(xe){const Ee=R(le);Ee&&(ke.resourceTiming={},ke.resourceTiming[q.source]=JSON.parse(JSON.stringify(Ee)))}J(null,ke)}})}reloadTile(q,J){const le=this.loaded;return le&&le[q.uid]?q.partial?J(null,void 0):super.reloadTile(q,J):this.loadTile(q,J)}loadGeoJSON(q,J){if(q.request)n.n(q.request,J);else{if(typeof q.data!="string")return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return J(null,JSON.parse(q.data))}catch{return J(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,J){try{J(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(le){J(le)}}getClusterChildren(q,J){try{J(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(le){J(le)}}getClusterLeaves(q,J){try{J(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(le){J(le)}}}class Uf{constructor(q,J,le){this.tileID=new n.aM(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=J,this.worldview=le}parse(q,J,le,xe){this.status="parsing";const de=new n.aM(le.tileID.overscaledZ,le.tileID.wrap,le.tileID.canonical.z,le.tileID.canonical.x,le.tileID.canonical.y),Se=[],ke=J.familiesBySource[le.source],Ee=new n.f0(de,le.promoteId);Ee.bucketLayerIDs=[],Ee.is3DTile=!0,n.fi(q).then(Fe=>{if(!Fe)return xe(new Error("Could not parse tile"));const et=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("MAPBOX_mesh_features")||Fe.json.asset.extras&&Fe.json.asset.extras.MAPBOX_mesh_features,Ve=Fe.json.extensionsUsed&&Fe.json.extensionsUsed.includes("EXT_meshopt_compression"),mt=new n.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const kt in ke)for(const Bt of ke[kt]){const li=Bt[0];Ee.bucketLayerIDs.push(Bt.map(zi=>n.C(zi.id,zi.scope))),li.recalculate(mt,[]);const ui=n.fj(Fe,1/n.cU(le.tileID.canonical)),mi=new n.fk(Bt,ui,de,et,Ve,this.brightness,Ee,this.worldview);et||(mi.needsUpload=!0),Se.push(mi),mi.evaluate(li)}this.status="done",xe(null,{buckets:Se,featureIndex:Ee,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Fe=>xe(new Error(Fe.message)))}}class Qc{constructor(q,J,le,xe,de,Se,ke,Ee){this.actor=q,this.layerIndex=J,this.availableImages=le,this.availableModels=xe,this.brightness=ke,this.loading={},this.loaded={},this.worldview=Ee}loadTile(q,J){const le=q.uid,xe=this.loading[le]=new Uf(q,this.brightness,this.worldview);n.br(q.request,(de,Se)=>{const ke=!this.loading[le];return delete this.loading[le],ke||de?(xe.status="done",ke||(this.loaded[le]=xe),J(de)):Se&&Se.byteLength!==0?void xe.parse(Se,this.layerIndex,q,(Ee,Fe)=>{xe.status="done",this.loaded=this.loaded||{},this.loaded[le]=xe,Ee||!Fe?J(Ee):J(null,Fe)}):(xe.status="done",this.loaded[le]=xe,J())})}reloadTile(q,J){const le=this.loaded,xe=q.uid;if(le&&le[xe]){const de=le[xe];de.projection=q.projection,de.brightness=q.brightness;const Se=(ke,Ee)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(q,J)),J(ke,Ee)};de.status==="parsing"?de.reloadCallback=Se:de.status==="done"&&this.loadTile(q,J)}}abortTile(q,J){const le=q.uid;this.loading[le]&&delete this.loading[le],J()}removeTile(q,J){const le=this.loaded,xe=q.uid;le&&le[xe]&&delete le[xe],J()}}class Yi{constructor(q){this.self=q,this.actor=new n.fm(q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.ce({name:"mercator"}),this.workerSourceTypes={vector:Ae,geojson:jo,"raster-dem":Ie,"raster-array":Pe,"batched-model":Qc},this.workerSources={},this.self.registerWorkerSource=(J,le)=>{if(this.workerSourceTypes[J])throw new Error(`Worker source with name "${J}" already registered.`);this.workerSourceTypes[J]=le},this.self.registerRTLTextPlugin=J=>{if(n.fn.isParsed())throw new Error("RTL text plugin already registered.");n.fn.setState({pluginStatus:n.fo.parsed,pluginURL:n.fn.getPluginURL()}),n.fn.applyArabicShaping=J.applyArabicShaping,n.fn.processBidirectionalText=J.processBidirectionalText,n.fn.processStyledBidirectionalText=J.processStyledBidirectionalText;for(const le of this.rtlPluginParsingListeners)le(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(q,J,le){delete this.layerIndexes[q],delete this.availableImages[q],delete this.availableModels[q],delete this.workerSources[q],le()}checkIfReady(q,J,le){le()}setReferrer(q,J){this.referrer=J}spriteLoaded(q,J){this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={});const{scope:le,isLoaded:xe}=J;if(this.isSpriteLoaded[q][le]=xe,this.workerSources[q]&&this.workerSources[q][le])for(const de in this.workerSources[q][le]){const Se=this.workerSources[q][le][de];for(const ke in Se){const Ee=Se[ke];Ee instanceof Ae&&(Ee.isSpriteLoaded=xe,Ee.fire(new n.A("isSpriteLoaded")))}}}setImages(q,J,le){this.availableImages[q]||(this.availableImages[q]={});const{scope:xe,images:de}=J;if(this.availableImages[q][xe]=de,this.workerSources[q]&&this.workerSources[q][xe]){for(const Se in this.workerSources[q][xe]){const ke=this.workerSources[q][xe][Se];for(const Ee in ke)ke[Ee].availableImages=de}le()}else le()}setModels(q,{scope:J,models:le},xe){if(this.availableModels[q]||(this.availableModels[q]={}),this.availableModels[q][J]=le,this.workerSources[q]&&this.workerSources[q][J]){for(const de in this.workerSources[q][J]){const Se=this.workerSources[q][J][de];for(const ke in Se)Se[ke].availableModels=le}xe()}else xe()}setProjection(q,J){this.projections[q]=n.ce(J)}setBrightness(q,J,le){this.brightness=J,le()}setWorldview(q,J,le){this.worldview=J,le()}setLayers(q,J,le){this.getLayerIndex(q,J.scope).replace(J.layers,J.options),le()}updateLayers(q,J,le){this.getLayerIndex(q,J.scope).update(J.layers,J.removedIds,J.options),le()}loadTile(q,J,le){J.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,J.type,J.source,J.scope).loadTile(J,le)}decodeRasterArray(q,J,le){this.getWorkerSource(q,J.type,J.source,J.scope).decodeRasterArray(J,le)}reloadTile(q,J,le){J.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,J.type,J.source,J.scope).reloadTile(J,le)}abortTile(q,J,le){this.getWorkerSource(q,J.type,J.source,J.scope).abortTile(J,le)}removeTile(q,J,le){this.getWorkerSource(q,J.type,J.source,J.scope).removeTile(J,le)}removeSource(q,J,le){if(!(this.workerSources[q]&&this.workerSources[q][J.scope]&&this.workerSources[q][J.scope][J.type]&&this.workerSources[q][J.scope][J.type][J.source]))return;const xe=this.workerSources[q][J.scope][J.type][J.source];delete this.workerSources[q][J.scope][J.type][J.source],xe.removeSource!==void 0?xe.removeSource(J,le):le()}loadWorkerSource(q,J,le){try{this.self.importScripts(J.url),le()}catch(xe){le(xe.toString())}}syncRTLPluginState(q,J,le){if(n.fn.isParsed())le(null,!0);else if(n.fn.isParsing())this.rtlPluginParsingListeners.push(le);else try{n.fn.setState(J);const xe=n.fn.getPluginURL();!n.fn.isLoaded()||n.fn.isParsed()||n.fn.isParsing()||xe==null||(n.fn.setState({pluginStatus:n.fo.parsing,pluginURL:n.fn.getPluginURL()}),this.self.importScripts(xe),n.fn.isParsed()?le(null,!0):this.rtlPluginParsingListeners.push(le))}catch(xe){le(xe.toString())}}setDracoUrl(q,J){this.dracoUrl=J}getAvailableImages(q,J){this.availableImages[q]||(this.availableImages[q]={});let le=this.availableImages[q][J];return le||(le=[]),le}getAvailableModels(q,J){this.availableModels[q]||(this.availableModels[q]={});let le=this.availableModels[q][J];return le||(le={}),le}getLayerIndex(q,J){this.layerIndexes[q]||(this.layerIndexes[q]={});let le=this.layerIndexes[q][J];return le||(le=this.layerIndexes[q][J]=new X,le.scope=J),le}getWorkerSource(q,J,le,xe){const de=this.workerSources;return de[q]||(de[q]={}),de[q][xe]||(de[q][xe]={}),de[q][xe][J]||(de[q][xe][J]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),de[q][xe][J][le]||(de[q][xe][J][le]=new this.workerSourceTypes[J]({send:(Se,ke,Ee,Fe,et,Ve)=>this.actor.send(Se,ke,Ee,q,et,Ve),scheduler:this.actor.scheduler},this.getLayerIndex(q,xe),this.getAvailableImages(q,xe),this.getAvailableModels(q,xe),this.isSpriteLoaded[q][xe],void 0,this.brightness,this.worldview)),de[q][xe][J][le]}rasterizeImagesWorker(q,J,le){const xe=new Map;for(const[de,{image:Se,imageVariant:ke}]of J.tasks.entries()){const Ee=this.imageRasterizer.rasterize(ke,Se,J.scope,q);xe.set(de,Ee)}le(void 0,xe)}removeRasterizedImages(q,J,le){this.imageRasterizer.removeImagesFromCacheByIds(J.imageIds,J.scope,q),le()}enforceCacheSizeLimit(q,J){n.fp(J)}getWorkerPerformanceMetrics(q,J,le){le(void 0,void 0)}}return n.fl(self)&&(self.worker=new Yi(self)),Yi}),b(["./shared"],function(n){var R="3.13.0";const B={create:"create",load:"load",fullLoad:"fullLoad"},N={mark(u){performance.mark(u)},measure(u,t,o){performance.measure(u,t,o)}};function X(u){const t=u.name.split("?")[0];return n.a(t)&&t.includes("mapbox-gl.js")?"javascript":n.a(t)&&t.includes("mapbox-gl.css")?"css":n.b(t)?"fontRange":n.c(t)?"sprite":n.i(t)?"style":n.d(t)?"tilejson":"other"}var ie,se={},we=function(){if(ie)return se;function u(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,v,S=new Blob([""],{type:"text/javascript"}),A=URL.createObjectURL(S);try{v=new Worker(A),y=!0}catch{y=!1}return v&&v.terminate(),URL.revokeObjectURL(A),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var v=y.getContext("2d");if(!v)return!1;var S=v.getImageData(0,0,1,1);return S&&S.width===y.width}()?(o[_=d&&d.failIfMajorPerformanceCaveat]===void 0&&(o[_]=function(y){var v,S=function(A){var P=document.createElement("canvas"),D=Object.create(u.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=A,P.getContext("webgl2",D)}(y);if(!S)return!1;try{v=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!v||S.isContextLost())&&(S.shaderSource(v,"void main() {}"),S.compileShader(v),S.getShaderParameter(v,S.COMPILE_STATUS)===!0)}(_)),o[_]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var _}ie=1,se.supported=u,se.notSupportedReason=t;var o={};return u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},se}();function pe(u,t,o){const d=document.createElement(u);return t!=null&&(d.className=t),o&&o.appendChild(d),d}function Ae(u,t,o){const d=document.createElementNS("http://www.w3.org/2000/svg",u);for(const _ of Object.keys(t))d.setAttributeNS(null,_,String(t[_]));return o&&o.appendChild(d),d}const Ie=typeof document<"u"?document.documentElement&&document.documentElement.style:null,Je=Ie&&Ie.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Pe;function Oe(){Ie&&Je&&(Pe=Ie[Je],Ie[Je]="none")}function tt(){Ie&&Je&&(Ie[Je]=Pe)}function xt(u){u.preventDefault(),u.stopPropagation(),window.removeEventListener("click",xt,!0)}function Tt(){window.addEventListener("click",xt,!0),window.setTimeout(()=>{window.removeEventListener("click",xt,!0)},0)}function At(u,t){const o=u.getBoundingClientRect();return jt(u,o,t)}function Wt(u,t){const o=u.getBoundingClientRect(),d=[];for(let _=0;_<t.length;_++)d.push(jt(u,o,t[_]));return d}function Zt(u){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&u.button===2&&u.ctrlKey?0:u.button}function jt(u,t,o){const d=u.offsetWidth===t.width?1:u.offsetWidth/t.width;return new n.P((o.clientX-t.left)*d,(o.clientY-t.top)*d)}const pi="01",gi="NO_ACCESS_TOKEN";class _i{constructor(t,o,d){this._transformRequestFn=t,this._customAccessToken=o,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let o="";for(let d=0;d<10;d++)o+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",pi,o].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,o){return this._transformRequestFn&&this._transformRequestFn(t,o)||{url:t}}normalizeStyleURL(t,o){if(!n.j(t))return t;const d=$t(t);return d.params.push(`sdk=js-${R}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeGlyphsURL(t,o){if(!n.j(t))return t;const d=$t(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeModelURL(t,o){if(!n.j(t))return t;const d=$t(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||o)}normalizeSourceURL(t,o,d,_){if(!n.j(t))return t;const y=$t(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),_&&y.params.push(`worldview=${_}`),this._makeAPIURL(y,this._customAccessToken||o)}normalizeIconsetURL(t,o){const d=$t(t);return n.j(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||o)):xi(d)}normalizeSpriteURL(t,o,d,_){const y=$t(t);return n.j(t)?(y.path=`/styles/v1${y.path}/sprite${o}${d}`,this._makeAPIURL(y,this._customAccessToken||_)):(y.path+=`${o}${d}`,xi(y))}normalizeTileURL(t,o,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!n.j(t))return t;const _=$t(t);_.path=_.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${o||d&&_.authority!=="raster"&&d===512?"@2x":""}${n.l.supported?".webp":"$1"}`),_.authority==="raster"?_.path=`/${n.e.RASTER_URL_PREFIX}${_.path}`:_.authority==="rasterarrays"?_.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${_.path}`:_.authority==="3dtiles"?_.path=`/${n.e.TILES3D_URL_PREFIX}${_.path}`:(_.path=_.path.replace(/^.+\/v4\//,"/"),_.path=`/${n.e.TILE_URL_VERSION}${_.path}`);const y=this._customAccessToken||function(v){for(const S of v){const A=S.match(/^access_token=(.*)$/);if(A)return A[1]}return null}(_.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&_.params.push(`sku=${this._skuToken}`),this._makeAPIURL(_,y)}canonicalizeTileURL(t,o){const d=$t(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let _="mapbox://";d.path.match(/^\/raster\/v1\//)?_+=`raster/${d.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?_+=`rasterarrays/${d.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:_+=`tiles/${d.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return o&&(y=y.filter(v=>!v.match(/^access_token=/))),y.length&&(_+=`?${y.join("&")}`),_}canonicalizeTileset(t,o){const d=!!o&&n.j(o),_=[];for(const y of t.tiles||[])n.k(y)?_.push(this.canonicalizeTileURL(y,d)):_.push(y);return _}_makeAPIURL(t,o){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",_=$t(n.e.API_URL);if(t.protocol=_.protocol,t.authority=_.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(_.path!=="/"&&(t.path=`${_.path}${t.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return xi(t);if(o=o||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!o)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(o[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${o||""}`),xi(t)}}const yi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function $t(u){const t=u.match(yi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function xi(u){const t=u.params.length?`?${u.params.join("&")}`:"";return`${u.protocol}://${u.authority}${u.path}${t}`}const hi="mapbox.eventData";function sn(u){if(!u)return null;const t=u.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(n.m(t[1]))}catch{return null}}class Ui{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const o=sn(n.e.ACCESS_TOKEN);let d="";return d=o&&o.u?n.f(o.u):n.e.ACCESS_TOKEN||"",t?`${hi}.${t}:${d}`:`${hi}:${d}`}fetchEventData(){const t=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid");if(t)try{const _=localStorage.getItem(o);_&&(this.eventData=JSON.parse(_));const y=localStorage.getItem(d);y&&(this.anonId=y)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const t=n.s("localStorage"),o=this.getStorageKey(),d=this.getStorageKey("uuid"),_=this.anonId;if(t&&_)try{localStorage.setItem(d,_),Object.keys(this.eventData).length>=1&&localStorage.setItem(o,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,o,d,_){if(!n.e.EVENTS_URL)return;const y=$t(n.e.EVENTS_URL);y.params.push(`access_token=${_||n.e.ACCESS_TOKEN||""}`);const v={event:this.type,created:new Date(t).toISOString()},S=o?n.h(v,o):v,A={url:xi(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([S])};this.pendingRequest=n.p(A,P=>{this.pendingRequest=null,d(P),this.saveEventData(),this.processRequests(_)})}queueRequest(t,o){this.queue.push(t),this.processRequests(o)}}const ss=new class extends Ui{constructor(u){super("appUserTurnstile"),this._customAccessToken=u}postTurnstileEvent(u,t){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(u)&&u.some(o=>n.j(o)||n.k(o))&&this.queueRequest(Date.now(),t)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=sn(n.e.ACCESS_TOKEN),o=t?t.u:n.e.ACCESS_TOKEN;let d=o!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),d=!0);const _=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),v=new Date(_),S=(_-this.eventData.lastSuccess)/864e5;d=d||S>=1||S<-1||y.getDate()!==v.getDate()}else d=!0;d?this.postEvent(_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:pi,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=_,this.eventData.tokenU=o)},u):this.processRequests()}},jn=ss.postTurnstileEvent.bind(ss),Fs=new class extends Ui{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(u,t,o,d){this.skuToken=t,this.errorCb=d,n.e.EVENTS_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},o):this.errorCb(new Error(gi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:R,skuId:pi,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u))}remove(){this.errorCb=null}},Is=Fs.postMapLoadEvent.bind(Fs),Zi=new class extends Ui{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(u){let t=this.mapInstanceIdMap.get(u);return t||(t=n.u(),this.mapInstanceIdMap.set(u,t)),t}getEventId(u){const t=this.eventIdPerMapInstanceMap.get(u)||0;return this.eventIdPerMapInstanceMap.set(u,t+1),t}postStyleLoadEvent(u,t){const{map:o,style:d,importedStyles:_}=t;if(!n.e.EVENTS_URL||!u&&!n.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(o),v={mapInstanceId:y,eventId:this.getEventId(y),style:d};_.length&&(v.importedStyles=_),this.queueRequest({timestamp:Date.now(),payload:v},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:o}=this.queue.shift();this.postEvent(t,o,()=>{},u)}},en=Zi.postStyleLoadEvent.bind(Zi),es=new class extends Ui{constructor(){super("gljs.performance")}postPerformanceEvent(u,t){n.e.EVENTS_URL&&(u||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},u)}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:o}=this.queue.shift(),d=function(_){const y=performance.getEntriesByType("resource"),v=performance.getEntriesByType("mark"),S=function(F){const G={};if(F){for(const j in F)if(j!=="other")for(const H of F[j]){const Z=`${j}ResolveRangeMin`,K=`${j}ResolveRangeMax`,re=`${j}RequestCount`,ce=`${j}RequestCachedCount`;G[Z]=Math.min(G[Z]||1/0,H.startTime),G[K]=Math.max(G[K]||-1/0,H.responseEnd);const me=fe=>{G[fe]===void 0&&(G[fe]=0),++G[fe]};H.transferSize!==void 0&&H.transferSize===0&&me(ce),me(re)}}return G}(function(F,G){const j={};if(F)for(const H of F){const Z=G(H);j[Z]===void 0&&(j[Z]=[]),j[Z].push(H)}return j}(y,X)),A=window.devicePixelRatio,P=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=P?P.effectiveType:void 0,k={counters:[],metadata:[],attributes:[]},z=(F,G,j)=>{j!=null&&F.push({name:G,value:j.toString()})};for(const F in S)z(k.counters,F,S[F]);if(_.interactionRange[0]!==1/0&&_.interactionRange[1]!==-1/0&&(z(k.counters,"interactionRangeMin",_.interactionRange[0]),z(k.counters,"interactionRangeMax",_.interactionRange[1])),v)for(const F of Object.keys(B)){const G=B[F],j=v.find(H=>H.name===G);j&&z(k.counters,G,j.startTime)}return z(k.counters,"visibilityHidden",_.visibilityHidden),z(k.attributes,"style",function(F){if(F)for(const G of F){const j=G.name.split("?")[0];if(n.i(j)){const H=j.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(y)),z(k.attributes,"terrainEnabled",_.terrainEnabled?"true":"false"),z(k.attributes,"fogEnabled",_.fogEnabled?"true":"false"),z(k.attributes,"projection",_.projection),z(k.attributes,"zoom",_.zoom),z(k.metadata,"devicePixelRatio",A),z(k.metadata,"connectionEffectiveType",D),z(k.metadata,"navigatorUserAgent",navigator.userAgent),z(k.metadata,"screenWidth",window.screen.width),z(k.metadata,"screenHeight",window.screen.height),z(k.metadata,"windowWidth",window.innerWidth),z(k.metadata,"windowHeight",window.innerHeight),z(k.metadata,"mapWidth",_.width/A),z(k.metadata,"mapHeight",_.height/A),z(k.metadata,"webglRenderer",_.renderer),z(k.metadata,"webglVendor",_.vendor),z(k.metadata,"sdkVersion",R),z(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(o);for(const _ of d.metadata);for(const _ of d.counters);for(const _ of d.attributes);this.postEvent(t,d,()=>{},u)}},xs=es.postPerformanceEvent.bind(es),fn=new class extends Ui{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(u,t,o,d){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const _=$t(n.e.API_URL+n.e.SESSION_PATH);_.params.push(`sku=${t||""}`),_.params.push(`access_token=${d||n.e.ACCESS_TOKEN||""}`);const y={url:xi(_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(y,v=>{this.pendingRequest=null,o(v),this.saveEventData(),this.processRequests(d)})}getSessionAPI(u,t,o,d){this.skuToken=t,this.errorCb=d,n.e.SESSION_PATH&&n.e.API_URL&&(o||n.e.ACCESS_TOKEN?this.queueRequest({id:u,timestamp:Date.now()},o):this.errorCb(new Error(gi)))}processRequests(u){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:o}=this.queue.shift();t&&this.success[t]||this.getSession(o,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},u)}remove(){this.errorCb=null}},pr=fn.getSessionAPI.bind(fn),Ks=new Set;function Js(u,t){t?Ks.add(u):Ks.delete(u)}class Ce{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,o){this._updatedSourceCaches[t]=o,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const o=t.scope;this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._updatedLayers[o].add(t.id),this.setDirty()}removeLayer(t){const o=t.scope;this._removedLayers[o]=this._removedLayers[o]||{},this._updatedLayers[o]=this._updatedLayers[o]||new Set,this._removedLayers[o][t.id]=t,this._updatedLayers[o].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const o in this._updatedLayers)t[o]=t[o]||{},t[o].updatedIds=Array.from(this._updatedLayers[o].values());for(const o in this._removedLayers)t[o]=t[o]||{},t[o].removedIds=Object.keys(this._removedLayers[o]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,o){this._updatedImages[o]=this._updatedImages[o]||new Set,this._updatedImages[o].add(n.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Ze(u){const{userImage:t}=u;return!!(t&&t.render&&t.render())&&(u.data.replace(new Uint8Array(t.data.buffer)),!0)}class gt extends n.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&n.t()&&(this.imageRasterizerDispatcher=new n.D(n.x(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new n.r({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const o=this.atlasTexture.get(t);o&&(o.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,o){this.imageProviders.has(o)||this.imageProviders.set(o,new Map),this.imageProviders.get(o).set(t.id,t)}removeImageProvider(t,o){this.imageProviders.has(o)&&this.imageProviders.get(o).delete(t)}getPendingImageProviders(){const t=[];for(const o of this.imageProviders.values())for(const d of o.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.y),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,o){if(this.loaded.get(o)!==t&&(this.loaded.set(o,t),t)){for(const{ids:d,callback:_}of this.requestors)this._notify(d,o,_);this.requestors=[]}}hasImage(t,o){return!!this.getImage(t,o)}getImage(t,o){return this.images.get(o).get(t.toString())}addImage(t,o,d){this._validate(t,d)&&this.images.get(o).set(t.toString(),d)}_validate(t,o){let d=!0;return this._validateStretch(o.stretchX,o.data&&o.data.width)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(o.stretchY,o.data&&o.data.height)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(o.content,o)||(this.fire(new n.z(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,o){if(!t)return!0;let d=0;for(const _ of t){if(_[0]<d||_[1]<_[0]||o<_[1])return!1;d=_[1]}return!0}_validateContent(t,o){return t?t.length!==4||!o.usvg&&(t[0]<0||o.data.width<t[0]||t[1]<0||o.data.height<t[1]||t[2]<0||o.data.width<t[2]||t[3]<0||o.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,o,d){const _=this.images.get(o).get(t.toString());d.version=_.version+1,this.images.get(o).set(t.toString(),d),this.updatedImages.get(o).add(t),this.removeFromImageRasterizerCache(t,o)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,o){this.spriteFormat!=="raster"&&(n.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:o}):this.imageRasterizer.removeImagesFromCacheByIds([t],o))}removeImage(t,o){const d=this.images.get(o),_=d.get(t.toString());d.delete(t.toString()),this.patterns.get(o).delete(t.toString()),this.removeFromImageRasterizerCache(t,o),_.userImage&&_.userImage.onRemove&&_.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(o=>n.I.from(o))}getImages(t,o,d){const _=[],y=[],v=this.imageProviders.get(o);for(const D of t){if(!D.iconsetId){_.push(D);continue}const k=v.get(D.iconsetId);k&&(this.getImage(D,o)?y.push(D):k.addPendingRequest(D))}if(_.length===0)return void this._notify(y,o,d);let S=!0;const A=!!this.loaded.get(o),P=this.images.get(o);if(!A)for(const D of _)P.has(D.toString())||(S=!1);A||S?this._notify(_,o,d):this.requestors.push({ids:_,scope:o,callback:d})}rasterizeImages(t,o){const d=new Map,{tasks:_,scope:y}=t;for(const[v,S]of _.entries()){const A=this.getImage(S.id,y);A&&d.set(v,{image:A,imageVariant:S})}this._rasterizeImages(y,d,o)}_rasterizeImages(t,o,d){if(n.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:o,scope:t},d);else{const _=new Map;for(const[y,{image:v,imageVariant:S}]of o.entries())_.set(y,this.imageRasterizer.rasterize(S,v,t,0));d(void 0,_)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,o,d){const _=this.images.get(o),y=new Map;for(const v of t){if(!_.get(v.toString())){if(v.iconsetId)continue;this.fire(new n.A("styleimagemissing",{id:v.name}))}const S=_.get(v.toString());if(!S){n.w(`Image "${v.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const A={data:S.usvg?null:S.data.clone(),pixelRatio:S.pixelRatio,sdf:S.sdf,usvg:S.usvg,version:S.version,stretchX:S.stretchX,stretchY:S.stretchY,content:S.content,hasRenderCallback:!!(S.userImage&&S.userImage.render)};S.usvg&&Object.assign(A,{width:S.icon.usvg_tree.width,height:S.icon.usvg_tree.height}),y.set(n.I.toString(v),A)}d(null,y)}getPixelSize(t){const{width:o,height:d}=this.atlasImage.get(t);return{width:o,height:d}}getPattern(t,o,d){const _=t.toString(),y=this.patterns.get(o),v=y.get(_),S=this.getImage(t,o);if(!S)return null;if(v){if(v.position.version===S.version)return v.position;v.position.version=S.version}else{if(S.usvg&&!S.data){const A=this.getPatternInFlightId(_,o);if(this.patternsInFlight.has(A))return null;this.patternsInFlight.add(A);const P=new n.B(t).scaleSelf(n.q.devicePixelRatio),D=new Map([[P.toString(),{image:S,imageVariant:P}]]);return this._rasterizeImages(o,D,(k,z)=>this.storePatternImage(P,o,S,d,z)),null}this.storePattern(t,o,S)}return this._updatePatternAtlas(o,d),y.get(_).position}getPatternInFlightId(t,o){return n.C(t,o)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,o,d,_,y){const v=t.toString(),S=y?y.get(v):void 0;S&&(d.data=S,this.storePattern(t.id,o,d),this._updatePatternAtlas(o,_),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),o)))}storePattern(t,o,d){const _={w:d.data.width+2*n.F,h:d.data.height+2*n.F,x:0,y:0},y=new n.G(_,d,n.F);this.patterns.get(o).set(t.toString(),{bin:_,position:y})}bind(t,o){const d=t.gl;let _=this.atlasTexture.get(o);_?this.dirty&&(_.update(this.atlasImage.get(o)),this.dirty=!1):(_=new n.T(t,this.atlasImage.get(o),d.RGBA8),this.atlasTexture.set(o,_)),_.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,o){const d=this.patterns.get(t),_=Array.from(d.values()).map(({bin:P})=>P),{w:y,h:v}=n.H(_),S=this.atlasImage.get(t);S.resize({width:y||1,height:v||1});const A=this.images.get(t);for(const[P,{bin:D,position:k}]of d.entries()){let z=k.padding;const F=D.x+z,G=D.y+z,j=A.get(P).data,H=j.width,Z=j.height;z=z>1?z-1:z,n.r.copy(j,S,{x:0,y:0},{x:F,y:G},{width:H,height:Z},o),n.r.copy(j,S,{x:0,y:Z-z},{x:F,y:G-z},{width:H,height:z},o),n.r.copy(j,S,{x:0,y:0},{x:F,y:G+Z},{width:H,height:z},o),n.r.copy(j,S,{x:H-z,y:0},{x:F-z,y:G},{width:z,height:Z},o),n.r.copy(j,S,{x:0,y:0},{x:F+H,y:G},{width:z,height:Z},o),n.r.copy(j,S,{x:H-z,y:Z-z},{x:F-z,y:G-z},{width:z,height:z},o),n.r.copy(j,S,{x:0,y:Z-z},{x:F+H,y:G-z},{width:z,height:z},o),n.r.copy(j,S,{x:0,y:0},{x:F+H,y:G+Z},{width:z,height:z},o),n.r.copy(j,S,{x:H-z,y:0},{x:F-z,y:G+Z},{width:z,height:z},o)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,o){const d=this.images.get(o);for(const _ of t){if(this.callbackDispatchedThisFrame.get(o).has(_.toString()))continue;this.callbackDispatchedThisFrame.get(o).add(_.toString());const y=d.get(_.toString());Ze(y)&&this.updateImage(_,o,y)}}}function Rt(u){const t=u.key,o=u.value,d=u.valueSpec||{},_=u.objectElementValidators||{},y=u.style,v=u.styleSpec;let S=[];const A=n.J(o);if(A!=="object")return[new n.V(t,o,`object expected, ${A} found`)];for(const P in o){const D=P.split(".")[0];let k;_[D]?k=_[D]:d[D]?k=An:_["*"]?k=_["*"]:d["*"]&&(k=An),k?S=S.concat(k({key:(t&&`${t}.`)+P,value:o[P],valueSpec:d[D]||d["*"],style:y,styleSpec:v,object:o,objectKey:P},o)):S.push(new n.K(t,o[P],`unknown property "${P}"`))}for(const P in d)_[P]||d[P].required&&d[P].default===void 0&&o[P]===void 0&&S.push(new n.V(t,o,`missing required property "${P}"`));return S}function zt(u){const t=u.value,o=u.valueSpec,d=u.style,_=u.styleSpec,y=u.key,v=u.arrayElementValidator||An;if(n.J(t)!=="array")return[new n.V(y,t,`array expected, ${n.J(t)} found`)];if(o.length&&t.length!==o.length)return[new n.V(y,t,`array length ${o.length} expected, length ${t.length} found`)];if(o["min-length"]&&t.length<o["min-length"])return[new n.V(y,t,`array length at least ${o["min-length"]} expected, length ${t.length} found`)];let S={type:o.value,values:o.values,minimum:o.minimum,maximum:o.maximum,function:void 0};_.$version<7&&(S.function=o.function),n.J(o.value)==="object"&&(S=o.value);let A=[];for(let P=0;P<t.length;P++)A=A.concat(v({array:t,arrayIndex:P,value:t[P],valueSpec:S,style:d,styleSpec:_,key:`${y}[${P}]`},!0));return A}function Nt(u){const t=u.key,o=u.value,d=u.valueSpec;let _=n.J(o);if(_==="number"&&o!=o&&(_="NaN"),_!=="number")return[new n.V(t,o,`number expected, ${_} found`)];if("minimum"in d){let y=d.minimum;if(n.J(d.minimum)==="array"&&(y=d.minimum[u.arrayIndex]),o<y)return[new n.V(t,o,`${o} is less than the minimum value ${y}`)]}if("maximum"in d){let y=d.maximum;if(n.J(d.maximum)==="array"&&(y=d.maximum[u.arrayIndex]),o>y)return[new n.V(t,o,`${o} is greater than the maximum value ${y}`)]}return[]}function Qt(u){const t=u.valueSpec,o=n.M(u.value.type);let d,_,y,v={};const S=o!=="categorical"&&u.value.property===void 0,A=!S,P=n.J(u.value.stops)==="array"&&n.J(u.value.stops[0])==="array"&&n.J(u.value.stops[0][0])==="object",D=Rt({key:u.key,value:u.value,valueSpec:u.styleSpec.function,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{stops:function(F){if(o==="identity")return[new n.V(F.key,F.value,'identity function may not have a "stops" property')];let G=[];const j=F.value;return G=G.concat(zt({key:F.key,value:j,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:k})),n.J(j)==="array"&&j.length===0&&G.push(new n.V(F.key,j,"array must have at least one stop")),G},default:function(F){return An({key:F.key,value:F.value,valueSpec:t,style:F.style,styleSpec:F.styleSpec})}}});return o==="identity"&&S&&D.push(new n.V(u.key,u.value,'missing required property "property"')),o==="identity"||u.value.stops||D.push(new n.V(u.key,u.value,'missing required property "stops"')),o==="exponential"&&u.valueSpec.expression&&!n.N(u.valueSpec)&&D.push(new n.V(u.key,u.value,"exponential functions not supported")),u.styleSpec.$version>=8&&(A&&!n.O(u.valueSpec)?D.push(new n.V(u.key,u.value,"property functions not supported")):S&&!n.Q(u.valueSpec)&&D.push(new n.V(u.key,u.value,"zoom functions not supported"))),o!=="categorical"&&!P||u.value.property!==void 0||D.push(new n.V(u.key,u.value,'"property" property is required')),D;function k(F){let G=[];const j=F.value,H=F.key;if(n.J(j)!=="array")return[new n.V(H,j,`array expected, ${n.J(j)} found`)];if(j.length!==2)return[new n.V(H,j,`array length 2 expected, length ${j.length} found`)];if(P){if(n.J(j[0])!=="object")return[new n.V(H,j,`object expected, ${n.J(j[0])} found`)];if(j[0].zoom===void 0)return[new n.V(H,j,"object stop key must have zoom")];if(j[0].value===void 0)return[new n.V(H,j,"object stop key must have value")];const Z=n.M(j[0].zoom);if(typeof Z!="number")return[new n.V(H,j[0].zoom,"stop zoom values must be numbers")];if(y&&y>Z)return[new n.V(H,j[0].zoom,"stop zoom values must appear in ascending order")];Z!==y&&(y=Z,_=void 0,v={}),G=G.concat(Rt({key:`${H}[0]`,value:j[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Nt,value:z}}))}else G=G.concat(z({key:`${H}[0]`,value:j[0],style:F.style,styleSpec:F.styleSpec},j));return n.S(n.U(j[1]))?G.concat([new n.V(`${H}[1]`,j[1],"expressions are not allowed in function stops.")]):G.concat(An({key:`${H}[1]`,value:j[1],valueSpec:t,style:F.style,styleSpec:F.styleSpec}))}function z(F,G){const j=n.J(F.value),H=n.M(F.value),Z=F.value!==null?F.value:G;if(d){if(j!==d)return[new n.V(F.key,Z,`${j} stop domain type must match previous stop domain type ${d}`)]}else d=j;if(j!=="number"&&j!=="string"&&j!=="boolean"&&typeof H!="number"&&typeof H!="string"&&typeof H!="boolean")return[new n.V(F.key,Z,"stop domain value must be a number, string, or boolean")];if(j!=="number"&&o!=="categorical"){let K=`number expected, ${j} found`;return n.O(t)&&o===void 0&&(K+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(F.key,Z,K)]}return o!=="categorical"||j!=="number"||typeof H=="number"&&isFinite(H)&&Math.floor(H)===H?o!=="categorical"&&j==="number"&&typeof H=="number"&&typeof _=="number"&&_!==void 0&&H<_?[new n.V(F.key,Z,"stop domain values must appear in ascending order")]:(_=H,o==="categorical"&&H in v?[new n.V(F.key,Z,"stop domain values must be unique")]:(v[H]=!0,[])):[new n.V(F.key,Z,`integer expected, found ${String(H)}`)]}}function Gt(u){const t=(u.expressionContext==="property"?n.W:n.X)(n.U(u.value),u.valueSpec);if(t.result==="error")return t.value.map(d=>new n.V(`${u.key}${d.key}`,u.value,d.message));const o=t.value.expression||t.value._styleExpression.expression;if(u.expressionContext==="property"&&u.propertyKey==="text-font"&&!o.outputDefined())return[new n.V(u.key,u.value,`Invalid data expression for "${u.propertyKey}". Output values must be contained as literals within the expression.`)];if(u.expressionContext==="property"&&u.propertyType==="layout"&&!n.Y(o))return[new n.V(u.key,u.value,'"feature-state" data expressions are not supported with layout properties.')];if(u.expressionContext==="filter")return Kt(o,u);if(u.expressionContext&&u.expressionContext.indexOf("cluster")===0){if(!n.Z(o,["zoom","feature-state"]))return[new n.V(u.key,u.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(u.expressionContext==="cluster-initial"&&!n._(o))return[new n.V(u.key,u.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Kt(u,t){const o=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const _ of t.valueSpec.expression.parameters)o.delete(_);if(o.size===0)return[];const d=[];return u instanceof n.$&&o.has(u.name)?[new n.V(t.key,t.value,`["${u.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(u.eachChild(_=>{d.push(...Kt(_,t))}),d)}function Vt(u){const t=u.key,o=u.value,d=u.valueSpec,_=[];return Array.isArray(d.values)?d.values.indexOf(n.M(o))===-1&&_.push(new n.V(t,o,`expected one of [${d.values.join(", ")}], ${JSON.stringify(o)} found`)):Object.keys(d.values).indexOf(n.M(o))===-1&&_.push(new n.V(t,o,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(o)} found`)),_}function Ci(u){return n.a1(n.U(u.value))?Gt(n.L({},u,{expressionContext:"filter",valueSpec:u.styleSpec[`filter_${u.layerType||"fill"}`]})):Jt(u)}function Jt(u){const t=u.value,o=u.key;if(n.J(t)!=="array")return[new n.V(o,t,`array expected, ${n.J(t)} found`)];const d=u.styleSpec;let _,y=[];if(t.length<1)return[new n.V(o,t,"filter array must have at least 1 element")];switch(y=y.concat(Vt({key:`${o}[0]`,value:t[0],valueSpec:d.filter_operator,style:u.style,styleSpec:u.styleSpec})),n.M(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&n.M(t[1])==="$type"&&y.push(new n.V(o,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&y.push(new n.V(o,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(_=n.J(t[1]),_!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${_} found`)));for(let v=2;v<t.length;v++)_=n.J(t[v]),n.M(t[1])==="$type"?y=y.concat(Vt({key:`${o}[${v}]`,value:t[v],valueSpec:d.geometry_type,style:u.style,styleSpec:u.styleSpec})):_!=="string"&&_!=="number"&&_!=="boolean"&&y.push(new n.V(`${o}[${v}]`,t[v],`string, number, or boolean expected, ${_} found`));break;case"any":case"all":case"none":for(let v=1;v<t.length;v++)y=y.concat(Jt({key:`${o}[${v}]`,value:t[v],style:u.style,styleSpec:u.styleSpec}));break;case"has":case"!has":_=n.J(t[1]),t.length!==2?y.push(new n.V(o,t,`filter array for "${t[0]}" operator must have 2 elements`)):_!=="string"&&y.push(new n.V(`${o}[1]`,t[1],`string expected, ${_} found`))}return y}function Ti(u,t){const o=u.key,d=u.style,_=u.layer,y=u.styleSpec,v=u.value,S=u.objectKey,A=y[`${t}_${u.layerType}`];if(!A)return[];const P=S.match(/^(.*)-use-theme$/);if(t==="paint"&&P&&A[P[1]])return n.S(v)?[].concat(An({key:u.key,value:v,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S})):An({key:o,value:v,valueSpec:{type:"string"},style:d,styleSpec:y});const D=S.match(/^(.*)-transition$/);if(t==="paint"&&D&&A[D[1]]&&A[D[1]].transition)return An({key:o,value:v,valueSpec:y.transition,style:d,styleSpec:y});const k=u.valueSpec||A[S];if(!k)return[new n.K(o,v,`unknown property "${S}"`)];let z;if(n.J(v)==="string"&&n.O(k)&&!k.tokens&&(z=/^{([^}]+)}$/.exec(v))){const G=`\`{ "type": "identity", "property": ${z?JSON.stringify(z[1]):'"_"'} }\``;return[new n.V(o,v,`"${S}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const F=[];if(u.layerType==="symbol")S!=="text-field"||!d||d.glyphs||d.imports||F.push(new n.V(o,v,'use of "text-field" requires a style "glyphs" property')),S==="text-font"&&n.a2(n.U(v))&&n.M(v.type)==="identity"&&F.push(new n.V(o,v,'"text-font" does not support identity functions'));else if(u.layerType==="model"&&t==="paint"&&_&&_.layout&&_.layout.hasOwnProperty("model-id")&&n.O(k)&&(n.a3(k)||n.Q(k))){const G=n.W(n.U(v),k),j=G.value.expression||G.value._styleExpression.expression;j&&!n.Z(j,["measure-light"])&&(S==="model-emissive-strength"&&n._(j)&&n.Y(j)||F.push(new n.V(o,v,`${S} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return F.concat(An({key:u.key,value:v,valueSpec:k,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:S}))}function Vi(u){return Ti(u,"paint")}function ji(u){return Ti(u,"layout")}function $n(u){let t=[];const o=u.value,d=u.key,_=u.style,y=u.styleSpec;o.type||o.ref||t.push(new n.V(d,o,'either "type" or "ref" is required'));let v=n.M(o.type);const S=n.M(o.ref);if(o.id){const A=n.M(o.id);for(let P=0;P<u.arrayIndex;P++){const D=_.layers[P];n.M(D.id)===A&&t.push(new n.V(d,o.id,`duplicate layer id "${o.id}", previously used at line ${D.id.__line__}`))}}if("ref"in o){let A;["type","source","source-layer","filter","layout"].forEach(P=>{P in o&&t.push(new n.V(d,o[P],`"${P}" is prohibited for ref layers`))}),_.layers.forEach(P=>{n.M(P.id)===S&&(A=P)}),A?A.ref?t.push(new n.V(d,o.ref,"ref cannot reference another ref layer")):v=n.M(A.type):typeof S=="string"&&t.push(new n.V(d,o.ref,`ref layer "${S}" not found`))}else if(v!=="background"&&v!=="sky"&&v!=="slot")if(o.source){const A=_.sources&&_.sources[o.source],P=A&&n.M(A.type);A?P==="vector"&&v==="raster"?t.push(new n.V(d,o.source,`layer "${o.id}" requires a raster source`)):P==="raster"&&v!=="raster"?t.push(new n.V(d,o.source,`layer "${o.id}" requires a vector source`)):P!=="vector"||o["source-layer"]?P==="raster-dem"&&v!=="hillshade"?t.push(new n.V(d,o.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="raster-array"||["raster","raster-particle"].includes(v)?v==="line"&&o.paint&&(o.paint["line-gradient"]||o.paint["line-trim-offset"])&&P==="geojson"&&!A.lineMetrics?t.push(new n.V(d,o,`layer "${o.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):v==="raster-particle"&&P!=="raster-array"&&t.push(new n.V(d,o.source,`layer "${o.id}" requires a 'raster-array' source.`)):t.push(new n.V(d,o.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new n.V(d,o,`layer "${o.id}" must specify a "source-layer"`)):t.push(new n.V(d,o.source,`source "${o.source}" not found`))}else t.push(new n.V(d,o,'missing required property "source"'));return t=t.concat(Rt({key:d,value:o,valueSpec:y.layer,style:u.style,styleSpec:u.styleSpec,objectElementValidators:{"*":()=>[],type:()=>An({key:`${d}.type`,value:o.type,valueSpec:y.layer.type,style:u.style,styleSpec:u.styleSpec,object:o,objectKey:"type"}),filter:A=>Ci(n.L({layerType:v},A)),layout:A=>Rt({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>ji(n.L({layerType:v},P))}}),paint:A=>Rt({layer:o,key:A.key,value:A.value,valueSpec:{},style:A.style,styleSpec:A.styleSpec,objectElementValidators:{"*":P=>Vi(n.L({layerType:v,layer:o},P))}})}})),t}function wn(u){const t=u.value,o=u.key,d=n.J(t);return d!=="string"?[new n.V(o,t,`string expected, ${d} found`)]:[]}const zs={promoteId:function u({key:t,value:o}){if(n.J(o)==="string")return wn({key:t,value:o});if(Array.isArray(o)){const d=[],_=n.U(o),y=n.X(_);return y.result==="error"&&y.value.forEach(v=>{d.push(new n.V(`${t}${v.key}`,null,`${v.message}`))}),n.Z(y.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new n.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}{const d=[];for(const _ in o)d.push(...u({key:`${t}.${_}`,value:o[_]}));return d}}};function Hn(u){const t=u.value,o=u.key,d=u.styleSpec,_=u.style;if(!t.type)return[new n.V(o,t,'"type" is required')];const y=n.M(t.type);let v=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&(t.url||t.tiles||v.push(new n.K(o,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return v=v.concat(Rt({key:o,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:u.style,styleSpec:d,objectElementValidators:zs})),v;case"geojson":if(v=Rt({key:o,value:t,valueSpec:d.source_geojson,style:_,styleSpec:d,objectElementValidators:zs}),t.cluster)for(const S in t.clusterProperties){const[A,P]=t.clusterProperties[S],D=typeof A=="string"?[A,["accumulated"],["get",S]]:A;v.push(...Gt({key:`${o}.${S}.map`,value:P,expressionContext:"cluster-map"})),v.push(...Gt({key:`${o}.${S}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return v;case"video":return Rt({key:o,value:t,valueSpec:d.source_video,style:_,styleSpec:d});case"image":return Rt({key:o,value:t,valueSpec:d.source_image,style:_,styleSpec:d});case"canvas":return[new n.V(o,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vt({key:`${o}.type`,value:t.type,valueSpec:{values:vs(d)}})}}function vs(u){return u.source.reduce((t,o)=>{const d=u[o];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values))),t},[])}function Os(u){const t=u.value,o=u.styleSpec,d=o.light,_=u.style;let y=[];const v=n.J(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new n.V("light",t,`object expected, ${v} found`)]),y;for(const S in t){const A=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);y=y.concat(P&&d[P[1]]?An({key:S,value:t[S],valueSpec:{type:"string"},style:_,styleSpec:o}):A&&d[A[1]]&&d[A[1]].transition?An({key:S,value:t[S],valueSpec:o.transition,style:_,styleSpec:o}):d[S]?An({key:S,value:t[S],valueSpec:d[S],style:_,styleSpec:o}):[new n.V(S,t[S],`unknown property "${S}"`)])}return y}function wr(u){const t=u.value;let o=[];if(!t)return o;const d=n.J(t);if(d!=="object")return o=o.concat([new n.V("light-3d",t,`object expected, ${d} found`)]),o;const _=u.styleSpec,y=_["light-3d"],v=u.key,S=u.style,A=u.style.lights;for(const k of["type","id"])if(!(k in t))return o=o.concat([new n.V("light-3d",t,`missing property ${k} on light`)]),o;if(t.type&&A)for(let k=0;k<u.arrayIndex;k++){const z=n.M(t.type),F=A[k];n.M(F.type)===z&&o.push(new n.V(v,t.id,`duplicate light type "${t.type}", previously defined at line ${F.id.__line__}`))}const P=`properties_light_${t.type}`;if(!(P in _))return o=o.concat([new n.V("light-3d",t,`Invalid light type ${t.type}`)]),o;const D=_[P];for(const k in t)if(k==="properties"){const z=t[k],F=n.J(z);if(F!=="object")return o=o.concat([new n.V("properties",z,`object expected, ${F} found`)]),o;for(const G in z){const j=G.match(/^(.*)-transition$/),H=G.match(/^(.*)-use-theme$/);o=o.concat(H&&D[H[1]]?An({key:k,value:z[G],valueSpec:{type:"string"},style:S,styleSpec:_}):j&&D[j[1]]&&D[j[1]].transition?An({key:k,value:t[k],valueSpec:_.transition,style:S,styleSpec:_}):D[G]?An({key:G,value:z[G],valueSpec:D[G],style:S,styleSpec:_}):[new n.K(u.key,z[G],`unknown property "${G}"`)])}}else o=o.concat(y[k]?An({key:k,value:t[k],valueSpec:y[k],style:S,styleSpec:_}):[new n.K(k,t[k],`unknown property "${k}"`)]);return o}function wo(u){const t=u.value,o=u.key,d=u.style,_=u.styleSpec,y=_.terrain;let v=[];const S=n.J(t);if(t===void 0||S==="null")return v;if(S!=="object")return v=v.concat([new n.V("terrain",t,`object expected, ${S} found`)]),v;for(const A in t){const P=A.match(/^(.*)-transition$/),D=A.match(/^(.*)-use-theme$/);v=v.concat(D&&y[D[1]]?An({key:A,value:t[A],valueSpec:{type:"string"},style:d,styleSpec:_}):P&&y[P[1]]&&y[P[1]].transition?An({key:A,value:t[A],valueSpec:_.transition,style:d,styleSpec:_}):y[A]?An({key:A,value:t[A],valueSpec:y[A],style:d,styleSpec:_}):[new n.K(A,t[A],`unknown property "${A}"`)])}if(t.source){const A=d.sources&&d.sources[t.source],P=A&&n.M(A.type);A?P!=="raster-dem"&&v.push(new n.V(o,t.source,`terrain cannot be used with a source of type ${String(P)}, it only be used with a "raster-dem" source type`)):v.push(new n.V(o,t.source,`source "${t.source}" not found`))}else v.push(new n.V(o,t,'terrain is missing required property "source"'));return v}function Ds(u){const t=u.value,o=u.style,d=u.styleSpec,_=d.fog;let y=[];const v=n.J(t);if(t===void 0)return y;if(v!=="object")return y=y.concat([new n.V("fog",t,`object expected, ${v} found`)]),y;for(const S in t){const A=S.match(/^(.*)-transition$/),P=S.match(/^(.*)-use-theme$/);y=y.concat(P&&_[P[1]]?An({key:S,value:t[S],valueSpec:{type:"string"},style:o,styleSpec:d}):A&&_[A[1]]&&_[A[1]].transition?An({key:S,value:t[S],valueSpec:d.transition,style:o,styleSpec:d}):_[S]?An({key:S,value:t[S],valueSpec:_[S],style:o,styleSpec:d}):[new n.K(S,t[S],`unknown property "${S}"`)])}return y}const Qs={"*":()=>[],array:zt,boolean:function(u){const t=u.value,o=u.key,d=n.J(t);return d!=="boolean"?[new n.V(o,t,`boolean expected, ${d} found`)]:[]},number:Nt,color:function(u){const t=u.key,o=u.value,d=n.J(o);return d!=="string"?[new n.V(t,o,`color expected, ${d} found`)]:n.a0.parseCSSColor(o)===null?[new n.V(t,o,`color expected, "${o}" found`)]:[]},enum:Vt,filter:Ci,function:Qt,layer:$n,object:Rt,source:Hn,model:n.a4,light:Os,"light-3d":wr,terrain:wo,fog:Ds,string:wn,formatted:function(u){return wn(u).length===0?[]:Gt(u)},resolvedImage:function(u){return wn(u).length===0?[]:Gt(u)},projection:function(u){const t=u.value,o=u.styleSpec,d=o.projection,_=u.style;let y=[];const v=n.J(t);if(v==="object")for(const S in t)y=y.concat(An({key:S,value:t[S],valueSpec:d[S],style:_,styleSpec:o}));else v!=="string"&&(y=y.concat([new n.V("projection",t,`object or string expected, ${v} found`)]));return y},import:function(u){const{value:t,styleSpec:o}=u,{data:d,..._}=t;Object.defineProperty(_,"__line__",{value:t.__line__,enumerable:!1});let y=Rt(n.L({},u,{value:_,valueSpec:o.import}));return n.M(_.id)===""&&y.push(new n.V(`${u.key}.id`,_,"import id can't be an empty string")),d&&(y=y.concat(Vl(d,o,{key:`${u.key}.data`}))),y},iconset:function(u){const t=u.value,o=u.key,d=u.styleSpec,_=u.style;if(!t.type)return[new n.V(o,t,'"type" is required')];const y=n.M(t.type);let v=[];if(v=v.concat(Rt({key:o,value:t,valueSpec:d[`iconset_${y}`],style:_,styleSpec:d})),y==="source"&&t.source){const S=_.sources&&_.sources[t.source],A=S&&n.M(S.type);S?A!=="raster-array"&&v.push(new n.V(o,t.source,`iconset cannot be used with a source of type ${String(A)}, it only be used with a "raster-array" source type`)):v.push(new n.V(o,t.source,`source "${t.source}" not found`))}return v}};function An(u,t=!1){const o=u.value,d=u.valueSpec,_=u.styleSpec;if(d.expression&&n.a2(n.M(o)))return Qt(u);if(d.expression&&n.S(n.U(o)))return Gt(u);if(d.type&&Qs[d.type]){const y=Qs[d.type](u);return t===!0&&y.length>0&&n.J(u.value)==="array"?Gt(u):y}return Rt(n.L({},u,{valueSpec:d.type?_[d.type]:d}))}function fa(u){const t=u.value,o=u.key,d=wn(u);return d.length||(t.indexOf("{fontstack}")===-1&&d.push(new n.V(o,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&d.push(new n.V(o,t,'"glyphs" url must include a "{range}" token'))),d}function Vl(u,t=n.a5,o={}){return An({key:o.key||"",value:u,valueSpec:t.$root,styleSpec:t,style:u,objectElementValidators:{glyphs:fa,"*":()=>[]}})}function Tr(u,t=n.a5){return xe(Vl(u,t))}const Vf=u=>xe(Hn(u)),Du=u=>xe(Os(u)),Ka=u=>xe(wr(u)),_t=u=>xe(wo(u)),jo=u=>xe(Ds(u)),Uf=u=>xe(function(t){const o=t.value,d=t.style,_=t.styleSpec,y=_.snow;let v=[];const S=n.J(o);if(o===void 0)return v;if(S!=="object")return v=v.concat([new n.V("snow",o,`object expected, ${S} found`)]),v;for(const A in o){const P=A.match(/^(.*)-transition$/);v=v.concat(P&&y[P[1]]&&y[P[1]].transition?An({key:A,value:o[A],valueSpec:_.transition,style:d,styleSpec:_}):y[A]?An({key:A,value:o[A],valueSpec:y[A],style:d,styleSpec:_}):[new n.K(A,o[A],`unknown property "${A}"`)])}return v}(u)),Qc=u=>xe(function(t){const o=t.value,d=t.style,_=t.styleSpec,y=_.rain;let v=[];const S=n.J(o);if(o===void 0)return v;if(S!=="object")return v=v.concat([new n.V("rain",o,`object expected, ${S} found`)]),v;for(const A in o){const P=A.match(/^(.*)-transition$/);v=v.concat(P&&y[P[1]]&&y[P[1]].transition?An({key:A,value:o[A],valueSpec:_.transition,style:d,styleSpec:_}):y[A]?An({key:A,value:o[A],valueSpec:y[A],style:d,styleSpec:_}):[new n.K(A,o[A],`unknown property "${A}"`)])}return v}(u)),Yi=u=>xe($n(u)),Ne=u=>xe(Ci(u)),q=u=>xe(Vi(u)),J=u=>xe(ji(u)),le=u=>xe(n.a4(u));function xe(u){return u.slice().sort((t,o)=>t.line&&o.line?t.line-o.line:0)}function de(u,t){let o=!1;if(t&&t.length)for(const d of t)d instanceof n.K?n.w(d.message):(u.fire(new n.z(new Error(d.message))),o=!0);return o}let Se;class ke extends n.E{constructor(t,o="flat"){super(),this._transitionable=new n.a6(Se||(Se=new n.a7({anchor:new n.a8(n.a5.light.anchor),position:new n.a9(n.a5.light.position),color:new n.a8(n.a5.light.color),intensity:new n.a8(n.a5.light.intensity)}))),this.setLight(t,o),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,o,d={}){this._validate(Du,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=o)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&de(this,t.call(Tr,n.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let Ee=class extends n.E{constructor(u,t,o,d,_){super(),this.scope=o,this._transitionable=new n.a6(new n.a7({source:new n.a8(n.a5.terrain.source),exaggeration:new n.a8(n.a5.terrain.exaggeration)}),o,d),this._transitionable.setTransitionOrValue(u,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=_}get(){return this._transitionable.serialize()}set(u,t){this._transitionable.setTransitionOrValue(u,t)}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}getExaggeration(u){return this._transitioning.possiblyEvaluate(new n.aa(u,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const u=this._transitionable._values.exaggeration;if(!u)return null;const t=u.value.expression;if(!t)return null;let o=-1,d=-1,_=1;for(const y of t.zoomStops)_=t.evaluate(new n.aa(y,{worldview:this.worldview})),_>.01?(o=y,d=-1):d=y;return _<.01&&o>0&&d>o?[o,d]:null}isZoomDependent(){const u=this._transitionable._values.exaggeration;return u!=null&&u.value!=null&&u.value.expression!=null&&u.value.expression instanceof n.ab}};const Fe=45,et=65,Ve=.05;function mt(u,t,o,d){const _=n.af(Fe,et,o),[y,v]=kt(u,d);let S=1-Math.min(1,Math.exp((t-y)/(v-y)*-6));return S*=S*S,S=Math.min(1,1.00747*S),S*_*u.alpha}function kt(u,t){const o=.5/Math.tan(.5*t);return[u.range[0]+o,u.range[1]+o]}function Bt(u,t,o,d,_){const y=n.ad([],[t,o,d],_.mercatorFogMatrix);return mt(u,n.ae(y),_.pitch,_._fov)}function li(u,t,o,d,_,y,v){const S=[[o,d,0],[_,d,0],[_,y,0],[o,y,0]];let A=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(const D of S){const k=n.ad([],D,t),z=n.ae(k);A=Math.min(A,z),P=Math.max(P,z)}return[mt(u,A,v.pitch,v._fov),mt(u,P,v.pitch,v._fov)]}class ui extends n.E{constructor(t,o,d,_){super();const y=new n.a7({range:new n.a8(n.a5.fog.range),color:new n.a8(n.a5.fog.color),"color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.a8(n.a5.fog["high-color"]),"high-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.a8(n.a5.fog["space-color"]),"space-color-use-theme":new n.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.a8(n.a5.fog["horizon-blend"]),"star-intensity":new n.a8(n.a5.fog["star-intensity"]),"vertical-range":new n.a8(n.a5.fog["vertical-range"])});this._transitionable=new n.a6(y,d,new Map(_)),this.set(t,_),this._transitioning=this._transitionable.untransitioned(),this._transform=o,this.properties=new n.ag(y),this.scope=d}get state(){const t=this._transform,o=t.projection.name==="globe",d=n.ah(t.zoom),_=this.properties.get("range"),y=[.5,3];return{range:o?[n.ai(y[0],_[0],d),n.ai(y[1],_[1],d)]:_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,o,d={}){if(this._validate(jo,t,d))return;const _=n.h({},t);for(const y of Object.keys(n.a5.fog))_[y]===void 0&&(_[y]=n.a5.fog[y].default);this._options=_,this._transitionable.setTransitionOrValue(this._options,o)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const o=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.af(Fe,et,t))*o.a}getOpacityAtLatLng(t,o){return this._transform.projection.supportsFog?function(d,_,y){const v=n.ac.fromLngLat(_),S=y.elevation?y.elevation.getAtPointOrZero(v):0;return Bt(d,v.x,v.y,S,y)}(this.state,t,o):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const o=this._transform.calculateFogTileMatrix(t.toUnwrapped());return li(this.state,o,0,0,n.aj,n.aj,this._transform)}getOpacityForBounds(t,o,d,_,y){return this._transform.projection.supportsFog?li(this.state,t,o,d,_,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?kt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const o=[4,5,6,7];for(const d of o){const _=t.points[d];let y;if(_[2]>=0)y=_;else{const v=t.points[d-4];y=n.ak(v,_,v[2]/(v[2]-_[2]))}if(Bt(this.state,y[0],y[1],0,this._transform)>=Ve)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,o,d){return(!d||d.validate!==!1)&&de(this,t.call(Tr,n.h({value:o,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}}let mi,zi,Si,bn,Fn=class extends n.E{constructor(u,t,o,d){super();const _=mi||(mi=new n.a7({density:new n.a8(n.a5.snow.density),intensity:new n.a8(n.a5.snow.intensity),color:new n.a8(n.a5.snow.color),opacity:new n.a8(n.a5.snow.opacity),vignette:new n.a8(n.a5.snow.vignette),"vignette-color":new n.a8(n.a5.snow["vignette-color"]),"center-thinning":new n.a8(n.a5.snow["center-thinning"]),direction:new n.a8(n.a5.snow.direction),"flake-size":new n.a8(n.a5.snow["flake-size"])}));this._transitionable=new n.a6(_,o,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(_),this.scope=o}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),d=n.al(o[0]),_=-Math.max(n.al(o[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],v=this.properties.get("vignette"),S=this.properties.get("vignette-color");return S.a=v,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(u,t,o={}){if(this._validate(Uf,u,o))return;const d=n.h({},u);for(const _ of Object.keys(n.a5.snow))d[_]===void 0&&(d[_]=n.a5.snow[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,o){return(!o||o.validate!==!1)&&de(this,u.call(Tr,n.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}},Bn=class extends n.E{constructor(u,t,o,d){super();const _=zi||(zi=new n.a7({density:new n.a8(n.a5.rain.density),intensity:new n.a8(n.a5.rain.intensity),color:new n.a8(n.a5.rain.color),opacity:new n.a8(n.a5.rain.opacity),vignette:new n.a8(n.a5.rain.vignette),"vignette-color":new n.a8(n.a5.rain["vignette-color"]),"center-thinning":new n.a8(n.a5.rain["center-thinning"]),direction:new n.a8(n.a5.rain.direction),"droplet-size":new n.a8(n.a5.rain["droplet-size"]),"distortion-strength":new n.a8(n.a5.rain["distortion-strength"])}));this._transitionable=new n.a6(_,o,new Map(d)),this.set(u,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ag(_),this.scope=o}get state(){const u=this.properties.get("opacity"),t=this.properties.get("color"),o=this.properties.get("direction"),d=n.al(o[0]),_=-Math.max(n.al(o[1]),.01),y=[Math.cos(d)*Math.cos(_),Math.sin(d)*Math.cos(_),Math.sin(_)],v=this.properties.get("vignette-color");return v.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.am(t.r,t.g,t.b,t.a*u),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:v}}get(){return this._transitionable.serialize()}set(u,t,o={}){if(this._validate(Qc,u,o))return;const d=n.h({},u);for(const _ of Object.keys(n.a5.rain))d[_]===void 0&&(d[_]=n.a5.rain[_].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(u){this._transitionable.setTransitionOrValue(this._options,new Map(u))}updateTransitions(u){this._transitioning=this._transitionable.transitioned(u,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(u){this.properties=this._transitioning.possiblyEvaluate(u)}_validate(u,t,o){return(!o||o.validate!==!1)&&de(this,u.call(Tr,n.h({value:t,style:{glyphs:!0,sprite:!0},styleSpec:n.a5})))}};class hn extends n.E{constructor(t,o,d,_){super(),this.scope=d,this._options=t,this.properties=new n.ag(o),this._transitionable=new n.a6(o,d,new Map(_)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,o){this._options=t,this._transitionable.setTransitionOrValue(t.properties,o)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class Ji{constructor(t,o,d,_){this.screenBounds=t,this.cameraPoint=o,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=d,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,_)}static createFromScreenPoints(t,o){let d,_;if(t instanceof n.P||typeof t[0]=="number"){const y=n.P.convert(t);d=[y],_=o.isPointAboveHorizon(y)}else{const y=n.P.convert(t[0]),v=n.P.convert(t[1]),S=y.add(v)._div(2);d=[y,v],_=n.ao(y,v).every(A=>o.isPointAboveHorizon(A))&&o.isPointAboveHorizon(S)}return new Ji(d,o.getCameraPoint(),_,o)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return n.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],_=n.ao(o,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>o.x&&this.cameraPoint.x<d.x?_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?_[2]=this.cameraPoint:this.cameraPoint.x<=o.x&&(_[3]=this.cameraPoint)),n.ap(_,t)}bufferedCameraGeometryGlobe(t){const o=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],_=n.ao(o,d,t),y=this.cameraPoint.clone();switch(3*((y.y>o.y)+(y.y>d.y))+((y.x>o.x)+(y.x>d.x))){case 0:_[0]=y,_[4]=y.clone();break;case 1:_.splice(1,0,y);break;case 2:_[1]=y;break;case 3:_.splice(4,0,y);break;case 5:_.splice(2,0,y);break;case 6:_[3]=y;break;case 7:_.splice(3,0,y);break;case 8:_[2]=y}return _}containsTile(t,o,d,_=0){const y=t.queryPadding/o._pixelsPerMercatorPixel+1,v=d?this._bufferedCameraMercator(y,o):this._bufferedScreenMercator(y,o);let S=t.tileID.wrap+(v.unwrapped?_:0);const A=v.polygon.map(H=>n.aq(t.tileTransform,H,S));if(!n.ar(A,0,0,n.aj,n.aj))return;S=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?_:0);const P=this.screenGeometryMercator.polygon.map(H=>n.as(t.tileTransform,H,S)),D=P.map(H=>new n.P(H[0],H[1])),k=o.getFreeCameraOptions().position||new n.ac(0,0,0),z=n.as(t.tileTransform,k,S),F=P.map(H=>{const Z=n.at(H,H,z);return n.au(Z,Z),new n.av(z,Z)}),G=n.aw(t,1,o.zoom)*o._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:F,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(j=n.ax(A),j.min.x=n.ay(j.min.x,0,n.aj),j.min.y=n.ay(j.min.y,0,n.aj),j.max.x=n.ay(j.max.x,0,n.aj),j.max.y=n.ay(j.max.y,0,n.aj),j),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:G};var j}_bufferedScreenMercator(t,o){const d=Wn(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),o):{polygon:this.bufferedScreenGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=_,_}}_bufferedCameraMercator(t,o){const d=Wn(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let _;return _=o.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),o):{polygon:this.bufferedCameraGeometry(t).map(y=>o.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=_,_}}_projectAndResample(t,o){const d=function(y,v){const S=n.az([],v.pixelMatrix,v.globeMatrix),A=[0,-n.aB,0,1],P=[0,n.aB,0,1],D=[0,0,0,1];n.aA(A,A,S),n.aA(P,P,S),n.aA(D,D,S);const k=new n.P(A[0]/A[3],A[1]/A[3]),z=new n.P(P[0]/P[3],P[1]/P[3]),F=n.aC(y,k)&&A[3]<D[3],G=n.aC(y,z)&&P[3]<D[3];if(!F&&!G)return null;const j=function(ue,he,_e){for(let ye=1;ye<ue.length;ye++){const Le=Yn(he.pointCoordinate3D(ue[ye-1]).x),ze=Yn(he.pointCoordinate3D(ue[ye]).x);if(_e<0){if(Le<ze)return{idx:ye,t:-Le/(ze-1-Le)}}else if(ze<Le)return{idx:ye,t:(1-Le)/(ze+1-Le)}}return null}(y,v,F?-1:1);if(!j)return null;const{idx:H,t:Z}=j;let K=H>1?rs(y.slice(0,H),v):[],re=H<y.length?rs(y.slice(H),v):[];K=K.map(ue=>new n.P(Yn(ue.x),ue.y)),re=re.map(ue=>new n.P(Yn(ue.x),ue.y));const ce=[...K];ce.length===0&&ce.push(re[re.length-1]);const me=n.ai(ce[ce.length-1].y,(re.length===0?K[0]:re[0]).y,Z);let fe;return fe=F?[new n.P(0,me),new n.P(0,0),new n.P(1,0),new n.P(1,me)]:[new n.P(1,me),new n.P(1,1),new n.P(0,1),new n.P(0,me)],ce.push(...fe),re.length===0?ce.push(K[0]):ce.push(...re),{polygon:ce.map(ue=>new n.ac(ue.x,ue.y)),unwrapped:!1}}(t,o);if(d)return d;const _=function(y,v){let S=!1,A=-1/0,P=0;for(let k=0;k<y.length-1;k++)y[k].x>A&&(A=y[k].x,P=k);for(let k=0;k<y.length-1;k++){const z=(P+k)%(y.length-1),F=y[z],G=y[z+1];Math.abs(F.x-G.x)>.5&&(F.x<G.x?(F.x+=1,z===0&&(y[y.length-1].x+=1)):(G.x+=1,z+1===y.length-1&&(y[0].x+=1)),S=!0)}const D=n.aD(v.center.lng);return S&&D<Math.abs(D-1)&&y.forEach(k=>{k.x-=1}),{polygon:y,unwrapped:S}}(rs(t,o).map(y=>new n.P(Yn(y.x),y.y)),o);return{polygon:_.polygon.map(y=>new n.ac(y.x,y.y)),unwrapped:_.unwrapped}}}function rs(u,t){return n.aE(u,o=>{const d=t.pointCoordinate3D(o);o.x=d.x,o.y=d.y},1/256)}function Yn(u){return u<0?1+u%1:u%1}function Wn(u){return 100*u|0}function Bs(u,t,o,d,_){const y=function(S,A){if(S)return _(S);if(A){if(u.url&&A.tiles&&u.tiles&&delete u.tiles,A.variants){if(!Array.isArray(A.variants))return _(new Error("variants must be an array"));for(const D of A.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return _(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return _(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){A=n.h(A,D);break}}}const P=n.aF(n.h({},A,u),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);P.tiles=t.canonicalizeTileset(P,u.url),_(null,P)}},v=function(S,A,P){if(!S)return null;if(!A&&!P)return S;P=P||S.worldview_default;const D=Object.values(S.language||{});if(D.length===0)return null;const k=Object.values(S.worldview||{});if(k.length===0)return null;const z=D.every(G=>G===A),F=k.every(G=>G===P);return z&&F?S:A in(S.language_options||{})||P in(S.worldview_options||{})?null:S.language_options&&S.worldview_options?S:null}(u.data,o,d);return v?n.q.frame(()=>y(null,v)):u.url?n.n(t.transformRequest(t.normalizeSourceURL(u.url,null,o,d),n.R.Source),y):n.q.frame(()=>{const{data:S,...A}=u;y(null,A)})}function mr(u,t){const o=Math.pow(2,t.z),d=Math.floor(n.aD(u.getWest())*o),_=Math.floor(n.aH(u.getNorth())*o),y=Math.ceil(n.aD(u.getEast())*o),v=Math.ceil(n.aH(u.getSouth())*o);return t.x>=d&&t.x<y&&t.y>=_&&t.y<v}class er{constructor(t,o,d){this.bounds=t?n.aG.convert(this.validateBounds(t)):null,this.minzoom=o||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const o of t)this.extraBounds.push(n.aG.convert(this.validateBounds(o)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!mr(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const o of this.extraBounds)if(mr(o,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const o=new er(t.bounds,t.minzoom,t.maxzoom);return o.addExtraBounds(t.extra_bounds),o}}class eh extends n.E{constructor(t,o,d,_){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,n.h(this,n.aF(o,["url","scheme","tileSize","promoteId"])),this._options=n.h({type:"vector"},o),this._collectResourceTiming=!!o.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(_),this._tileWorkers={},this._deduped=new n.aI}load(t){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const o=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,o,d,(_,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,_)o&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${o}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new n.z(_));else if(y){if(n.h(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const v of y.vector_layers)this.vectorLayerIds.push(v.id),y.worldview&&y.worldview[v.source]&&this.localizableLayerIds.add(v.id)}this.tileBounds=er.fromTileJSON(y),jn(y.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}t&&t(_)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.h({},this._options)}loadTile(t,o){const d=t.tileID.canonical.url(this.tiles,this.scheme),_=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(_,n.R.Tile),v=this.map.style?this.map.style.getLut(this.scope):null,S=v?{image:v.image.clone()}:null,A={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:S,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&n.j(d)&&(A.localizableLayerIds=this.localizableLayerIds),A.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=o:t.request=t.actor.send("reloadTile",A,P.bind(this));else if(t.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",A,P.bind(this),void 0,!0);else{const D=n.aJ.call({deduped:this._deduped},A,(k,z)=>{k||!z?P.call(this,k):(A.data={cacheControl:z.cacheControl,expires:z.expires,rawData:z.rawData.slice(0)},t.actor&&t.actor.send("loadTile",A,P.bind(this),void 0,!0))},!0);t.request={cancel:D}}function P(D,k){return delete t.request,t.aborted?o(null):D&&D.status!==404?o(D):(k&&k.resourceTiming&&(t.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&t.setExpiryData(k),t.loadVectorData(k,this.map.painter),n.aK(this.dispatcher),o(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class js extends n.E{constructor(t,o,d,_){super(),this.id=t,this.dispatcher=d,this.setEventedParent(_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=n.h({type:"raster"},o),n.h(this,n.aF(o,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const o=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,null,o,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new n.z(d)):_&&(n.h(this,_),_.raster_layers&&(this.rasterLayers=_.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=er.fromTileJSON(_),jn(_.tiles),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return n.h({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,o){const d=n.q.devicePixelRatio>=2,_=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=n.o(this.map._requestManager.transformRequest(_,n.R.Tile),(y,v,S,A)=>(delete t.request,t.aborted?(t.state="unloaded",o(null)):y?(t.state="errored",o(y)):v?(this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:S,expires:A}),t.setTexture(v,this.map.painter),t.state="loaded",n.aK(this.dispatcher),void o(null)):o(null)))}abortTile(t,o){t.request&&(t.request.cancel(),delete t.request),o&&o()}unloadTile(t,o){t.texture&&t.texture instanceof n.T?(t.destroy(!0),t.texture&&t.texture instanceof n.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),o&&o()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pa extends js{constructor(t,o,d,_){super(t,o,d,_),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=n.h({type:"raster-array"},o)}triggerRepaint(t){const o=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);o&&o.enabled&&d&&o._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,o){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),_=this.map._requestManager.transformRequest(d,n.R.Tile),y={request:_,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=_,t.actor||(t.actor=this.dispatcher.getActor());const v=(S,A,P,D)=>{if(delete t.request,t.aborted)return t.state="unloaded",o(null);if(S)return S.name==="AbortError"?void 0:(t.state="errored",o(S));if(this.map._refreshExpiredTiles&&A&&t.setExpiryData({cacheControl:P,expires:D}),this.partial)t.state="empty";else{if(!A)return o(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=A}o(null)};t.request=this.partial?t.fetchHeader(void 0,v.bind(this)):t.actor.send("loadTile",y,v.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,o){const d=t.texture;d&&d instanceof n.T?(t.destroy(!0),this.map.painter.saveTileTexture(d)):(t.destroy(),t.flushQueues(),t._isHeaderLoaded=!1,delete t._mrt,delete t.textureDescriptor),t.fbo&&(t.fbo.destroy(),delete t.fbo),delete t.request,delete t.requestParams,delete t.neighboringTiles,t.state="unloaded"}prepareTile(t,o,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBand(o,d,(_,y)=>{if(_)return t.state="errored",this.fire(new n.z(_)),void this.triggerRepaint(t);y&&(t._isHeaderLoaded=!0,t.setTexture(y,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const o=this.rasterLayers.find(({id:y})=>y===t),d=o&&o.fields,_=d&&d.bands&&d.bands;return _?_[0]:0}getTextureDescriptor(t,o,d){if(!t)return;const _=o.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!_)return;let y=null;o instanceof n.aN?y=o.paint.get("raster-array-band"):o instanceof n.aO&&(y=o.paint.get("raster-particle-array-band"));const v=y||this.getInitialBand(_);if(v!=null)if(t.textureDescriptor){if(!t.updateNeeded(_,v)||d)return Object.assign({},t.textureDescriptor,{texture:t.texture})}else this.prepareTile(t,_,v)}getImages(t,o){const d=new Map;for(const _ of t)for(const y of o){const[v,S]=y.split("/"),A=_.getLayer(v);if(!A||!A.hasBand(S)||!A.hasDataForBand(S))continue;const{bytes:P,tileSize:D,buffer:k}=A.getBandView(S),z=D+2*k,F={data:new n.r({width:z,height:z},P),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(y,F)}return d}}const Ru={vector:eh,raster:js,"raster-dem":class extends js{constructor(u,t,o,d){super(u,t,o,d),this.type="raster-dem",this.maxzoom=22,this._options=n.h({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(u,t){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(_,y){_&&(u.state="errored",t(_)),y&&(u.dem=y,u.dem.onDeserialize(),u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0,u.state="loaded",t(null))}u.request=n.o(this.map._requestManager.transformRequest(o,n.R.Tile),(function(_,y,v,S){if(delete u.request,u.aborted)u.state="unloaded",t(null);else if(_)u.state="errored",t(_);else if(y){this.map._refreshExpiredTiles&&u.setExpiryData({cacheControl:v,expires:S});const A=ImageBitmap&&y instanceof ImageBitmap&&n.t(),P=1-(y.width-n.aL(y.width))/2;P<1||u.neighboringTiles||(u.neighboringTiles=this._getNeighboringTiles(u.tileID));const D=A?y:n.q.getImageData(y,P),k={uid:u.uid,tileID:u.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:P};u.actor&&u.state!=="expired"||(u.actor=this.dispatcher.getActor(),u.actor.send("loadTile",k,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(u){const t=u.canonical,o=Math.pow(2,t.z),d=(t.x-1+o)%o,_=t.x===0?u.wrap-1:u.wrap,y=(t.x+1+o)%o,v=t.x+1===o?u.wrap+1:u.wrap,S={};return S[new n.aM(u.overscaledZ,_,t.z,d,t.y).key]={backfilled:!1},S[new n.aM(u.overscaledZ,v,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(S[new n.aM(u.overscaledZ,_,t.z,d,t.y-1).key]={backfilled:!1},S[new n.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},S[new n.aM(u.overscaledZ,v,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<o&&(S[new n.aM(u.overscaledZ,_,t.z,d,t.y+1).key]={backfilled:!1},S[new n.aM(u.overscaledZ,u.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},S[new n.aM(u.overscaledZ,v,t.z,y,t.y+1).key]={backfilled:!1}),S}},"raster-array":pa,geojson:class extends n.E{constructor(u,t,o,d){super(),this.id=u,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=o.getActor(),this.setEventedParent(d),this._data=t.data,this._options=n.h({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const _=n.aj/this.tileSize;this.workerOptions=n.h({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*_,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*_,extent:n.aj,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:n.aj,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*_,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(u){this.map=u,this.setData(this._data)}setData(u){return this._data=u,this._updateWorkerData(),this}updateData(u){if(!this._options.dynamic)return this.fire(new n.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof u!="string"&&(u.type==="Feature"&&(u={type:"FeatureCollection",features:[u]}),u.type!=="FeatureCollection"))return this.fire(new n.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof u!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const o of this._data.features)t.set(o.id,o);for(const o of u.features)t.set(o.id,o);this._data.features=[...t.values()]}else this._data=u;return this._updateWorkerData(!0),this}getClusterExpansionZoom(u,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterChildren(u,t){return this.actor.send("geojson.getClusterChildren",{clusterId:u,source:this.id,scope:this.scope},t),this}getClusterLeaves(u,t,o,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:u,limit:t,offset:o},d),this}_updateWorkerData(u=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.A("dataloading",{dataType:"source"})),this._loaded=!1;const t=n.h({append:u},this.workerOptions);t.scope=this.scope;const o=this._data;typeof o=="string"?(t.request=this.map._requestManager.transformRequest(n.q.resolveURL(o),n.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(o),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,_)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new n.z(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(y.resourceTiming=_.resourceTiming[this.id]),u&&(this._partialReload=!0),this.fire(new n.A("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(u),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const u=n.C(this.id,this.scope);this.map.style.clearSource(u),this._updateWorkerData()}loadTile(u,t){const o=u.actor?"reloadTile":"loadTile";u.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,_=d?{image:d.image.clone()}:null,y=this._partialReload,v={type:this.type,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:_,scope:this.scope,pixelRatio:n.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:u.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview()};u.request=this.actor.send(o,v,(S,A)=>y&&!A?(u.state="loaded",t(null)):(delete u.request,u.destroy(),u.aborted?t(null):S?t(S):(u.loadVectorData(A,this.map.painter,o==="reloadTile"),t(null))),void 0,o==="loadTile")}abortTile(u){u.request&&(u.request.cancel(),delete u.request),u.aborted=!0}unloadTile(u,t){this.actor.send("removeTile",{uid:u.uid,type:this.type,source:this.id,scope:this.scope}),u.destroy()}onRemove(u){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return n.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aP{constructor(u,t,o,d){super(u,t,o,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const u=this.options;this.urls=[];for(const t of u.urls)this.urls.push(this.map._requestManager.transformRequest(t,n.R.Source).url);n.aQ(this.urls,(t,o)=>{this._loaded=!0,t?this.fire(new n.z(t)):o&&(this.video=o,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(u){if(this.video){const t=this.video.seekable;u<t.start(0)||u>t.end(0)?this.fire(new n.z(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=u}}getVideo(){return this.video}onAdd(u){this.map||(this.map=u,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const u=this.map.painter.context,t=u.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(u,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(u)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aP,model:class extends n.E{constructor(u,t,o,d){super(),this.id=u,this.type="model",this.models=[],this._loaded=!1,this._options=t}load(){const u=[];for(const t in this._options.models){const o=this._options.models[t],d=n.aS(this.map._requestManager.transformRequest(o.uri,n.R.Model).url).then(_=>{if(!_)return;const y=n.aT(_),v=new n.aU(t,o.position,o.orientation,y);v.computeBoundsAndApplyParent(),this.models.push(v)}).catch(_=>{this.fire(new n.z(new Error(`Could not load model ${t} from ${o.uri}: ${_.message}`)))});u.push(d)}Promise.allSettled(u).then(()=>{this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(t=>{this._loaded=!0,this.fire(new n.z(new Error(`Could not load models: ${t.message}`)))})}onAdd(u){this.map=u,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(u,t){}serialize(){return this._options}},"batched-model":class extends n.E{constructor(u,t,o,d){super(),this.type="batched-model",this.id=u,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=o,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(u){this.map=u,this.load()}reload(){this.cancelTileJSONRequest();const u=n.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(u))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(u){this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,o=this.map.getWorldview();this._tileJSONRequest=Bs(this._options,this.map._requestManager,t,o,(d,_)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),o&&o.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${o}`),this.fire(new n.z(d))):_&&(n.h(this,_),_.bounds&&(this.tileBounds=new er(_.bounds,this.minzoom,this.maxzoom)),jn(_.tiles,this.map._requestManager._customAccessToken),this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))),u&&u(d)})}hasTransition(){return!1}hasTile(u){return!this.tileBounds||this.tileBounds.contains(u.canonical)}loaded(){return this._loaded}loadTile(u,t){const o=this.map._requestManager.normalizeTileURL(u.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(o,n.R.Tile),data:void 0,uid:u.uid,tileID:u.tileID,tileZoom:u.tileZoom,zoom:u.tileID.overscaledZ,tileSize:this.tileSize*u.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:u.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.q.devicePixelRatio,promoteId:this.promoteId};if(u.actor&&u.state!=="expired")if(u.state==="loading")u.reloadCallback=t;else{if(u.buckets){const y=Object.values(u.buckets);for(const v of y)v.dirty=!0;return void(u.state="loaded")}u.request=u.actor.send("reloadTile",d,_.bind(this))}else u.actor=this.dispatcher.getActor(),u.request=u.actor.send("loadTile",d,_.bind(this),void 0,!0);function _(y,v){return u.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&v&&u.setExpiryData(v),u.loadModelData(v,this.map.painter),u.state="loaded",void t(null))}}serialize(){return n.h({},this._options)}},canvas:class extends n.aP{constructor(u,t,o,d){super(u,t,o,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(_=>!Array.isArray(_)||_.length!==2||_.some(y=>typeof y!="number"))||this.fire(new n.z(new n.V(`sources.${u}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.z(new n.V(`sources.${u}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new n.z(new n.V(`sources.${u}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new n.z(new n.V(`sources.${u}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.z(new n.V(`sources.${u}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(u){this.map=u,this.load(),this.canvas&&this.animate&&this.play()}onRemove(u){this.pause()}prepare(){let u=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,u=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,u=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!u&&!this._playing||this.texture instanceof n.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const u of[this.canvas.width,this.canvas.height])if(isNaN(u)||u<=0)return!0;return!1}},custom:class extends n.E{constructor(u,t,o,d){super(),this.id=u,this.type="custom",this._dataType="raster",this._dispatcher=o,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new er(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),n.h(this,n.aF(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(u){this.map=u,this._loaded=!1,this.fire(new n.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(u),this.load()}onRemove(u){this._implementation.onRemove&&this._implementation.onRemove(u)}hasTile(u){if(this._implementation.hasTile){const{x:t,y:o,z:d}=u.canonical;return this._implementation.hasTile({x:t,y:o,z:d})}return!this.tileBounds||this.tileBounds.contains(u.canonical)}loadTile(u,t){const{x:o,y:d,z:_}=u.tileID.canonical,y=new AbortController;u.request=Promise.resolve(this._implementation.loadTile({x:o,y:d,z:_},{signal:y.signal})).then((function(v){return delete u.request,u.aborted?(u.state="unloaded",t(null)):v===void 0?(u.state="errored",t(null)):v===null?(this.loadTileData(u,{width:this.tileSize,height:this.tileSize,data:null}),u.state="loaded",t(null)):function(S){return S instanceof ImageData||S instanceof HTMLCanvasElement||S instanceof ImageBitmap||S instanceof HTMLImageElement}(v)?(this.loadTileData(u,v),u.state="loaded",void t(null)):(u.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(v=>{v.name!=="AbortError"&&(u.state="errored",t(v))}),u.request.cancel=()=>y.abort()}loadTileData(u,t){u.setTexture(t,this.map.painter)}unloadTile(u,t){if(u.texture&&u.texture instanceof n.T?(u.destroy(!0),u.texture&&u.texture instanceof n.T&&this.map.painter.saveTileTexture(u.texture)):u.destroy(),this._implementation.unloadTile){const{x:o,y:d,z:_}=u.tileID.canonical;this._implementation.unloadTile({x:o,y:d,z:_})}t&&t()}abortTile(u,t){u.request&&u.request.cancel&&(u.request.cancel(),delete u.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(u=>({x:u.canonical.x,y:u.canonical.y,z:u.canonical.z}))}_clearTiles(){const u=n.C(this.id,this.scope);this.map.style.clearSource(u)}_update(){this.fire(new n.A("data",{dataType:"source",sourceDataType:"content"}))}}},th=function(u,t,o,d){const _=new Ru[t.type](u,t,o,d);if(_.id!==u)throw new Error(`Expected Source id to be ${u} instead of ${_.id}`);return n.aV(["load","abort","unload","serialize","prepare"],_),_};function ih(u,t,o=""){return`${o}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:_,importId:y}=d;return`featureset:${_}${y?`:import:${y}`:""}`}}(u.target)}`}function Lu(u,t,o,d=""){if(u.uniqueFeatureID){const _=ih(u,t,d);if(o.has(_))return!0;o.add(_)}return!1}function zu(u,t,o,d,_=!1){const y=t.sourceCache.transform,v=t.sourceCache.tilesIn(u,t.has3DLayers,_);v.sort(Ou);const S=[];for(const A of v){const P=A.tile.queryRenderedFeatures(t,A,o,d,y,_);Object.keys(P).length&&S.push({wrappedTileID:A.tile.tileID.wrapped().key,queryResults:P})}return S.length===0?{}:function(A){const P={},D={};for(const k of A){const z=k.queryResults,F=k.wrappedTileID,G=D[F]=D[F]||{};for(const j in z){const H=z[j],Z=G[j]=G[j]||{},K=P[j]=P[j]||[];for(const re of H)Z[re.featureIndex]||(Z[re.featureIndex]=!0,K.push(re))}}return P}(S)}function Ja(u,t,o,d,_,y){const v={},S=d.queryRenderedSymbols(u),A=[];for(const P of Object.keys(S).map(Number))A.push(_[P]);A.sort(Ou);for(const P of A){const D=P.featureIndex.lookupSymbolFeatures(S[P.bucketInstanceId],P.bucketIndex,P.sourceLayerIndex,t,o,y);for(const k in D){const z=v[k]=v[k]||[],F=D[k];F.sort((G,j)=>{const H=P.featureSortOrder;if(H){const Z=H.indexOf(G.featureIndex);return H.indexOf(j.featureIndex)-Z}return j.featureIndex-G.featureIndex});for(const G of F)z.push(G)}}return v}function nh(u,t){const o=u.getRenderableIds().map(y=>u.getTileByID(y)),d=[],_={};for(let y=0;y<o.length;y++){const v=o[y],S=v.tileID.canonical.key;_[S]||(_[S]=!0,v.querySourceFeatures(d,t))}return d}function Ou(u,t){const o=u.tileID,d=t.tileID;return o.overscaledZ-d.overscaledZ||o.canonical.y-d.canonical.y||o.wrap-d.wrap||o.canonical.x-d.canonical.x}function no(u,t){const o={};if(!t)return o;for(const d of u){const _=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(_.length!==0){d.layers=_,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>_.filter(v=>v.id===y)[0]));for(const y of _)o[y.fqid]=d}}return o}const zr=32,Hr=33,$o=new Uint16Array(8184);for(let u=0;u<2046;u++){let t=u+2,o=0,d=0,_=0,y=0,v=0,S=0;for(1&t?_=y=v=zr:o=d=S=zr;(t>>=1)>1;){const P=o+_>>1,D=d+y>>1;1&t?(_=o,y=d,o=v,d=S):(o=_,d=y,_=v,y=S),v=P,S=D}const A=4*u;$o[A+0]=o,$o[A+1]=d,$o[A+2]=_,$o[A+3]=y}const so=new Uint16Array(2178),Go=new Uint8Array(1089),sh=new Uint16Array(1089);function To(u){return u===0?-.03125:u===32?.03125:0}const rh={type:2,extent:n.aj,loadGeometry:()=>[[new n.P(0,0),new n.P(n.aj+1,0),new n.P(n.aj+1,n.aj+1),new n.P(0,n.aj+1),new n.P(0,0)]]};class Qa{constructor(t,o,d,_,y,v){this.tileID=t,this.uid=n.a$(),this.uses=0,this.tileSize=o,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,_&&_.style&&(this._lastUpdatedBrightness=_.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",_&&_.transform&&(this.projection=_.transform.projection),this.worldview=v}registerFadeDuration(t){const o=t+this.timeAdded;o<n.q.now()||this.fadeEndTime&&o<this.fadeEndTime||(this.fadeEndTime=o)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,o,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=no(t.buckets,o.style),this.hasSymbolBuckets=!1;for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof n.b1){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const _ in this.buckets){const y=this.buckets[_];if(y instanceof n.b1&&y.hasRTLText){this.hasRTLText=!0,n.b2();break}}this.queryPadding=0;for(const _ in this.buckets){const y=this.buckets[_],v=o.style.getOwnLayer(_);if(!v)continue;const S=v.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,S)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new n.b0}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,o,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,no(t.buckets,o.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t){for(const _ in this.buckets){const y=this.buckets[_];y.uploadPending()&&y.upload(t)}const o=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new n.T(t,d.image,o.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(t,this.glyphAtlasImage,o.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(t,this.lineAtlas.image,o.R8),this.lineAtlas.uploaded=!0)}prepare(t,o,d){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d),!o||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const _=o.style.getBrightness();(this._lastUpdatedBrightness||_)&&(this._lastUpdatedBrightness&&_&&Math.abs(this._lastUpdatedBrightness-_)<.001||(this.updateBuckets(o,this._lastUpdatedBrightness!==_),this._lastUpdatedBrightness=_))}queryRenderedFeatures(t,o,d,_,y,v){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const S=function(A,P){const D=n.bn([],[.5*A.width,.5*-A.height,1]);return n.bo(D,D,[1,-1,0]),n.az(D,D,A.calculateProjMatrix(P.toUnwrapped())),Float32Array.from(D)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:o,pixelPosMatrix:S,transform:_,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(t,o){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const _=d.loadVTLayers(),y=o?o.sourceLayer:"",v=_._geojsonTileLayer||_[y];if(!v)return;const S=n.b3(o&&o.filter),{z:A,x:P,y:D}=this.tileID.canonical,k={z:A,x:P,y:D};for(let z=0;z<v.length;z++){const F=v.feature(z);if(S.needGeometry){const H=n.b4(F,!0);if(!S.filter(new n.aa(this.tileID.overscaledZ,{worldview:this.worldview}),H,this.tileID.canonical))continue}else if(!S.filter(new n.aa(this.tileID.overscaledZ,{worldview:this.worldview}),F))continue;const G=d.getId(F,y),j=new n.b5(F,A,P,D,G);j.tile=k,t.push(j)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const o=this.expirationTime;if(t.cacheControl){const d=n.b6(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let _=!1;if(this.expirationTime>d)_=!1;else if(o)if(this.expirationTime<o)_=!0;else{const y=this.expirationTime-o;y?this.expirationTime=d+Math.max(y,3e4):_=!0}else _=!0;_?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}updateBuckets(t,o){if(!this.latestFeatureIndex||!t.style)return;const d=this.latestFeatureIndex.loadVTLayers(),_=t.style.listImages(),y=t.style.getBrightness();for(const v in this.buckets){if(!t.style.hasLayer(v))continue;const S=this.buckets[v],A=S.layers[0],P=A.sourceLayer||"_geojsonTileLayer",D=d[P],k=t.style.getLayerSourceCache(A);let z={};k&&(z=k._state.getState(P,void 0));const F=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},G=Object.keys(z).length>0&&!o;G&&!S.stateDependentLayers.length&&!o||S.update(z,D,_,F,G?S.stateDependentLayers:S.layers,o,y),(S instanceof n.b7||S instanceof n.b8)&&t._terrain&&t._terrain.enabled&&k&&S.uploadPending()&&t._terrain._clearRenderCacheForTile(k.id,this.tileID);const j=t&&t.style&&t.style.getOwnLayer(v);j&&(this.queryPadding=Math.max(this.queryPadding,j.queryRadius(S)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=n.q.now()+t}setTexture(t,o){const d=o.context,_=d.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t):(this.texture=new n.T(d,t,_.RGBA8,{useMipmap:!0}),this.texture.bind(_.LINEAR,_.CLAMP_TO_EDGE))}setDependencies(t,o){const d={};for(const _ of o)d[_]=!0;this.dependencies[t]=d}hasDependency(t,o){for(const d of t){const _=this.dependencies[d];if(_){for(const y of o)if(_[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,o){if(!o||o.name==="mercator"||this._tileDebugBuffer)return;const d=n.b9(rh,this.tileID.canonical,this.tileTransform)[0],_=new n.ba,y=new n.bb;for(let v=0;v<d.length;v++){const{x:S,y:A}=d[v];_.emplaceBack(S,A),y.emplaceBack(v)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(_,n.bc.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,_.length,y.length)}_makeTileBoundsBuffers(t,o){if(this._tileBoundsBuffer||!o||o.name==="mercator")return;const d=n.b9(rh,this.tileID.canonical,this.tileTransform)[0];let _,y;if(this.isRaster){const v=function(S,A){const P=n.aW(S,A),D=Math.pow(2,S.z);for(let H=0;H<Hr;H++)for(let Z=0;Z<Hr;Z++){const K=n.aX((S.x+(Z+To(Z))/zr)/D),re=n.aY((S.y+(H+To(H))/zr)/D),ce=A.project(K,re),me=H*Hr+Z;so[2*me+0]=Math.round((ce.x*P.scale-P.x)*n.aj),so[2*me+1]=Math.round((ce.y*P.scale-P.y)*n.aj)}Go.fill(0),sh.fill(0);for(let H=2045;H>=0;H--){const Z=4*H,K=$o[Z+0],re=$o[Z+1],ce=$o[Z+2],me=$o[Z+3],fe=K+ce>>1,ue=re+me>>1,he=fe+ue-re,_e=ue+K-fe,ye=re*Hr+K,Le=me*Hr+ce,ze=ue*Hr+fe,qe=Math.hypot((so[2*ye+0]+so[2*Le+0])/2-so[2*ze+0],(so[2*ye+1]+so[2*Le+1])/2-so[2*ze+1])>=16;Go[ze]=Go[ze]||(qe?1:0),H<1022&&(Go[ze]=Go[ze]||Go[(re+_e>>1)*Hr+(K+he>>1)]||Go[(me+_e>>1)*Hr+(ce+he>>1)])}const k=new n.aZ,z=new n.a_;let F=0;function G(H,Z){const K=Z*Hr+H;return sh[K]===0&&(k.emplaceBack(so[2*K+0],so[2*K+1],H*n.aj/zr,Z*n.aj/zr),sh[K]=++F),sh[K]-1}function j(H,Z,K,re,ce,me){const fe=H+K>>1,ue=Z+re>>1;if(Math.abs(H-ce)+Math.abs(Z-me)>1&&Go[ue*Hr+fe])j(ce,me,H,Z,fe,ue),j(K,re,ce,me,fe,ue);else{const he=G(H,Z),_e=G(K,re),ye=G(ce,me);z.emplaceBack(he,_e,ye)}}return j(0,0,zr,zr,zr,0),j(zr,zr,0,0,0,zr),{vertices:k,indices:z}}(this.tileID.canonical,o);_=v.vertices,y=v.indices}else{_=new n.aZ,y=new n.a_;for(const{x:S,y:A}of d)_.emplaceBack(S,A,0,0);const v=n.be(_.int16.subarray(0,4*_.length),void 0,4);for(let S=0;S<v.length;S+=3)y.emplaceBack(v[S],v[S+1],v[S+2])}this._tileBoundsBuffer=t.createVertexBuffer(_,n.bf.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=n.bd.simpleSegment(0,0,_.length,y.length)}_makeGlobeTileDebugBuffers(t,o){const d=o.projection;if(!d||d.name!=="globe"||o.freezeTileCoverage)return;const _=this.tileID.canonical,y=n.bg(_,o),v=n.bh(y),S=n.ah(o.zoom);let A;S>0&&(A=n.bi(new Float64Array(16),o.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,_,o,v,A,S),this._makeGlobeTileDebugTextBuffer(t,_,o,v,A,S)}_globePoint(t,o,d,_,y,v,S){let A=n.bj(t,o,d);if(v){const P=1<<d.z,D=n.aD(_.center.lng),k=n.aH(_.center.lat),z=(d.x+.5)/P-D;let F=0;z>.5?F=-1:z<-.5&&(F=1);let G=(t/n.aj+d.x)/P+F,j=(o/n.aj+d.y)/P;G=(G-D)*_._pixelsPerMercatorPixel+D,j=(j-k)*_._pixelsPerMercatorPixel+k;const H=[G*_.worldSize,j*_.worldSize,0];n.ad(H,H,v),A=n.bk(A,H,S)}return n.ad(A,A,y)}_makeGlobeTileDebugBorderBuffer(t,o,d,_,y,v){const S=new n.ba,A=new n.bb,P=new n.bl,D=(z,F,G,j,H)=>{const Z=(G-z)/(H-1),K=(j-F)/(H-1),re=S.length;for(let ce=0;ce<H;ce++){const me=z+ce*Z,fe=F+ce*K;S.emplaceBack(me,fe);const ue=this._globePoint(me,fe,o,d,_,y,v);P.emplaceBack(ue[0],ue[1],ue[2]),A.emplaceBack(re+ce)}},k=n.aj;D(0,0,k,0,16),D(k,0,k,k,16),D(k,k,0,k,16),D(0,k,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(A),this._tileDebugBuffer=t.createVertexBuffer(S,n.bc.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(P,n.bm.members),this._tileDebugSegments=n.bd.simpleSegment(0,0,S.length,A.length)}_makeGlobeTileDebugTextBuffer(t,o,d,_,y,v){const S=n.aj/4,A=new n.ba,P=new n.a_,D=new n.bl,k=25;P.reserve(32),A.reserve(k),D.reserve(k);const z=(F,G)=>k*F+G;for(let F=0;F<k;F++){const G=F*S;for(let j=0;j<k;j++){const H=j*S;A.emplaceBack(H,G);const Z=this._globePoint(H,G,o,d,_,y,v);D.emplaceBack(Z[0],Z[1],Z[2])}}for(let F=0;F<4;F++)for(let G=0;G<4;G++){const j=z(F,G),H=z(F,G+1),Z=z(F+1,G),K=z(F+1,G+1);P.emplaceBack(j,H,Z),P.emplaceBack(Z,H,K)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(P),this._tileDebugTextBuffer=t.createVertexBuffer(A,n.bc.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(D,n.bm.members),this._tileDebugTextSegments=n.bd.simpleSegment(0,0,k,32)}destroy(t=!1){for(const o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!t&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bp.setPbf(n.bq);class Ul extends Qa{constructor(t,o,d,_,y){super(t,o,d,_,y),this._workQueue=[],this._fetchQueue=[],this._isHeaderLoaded=!1}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexture(t,o){const d=o.context,_=d.gl;this.texture=this.texture||o.getTileTexture(t.width),this.texture&&this.texture instanceof n.T?this.texture.update(t,{premultiply:!1}):this.texture=new n.T(d,t,_.RGBA8,{premultiply:!1})}flushQueues(){for(;this._workQueue.length;)this._workQueue.pop()();for(;this._fetchQueue.length;)this._fetchQueue.pop()()}fetchHeader(t=16384,o){const d=this._mrt=new n.bp(30),_=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=n.br(_,(y,v,S,A)=>{if(y)o(y);else try{const P=d.getHeaderLength(v);if(P>t)return void(this.request=this.fetchHeader(P,o));d.parseHeader(v),this._isHeaderLoaded=!0;let D=0;for(const k of Object.values(d.layers))D=Math.max(D,k.dataIndex[k.dataIndex.length-1].lastByte);v.byteLength>=D&&(this.entireBuffer=v),o(null,this.entireBuffer||v,S,A)}catch(P){o(P)}}),this.request}fetchBand(t,o,d){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void d(new Error("Tile header is not ready"));const y=this.actor;if(!y)return void d(new Error("Can't fetch tile band without an actor"));let v;const S=(k,z)=>{v.complete(k,z),k?d(k):(this.updateTextureDescriptor(t,o),d(null,this.textureDescriptor&&this.textureDescriptor.img))},A=(k,z)=>{if(k)return d(k);const F=y.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:z,task:v},S,void 0,!0);this._workQueue.push(()=>{F&&F.cancel(),v.cancel()})},P=_.getLayer(t);if(!P)return void d(new Error(`Unknown sourceLayer "${t}"`));if(P.hasDataForBand(o))return this.updateTextureDescriptor(t,o),void d(null,this.textureDescriptor?this.textureDescriptor.img:null);const D=P.getDataRange([o]);if(v=_.createDecodingTask(D),!v||v.tasks.length)if(this.flushQueues(),this.entireBuffer)A(null,this.entireBuffer.slice(D.firstByte,D.lastByte+1));else{const k=Object.assign({},this.requestParams,{headers:{Range:`bytes=${D.firstByte}-${D.lastByte}`}}),z=n.br(k,A);this._fetchQueue.push(()=>{z.cancel(),v.cancel()})}else d(null)}updateNeeded(t,o){return(!this.textureDescriptor||this.textureDescriptor.band!==o||this.textureDescriptor.layer!==t)&&this.state!=="errored"}updateTextureDescriptor(t,o){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(o)||!d.hasDataForBand(o))return;const{bytes:_,tileSize:y,buffer:v,offset:S,scale:A}=d.getBandView(o),P=y+2*v,D=new n.r({width:P,height:P},_),k=this.texture;k&&k instanceof n.T&&k.update(D,{premultiply:!1}),this.textureDescriptor={layer:t,band:o,img:D,buffer:v,offset:S,tileSize:y,format:d.pixelFormat,mix:[A,256*A,65536*A,16777216*A]}}}class jf{constructor(t,o){this.max=t,this.onRemove=o,this.reset()}reset(){for(const t in this.data)for(const o of this.data[t])o.timeout&&clearTimeout(o.timeout),this.onRemove(o.value);return this.data={},this.order=[],this}add(t,o,d){const _=t.wrapped().key;this.data[_]===void 0&&(this.data[_]=[]);const y={value:o,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[_].push(y),this.order.push(_),this.order.length>this.max){const v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const o=this.data[t].shift();return o.timeout&&clearTimeout(o.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),o.value}getByKey(t){const o=this.data[t];return o?o[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,o){if(!this.has(t))return this;const d=t.wrapped().key,_=o===void 0?0:this.data[d].indexOf(o),y=this.data[d][_];return this.data[d].splice(_,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}filter(t){const o=[];for(const d in this.data)for(const _ of this.data[d])t(_.value)||o.push(_);for(const d of o)this.remove(d.value.tileID,d)}}class $f{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,o,d){const _=String(o);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][_]=this.stateChanges[t][_]||{},n.h(this.stateChanges[t][_],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==_&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][_]===null){this.deletedStates[t][_]={};for(const y in this.state[t][_])d[y]||(this.deletedStates[t][_][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][_]&&this.deletedStates[t][_][y]===null&&delete this.deletedStates[t][_][y]}removeFeatureState(t,o,d){if(this.deletedStates[t]===null)return;const _=String(o);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&o!==void 0)this.deletedStates[t][_]!==null&&(this.deletedStates[t][_]=this.deletedStates[t][_]||{},this.deletedStates[t][_][d]=null);else if(o!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][_])for(d in this.deletedStates[t][_]={},this.stateChanges[t][_])this.deletedStates[t][_][d]=null;else this.deletedStates[t][_]=null;else this.deletedStates[t]=null}getState(t,o){const d=this.state[t]||{},_=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(o!==void 0){const S=String(o),A=n.h({},d[S],_[S]);if(y){const P=y[o];if(P===null)return{};for(const D in P)delete A[D]}return A}const v=n.h({},d,_);if(y)for(const S in y)delete v[S];return v}initializeTileState(t,o){t.refreshFeatureState(o)}coalesceChanges(t,o){const d={};for(const _ in this.stateChanges){this.state[_]=this.state[_]||{};const y={};for(const v in this.stateChanges[_])this.state[_][v]||(this.state[_][v]={}),n.h(this.state[_][v],this.stateChanges[_][v]),y[v]=this.state[_][v];d[_]=y}for(const _ in this.deletedStates){this.state[_]=this.state[_]||{};const y={};if(this.deletedStates[_]===null)for(const v in this.state[_])y[v]={},this.state[_][v]={};else for(const v in this.deletedStates[_]){if(this.deletedStates[_][v]===null)this.state[_][v]={};else if(this.state[_][v])for(const S of Object.keys(this.deletedStates[_][v]))delete this.state[_][v][S];y[v]=this.state[_][v]}d[_]=d[_]||{},n.h(d[_],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const _ in t)t[_].refreshFeatureState(o)}}class _r extends n.E{constructor(t,o,d){super(),this.id=t,this._onlySymbols=d,o.on("data",_=>{_.dataType==="source"&&_.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&_.dataType==="source"&&_.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),o.on("error",()=>{this._sourceErrored=!0}),this._source=o,this._tiles={},this._cache=new jf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=o.minTileCacheSize,this._maxTileCacheSize=o.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $f,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,o){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,o)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const o in this._tiles){const d=this._tiles[o];d.upload(t),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(el).map(t=>t.key)}getRenderableIds(t,o){const d=[];for(const _ in this._tiles)this._isIdRenderable(+_,t,o)&&d.push(this._tiles[_]);return t?d.sort((_,y)=>{const v=_.tileID,S=y.tileID,A=new n.P(v.canonical.x,v.canonical.y)._rotate(this.transform.angle),P=new n.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return v.overscaledZ-S.overscaledZ||P.y-A.y||P.x-A.x}).map(_=>_.tileID.key):d.map(_=>_.tileID).sort(el).map(_=>_.key)}hasRenderableParent(t){const o=this.findLoadedParent(t,0);return!!o&&this._isIdRenderable(o.tileID.key)}_isIdRenderable(t,o,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(o||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,o){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=o),this._loadTile(d,this._tileLoaded.bind(this,d,t,o)))}_tileLoaded(t,o,d,_){if(_)if(t.state="errored",_.status!==404)this._source.fire(new n.z(_,{tile:t}));else{if(this._source.fire(new n.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const y=this.map.painter.terrain;this.update(this.transform,y.getScaledDemTileSize(),!0),y.resetTileLookupCache(this.id)}else this.update(this.transform)}else t.timeAdded=n.q.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(o,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new n.A("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const o=this.getRenderableIds();for(let _=0;_<o.length;_++){const y=o[_];if(t.neighboringTiles&&t.neighboringTiles[y]){const v=this.getTileByID(y);d(t,v),d(v,t)}}function d(_,y){if(!_.dem||_.dem.borderReady)return;_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0;let v=y.tileID.canonical.x-_.tileID.canonical.x;const S=y.tileID.canonical.y-_.tileID.canonical.y,A=Math.pow(2,_.tileID.canonical.z),P=y.tileID.key;v===0&&S===0||Math.abs(S)>1||(Math.abs(v)>1&&(Math.abs(v+A)===1?v+=A:Math.abs(v-A)===1&&(v-=A)),y.dem&&_.dem&&(_.dem.backfillBorder(y.dem,v,S),_.neighboringTiles&&_.neighboringTiles[P]&&(_.neighboringTiles[P].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,o,d,_){for(const y in this._tiles){let v=this._tiles[y];if(_[y]||!v.hasData()||v.tileID.overscaledZ<=o||v.tileID.overscaledZ>d)continue;let S=v.tileID;for(;v&&v.tileID.overscaledZ>o+1;){const P=v.tileID.scaledTo(v.tileID.overscaledZ-1);v=this._tiles[P.key],v&&v.hasData()&&(S=P)}let A=S;for(;A.overscaledZ>o;)if(A=A.scaledTo(A.overscaledZ-1),t[A.key]){_[S.key]=S;break}}}findLoadedParent(t,o){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=o?d:null}for(let d=t.overscaledZ-1;d>=o;d--){const _=t.scaledTo(d),y=this._getLoadedTile(_);if(y)return y}}_getLoadedTile(t){const o=this._tiles[t.key];return o&&o.hasData()?o:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,o){o=o||this._source.tileSize;const d=Math.ceil(t.width/o)+1,_=Math.ceil(t.height/o)+1,y=Math.floor(d*_*5),v=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,S=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,v):v;this._cache.setMaxSize(S)}handleWrapJump(t){const o=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,o){const d={};for(const _ in this._tiles){const y=this._tiles[_];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+o),d[y.tileID.key]=y}this._tiles=d;for(const _ in this._timers)clearTimeout(this._timers[_]),delete this._timers[_];for(const _ in this._tiles)this._setTileReloadTimer(+_,this._tiles[_])}}update(t,o,d,_,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,o),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const v=this._source.type==="batched-model";let S,A=this._source.maxzoom;const P=this.map&&this.map.painter?this.map.painter._terrain:null;if(P&&P.sourceCache===this&&P.attenuationRange()){const z=P.attenuationRange()[0],F=Math.floor(z)-Math.log2(P.getDemUpscale());A>F&&(A=F)}if(this.used||this.usedForTerrain){if(this._source.tileID)S=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(z=>new n.aM(z.canonical.z,z.wrap,z.canonical.z,z.canonical.x,z.canonical.y));else if(this.tileCoverLift!==0){const z=t.clone();z.tileCoverLift=this.tileCoverLift,S=z.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.minzoom<=1&&t.projection.name==="globe"&&(S.push(new n.aM(1,0,1,0,0)),S.push(new n.aM(1,0,1,1,0)),S.push(new n.aM(1,0,1,0,1)),S.push(new n.aM(1,0,1,1,1)))}else if(S=t.coveringTiles({tileSize:o||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:A,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:v}),this._source.hasTile){const z=this._source.hasTile.bind(this._source);S=S.filter(F=>z(F))}}else S=[];if(S.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!oh(this._source.type)){const z=t.coveringZoomLevel({tileSize:o||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),F=Math.min(z,this._source.maxzoom);if(v){const G=t.extendTileCover(S,F);for(const j of G)S.push(j)}else if(y){const G=t.extendTileCover(S,F,this.transform._camera.forward());for(const j of G)S.push(j)}else if(this.castsShadows&&_){const G=t.extendTileCover(S,F,_);for(const j of G)this._shadowCasterTiles[j.key]=!0,S.push(j)}}const D=this._updateRetainedTiles(S);if(oh(this._source.type)&&S.length!==0){const z={},F={},G=Object.keys(D);for(const H of G){const Z=D[H],K=this._tiles[H];if(!K||K.fadeEndTime&&K.fadeEndTime<=n.q.now())continue;const re=this.findLoadedParent(Z,Math.max(Z.overscaledZ-_r.maxOverzooming,this._source.minzoom));re&&(this._addTile(re.tileID),z[re.tileID.key]=re.tileID),F[H]=Z}const j=S[S.length-1].overscaledZ;for(const H in this._tiles){const Z=this._tiles[H];if(D[H]||!Z.hasData())continue;let K=Z.tileID;for(;K.overscaledZ>j;){K=K.scaledTo(K.overscaledZ-1);const re=this._tiles[K.key];if(re&&re.hasData()&&F[K.key]){D[H]=Z.tileID;break}}}for(const H in z)D[H]||(this._coveredTiles[H]=!0,D[H]=z[H])}for(const z in D)this._tiles[z].clearFadeHold();const k=n.bs(this._tiles,D);for(const z of k){const F=this._tiles[z];F.hasSymbolBuckets&&!F.holdingForFade()?F.setHoldDuration(this.map._fadeDuration):F.hasSymbolBuckets&&!F.symbolFadeFinished()||this._removeTile(+z)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const o={};if(t.length===0)return o;const d={},_=t.reduce((P,D)=>Math.min(P,D.overscaledZ),1/0),y=t[0].overscaledZ,v=Math.max(y-_r.maxOverzooming,this._source.minzoom),S=Math.max(y+_r.maxUnderzooming,this._source.minzoom),A={};for(const P of t){const D=this._addTile(P);o[P.key]=P,D.hasData()||_<this._source.maxzoom&&(A[P.key]=P)}this._retainLoadedChildren(A,_,S,o);for(const P of t){let D=this._tiles[P.key];if(D.hasData())continue;if(P.canonical.z>=this._source.maxzoom){const z=P.children(this._source.maxzoom)[0],F=this.getTile(z);if(F&&F.hasData()){o[z.key]=z;continue}}else{const z=P.children(this._source.maxzoom);if(o[z[0].key]&&o[z[1].key]&&o[z[2].key]&&o[z[3].key])continue}let k=D.wasRequested();for(let z=P.overscaledZ-1;z>=v;--z){const F=P.scaledTo(z);if(d[F.key]||(d[F.key]=!0,D=this.getTile(F),!D&&k&&(D=this._addTile(F)),D&&(o[F.key]=F,k=D.wasRequested(),D.hasData())))break}}return o}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const o=[];let d,_=this._tiles[t].tileID;for(;_.overscaledZ>0;){if(_.key in this._loadedParentTiles){d=this._loadedParentTiles[_.key];break}o.push(_.key);const y=_.scaledTo(_.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;_=y}for(const y of o)this._loadedParentTiles[y]=d}}_addTile(t){let o=this._tiles[t.key];if(o)return o.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),o;o=this._cache.getAndRemove(t),o&&(this._setTileReloadTimer(t.key,o),o.tileID=t,this._state.initializeTileState(o,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,o)));const d=!!o;if(!d){const _=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();o=this._source.type==="raster-array"?new Ul(t,y,this.transform.tileZoom,_,this._isRaster):new Qa(t,y,this.transform.tileZoom,_,this._isRaster,this._source.worldview),this._loadTile(o,this._tileLoaded.bind(this,o,t.key,o.state))}return o.uses++,this._tiles[t.key]=o,d||this._source.fire(new n.A("dataloading",{tile:o,coord:o.tileID,dataType:"source"})),o}_setTileReloadTimer(t,o){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=o.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const o=this._tiles[t];o&&(o.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),o.uses>0||(o.hasData()&&o.state!=="reloading"||o.state==="empty"?this._cache.add(o.tileID,o,o.getExpiryTimeout()):(o.aborted=!0,this._abortTile(o),this._unloadTile(o))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,o,d){const _=[],y=this.transform;if(!y)return _;const v=y.projection.name==="globe",S=n.aD(y.center.lng);for(const A in this._tiles){const P=this._tiles[A];if(d&&P.clearQueryDebugViz(),P.holdingForFade())continue;let D;if(v){const k=P.tileID.canonical;if(k.z===0){const z=[Math.abs(n.ay(S,...jl(k,-1))-S),Math.abs(n.ay(S,...jl(k,1))-S)];D=[0,2*z.indexOf(Math.min(...z))-1]}else{const z=[Math.abs(n.ay(S,...jl(k,-1))-S),Math.abs(n.ay(S,...jl(k,0))-S),Math.abs(n.ay(S,...jl(k,1))-S)];D=[z.indexOf(Math.min(...z))-1]}}else D=[0];for(const k of D){const z=t.containsTile(P,y,o,k);z&&_.push(z)}}return _}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,o){const d=this.getRenderableIds(t,o).map(y=>this._tiles[y].tileID),_=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=_?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){const o=t.slice(),d=this.transform._camera.position,_=this.transform._camera.forward(),y={};for(const v of o){const S=1/(1<<v.canonical.z);y[v.key]=((v.canonical.x+.5)*S+v.wrap-d[0])*_[0]+((v.canonical.y+.5)*S-d[1])*_[1]-d[2]*_[2]}return o.sort((v,S)=>y[v.key]-y[S.key]),o}hasTransition(){if(this._source.hasTransition())return!0;if(oh(this._source.type))for(const t in this._tiles){const o=this._tiles[t];if(o.fadeEndTime!==void 0&&o.fadeEndTime>=n.q.now())return!0}return!1}setFeatureState(t,o,d){this._state.updateState(t=t||"_geojsonTileLayer",o,d)}removeFeatureState(t,o,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",o,d)}getFeatureState(t,o){return this._state.getState(t=t||"_geojsonTileLayer",o)}setDependencies(t,o,d){const _=this._tiles[t];_&&_.setDependencies(o,d)}reloadTilesForDependencies(t,o){for(const d in this._tiles)this._tiles[d].hasDependency(t,o)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,o))}_preloadTiles(t,o){if(!this._sourceLoaded){const A=()=>{this._sourceLoaded&&(this._source.off("data",A),this._preloadTiles(t,o))};return void this._source.on("data",A)}const d=new Map,_=Array.isArray(t)?t:[t],y=this.map.painter.terrain,v=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const A of _){const P=A.coveringTiles({tileSize:v,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of P)d.set(D.key,D);this.usedForTerrain&&A.updateElevation(!1)}const S=Array.from(d.values());n.bt(S,(A,P)=>{const D=new Qa(A,this._source.tileSize*A.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,k=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),P(k,D)})},o)}}function el(u,t){const o=Math.abs(2*u.wrap)-+(u.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return u.overscaledZ-t.overscaledZ||d-o||t.canonical.y-u.canonical.y||t.canonical.x-u.canonical.x}function oh(u){return u==="raster"||u==="image"||u==="video"||u==="custom"}function jl(u,t){const o=1<<u.z;return[u.x/o+t,(u.x+1)/o+t]}_r.maxOverzooming=10,_r.maxUnderzooming=3;class P_{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,o=!1;for(const d in this.style._mergedLayers){const _=this.style._mergedLayers[d];if(_.type==="fill-extrusion"||_.type==="building")this.layers.push({layer:_,visible:t,visibilityChanged:o});else if(_.type==="model"){const y=this.style.getLayerSource(_);y&&y.type==="batched-model"&&this.layers.push({layer:_,visible:t,visibilityChanged:o})}}}onNewFrame(t){this.layersGotHidden=!1;for(const o of this.layers){const d=o.layer;let _=!1;d.type==="fill-extrusion"?_=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?_=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(_=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!_&&o.visible,o.visible=_}}updateZOffset(t,o){this.currentBuildingBuckets=[];for(const _ of this.layers){const y=_.layer,v=this.style.getLayerSourceCache(y);let S=1;y.type==="fill-extrusion"?S=_.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(S=_.visible?y.paint.get("building-vertical-scale"):0);let A=v?v.getTile(o):null;if(!A&&v&&o.canonical.z>v.getSource().minzoom){let P=o.scaledTo(Math.min(v.getSource().maxzoom,o.overscaledZ-1));for(;P.overscaledZ>=v.getSource().minzoom&&(A=v.getTile(P),!A&&P.overscaledZ!==0);)P=P.scaledTo(P.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:A?A.getBucket(y):null,tileID:A?A.tileID:o,verticalScale:S})}t.hasAnyZOffset=!1;let d=!1;for(let _=0;_<t.symbolInstances.length;_++){const y=t.symbolInstances.get(_),v=y.zOffset,S=this._getHeightAtTileOffset(o,y.tileAnchorX,y.tileAnchorY);y.zOffset=S!==Number.NEGATIVE_INFINITY?S:v,d||v===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,o,d,_){let y=o,v=d;if(t.canonical.z!==_.canonical.z){const S=_.canonical,A=1/(1<<t.canonical.z-S.z);y=(o+t.canonical.x*n.aj)*A-S.x*n.aj|0,v=(d+t.canonical.y*n.aj)*A-S.y*n.aj|0}return{tileX:y,tileY:v}}_getHeightAtTileOffset(t,o,d){let _,y;for(let v=0;v<this.layers.length;++v){const S=this.layers[v].layer;if(S.type!=="fill-extrusion"&&S.type!=="building")continue;const{bucket:A,tileID:P,verticalScale:D}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:k,tileY:z}=this._mapCoordToOverlappingTile(t,o,d,P),F=A.getHeightAtTileCoord(k,z);F&&F.height!==void 0&&(F.hidden?_=F.height:y=Math.max(F.height*D,y||0))}if(y!==void 0)return y;for(let v=0;v<this.layers.length;++v){const S=this.layers[v];if(S.layer.type!=="model"||!S.visible)continue;const{bucket:A,tileID:P}=this.currentBuildingBuckets[v];if(!A)continue;const{tileX:D,tileY:k}=this._mapCoordToOverlappingTile(t,o,d,P),z=A.getHeightAtTileCoord(D,k);if(z&&!z.hidden)return z.height===void 0&&_!==void 0?Math.min(z.maxHeight,_)*z.verticalScale:z.height?z.height*z.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function D_(u,t){const o={};for(const d in u)d!=="ref"&&(o[d]=u[d]);return n.bu.forEach(d=>{d in t&&(o[d]=t[d])}),o}function ah(u){u=u.slice();const t=Object.create(null);for(let o=0;o<u.length;o++)t[u[o].id]=u[o];for(let o=0;o<u.length;o++)"ref"in u[o]&&(u[o]=D_(u[o],t[u[o].ref]));return u}const qi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function ku(u,t,o){o.push({command:qi.addSource,args:[u,t[u]]})}function $l(u,t,o){t.push({command:qi.removeSource,args:[u]}),o[u]=!0}function lh(u,t,o,d){$l(u,o,d),ku(u,t,o)}function Qx(u,t,o){let d;for(d in u[o])if(u[o].hasOwnProperty(d)&&d!=="data"&&!n.bv(u[o][d],t[o][d]))return!1;for(d in t[o])if(t[o].hasOwnProperty(d)&&d!=="data"&&!n.bv(u[o][d],t[o][d]))return!1;return!0}function ch(u,t,o,d,_,y){let v;for(v in t=t||{},u=u||{})u.hasOwnProperty(v)&&(n.bv(u[v],t[v])||o.push({command:y,args:[d,v,t[v],_]}));for(v in t)t.hasOwnProperty(v)&&!u.hasOwnProperty(v)&&(n.bv(u[v],t[v])||o.push({command:y,args:[d,v,t[v],_]}))}function tl(u){return u.id}function ma(u,t){return u[t.id]=t,u}class Gf{constructor(t,o){this.reset(t,o)}reset(t,o){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(o||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=n.ay(t,0,1);let o=1,d=this._distances[o];const _=t*this.paddedLength+this.padding;for(;d<_&&o<this._distances.length;)d=this._distances[++o];const y=o-1,v=this._distances[y],S=d-v,A=S>0?(_-v)/S:0;return this.points[y].mult(1-A).add(this.points[o].mult(A))}}class Hf{constructor(t,o,d){const _=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(o/d);for(let v=0;v<this.xCellCount*this.yCellCount;v++)_.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=o,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/o,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,o,d,_,y){this._forEachCell(o,d,_,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(o),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(y)}insertCircle(t,o,d,_){this._forEachCell(o-_,d-_,o+_,d+_,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(o),this.circles.push(d),this.circles.push(_)}_insertBoxCell(t,o,d,_,y,v){this.boxCells[y].push(v)}_insertCircleCell(t,o,d,_,y,v){this.circleCells[y].push(v)}_query(t,o,d,_,y,v){if(d<0||t>this.width||_<0||o>this.height)return!y&&[];const S=[];if(t<=0&&o<=0&&this.width<=d&&this.height<=_){if(y)return!0;for(let A=0;A<this.boxKeys.length;A++)S.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const P=this.circles[3*A],D=this.circles[3*A+1],k=this.circles[3*A+2];S.push({key:this.circleKeys[A],x1:P-k,y1:D-k,x2:P+k,y2:D+k})}return v?S.filter(v):S}return this._forEachCell(t,o,d,_,this._queryCell,S,{hitTest:y,seenUids:{box:{},circle:{}}},v),y?S.length>0:S}_queryCircle(t,o,d,_,y){const v=t-d,S=t+d,A=o-d,P=o+d;if(S<0||v>this.width||P<0||A>this.height)return!_&&[];const D=[];return this._forEachCell(v,A,S,P,this._queryCellCircle,D,{hitTest:_,circle:{x:t,y:o,radius:d},seenUids:{box:{},circle:{}}},y),_?D.length>0:D}query(t,o,d,_,y){return this._query(t,o,d,_,!1,y)}hitTest(t,o,d,_,y){return this._query(t,o,d,_,!0,y)}hitTestCircle(t,o,d,_){return this._queryCircle(t,o,d,!0,_)}_queryCell(t,o,d,_,y,v,S,A){const P=S.seenUids,D=this.boxCells[y];if(D!==null){const z=this.bboxes;for(const F of D)if(!P.box[F]){P.box[F]=!0;const G=4*F;if(t<=z[G+2]&&o<=z[G+3]&&d>=z[G+0]&&_>=z[G+1]&&(!A||A(this.boxKeys[F]))){if(S.hitTest)return v.push(!0),!0;v.push({key:this.boxKeys[F],x1:z[G],y1:z[G+1],x2:z[G+2],y2:z[G+3]})}}}const k=this.circleCells[y];if(k!==null){const z=this.circles;for(const F of k)if(!P.circle[F]){P.circle[F]=!0;const G=3*F;if(this._circleAndRectCollide(z[G],z[G+1],z[G+2],t,o,d,_)&&(!A||A(this.circleKeys[F]))){if(S.hitTest)return v.push(!0),!0;{const j=z[G],H=z[G+1],Z=z[G+2];v.push({key:this.circleKeys[F],x1:j-Z,y1:H-Z,x2:j+Z,y2:H+Z})}}}}}_queryCellCircle(t,o,d,_,y,v,S,A){const P=S.circle,D=S.seenUids,k=this.boxCells[y];if(k!==null){const F=this.bboxes;for(const G of k)if(!D.box[G]){D.box[G]=!0;const j=4*G;if(this._circleAndRectCollide(P.x,P.y,P.radius,F[j+0],F[j+1],F[j+2],F[j+3])&&(!A||A(this.boxKeys[G])))return v.push(!0),!0}}const z=this.circleCells[y];if(z!==null){const F=this.circles;for(const G of z)if(!D.circle[G]){D.circle[G]=!0;const j=3*G;if(this._circlesCollide(F[j],F[j+1],F[j+2],P.x,P.y,P.radius)&&(!A||A(this.circleKeys[G])))return v.push(!0),!0}}}_forEachCell(t,o,d,_,y,v,S,A){const P=this._convertToXCellCoord(t),D=this._convertToYCellCoord(o),k=this._convertToXCellCoord(d),z=this._convertToYCellCoord(_);for(let F=P;F<=k;F++)for(let G=D;G<=z;G++)if(y.call(this,t,o,d,_,this.xCellCount*G+F,v,S,A))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,o,d,_,y,v){const S=_-t,A=y-o,P=d+v;return P*P>S*S+A*A}_circleAndRectCollide(t,o,d,_,y,v,S){const A=(v-_)/2,P=Math.abs(t-(_+A));if(P>A+d)return!1;const D=(S-y)/2,k=Math.abs(o-(y+D));if(k>D+d)return!1;if(P<=A||k<=D)return!0;const z=P-A,F=k-D;return z*z+F*F<=d*d}}const il={unknown:0,flipRequired:1,flipNotRequired:2},R_=Math.tan(85*Math.PI/180);function Ho(u,t,o,d,_,y,v){const S=n.bz();if(o)if(y.name==="globe"){const A=n.bA(_,t);n.az(S,S,A)}else{const A=n.bB([],v);S[0]=A[0],S[1]=A[1],S[4]=A[2],S[5]=A[3],d||n.by(S,S,_.angle)}else n.az(S,_.labelPlaneMatrix,u);return S}function Fu(u,t,o,d,_,y,v){const S=Ho(u,t,o,d,_,y,v);return y.name==="globe"&&o||(S[2]=S[6]=S[10]=S[14]=0),S}function Bu(u,t,o,d,_,y,v){if(o){if(y.name==="globe"){const S=Ho(u,t,o,d,_,y,v);return n.bi(S,S),n.az(S,u,S),S}{const S=n.bw(u),A=n.bx([]);return A[0]=v[0],A[1]=v[1],A[4]=v[2],A[5]=v[3],n.az(S,S,A),d||n.by(S,S,-_.angle),S}}return _.glCoordMatrix}function ro(u,t,o,d){const _=[u,t,o,1];o?n.aA(_,_,d):rn(_,_,d);const y=_[3];return _[0]/=y,_[1]/=y,_[2]/=y,_}function hh(u,t){return Math.min(.5+u/t*.5,1.5)}function nl(u,t){const o=u[0]/u[3],d=u[1]/u[3];return o>=-t[0]&&o<=t[0]&&d>=-t[1]&&d<=t[1]}function Nu(u,t,o,d,_,y,v,S,A,P){const D=o.transform,k=d?u.textSizeData:u.iconSizeData,z=n.bH(k,o.transform.zoom),F=D.projection.name==="globe",G=[256/o.width*2+1,256/o.height*2+1],j=d?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;j.clear();let H=null;F&&(H=d?u.text.globeExtVertexArray:u.icon.globeExtVertexArray);const Z=u.lineVertexArray,K=d?u.text.placedSymbolArray:u.icon.placedSymbolArray,re=o.transform.width/o.transform.height;let ce,me=!1;for(let fe=0;fe<K.length;fe++){const ue=K.get(fe),{numGlyphs:he,writingMode:_e}=ue;if(_e!==n.bI.vertical||me||ce===n.bI.horizontal||(me=!0),ce=_e,(ue.hidden||_e===n.bI.vertical)&&!me){rl(he,j);continue}me=!1;const ye=new n.P(ue.tileAnchorX,ue.tileAnchorY);let{x:Le,y:ze,z:qe}=D.projection.projectTilePoint(ye.x,ye.y,P.canonical);if(A){const[Mt,Pt,Et]=A(ye);Le+=Mt,ze+=Pt,qe+=Et}const Xe=[Le,ze,qe,1];if(n.aA(Xe,Xe,t),!nl(Xe,G)){rl(he,j);continue}const st=Xe[3],De=hh(o.transform.getCameraToCenterDistance(D.projection),st),je=n.bJ(k,z,ue),Te=v?je/De:je*De,Ke=ro(Le,ze,qe,_);if(Ke[3]<=0){rl(he,j);continue}let Be={};const it=n.al(u.layers[0].layout.get("text-max-angle")),ft=Math.cos(it),Ye=v?null:A,ut=sl(ue,Te,!1,S,t,_,y,u.glyphOffsetArray,Z,j,H,Ke,ye,Be,re,Ye,D.projection,P,v,ft);me=ut.useVertical,Ye&&ut.needsFlipping&&(Be={}),(ut.notEnoughRoom||me||ut.needsFlipping&&sl(ue,Te,!0,S,t,_,y,u.glyphOffsetArray,Z,j,H,Ke,ye,Be,re,Ye,D.projection,P,v,ft).notEnoughRoom)&&rl(he,j)}d?(u.text.dynamicLayoutVertexBuffer.updateData(j),H&&u.text.globeExtVertexBuffer&&u.text.globeExtVertexBuffer.updateData(H)):(u.icon.dynamicLayoutVertexBuffer.updateData(j),H&&u.icon.globeExtVertexBuffer&&u.icon.globeExtVertexBuffer.updateData(H))}function Wf(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H){const{lineStartIndex:Z,glyphStartIndex:K,segment:re}=S,ce=K+S.numGlyphs,me=Z+S.lineLength,fe=t.getoffsetX(K),ue=t.getoffsetX(ce-1),he=Gl(u*fe,o,d,_,y,v,re,Z,me,A,P,D,k,z,!0,F,G,j,H);if(!he)return null;const _e=Gl(u*ue,o,d,_,y,v,re,Z,me,A,P,D,k,z,!0,F,G,j,H);return _e?{first:he,last:_e}:null}function Vu(u,t,o,d){return u===n.bI.horizontal&&Math.abs(d)>Math.abs(o)?{useVertical:!0}:u===n.bI.vertical?d>0?{needsFlipping:!0}:null:t!==il.unknown&&function(_,y){return _===0||Math.abs(y/_)>R_}(o,d)?t===il.flipRequired?{needsFlipping:!0}:null:o<0?{needsFlipping:!0}:null}function sl(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K,re){const ce=t/24,me=u.lineOffsetX*ce,fe=u.lineOffsetY*ce,{lineStartIndex:ue,glyphStartIndex:he,numGlyphs:_e,segment:ye,writingMode:Le,flipState:ze}=u,qe=ue+u.lineLength,Xe=st=>{if(D){const[Ke,Be,it]=st.up,ft=P.length;n.bK(D,ft+0,Ke,Be,it),n.bK(D,ft+1,Ke,Be,it),n.bK(D,ft+2,Ke,Be,it),n.bK(D,ft+3,Ke,Be,it)}const[De,je,Te]=st.point;n.bL(P,De,je,Te,st.angle)};if(_e>1){const st=Wf(ce,S,me,fe,o,k,z,u,A,y,F,j,!1,H,Z,K,re);if(!st)return{notEnoughRoom:!0};if(d&&!o){let[De,je,Te]=st.first.point,[Ke,Be,it]=st.last.point;[De,je]=ro(De,je,Te,v),[Ke,Be]=ro(Ke,Be,it,v);const ft=Vu(Le,ze,(Ke-De)*G,Be-je);if(u.flipState=ft&&ft.needsFlipping?il.flipRequired:il.flipNotRequired,ft)return ft}Xe(st.first);for(let De=he+1;De<he+_e-1;De++){const je=Gl(ce*S.getoffsetX(De),me,fe,o,k,z,ye,ue,qe,A,y,F,j,!1,!1,H,Z,K,re);if(!je)return P.length-=4*(De-he),{notEnoughRoom:!0};Xe(je)}Xe(st.last)}else{if(d&&!o){const De=ro(z.x,z.y,0,_),je=ue+ye+1,Te=new n.P(A.getx(je),A.gety(je)),Ke=ro(Te.x,Te.y,0,_),Be=Ke[3]>0?Ke:qf(z,Te,De,1,_,void 0,H,Z.canonical),it=Vu(Le,ze,(Be[0]-De[0])*G,Be[1]-De[1]);if(u.flipState=it&&it.needsFlipping?il.flipRequired:il.flipNotRequired,it)return it}const st=Gl(ce*S.getoffsetX(he),me,fe,o,k,z,ye,ue,qe,A,y,F,j,!1,!1,H,Z,K,re);if(!st)return{notEnoughRoom:!0};Xe(st)}return{}}function Sr(u,t,o,d,_){const{x:y,y:v,z:S}=d.projectTilePoint(u.x,u.y,t);if(!_)return ro(y,v,S,o);const[A,P,D]=_(u);return ro(y+A,v+P,S+D,o)}function qf(u,t,o,d,_,y,v,S){const A=Sr(u.sub(t)._unit()._add(u),S,_,v,y);return n.at(A,o,A),n.au(A,A),n.bE(A,o,A,d)}function Gl(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K){const re=d?u-t:u+t;let ce=re>0?1:-1,me=0;d&&(ce*=-1,me=Math.PI),ce<0&&(me+=Math.PI);let fe=S+v+(ce>0?0:1)|0,ue=_,he=_,_e=0,ye=0;const Le=Math.abs(re),ze=[],qe=[];let Xe=y,st=Xe,De=n.bC([]);const je=()=>qf(st,Xe,he,Le-_e+1,D,z,j,H.canonical);for(;_e+ye<=Le;){if(fe+=ce,fe<S||fe>=A)return null;if(he=ue,st=Xe,ze.push(he),F&&qe.push(st),Xe=new n.P(P.getx(fe),P.gety(fe)),ue=k[fe],!ue){const Et=Sr(Xe,H.canonical,D,j,z);ue=Et[3]>0?k[fe]=Et:je()}_e+=ye;const Mt=n.at([],ue,he),Pt=n.bD(he,ue);if(o&&Pt>0&&ye>0&&n.bG(De,Mt)/(ye*Pt)<K)return null;ye=Pt,De=Mt}G&&z&&(k[fe]&&(ue=je(),ye=n.bD(he,ue),De=n.at([],ue,he)),k[fe]=ue);const Te=(Le-_e)/ye,Ke=Xe.sub(st)._mult(Te)._add(st),Be=n.bE([],he,De,Te);let it=[0,0,1],ft=De[0],Ye=De[1];if(Z&&(it=j.upVector(H.canonical,Ke.x,Ke.y),it[0]!==0||it[1]!==0||it[2]!==1)){const Mt=[it[2],0,-it[0]],Pt=n.bF([],it,Mt);n.au(Mt,Mt),n.au(Pt,Pt),ft=n.bG(De,Mt),Ye=n.bG(De,Pt)}if(o){const Mt=n.bF([],it,De);n.au(Mt,Mt),n.bE(Be,Be,Mt,o*ce)}const ut=me+Math.atan2(Ye,ft);return ze.push(Be),F&&qe.push(Ke),{point:Be,angle:ut,path:ze,tilePath:qe,up:it}}function rl(u,t){const o=t.length,d=o+4*u;t.resize(d),t.float32.fill(-1/0,4*o,4*d)}function rn(u,t,o){const d=t[0],_=t[1];return u[0]=o[0]*d+o[4]*_+o[12],u[1]=o[1]*d+o[5]*_+o[13],u[3]=o[3]*d+o[7]*_+o[15],u}const oo=100;class ev{constructor(t,o,d=new Hf(t.width+200,t.height+200,25),_=new Hf(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=_,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+oo,this.screenBottomBoundary=t.height+oo,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=o}placeCollisionBox(t,o,d,_,y,v,S,A){let P=d.projectedAnchorX,D=d.projectedAnchorY,k=d.projectedAnchorZ;const z=d.elevation,F=d.tileID,G=t.getProjection();if(z&&F){const[fe,ue,he]=G.upVector(F.canonical,d.tileAnchorX,d.tileAnchorY),_e=G.upVectorScale(F.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;P+=fe*z*_e,D+=ue*z*_e,k+=he*z*_e}const j=this.projectAndGetPerspectiveRatio(S,P,D,k,d.tileID,G.name==="globe"||!!z||this.transform.pitch>0,G),H=v*j.perspectiveRatio,Z=(d.x1*o+_.x-d.padding)*H+j.point.x,K=(d.y1*o+_.y-d.padding)*H+j.point.y,re=(d.x2*o+_.x+d.padding)*H+j.point.x,ce=(d.y2*o+_.y+d.padding)*H+j.point.y,me=j.perspectiveRatio<=.55||j.occluded;return!this.isInsideGrid(Z,K,re,ce)||!y&&this.grid.hitTest(Z,K,re,ce,A)||me?{box:[],offscreen:!1,occluded:j.occluded}:{box:[Z,K,re,ce],offscreen:this.isOffscreen(Z,K,re,ce),occluded:!1}}placeCollisionCircles(t,o,d,_,y,v,S,A,P,D,k,z,F,G,j){const H=[],Z=this.transform.elevation,K=t.getProjection(),re=Z?Z.getAtTileOffsetFunc(j,this.transform.center.lat,this.transform.worldSize,K):null,ce=new n.P(d.tileAnchorX,d.tileAnchorY);let{x:me,y:fe,z:ue}=K.projectTilePoint(ce.x,ce.y,j.canonical);if(re){const[it,ft,Ye]=re(ce);me+=it,fe+=ft,ue+=Ye}const he=K.name==="globe",_e=this.projectAndGetPerspectiveRatio(S,me,fe,ue,j,he||!!Z||this.transform.pitch>0,K),{perspectiveRatio:ye}=_e,Le=(k?v/ye:v*ye)/n.bO,ze=ro(me,fe,ue,A),qe=d.lineOffsetX*Le,Xe=d.lineOffsetY*Le,st=n.al(t.layers[0].layout.get("text-max-angle")),De=Math.cos(st),je=_e.signedDistanceFromCamera>0?Wf(Le,y,qe,Xe,!1,ze,ce,d,_,A,{},Z&&!k?re:null,k&&!!Z,K,j,k,De):null;let Te=!1,Ke=!1,Be=!0;if(je&&!_e.occluded){const it=.5*F*ye+G,ft=new n.P(-100,-100),Ye=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ut=new Gf,{first:Mt,last:Pt}=je,Et=Mt.path.length;let Ut=[];for(let ai=Et-1;ai>=1;ai--)Ut.push(Mt.path[ai]);for(let ai=1;ai<Pt.path.length;ai++)Ut.push(Pt.path[ai]);const qt=2.5*it;P&&(Ut=Ut.map(([ai,Ei,an],In)=>(re&&!he&&(an=re(In<Et-1?Mt.tilePath[Et-1-In]:Pt.tilePath[In-Et+2])[2]),ro(ai,Ei,an,P))),Ut.some(ai=>ai[3]<=0)&&(Ut=[]));let ei=[];if(Ut.length>0){let ai=1/0,Ei=-1/0,an=1/0,In=-1/0;for(const un of Ut)ai=Math.min(ai,un[0]),an=Math.min(an,un[1]),Ei=Math.max(Ei,un[0]),In=Math.max(In,un[1]);Ei>=ft.x&&ai<=Ye.x&&In>=ft.y&&an<=Ye.y&&(ei=[Ut.map(un=>new n.P(un[0],un[1]))],(ai<ft.x||Ei>Ye.x||an<ft.y||In>Ye.y)&&(ei=n.bM(ei,ft.x,ft.y,Ye.x,Ye.y)))}for(const ai of ei){ut.reset(ai,.25*it);let Ei=0;Ei=ut.length<=.5*it?1:Math.ceil(ut.paddedLength/qt)+1;for(let an=0;an<Ei;an++){const In=an/Math.max(Ei-1,1),un=ut.lerp(In),mn=un.x+oo,os=un.y+oo;H.push(mn,os,it,0);const vi=mn-it,Mi=os-it,Oi=mn+it,Rn=os+it;if(Be=Be&&this.isOffscreen(vi,Mi,Oi,Rn),Ke=Ke||this.isInsideGrid(vi,Mi,Oi,Rn),!o&&this.grid.hitTestCircle(mn,os,it,z)&&(Te=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Te,occluded:!1}}}}return{circles:!D&&Te||!Ke?[]:H,offscreen:Be,collisionDetected:Te,occluded:_e.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const o=[];let d=1/0,_=1/0,y=-1/0,v=-1/0;for(const D of t){const k=new n.P(D.x+oo,D.y+oo);d=Math.min(d,k.x),_=Math.min(_,k.y),y=Math.max(y,k.x),v=Math.max(v,k.y),o.push(k)}const S=this.grid.query(d,_,y,v).concat(this.ignoredGrid.query(d,_,y,v)),A={},P={};for(const D of S){const k=D.key;if(A[k.bucketInstanceId]===void 0&&(A[k.bucketInstanceId]={}),A[k.bucketInstanceId][k.featureIndex])continue;const z=[new n.P(D.x1,D.y1),new n.P(D.x2,D.y1),new n.P(D.x2,D.y2),new n.P(D.x1,D.y2)];n.bN(o,z)&&(A[k.bucketInstanceId][k.featureIndex]=!0,P[k.bucketInstanceId]===void 0&&(P[k.bucketInstanceId]=[]),P[k.bucketInstanceId].push(k.featureIndex))}return P}insertCollisionBox(t,o,d,_,y){(o?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:_,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,o,d,_,y){const v=o?this.ignoredGrid:this.grid,S={bucketInstanceId:d,featureIndex:_,collisionGroupID:y};for(let A=0;A<t.length;A+=4)v.insertCircle(S,t[A],t[A+1],t[A+2])}projectAndGetPerspectiveRatio(t,o,d,_,y,v,S){const A=[o,d,_,1];let P=!1;_||this.transform.pitch>0?(n.aA(A,A,t),this.fogState&&y&&S.name!=="globe"&&(P=function(z,F,G,j,H,Z){const K=Z.calculateFogTileMatrix(H),re=[F,G,j];return n.ad(re,re,K),mt(z,n.ae(re),Z.pitch,Z._fov)}(this.fogState,o,d,_,y.toUnwrapped(),this.transform)>.9)):rn(A,A,t);const D=A[3];return{point:new n.P((A[0]/D+1)/2*this.transform.width+oo,(-A[1]/D+1)/2*this.transform.height+oo),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(S)/D*.5,1.5),signedDistanceFromCamera:D,occluded:v&&A[2]>D||P}}isOffscreen(t,o,d,_){return d<oo||t>=this.screenRightBoundary||_<oo||o>this.screenBottomBoundary}isInsideGrid(t,o,d,_){return d>=0&&t<this.gridRightBoundary&&_>=0&&o<this.gridBottomBoundary}getViewportMatrix(){const t=n.bx([]);return n.bo(t,t,[-100,-100,0]),t}}function Zf(u,t,o){const d=t.createTileMatrix(u,u.worldSize,o.toUnwrapped());return n.az(new Float32Array(16),u.projMatrix,d)}function ri(u,t,o){if(t.projection.name===o.projection.name)return u.projMatrix;const d=o.clone();return d.setProjection(t.projection),Zf(d,t.getProjection(),u)}function Uu(u,t,o){return t.name===o.projection.name?u.projMatrix:Zf(o,t,u)}class uh{constructor(t,o,d,_){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?o:-o))):_&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class ol{constructor(t,o,d,_,y,v=!1){this.text=new uh(t?t.text:null,o,d,y),this.icon=new uh(t?t.icon:null,o,_,y),this.clipped=v}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Or{constructor(t,o,d,_=!1){this.text=t,this.icon=o,this.skipFade=d,this.clipped=_}}class Xf{constructor(){this.invProjMatrix=n.bz(),this.viewportMatrix=n.bz(),this.circles=[]}}class Hl{constructor(t,o,d,_,y){this.bucketInstanceId=t,this.featureIndex=o,this.sourceLayerIndex=d,this.bucketIndex=_,this.tileID=y}}class Ht{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const o=++this.maxGroupID;this.collisionGroups[t]={ID:o,predicate:d=>d.collisionGroupID===o}}return this.collisionGroups[t]}}function pn(u,t,o,d,_){const{horizontalAlign:y,verticalAlign:v}=n.bT(u),S=-(y-.5)*t,A=-(v-.5)*o,P=n.bU(u,d);return new n.P(S+P[0]*_,A+P[1]*_)}function tn(u,t,o,d,_){const y=new n.P(u,t);return o&&y._rotate(d?_:-_),y}class Er{constructor(t,o,d,_,y,v){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new ev(this.transform,y),this.buildingIndex=v,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=o,this.retainedQueryData={},this.collisionGroups=new Ht(d),this.collisionCircleArrays={},this.prevPlacement=_,_&&(_.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,o,d,_,y=1){const v=d.getBucket(o),S=d.latestFeatureIndex;if(!v||!S||o.fqid!==v.layerIds[0])return;const A=v.layers[0].layout,P=v.layers[0].paint,D=d.collisionBoxArray,k=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),z=d.tileSize/n.aj,F=d.tileID.toUnwrapped();this.transform.setProjection(v.projection);const G=(j=d.tileID,H=v.getProjection(),Z=this.transform,H.name===this.projection?Z.calculateProjMatrix(j.toUnwrapped()):Zf(Z,H,j));var j,H,Z;const K=A.get("text-pitch-alignment")==="map",re=A.get("text-rotation-alignment")==="map";o.compileFilter(o.options);const ce=o.dynamicFilter(),me=o.dynamicFilterNeedsFeature(),fe=this.transform.calculatePixelsToTileUnitsMatrix(d),ue=Fu(G,d.tileID.canonical,K,re,this.transform,v.getProjection(),fe);let he=null;if(K){const je=Bu(G,d.tileID.canonical,K,re,this.transform,v.getProjection(),fe);he=n.az([],this.transform.labelPlaneMatrix,je)}let _e=null;ce&&d.latestFeatureIndex&&(_e={unwrappedTileID:F,dynamicFilter:ce,dynamicFilterNeedsFeature:me}),this.retainedQueryData[v.bucketInstanceId]=new Hl(v.bucketInstanceId,S,v.sourceLayerIndex,v.index,d.tileID);const[ye,Le]=v.layers[0].layout.get("text-size-scale-range"),ze=n.ay(y,ye,Le),[qe,Xe]=A.get("icon-size-scale-range"),st=n.ay(y,qe,Xe),De={bucket:v,layout:A,paint:P,posMatrix:G,textLabelPlaneMatrix:ue,labelToScreenMatrix:he,clippingData:_e,scale:k,textPixelRatio:z,holdingForFade:d.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:n.bH(v.textSizeData,this.transform.zoom,ze),partiallyEvaluatedIconSize:n.bH(v.iconSizeData,this.transform.zoom,st),collisionGroup:this.collisionGroups.get(v.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(_)for(const je of v.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:Ke,symbolInstanceEnd:Be}=je;t.push({sortKey:Te,symbolInstanceStart:Ke,symbolInstanceEnd:Be,parameters:De})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:v.symbolInstances.length,parameters:De})}attemptAnchorPlacement(t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K){const{textOffset0:re,textOffset1:ce,crossTileID:me}=z,fe=[re,ce],ue=pn(t,d,_,fe,y),he=this.collisionIndex.placeCollisionBox(G,y,o,tn(ue.x,ue.y,v,S,this.transform.angle),k,A,P,D.predicate);if(H){const _e=G.getSymbolInstanceIconSize(K,this.transform.zoom,z.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,_e,H,tn(ue.x,ue.y,v,S,this.transform.angle),k,A,P,D.predicate).box.length===0)return}if(he.box.length>0){let _e;return this.prevPlacement&&this.prevPlacement.variableOffsets[me]&&this.prevPlacement.placements[me]&&this.prevPlacement.placements[me].text&&(_e=this.prevPlacement.variableOffsets[me].anchor),this.variableOffsets[me]={textOffset:fe,width:d,height:_,anchor:t,textScale:y,prevAnchor:_e},this.markUsedJustification(G,t,z,j),G.allowVerticalPlacement&&(this.markUsedOrientation(G,j,z),this.placedOrientations[me]=j),{shift:ue,placedGlyphBoxes:he}}}placeLayerBucketPart(t,o,d,_,y=1){const{bucket:v,layout:S,paint:A,posMatrix:P,textLabelPlaneMatrix:D,labelToScreenMatrix:k,clippingData:z,textPixelRatio:F,holdingForFade:G,collisionBoxArray:j,partiallyEvaluatedTextSize:H,partiallyEvaluatedIconSize:Z,collisionGroup:K,latestFeatureIndex:re}=t.parameters,ce=S.get("text-optional"),me=S.get("icon-optional"),fe=S.get("text-allow-overlap"),ue=S.get("icon-allow-overlap"),he=S.get("text-rotation-alignment")==="map",_e=S.get("text-pitch-alignment")==="map",ye=A.get("symbol-z-offset"),Le=S.get("symbol-elevation-reference")==="sea",[ze,qe]=S.get("text-size-scale-range"),[Xe,st]=S.get("icon-size-scale-range"),De=n.ay(y,ze,qe),je=n.ay(y,Xe,st);this.transform.setProjection(v.projection);let Te=fe&&(ue||!v.hasIconData()||me),Ke=ue&&(fe||!v.hasTextData()||ce);const Be=!ye.isConstant();!v.collisionArrays&&j&&v.deserializeCollisionBoxes(j),d&&_&&v.updateCollisionDebugBuffers(this.transform.zoom,j,De,je);const it=(Ye,ut,Mt)=>{const{crossTileID:Pt,numVerticalGlyphVertices:Et}=Ye;let Ut=null;if(z&&z.dynamicFilterNeedsFeature||Be){const Tn=this.retainedQueryData[v.bucketInstanceId];Ut=re.loadFeature({featureIndex:Ye.featureIndex,bucketIndex:Tn.bucketIndex,sourceLayerIndex:Tn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(z&&!(0,z.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},Ut,this.retainedQueryData[v.bucketInstanceId].tileID.canonical,new n.P(Ye.tileAnchorX,Ye.tileAnchorY),this.transform.calculateDistanceTileData(z.unwrappedTileID)))return this.placements[Pt]=new Or(!1,!1,!1,!0),void o.add(Pt);const qt=ye.evaluate(Ut,{});if(o.has(Pt))return;if(G)return void(this.placements[Pt]=new Or(!1,!1,!1));let ei=!1,ai=!1,Ei=!0,an=!1,In=!1,un=null,mn={box:null,offscreen:null,occluded:null},os={box:null},vi=null,Mi=null,Oi=null,Rn=0,_s=0,Cn=0;Mt.textFeatureIndex?Rn=Mt.textFeatureIndex:Ye.useRuntimeCollisionCircles&&(Rn=Ye.featureIndex),Mt.verticalTextFeatureIndex&&(_s=Mt.verticalTextFeatureIndex);const Qi=Tn=>{Tn.tileID=this.retainedQueryData[v.bucketInstanceId].tileID;const zn=this.transform.elevation;Tn.elevation=Le?qt:qt+(zn?zn.getAtTileOffset(Tn.tileID,Tn.tileAnchorX,Tn.tileAnchorY):0),Tn.elevation+=Ye.zOffset},Jn=Mt.textBox;if(Jn){Qi(Jn);const Tn=nn=>{let is=n.bI.horizontal;if(v.allowVerticalPlacement&&!nn&&this.prevPlacement){const Hs=this.prevPlacement.placedOrientations[Pt];Hs&&(this.placedOrientations[Pt]=Hs,is=Hs,this.markUsedOrientation(v,is,Ye))}return is},zn=(nn,is)=>{if(v.allowVerticalPlacement&&Et>0&&Mt.verticalTextBox){for(const Hs of v.writingModes)if(Hs===n.bI.vertical?(mn=is(),os=mn):mn=nn(),mn&&mn.box&&mn.box.length)break}else mn=nn()};if(S.get("text-variable-anchor")){let nn=S.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Pt]){const Vn=this.prevPlacement.variableOffsets[Pt];nn.indexOf(Vn.anchor)>0&&(nn=nn.filter(Ki=>Ki!==Vn.anchor),nn.unshift(Vn.anchor))}const is=(Vn,Ki,Ir)=>{const yr=v.getSymbolInstanceTextSize(H,Ye,this.transform.zoom,ut),Br=(Vn.x2-Vn.x1)*yr+2*Vn.padding,co=(Vn.y2-Vn.y1)*yr+2*Vn.padding,Kr=Ye.hasIconTextFit&&!ue?Ki:null;Kr&&Qi(Kr);let xr={box:[],offscreen:!1,occluded:!1};const Da=fe?2*nn.length:nn.length;for(let ho=0;ho<Da;++ho){const Ra=this.attemptAnchorPlacement(nn[ho%nn.length],Vn,Br,co,yr,he,_e,F,P,K,ho>=nn.length,Ye,ut,v,Ir,Kr,H,Z);if(Ra&&(xr=Ra.placedGlyphBoxes,xr&&xr.box&&xr.box.length)){ei=!0,un=Ra.shift;break}}return xr};zn(()=>is(Jn,Mt.iconBox,n.bI.horizontal),()=>{const Vn=Mt.verticalTextBox;return Vn&&Qi(Vn),v.allowVerticalPlacement&&!(mn&&mn.box&&mn.box.length)&&Et>0&&Vn?is(Vn,Mt.verticalIconBox,n.bI.vertical):{box:null,offscreen:null,occluded:null}}),mn&&(ei=mn.box,Ei=mn.offscreen,an=mn.occluded);const Hs=Tn(!(!mn||!mn.box));if(!ei&&this.prevPlacement){const Vn=this.prevPlacement.variableOffsets[Pt];Vn&&(this.variableOffsets[Pt]=Vn,this.markUsedJustification(v,Vn.anchor,Ye,Hs))}}else{const nn=(is,Hs)=>{const Vn=v.getSymbolInstanceTextSize(H,Ye,this.transform.zoom,ut,y),Ki=this.collisionIndex.placeCollisionBox(v,Vn,is,new n.P(0,0),fe,F,P,K.predicate);return Ki&&Ki.box&&Ki.box.length&&(this.markUsedOrientation(v,Hs,Ye),this.placedOrientations[Pt]=Hs),Ki};zn(()=>nn(Jn,n.bI.horizontal),()=>{const is=Mt.verticalTextBox;return v.allowVerticalPlacement&&Et>0&&is?(Qi(is),nn(is,n.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Tn(!!(mn&&mn.box&&mn.box.length))}}if(vi=mn,ei=vi&&vi.box&&vi.box.length>0,Ei=vi&&vi.offscreen,an=vi&&vi.occluded,Ye.useRuntimeCollisionCircles){const Tn=v.text.placedSymbolArray.get(Ye.centerJustifiedTextSymbolIndex>=0?Ye.centerJustifiedTextSymbolIndex:Ye.verticalPlacedTextSymbolIndex),zn=n.bJ(v.textSizeData,H,Tn),nn=S.get("text-padding");Mi=this.collisionIndex.placeCollisionCircles(v,fe,Tn,v.lineVertexArray,v.glyphOffsetArray,zn,P,D,k,d,_e,K.predicate,Ye.collisionCircleDiameter*zn/n.bO,nn,this.retainedQueryData[v.bucketInstanceId].tileID),ei=fe||Mi.circles.length>0&&!Mi.collisionDetected,Ei=Ei&&Mi.offscreen,an=Mi.occluded}if(Mt.iconFeatureIndex&&(Cn=Mt.iconFeatureIndex),Mt.iconBox){const Tn=zn=>{Qi(zn);const nn=Ye.hasIconTextFit&&un?tn(un.x,un.y,he,_e,this.transform.angle):new n.P(0,0),is=v.getSymbolInstanceIconSize(Z,this.transform.zoom,Ye.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(v,is,zn,nn,ue,F,P,K.predicate)};os&&os.box&&os.box.length&&Mt.verticalIconBox?(Oi=Tn(Mt.verticalIconBox),ai=Oi.box.length>0):(Oi=Tn(Mt.iconBox),ai=Oi.box.length>0),Ei=Ei&&Oi.offscreen,In=Oi.occluded}const $i=ce||Ye.numHorizontalGlyphVertices===0&&Et===0,ds=me||Ye.numIconVertices===0;if($i||ds?ds?$i||(ai=ai&&ei):ei=ai&&ei:ai=ei=ai&&ei,ei&&vi&&vi.box&&this.collisionIndex.insertCollisionBox(vi.box,S.get("text-ignore-placement"),v.bucketInstanceId,os&&os.box&&_s?_s:Rn,K.ID),ai&&Oi&&this.collisionIndex.insertCollisionBox(Oi.box,S.get("icon-ignore-placement"),v.bucketInstanceId,Cn,K.ID),Mi&&(ei&&this.collisionIndex.insertCollisionCircles(Mi.circles,S.get("text-ignore-placement"),v.bucketInstanceId,Rn,K.ID),d)){const Tn=v.bucketInstanceId;let zn=this.collisionCircleArrays[Tn];zn===void 0&&(zn=this.collisionCircleArrays[Tn]=new Xf);for(let nn=0;nn<Mi.circles.length;nn+=4)zn.circles.push(Mi.circles[nn+0]),zn.circles.push(Mi.circles[nn+1]),zn.circles.push(Mi.circles[nn+2]),zn.circles.push(Mi.collisionDetected?1:0)}const Ln=v.projection.name!=="globe";Te=Te&&(Ln||!an),Ke=Ke&&(Ln||!In),this.placements[Pt]=new Or(ei||Te,ai||Ke,Ei||v.justReloaded),o.add(Pt)},ft=this.retainedQueryData[v.bucketInstanceId].tileID;if(v.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(v,ft),v.elevationType==="road"&&v.updateRoadElevation(ft.canonical),v.updateZOffset(),v.sortFeaturesByY){const Ye=v.getSortedSymbolIndexes(this.transform.angle);for(let ut=Ye.length-1;ut>=0;--ut){const Mt=Ye[ut];it(v.symbolInstances.get(Mt),Mt,v.collisionArrays[Mt])}v.hasAnyZOffset&&n.w(`${v.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(v.hasAnyZOffset){const Ye=v.getSortedIndexesByZOffset();for(let ut=0;ut<Ye.length;++ut){const Mt=Ye[ut];it(v.symbolInstances.get(Mt),Mt,v.collisionArrays[Mt])}}else for(let Ye=t.symbolInstanceStart;Ye<t.symbolInstanceEnd;Ye++)it(v.symbolInstances.get(Ye),Ye,v.collisionArrays[Ye]);if(d&&v.bucketInstanceId in this.collisionCircleArrays){const Ye=this.collisionCircleArrays[v.bucketInstanceId];n.bi(Ye.invProjMatrix,P),Ye.viewportMatrix=this.collisionIndex.getViewportMatrix()}v.justReloaded=!1}markUsedJustification(t,o,d,_){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:S,verticalPlacedTextSymbolIndex:A,crossTileID:P}=d,D=n.bV(o),k=_===n.bI.vertical?A:D==="left"?y:D==="center"?v:D==="right"?S:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=k>=0&&y!==k?0:P),v>=0&&(t.text.placedSymbolArray.get(v).crossTileID=k>=0&&v!==k?0:P),S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=k>=0&&S!==k?0:P),A>=0&&(t.text.placedSymbolArray.get(A).crossTileID=k>=0&&A!==k?0:P)}markUsedOrientation(t,o,d){const _=o===n.bI.horizontal||o===n.bI.horizontalOnly?o:0,y=o===n.bI.vertical?o:0,{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:A,verticalPlacedTextSymbolIndex:P}=d,D=t.text.placedSymbolArray;v>=0&&(D.get(v).placedOrientation=_),S>=0&&(D.get(S).placedOrientation=_),A>=0&&(D.get(A).placedOrientation=_),P>=0&&(D.get(P).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const o=this.prevPlacement;let d=!1;this.prevZoomAdjustment=o?o.zoomAdjustment(this.transform.zoom):0;const _=o?o.symbolFadeChange(t):1,y=o?o.opacities:{},v=o?o.variableOffsets:{},S=o?o.placedOrientations:{};for(const A in this.placements){const P=this.placements[A],D=y[A];D?(this.opacities[A]=new ol(D,_,P.text,P.icon,null,P.clipped),d=d||P.text!==D.text.placed||P.icon!==D.icon.placed):(this.opacities[A]=new ol(null,_,P.text,P.icon,P.skipFade,P.clipped),d=d||P.text||P.icon)}for(const A in y){const P=y[A];if(!this.opacities[A]){const D=new ol(P,_,!1,!1);D.isHidden()||(this.opacities[A]=D,d=d||P.text.placed||P.icon.placed)}}for(const A in v)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=v[A]);for(const A in S)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=S[A]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=o?o.lastPlacementChangeTime:t)}updateLayerOpacities(t,o,d,_){const y=new Set;for(const v of o){const S=v.getBucket(t);S&&v.latestFeatureIndex&&t.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,y,v,v.collisionBoxArray,d,_,v.tileID,t.scope),S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,v.tileID),S.elevationType==="road"&&S.updateRoadElevation(v.tileID.canonical),S.updateZOffset())}}updateBucketOpacities(t,o,d,_,y,v,S,A){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const P=t.layers[0].layout,D=t.layers[0].paint,k=!!t.layers[0].dynamicFilter(),z=new ol(null,0,!1,!1,!0),F=P.get("text-allow-overlap"),G=P.get("icon-allow-overlap"),j=P.get("text-variable-anchor"),H=P.get("text-rotation-alignment")==="map",Z=P.get("text-pitch-alignment")==="map",K=D.get("symbol-z-offset"),re=P.get("symbol-elevation-reference")==="sea",ce=!K.isConstant(),me=new ol(null,0,F&&(G||!t.hasIconData()||P.get("icon-optional")),G&&(F||!t.hasTextData()||P.get("text-optional")),!0);!t.collisionArrays&&_&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(_);const fe=(he,_e,ye)=>{for(let Le=0;Le<_e/4;Le++)he.opacityVertexArray.emplaceBack(ye)};let ue=0;v&&t.updateReplacement(S,v);for(let he=0;he<t.symbolInstances.length;he++){const _e=t.symbolInstances.get(he),{numHorizontalGlyphVertices:ye,numVerticalGlyphVertices:Le,crossTileID:ze,numIconVertices:qe,tileAnchorX:Xe,tileAnchorY:st}=_e;let De=null;const je=this.retainedQueryData[t.bucketInstanceId];ce&&_e&&je&&(De=d.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:je.bucketIndex,sourceLayerIndex:je.sourceLayerIndex,layoutVertexArrayOffset:0}));const Te=K.evaluate(De,{}),Ke=o.has(ze);let Be=this.opacities[ze];Ke?Be=z:Be||(Be=me,this.opacities[ze]=Be),o.add(ze);const it=ye>0||Le>0,ft=qe>0,Ye=this.placedOrientations[ze],ut=Ye===n.bI.vertical,Mt=Ye===n.bI.horizontal||Ye===n.bI.horizontalOnly;!it&&!ft||Be.isHidden()||ue++;let Pt=!1;if((it||ft)&&v)for(const Et of t.activeReplacements){if(n.bP(Et,y,n.bQ.Symbol,A)||Et.min.x>Xe||Xe>Et.max.x||Et.min.y>st||st>Et.max.y)continue;const Ut=n.bR(Xe,st,S.canonical,Et.footprintTileId.canonical);if(Pt=n.bS(Ut,Et.footprint),Pt)break}if(it){const Et=Pt?_a:Wl(Be.text);fe(t.text,ye,ut?_a:Et),fe(t.text,Le,Mt?_a:Et);const Ut=Be.text.isHidden(),{leftJustifiedTextSymbolIndex:qt,centerJustifiedTextSymbolIndex:ei,rightJustifiedTextSymbolIndex:ai,verticalPlacedTextSymbolIndex:Ei}=_e,an=t.text.placedSymbolArray,In=Ut||ut?1:0;qt>=0&&(an.get(qt).hidden=In),ei>=0&&(an.get(ei).hidden=In),ai>=0&&(an.get(ai).hidden=In),Ei>=0&&(an.get(Ei).hidden=Ut||Mt?1:0);const un=this.variableOffsets[ze];un&&this.markUsedJustification(t,un.anchor,_e,Ye);const mn=this.placedOrientations[ze];mn&&(this.markUsedJustification(t,"left",_e,mn),this.markUsedOrientation(t,mn,_e))}if(ft){const Et=Pt?_a:Wl(Be.icon),{placedIconSymbolIndex:Ut,verticalPlacedIconSymbolIndex:qt}=_e,ei=t.icon.placedSymbolArray,ai=Be.icon.isHidden()?1:0;Ut>=0&&(fe(t.icon,qe,ut?_a:Et),ei.get(Ut).hidden=ai),qt>=0&&(fe(t.icon,_e.numVerticalIconVertices,Mt?_a:Et),ei.get(qt).hidden=ai)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Et=t.collisionArrays[he];if(Et){let Ut=new n.P(0,0),qt=!0;if(Et.textBox||Et.verticalTextBox){if(j){const ai=this.variableOffsets[ze];ai?(Ut=pn(ai.anchor,ai.width,ai.height,ai.textOffset,ai.textScale),H&&Ut._rotate(Z?this.transform.angle:-this.transform.angle)):qt=!1}k&&(qt=!Be.clipped),Et.textBox&&Wo(t.textCollisionBox.collisionVertexArray,Be.text.placed,!qt||ut,Te,re,Ut.x,Ut.y),Et.verticalTextBox&&Wo(t.textCollisionBox.collisionVertexArray,Be.text.placed,!qt||Mt,Te,re,Ut.x,Ut.y)}const ei=qt&&!!(!Mt&&Et.verticalIconBox);Et.iconBox&&Wo(t.iconCollisionBox.collisionVertexArray,Be.icon.placed,ei,Te,re,_e.hasIconTextFit?Ut.x:0,_e.hasIconTextFit?Ut.y:0),Et.verticalIconBox&&Wo(t.iconCollisionBox.collisionVertexArray,Be.icon.placed,!ei,Te,re,_e.hasIconTextFit?Ut.x:0,_e.hasIconTextFit?Ut.y:0)}}}if(t.fullyClipped=ue===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const he=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=he.invProjMatrix,t.placementViewportMatrix=he.viewportMatrix,t.collisionCircleArray=he.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,o){const d=this.zoomAtLastRecencyCheck===o?1-this.zoomAdjustment(o):1;return this.zoomAtLastRecencyCheck=o,this.commitTime+this.fadeDuration*d>t}setStale(){this.stale=!0}}function Wo(u,t,o,d,_,y,v){u.emplaceBack(t?1:0,o?1:0,y||0,v||0,d,_?1:0),u.emplaceBack(t?1:0,o?1:0,y||0,v||0,d,_?1:0),u.emplaceBack(t?1:0,o?1:0,y||0,v||0,d,_?1:0),u.emplaceBack(t?1:0,o?1:0,y||0,v||0,d,_?1:0)}const on=Math.pow(2,25),ju=Math.pow(2,24),dh=Math.pow(2,17),fh=Math.pow(2,16),or=Math.pow(2,9),bs=Math.pow(2,8),tv=Math.pow(2,1);function Wl(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;const t=u.placed?1:0,o=Math.floor(127*u.opacity);return o*on+t*ju+o*dh+t*fh+o*or+t*bs+o*tv+t}const _a=0;class ph{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,o,d,_,y,v){const S=this._bucketParts;for(;this._currentTileIndex<t.length;)if(o.getBucketParts(S,_,t[this._currentTileIndex],this._sortAcrossTiles,v),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((A,P)=>A.sortKey-P.sortKey));this._currentPartIndex<S.length;){const A=S[this._currentPartIndex];if(o.placeLayerBucketPart(A,this._seenCrossTileIDs,d,A.symbolInstanceStart===0,v),this._currentPartIndex++,y())return!0}return!1}}class $u{constructor(t,o,d,_,y,v,S,A,P){this.placement=new Er(t,y,v,S,A,P),this._currentPlacementIndex=o.length-1,this._forceFullPlacement=d,this._showCollisionBoxes=_,this._done=!1}isDone(){return this._done}continuePlacement(t,o,d,_,y){const v=n.q.now(),S=()=>{const A=n.q.now()-v;return!this._forceFullPlacement&&A>2};for(;this._currentPlacementIndex>=0;){const A=o[t[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){const D=A,k=D.layout.get("symbol-z-elevate"),z=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,F=D.layout.get("symbol-z-order"),G=F==="viewport-y"||F==="auto"&&!(F!=="viewport-y"&&z),j=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),H=G&&j,Z=this._inProgressLayer=this._inProgressLayer||new ph(D),K=n.C(A.source,A.scope);if(Z.continuePlacement(k||H?_[K]:d[K],this.placement,this._showCollisionBoxes,A,S,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const mh=512/n.aj/2;class Gu{constructor(t,o,d){this.tileID=t,this.bucketInstanceId=d,this.index=new n.bW(o.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const _=t.canonical.x*n.aj,y=t.canonical.y*n.aj;for(let v=0;v<o.length;v++){const{key:S,crossTileID:A,tileAnchorX:P,tileAnchorY:D}=o.get(v),k=Math.floor((_+P)*mh),z=Math.floor((y+D)*mh);this.index.add(k,z),this.keys.push(S),this.crossTileIDs.push(A)}this.index.finish()}findMatches(t,o,d){const _=this.tileID.canonical.z<o.canonical.z?1:Math.pow(2,this.tileID.canonical.z-o.canonical.z),y=mh/Math.pow(2,o.canonical.z-this.tileID.canonical.z),v=o.canonical.x*n.aj,S=o.canonical.y*n.aj;for(let A=0;A<t.length;A++){const P=t.get(A);if(P.crossTileID)continue;const{key:D,tileAnchorX:k,tileAnchorY:z}=P,F=Math.floor((v+k)*y),G=Math.floor((S+z)*y),j=this.index.range(F-_,G-_,F+_,G+_).sort((H,Z)=>H-Z);for(const H of j){const Z=this.crossTileIDs[H];if(this.keys[H]===D&&!d.has(Z)){d.add(Z),P.crossTileID=Z;break}}}}}class ar{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const o=Math.round((t-this.lng)/360);if(o!==0)for(const d in this.indexes){const _=this.indexes[d],y={};for(const v in _){const S=_[v];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+o),y[S.tileID.key]=S}this.indexes[d]=y}this.lng=t}addBucket(t,o,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===o.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<o.symbolInstances.length;y++)o.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const _=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const v=this.indexes[y];if(Number(y)>t.overscaledZ)for(const S in v){const A=v[S];A.tileID.isChildOf(t)&&A.findMatches(o.symbolInstances,t,_)}else{const S=v[t.scaledTo(Number(y)).key];S&&S.findMatches(o.symbolInstances,t,_)}}for(let y=0;y<o.symbolInstances.length;y++){const v=o.symbolInstances.get(y);v.crossTileID||(v.crossTileID=d.generate(),_.add(v.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Gu(t,o.symbolInstances,o.bucketInstanceId),!0}removeBucketCrossTileIDs(t,o){for(const d of o.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let o=!1;for(const d in this.indexes){const _=this.indexes[d];for(const y in _)t[_[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,_[y]),delete _[y],o=!0)}return o}}class gr{constructor(){this.layerIndexes={},this.crossTileIDs=new ar,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,o,d,_){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new qo);let v=!1;const S={};_.name!=="globe"&&y.handleWrapJump(d);for(const A of o){const P=A.getBucket(t);P&&t.fqid===P.layerIds[0]&&(P.bucketInstanceId||(P.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(A.tileID,P,this.crossTileIDs)&&(v=!0),S[P.bucketInstanceId]=!0)}return y.removeStaleBuckets(S)&&(v=!0),v}pruneUnusedLayers(t){const o={};t.forEach(d=>{o[d]=!0});for(const d in this.layerIndexes)o[d]||delete this.layerIndexes[d]}}const al=771;class Di{constructor(t,o,d,_){this.blendFunction=t,this.blendColor=o.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=_}}Di.Replace=[1,0,1,0],Di.disabled=new Di(Di.Replace,n.am.transparent,[!1,!1,!1,!1]),Di.unblended=new Di(Di.Replace,n.am.transparent,[!0,!0,!0,!0]),Di.alphaBlended=new Di([1,al,1,al],n.am.transparent,[!0,!0,!0,!0]),Di.alphaBlendedNonPremultiplied=new Di([770,al,770,al],n.am.transparent,[!0,!0,!0,!0]),Di.multiply=new Di([774,0,774,0],n.am.transparent,[!0,!0,!0,!0]);class It{constructor(t,o,d){this.func=t,this.mask=o,this.range=d}}It.ReadOnly=!1,It.ReadWrite=!0,It.disabled=new It(519,It.ReadOnly,[0,1]);const Wr=7680;class ci{constructor(t,o,d,_,y,v){this.test=t,this.ref=o,this.mask=d,this.fail=_,this.depthFail=y,this.pass=v}}ci.disabled=new ci({func:519,mask:0},0,0,Wr,Wr,Wr);const ms=1029,_h=2305;class ni{constructor(t,o,d){this.enable=t,this.mode=o,this.frontFace=d}}function ql(u,t){const o=n.c1(u,3);n.c3(u,t),n.c7(u,3,o)}function Zl(u,t){const o=n.b_([]);return n.b$(o,o,-t),n.c0(o,o,-u),o}function ga(u,t){const o=[u[0],u[1],0],d=[t[0],t[1],0];if(n.ae(o)>=1e-15){const v=n.au([],o);n.bY(d,v,n.bG(d,v)),t[0]=d[0],t[1]=d[1]}const _=n.bF([],t,u);if(n.bZ(_)<1e-15)return null;const y=Math.atan2(-_[1],_[0]);return Zl(Math.atan2(Math.sqrt(u[0]*u[0]+u[1]*u[1]),-u[2]),y)}ni.disabled=new ni(!1,ms,_h),ni.backCCW=new ni(!0,ms,_h),ni.backCW=new ni(!0,ms,2304),ni.frontCW=new ni(!0,1028,2304),ni.frontCCW=new ni(!0,1028,_h);class L_{constructor(t,o){this.position=t,this.orientation=o}get position(){return this._position}set position(t){if(t){const o=t instanceof n.ac?t:new n.ac(t[0],t[1],t[2]);this._renderWorldCopies&&(o.x=n.bX(o.x,0,1)),this._position=o}else this._position=null}lookAtPoint(t,o){if(this.orientation=null,!this.position)return;const d=this.position,_=this._elevation?this._elevation.getAtPointOrZero(n.ac.fromLngLat(t)):0,y=n.ac.fromLngLat(t,_),v=[y.x-d.x,y.y-d.y,y.z-d.z];o||(o=[0,0,1]),o[2]=Math.abs(o[2]),this.orientation=ga(v,o)}setPitchBearing(t,o){this.orientation=Zl(n.al(t),n.al(-o))}}class qr{constructor(t,o){this._transform=n.bx([]),this.orientation=o,this.position=t}get mercatorPosition(){const t=this.position;return new n.ac(t[0],t[1],t[2])}get position(){const t=n.c1(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var o;t&&n.c7(this._transform,3,[(o=t)[0],o[1],o[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||n.b_([]),t&&ql(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),o=this.right();return{bearing:Math.atan2(-o[1],o[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,o){this._orientation=Zl(t,o),ql(this._transform,this._orientation)}forward(){const t=n.c1(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=n.c1(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=n.c1(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,o){const d=new Float64Array(16);return n.bi(d,this.getWorldToCamera(t,o)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,o,d){const _=this.position;n.bY(_,_,-t);const y=new Float64Array(16);return n.bn(y,[d,d,d]),n.bo(y,y,_),y[10]*=o,y}getWorldToCamera(t,o){const d=new Float64Array(16),_=new Float64Array(4),y=this.position;return n.c2(_,this._orientation),n.bY(y,y,-t),n.c3(d,_),n.bo(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=o,d[9]*=o,d[10]*=o,d[11]*=o,d}getCameraToClipPerspective(t,o,d,_){const y=new Float64Array(16);return n.c4(y,t,o,d,_),y}getCameraToClipOrthographic(t,o,d,_,y,v){const S=new Float64Array(16);return n.c5(S,t,o,d,_,y,v),S}getDistanceToElevation(t,o=!1){const d=t===0?0:n.c6(t,o?n.aY(this.position[1]):this.position[1]),_=this.forward();return(d-this.position[2])/_[2]}clone(){return new qr([...this.position],[...this.orientation])}}const lr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class gh{constructor(t=0,o=0,d=0,_=0){if(isNaN(t)||t<0||isNaN(o)||o<0||isNaN(d)||d<0||isNaN(_)||_<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=o,this.left=d,this.right=_}interpolate(t,o,d){return o.top!=null&&t.top!=null&&(this.top=n.ai(t.top,o.top,d)),o.bottom!=null&&t.bottom!=null&&(this.bottom=n.ai(t.bottom,o.bottom,d)),o.left!=null&&t.left!=null&&(this.left=n.ai(t.left,o.left,d)),o.right!=null&&t.right!=null&&(this.right=n.ai(t.right,o.right,d)),this}getCenter(t,o){const d=n.ay((this.left+t-this.right)/2,0,t),_=n.ay((this.top+o-this.bottom)/2,0,o);return new n.P(d,_)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new gh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Ns=15;class Yf{constructor(t,o,d,_,y,v,S){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=o||22,this._minPitch=d??0,this._maxPitch=_??60,this.setProjection(v),this.setMaxBounds(S),this.width=0,this.height=0,this._center=new n.cd(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new gh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new qr,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Yf(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<Ns}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,o=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(o),this._calcMatrices()}getProjection(){return n.aF(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const o=this.projection?this.getProjection():void 0;this.projection=n.ce(this.projectionOptions);const d=this.getProjection(),_=!n.bv(o,d);return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.ce({name:"mercator"});const o=t!==this.projection.name;return o&&this._calcMatrices(),o}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.c6(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bX(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const o=-t*Math.PI/180;this.angle!==o&&(this._unmodified=!1,this.angle=o,this._calcMatrices(),this.rotationMatrix=n.cf(),n.cg(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const o=n.ay(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==o&&(this._unmodified=!1,this._pitch=o,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=n.al(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const o=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==o&&(this._unmodified=!1,this._setZoom(o),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,o=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!o||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;o||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,o=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let _=0,y=0;for(let v=0;v<o.length;v++){const S=new n.P(o[v][0]*this.width,d+o[v][1]*(this.height-d)),A=t.pointCoordinate(S);if(!A)continue;const P=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);_+=A[3]*P,y+=P}return y===0?NaN:_/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,o=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*o,_=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),v=Math.max(_-d,y);this._setZoom(this._zoomFromMercatorZ(v))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(t){const o=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[o.x,o.y,o.z]:[t.x,t.y,t.z];const _=n.ae(n.at([],this._camera.position,d));return n.ay(this._zoomFromMercatorZ(_),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let o=!1;if(t.orientation&&!n.ch(t.orientation,this._camera.orientation)&&(o=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];n.ci(d,this._camera.position)||(this._setCameraPosition(d),o=!0)}o&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,o=new L_;return o.position=new n.ac(t[0],t[1],t[2]),o.orientation=this._camera.orientation,o._elevation=this.elevation,o._renderWorldCopies=this.renderWorldCopies,o}_setCameraOrientation(t){if(!n.cj(t))return!1;n.ck(t,t);const o=n.cl([],[0,0,-1],t),d=n.cl([],[0,-1,0],t);if(d[2]<0)return!1;const _=ga(o,d);return!!_&&(this._camera.orientation=_,!0)}_setCameraPosition(t){const o=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,_=this.cameraToCenterDistance;t[2]=n.ay(t[2],_/d,_/o),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,o,d){this._unmodified=!1,this._edgeInsets.interpolate(t,o,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const o=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,o)}getVisibleUnwrappedCoordinates(t){const o=[new n.cm(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new n.P(0,0)),_=this.pointCoordinate(new n.P(this.width,0)),y=this.pointCoordinate(new n.P(this.width,this.height)),v=this.pointCoordinate(new n.P(0,this.height)),S=Math.floor(Math.min(d.x,_.x,y.x,v.x)),A=Math.floor(Math.max(d.x,_.x,y.x,v.x)),P=1;for(let D=S-P;D<=A+P;D++)D!==0&&o.push(new n.cm(D,t))}return o}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,o,d){let _=[];const y=d!=null,v=!y;if(v&&this.zoom<o||y&&d[0]===0&&d[1]===0)return _;const S=new Set,A=(D,k,z,F,G)=>{const j=n.cK(k,D,z,F,G);S.has(j)||(_.push(new n.aM(D,k,z,F,G)),S.add(j))};for(let D=0;D<t.length;D++){const k=t[D];if(v&&k.canonical.z!==o)continue;const z=k.canonical,F=k.overscaledZ,G=k.wrap,j=1<<z.z,H=z.x+1<j,Z=z.x>0,K=z.y+1<j,re=z.y>0,ce=k.wrap-(Z?0:1),me=k.wrap+(H?0:1),fe=Z?z.x-1:j-1,ue=H?z.x+1:0;if(y)d[0]<0?(A(F,me,z.z,ue,z.y),d[1]<0&&K&&(A(F,G,z.z,z.x,z.y+1),A(F,me,z.z,ue,z.y+1)),d[1]>0&&re&&(A(F,G,z.z,z.x,z.y-1),A(F,me,z.z,ue,z.y-1))):d[0]>0?(A(F,ce,z.z,fe,z.y),d[1]<0&&K&&(A(F,G,z.z,z.x,z.y+1),A(F,ce,z.z,fe,z.y+1)),d[1]>0&&re&&(A(F,G,z.z,z.x,z.y-1),A(F,ce,z.z,fe,z.y-1))):d[1]<0&&K?A(F,G,z.z,z.x,z.y+1):re&&A(F,G,z.z,z.x,z.y-1);else{const he=k.visibleQuadrants;1&he&&(A(F,ce,z.z,fe,z.y),re&&(A(F,G,z.z,z.x,z.y-1),A(F,ce,z.z,fe,z.y-1))),2&he&&(A(F,me,z.z,ue,z.y),re&&(A(F,G,z.z,z.x,z.y-1),A(F,me,z.z,ue,z.y-1))),4&he&&(A(F,ce,z.z,fe,z.y),K&&(A(F,G,z.z,z.x,z.y+1),A(F,ce,z.z,fe,z.y+1))),8&he&&(A(F,me,z.z,ue,z.y),K&&(A(F,G,z.z,z.x,z.y+1),A(F,me,z.z,ue,z.y+1)))}}const P=[];for(const D of _)_.some(k=>D.isChildOf(k))||P.push(D);if(_=P.filter(D=>!t.some(k=>!!(D.overscaledZ<o&&k.isChildOf(D))||D.equals(k)||D.isChildOf(k))),v){const D=1<<o,k=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[D*k.x,D*k.y],F=4,G=F*F;_=_.filter(j=>{const H=j.canonical.x+.5-z[0],Z=j.canonical.y+.5-z[1];return H*H+Z*Z<G})}return _}coveringTiles(t){let o=this.coveringZoomLevel(t);const d=o,_=this.elevation&&this.elevation.exaggeration(),y=_&&!t.isTerrainDEM,v=this.projection.name==="mercator";if(t.minzoom!==void 0&&o<t.minzoom)return[];t.maxzoom!==void 0&&o>t.maxzoom&&(o=t.maxzoom);const S=this.locationCoordinate(this.center),A=this.center.lat,P=1<<o,D=[P*S.x,P*S.y,0],k=this.projection.name==="globe",z=!k,F=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,o,z),G=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),j=P*n.c6(1,this.center.lat),H=this._camera.position[2]/n.c6(1,this.center.lat),Z=[P*G.x,P*G.y,H*(z?1:j)],K=k||_,re=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),ce=this.isLODDisabled(!0)?o:0;let me;if(this._elevation&&t.isTerrainDEM)me=1e4*this._elevation.exaggeration();else if(this._elevation){const Te=this._elevation.getMinMaxForVisibleTiles();me=Te?Te.max:this._centerAltitude}else me=this._centerAltitude;const fe=t.isTerrainDEM?-me:this._elevation?this._elevation.getMinElevationBelowMSL():0,ue=this.projection.isReprojectedInTileSpace?n.co(this):1,he=Te=>{const Be=new n.ac(Te.x+25e-6,Te.y,Te.z),it=new n.ac(Te.x,Te.y+25e-6,Te.z),ft=Te.toLngLat(),Ye=Be.toLngLat(),ut=it.toLngLat(),Mt=this.locationCoordinate(ft),Pt=this.locationCoordinate(Ye),Et=this.locationCoordinate(ut),Ut=Math.hypot(Pt.x-Mt.x,Pt.y-Mt.y),qt=Math.hypot(Et.x-Mt.x,Et.y-Mt.y);return Math.sqrt(Ut*qt)*ue/25e-6},_e=Te=>{const Ke=me,Be=fe;return{aabb:n.cr(this,P,0,0,0,Te,Be,Ke,this.projection),zoom:0,x:0,y:0,minZ:Be,maxZ:Ke,wrap:Te,fullyVisible:!1}},ye=[];let Le=[];const ze=o,qe=t.reparseOverscaled?d:o,Xe=(H-this._centerAltitude)*j,st=Te=>{if(!this._elevation||!Te.tileID||!v)return;const Ke=this._elevation.getMinMaxForTile(Te.tileID),Be=Te.aabb;Ke?(Be.min[2]=Ke.min,Be.max[2]=Ke.max,Be.center[2]=(Be.min[2]+Be.max[2])/2):(Te.shouldSplit=je(Te),Te.shouldSplit||(Be.min[2]=Be.max[2]=Be.center[2]=this._centerAltitude))},De=(Te,Ke)=>{if(.707*Ke<Te)return 1;const Be=Ke/Te;return Be/(1.4144271570014144+(Math.pow(1.1,Be-1.4144271570014144+1)-1)/(1.1-1)-1)},je=Te=>{if(Te.zoom<ce)return!0;if(Te.zoom===ze)return!1;if(Te.shouldSplit!=null)return Te.shouldSplit;const Ke=Te.aabb.distanceX(Z),Be=Te.aabb.distanceY(Z);let it=Xe,ft=1;if(k){it=Te.aabb.distanceZ(Z);const qt=Math.pow(2,Te.zoom),ei=n.aY((Te.y+1)/qt),ai=n.aY(Te.y/qt),Ei=Math.min(Math.max(A,ei),ai),an=n.cO(Ei)/n.cO(A);if(ft=Ei===A?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,an/this._mercatorScaleRatio),this.zoom<=n.cL&&Te.zoom===ze-1&&an>=.9)return!0}else if(y&&(it=Te.aabb.distanceZ(Z)*j),this.projection.isReprojectedInTileSpace&&d<=5){const qt=Math.pow(2,Te.zoom),ei=he(new n.ac((Te.x+.5)/qt,(Te.y+.5)/qt));ft=ei>.85?1:ei}if(!v){const qt=Math.sqrt(Ke*Ke+Be*Be+it*it);let ei=(1<<ze-Te.zoom)*re*ft;return ei*=De(Math.max(it,Xe),qt),qt<ei}let Ye=Number.MAX_VALUE,ut=0;const Mt=Te.aabb.getCorners(),Pt=[];for(const qt of Mt){n.at(Pt,qt,Z),k||(y?Pt[2]*=j:Pt[2]=Xe);const ei=n.bG(Pt,this._camera.forward());ei<Ye&&(Ye=ei,ut=Math.abs(Pt[2]))}let Et=(1<<ze-Te.zoom)*re*ft;if(Et*=De(Math.max(ut,Xe),Ye),Ye<Et)return!0;const Ut=Te.aabb.closestPoint(D);return Ut[0]===D[0]&&Ut[1]===D[1]};if(this.renderWorldCopies)for(let Te=1;Te<=3;Te++)ye.push(_e(-Te)),ye.push(_e(Te));for(ye.push(_e(0));ye.length>0;){const Te=ye.pop(),Ke=Te.x,Be=Te.y;let it=Te.fullyVisible;const ft=()=>this.projection.name==="globe"&&(Te.y===0||Te.y===(1<<Te.zoom)-1);if(!it){let Ye=K?Te.aabb.intersects(F):Te.aabb.intersectsFlat(F);if(Ye===0&&ft()){const ut=new n.cp(Te.zoom,Ke,Be);Ye=n.cq(this,P,ut,!0).intersects(F)}if(Ye===0)continue;it=Ye===2}if(Te.zoom!==ze&&je(Te))for(let Ye=0;Ye<4;Ye++){const ut=(Ke<<1)+Ye%2,Mt=(Be<<1)+(Ye>>1),Pt={aabb:v?Te.aabb.quadrant(Ye):n.cr(this,P,Te.zoom+1,ut,Mt,Te.wrap,Te.minZ,Te.maxZ,this.projection),zoom:Te.zoom+1,x:ut,y:Mt,wrap:Te.wrap,fullyVisible:it,tileID:void 0,shouldSplit:void 0,minZ:Te.minZ,maxZ:Te.maxZ};y&&!k&&(Pt.tileID=new n.aM(Te.zoom+1===ze?qe:Te.zoom+1,Te.wrap,Te.zoom+1,ut,Mt),st(Pt)),ye.push(Pt)}else{const Ye=Te.zoom===ze?qe:Te.zoom;if(t.minzoom&&t.minzoom>Ye)continue;let ut=0;if(!it){let Ut=K?Te.aabb.intersectsPrecise(F):Te.aabb.intersectsPreciseFlat(F);if(Ut===0&&ft()){const qt=new n.cp(Te.zoom,Ke,Be);Ut=n.cq(this,P,qt,!0).intersectsPrecise(F)}if(Ut===0)continue;if(t.calculateQuadrantVisibility)if(F.containsPoint(Te.aabb.center))ut=15;else for(let qt=0;qt<4;qt++)Te.aabb.quadrant(qt).intersects(F)!==0&&(ut|=1<<qt)}const Mt=D[0]-(.5+Ke+(Te.wrap<<Te.zoom))*(1<<o-Te.zoom),Pt=D[1]-.5-Be,Et=Te.tileID?Te.tileID:new n.aM(Ye,Te.wrap,Te.zoom,Ke,Be);t.calculateQuadrantVisibility&&(Et.visibleQuadrants=ut),Le.push({tileID:Et,distanceSq:Mt*Mt+Pt*Pt})}}if(this.fogCullDistSq){const Te=this.fogCullDistSq,Ke=this.horizonLineFromTop();Le=Le.filter(Be=>{const it=[0,0,0,1],ft=[n.aj,n.aj,0,1],Ye=this.calculateFogTileMatrix(Be.tileID.toUnwrapped());n.aA(it,it,Ye),n.aA(ft,ft,Ye);const ut=n.cs([],it,ft),Mt=n.ct([],it,ft),Pt=n.cM(ut,Mt);if(Pt===0)return!0;let Et=!1;const Ut=this._elevation;if(Ut&&Pt>Te&&Ke!==0){const qt=this.calculateProjMatrix(Be.tileID.toUnwrapped());let ei;t.isTerrainDEM||(ei=Ut.getMinMaxForTile(Be.tileID)),ei||(ei={min:fe,max:me});const ai=n.cu(this.rotation),Ei=[ai[0]*n.aj,ai[1]*n.aj,ei.max];n.ad(Ei,Ei,qt),Et=(1-Ei[1])*this.height*.5<Ke}return Pt<Te||Et})}return Le.sort((Te,Ke)=>Te.distanceSq-Ke.distanceSq).map(Te=>Te.tileID)}resize(t,o){this.width=t,this.height=o,this.pixelsToGLUnits=[2/t,-2/o],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const o=n.ay(t.lat,-85.051129,n.cv),d=this.projection.project(t.lng,o);return new n.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.c6(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,o){let d,_;const y=this.centerPoint;if(this.projection.name==="globe"){const S=this.worldSize;d=(o.x-y.x)/S,_=(o.y-y.y)/S}else{const S=this.pointCoordinate(o),A=this.pointCoordinate(y);d=S.x-A.x,_=S.y-A.y}const v=this.locationCoordinate(t);this.setLocation(new n.ac(v.x-d,v.y-_))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,o){return this.projection.locationPoint(this,t,o)}locationPoint3D(t,o){return this.projection.locationPoint(this,t,o,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,o){return this.coordinateLocation(this.pointCoordinate3D(t,o))}locationCoordinate(t,o){const d=o?n.c6(o,t.lat):void 0,_=this.projection.project(t.lng,t.lat);return new n.ac(_.x,_.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,o){const d=o??this._centerAltitude,_=[t.x,t.y,0,1],y=[t.x,t.y,1,1];n.aA(_,_,this.pixelMatrixInverse),n.aA(y,y,this.pixelMatrixInverse);const v=y[3];n.cw(_,_,1/_[3]),n.cw(y,y,1/v);const S=_[2],A=y[2];return{p0:_,p1:y,t:S===A?0:(d-S)/(A-S)}}screenPointToMercatorRay(t){const o=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return n.aA(o,o,this.pixelMatrixInverse),n.aA(d,d,this.pixelMatrixInverse),n.cw(o,o,1/o[3]),n.cw(d,d,1/d[3]),o[2]=n.c6(o[2],this._center.lat)*this.worldSize,d[2]=n.c6(d[2],this._center.lat)*this.worldSize,n.cw(o,o,1/this.worldSize),n.cw(d,d,1/this.worldSize),new n.av([o[0],o[1],o[2]],n.au([],n.at([],d,o)))}rayIntersectionCoordinate(t){const{p0:o,p1:d,t:_}=t,y=n.c6(o[2],this._center.lat),v=n.c6(d[2],this._center.lat);return new n.ac(n.ai(o[0],d[0],_)/this.worldSize,n.ai(o[1],d[1],_)/this.worldSize,n.ai(y,v,_))}pointCoordinate(t,o=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,o)}pointCoordinate3D(t,o){if(!this.elevation)return this.pointCoordinate(t,o);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new n.ac(d[0],d[1],d[2]);let _=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,o);const v=.02*y,S=t.clone();for(let A=0;A<10&&y-_>v;A++){S.y=n.ai(_,y,.66);const P=this.projection.pointCoordinate3D(this,S.x,S.y);P?(y=S.y,d=P):_=S.y}return d?new n.ac(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=n.cx)return!this.isPointAboveHorizon(t);const o=this.pointCoordinate(t);return o.y>=0&&o.y<=1}_coordinatePoint(t,o){const d=o&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,_=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return n.aA(_,_,this.pixelMatrix),_[3]>0?new n.P(_[0]/_[3],_[1]/_[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:o}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,y=this.pointLocation3D(new n.P(o,t)),v=this.pointLocation3D(new n.P(_,t)),S=this.pointLocation3D(new n.P(_,d)),A=this.pointLocation3D(new n.P(o,d));let P=Math.min(y.lng,v.lng,S.lng,A.lng),D=Math.max(y.lng,v.lng,S.lng,A.lng),k=Math.min(y.lat,v.lat,S.lat,A.lat),z=Math.max(y.lat,v.lat,S.lat,A.lat);const F=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,j=(H,Z,K,re,ce)=>{const me=(H+K)/2,fe=(Z+re)/2,ue=new n.P(me,fe),{lng:he,lat:_e}=this.pointLocation3D(ue),ye=Math.max(0,P-he,k-_e,he-D,_e-z);P=Math.min(P,he),D=Math.max(D,he),k=Math.min(k,_e),z=Math.max(z,_e),(ce<G||ye>F)&&(j(H,Z,me,fe,ce+1),j(me,fe,K,re,ce+1))};if(j(o,t,_,t,1),j(_,t,_,d,1),j(_,d,o,d,1),j(o,d,o,t,1),this.projection.name==="globe"){const[H,Z]=n.cy(this);H?(z=90,D=180,P=-180):Z&&(k=-90,D=180,P=-180)}return new n.aG(new n.cd(P,k),new n.cd(D,z))}_getBoundsRectangular(t,o){const{top:d,left:_}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,v=this.width-this._edgeInsets.right,S=new n.P(_,d),A=new n.P(v,d),P=new n.P(v,y),D=new n.P(_,y);let k=this.pointCoordinate(S,t),z=this.pointCoordinate(A,t);const F=this.pointCoordinate(P,o),G=this.pointCoordinate(D,o),j=(H,Z)=>(Z.y-H.y)/(Z.x-H.x);return k.y>1&&z.y>=0?k=new n.ac((1-G.y)/j(G,k)+G.x,1):k.y<0&&z.y<=1&&(k=new n.ac(-G.y/j(G,k)+G.x,0)),z.y>1&&k.y>=0?z=new n.ac((1-F.y)/j(F,z)+F.x,1):z.y<0&&k.y<=1&&(z=new n.ac(-F.y/j(F,z)+F.x,0)),new n.aG().extend(this.coordinateLocation(k)).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(F))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const o=t.visibleDemTiles.reduce((d,_)=>{if(_.dem){const y=_.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(o.min*t.exaggeration(),o.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const o=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-o*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-85.051129,this.maxLat=n.cv,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aD(this.minLng)*this.tileSize,this.worldMaxX=n.aD(this.maxLng)*this.tileSize,this.worldMinY=n.aH(this.maxLat)*this.tileSize,this.worldMaxY=n.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,o){return this.projection.createTileMatrix(this,o,t)}calculateDistanceTileData(t){const o=t.key,d=this._distanceTileDataCache;if(d[o])return d[o];const _=t.canonical,y=1/this.height,v=this.cameraWorldSize,S=v/this.zoomScale(_.z),A=(_.x+Math.pow(2,_.z)*t.wrap)*S,P=_.y*S,D=this.point;D.x*=v/this.worldSize,D.y*=v/this.worldSize;const k=this.angle,z=Math.sin(-k),F=-Math.cos(-k);return d[o]={bearing:[z,F],center:[(D.x-A)*y,(D.y-P)*y],scale:S/n.aj*y},d[o]}calculateFogTileMatrix(t){const o=t.key,d=this._fogTileMatrixCache;if(d[o])return d[o];const _=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return n.az(_,this.worldToFogMatrix,_),d[o]=new Float32Array(_),d[o]}calculateProjMatrix(t,o=!1,d=!1){const _=t.key;let y;if(y=d?this._expandedProjMatrixCache:o?this._alignedProjMatrixCache:this._projMatrixCache,y[_])return y[_];const v=this.calculatePosMatrix(t,this.worldSize);let S;return S=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:o?this.alignedProjMatrix:this.projMatrix,n.az(v,S,v),y[_]=new Float32Array(v),y[_]}calculatePixelsToTileUnitsMatrix(t){const o=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[o])return d[o];const _=n.cz(t,this);return d[o]=_,d[o]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,o=n.bn([],[t,t,t]);return n.az(o,o,this.globeMatrix),o}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const o=n.c6(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(o),_=this._camera.forward(),y=n.c6(1,this._center.lat);d[2]/=y,_[2]/=y,n.au(_,_);const v=t.raycast(d,_,t.exaggeration());if(v){const S=n.bE([],d,_,v),A=new n.ac(S[0],S[1],n.c6(S[2],n.aY(S[1]))),P=(A.z+n.ae([A.x-d[0],A.y-d[1],A.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(P),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const o=this._elevation,d=n.c6(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(d),y=o.getAtPointOrZero(new n.ac(..._)),v=this.pixelsPerMeter/this.worldSize*y,S=this._minimumHeightOverTerrain(),A=_[2]-v;if(A<=S)if(A<0||t){const P=this.locationCoordinate(this._center,this._centerAltitude),D=[_[0],_[1],P.z-_[2]],k=n.ae(D);D[2]-=(S-A)/this._pixelsPerMercatorPixel;const z=n.ae(D);if(z===0)return;n.bY(D,D,k/z*this._pixelsPerMercatorPixel),this._camera.position=[_[0],_[1],P.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const z=this.center;return z.lat=n.ay(z.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(z.lng=n.ay(z.lng,this.minLng,this.maxLng)),this.center=z,void(this._constraining=!1)}const o=this._unmodified,{x:d,y:_}=this.point;let y=0,v=d,S=_;const A=this.width/2,P=this.height/2,D=this.worldMinY*this.scale,k=this.worldMaxY*this.scale;if(_-P<D&&(S=D+P),_+P>k&&(S=k-P),k-D<this.height&&(y=Math.max(y,this.height/(k-D)),S=(k+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const z=this.worldMinX*this.scale,F=this.worldMaxX*this.scale,G=this.worldSize/2-(z+F)/2;v=(d+G+this.worldSize)%this.worldSize-G,v-A<z&&(v=z+A),v+A>F&&(v=F-A),F-z<this.width&&(y=Math.max(y,this.width/(F-z)),v=(F+z)/2)}v===d&&S===_||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(v,S))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=o,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,o=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.c6(1,this.center.lat)/n.c6(1,n.cP));const _=n.cA(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,v=this._camera.getWorldToCamera(this.worldSize,y);let S;const A=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(A[8]=2*-t.x/this.width,A[9]=2*t.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ye=_e*this.aspect,Le=-ye,ze=-_e;ye-=t.x,Le-=t.x,_e+=t.y,ze+=t.y,S=this._camera.getCameraToClipOrthographic(Le,ye,ze,_e,this._nearZ,this._farZ),((qe,Xe,st,De)=>{for(let je=0;je<16;je++)qe[je]=n.ai(Xe[je],st[je],De)})(S,S,A,n.cN(this.pitch>=Ns?1:this.pitch/Ns))}else S=A;const P=n.cB([],A,v);let D=n.cB([],S,v);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),ye=n.bx([]);n.bo(ye,ye,[_e.x*this.worldSize,_e.y*this.worldSize,0]),n.az(ye,ye,n.cC(this)),n.bo(ye,ye,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),n.az(D,D,ye),n.az(P,P,ye),this.inverseAdjustmentMatrix=n.cD(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cE([],D,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=D,this.invProjMatrix=n.bi(new Float64Array(16),this.projMatrix),o){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-t.x/this.width,_e[9]=2*t.y/this.height,this.expandedFarZProjMatrix=n.cB([],_e,v)}else this.expandedFarZProjMatrix=this.projMatrix;const k=n.bi([],S);this.frustumCorners=n.cF.fromInvProjectionMatrix(k,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!o);const z=new Float32Array(16);n.bx(z),n.cE(z,z,[1,-1,1]),n.cG(z,z,this._pitch),n.by(z,z,this.angle);const F=n.c4(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bw(F);const G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;F[8]=2*-t.x/this.width,F[9]=2*(t.y+G)/this.height,this.skyboxMatrix=n.az(z,F,z);const j=this.point,H=j.x,Z=j.y,K=this.width%2/2,re=this.height%2/2,ce=Math.cos(this.angle),me=Math.sin(this.angle),fe=H-Math.round(H)+ce*K+me*re,ue=Z-Math.round(Z)+ce*re+me*K,he=new Float64Array(D);if(n.bo(he,he,[fe>.5?fe-1:fe,ue>.5?ue-1:ue,0]),this.alignedProjMatrix=he,D=n.bz(),n.cE(D,D,[this.width/2,-this.height/2,1]),n.bo(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=n.bz(),n.cE(D,D,[1,-1,1]),n.bo(D,D,[-1,-1,0]),n.cE(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=n.az(new Float64Array(16),this.labelPlaneMatrix,P),this._calcFogMatrices(),this._distanceTileDataCache={},D=n.bi(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cH(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.ad(_e,_e,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,o=this.cameraPixelsPerMeter,d=this._camera.position,_=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,o];n.bY(y,y,_),n.bY(d,d,-1),n.cI(d,d,y);const v=n.bz();n.bo(v,v,d),n.cE(v,v,y),this.mercatorFogMatrix=v,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,o,_)}_computeCameraPosition(t){const o=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),_=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*o-t/this.worldSize*this._centerAltitude;return[_.x/this.worldSize-d[0]*y,_.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const o=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],_=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),_>0&&(y=Math.min((o-d)/_,1)),this._camera.position=n.bE([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,o=this._camera.forward(),{pitch:d,bearing:_}=this._camera.getPitchBearing(),y=n.c6(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,v=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.al(this._maxPitch)),S=Math.max((t[2]-y)/Math.cos(d),v),A=this._zoomFromMercatorZ(S);n.bE(t,t,o,S),this._pitch=n.ay(d,n.al(this.minPitch),n.al(this.maxPitch)),this.angle=n.bX(_,-Math.PI,Math.PI),this._setZoom(n.ay(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ac(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let o=0,d=n.cx,_=0,y=1/0;for(;d-o>1e-6&&d>o;){const v=o+.5*(d-o),S=this.tileSize*Math.pow(2,v),A=this.getCameraToCenterDistance(this.projection,v,S),P=this.scaleZoom(A/(Math.max(0,t)*this.tileSize)),D=Math.abs(v-P);D<y&&(y=D,_=v),v<P?o=v:d=v}return _}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,o){const d=Math.min(t.x,o.x),_=Math.max(t.x,o.x),y=Math.min(t.y,o.y),v=Math.max(t.y,o.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const S=[new n.P(d,y),new n.P(_,v),new n.P(d,v),new n.P(_,y)],A=this.renderWorldCopies?-3:0,P=this.renderWorldCopies?4:1;for(const D of S){const k=this.pointRayIntersection(D);if(k.t<0)return!0;const z=this.rayIntersectionCoordinate(k);if(z.x<A||z.y<0||z.x>P||z.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cJ(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(t,o){const d=n.ae(n.at([],this._camera.position,t)),_=this._zoomFromMercatorZ(d)+o;return d-this._mercatorZfromZoom(_)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([o,d,_],y){const v=[o,d,_,1];n.aA(v,v,y);const S=v[3]=Math.max(v[3],1e-6);return v[0]/=S,v[1]/=S,v[2]/=S,v}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,t))}}getCameraToCenterDistance(t,o=this.zoom,d=this.worldSize){const _=n.cA(t,o,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,_);let v=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(v=n.ai(1,v,n.cN(this.pitch>=Ns?1:this.pitch/Ns))),v}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.az(t,t,this.globeMatrix),t}getFrustum(t){return n.cn.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const So=(u,t)=>{if(t>0&&u.terrain&&n.w("Cutoff is currently disabled on terrain"),t<=0||u.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const o=u.transform,d=Math.max(Math.abs(o._zoom-(u.minCutoffZoom-1)),1),_=o.isLODDisabled(!1)?n.af(60,45,o.pitch):n.af(30,15,o.pitch),y=o._farZ-o._nearZ,v=t*o.height,S=((1-(A=_))*o.cameraToCenterDistance+A*(o._farZ+v))*d;var A;return{shouldRenderCutoff:_<1,uniformValues:{u_cutoff_params:[o._nearZ,o._farZ,(S-o._nearZ)/y,(S-v-o._nearZ)/y]}}},tr={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class yh{constructor(t,o){this.aabb=t,this.lastCascade=o}}class iv{add(t,o){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],o.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],o.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],o.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],o.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],o.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],o.max[2])):this.receivers[t.key]=new yh(o,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,o,d){const _=n.cW.fromPoints(t.points);let y=0;for(const v in this.receivers){const S=this.receivers[v];if(!S||!_.intersectsAabb(S.aabb))continue;S.aabb.min=_.closestPoint(S.aabb.min),S.aabb.max=_.closestPoint(S.aabb.max);const A=S.aabb.getCorners();for(let P=0;P<d.length;P++){let D=!0;for(const k of A){const z=[k[0]*o,k[1]*o,k[2]];if(n.ad(z,z,d[P].matrix),z[0]<-1||z[0]>1||z[1]<-1||z[1]>1){D=!1;break}}if(S.lastCascade=P,y=Math.max(y,P),D)break}}return y+1}}class nv{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new iv,this._depthMode=new It(t.context.gl.LEQUAL,It.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,t.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),t.tp.registerParameter(tr,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),t.tp.registerParameter(tr,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),t.tp.registerParameter(tr,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),t.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,o){const d=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!o||!o.properties)return;const _=o.properties.get("shadow-intensity");if(!o.shadowsEnabled()||_<=0||(this._shadowLayerCount=d.style.order.reduce((G,j)=>{const H=d.style._mergedLayers[j];return G+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const y=d.context,v=tr.shadowMapResolution,S=tr.shadowMapResolution;if(this._cascades.length===0||tr.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let G=0;G<tr.cascadeCount;++G){const j=d._shadowMapDebug,H=y.gl,Z=y.createFramebuffer(v,S,j,"texture"),K=new n.T(y,{width:v,height:S,data:null},H.DEPTH_COMPONENT16);if(Z.depthAttachment.set(K.texture),j){const re=new n.T(y,{width:v,height:S,data:null},H.RGBA8);Z.colorAttachment.set(re.texture)}this._cascades.push({framebuffer:Z,texture:K,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cn,scale:0})}}this.shadowDirection=Xl(o);let A=0;if(t.elevation){const G=t.elevation,j=[1e4,-1e4];G.visibleDemTiles.filter(H=>H.dem).forEach(H=>{const Z=H.dem.tree;j[0]=Math.min(j[0],Z.minimums[0]),j[1]=Math.max(j[1],Z.maximums[0])}),j[0]!==1e4&&(A=(j[1]-j[0])*G.exaggeration())}const P=1.5*t.cameraToCenterDistance,D=3*P,k=new Float64Array(16);for(let G=0;G<this._cascades.length;++G){const j=this._cascades[G];let H=t.height/50,Z=1;tr.cascadeCount===1?Z=D:G===0?Z=P:(H=P,Z=D);const[K,re]=Yl(t,this.shadowDirection,H,Z,tr.shadowMapResolution,A);j.scale=t.scale,j.matrix=K,j.boundingSphereRadius=re,n.bi(k,j.matrix),j.frustum=n.cn.fromInvProjectionMatrix(k,1,0,!0),j.far=Z}const z=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[z].far,this._cascades[z].far],this._uniformValues.u_shadow_intensity=_,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/tr.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=tr.shadowMapResolution,this._uniformValues.u_shadowmap_0=lr.ShadowMap0,this._uniformValues.u_shadowmap_1=lr.ShadowMap0+1,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const F=d.transform.elevation;for(const G of this._groundShadowTiles){let j={min:0,max:0};if(F){const H=F.getMinMaxForTile(G);H&&(j=H)}this.addShadowReceiver(G.toUnwrapped(),j.min,j.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,o){if(!this.enabled)return;const d=this.painter,_=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),_.viewport.set([0,0,tr.shadowMapResolution,tr.shadowMapResolution]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,_.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),_.clear({color:n.am.white,depth:1});for(const v of t.order){const S=t._mergedLayers[v];if(!S.hasShadowPass()||S.isHidden(d.transform.zoom))continue;const A=t.getLayerSourceCache(S),P=A?o[A.id]:void 0;(S.type==="model"||P&&P.length)&&d.renderLayer(d,A,S,P)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,o=t.style,d=t.context,_=d.gl,y=o.directionalLight,v=o.ambientLight;if(!y||!v)return;const S=[],A=So(t,t.longestCutoffRange);A.shouldRenderCutoff&&S.push("RENDER_CUTOFF"),S.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&S.push("NORMAL_OFFSET");const P=ll(o,y,v),D=new It(_.LEQUAL,It.ReadOnly,t.depthRangeFor3D),k=new ci({func:_.EQUAL,mask:255},0,255,_.KEEP,_.KEEP,_.KEEP);for(const z of this._groundShadowTiles){const F=z.toUnwrapped(),G=t.isTileAffectedByFog(z),j=t.getOrCreateProgram("groundShadow",{defines:S,overrideFog:G});this.setupShadows(F,j),t.uploadCommonUniforms(d,j,F,null,A);const H={u_matrix:t.transform.calculateProjMatrix(F),u_ground_shadow_factor:P};j.draw(t,_.TRIANGLES,D,k,Di.multiply,ni.disabled,H,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Di.unblended:Di.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const o=this.painter.transform,d=o.calculatePosMatrix(t,o.worldSize);return n.az(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){return n.az(t,this._cascades[this.painter.currentShadowCascade].matrix,t),Float32Array.from(t)}setupShadows(t,o,d,_=0){if(!this.enabled)return;const y=this.painter.transform,v=this.painter.context,S=v.gl,A=this._uniformValues,P=new Float64Array(16),D=y.calculatePosMatrix(t,y.worldSize);for(let k=0;k<this._cascades.length;k++)n.az(P,this._cascades[k].matrix,D),A[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(P),v.activeTexture.set(S.TEXTURE0+lr.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const k=n.cU(t.canonical),z=2/y.tileSize*n.aj/tr.shadowMapResolution,F=z*this._cascades[0].boundingSphereRadius,G=z*this._cascades[this._cascades.length-1].boundingSphereRadius,j=(d==="vector-tile"?1:3)/Math.pow(2,_-t.canonical.z-(1-y.zoom+Math.floor(y.zoom)));A.u_shadow_normal_offset=[k,F*j,G*j],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(v,A)}setupShadowsFromMatrix(t,o,d=!1){if(!this.enabled)return;const _=this.painter.context,y=_.gl,v=this._uniformValues,S=new Float64Array(16);for(let A=0;A<tr.cascadeCount;A++)n.az(S,this._cascades[A].matrix,t),v[A===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(S),_.activeTexture.set(y.TEXTURE0+lr.ShadowMap0+A),this._cascades[A].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);if(this.useNormalOffset=d,d){const A=tr.normalOffset;v.u_shadow_normal_offset=[1,A,A],v.u_shadow_bias=[6e-5,.0012,.012]}else v.u_shadow_bias=[36e-5,.0012,.012];o.setShadowUniformValues(_,v)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,o,d,_){if(_[2]>=0)return{};const y=function(A,P,D){const k=D/(1<<A.canonical.z);return new n.cW([A.canonical.x*k+A.wrap*D,A.canonical.y*k+A.wrap*D,0],[(A.canonical.x+1)*k+A.wrap*D,(A.canonical.y+1)*k+A.wrap*D,P])}(t,o,d).getCorners(),v=o/-_[2];_[0]<0?(n.cV(y[0],y[0],[_[0]*v,0,0]),n.cV(y[3],y[3],[_[0]*v,0,0])):_[0]>0&&(n.cV(y[1],y[1],[_[0]*v,0,0]),n.cV(y[2],y[2],[_[0]*v,0,0])),_[1]<0?(n.cV(y[0],y[0],[0,_[1]*v,0]),n.cV(y[1],y[1],[0,_[1]*v,0])):_[1]>0&&(n.cV(y[2],y[2],[0,_[1]*v,0]),n.cV(y[3],y[3],[0,_[1]*v,0]));const S={};return S.vertices=y,S.planes=[ya(y[1],y[0],y[4]),ya(y[2],y[1],y[5]),ya(y[3],y[2],y[6]),ya(y[0],y[3],y[7])],S}addShadowReceiver(t,o,d){this._receivers.add(t,n.cW.fromTileIdAndHeight(t,o,d))}getMaxCascadeForTile(t){const o=this._receivers.get(t);return o&&o.lastCascade?o.lastCascade:0}}function ya(u,t,o){const d=n.at([],o,t),_=n.at([],u,t),y=n.bF([],d,_),v=n.ae(y);return v===0?[0,0,1,0]:(n.bY(y,y,1/v),[y[0],y[1],y[2],-n.bG(y,t)])}function Xl(u){const t=u.properties.get("direction"),o=n.cR(t.x,t.y,t.z);o[2]=n.ay(o[2],0,75);const d=n.cT([o[0],o[1],o[2]]);return n.cS(d.x,d.y,d.z)}function ll(u,t,o){const d=t.properties.get("color-use-theme")==="none",_=t.properties.get("color"),y=t.properties.get("intensity"),v=t.properties.get("direction"),S=[v.x,v.y,v.z],A=o.properties.get("color-use-theme")==="none",P=o.properties.get("color"),D=o.properties.get("intensity"),k=Math.max(n.bG([0,0,1],S),0),z=[0,0,0];n.bY(z,P.toPremultipliedRenderColor(A?null:u.getLut(t.scope)).toArray01Linear().slice(0,3),D);const F=[0,0,0];return n.bY(F,_.toPremultipliedRenderColor(d?null:u.getLut(o.scope)).toArray01Linear().slice(0,3),k*y),n.cY([z[0]>0?z[0]/(z[0]+F[0]):0,z[1]>0?z[1]/(z[1]+F[1]):0,z[2]>0?z[2]/(z[2]+F[2]):0])}function Yl(u,t,o,d,_,y){const v=u.zoom,S=u.scale,A=u.worldSize,P=1/A,D=u.aspect,k=Math.sqrt(1+D*D)*Math.tan(.5*u.fovX),z=k*k,F=d-o,G=d+o;let j,H;z>F/G?(j=d,H=d*k):(j=.5*G*(1+z),H=.5*Math.sqrt(F*F+2*(d*d+o*o)*z+G*G*z*z));const Z=u.projection.pixelsPerMeter(u.center.lat,A),K=u._camera.getCameraToWorldMercator(),re=[0,0,-j*P];n.ad(re,re,K);let ce=H*P;const me=u._edgeInsets;if(!(me.left===0&&me.top===0&&me.right===0&&me.bottom===0||me.left===me.right&&me.top===me.bottom)){const it=u._camera.getWorldToCamera(u.worldSize,u.projection.zAxisUnit==="meters"?Z:1),ft=u._camera.getCameraToClipPerspective(u._fov,u.width/u.height,o,d);ft[8]=2*-u.centerOffset.x/u.width,ft[9]=2*u.centerOffset.y/u.height;const Ye=new Float64Array(16);n.cB(Ye,ft,it);const ut=new Float64Array(16);n.bi(ut,Ye);const Mt=n.cn.fromInvProjectionMatrix(ut,A,v,!0);for(const Pt of Mt.points){const Et=((fe=Pt)[0]/=S,fe[1]/=S,fe[2]=n.c6(fe[2],u._center.lat),fe);ce=Math.max(ce,n.bZ(n.cX([],re,Et)))}}var fe;ce*=_/(_-1);const ue=Math.acos(t[2]),he=Math.atan2(-t[0],-t[1]),_e=new qr;_e.position=re,_e.setPitchBearing(ue,he);const ye=_e.getWorldToCamera(A,Z),Le=ce*A,ze=Math.min(u._mercatorZfromZoom(17)*A*-2,-2*Le),qe=_e.getCameraToClipOrthographic(-Le,Le,-Le,Le,ze,(Le+y*Z)/t[2]),Xe=new Float64Array(16);n.az(Xe,qe,ye);const st=n.cS(Math.floor(1e6*re[0])/1e6*A,Math.floor(1e6*re[1])/1e6*A,0),De=.5*_,je=[0,0,0];n.ad(je,st,Xe),n.bY(je,je,De);const Te=[Math.floor(je[0]),Math.floor(je[1]),Math.floor(je[2])],Ke=[0,0,0];n.at(Ke,je,Te),n.bY(Ke,Ke,-1/De);const Be=new Float64Array(16);return n.bx(Be),n.bo(Be,Be,Ke),n.az(Xe,Be,Xe),[Xe,Le]}class z_ extends n.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,o){return n.aS(this.requestManager.transformRequest(o,n.R.Model).url).then(d=>{if(!d)return;const _=n.aT(d),y=new n.aU(t,void 0,void 0,_);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new n.z(new Error(`Could not load model ${t} from ${o}: ${d.message}`)))})}load(t,o,d={forceReload:!1}){this.models[o]||(this.models[o]={});const _=Object.keys(t),y=[],v=[];for(const S of _){const A=t[S];this.hasURLBeenRequested(A)&&!d.forceReload||(this.modelByURL[A]={modelId:S,scope:o},y.push(this.loadModel(S,A)),v.push(S)),this.models[o][S]||(this.models[o][S]={model:null,numReferences:1})}this.numModelsLoading[o]=(this.numModelsLoading[o]||0)+v.length,Promise.allSettled(y).then(S=>{for(let A=0;A<S.length;A++){const{status:P}=S[A];if(P==="rejected")continue;const{value:D}=S[A];this.models[o][v[A]]||(this.models[o][v[A]]={model:null,numReferences:1}),this.models[o][v[A]].model=D}this.numModelsLoading[o]-=v.length,this.fire(new n.A("data",{dataType:"style"}))}).catch(S=>{this.fire(new n.z(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,o,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,o):this.getModelByURL(this.modelUris[o][t]))}getModel(t,o){return this.models[o]||(this.models[o]={}),this.models[o][t]?this.models[o][t].model:void 0}getModelByURL(t){if(!t)return null;const o=this.modelByURL[t];return o?this.models[o.scope][o.modelId].model:null}hasModelBeenAdded(t,o){return this.models[o]&&this.models[o][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,o,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const _=this.requestManager.normalizeModelURL(o);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===_)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(_)){const{scope:y,modelId:v}=this.modelByURL[_];this.models[y][v].numReferences++}else this.modelUris[d][t]=_,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d=this.modelUris[o];for(const _ in t)d[_]=this.requestManager.normalizeModelURL(t[_])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,o){this.models[o]||(this.models[o]={}),this.modelUris[o]||(this.modelUris[o]={});const d={};for(const _ of t)this.hasModel(_,o,{exactIdMatch:!0})||this.hasURLBeenRequested(_)?this.models[o][_].numReferences++:this.modelUris[o][_]&&!this.hasURLBeenRequested(_)?d[_]=this.modelUris[o][_]:!this.hasURLBeenRequested(_)&&n.cZ(_,!1)&&(this.modelUris[o][_]=this.requestManager.normalizeModelURL(_),d[_]=this.modelUris[o][_]);this.load(d,o)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,o,d=!1){if(this.models[o]&&this.models[o][t]&&(this.models[o][t].numReferences--,this.models[o][t].numReferences===0)){const _=this.modelUris[o][t];d||delete this.modelUris[o][t],delete this.modelByURL[_];const y=this.models[o][t].model;if(!y)return;delete this.models[o][t],y.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const o of Object.keys(this.models[t])){const d=this.models[t][o].model;delete this.models[t][o],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,o){this.models[o]||(this.models[o]={});for(const d in this.models[o])this.models[o][d].model&&this.models[o][d].model.upload(t.context)}}const Hu=new n.a7({data:new n.a8(n.a5.colorTheme.data)}),Kf={"mbx-indoor-active-floorplans":{default:["literal",[]]},"mbx-indoor-underground":{default:["literal",!1]},"mbx-indoor-loaded-levels":{default:["literal",[]]},"mbx-indoor-level-height":{default:["literal",{}]},"mbx-indoor-level-base":{default:["literal",{}]},"mbx-indoor-level-selected":{default:["literal",{}]},"mbx-indoor-level-overlapped":{default:["literal",{}]}};function Zo(u){return u=u||{},Object.assign(u,Kf)}class sv extends n.E{constructor(t){super(),this.mergeFloors=!0,this._scope=void 0,this._queryFeatureSetId=void 0,this._buildingEntryFeatureSetId=void 0,this._selectedFloorplan=void 0,this._indoorData=void 0,this._floorplanStates={},n.aV(["_onLoad","_onMove","_checkFloorplanVisible"],this),this._map=t,this._checkFloorplanVisible(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=void 0}_onLoad(){this._map.style.forEachFragmentStyle(t=>{t.stylesheet.indoor&&(this._queryFeatureSetId?this.fire(new n.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._queryFeatureSetId=t.stylesheet.indoor.floorplanFeaturesetId,this._buildingEntryFeatureSetId=t.stylesheet.indoor.buildingFeaturesetId,this._scope=t.scope))}),this._queryFeatureSetId&&this._buildingEntryFeatureSetId&&this._map.addInteraction("mbx-indoor-buildingclick",{type:"click",target:{featuresetId:this._buildingEntryFeatureSetId,importId:this._scope},handler:t=>(t.feature&&t.feature.properties.floorplan&&this.selectFloorplan(t.feature.properties.floorplan),!0)}),this._checkFloorplanVisible()}_onMove(){this._checkFloorplanVisible()}_checkFloorplanVisible(){if(!this._queryFeatureSetId||!this._map.isStyleLoaded())return;const t=()=>{this._indoorData=void 0,this._selectedFloorplan=void 0,this._map.setConfigProperty(this._scope,"mbx-indoor-underground",!1),this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[]]),this.fire(new n.A("floorplangone"))};if(this._map.transform.zoom<13)return void t();const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=this._map.transform.width,_=this._map.transform.height,y=d*(2/3),v=_*(2/3),S=.5*(d-y),A=.5*(_-v),P=[new n.P(S,A),new n.P(S+y,A+v)],D=this._map.queryRenderedFeatures(P,o);D.length>0?this._selectedFloorplan&&D[0].properties.id===this._selectedFloorplan.properties.id||(this._selectedFloorplan=D[0],this._floorplanSelected()):t()}_floorplanSelected(){this._indoorData=JSON.parse(this._selectedFloorplan.properties["indoor-data"]),this._indoorData.id=this._selectedFloorplan.properties.id,this._floorplanStates[this._indoorData.id]=this._floorplanStates[this._indoorData.id]||{},this._map.setConfigProperty(this._scope,"mbx-indoor-active-floorplans",["literal",[this._indoorData.id]]);const t=this._floorplanStates[this._indoorData.id].selectedBuilding,o=t?this._indoorData.buildings.find(S=>S.id===t):this._indoorData.buildings.length>0?this._indoorData.buildings[0]:null,d=this._floorplanStates[this._indoorData.id].selectedLevel,_=this._indoorData.levels.find(S=>S.id===d),y=this._indoorData.levels.find(S=>!(!o||!o.levels)&&Number(S.levelOrder)===0&&o.levels.includes(S.id)),v=_?_.id:y?y.id:void 0;this.fire(new n.A("floorplanselected",{buildings:this._indoorData.buildings,levels:this._indoorData.levels,selectedLevelId:v})),o&&this._buildingSelected(o,!1),v&&this._levelSelected(v)}_buildingSelected(t,o){if(!t||!t.id)return void console.warn("IndoorManager: Building or building id is undefined");o&&t.extent&&this._map.fitBounds(t.extent,{pitch:this._map.getPitch(),bearing:this._map.getBearing()}),this._floorplanStates[this._indoorData.id].selectedBuilding=t?t.id:void 0;const d=this._indoorData.levels.filter(_=>t.levels.includes(_.id));this.fire(new n.A("buildingselected",{buildingId:t.id,levels:d}))}_levelSelected(t){const o=this._indoorData.levels.find(d=>d.id===t);o?(this._updateLevels(o,!0),this.fire(new n.A("levelselected",{levelId:o.id}))):console.warn(`IndoorManager: Level with ID ${t} not found in the current floorplan.`)}_updateLevels(t,o){if(!t||!t.id)throw new Error("IndoorManager: Selected level or level ID is undefined");function d(P){const D=P.indexOf("/floor/");if(D===-1)return P;const k=D+7,z=P.indexOf("/",k);return z===-1?P.slice(k):P.slice(k,z)}this._floorplanStates[this._indoorData.id].selectedLevel=t.id;const _=[],y={},v={},S={},A={};for(const P of this._indoorData.levels){if(_.push(P.id),y[P.id]=P.levelOrder>=0?3*Math.abs(P.levelOrder+1):3*Math.abs(P.levelOrder),v[P.id]=P.levelOrder>=0?3*P.levelOrder:0,this.mergeFloors){const D=d(t.id),k=d(P.id);S[P.id]=k===D?"true":"false"}else S[P.id]=P.id===t.id?"true":"false";A[P.id]=P.levelOrder<t.levelOrder?"true":"false"}this._map.setConfigProperty(this._scope,"mbx-indoor-loaded-levels",["literal",_]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-height",["literal",y]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-base",["literal",v]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",S]),this._map.setConfigProperty(this._scope,"mbx-indoor-level-overlapped",["literal",A]),this._map.setConfigProperty(this._scope,"mbx-indoor-underground",t.levelOrder<0)}selectFloorplan(t){const o={target:{featuresetId:this._queryFeatureSetId,importId:this._scope}},d=[new n.P(0,0),new n.P(this._map.transform.width,this._map.transform.height)],_=this._map.queryRenderedFeatures(d,o);if(_.length>0){for(const y of _)if(JSON.parse(y.properties["indoor-data"]).id===t){this._selectedFloorplan=y,this._floorplanSelected();break}}}selectBuilding(t){const o=this._indoorData.buildings.find(d=>d.id===t);this._buildingSelected(o,!0)}selectLevel(t){this._levelSelected(t)}}function rv(u){if(!u.metadata||!u.metadata.content_area)return;const t=n.q.devicePixelRatio,{left:o,top:d,width:_,height:y}=u.metadata.content_area,v=o*t,S=d*t;return[v,S,v+_*t,S+y*t]}function O_(u){if(u)return u.map(([t,o])=>[t*n.q.devicePixelRatio,o*n.q.devicePixelRatio])}class k_{constructor(t,o,d){this.id=t,this.scope=o,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const o=this.sourceCache.getVisibleCoordinates();if(o.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof pa))return t;const _=o.map(v=>this.sourceCache.getTile(v)),y=d.getImages(_,Array.from(this.pendingRequests));for(const[v,S]of y)t.set(n.I.from({name:v,iconsetId:this.id}),S),this.pendingRequests.delete(v);for(const v of this.pendingRequests)this.missingRequests.add(v);return this.pendingRequests.clear(),t}}const cl=(u,t)=>de(u,t&&t.filter(o=>o.identifier!=="source.canvas")),Jf=n.aF(qi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),F_=n.aF(qi,["setCenter","setZoom","setBearing","setPitch"]),Wu=new Set(["background","sky","slot","custom"]),Qf={version:8,layers:[],sources:{}},ep={duration:300,delay:0};class ir extends n.E{constructor(t,o={}){super(),this.map=t,this.scope=o.scope||"",this.globalId=null,this.fragments=[],this.importDepth=o.importDepth||0,this.importsCache=o.importsCache||new Map,this.resolvedImports=o.resolvedImports||new Set,this.transition=n.h({},ep),this._buildingIndex=new P_(this),this.crossTileSymbolIndex=new gr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=o.styleChanges||new Ce,this.dispatcher=o.dispatcher?o.dispatcher:new n.D(n.c$(),this),o.imageManager?this.imageManager=o.imageManager:(this.imageManager=new gt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=o.glyphManager?o.glyphManager:new n.d0(t._requestManager,o.localFontFamily?n.d1.all:o.localIdeographFontFamily?n.d1.ideographs:n.d1.none,o.localFontFamily||o.localIdeographFontFamily),o.modelManager?this.modelManager=o.modelManager:(this.modelManager=new z_(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=o.configOptions?o.configOptions:new Map,this._configDependentLayers=o.configDependentLayers?o.configDependentLayers:new Set,this._config=o.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:o.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=o.initialConfig,this.dispatcher.broadcast("setReferrer",n.d2());const d=this;this._rtlTextPluginCallback=ir.registerForPluginStateChange(_=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:_.pluginStatus,pluginURL:_.pluginURL},(y,v)=>{if(n.d3(y),v&&v.every(S=>S))for(const S in d._sourceCaches){const A=d._sourceCaches[S],P=A.getSource().type;P!=="vector"&&P!=="geojson"||A.reload()}})}),this.on("data",_=>{if(_.dataType!=="source"||_.sourceDataType!=="metadata")return;const y=this.getOwnSource(_.sourceId);if(y&&y.vectorLayerIds)for(const v in this._layers){const S=this._layers[v];S.source===y.id&&this._validateLayer(S)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(n.j(t))return t;const o=n.d4(t);if(!o.startsWith("http"))try{return new URL(o,location.href).toString()}catch{return o}return o}return`json://${n.d5(JSON.stringify(t))}`}_diffStyle(t,o,d){this.globalId=this._getGlobalId(t);const _=(y,v)=>{try{v(null,this.setState(y,d))}catch(S){v(S,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),v=this.map._requestManager.transformRequest(y,n.R.Style);n.n(v,(S,A)=>{S?this.fire(new n.z(S)):A&&_(A,o)})}else typeof t=="object"&&_(t,o)}loadURL(t,o={}){this.fire(new n.A("dataloading",{dataType:"style"}));const d=typeof o.validate=="boolean"?o.validate:!n.j(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,o.accessToken),this.resolvedImports.add(t);const _=this.importsCache.get(t);if(_)return this._load(_,d);const y=this.map._requestManager.transformRequest(t,n.R.Style);this._request=n.n(y,(v,S)=>{if(this._request=null,v)this.fire(new n.z(v));else if(S)return this.importsCache.set(t,S),this._load(S,d)})}loadJSON(t,o={}){this.fire(new n.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=n.q.frame(()=>{this._request=null,this._load(t,o.validate!==!1)})}loadEmpty(){this.fire(new n.A("dataloading",{dataType:"style"})),this._load(Qf,!1)}_loadImports(t,o,d){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const _=[];for(const y of t){const v=this._createFragmentStyle(y),S=new Promise(D=>{v.once("style.import.load",D),v.once("error",D)}).then(()=>this.mergeAll());if(_.push(S),this.resolvedImports.has(y.url)){v.loadEmpty();continue}const A=y.data||this.importsCache.get(y.url);A?(v.loadJSON(A,{validate:o}),this._isInternalStyle(A)&&(v.globalId=null)):y.url?v.loadURL(y.url,{validate:o}):v.loadEmpty();const P={style:v,id:y.id,config:y.config};if(d){const D=this.fragments.findIndex(({id:k})=>k===d);this.fragments=this.fragments.slice(0,D).concat(P).concat(this.fragments.slice(D))}else this.fragments.push(P)}return Promise.allSettled(_)}getImportGlobalIds(t=this,o=new Set){for(const d of t.fragments)d.style.globalId&&o.add(d.style.globalId),this.getImportGlobalIds(d.style,o);return[...o.values()]}_createFragmentStyle(t){const o=this.scope?n.C(t.id,this.scope):t.id;let d;const _=this._initialConfig&&this._initialConfig[o];(t.config||_)&&(d=n.h({},t.config,_));const y=new ir(this.map,{scope:o,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,o){const d=t.indoor?Zo(t.schema):t.schema;if(this._isInternalStyle(t)){const v=n.h({},Qf,{imports:[{id:"basemap",data:t,url:""}]});return void this._load(v,o)}if(this.updateConfig(this._config,d),o&&cl(this,Tr(t)))return;this._loaded=!0,this.stylesheet=n.d6(t);const _=()=>{for(const P in t.sources)this.addSource(P,t.sources[P],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const P in t.iconsets)this.addIconset(P,t.iconsets[P]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.setGlyphsUrl(t.glyphs);const v=ah(this.stylesheet.layers);if(this._order=v.map(P=>P.id),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const P=this.stylesheet.lights[0];this.light=new ke(P.properties,P.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ke(this.stylesheet.light)),this._layers={};for(const P of v){const D=n.db(P,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const k=this.getOwnLayerSourceCache(D),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&D.canCastShadows()&&z&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const S=this.stylesheet.terrain;S&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.A("data",{dataType:"style"}));const A=this.isRootStyle();t.imports?this._loadImports(t.imports,o).then(()=>{this._reloadImports(),this.fire(new n.A(A?"style.load":"style.import.load"))}).catch(P=>{this.fire(new n.z(new Error("Failed to load imports",P))),this.fire(new n.A(A?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new n.A(A?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const y=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(y){const v=this._evaluateColorThemeData(y);this._loadColorTheme(v).then(()=>{_()}).catch(S=>{n.w(`Couldn't load color theme from the stylesheet: ${S}`),_()})}else this._styleColorTheme.lut=null,_()}isRootStyle(){return this.importDepth===0}mergeAll(){let t,o,d,_,y,v,S,A,P,D;const k={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(z=>{if(z.stylesheet){if(z.light!=null&&(t=z.light),z.stylesheet.lights)for(const F of z.stylesheet.lights)F.type==="ambient"&&z.ambientLight!=null&&(o=z.ambientLight),F.type==="directional"&&z.directionalLight!=null&&(d=z.directionalLight);_=this._prioritizeTerrain(_,z.terrain,z.stylesheet.terrain),z.stylesheet.fog&&z.fog!=null&&(y=z.fog),z.stylesheet.snow&&z.snow!=null&&(v=z.snow),z.stylesheet.rain&&z.rain!=null&&(S=z.rain),z.stylesheet.camera!=null&&(D=z.stylesheet.camera),z.stylesheet.projection!=null&&(A=z.stylesheet.projection),z.stylesheet.transition!=null&&(P=z.stylesheet.transition),k[z.scope]=z._styleColorTheme}}),this.light=t,this.ambientLight=o,this.directionalLight=d,this.fog=y,this.snow=v,this.rain=S,this._styleColorThemeForScope=k,_===null?delete this.terrain:this.terrain=_,this.camera=D||{"camera-projection":"perspective"},this.projection=A||{name:"mercator"},this.transition=n.h({},ep,P),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(t){const o=d=>{for(const _ of d.fragments)o(_.style);t(d)};o(this)}_prioritizeTerrain(t,o,d){const _=t&&t.drapeRenderMode===0;return d===null?o&&o.drapeRenderMode===0?o:_?t:null:o!=null&&(!t||_||o&&o.drapeRenderMode===1)?o:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(o=>{t=this._prioritizeTerrain(t,o.terrain,o.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(o=>{o.stylesheet.projection!=null&&(t=o.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},o={},d={};this.forEachFragmentStyle(_=>{for(const y in _._sourceCaches){const v=n.C(y,_.scope);t[v]=_._sourceCaches[y]}for(const y in _._otherSourceCaches){const v=n.C(y,_.scope);o[v]=_._otherSourceCaches[y]}for(const y in _._symbolSourceCaches){const v=n.C(y,_.scope);d[v]=_._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=o,this._mergedSymbolSourceCaches=d}mergeLayers(){const t={},o=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(y=>{for(const v of y._order){const S=y._layers[v];if(S.type==="slot"){const A=n.d7(v);if(t[A])continue;t[A]=[]}S.slot&&t[S.slot]?t[S.slot].push(S):o.push(S)}}),this._mergedOrder=[];const _=(y=[])=>{for(const v of y)if(v.type==="slot"){const S=n.d7(v.id);t[S]&&_(t[S]),this._mergedSlots.push(S)}else{const S=n.C(v.id,v.scope);this._mergedOrder.push(S),d[S]=v,v.is3D(!!this.terrain)&&(this._has3DLayers=!0),v.type==="circle"&&(this._hasCircleLayers=!0),v.type==="symbol"&&(this._hasSymbolLayers=!0),v.type==="clip"&&(this._clipLayerPresent=!0)}};_(o),this._mergedOrder.sort((y,v)=>{const S=d[y],A=d[v];return S.hasInitialOcclusionOpacityProperties?A.is3D(!!this.terrain)?1:0:S.is3D(!!this.terrain)&&A.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=n.h({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(o,d,_,y){const v=n.h({},d);for(const A of Object.keys(n.a5.colorTheme))v[A]===void 0&&(v[A]=n.a5.colorTheme[A].default);const S=new n.a6(Hu,o,new Map(_));return S.setTransitionOrValue(v,_),S.untransitioned().possiblyEvaluate(new n.aa(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const o=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,_)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let v=t;v.startsWith(y)||(v=y+v);const S=n.I.from("mapbox-reserved-lut"),A=new Image;A.src=v,A.onerror=()=>{this._styleColorTheme.lutLoading=!1,_(new Error("Failed to load image data"))},A.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==o)return void d();this._styleColorTheme.lutLoading=!1;const{width:P,height:D,data:k}=n.q.getImageData(A);if(D>32)return void _(new Error("The height of the image must be less than or equal to 32 pixels."));if(P!==D*D)return void _(new Error("The width of the image must be equal to the height squared."));this.getImage(S)&&this.removeImage(S),this.addImage(S,{data:new n.r({width:P,height:D},k),pixelRatio:1,sdf:!1,usvg:!1,version:0});const z=this.imageManager.getImage(S,this.scope);z?(this._styleColorTheme.lut={image:z.data,data:t},d()):_(new Error("Missing LUT image."))}})}getLut(t){const o=this._styleColorThemeForScope[t];return o?o.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(o,d,_){let y,v,S;const A=n.q.devicePixelRatio>1?"@2x":"";let P=n.n(d.transformRequest(d.normalizeSpriteURL(o,A,".json"),n.R.SpriteJSON),(z,F)=>{P=null,S||(S=z,y=F,k())}),D=n.o(d.transformRequest(d.normalizeSpriteURL(o,A,".png"),n.R.SpriteImage),(z,F)=>{D=null,S||(S=z,v=F,k())});function k(){if(S)_(S);else if(y&&v){const z=n.q.getImageData(v),F={};for(const G in y){const{width:j,height:H,x:Z,y:K,sdf:re,pixelRatio:ce,stretchX:me,stretchY:fe,content:ue}=y[G],he=new n.r({width:j,height:H});n.r.copy(z,he,{x:Z,y:K},{x:0,y:0},{width:j,height:H},null),F[G]={data:he,pixelRatio:ce,sdf:re,stretchX:me,stretchY:fe,content:ue,usvg:!1}}_(null,F)}}return{cancel(){P&&(P.cancel(),P=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,(o,d)=>{if(this._spriteRequest=null,o)this.fire(new n.z(o));else if(d){const _=new Map;for(const y in d)_.set(n.I.from(y),d[y]);this.addImages(_)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))})}addIconset(t,o){if(o.type==="sprite")return void this._loadSprite(o.url);const d=this.getOwnSourceCache(o.source);if(!d)return void this.fire(new n.z(new Error(`Source "${o.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const _=d.getSource();if(_.type!=="raster-array")return void this.fire(new n.z(new Error(`Source "${o.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));_.partial=!1;const y=new k_(t,this.scope,d);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!n.j(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const o=this.map._spriteFormat==="auto";var d,_;this._spriteRequest=(_=(y,v)=>{if(this._spriteRequest=null,y)o?this._loadSprite(t):this.fire(new n.z(y));else if(v){const S=new Map;for(const A in v)S.set(n.I.from(A),v[A]);this.addImages(S)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.A("data",{dataType:"style"}))},n.br((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),n.R.Iconset),(y,v)=>{if(y)return void _(y);const S={},A=n.c_(new n.bq(v));for(const P of A.icons){const D={version:1,pixelRatio:n.q.devicePixelRatio,content:rv(P),stretchX:P.metadata?O_(P.metadata.stretch_x_areas):void 0,stretchY:P.metadata?O_(P.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:P};S[P.name]=D}_(null,S)}))}_validateLayer(t){const o=this.getOwnSource(t.source);if(!o)return;const d=t.sourceLayer;d&&(o.type==="geojson"||o.vectorLayerIds&&o.vectorLayerIds.indexOf(d)===-1)&&this.fire(new n.z(new Error(`Source layer "${d}" does not exist on source "${o.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,o)=>{const d=this.fragments[o];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const o in this._sourceCaches){const d=this._sourceCaches[o].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const o=[];for(const d of t){const _=this._layers[d];_&&_.type!=="custom"&&o.push(_.serialize())}return o}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const o=this.getOwnLayer(t);if(o)return o;this.fire(new n.z(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const o=this.getOwnSource(t);if(o)return o;this.fire(new n.z(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,o){const d=this.map.painter;if(d)for(let _=t.minzoom||0;_<(t.maxzoom||25.5);_++){const y=t.getProgramIds();if(y)for(const v of y){const S=t.getDefaultProgramParams(v,o.zoom,this._styleColorTheme.lut);S&&(d.style=this,this.fog&&(d._fogVisible=!0,S.overrideFog=!0,d.getOrCreateProgram(v,S)),d._fogVisible=!1,S.overrideFog=!1,d.getOrCreateProgram(v,S),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(S.overrideRtt=!0,d.getOrCreateProgram(v,S)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const o=this.calculateLightsBrightness();t.brightness=o||0,o!==this._brightness&&(this._brightness=o,this.dispatcher.broadcast("setBrightness",o)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let _=!1;if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const A in S){const{updatedIds:P,removedIds:D}=S[A];(P||D)&&(this._updateWorkerLayers(A,P,D),_=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const S in this._mergedSourceCaches){const A=this._mergedSourceCaches[S];y[S]=A.used,A.used=!1,A.tileCoverLift=0}for(const S of this._mergedOrder){const A=this._mergedLayers[S];if(A.recalculate(t,this._availableImages),!A.isHidden(t.zoom)){const P=this.getLayerSourceCache(A);P&&(P.used=!0,P.tileCoverLift=Math.max(P.tileCoverLift,A.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(A,t)}):this.precompilePrograms(A,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&_&&this.mergeLayers();const v=this.imageManager.getPendingImageProviders();for(const S of v)S.sourceCache.used=!0;for(const S in y){const A=this._mergedSourceCaches[S];y[S]!==A.used&&A.getSource().fire(new n.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:A.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new n.A("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const o of t){const d=o.resolvePendingRequests(),_=this.getFragmentStyle(o.scope);_&&_.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const o in this._mergedSourceCaches){const d=this._mergedSourceCaches[o].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[o].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const o in t)this._changes.resetUpdatedImages(o)}_updateWorkerLayers(t,o,d){const _=this.getFragmentStyle(t);_&&this.dispatcher.broadcast("updateLayers",{layers:o?_._serializeLayers(o):[],scope:t,removedIds:d||[],options:_.options})}setState(t,o){if(this._checkLoaded(),cl(this,Tr(t)))return!1;(t=n.d6(t)).layers=ah(t.layers);const d=function(v,S){if(!v)return[{command:qi.setStyle,args:[S]}];let A=[];try{if(!n.bv(v.version,S.version))return[{command:qi.setStyle,args:[S]}];if(n.bv(v.center,S.center)||A.push({command:qi.setCenter,args:[S.center]}),n.bv(v.zoom,S.zoom)||A.push({command:qi.setZoom,args:[S.zoom]}),n.bv(v.bearing,S.bearing)||A.push({command:qi.setBearing,args:[S.bearing]}),n.bv(v.pitch,S.pitch)||A.push({command:qi.setPitch,args:[S.pitch]}),n.bv(v.sprite,S.sprite)||A.push({command:qi.setSprite,args:[S.sprite]}),n.bv(v.glyphs,S.glyphs)||A.push({command:qi.setGlyphs,args:[S.glyphs]}),n.bv(v.imports,S.imports)||function(F=[],G=[],j){G=G||[];const H=(F=F||[]).map(tl),Z=G.map(tl),K=F.reduce(ma,{}),re=G.reduce(ma,{}),ce=H.slice();let me,fe,ue,he;for(me=0,fe=0;me<H.length;me++)ue=H[me],re.hasOwnProperty(ue)?fe++:(j.push({command:qi.removeImport,args:[ue]}),ce.splice(ce.indexOf(ue,fe),1));for(me=0,fe=0;me<Z.length;me++)ue=Z[Z.length-1-me],ce[ce.length-1-me]!==ue&&(K.hasOwnProperty(ue)?(j.push({command:qi.removeImport,args:[ue]}),ce.splice(ce.lastIndexOf(ue,ce.length-fe),1)):fe++,he=ce[ce.length-me],j.push({command:qi.addImport,args:[re[ue],he]}),ce.splice(ce.length-me,0,ue));for(const _e of G){const ye=K[_e.id];ye&&(delete ye.data,n.bv(ye,_e)||j.push({command:qi.updateImport,args:[_e.id,_e]}))}}(v.imports,S.imports,A),n.bv(v.transition,S.transition)||A.push({command:qi.setTransition,args:[S.transition]}),n.bv(v.light,S.light)||A.push({command:qi.setLight,args:[S.light]}),n.bv(v.fog,S.fog)||A.push({command:qi.setFog,args:[S.fog]}),n.bv(v.snow,S.snow)||A.push({command:qi.setSnow,args:[S.snow]}),n.bv(v.rain,S.rain)||A.push({command:qi.setRain,args:[S.rain]}),n.bv(v.projection,S.projection)||A.push({command:qi.setProjection,args:[S.projection]}),n.bv(v.lights,S.lights)||A.push({command:qi.setLights,args:[S.lights]}),n.bv(v.camera,S.camera)||A.push({command:qi.setCamera,args:[S.camera]}),n.bv(v.iconsets,S.iconsets)||function(F,G,j){let H;for(H in G=G||{},F=F||{})F.hasOwnProperty(H)&&(G.hasOwnProperty(H)||j.push({command:qi.removeIconset,args:[H]}));for(H in G){if(!G.hasOwnProperty(H))continue;const Z=G[H];F.hasOwnProperty(H)?n.bv(F[H],Z)||(j.push({command:qi.removeIconset,args:[H]}),j.push({command:qi.addIconset,args:[H,Z]})):j.push({command:qi.addIconset,args:[H,Z]})}}(v.iconsets,S.iconsets,A),!n.bv(v["color-theme"],S["color-theme"]))return[{command:qi.setStyle,args:[S]}];const P={},D=[];(function(F,G,j,H){let Z;for(Z in G=G||{},F=F||{})F.hasOwnProperty(Z)&&(G.hasOwnProperty(Z)||$l(Z,j,H));for(Z in G){if(!G.hasOwnProperty(Z))continue;const K=G[Z];F.hasOwnProperty(Z)?n.bv(F[Z],K)||(F[Z].type==="geojson"&&K.type==="geojson"&&Qx(F,G,Z)?j.push({command:qi.setGeoJSONSourceData,args:[Z,K.data]}):lh(Z,G,j,H)):ku(Z,G,j)}})(v.sources,S.sources,D,P);const k=[];v.layers&&v.layers.forEach(F=>{F.source&&P[F.source]?A.push({command:qi.removeLayer,args:[F.id]}):k.push(F)});let z=v.terrain;z&&P[z.source]&&(A.push({command:qi.setTerrain,args:[void 0]}),z=void 0),A=A.concat(D),n.bv(z,S.terrain)||A.push({command:qi.setTerrain,args:[S.terrain]}),function(F,G,j){G=G||[];const H=(F=F||[]).map(tl),Z=G.map(tl),K=F.reduce(ma,{}),re=G.reduce(ma,{}),ce=H.slice(),me=Object.create(null);let fe,ue,he,_e,ye,Le,ze;for(fe=0,ue=0;fe<H.length;fe++)he=H[fe],re.hasOwnProperty(he)?ue++:(j.push({command:qi.removeLayer,args:[he]}),ce.splice(ce.indexOf(he,ue),1));for(fe=0,ue=0;fe<Z.length;fe++)he=Z[Z.length-1-fe],ce[ce.length-1-fe]!==he&&(K.hasOwnProperty(he)?(j.push({command:qi.removeLayer,args:[he]}),ce.splice(ce.lastIndexOf(he,ce.length-ue),1)):ue++,Le=ce[ce.length-fe],j.push({command:qi.addLayer,args:[re[he],Le]}),ce.splice(ce.length-fe,0,he),me[he]=!0);for(fe=0;fe<Z.length;fe++)if(he=Z[fe],_e=K[he],ye=re[he],!me[he]&&!n.bv(_e,ye))if(n.bv(_e.source,ye.source)&&n.bv(_e["source-layer"],ye["source-layer"])&&n.bv(_e.type,ye.type)){for(ze in ch(_e.layout,ye.layout,j,he,null,qi.setLayoutProperty),ch(_e.paint,ye.paint,j,he,null,qi.setPaintProperty),n.bv(_e.slot,ye.slot)||j.push({command:qi.setSlot,args:[he,ye.slot]}),n.bv(_e.filter,ye.filter)||j.push({command:qi.setFilter,args:[he,ye.filter]}),n.bv(_e.minzoom,ye.minzoom)&&n.bv(_e.maxzoom,ye.maxzoom)||j.push({command:qi.setLayerZoomRange,args:[he,ye.minzoom,ye.maxzoom]}),_e)_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?ch(_e[ze],ye[ze],j,he,ze.slice(6),qi.setPaintProperty):n.bv(_e[ze],ye[ze])||j.push({command:qi.setLayerProperty,args:[he,ze,ye[ze]]}));for(ze in ye)ye.hasOwnProperty(ze)&&!_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?ch(_e[ze],ye[ze],j,he,ze.slice(6),qi.setPaintProperty):n.bv(_e[ze],ye[ze])||j.push({command:qi.setLayerProperty,args:[he,ze,ye[ze]]}))}else j.push({command:qi.removeLayer,args:[he]}),Le=ce[ce.lastIndexOf(he)+1],j.push({command:qi.addLayer,args:[ye,Le]})}(k,S.layers,A)}catch(P){console.warn("Unable to compute style diff:",P),A=[{command:qi.setStyle,args:[S]}]}return A}(this.serialize(),t).filter(v=>!(v.command in F_));if(d.length===0)return!1;const _=d.filter(v=>!(v.command in Jf));if(_.length>0)throw new Error(`Unimplemented: ${_.map(v=>v.command).join(", ")}.`);const y=[];return d.forEach(v=>{y.push(this[v.command](...v.args))}),o&&Promise.all(y).then(o).catch(o),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){for(const[o,d]of t.entries()){if(this.getImage(o))return this.fire(new n.z(new Error(`An image with the name "${o.name}" already exists.`)));this.imageManager.addImage(o,this.scope,d),this._changes.updateImage(o,this.scope)}return this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this}addImage(t,o){return this.getImage(t)?this.fire(new n.z(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,o),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this)}updateImage(t,o,d=!1){this.imageManager.updateImage(t,this.scope,o),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(t){return this.modelManager.addModelURLs(t,this.scope),this._updateWorkerModels(),this.fire(new n.A("data",{dataType:"style"})),this}addModel(t,o,d={}){return this._checkLoaded(),this._validate(le,`models.${t}`,o,null,d)||(this.modelManager.addModel(t,o,this.scope),this.fire(new n.A("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.scope)}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.scope),this.fire(new n.A("data",{dataType:"style"})),this):this.fire(new n.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(t,o,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!o.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(o).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(o.type)>=0&&this._validate(Vf,`sources.${t}`,o,null,d))return;this.map&&this.map._collectResourceTiming&&(o.collectResourceTiming=!0);const _=th(t,o,this.dispatcher,this);_.scope=this.scope,_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(_.id),source:_.serialize(),sourceId:_.id}));const y=v=>{const S=(v?"symbol:":"other:")+_.id,A=n.C(S,this.scope),P=this._sourceCaches[S]=new _r(A,_,v);(v?this._symbolSourceCaches:this._otherSourceCaches)[_.id]=P,P.onAdd(this.map)};y(!1),o.type!=="vector"&&o.type!=="geojson"||y(!0),_.onAdd&&_.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const o=this.getOwnSource(t);if(!o)throw new Error("There is no source with this ID");for(const _ in this._layers)if(this._layers[_].source===t)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while layer "${_}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const _=Object.entries(this.stylesheet.iconsets).find(([y,v])=>v.type==="source"&&v.source===t);if(_)return this.fire(new n.z(new Error(`Source "${t}" cannot be removed while iconset "${_[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const _ of d){const y=n.d7(_.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(_.id),_.fire(new n.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:_.getSource().id})),_.setEventedParent(null),_.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),o.setEventedParent(null),o.onRemove&&o.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,o){this._checkLoaded(),this.getOwnSource(t).setData(o),this._changes.setDirty()}getOwnSource(t){const o=this.getOwnSourceCache(t);return o&&o.getSource()}getOwnSources(){const t=[];for(const o in this._otherSourceCaches){const d=this.getOwnSourceCache(o);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const o in t){const d=t[o]._tiles;for(const _ in d){const y=d[_];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const o=this._getTransitionParameters();for(const y of t){if(this._validate(Ka,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const v=this.ambientLight;v.set(y),v.updateTransitions(o)}else this.ambientLight=new hn(y,Si||(Si=new n.a7({color:new n.a8(n.a5.properties_light_ambient.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const v=this.directionalLight;v.set(y),v.updateTransitions(o)}else this.directionalLight=new hn(y,bn||(bn=new n.a7({direction:new n.an(n.a5.properties_light_directional.direction),color:new n.a8(n.a5.properties_light_directional.color),"color-use-theme":new n.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.a8(n.a5.properties_light_directional.intensity),"cast-shadows":new n.a8(n.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new n.a8(n.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.a8(n.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const d=Object.assign(o,{worldview:this.map.getWorldview()}),_=new n.aa(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(_),this.directionalLight&&this.directionalLight.recalculate(_),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,o=this.ambientLight;if(!t||!o)return;const d=z=>.2126*(z[0]<=.03928?z[0]/12.92:Math.pow((z[0]+.055)/1.055,2.4))+.7152*(z[1]<=.03928?z[1]/12.92:Math.pow((z[1]+.055)/1.055,2.4))+.0722*(z[2]<=.03928?z[2]/12.92:Math.pow((z[2]+.055)/1.055,2.4)),_=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),v=t.properties.get("direction"),S=1-n.cR(v.x,v.y,v.z)[2]/90,A=d(_)*y*S,P=o.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=o.properties.get("intensity"),k=d(P)*D;return Number(((A+k)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(n.d8(t)){const o=n.d9(t),d=this.fragments.find(({id:y})=>y===o);if(!d)return;const _=n.d7(t);return d.style.getFragmentStyle(_)}{const o=this.fragments.find(({id:d})=>d===t);return o?o.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const o={},d=(_,y="")=>`${_}::${y}`;this._featuresetSelectors={};for(const _ in t){const y=this._featuresetSelectors[_]=[];for(const v of t[_].selectors){if(v.featureNamespace){const A=this.getOwnLayer(v.layer);if(!A){n.w(`Layer is undefined for selector: ${v.layer}`);continue}const P=d(A.source,A.sourceLayer);if(P in o&&o[P]!==v.featureNamespace){n.w(`"featureNamespace ${v.featureNamespace} of featureset ${_}'s selector is not associated to the same source, skip this selector`);continue}o[P]=v.featureNamespace}let S;if(v.properties)for(const A in v.properties){const P=n.X(v.properties[A]);P.result==="success"&&(S=S||{},S[A]=P.value)}y.push({layerId:v.layer,namespace:v.featureNamespace,properties:S,uniqueFeatureID:v._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const o=this.getFragmentStyle(t);if(!o||!o.stylesheet.featuresets)return[];const d=[];for(const _ in o.stylesheet.featuresets)d.push({featuresetId:_,importId:o.scope?o.scope:void 0});return d}getFeaturesetLayers(t,o){const d=this.getFragmentStyle(o),_=d.stylesheet.featuresets;if(!_||!_[t])return this.fire(new n.z(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const v of _[t].selectors){const S=d.getOwnLayer(v.layer);S&&y.push(S)}return y}getConfigProperty(t,o){const d=this.getFragmentStyle(t);if(!d)return null;const _=n.C(o,d.scope),y=d.options.get(_),v=y?y.value||y.default:null;return v?v.serialize():null}setConfigProperty(t,o,d){const _=this.getFragmentStyle(t);if(!_)return;const y=_.stylesheet.indoor?Zo(_.stylesheet.schema):_.stylesheet.schema;if(!y||!y[o])return;const v=n.X(d);if(v.result!=="success")return void cl(this,v.value);const S=v.value.expression,A=n.C(o,_.scope),P=_.options.get(A);if(!P)return;let D;const{minValue:k,maxValue:z,stepValue:F,type:G,values:j}=y[o],H=n.X(y[o].default);H.result==="success"&&(D=H.value.expression),D?(this.options.set(A,Object.assign({},P,{value:S,default:D,minValue:k,maxValue:z,stepValue:F,type:G,values:j})),this.updateConfigDependencies(o)):this.fire(new n.z(new Error(`No schema defined for the config option "${o}" in the "${t}" fragment.`)))}getConfig(t){const o=this.getFragmentStyle(t);if(!o)return null;const d=o.stylesheet.schema;if(!d)return null;const _={};for(const y in d){const v=n.C(y,o.scope),S=o.options.get(v),A=S?S.value||S.default:null;_[y]=A?A.serialize():null}return _}setConfig(t,o){const d=this.getFragmentStyle(t);d&&(d.updateConfig(o,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const o=this.getFragmentStyle(t);return o?o.stylesheet.schema:null}setSchema(t,o){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=o,d.updateConfig(d._config,o),this.updateConfigDependencies())}updateConfig(t,o){if(this._config=t,t||o)if(o)for(const d in o){let _,y;const v=n.X(o[d].default);if(v.result==="success"&&(_=v.value.expression),t&&t[d]!==void 0){const z=n.X(t[d]);z.result==="success"&&(y=z.value.expression)}const{minValue:S,maxValue:A,stepValue:P,type:D,values:k}=o[d];if(_){const z=n.C(d,this.scope);this.options.set(z,{default:_,value:y,minValue:S,maxValue:A,stepValue:P,type:D,values:k})}else this.fire(new n.z(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new n.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(t){for(const o of this._configDependentLayers){const d=this.getLayer(o);if(d){if(t&&!d.configDependencies.has(t))continue;d.possiblyEvaluateVisibility(),this._updateLayer(d)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(o=>{const d=o._styleColorTheme.colorThemeOverride?o._styleColorTheme.colorThemeOverride:o._styleColorTheme.colorTheme;if(d){const _=o._evaluateColorThemeData(d);(!o._styleColorTheme.lut&&_!==""||o._styleColorTheme.lut&&_!==o._styleColorTheme.lut.data)&&o.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,o,d={}){this._checkLoaded();const _=t.id;if(this._layers[_])return void this.fire(new n.z(new Error(`Layer with id "${_}" already exists on this map`)));let y;if(t.type==="custom"){if(cl(this,n.da(t)))return;y=n.db(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(_,t.source),t=n.d6(t),t=n.h(t,{source:_})),this._validate(Yi,`layers.${_}`,t,{arrayIndex:-1},d))return;y=n.db(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:_}})}y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid);let v=this._order.length;if(o){const D=this._order.indexOf(o);if(D===-1)return void this.fire(new n.z(new Error(`Layer with id "${o}" does not exist on this map.`)));y.slot===this._layers[o].slot?v=D:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,_),this._layerOrderChanged=!0,this._layers[_]=y;const S=this.getOwnLayerSourceCache(y),A=!!this.directionalLight&&this.directionalLight.shadowsEnabled();S&&y.canCastShadows()&&A&&(S.castsShadows=!0);const P=this._changes.getRemovedLayer(y);if(P&&y.source&&S&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const D=n.C(y.source,y.scope);P.type!==y.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),S.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,o){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===o)return;const _=this._order.indexOf(t);this._order.splice(_,1);let y=this._order.length;if(o){const v=this._order.indexOf(o);if(v===-1)return void this.fire(new n.z(new Error(`Layer with id "${o}" does not exist on this map.`)));d.slot===this._layers[o].slot?y=v:n.w(`Layer with id "${o}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(y,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const o=this._checkLayer(t);if(!o)return;o.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(o.fqid),this._changes.removeLayer(o);const _=this.getOwnLayerSourceCache(o);if(_&&_.castsShadows){let y=!1;for(const v in this._layers)if(this._layers[v].source===o.source&&this._layers[v].canCastShadows()){y=!0;break}_.castsShadows=y}o.onRemove&&o.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const o in this._layers)if(this._layers[o].type===t)return!0;return!1}setLayerZoomRange(t,o,d){this._checkLoaded();const _=this._checkLayer(t);_&&(_.minzoom===o&&_.maxzoom===d||(o!=null&&(_.minzoom=o),d!=null&&(_.maxzoom=d),this._updateLayer(_)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,o){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==o&&(d.slot=o,this._updateLayer(d))}setFilter(t,o,d={}){this._checkLoaded();const _=this._checkLayer(t);if(_&&!n.bv(_.filter,o))return o==null?(_.filter=void 0,void this._updateLayer(_)):void(this._validate(Ne,`layers.${_.id}.filter`,o,{layerType:_.type},d)||(_.filter=n.d6(o),this._updateLayer(_)))}getFilter(t){const o=this._checkLayer(t);if(o)return n.d6(o.filter)}setLayoutProperty(t,o,d,_={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!n.bv(y.getLayoutProperty(o),d)){if(d!=null&&(!_||_.validate!==!1)&&cl(y,J.call(Tr,{key:`layers.${t}.layout.${o}`,layerType:y.type,objectKey:o,value:d,styleSpec:n.a5,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(o,d),y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),this._updateLayer(y)}}getLayoutProperty(t,o){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(o)}setPaintProperty(t,o,d,_={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||n.bv(y.getPaintProperty(o),d)||d!=null&&(!_||_.validate!==!1)&&cl(y,q.call(Tr,{key:`layers.${t}.paint.${o}`,layerType:y.type,objectKey:o,value:d,styleSpec:n.a5})))return;const v=y.setPaintProperty(o,d);y.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),v&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,o){const d=this._checkLayer(t);if(d)return d.getPaintProperty(o)}setFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:P}=t.target,D=this.getFragmentStyle(P),k=D.getFeaturesetLayers(A);for(const{source:z,sourceLayer:F}of k)D.setFeatureState({id:t.id,source:z,sourceLayer:F},o)}else if("layerId"in t.target){const{layerId:A}=t.target,P=this.getLayer(A);this.setFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}const d=t.source,_=t.sourceLayer,y=this._checkSource(d);if(!y)return;const v=y.type;if(v==="geojson"&&_)return void this.fire(new n.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(v==="vector"&&!_)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.setFeatureState(_,t.id,o)}removeFeatureState(t,o){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:A,importId:P}=t.target,D=this.getFragmentStyle(P),k=D.getFeaturesetLayers(A);for(const{source:z,sourceLayer:F}of k)D.removeFeatureState({id:t.id,source:z,sourceLayer:F},o)}else if("layerId"in t.target){const{layerId:A}=t.target,P=this.getLayer(A);this.removeFeatureState({id:t.id,source:P.source,sourceLayer:P.sourceLayer},o)}return}const d=t.source,_=this._checkSource(d);if(!_)return;const y=_.type,v=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!v)return void this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(o&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new n.z(new Error("A feature id is required to remove its specific state property.")));const S=this.getOwnSourceCaches(d);for(const A of S)A.removeFeatureState(v,t.id,o)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:v,importId:S}=t.target,A=this.getFragmentStyle(S),P=A.getFeaturesetLayers(v);for(const{source:D,sourceLayer:k}of P){const z=A.getFeatureState({id:t.id,source:D,sourceLayer:k});if(z&&!y)y=z;else if(!n.bv(y,z))return void this.fire(new n.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:v}=t.target,S=this.getLayer(v);y=this.getFeatureState({id:t.id,source:S.source,sourceLayer:S.sourceLayer})}return y}const o=t.source,d=t.sourceLayer,_=this._checkSource(o);if(_){if(_.type!=="vector"||d)return t.id===void 0&&this.fire(new n.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(o)[0].getFeatureState(d,t.id);this.fire(new n.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=n.h({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return n.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),o=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return n.dc({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:o,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const o of Object.values(this._mergedLayers))t(o)&&this._updateLayer(o)}_updateLayer(t){this._changes.updateLayer(t);const o=this.getLayerSourceCache(t),d=n.C(t.source,t.scope),_=this._changes.getUpdatedSourceCaches();t.source&&!_[d]&&o&&o.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),o.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const o=S=>this._mergedLayers[S].is3D(!!this.terrain),d=this.order,_={},y=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(o(A)){_[A]=S;for(const P of t){const D=P[A];if(D)for(const k of D)y.push(k)}}}y.sort((S,A)=>A.intersectionZ-S.intersectionZ);const v=[];for(let S=d.length-1;S>=0;S--){const A=d[S];if(o(A))for(let P=y.length-1;P>=0;P--){const D=y[P].feature;if(D.layer&&_[D.layer.id]<S)break;v.push(D),y.pop()}else for(const P of t){const D=P[A];if(D)for(const k of D)v.push(k.feature)}}return v}queryRenderedFeatures(t,o,d){let _;o&&!Array.isArray(o)&&o.filter&&(this._validate(Ne,"queryRenderedFeatures.filter",o.filter,null,o),_=n.b3(o.filter));const y={},v=D=>{if(Wu.has(D.type))return;const k=this.getOwnLayerSourceCache(D),z=y[k.id]=y[k.id]||{sourceCache:k,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(z.has3DLayers=!0),z.layers[D.fqid]=z.layers[D.fqid]||{styleLayer:D,targets:[]},z.layers[D.fqid].targets.push({filter:_})};if(o&&o.layers){if(!Array.isArray(o.layers))return this.fire(new n.z(new Error("parameters.layers must be an Array."))),[];for(const D of o.layers){const k=this._layers[D];if(!k)return this.fire(new n.z(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];v(k)}}else for(const D in this._layers)v(this._layers[D]);const S=this._queryRenderedFeatures(t,y,d),A=this._flattenAndSortRenderedFeatures(S),P=[];for(const D of A)n.dd(D.layer.id)===this.scope&&P.push(D);return P}queryRenderedFeatureset(t,o,d){let _;o&&!Array.isArray(o)&&o.filter&&(this._validate(Ne,"queryRenderedFeatures.filter",o.filter,null,o),_=n.b3(o.filter));const y="mock",v=[];if(o&&o.target)v.push(Object.assign({},o,{targetId:y,filter:_}));else{const D=this.getFeaturesetDescriptors();for(const k of D)v.push({targetId:y,filter:_,target:k});for(const{style:k}of this.fragments){const z=k.getFeaturesetDescriptors();for(const F of z)v.push({targetId:y,filter:_,target:F})}}const S=this.queryRenderedTargets(t,v,d),A=[],P=new Set;for(const D of S)for(const k of D.variants[y])Lu(k,D,P)||A.push(new n.de(D,k));return A}queryRenderedTargets(t,o,d){const _={},y=(S,A,P,D)=>{const k=_[A.id]=_[A.id]||{sourceCache:A,layers:{},has3DLayers:!1};if(k.layers[S.fqid]=k.layers[S.fqid]||{styleLayer:S,targets:[]},S.is3D(!!this.terrain)&&(k.has3DLayers=!0),!D)return P.uniqueFeatureID=!1,void k.layers[S.fqid].targets.push(P);k.layers[S.fqid].targets.push(Object.assign({},P,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const S of o)if("featuresetId"in S.target){const{featuresetId:A,importId:P}=S.target,D=this.getFragmentStyle(P);if(!D||!D._featuresetSelectors)continue;const k=D._featuresetSelectors[A];if(!k){this.fire(new n.z(new Error(`The featureset '${A}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const z of k){const F=D.getOwnLayer(z.layerId);F&&!Wu.has(F.type)&&y(F,D.getOwnLayerSourceCache(F),S,z)}}else if("layerId"in S.target){const{layerId:A}=S.target,P=this.getLayer(A);if(!P||Wu.has(P.type))continue;y(P,this.getLayerSourceCache(P),S)}const v=this._queryRenderedFeatures(t,_,d);return this._flattenAndSortRenderedFeatures(v)}_queryRenderedFeatures(t,o,d){const _=[],y=!!this.map._showQueryGeometry,v=Ji.createFromScreenPoints(t,d);for(const S in o){const A=zu(v,o[S],this._availableImages,d,y);Object.keys(A).length&&_.push(A)}if(this.placement)for(const S in o){if(!o[S].sourceCache._onlySymbols)continue;const A=Ja(v.screenGeometry,o[S],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(A).length&&_.push(A)}return _}querySourceFeatures(t,o){const d=o&&o.filter;d&&this._validate(Ne,"querySourceFeatures.filter",d,null,o);let _=[];const y=this.getOwnSourceCaches(t);for(const v of y)_=_.concat(nh(v,o));return _}addSourceType(t,o,d){return ir.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(ir.setSourceType(t,o),o.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:o.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,o,d={}){this._checkLoaded();const _=this.light.getLight();let y=!1;for(const S in t)if(!n.bv(t[S],_[S])){y=!0;break}if(!y)return;const v=this._getTransitionParameters();this.light.setLight(t,o,d),this.light.updateTransitions(v)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,o=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),o===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const _=t.source==null;if(o===1){if(this.disableElevatedTerrain)return;if(typeof d.source=="object"){const S="terrain-dem-src";this.addSource(S,d.source),d=n.d6(d),d=n.h(d,{source:S})}const y=n.h({},d),v={};if(this.terrain&&_){y.source=this.terrain.get().source;const S=this.terrain?this.getFragmentStyle(this.terrain.scope):null;S&&(v.style=S.serialize())}if(this._validate(_t,"terrain",y,v))return}if(!this.terrain||this.terrain.scope!==this.scope&&!_||this.terrain&&o!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,o),this.fire(new n.A("data",{dataType:"style"}))}else{const y=this.terrain,v=y.get();for(const S of Object.keys(n.a5.terrain))!d.hasOwnProperty(S)&&n.a5.terrain[S].default&&(d[S]=n.a5.terrain[S].default);for(const S in t)if(!n.bv(t[S],v[S])){y.set(t,this.options),this.stylesheet.terrain=t;const A=this._getTransitionParameters({duration:0});y.updateTransitions(A),this.fire(new n.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const o=this.fog=new ui(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createSnow(t){const o=this.snow=new Fn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_createRain(t){const o=this.rain=new Bn(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const o=this.fog;if(!n.bv(o.get(),t)){o.set(t,this.options),this.stylesheet.fog=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const o=this.snow;if(!n.bv(o.get(),t)){o.set(t,this.options),this.stylesheet.snow=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const o=this.rain;if(!n.bv(o.get(),t)){o.set(t,this.options),this.stylesheet.rain=o.get();const d=this._getTransitionParameters({duration:0});o.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const _ in this._layers)this._layers[_].lut=this._styleColorTheme.lut;for(const _ in this._sourceCaches)this._sourceCaches[_].clearTiles()},o=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!o)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(o);this._loadColorTheme(d).then(()=>{this.fire(new n.A("colorthemeset")),t()}).catch(_=>{n.w(`Couldn't set color theme: ${_}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,o){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=o,d._reloadColorTheme())}_getTransitionParameters(t){return{now:n.q.now(),transition:n.h(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],o=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):o.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...o)}_createTerrain(t,o){const d=this.terrain=new Ee(t,o,this.scope,this.options,this.map.getWorldview());o===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const _=this._getTransitionParameters({duration:0});d.updateTransitions(_)}_force3DLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="fill-extrusion"&&this._updateLayer(o)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const o=this._layers[t];o.type==="symbol"&&this._updateLayer(o)}}_validate(t,o,d,_,y={}){if(y&&y.validate===!1)return!1;const v=n.h({},this.serialize());return cl(this,t.call(Tr,n.h({key:o,style:v,value:d,styleSpec:n.a5},_)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.df.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const o=this.getSourceCaches(t);for(const d of o)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}reloadSource(t){const o=this.getSourceCaches(t);for(const d of o)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let o;this.directionalLight&&(o=Xl(this.directionalLight));const d=new Set;for(const _ in this._mergedLayers){const y=this._mergedLayers[_];y.hasElevation()&&!d.has(y.source)&&d.add(y.source)}for(const _ in this._mergedSourceCaches){const y=this._mergedSourceCaches[_],v=d.has(y._source.id);y.update(t,void 0,void 0,o,v)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const o=this._sourceCaches[t];o.resume(),o.reload()}}_updatePlacement(t,o,d,_,y,v,S=!1){let A=!1,P=!1;const D={},k={};for(const z of this._mergedOrder){const F=this._mergedLayers[z];if(F.type!=="symbol")continue;const G=n.C(F.source,F.scope);let j=D[G];if(!j){const Z=this.getLayerSourceCache(F);if(!Z)continue;const K=Z.getRenderableIds(!0).map(re=>Z.getTileByID(re));k[G]=K.slice(),j=D[G]=K.sort((re,ce)=>ce.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(ce.tileID)?-1:1))}const H=this.crossTileSymbolIndex.addLayer(F,j,o.center.lng,o.projection);A=A||H}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||_===0,this._layerOrderChanged&&this.fire(new n.A("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.q.now(),o.zoom))&&(this.pauseablePlacement=new $u(o,this._mergedOrder,S,d,_,y,this.placement,this.fog&&o.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,k,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.q.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A){this._buildingIndex.onNewFrame(o.zoom);for(let z=0;z<this._mergedOrder.length;z++){const F=this._mergedLayers[this._mergedOrder[z]];if(F.type!=="symbol")continue;const G=this.isLayerClipped(F);this.placement.updateLayerOpacities(F,D[n.C(F.source,F.scope)],z,G?v:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.q.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,o){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new n.z(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!o)return d.push(t),this._loadImports([t],!0);const _=d.findIndex(({id:y})=>y===o);return _===-1&&this.fire(new n.z(new Error(`Import with id "${o}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,_).concat(t).concat(d.slice(_)),this._loadImports([t],!0,o)}updateImport(t,o){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);return _===-1?this:typeof o=="string"?(this.setImportUrl(t,o),this):(o.url&&o.url!==d[_].url&&this.setImportUrl(t,o.url),n.bv(o.config,d[_].config)||this.setImportConfig(t,o.config,o.data.schema),n.bv(o.data,d[_].data)||this.setImportData(t,o.data),this)}moveImport(t,o){this._checkLoaded();let d=this.stylesheet.imports||[];const _=this.getImportIndex(t);if(_===-1)return this;const y=this.getImportIndex(o);if(y===-1)return this;const v=d[_],S=this.fragments[_];return d=d.filter(({id:A})=>A!==t),this.fragments=this.fragments.filter(({id:A})=>A!==t),this.stylesheet.imports=d.slice(0,y).concat(v).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(S).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,o){this._checkLoaded();const d=this.stylesheet.imports||[],_=this.getImportIndex(t);if(_===-1)return this;d[_].url=o;const y=this.fragments[_];return y.style=this._createFragmentStyle(d[_]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(o),this}setImportData(t,o){this._checkLoaded();const d=this.getImportIndex(t),_=this.stylesheet.imports||[];return d===-1?this:o?(this.fragments[d].style.setState(o),this._reloadImports(),this):(delete _[d].data,this.setImportUrl(t,_[d].url))}setImportConfig(t,o,d){this._checkLoaded();const _=this.getImportIndex(t),y=this.stylesheet.imports||[];if(_===-1)return this;o?y[_].config=o:delete y[_].config;const v=this.fragments[_];d&&v.style.stylesheet&&(v.style.stylesheet.schema=d);const S=v.style.stylesheet&&v.style.stylesheet.schema;return v.config=o,v.style.updateConfig(o,S),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const o=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(o.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const o=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return o===-1&&this.fire(new n.z(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),o}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const o in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[o];d&&t.push(d.getSource())}return t}getSource(t,o){const d=this.getSourceCache(t,o);return d&&d.getSource()}getLayerSource(t){const o=this.getLayerSourceCache(t);return o&&o.getSource()}getSourceCache(t,o){const d=n.C(t,o);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const o=n.C(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[o]:this._mergedOtherSourceCaches[o]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const o=[];return this._mergedOtherSourceCaches[t]&&o.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&o.push(this._mergedSymbolSourceCaches[t]),o}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const o in t){const d=t[o];d==="reload"?this.reloadSource(o):d==="clear"&&this.clearSource(o)}}updateLayers(t){const o=this._changes.getUpdatedPaintProperties();for(const d of o){const _=this.getLayer(d);_&&_.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t,this.scope)}getImages(t,o,d){this.imageManager.getImages(o.images,o.scope,d),this._updateTilesForChangedImages();const _=v=>{if(v){const S=o.images.map(A=>n.I.toString(A));v.setDependencies(o.tileID.key,o.type,S)}},y=n.C(o.source,o.scope);_(this._mergedOtherSourceCaches[y]),_(this._mergedSymbolSourceCaches[y])}rasterizeImages(t,o,d){this.imageManager.rasterizeImages(o,d)}getGlyphs(t,o,d){this.glyphManager.getGlyphs(o.stacks,o.scope,d)}getResource(t,o,d){return n.dg(o,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const o=[];return this._otherSourceCaches[t]&&o.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&o.push(this._symbolSourceCaches[t]),o}_isSourceCacheLoaded(t){const o=this.getOwnSourceCaches(t);return o.length===0?(this.fire(new n.z(new Error(`There is no source with ID '${t}'`))),!1):o.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,o){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&t.sourceLayer==="building",_=t.type==="building";if(t.is3D(!!this.terrain)){if(d||_||o&&o.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ir.getSourceType=function(u){return Ru[u]},ir.setSourceType=function(u,t){Ru[u]=t},ir.registerForPluginStateChange=n.dh;var xh=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,tp=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,ip=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Kl="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Jl=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,np=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,qu=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,kr=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Zu=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,yt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,sp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Ql=[];Zr(xh,Ql),Zr(ip,Ql),Zr(tp,Ql);const ec={"_prelude_fog.vertex.glsl":np,"_prelude_terrain.vertex.glsl":Jl,"_prelude_shadow.vertex.glsl":yt,"_prelude_fog.fragment.glsl":qu,"_prelude_shadow.fragment.glsl":sp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":kr,"_prelude_raster_particle.glsl":Zu},vh={};Ni("",Jl),Ni(qu,np),Ni(sp,yt),Ni(kr,""),Ni(Zu,"");const bh=Ni(tp,ip),Eo=xh;var Xu={background:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in highp vec3 v_normal;in highp float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 apply_lighting_linear(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec4 color=vec4(v_color.rgb,1.0);vec3 normal=normalize(v_normal);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,v_color.rgb,v_color.a);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_height));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_height);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3f;out vec4 v_color;out highp vec3 v_normal;out highp float v_height;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));vec3 pos=a_pos_3f;v_height=pos.z;gl_Position=u_matrix*vec4(pos,1.0);
#ifdef RENDER_SHADOWS
vec3 shadow_pos=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ni(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ni("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ni(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ni(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ni("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ni("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ni("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ni(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ni(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=cutoff_opacity(u_cutoff_params,ground.z);if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ni(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ni(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ni(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ni(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ni("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ni("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ni(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ni(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef Z_OFFSET
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
#endif
}`),terrainRaster:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ni("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ni(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Kl),skyboxGradient:Ni(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Kl),skyboxCapture:Ni(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ni(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ni(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ni(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ni(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ni("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ni("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ni("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ni("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Zr(u,t){const o=u.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let d of o)if(d=d.trim(),d[0]==="#"&&d.includes("if")&&!d.includes("endif")){d=d.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const _=d.split(" ");for(const y of _)t.includes(y)||t.push(y)}}function Ni(u,t){const o=/#include\s+"([^"]+)"/g,d=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let _=t.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);_&&(_=_.map(P=>{const D=P.split(" ");return D[D.length-1]}),_=[...new Set(_)]);const y={},v=[],S=[];if(u=u.replace(o,(P,D)=>(S.push(D),"")),(t=t.replace(o,(P,D)=>(v.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let A=[...Ql];Zr(u,A),Zr(t,A);for(const P of[...v,...S])ec[P]||console.error(`Undefined include: ${P}`),vh[P]||(vh[P]=[],Zr(ec[P],vh[P])),A=[...A,...vh[P]];return{fragmentSource:u=u.replace(d,(P,D,k,z,F)=>(y[F]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
in ${k} ${z} ${F};
#else
uniform ${k} ${z} u_${F};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${F}
    ${k} ${z} ${F} = u_${F};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${k} ${z} ${F};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(d,(P,D,k,z,F)=>{const G=z==="float"?"vec2":z,j=F.match(/color/)?"color":G;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${F}
in ${k} ${z} a_${F};
#endif
`:y[F]?D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${G} a_${F};
out ${k} ${z} ${F};
#else
uniform ${k} ${z} u_${F};
#endif
`:D==="initialize"?j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = a_${F};
#else
    ${k} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${k} ${z} ${F} = u_${F};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    in ${k} ${z} a_${F};
    out ${k} ${z} ${F};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${F} = a_${F};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${F}
uniform lowp float u_${F}_t;
in ${k} ${G} a_${F};
#else
uniform ${k} ${z} u_${F};
#endif
`:D==="define-instanced"?j==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${F}0;
in vec4 a_${F}1;
in vec4 a_${F}2;
in vec4 a_${F}3;
#else
uniform ${k} ${z} u_${F};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${G} a_${F};
#else
uniform ${k} ${z} u_${F};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${F}
    ${k} ${z} ${F} = a_${F};
#endif
`:j==="vec4"?`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${z} ${F} = a_${F};
#else
    ${k} ${z} ${F} = u_${F};
#endif
`:`
#ifndef HAS_UNIFORM_u_${F}
    ${k} ${z} ${F} = unpack_mix_${j}(a_${F}, u_${F}_t);
#else
    ${k} ${z} ${F} = u_${F};
#endif
`}),staticAttributes:_,usedDefines:A,vertexIncludes:v,fragmentIncludes:S}}class tc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,o,d,_,y,v,S,A){this.context=t;let P=this.boundPaintVertexBuffers.length!==_.length;for(let k=0;!P&&k<_.length;k++)this.boundPaintVertexBuffers[k]!==_[k]&&(P=!0);let D=this.boundDynamicVertexBuffers.length!==S.length;for(let k=0;!D&&k<S.length;k++)this.boundDynamicVertexBuffers[k]!==S[k]&&(D=!0);if(!this.vao||this.boundProgram!==o||this.boundLayoutVertexBuffer!==d||P||D||this.boundIndexBuffer!==y||this.boundVertexOffset!==v)this.freshBind(o,d,_,y,v,S,A);else{t.bindVertexArrayOES.set(this.vao);for(const k of S)k&&(k.bind(),A&&k.instanceCount&&k.setVertexAttribDivisor(t.gl,o,A));y&&y.dynamicDraw&&y.bind()}}freshBind(t,o,d,_,y,v,S){const A=t.numAttributes,P=this.context,D=P.gl;this.vao&&this.destroy(),this.vao=P.gl.createVertexArray(),P.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=o,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=_,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=v,o.enableAttributes(D,t),o.bind(),o.setVertexAttribPointers(D,t,y);for(const k of d)k.enableAttributes(D,t),k.bind(),k.setVertexAttribPointers(D,t,y);for(const k of v)k&&(k.enableAttributes(D,t),k.bind(),k.setVertexAttribPointers(D,t,y),S&&k.instanceCount&&k.setVertexAttribDivisor(D,t,S));_&&_.bind(),P.currentNumAttributes=A}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ov(u,t){const o=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new n.ac(0,d/o).toLngLat().lat,new n.ac(0,(d+1)/o).toLngLat().lat]}function av(u,t,o,d,_,y,v){const S=u.context,A=S.gl,P=o.hillshadeFBO;if(!P)return;u.prepareDrawTile();const D=u.isTileAffectedByFog(t),k=u.getOrCreateProgram("hillshade",{overrideFog:D});S.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,P.colorAttachment.get());const z=((H,Z,K,re)=>{const ce=K.paint.get("hillshade-shadow-color"),me=K.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",fe=K.paint.get("hillshade-highlight-color"),ue=K.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",he=K.paint.get("hillshade-accent-color"),_e=K.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",ye=K.paint.get("hillshade-emissive-strength");let Le=n.al(K.paint.get("hillshade-illumination-direction"));if(K.paint.get("hillshade-illumination-anchor")==="viewport")Le-=H.transform.angle;else if(H.style&&H.style.enable3dLights()&&H.style.directionalLight){const qe=H.style.directionalLight.properties.get("direction"),Xe=n.cR(qe.x,qe.y,qe.z);Le=n.al(Xe[1])}const ze=!H.options.moving;return{u_matrix:re||H.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),ze),u_image:0,u_latrange:ov(0,Z.tileID),u_light:[K.paint.get("hillshade-exaggeration"),Le],u_shadow:ce.toPremultipliedRenderColor(me?null:K.lut),u_highlight:fe.toPremultipliedRenderColor(ue?null:K.lut),u_emissive_strength:ye,u_accent:he.toPremultipliedRenderColor(_e?null:K.lut)}})(u,o,d,u.terrain?t.projMatrix:null);u.uploadCommonUniforms(S,k,t.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:G,tileBoundsSegments:j}=u.getTileBoundsBuffers(o);k.draw(u,A.TRIANGLES,_,y,v,ni.disabled,z,d.id,F,G,j)}function Yu(u,t,o){if(!t.needsDEMTextureUpload)return;const d=u.context,_=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||u.getTileTexture(o.stride);const y=o.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new n.T(d,y,_.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function lv(u,t,o){const d=u.context,_=d.gl;if(!t.dem)return;const y=t.dem;if(d.activeTexture.set(_.TEXTURE1),Yu(u,t,y),!t.demTexture)return;t.demTexture.bind(_.NEAREST,_.CLAMP_TO_EDGE);const v=y.dim;d.activeTexture.set(_.TEXTURE0);let S=t.hillshadeFBO;if(!S){const z=new n.T(d,{width:v,height:v,data:null},_.RGBA8);z.bind(_.LINEAR,_.CLAMP_TO_EDGE),S=t.hillshadeFBO=d.createFramebuffer(v,v,!0,"renderbuffer"),S.colorAttachment.set(z.texture)}d.bindFramebuffer.set(S.framebuffer),d.viewport.set([0,0,v,v]);const{tileBoundsBuffer:A,tileBoundsIndexBuffer:P,tileBoundsSegments:D}=u.getMercatorTileBoundsBuffers(),k=[];u.linearFloatFilteringSupported()&&k.push("TERRAIN_DEM_FLOAT_FORMAT"),u.getOrCreateProgram("hillshadePrepare",{defines:k}).draw(u,_.TRIANGLES,It.disabled,ci.disabled,Di.unblended,ni.disabled,((z,F)=>{const G=F.stride,j=n.bz();return n.c5(j,0,n.aj,-8192,0,0,1),n.bo(j,j,[0,-8192,0]),{u_matrix:j,u_image:1,u_dimension:[G,G],u_zoom:z.overscaledZ}})(t.tileID,y),o.id,A,P,D),t.needsHillshadePrepare=!1}class qn{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class B_ extends qn{getDefault(){return n.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class rp extends qn{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class cv extends qn{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class hv extends qn{getDefault(){return[!0,!0,!0,!0]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uv extends qn{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class dv extends qn{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class N_ extends qn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const o=this.current;(t.func!==o.func||t.ref!==o.ref||t.mask!==o.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class fv extends qn{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ku extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.STENCIL_TEST):o.disable(o.STENCIL_TEST),this.current=t,this.dirty=!1}}class pv extends qn{getDefault(){return[0,1]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class V_ extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.DEPTH_TEST):o.disable(o.DEPTH_TEST),this.current=t,this.dirty=!1}}class op extends qn{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Ju extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.BLEND):o.disable(o.BLEND),this.current=t,this.dirty=!1}}class ap extends qn{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class hl extends qn{getDefault(){return n.am.transparent.toNonPremultipliedRenderColor(null)}set(t){const o=this.current;(t.r!==o.r||t.g!==o.g||t.b!==o.b||t.a!==o.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ic extends qn{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class Qu extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;t?o.enable(o.CULL_FACE):o.disable(o.CULL_FACE),this.current=t,this.dirty=!1}}class ed extends qn{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class nc extends qn{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let U_=class extends qn{getDefault(){return null}set(u){(u!==this.current||this.dirty)&&(this.gl.useProgram(u),this.current=u,this.dirty=!1)}};class lp extends qn{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class j_ extends qn{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const o=this.current;(t[0]!==o[0]||t[1]!==o[1]||t[2]!==o[2]||t[3]!==o[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class sc extends qn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindFramebuffer(o.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class td extends qn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindRenderbuffer(o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class id extends qn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindTexture(o.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class cp extends qn{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.bindBuffer(o.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class nd extends qn{getDefault(){return null}set(t){const o=this.gl;o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class wh extends qn{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class $_ extends qn{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class G_ extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class H_ extends qn{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const o=this.gl;o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class xa extends qn{constructor(t,o){super(t),this.context=t,this.parent=o}getDefault(){return null}}class W_ extends xa{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class q_ extends xa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferRenderbuffer(o.FRAMEBUFFER,this.attachment(),o.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class mv extends xa{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const o=this.gl;o.framebufferTexture2D(o.FRAMEBUFFER,this.attachment(),o.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class _v extends q_{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const hp=(u,t,o)=>({u_matrix:u,u_image0:0,u_skirt_height:t,u_ground_shadow_factor:o}),sd=(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j)=>({u_proj_matrix:Float32Array.from(u),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:o,u_zoom_transition:_,u_merc_center:y,u_image0:0,u_frustum_tl:v,u_frustum_tr:S,u_frustum_br:A,u_frustum_bl:P,u_globe_pos:D,u_globe_radius:k,u_viewport:z,u_grid_matrix:j?Float32Array.from(j):new Float32Array(9),u_skirt_height:F,u_far_z_cutoff:G});function rd(u,t){return u!=null&&t!=null&&!(!u.hasData()||!t.hasData())&&u.demTexture!=null&&t.demTexture!=null&&u.tileID.key!==t.tileID.key}const va=new class{constructor(){this.operations={}}newMorphing(u,t,o,d,_){if(u in this.operations){const y=this.operations[u];y.to.tileID.key!==o.tileID.key&&(y.queued=o)}else this.operations[u]={startTime:d,phase:0,duration:_,from:t,to:o,queued:null}}getMorphValuesForProxy(u){if(!(u in this.operations))return null;const t=this.operations[u];return{from:t.from,to:t.to,phase:t.phase}}update(u){for(const t in this.operations){const o=this.operations[t];for(o.phase=(u-o.startTime)/o.duration;o.phase>=1||!this._validOp(o);)if(!this._nextOp(o,u)){delete this.operations[t];break}}}_nextOp(u,t){return!!u.queued&&(u.from=u.to,u.to=u.queued,u.queued=null,u.phase=0,u.startTime=t,!0)}_validOp(u){return u.from.hasData()&&u.to.hasData()}},up={0:null,1:"TERRAIN_VERTEX_MORPHING"};function dp(u,t,o){if(t===0)return 0;const d=t<1&&o===514?.25/t:1;return 6*Math.pow(1.5,22-u)*Math.max(t,1)*d}function gv(u,t){const o=1<<u.z;return!t&&(u.x===0||u.x===o-1)||u.y===0||u.y===o-1}const ul=u=>({u_matrix:u});function dl(u,t,o,d,_){if(_>0){const y=n.q.now(),v=(y-u.timeAdded)/_,S=t?(y-t.timeAdded)/_:-1,A=o.getSource(),P=d.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),D=!t||Math.abs(t.tileID.overscaledZ-P)>Math.abs(u.tileID.overscaledZ-P),k=D&&u.refreshedUponExpiration?1:n.ay(D?v:1-S,0,1);return u.refreshedUponExpiration&&v>=1&&(u.refreshedUponExpiration=!1),t?{opacity:1,mix:1-k}:{opacity:k,mix:0}}return{opacity:1,mix:0}}class Z_ extends _r{constructor(t){const o={type:"raster-dem",maxzoom:t.transform.maxZoom},d=new n.D(n.c$(),null),_=th("mock-dem",o,d,t.style);super("mock-dem",_,!1),_.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,o){t.state="loaded",o(null)}}class Fr extends _r{constructor(t){const o=th("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new n.D(n.c$(),null),t.style);super("proxy",o,!1),o.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,o,d){if(t.freezeTileCoverage)return;this.transform=t;const _=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,v)=>{if(y[v.key]="",!this._tiles[v.key]){const S=new Qa(v,this._source.tileSize*v.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);S.state="loaded",this._tiles[v.key]=S}return y},{});for(const y in this._tiles)y in _||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const o=this.proxyCachedFBO[t];if(o!==void 0){const d=Object.values(o);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class od extends n.aM{constructor(t,o,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=o,this.projMatrix=d}}class Th extends n.dt{constructor(t,o){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},t.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),t.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,_,y]=function(A){const P=new n.ba,D=new n.a_,k=131;P.reserve(17161),D.reserve(33800);const z=n.aj/128,F=n.aj+z/2,G=F+z;for(let H=-64;H<G;H+=z)for(let Z=-64;Z<G;Z+=z){const K=Z<0||Z>F||H<0||H>F?24575:0,re=n.ay(Math.round(Z),0,n.aj),ce=n.ay(Math.round(H),0,n.aj);P.emplaceBack(re+K,ce)}const j=(H,Z)=>{const K=Z*k+H;D.emplaceBack(K+1,K,K+k),D.emplaceBack(K+k,K+k+1,K+1)};for(let H=1;H<129;H++)for(let Z=1;Z<129;Z++)j(Z,H);return[0,129].forEach(H=>{for(let Z=0;Z<130;Z++)j(Z,H),j(H,Z)}),[P,D,32768]}(),v=t.context;this.gridBuffer=v.createVertexBuffer(d,n.bc.members),this.gridIndexBuffer=v.createIndexBuffer(_),this.gridSegments=n.bd.simpleSegment(0,0,d.length,_.length),this.gridNoSkirtSegments=n.bd.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Fr(o.map),this.orthoMatrix=n.bz(),n.c5(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.aj,0,n.aj,0,1);const S=v.gl;this._overlapStencilMode=new ci({func:S.GEQUAL,mask:255},0,255,S.KEEP,S.KEEP,S.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=o,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Z_(o.map),this._pendingGroundEffectLayers=[]}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,o,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const _=t.terrain.properties,y=t.terrain.drapeRenderMode===0,v=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.q.now();const S=t.terrain&&t.terrain.scope,A=_.get("source"),P=y?this._mockSourceCache:t.getSourceCache(A,S);if(!P)return void n.w(`Couldn't find terrain source "${A}".`);if(this.sourceCache=P,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=v?this.calculateExaggeration(o):_.get("exaggeration"),!o.projection.requiresDraping&&v&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const k=this.getScaledDemTileSize();this.sourceCache.update(o,k,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),o.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(o),this._emptyDEMTextureDirty=!0,this._previousZoom=o.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const o=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const _=o!=null?d-o:Number.MAX_VALUE;if(Math.abs(_)<2)return this._exaggeration;const y=t.zoom,v=this._style.terrain;if(!this._previousUpdateTimestamp)return v.getExaggeration(y);let S=y-this._previousZoom;const A=this._previousUpdateTimestamp;let P=y;this._evaluationZoom!=null&&(P=this._evaluationZoom,Math.abs(y-P)>.5&&(S=.5*(y-P+S)),S*_<0&&(P+=S)),this._evaluationZoom=P;const D=v.getExaggeration(P),k=D===v.getExaggeration(Math.max(0,P-.1));if(k&&Math.abs(D-this._exaggeration)<.01)return D;let z=Math.min(.1,.00375*(this._updateTimestamp-A));return(k||D<.1||Math.abs(S)<1e-4)&&(z=Math.min(.2,4*z)),n.ai(this._exaggeration,D,z)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.coord&&t.dataType==="source"?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const o=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(n.ac.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const _=this.proxyCoords=o.getIds().map(A=>{const P=o.getTileByID(A).tileID;return P.projMatrix=d.calculateProjMatrix(P.toUnwrapped()),P});(function(A,P){const D=P.transform.pointCoordinate(P.transform.getCameraPoint()),k=new n.P(D.x,D.y);A.sort((z,F)=>{if(F.overscaledZ-z.overscaledZ)return F.overscaledZ-z.overscaledZ;const G=new n.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),j=new n.P(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),H=k.mult(1<<z.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(G)-H.distSqr(j)})})(_,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},_.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const v=this._style._mergedSourceCaches;for(const A in v){const P=v[A];if(!P.used||(P!==this.sourceCache&&this.resetTileLookupCache(P.id),this._setupProxiedCoordsForOrtho(P,t[A],y),P.usedForTerrain))continue;const D=t[A];P.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[o.id]=_.map(A=>new od(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const S={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const P=this.terrainTileForTile[A.key];if(!P)continue;const D=P.tileID.key;D in S||(this._visibleDemTiles.push(P),S[D]=D)}}_assignTerrainTiles(t){this._initializing||t.forEach(o=>{if(this.terrainTileForTile[o.key])return;const d=this._findTileCoveringTileID(o,this.sourceCache);d&&(this.terrainTileForTile[o.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,o=t.gl;for(const d in this.terrainTileForTile){const _=this.terrainTileForTile[d],y=_.dem;!y||_.demTexture&&!_.needsDEMTextureUpload||(t.activeTexture.set(o.TEXTURE1),Yu(this.painter,_,y))}}_prepareDemTileUniforms(t,o,d,_){if(!o||o.demTexture==null)return!1;const y=t.tileID.canonical,v=Math.pow(2,o.tileID.canonical.z-y.z),S=_||"";return d[`u_dem_tl${S}`]=[y.x*v%1,y.y*v%1],d[`u_dem_scale${S}`]=v,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const o=this._visibleDemTiles.reduce((d,_)=>{if(!_.dem)return d;const y=_.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?o/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,o=t.gl;t.activeTexture.set(o.TEXTURE2);const d=this._getLoadedAreaMinimum(),_=new n.du({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(_,{premultiply:!1}):y=this._emptyDEMTexture=new n.T(t,_,o.R32F,{premultiply:!1}),y}setupElevationDraw(t,o,d){const _=this.painter.context,y=_.gl,v={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};v.u_exaggeration=this.exaggeration();let S=null,A=null,P=1;if(d&&d.morphing&&this._useVertexMorphing){const F=d.morphing.srcDemTile,G=d.morphing.dstDemTile;P=d.morphing.phase,F&&G&&(this._prepareDemTileUniforms(t,F,v,"_prev")&&(A=F),this._prepareDemTileUniforms(t,G,v)&&(S=G))}const D=F=>F&&F.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let k=null;var z;if(this.enabled?A&&S?(k=S.demTexture,_.activeTexture.set(y.TEXTURE4),A.demTexture.bind(D(A),y.CLAMP_TO_EDGE),v.u_dem_lerp=P):(S=this.terrainTileForTile[t.tileID.key],k=this._prepareDemTileUniforms(t,S,v)?S.demTexture:this.emptyDEMTexture):k=this.emptyDEMTexture,_.activeTexture.set(y.TEXTURE2),k&&(v.u_dem_size=(z=k).size[0]===1?1:z.size[0]-2,k.bind(D(S),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,o,v),d&&d.useMeterToDem&&S){const F=(1<<S.tileID.canonical.z)*n.c6(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;v.u_meter_to_dem=F}if(d&&d.labelPlaneMatrixInv&&(v.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),o.setTerrainUniformValues(_,v),this.painter.transform.projection.name==="globe"){const F=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);o.setGlobeUniformValues(_,F)}}globeUniformValues(t,o,d){const _=t.projection;return{u_tile_tl_up:_.upVector(o,0,0),u_tile_tr_up:_.upVector(o,n.aj,0),u_tile_br_up:_.upVector(o,n.aj,n.aj),u_tile_bl_up:_.upVector(o,0,n.aj),u_tile_up_scale:d?n.dv(1):_.upVectorScale(o,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const o=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),o.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(_,y,v,S,A){if(_.transform.projection.name==="globe")(function(P,D,k,z,F){const G=P.context,j=G.gl;let H,Z;const K=P.transform,re=n.dl(P,G,K),ce=(qe,Xe)=>{if(Z===Xe)return;const st=[up[Xe],"PROJECTION_GLOBE_VIEW"];re&&st.push("CUSTOM_ANTIALIASING");const De=P.isTileAffectedByFog(qe);H=P.getOrCreateProgram("globeRaster",{defines:st,overrideFog:De}),Z=Xe},me=P.colorModeForRenderPass(),fe=new It(j.LEQUAL,It.ReadWrite,P.depthRangeFor3D);va.update(F);const ue=n.dm(K),he=[n.aD(K.center.lng),n.aH(K.center.lat)],_e=P.globeSharedBuffers,ye=[K.width*n.q.devicePixelRatio,K.height*n.q.devicePixelRatio],Le=Float32Array.from(K.globeMatrix),ze={useDenormalizedUpVectorScale:!0};{const qe=P.transform,Xe=dp(qe.zoom,D.exaggeration(),D.sourceCache._source.tileSize);Z=-1;const st=j.TRIANGLES;for(const De of z){const je=k.getTile(De),Te=ci.disabled,Ke=D.prevTerrainTileForTile[De.key],Be=D.terrainTileForTile[De.key];rd(Ke,Be)&&va.newMorphing(De.key,Ke,Be,F,250),G.activeTexture.set(j.TEXTURE0),je.texture&&je.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);const it=va.getMorphValuesForProxy(De.key),ft=it?1:0;it&&n.L(ze,{morphing:{srcDemTile:it.from,dstDemTile:it.to,phase:n.dk(it.phase)}});const Ye=n.dn(De.canonical),ut=n.dp(Ye.getCenter().lat),Mt=n.dq(De.canonical,Ye,ut,qe.worldSize/qe._pixelsPerMercatorPixel),Pt=n.bh(n.dr(De.canonical)),Et=sd(qe.expandedFarZProjMatrix,Le,ue,Pt,n.ah(qe.zoom),he,qe.frustumCorners.TL,qe.frustumCorners.TR,qe.frustumCorners.BR,qe.frustumCorners.BL,qe.globeCenterInViewSpace,qe.globeRadius,ye,Xe,qe._farZ,Mt);if(ce(De,ft),H&&(D.setupElevationDraw(je,H,ze),P.uploadCommonUniforms(G,H,De.toUnwrapped()),_e)){const[Ut,qt,ei]=_e.getGridBuffers(ut,Xe!==0);H.draw(P,st,fe,Te,me,ni.backCCW,Et,"globe_raster",Ut,qt,ei)}}}if(_e&&(P.renderDefaultNorthPole||P.renderDefaultSouthPole)){const qe=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];re&&qe.push("CUSTOM_ANTIALIASING"),H=P.getOrCreateProgram("globeRaster",{defines:qe});for(const Xe of z){const{x:st,y:De,z:je}=Xe.canonical,Te=De===0,Ke=De===(1<<je)-1,[Be,it,ft,Ye]=_e.getPoleBuffers(je,!1);if(Ye&&(Te||Ke)){const ut=k.getTile(Xe);G.activeTexture.set(j.TEXTURE0),ut.texture&&ut.texture.bind(j.LINEAR,j.CLAMP_TO_EDGE);let Mt=n.ds(je,st,K);const Pt=n.bh(n.dr(Xe.canonical)),Et=(Ut,qt)=>Ut.draw(P,j.TRIANGLES,fe,ci.disabled,me,ni.disabled,sd(K.expandedFarZProjMatrix,Mt,Mt,Pt,0,he,K.frustumCorners.TL,K.frustumCorners.TR,K.frustumCorners.BR,K.frustumCorners.BL,K.globeCenterInViewSpace,K.globeRadius,ye,0,K._farZ),"globe_pole_raster",qt,ft,Ye);D.setupElevationDraw(ut,H,ze),P.uploadCommonUniforms(G,H,Xe.toUnwrapped()),Te&&P.renderDefaultNorthPole&&Et(H,Be),Ke&&P.renderDefaultSouthPole&&(Mt=n.cE(n.bz(),Mt,[1,-1,1]),Et(H,it))}}}})(_,y,v,S,A);else{const P=_.context,D=P.gl;let k,z;const F=_.shadowRenderer,G=So(_,_.longestCutoffRange),j=me=>{if(z===me)return;const fe=[];fe.push(up[me]),G.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),F&&(fe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&fe.push("NORMAL_OFFSET")),k=_.getOrCreateProgram("terrainRaster",{defines:fe}),z=me},H=_.colorModeForRenderPass(),Z=new It(D.LEQUAL,It.ReadWrite,_.depthRangeFor3D);va.update(A);const K=_.transform,re=dp(K.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let ce=[0,0,0];if(F){const me=_.style.directionalLight,fe=_.style.ambientLight;me&&fe&&(ce=ll(_.style,me,fe))}{z=-1;const me=D.TRIANGLES,[fe,ue]=[y.gridIndexBuffer,y.gridSegments];for(const he of S){const _e=v.getTile(he),ye=ci.disabled,Le=y.prevTerrainTileForTile[he.key],ze=y.terrainTileForTile[he.key];rd(Le,ze)&&va.newMorphing(he.key,Le,ze,A,250),P.activeTexture.set(D.TEXTURE0),_e.texture&&_e.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const qe=va.getMorphValuesForProxy(he.key),Xe=qe?1:0;let st;qe&&(st={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:n.dk(qe.phase)}});const De=hp(he.projMatrix,gv(he.canonical,K.renderWorldCopies)?re/10:re,ce);if(j(Xe),!k)continue;y.setupElevationDraw(_e,k,st);const je=he.toUnwrapped();F&&F.setupShadows(je,k),_.uploadCommonUniforms(P,k,je,null,G),k.draw(_,me,Z,ye,H,ni.backCCW,De,"terrain_raster",y.gridBuffer,fe,ue)}}}}(o,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,o.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const o=this.painter,d=this.painter.context,_=this.proxySourceCache,y=this.proxiedCoords[_.id],v=this._drapedRenderBatches.shift(),S=o.style.order,A=[];let P=0;for(const D of y){const k=_.getTileByID(D.proxyTileKey),z=_.proxyCachedFBO[D.key]?_.proxyCachedFBO[D.key][t]:void 0,F=z!==void 0?_.renderCache[z]:this.pool[P++],G=z!==void 0;if(k.texture=F.tex,G&&!F.dirty){A.push(k.tileID);continue}let j;d.bindFramebuffer.set(F.fb.framebuffer),this.renderedToTile=!1,F.dirty&&(d.clear({color:n.am.transparent,stencil:0}),F.dirty=!1);for(let H=v.start;H<=v.end;++H){const Z=o.style._mergedLayers[S[H]];if(Z.isHidden(o.transform.zoom))continue;const K=o.style.getLayerSourceCache(Z),re=K?this.proxyToSource[D.key][K.id]:[D];if(!re)continue;const ce=re;d.viewport.set([0,0,F.fb.width,F.fb.height]),j!==(K?K.id:null)&&(this._setupStencil(F,re,Z,K),j=K?K.id:null),o.renderLayer(o,K,Z,ce)}if(this._drapedRenderBatches.length===0)for(const H of this._pendingGroundEffectLayers){const Z=o.style._mergedLayers[S[H]];if(Z.isHidden(o.transform.zoom))continue;const K=o.style.getLayerSourceCache(Z),re=K?this.proxyToSource[D.key][K.id]:[D];if(!re)continue;const ce=re;d.viewport.set([0,0,F.fb.width,F.fb.height]),j!==(K?K.id:null)&&(this._setupStencil(F,re,Z,K),j=K?K.id:null),o.renderLayer(o,K,Z,ce)}this.renderedToTile?(F.dirty=!0,A.push(k.tileID)):G||--P,P===5&&(P=0,this.renderToBackBuffer(A))}return this.renderToBackBuffer(A),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,o.width,o.height]),v.end+1}postRender(){}isLayerOrderingCorrect(t){const o=t.order.length;let d=-1,_=o;for(let y=0;y<o;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):_=Math.min(_,y);return _>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(o=>o.dem).forEach(o=>{t=Math.min(t,o.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,o,d){if(!this._visibleDemTiles)return null;const _=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const v=y.tileID,S=1<<v.overscaledZ,{x:A,y:P}=v.canonical,D=A/S,k=(A+1)/S,z=P/S,F=(P+1)/S;return{minx:D,miny:z,maxx:k,maxy:F,t:y.dem.tree.raycastRoot(D,z,k,F,t,o,d),tile:y}});_.sort((y,v)=>(y.t!==null?y.t:Number.MAX_VALUE)-(v.t!==null?v.t:Number.MAX_VALUE));for(const y of _){if(y.t==null)return null;const v=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,o,d);if(v!=null)return v}return null}_createFBO(){const t=this.painter.context,o=t.gl,d=this.drapeBufferSize;t.activeTexture.set(o.TEXTURE0);const _=new n.T(t,{width:d[0],height:d[1],data:null},o.RGBA8);_.bind(o.LINEAR,o.CLAMP_TO_EDGE);const y=t.createFramebuffer(d[0],d[1],!0,null);return y.colorAttachment.set(_.texture),y.depthAttachment=new _v(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&o.texParameterf(o.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const o=this._style._mergedLayers[t],d=o.isHidden(this.painter.transform.zoom);return o.type==="hillshade"||o.type==="custom"?!d&&o.shouldRedrape():!d&&o.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof eh){t=!0;break}if(!t)return;const o={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(y&&!o[y.id]&&!_.isHidden(this.painter.transform.zoom)&&_.type==="line"&&_.widthExpression()instanceof n.ab){o[y.id]=!0;for(const v of this.proxyCoords){const S=this.proxyToSource[v.key][y.id];if(S)for(const A of S)this._clearRenderCacheForTile(y.id,A)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof js){t=!0;break}if(!t)return;const o={};for(let d=0;d<this._style.order.length;++d){const _=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(_);if(!y||o[y.id]||_.isHidden(this.painter.transform.zoom)||_.type!=="raster")continue;const v=_.paint.get("raster-fade-duration");for(const S of this.proxyCoords){const A=this.proxyToSource[S.key][y.id];if(A)for(const P of A){const D=dl(y.getTile(P),y.findLoadedParent(P,0),y,this.painter.transform,v);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(y.id,P)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,o=t.length;if(o===0)return;const d=[];this._pendingGroundEffectLayers=[];let _,y=0,v=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(v)&&v.isHidden(this.painter.transform.zoom)&&++y<o;)v=this._style._mergedLayers[t[y]];for(;y<o;++y){const S=this._style._mergedLayers[t[y]];S.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(S)?_===void 0&&(_=y):(S.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),_!==void 0&&(d.push({start:_,end:y-1}),_=void 0)))}if(_!==void 0&&d.push({start:_,end:y-1}),d.length!==0){const S=d[d.length-1];this._pendingGroundEffectLayers.every(A=>A>S.end)||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const o=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,o.renderCache.length>o.renderCachePool.length){const v=Object.values(o.proxyCachedFBO);o.proxyCachedFBO={};for(let S=0;S<v.length;++S){const A=Object.values(v[S]);o.renderCachePool.push(...A)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,_=this._tilesDirty;for(let v=d.length-1;v>=0;v--){const S=d[v];if(o.getTileByID(S.key),o.proxyCachedFBO[S.key]!==void 0){const A=t[S.key],P=this.proxyToSource[S.key];let D=0;for(const k in P){const z=P[k],F=A[k];if(!F||F.length!==z.length||z.some((G,j)=>G!==F[j]||_[k]&&_[k].hasOwnProperty(G.key))){D=-1;break}++D}for(const k in o.proxyCachedFBO[S.key])o.renderCache[o.proxyCachedFBO[S.key][k]].dirty=D<0||D!==Object.values(A).length}}const y=[...this._drapedRenderBatches];y.sort((v,S)=>S.end-S.start-(v.end-v.start));for(const v of y)for(const S of d){if(o.proxyCachedFBO[S.key])continue;let A=o.renderCachePool.pop();A===void 0&&o.renderCache.length<50&&(A=o.renderCache.length,o.renderCache.push(this._createFBO())),A!==void 0&&(o.proxyCachedFBO[S.key]={},o.proxyCachedFBO[S.key][v.start]=A,o.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(t,o,d,_){if(!_||!this._sourceTilesOverlap[_.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,v=y.gl;if(o.length<=1)return void(this._overlapStencilType=!1);let S;if(d.isTileClipped())S=o.length,this._overlapStencilMode.test={func:v.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(o[0].overscaledZ>o[o.length-1].overscaledZ))return void(this._overlapStencilType=!1);S=1,this._overlapStencilMode.test={func:v.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+S>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=S,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(o,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):ci.disabled}_renderTileClippingMasks(t,o){const d=this.painter,_=this.painter.context,y=_.gl;d._tileClippingMaskIDs={},_.setColorMode(Di.disabled),_.setDepthMode(It.disabled);const v=d.getOrCreateProgram("clippingMask");for(const S of t){const A=d._tileClippingMaskIDs[S.key]=--o;v.draw(d,y.TRIANGLES,It.disabled,new ci({func:y.ALWAYS,mask:0},A,255,y.KEEP,y.KEEP,y.REPLACE),Di.disabled,ni.disabled,ul(S.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const o=this.painter.transform;if(t.x<0||t.x>o.width||t.y<0||t.y>o.height)return null;const d=[t.x,t.y,1,1];n.aA(d,d,o.pixelMatrixInverse),n.cw(d,d,1/d[3]),d[0]/=o.worldSize,d[1]/=o.worldSize;const _=o._camera.position,y=n.c6(1,o.center.lat),v=[_[0],_[1],_[2]/y,0],S=n.cX([],d.slice(0,3),v);n.au(S,S);const A=this.raycast(v,S,this._exaggeration);return A!==null&&A?(n.bE(v,v,S,A),v[3]=v[2],v[2]*=y,v):null}_setupProxiedCoordsForOrtho(t,o,d){if(t.getSource()instanceof n.aP)return this._setupProxiedCoordsForImageSource(t,o,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let A=0;A<y.length;A++){const P=y[A],D=this._findTileCoveringTileID(P,t);if(D){const k=this._createProxiedId(P,D,d[P.key]&&d[P.key][t.id]);_.push(k),this.proxyToSource[P.key][t.id]=[k]}}let v=!1;const S=new Set;for(let A=0;A<o.length;A++){const P=t.getTile(o[A]);if(!P||!P.hasData())continue;const D=this._findTileCoveringTileID(P.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==P.tileID.canonical.z){const k=this.proxyToSource[D.tileID.key][t.id],z=this._createProxiedId(D.tileID,P,d[D.tileID.key]&&d[D.tileID.key][t.id]);k?k.splice(k.length-1,0,z):this.proxyToSource[D.tileID.key][t.id]=[z];const F=this.proxyToSource[D.tileID.key][t.id];S.has(F)||S.add(F),_.push(z),v=!0}}if(this._sourceTilesOverlap[t.id]=v,v&&this._debugParams.sortTilesHiZFirst)for(const A of S)A.sort((P,D)=>D.overscaledZ-P.overscaledZ)}_setupProxiedCoordsForImageSource(t,o,d){if(!t.getSource().loaded())return;const _=this.proxiedCoords[t.id]=[],y=this.proxyCoords,v=t.getSource(),S=v.tileID;if(!S)return;const A=new n.P(S.x,S.y)._div(1<<S.z),P=v.coordinates.map(n.ac.fromLngLat).reduce((k,z)=>(k.min.x=Math.min(k.min.x,z.x-A.x),k.min.y=Math.min(k.min.y,z.y-A.y),k.max.x=Math.max(k.max.x,z.x-A.x),k.max.y=Math.max(k.max.y,z.y-A.y),k),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(k,z)=>{const F=k.wrap+k.canonical.x/(1<<k.canonical.z),G=k.canonical.y/(1<<k.canonical.z),j=n.aj/(1<<k.canonical.z),H=z.wrap+z.canonical.x/(1<<z.canonical.z),Z=z.canonical.y/(1<<z.canonical.z);return F+j<H+P.min.x||F>H+P.max.x||G+j<Z+P.min.y||G>Z+P.max.y};for(let k=0;k<y.length;k++){const z=y[k];for(let F=0;F<o.length;F++){const G=t.getTile(o[F]);if(!G||!G.hasData()||D(z,G.tileID))continue;const j=this._createProxiedId(z,G,d[z.key]&&d[z.key][t.id]),H=this.proxyToSource[z.key][t.id];H?H.push(j):this.proxyToSource[z.key][t.id]=[j],_.push(j)}}}_createProxiedId(t,o,d){let _=this.orthoMatrix;if(d){const y=d.find(v=>v.key===o.tileID.key);if(y)return y}if(o.tileID.key!==t.key){const y=t.canonical.z-o.tileID.canonical.z;let v,S,A;_=n.bz();const P=o.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(v=n.aj>>y,S=v*((o.tileID.canonical.x<<y)-t.canonical.x+P),A=v*((o.tileID.canonical.y<<y)-t.canonical.y)):(v=n.aj<<-y,S=n.aj*(o.tileID.canonical.x-(t.canonical.x+P<<-y)),A=n.aj*(o.tileID.canonical.y-(t.canonical.y<<-y))),n.c5(_,0,v,0,v,0,1),n.bo(_,_,[S,A,0])}return new od(o.tileID,t.key,_)}_findTileCoveringTileID(t,o){let d=o.getTile(t);if(d&&d.hasData())return d;const _=this._findCoveringTileCache[o.id],y=_[t.key];if(d=y?o.getTileByID(y):null,d&&d.hasData()||y===null)return d;let v=d?d.tileID:t,S=v.overscaledZ;const A=o.getSource().minzoom,P=[];if(!y){const k=o.getSource().maxzoom;if(t.canonical.z>=k){const z=t.canonical.z-k;o.getSource().reparseOverscaled?(S=Math.max(t.canonical.z+2,o.transform.tileZoom),v=new n.aM(S,t.wrap,k,t.canonical.x>>z,t.canonical.y>>z)):z!==0&&(S=k,v=new n.aM(S,t.wrap,k,t.canonical.x>>z,t.canonical.y>>z))}v.key!==t.key&&(P.push(v.key),d=o.getTile(v))}const D=k=>{P.forEach(z=>{_[z]=k}),P.length=0};for(S-=1;S>=A&&(!d||!d.hasData());S--){d&&D(d.tileID.key);const k=v.calculateScaledKey(S);if(d=o.getTileByID(k),d&&d.hasData())break;const z=_[k];if(z===null)break;z===void 0?P.push(k):d=o.getTileByID(z)}return D(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,o){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[o.key]=!0}}function ad(u,t,o){const d=function(S,A,P){const D=n.bG(A,S),k=n.bG(P,[.2126,.7152,.0722]),z=(G,j,H)=>(1-H)*G+H*j,F=z(1-.3*Math.min(k,1),1,Math.min(D+1,1));return z(.92,1,Math.asin(n.ay(A[2],-1,1))/Math.PI+.5)*F}(u,[0,0,1],t),_=[0,0,0];n.bY(_,o.slice(0,3),d);const y=[0,0,0];n.bY(y,t.slice(0,3),u[2]);const v=[0,0,0];return n.cV(v,_,y),n.cY(v)}const fp=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],pp=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class ld{static cacheKey(t,o,d,_){let y=`${o}${_?_.cacheKey:""}`;for(const v of d)t.usedDefines.includes(v)&&(y+=`/${v}`);return y}constructor(t,o,d,_,y,v){const S=t.gl;this.program=S.createProgram(),this.configuration=_,this.name=o,this.fixedDefines=[...v];const A=_?_.getBinderAttributes():[],P=(d.staticAttributes||[]).concat(A);let D=_?_.defines():[];D=D.concat(v.map(H=>`#define ${H}`));const k=`#version 300 es
`;let z=k+D.concat("precision mediump float;",Eo,bh.fragmentSource).join(`
`);for(const H of d.fragmentIncludes)z+=`
${ec[H]}`;z+=`
${d.fragmentSource}`;let F=k+D.concat("precision highp float;",Eo,bh.vertexSource).join(`
`);for(const H of d.vertexIncludes)F+=`
${ec[H]}`;this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(F+=`
uniform int u_instanceID;
`),F+=`
${d.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(F=F.replaceAll("gl_InstanceID","u_instanceID"));const G=S.createShader(S.FRAGMENT_SHADER);if(S.isContextLost())return void(this.failedToCreate=!0);S.shaderSource(G,z),S.compileShader(G),S.attachShader(this.program,G);const j=S.createShader(S.VERTEX_SHADER);if(S.isContextLost())this.failedToCreate=!0;else{S.shaderSource(j,F),S.compileShader(j),S.attachShader(this.program,j),this.attributes={},this.numAttributes=P.length;for(let H=0;H<this.numAttributes;H++)if(P[H]){const Z=P[H].startsWith("a_")?P[H]:`a_${P[H]}`;S.bindAttribLocation(this.program,H,Z),this.attributes[Z]=H}S.linkProgram(this.program),S.deleteShader(j),S.deleteShader(G),this.fixedUniforms=y(t),this.binderUniforms=_?_.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(H=>({u_instanceID:new n.c8(H)}))(t)),(v.includes("TERRAIN")||o.indexOf("symbol")!==-1||o.indexOf("circle")!==-1)&&(this.terrainUniforms=(H=>({u_dem:new n.c8(H),u_dem_prev:new n.c8(H),u_dem_tl:new n.cb(H),u_dem_scale:new n.ca(H),u_dem_tl_prev:new n.cb(H),u_dem_scale_prev:new n.ca(H),u_dem_size:new n.ca(H),u_dem_lerp:new n.ca(H),u_exaggeration:new n.ca(H),u_depth:new n.c8(H),u_depth_size_inv:new n.cb(H),u_depth_range_unpack:new n.cb(H),u_occluder_half_size:new n.ca(H),u_occlusion_depth_offset:new n.ca(H),u_meter_to_dem:new n.ca(H),u_label_plane_matrix_inv:new n.cc(H)}))(t)),v.includes("GLOBE")&&(this.globeUniforms=(H=>({u_tile_tl_up:new n.c9(H),u_tile_tr_up:new n.c9(H),u_tile_br_up:new n.c9(H),u_tile_bl_up:new n.c9(H),u_tile_up_scale:new n.ca(H)}))(t)),v.includes("FOG")&&(this.fogUniforms=(H=>({u_fog_matrix:new n.cc(H),u_fog_range:new n.cb(H),u_fog_color:new n.cQ(H),u_fog_horizon_blend:new n.ca(H),u_fog_vertical_limit:new n.cb(H),u_fog_temporal_offset:new n.ca(H),u_frustum_tl:new n.c9(H),u_frustum_tr:new n.c9(H),u_frustum_br:new n.c9(H),u_frustum_bl:new n.c9(H),u_globe_pos:new n.c9(H),u_globe_radius:new n.ca(H),u_globe_transition:new n.ca(H),u_is_globe:new n.c8(H),u_viewport:new n.cb(H)}))(t)),v.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(H=>({u_cutoff_params:new n.cQ(H)}))(t)),v.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(H=>({u_lighting_ambient_color:new n.c9(H),u_lighting_directional_dir:new n.c9(H),u_lighting_directional_color:new n.c9(H),u_ground_radiance:new n.c9(H)}))(t)),v.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(H=>({u_light_matrix_0:new n.cc(H),u_light_matrix_1:new n.cc(H),u_fade_range:new n.cb(H),u_shadow_normal_offset:new n.c9(H),u_shadow_intensity:new n.ca(H),u_shadow_texel_size:new n.ca(H),u_shadow_map_resolution:new n.ca(H),u_shadow_direction:new n.c9(H),u_shadow_bias:new n.c9(H),u_shadowmap_0:new n.c8(H),u_shadowmap_1:new n.c8(H)}))(t))}}setTerrainUniformValues(t,o){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in o)d[_]&&d[_].set(this.program,_,o[_])}}setGlobeUniformValues(t,o){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in o)d[_]&&d[_].set(this.program,_,o[_])}}setFogUniformValues(t,o){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in o)d[_].set(this.program,_,o[_])}}setCutoffUniformValues(t,o){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in o)d[_].set(this.program,_,o[_])}}setLightsUniformValues(t,o){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const _ in o)d[_].set(this.program,_,o[_])}}setShadowUniformValues(t,o){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const _ in o)d[_].set(this.program,_,o[_])}_drawDebugWireframe(t,o,d,_,y,v,S,A,P,D){const k=t.options.wireframe;if(k.terrain===!1&&k.layers2D===!1&&k.layers3D===!1)return;const z=t.context;if(!(!(!k.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!k.layers2D||t._terrain&&t._terrain.renderingToTexture||!fp.includes(this.name))||!(!k.layers3D||!pp.includes(this.name))))return;const F=z.gl,G=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,z);if(!G)return;const j=[...this.fixedDefines];j.push("DEBUG_WIREFRAME");const H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:j});z.program.set(H.program);const Z=(ce,me,fe)=>{if(me[ce]&&fe[ce])for(const ue in me[ce])fe[ce][ue]&&fe[ce][ue].set(fe.program,ue,me[ce][ue].current)};P&&P.setUniforms(H.program,z,H.binderUniforms,S,{zoom:A}),Z("fixedUniforms",this,H),Z("terrainUniforms",this,H),Z("globeUniforms",this,H),Z("fogUniforms",this,H),Z("lightsUniforms",this,H),Z("shadowUniforms",this,H),G.bind(),z.setColorMode(new Di([F.ONE,F.ONE_MINUS_SRC_ALPHA,F.ZERO,F.ONE],n.am.transparent,[!0,!0,!0,!1])),z.setDepthMode(new It(o.func===F.LESS?F.LEQUAL:o.func,It.ReadOnly,o.range)),z.setStencilMode(ci.disabled);const K=3*v.primitiveLength*2,re=3*v.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const ce=D||1;for(let me=0;me<ce;++me)H.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",me),F.drawElements(F.LINES,K,F.UNSIGNED_SHORT,re)}else D&&D>1?F.drawElementsInstanced(F.LINES,K,F.UNSIGNED_SHORT,re,D):F.drawElements(F.LINES,K,F.UNSIGNED_SHORT,re);y.bind(),z.program.set(this.program),z.setDepthMode(o),z.setStencilMode(d),z.setColorMode(_)}checkUniforms(t,o,d){if(this.fixedDefines.includes(o)){for(const _ of Object.keys(d))if(!d[_].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${_} not set but required by ${o} being defined`)}}draw(t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H){const Z=t.context,K=Z.gl;if(this.failedToCreate)return;Z.program.set(this.program),Z.setDepthMode(d),Z.setStencilMode(_),Z.setColorMode(y),Z.setCullFace(v);for(const me of Object.keys(this.fixedUniforms))this.fixedUniforms[me].set(this.program,me,S[me]);G&&G.setUniforms(this.program,Z,this.binderUniforms,z,{zoom:F});const re={[K.POINTS]:1,[K.LINES]:2,[K.TRIANGLES]:3,[K.LINE_STRIP]:1}[o];this.checkUniforms(A,"RENDER_SHADOWS",this.shadowUniforms);const ce=H&&H>0?1:void 0;for(const me of k.get()){const fe=me.vaos||(me.vaos={});if((fe[A]||(fe[A]=new tc)).bind(Z,this,P,G?G.getPaintVertexBuffers():[],D,me.vertexOffset,j||[],ce),this.forceManualRenderingForInstanceIDShaders){const ue=H||1;for(let he=0;he<ue;++he)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",he),D?K.drawElements(o,me.primitiveLength*re,K.UNSIGNED_SHORT,me.primitiveOffset*re*2):K.drawArrays(o,me.vertexOffset,me.vertexLength)}else H&&H>1?K.drawElementsInstanced(o,me.primitiveLength*re,K.UNSIGNED_SHORT,me.primitiveOffset*re*2,H):D?K.drawElements(o,me.primitiveLength*re,K.UNSIGNED_SHORT,me.primitiveOffset*re*2):K.drawArrays(o,me.vertexOffset,me.vertexLength);o===K.TRIANGLES&&D&&this._drawDebugWireframe(t,d,_,y,D,me,z,F,G,H)}}}function Sh(u,t,o=0){const d=Math.pow(2,t.tileID.overscaledZ),_=t.tileSize*Math.pow(2,u.transform.tileZoom)/d,y=_*(t.tileID.canonical.x+t.tileID.wrap*d),v=_*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.aw(t,1,u.transform.tileZoom),u_pixel_coord_upper:[y>>16,v>>16],u_pixel_coord_lower:[65535&y,65535&v],u_pattern_transition:o}}const rc={terrain:0,flat:1},mp=n.bz(),Eh=(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z)=>{const K=t.style.light,re=K.properties.get("position"),ce=[re.x,re.y,re.z],me=n.dx();K.properties.get("anchor")==="viewport"&&(n.dy(me,-t.transform.angle),n.dz(ce,ce,me));const fe=K.properties.get("color").toPremultipliedRenderColor(null),ue=t.transform,he={u_matrix:u,u_lightpos:ce,u_lightintensity:K.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_vertical_gradient:+o,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:mp,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:rc[P],u_base_type:rc[D],u_ao:_,u_edge_radius:y,u_width_scale:v,u_flood_light_color:G,u_vertical_scale:j,u_flood_light_intensity:H,u_ground_shadow_factor:Z};return ue.projection.name==="globe"&&(he.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],he.u_zoom_transition=k,he.u_inv_rot_matrix=F,he.u_merc_center=z,he.u_up_dir=ue.projection.upVector(new n.cp(0,0,0),z[0]*n.aj,z[1]*n.aj),he.u_height_lift=A),he},X_=(u,t,o,d,_,y)=>({u_matrix:u,u_edge_radius:t,u_width_scale:o,u_vertical_scale:d,u_height_type:rc[_],u_base_type:rc[y]}),Y_=(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z)=>{const K=Eh(u,t,o,d,_,y,v,S,P,D,k,z,F,G,j,H,1,[0,0,0]),re={u_height_factor:-Math.pow(2,S.overscaledZ)/A.tileSize/8};return n.h(K,Sh(t,A,Z),re)},fl=(u,t,o)=>({u_matrix:u,u_emissive_strength:t,u_ground_shadow_factor:o}),K_=(u,t,o,d,_,y=0)=>n.h(fl(u,t,_),Sh(o,d,y)),yv=(u,t,o,d)=>({u_matrix:u,u_world:o,u_emissive_strength:t,u_ground_shadow_factor:d}),xv=(u,t,o,d,_,y,v=0)=>n.h(K_(u,t,o,d,y,v),{u_world:_}),vv=(u,t)=>({u_matrix:u,u_ground_shadow_factor:t}),cd=(u,t,o,d,_)=>({u_matrix:u,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:o,u_height_scale:d,u_reset_depth:_}),bv=(u,t,o,d)=>{const _=n.aj/o.tileSize;return{u_matrix:u,u_camera_to_center_distance:t.getCameraToCenterDistance(d),u_extrude_scale:[t.pixelsToGLUnits[0]/_,t.pixelsToGLUnits[1]/_]}},hd=(u,t,o=1)=>({u_matrix:u,u_color:t,u_overlay:0,u_overlay_scale:o}),_p=n.bz(),J_=(u,t,o,d,_,y,v)=>{const S=u.transform,A=S.projection.name==="globe",P=A?n.dA(S.zoom,t.canonical)*S._pixelsPerMercatorPixel:n.aw(o,1,y),D={u_matrix:t.projMatrix,u_extrude_scale:P,u_intensity:v,u_inv_rot_matrix:_p,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){D.u_inv_rot_matrix=d,D.u_merc_center=_,D.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],D.u_zoom_transition=n.ah(S.zoom);const k=_[0]*n.aj,z=_[1]*n.aj;D.u_up_dir=S.projection.upVector(new n.cp(0,0,0),k,z)}return D};function pl(u,[t,o,d,_],[y,v]){if(y===v)return[0,0,0,0];const S=255*(u-1)/(u*(v-y));return[t*S,o*S,d*S,_*S]}function gp(u,t,[o,d]){return o===d?0:.5/u+(t-o)*(u-1)/(u*(d-o))}const yp=(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K,re,ce)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:P,u_fade_t:D.mix,u_opacity:D.opacity*k.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:k.paint.get("raster-brightness-min"),u_brightness_high:k.paint.get("raster-brightness-max"),u_saturation_factor:n.dC(k.paint.get("raster-saturation")),u_contrast_factor:n.dB(k.paint.get("raster-contrast")),u_spin_weights:Q_(k.paint.get("raster-hue-rotate")),u_perspective_transform:z,u_raster_elevation:F,u_zoom_transition:v,u_merc_center:S,u_cutoff_params:A,u_colorization_mix:pl(n.dD,j,Z),u_colorization_offset:gp(n.dD,H,Z),u_color_ramp:G,u_texture_offset:[re/(K+2*re),K/(K+2*re)],u_texture_res:[K+2*re,K+2*re],u_emissive_strength:ce});function Q_(u){u*=Math.PI/180;const t=Math.sin(u),o=Math.cos(u);return[(2*o+1)/3,(-Math.sqrt(3)*t-o+1)/3,(Math.sqrt(3)*t-o+1)/3]}const ba=.05,ml=(u,t,o,d,_,y,v,S,A,P,D,k)=>({u_matrix:u,u_normalize_matrix:t,u_globe_matrix:o,u_merc_matrix:d,u_grid_matrix:_,u_tl_parent:y,u_scale_parent:P,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:k,u_zoom_transition:v,u_merc_center:S,u_cutoff_params:A}),eg=(u,t,o,d,_,y,v,S,A,P)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_tile_offset:o,u_velocity:d,u_color_ramp:y,u_velocity_res:_,u_max_speed:v,u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),wa=(u,t,o,d,_,y,v,S,A,P)=>({u_particle_texture:u,u_particle_texture_side_len:t,u_velocity:o,u_velocity_res:d,u_max_speed:_,u_speed_factor:y,u_reset_rate:v,u_rand_seed:Math.random(),u_uv_offset:S,u_data_scale:[255*A[0],255*A[1]],u_data_offset:P,u_particle_pos_scale:1.1,u_particle_pos_offset:[ba,ba]}),ud=n.bz(),Ah=(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K,re,ce,me,fe,ue)=>{const he=_.transform,_e={u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:he.getCameraToCenterDistance(K),u_rotate_symbol:+o,u_aspect_ratio:he.width/he.height,u_fade_change:_.options.fadeDuration?_.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:v,u_coord_matrix:S,u_is_text:+P,u_elevation_from_sea:A?1:0,u_pitch_with_map:+d,u_texsize:D,u_texsize_icon:k,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ud,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ud,u_up_vector:[0,-1,0],u_color_adj_mat:me,u_icon_transition:fe||0,u_gamma_scale:d?_.transform.getCameraToCenterDistance(K)*Math.cos(_.terrain?0:_.transform._pitch):1,u_device_pixel_ratio:n.q.devicePixelRatio,u_is_halo:1,u_scale_factor:ue||1,u_ground_shadow_factor:re,u_inv_matrix:n.bi(n.bz(),v),u_normal_scale:ce};return K.name==="globe"&&(_e.u_tile_id=[F.canonical.x,F.canonical.y,1<<F.canonical.z],_e.u_zoom_transition=G,_e.u_inv_rot_matrix=H,_e.u_merc_center=j,_e.u_camera_forward=he._camera.forward(),_e.u_ecef_origin=n.dE(he.globeMatrix,F.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(he.globeMatrix),_e.u_up_vector=Z),_e},xp=(u,t,o,d)=>({u_matrix:u,u_emissive_strength:t,u_opacity:o,u_color:d}),vp=(u,t,o,d,_,y,v,S,A)=>n.h(function(P,D,k,z,F,G){const{width:j,height:H}=z.imageManager.getPixelSize(D),Z=Math.pow(2,G.tileID.overscaledZ),K=G.tileSize*Math.pow(2,z.transform.tileZoom)/Z,re=K*(G.tileID.canonical.x+G.tileID.wrap*Z),ce=K*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:k.tl,u_pattern_br:k.br,u_texsize:[j,H],u_pattern_size:k.displaySize,u_pattern_units_to_pixels:F?[z.transform.width,-1*z.transform.height]:[1/n.aw(G,1,z.transform.tileZoom),1/n.aw(G,1,z.transform.tileZoom)],u_pixel_coord_upper:[re>>16,ce>>16],u_pixel_coord_lower:[65535&re,65535&ce]}}(0,y,v,d,S,A),{u_matrix:u,u_emissive_strength:t,u_opacity:o}),Ih=new Float32Array(n.bx([])),Ch=(u,t,o,d,_,y,v,S,A,P,D,k,z,F=[0,0,0],G)=>{const j=_.style.light,H=j.properties.get("position"),Z=[-H.x,-H.y,H.z],K=n.dx();j.properties.get("anchor")==="viewport"&&(n.dy(K,-_.transform.angle),n.dz(Z,Z,K));const re=D.alphaMode==="MASK",ce=j.properties.get("color").toNonPremultipliedRenderColor(null),me=z.paint.get("model-ambient-occlusion-intensity"),fe=z.paint.get("model-color").constantOr(n.am.white).toNonPremultipliedRenderColor(null);return fe.a=z.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:u,u_lighting_matrix:t,u_normal_matrix:o,u_node_matrix:d||Ih,u_lightpos:Z,u_lightintensity:j.properties.get("intensity"),u_lightcolor:[ce.r,ce.g,ce.b],u_camera_pos:F,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:v.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:A,u_roughnessFactor:P,u_baseColorTexture:lr.BaseColor,u_metallicRoughnessTexture:lr.MetallicRoughness,u_normalTexture:lr.Normal,u_occlusionTexture:lr.Occlusion,u_emissionTexture:lr.Emission,u_lutTexture:lr.LUT,u_color_mix:fe.toArray01(),u_aoIntensity:me,u_emissive_strength:k,u_occlusionTextureTransform:G||[0,0,0,0]}},tg=(u,t=Ih,o=Ih)=>({u_matrix:u,u_instance:t,u_node_matrix:o}),ig={fillExtrusion:u=>({u_matrix:new n.cc(u),u_lightpos:new n.c9(u),u_lightintensity:new n.ca(u),u_lightcolor:new n.c9(u),u_vertical_gradient:new n.ca(u),u_opacity:new n.ca(u),u_edge_radius:new n.ca(u),u_width_scale:new n.ca(u),u_ao:new n.cb(u),u_height_type:new n.c8(u),u_base_type:new n.c8(u),u_tile_id:new n.c9(u),u_zoom_transition:new n.ca(u),u_inv_rot_matrix:new n.cc(u),u_merc_center:new n.cb(u),u_up_dir:new n.c9(u),u_height_lift:new n.ca(u),u_flood_light_color:new n.c9(u),u_vertical_scale:new n.ca(u),u_flood_light_intensity:new n.ca(u),u_ground_shadow_factor:new n.c9(u)}),fillExtrusionDepth:u=>({u_matrix:new n.cc(u),u_edge_radius:new n.ca(u),u_width_scale:new n.ca(u),u_vertical_scale:new n.ca(u),u_height_type:new n.c8(u),u_base_type:new n.c8(u)}),fillExtrusionPattern:u=>({u_matrix:new n.cc(u),u_lightpos:new n.c9(u),u_lightintensity:new n.ca(u),u_lightcolor:new n.c9(u),u_vertical_gradient:new n.ca(u),u_height_factor:new n.ca(u),u_edge_radius:new n.ca(u),u_width_scale:new n.ca(u),u_ao:new n.cb(u),u_height_type:new n.c8(u),u_base_type:new n.c8(u),u_tile_id:new n.c9(u),u_zoom_transition:new n.ca(u),u_inv_rot_matrix:new n.cc(u),u_merc_center:new n.cb(u),u_up_dir:new n.c9(u),u_height_lift:new n.ca(u),u_image:new n.c8(u),u_texsize:new n.cb(u),u_pixel_coord_upper:new n.cb(u),u_pixel_coord_lower:new n.cb(u),u_tile_units_to_pixels:new n.ca(u),u_opacity:new n.ca(u),u_pattern_transition:new n.ca(u)}),fillExtrusionGroundEffect:u=>({u_matrix:new n.cc(u),u_opacity:new n.ca(u),u_ao_pass:new n.ca(u),u_meter_to_tile:new n.ca(u),u_ao:new n.cb(u),u_flood_light_intensity:new n.ca(u),u_flood_light_color:new n.c9(u),u_attenuation:new n.ca(u),u_edge_radius:new n.ca(u),u_fb:new n.c8(u),u_fb_size:new n.ca(u),u_dynamic_offset:new n.ca(u)}),fill:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_ground_shadow_factor:new n.c9(u)}),fillPattern:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_image:new n.c8(u),u_texsize:new n.cb(u),u_pixel_coord_upper:new n.cb(u),u_pixel_coord_lower:new n.cb(u),u_tile_units_to_pixels:new n.ca(u),u_ground_shadow_factor:new n.c9(u),u_pattern_transition:new n.ca(u)}),fillOutline:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_world:new n.cb(u),u_ground_shadow_factor:new n.c9(u)}),fillOutlinePattern:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_world:new n.cb(u),u_image:new n.c8(u),u_texsize:new n.cb(u),u_pixel_coord_upper:new n.cb(u),u_pixel_coord_lower:new n.cb(u),u_tile_units_to_pixels:new n.ca(u),u_ground_shadow_factor:new n.c9(u),u_pattern_transition:new n.ca(u)}),building:u=>({u_matrix:new n.cc(u),u_normal_matrix:new n.cc(u),u_opacity:new n.ca(u)}),buildingDepth:u=>({u_matrix:new n.cc(u)}),elevatedStructuresDepth:u=>({u_matrix:new n.cc(u),u_depth_bias:new n.ca(u)}),elevatedStructures:u=>({u_matrix:new n.cc(u),u_ground_shadow_factor:new n.c9(u)}),elevatedStructuresDepthReconstruct:u=>({u_matrix:new n.cc(u),u_camera_pos:new n.c9(u),u_depth_bias:new n.ca(u),u_height_scale:new n.ca(u),u_reset_depth:new n.ca(u)}),circle:n.dH,collisionBox:u=>({u_matrix:new n.cc(u),u_camera_to_center_distance:new n.ca(u),u_extrude_scale:new n.cb(u)}),collisionCircle:u=>({u_matrix:new n.cc(u),u_inv_matrix:new n.cc(u),u_camera_to_center_distance:new n.ca(u),u_viewport_size:new n.cb(u)}),debug:u=>({u_color:new n.di(u),u_matrix:new n.cc(u),u_overlay:new n.c8(u),u_overlay_scale:new n.ca(u)}),clippingMask:u=>({u_matrix:new n.cc(u)}),heatmap:u=>({u_extrude_scale:new n.ca(u),u_intensity:new n.ca(u),u_matrix:new n.cc(u),u_inv_rot_matrix:new n.cc(u),u_merc_center:new n.cb(u),u_tile_id:new n.c9(u),u_zoom_transition:new n.ca(u),u_up_dir:new n.c9(u)}),heatmapTexture:u=>({u_image:new n.c8(u),u_color_ramp:new n.c8(u),u_opacity:new n.ca(u)}),hillshade:u=>({u_matrix:new n.cc(u),u_image:new n.c8(u),u_latrange:new n.cb(u),u_light:new n.cb(u),u_shadow:new n.di(u),u_highlight:new n.di(u),u_emissive_strength:new n.ca(u),u_accent:new n.di(u)}),hillshadePrepare:u=>({u_matrix:new n.cc(u),u_image:new n.c8(u),u_dimension:new n.cb(u),u_zoom:new n.ca(u)}),line:n.dG,linePattern:n.dF,raster:u=>({u_matrix:new n.cc(u),u_normalize_matrix:new n.cc(u),u_globe_matrix:new n.cc(u),u_merc_matrix:new n.cc(u),u_grid_matrix:new n.dj(u),u_tl_parent:new n.cb(u),u_scale_parent:new n.ca(u),u_fade_t:new n.ca(u),u_opacity:new n.ca(u),u_image0:new n.c8(u),u_image1:new n.c8(u),u_brightness_low:new n.ca(u),u_brightness_high:new n.ca(u),u_saturation_factor:new n.ca(u),u_contrast_factor:new n.ca(u),u_spin_weights:new n.c9(u),u_perspective_transform:new n.cb(u),u_raster_elevation:new n.ca(u),u_zoom_transition:new n.ca(u),u_merc_center:new n.cb(u),u_cutoff_params:new n.cQ(u),u_colorization_mix:new n.cQ(u),u_colorization_offset:new n.ca(u),u_color_ramp:new n.c8(u),u_texture_offset:new n.cb(u),u_texture_res:new n.cb(u),u_emissive_strength:new n.ca(u)}),rasterParticle:u=>({u_matrix:new n.cc(u),u_normalize_matrix:new n.cc(u),u_globe_matrix:new n.cc(u),u_merc_matrix:new n.cc(u),u_grid_matrix:new n.dj(u),u_tl_parent:new n.cb(u),u_scale_parent:new n.ca(u),u_fade_t:new n.ca(u),u_opacity:new n.ca(u),u_image0:new n.c8(u),u_image1:new n.c8(u),u_raster_elevation:new n.ca(u),u_zoom_transition:new n.ca(u),u_merc_center:new n.cb(u),u_cutoff_params:new n.cQ(u)}),rasterParticleTexture:u=>({u_texture:new n.c8(u),u_opacity:new n.ca(u)}),rasterParticleDraw:u=>({u_particle_texture:new n.c8(u),u_particle_texture_side_len:new n.ca(u),u_tile_offset:new n.cb(u),u_velocity:new n.c8(u),u_color_ramp:new n.c8(u),u_velocity_res:new n.cb(u),u_max_speed:new n.ca(u),u_uv_offset:new n.cb(u),u_data_scale:new n.cb(u),u_data_offset:new n.ca(u),u_particle_pos_scale:new n.ca(u),u_particle_pos_offset:new n.cb(u)}),rasterParticleUpdate:u=>({u_particle_texture:new n.c8(u),u_particle_texture_side_len:new n.ca(u),u_velocity:new n.c8(u),u_velocity_res:new n.cb(u),u_max_speed:new n.ca(u),u_speed_factor:new n.ca(u),u_reset_rate:new n.ca(u),u_rand_seed:new n.ca(u),u_uv_offset:new n.cb(u),u_data_scale:new n.cb(u),u_data_offset:new n.ca(u),u_particle_pos_scale:new n.ca(u),u_particle_pos_offset:new n.cb(u)}),symbol:u=>({u_is_size_zoom_constant:new n.c8(u),u_is_size_feature_constant:new n.c8(u),u_size_t:new n.ca(u),u_size:new n.ca(u),u_camera_to_center_distance:new n.ca(u),u_rotate_symbol:new n.c8(u),u_aspect_ratio:new n.ca(u),u_fade_change:new n.ca(u),u_matrix:new n.cc(u),u_label_plane_matrix:new n.cc(u),u_coord_matrix:new n.cc(u),u_is_text:new n.c8(u),u_elevation_from_sea:new n.c8(u),u_pitch_with_map:new n.c8(u),u_texsize:new n.cb(u),u_texsize_icon:new n.cb(u),u_texture:new n.c8(u),u_texture_icon:new n.c8(u),u_gamma_scale:new n.ca(u),u_device_pixel_ratio:new n.ca(u),u_tile_id:new n.c9(u),u_zoom_transition:new n.ca(u),u_inv_rot_matrix:new n.cc(u),u_merc_center:new n.cb(u),u_camera_forward:new n.c9(u),u_tile_matrix:new n.cc(u),u_up_vector:new n.c9(u),u_ecef_origin:new n.c9(u),u_is_halo:new n.c8(u),u_icon_transition:new n.ca(u),u_color_adj_mat:new n.cc(u),u_scale_factor:new n.ca(u),u_ground_shadow_factor:new n.c9(u),u_inv_matrix:new n.cc(u),u_normal_scale:new n.ca(u)}),background:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_opacity:new n.ca(u),u_color:new n.di(u)}),backgroundPattern:u=>({u_matrix:new n.cc(u),u_emissive_strength:new n.ca(u),u_opacity:new n.ca(u),u_image:new n.c8(u),u_pattern_tl:new n.cb(u),u_pattern_br:new n.cb(u),u_texsize:new n.cb(u),u_pattern_size:new n.cb(u),u_pixel_coord_upper:new n.cb(u),u_pixel_coord_lower:new n.cb(u),u_pattern_units_to_pixels:new n.cb(u)}),terrainRaster:u=>({u_matrix:new n.cc(u),u_image0:new n.c8(u),u_skirt_height:new n.ca(u),u_ground_shadow_factor:new n.c9(u)}),skybox:u=>({u_matrix:new n.cc(u),u_sun_direction:new n.c9(u),u_cubemap:new n.c8(u),u_opacity:new n.ca(u),u_temporal_offset:new n.ca(u)}),skyboxGradient:u=>({u_matrix:new n.cc(u),u_color_ramp:new n.c8(u),u_center_direction:new n.c9(u),u_radius:new n.ca(u),u_opacity:new n.ca(u),u_temporal_offset:new n.ca(u)}),skyboxCapture:u=>({u_matrix_3f:new n.dj(u),u_sun_direction:new n.c9(u),u_sun_intensity:new n.ca(u),u_color_tint_r:new n.cQ(u),u_color_tint_m:new n.cQ(u),u_luminance:new n.ca(u)}),globeRaster:u=>({u_proj_matrix:new n.cc(u),u_globe_matrix:new n.cc(u),u_normalize_matrix:new n.cc(u),u_merc_matrix:new n.cc(u),u_zoom_transition:new n.ca(u),u_merc_center:new n.cb(u),u_image0:new n.c8(u),u_grid_matrix:new n.dj(u),u_skirt_height:new n.ca(u),u_far_z_cutoff:new n.ca(u),u_frustum_tl:new n.c9(u),u_frustum_tr:new n.c9(u),u_frustum_br:new n.c9(u),u_frustum_bl:new n.c9(u),u_globe_pos:new n.c9(u),u_globe_radius:new n.ca(u),u_viewport:new n.cb(u)}),globeAtmosphere:u=>({u_frustum_tl:new n.c9(u),u_frustum_tr:new n.c9(u),u_frustum_br:new n.c9(u),u_frustum_bl:new n.c9(u),u_horizon:new n.ca(u),u_transition:new n.ca(u),u_fadeout_range:new n.ca(u),u_color:new n.cQ(u),u_high_color:new n.cQ(u),u_space_color:new n.cQ(u),u_temporal_offset:new n.ca(u),u_horizon_angle:new n.ca(u)}),model:u=>({u_matrix:new n.cc(u),u_lighting_matrix:new n.cc(u),u_normal_matrix:new n.cc(u),u_node_matrix:new n.cc(u),u_lightpos:new n.c9(u),u_lightintensity:new n.ca(u),u_lightcolor:new n.c9(u),u_camera_pos:new n.c9(u),u_opacity:new n.ca(u),u_baseColorFactor:new n.cQ(u),u_emissiveFactor:new n.cQ(u),u_metallicFactor:new n.ca(u),u_roughnessFactor:new n.ca(u),u_baseTextureIsAlpha:new n.c8(u),u_alphaMask:new n.c8(u),u_alphaCutoff:new n.ca(u),u_baseColorTexture:new n.c8(u),u_metallicRoughnessTexture:new n.c8(u),u_normalTexture:new n.c8(u),u_occlusionTexture:new n.c8(u),u_emissionTexture:new n.c8(u),u_lutTexture:new n.c8(u),u_color_mix:new n.cQ(u),u_aoIntensity:new n.ca(u),u_emissive_strength:new n.ca(u),u_occlusionTextureTransform:new n.cQ(u)}),modelDepth:u=>({u_matrix:new n.cc(u),u_instance:new n.cc(u),u_node_matrix:new n.cc(u)}),groundShadow:u=>({u_matrix:new n.cc(u),u_ground_shadow_factor:new n.c9(u)}),stars:u=>({u_matrix:new n.cc(u),u_up:new n.c9(u),u_right:new n.c9(u),u_intensity_multiplier:new n.ca(u)}),snowParticle:u=>({u_modelview:new n.cc(u),u_projection:new n.cc(u),u_time:new n.ca(u),u_cam_pos:new n.c9(u),u_velocityConeAperture:new n.ca(u),u_velocity:new n.ca(u),u_horizontalOscillationRadius:new n.ca(u),u_horizontalOscillationRate:new n.ca(u),u_boxSize:new n.ca(u),u_billboardSize:new n.ca(u),u_simpleShapeParameters:new n.cb(u),u_screenSize:new n.cb(u),u_thinningCenterPos:new n.cb(u),u_thinningShape:new n.c9(u),u_thinningAffectedRatio:new n.ca(u),u_thinningParticleOffset:new n.ca(u),u_particleColor:new n.cQ(u),u_direction:new n.c9(u)}),rainParticle:u=>({u_modelview:new n.cc(u),u_projection:new n.cc(u),u_time:new n.ca(u),u_cam_pos:new n.c9(u),u_texScreen:new n.c8(u),u_velocityConeAperture:new n.ca(u),u_velocity:new n.ca(u),u_boxSize:new n.ca(u),u_rainDropletSize:new n.cb(u),u_distortionStrength:new n.ca(u),u_rainDirection:new n.c9(u),u_color:new n.cQ(u),u_screenSize:new n.cb(u),u_thinningCenterPos:new n.cb(u),u_thinningShape:new n.c9(u),u_thinningAffectedRatio:new n.ca(u),u_thinningParticleOffset:new n.ca(u),u_shapeDirectionalPower:new n.ca(u),u_shapeNormalPower:new n.ca(u),u_mode:new n.ca(u)}),vignette:u=>({u_vignetteShape:new n.c9(u),u_vignetteColor:new n.cQ(u)}),occlusion:u=>({u_matrix:new n.cc(u),u_anchorPos:new n.c9(u),u_screenSizePx:new n.cb(u),u_occluderSizePx:new n.cb(u),u_color:new n.cQ(u)})};class Xr{constructor(t,o,d,_){this.id=Xr.uniqueIdxCounter,Xr.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||_||o.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=Xr.uniqueIdxCounter,Xr.uniqueIdxCounter++;const o=this.context.gl;this.context.unbindVAO(),this.bind(),o.bufferSubData(o.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Xr.uniqueIdxCounter=0;const wv={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Tv{constructor(t,o,d,_,y,v){this.length=o.length,this.attributes=d,this.itemSize=o.bytesPerElement,this.dynamicDraw=_,this.instanceCount=v,this.context=t;const S=t.gl;this.buffer=S.createBuffer(),t.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,o.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||y||o.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const o=this.context.gl;this.bind(),o.bufferSubData(o.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,o){for(let d=0;d<this.attributes.length;d++){const _=o.attributes[this.attributes[d].name];_!==void 0&&t.enableVertexAttribArray(_)}}setVertexAttribPointers(t,o,d){for(let _=0;_<this.attributes.length;_++){const y=this.attributes[_],v=o.attributes[y.name];v!==void 0&&t.vertexAttribPointer(v,y.components,t[wv[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,o,d){for(let _=0;_<this.attributes.length;_++){const y=o.attributes[this.attributes[_].name];y!==void 0&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bp{constructor(t,o,d,_,y){this.context=t,this.width=o,this.height=d;const v=this.framebuffer=t.gl.createFramebuffer();_&&(this.colorAttachment=new W_(t,v)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new q_(t,v):new mv(t,v))}destroy(){const t=this.context.gl;if(this.colorAttachment){const o=this.colorAttachment.get();o&&t.deleteTexture(o)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const o=this.depthAttachment.get();o&&t.deleteRenderbuffer(o)}else{const o=this.depthAttachment.get();o&&t.deleteTexture(o)}t.deleteFramebuffer(this.framebuffer)}}class Sv{constructor(t,o){this.gl=t,this.clearColor=new B_(this),this.clearDepth=new rp(this),this.clearStencil=new cv(this),this.colorMask=new hv(this),this.depthMask=new uv(this),this.stencilMask=new dv(this),this.stencilFunc=new N_(this),this.stencilOp=new fv(this),this.stencilTest=new Ku(this),this.depthRange=new pv(this),this.depthTest=new V_(this),this.depthFunc=new op(this),this.blend=new Ju(this),this.blendFunc=new ap(this),this.blendColor=new hl(this),this.blendEquation=new ic(this),this.cullFace=new Qu(this),this.cullFaceSide=new ed(this),this.frontFace=new nc(this),this.program=new U_(this),this.activeTexture=new lp(this),this.viewport=new j_(this),this.bindFramebuffer=new sc(this),this.bindRenderbuffer=new td(this),this.bindTexture=new id(this),this.bindVertexBuffer=new cp(this),this.bindElementBuffer=new nd(this),this.bindVertexArrayOES=new wh(this),this.pixelStoreUnpack=new $_(this),this.pixelStoreUnpackPremultiplyAlpha=new G_(this),this.pixelStoreUnpackFlipY=new H_(this),this.options=o?Object.assign({},o):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=o&&!!o.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.maxPointSize=t.getParameter(t.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,o,d){return new Xr(this,t,o,d)}createVertexBuffer(t,o,d,_,y){return new Tv(this,t,o,d,_,y)}createRenderbuffer(t,o,d){const _=this.gl,y=_.createRenderbuffer();return this.bindRenderbuffer.set(y),_.renderbufferStorage(_.RENDERBUFFER,t,o,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,o,d,_){return new bp(this,t,o,d,_)}clear({color:t,depth:o,stencil:d,colorMask:_}){const y=this.gl;let v=0;t&&(v|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(_||[!0,!0,!0,!0])),o!==void 0&&(v|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),d!==void 0&&(v|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(v)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){n.bv(t.blendFunction,Di.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let oc;function dd(u,t,o,d,_,y,v){const S=u.context,A=S.gl,P=u.transform,D=u.getOrCreateProgram("collisionBox"),k=[];let z=0,F=0;for(let ce=0;ce<d.length;ce++){const me=d[ce],fe=t.getTile(me),ue=fe.getBucket(o);if(!ue)continue;const he=ri(me,ue,P);let _e=he;_[0]===0&&_[1]===0||(_e=u.translatePosMatrix(he,fe,_,y));const ye=v?ue.textCollisionBox:ue.iconCollisionBox,Le=ue.collisionCircleArray;if(Le.length>0){const ze=n.bz(),qe=_e;n.cB(ze,ue.placementInvProjMatrix,P.glCoordMatrix),n.cB(ze,ze,ue.placementViewportMatrix),k.push({circleArray:Le,circleOffset:F,transform:qe,invTransform:ze,projection:ue.getProjection()}),z+=Le.length/4,F=z}ye&&(u.terrain&&u.terrain.setupElevationDraw(fe,D),D.draw(u,A.LINES,It.disabled,ci.disabled,u.colorModeForRenderPass(),ni.disabled,bv(_e,P,fe,ue.getProjection()),o.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,null,P.zoom,null,[ye.collisionVertexBuffer,ye.collisionVertexBufferExt]))}if(!v||!k.length)return;const G=u.getOrCreateProgram("collisionCircle"),j=new n.dI;j.resize(4*z),j._trim();let H=0;for(const ce of k)for(let me=0;me<ce.circleArray.length/4;me++){const fe=4*me,ue=ce.circleArray[fe+0],he=ce.circleArray[fe+1],_e=ce.circleArray[fe+2],ye=ce.circleArray[fe+3];j.emplace(H++,ue,he,_e,ye,0),j.emplace(H++,ue,he,_e,ye,1),j.emplace(H++,ue,he,_e,ye,2),j.emplace(H++,ue,he,_e,ye,3)}(!oc||oc.length<2*z)&&(oc=function(ce){const me=2*ce,fe=new n.a_;fe.resize(me),fe._trim();for(let ue=0;ue<me;ue++){const he=6*ue;fe.uint16[he+0]=4*ue+0,fe.uint16[he+1]=4*ue+1,fe.uint16[he+2]=4*ue+2,fe.uint16[he+3]=4*ue+2,fe.uint16[he+4]=4*ue+3,fe.uint16[he+5]=4*ue+0}return fe}(z));const Z=S.createIndexBuffer(oc,!0),K=S.createVertexBuffer(j,n.dJ.members,!0);for(const ce of k){const me={u_matrix:ce.transform,u_inv_matrix:ce.invTransform,u_camera_to_center_distance:(re=P).getCameraToCenterDistance(ce.projection),u_viewport_size:[re.width,re.height]};G.draw(u,A.TRIANGLES,It.disabled,ci.disabled,u.colorModeForRenderPass(),ni.disabled,me,o.id,K,Z,n.bd.simpleSegment(0,2*ce.circleOffset,ce.circleArray.length,ce.circleArray.length/2),null,P.zoom)}var re;K.destroy(),Z.destroy()}const Xo=n.bz();function Mh(u){const t=u._camera.getWorldToCamera(u.worldSize,1),o=n.az([],t,u.globeMatrix);n.bi(o,o);const d=[0,0,0],_=[0,1,0,0];return n.aA(_,_,o),d[0]=_[0],d[1]=_[1],d[2]=_[2],n.au(d,d),d}function Ph({width:u,height:t,anchor:o,textOffset:d,textScale:_},y){const{horizontalAlign:v,verticalAlign:S}=n.bT(o),A=-(v-.5)*u,P=-(S-.5)*t,D=n.bU(o,d);return new n.P((A/_+D[0])*y,(P/_+D[1])*y)}function ng(u,t,o,d,_,y,v,S,A,P){const D=u.text.placedSymbolArray,k=u.text.dynamicLayoutVertexArray,z=u.icon.dynamicLayoutVertexArray,F={},G=u.getProjection(),j=Uu(v,G,_),H=_.elevation,Z=G.upVectorScale(v.canonical,_.center.lat,_.worldSize).metersToTile;k.clear();for(let K=0;K<D.length;K++){const re=D.get(K),{tileAnchorX:ce,tileAnchorY:me,numGlyphs:fe}=re,ue=re.hidden||!re.crossTileID||u.allowVerticalPlacement&&!re.placedOrientation?null:d[re.crossTileID];if(ue){let he=0,_e=0,ye=0;if(H){const Ke=H?H.getAtTileOffset(v,ce,me):0,[Be,it,ft]=G.upVector(v.canonical,ce,me);he=Ke*Be*Z,_e=Ke*it*Z,ye=Ke*ft*Z}let[Le,ze,qe,Xe]=ro(re.projectedAnchorX+he,re.projectedAnchorY+_e,re.projectedAnchorZ+ye,o?j:y);const st=hh(_.getCameraToCenterDistance(G),Xe);let De=n.bJ(u.textSizeData,A,re)*st/n.bO;o&&(De*=u.tilePixelRatio/S);const je=Ph(ue,De);o?({x:Le,y:ze,z:qe}=G.projectTilePoint(ce+je.x,me+je.y,v.canonical),[Le,ze,qe]=ro(Le+he,ze+_e,qe+ye,y)):(t&&je._rotate(-_.angle),Le+=je.x,ze+=je.y,qe=0);const Te=u.allowVerticalPlacement&&re.placedOrientation===n.bI.vertical?Math.PI/2:0;for(let Ke=0;Ke<fe;Ke++)n.bL(k,Le,ze,qe,Te);P&&re.associatedIconIndex>=0&&(F[re.associatedIconIndex]={x:Le,y:ze,z:qe,angle:Te})}else rl(fe,k)}if(P){z.clear();const K=u.icon.placedSymbolArray;for(let re=0;re<K.length;re++){const ce=K.get(re),{numGlyphs:me}=ce,fe=F[re];if(ce.hidden||!fe)rl(me,z);else{const{x:ue,y:he,z:_e,angle:ye}=fe;for(let Le=0;Le<me;Le++)n.bL(z,ue,he,_e,ye)}}u.icon.dynamicLayoutVertexBuffer.updateData(z)}u.text.dynamicLayoutVertexBuffer.updateData(k)}function ac(u,t,o,d,_,y,v={}){const S=o.paint.get("icon-translate"),A=o.paint.get("text-translate"),P=o.paint.get("icon-translate-anchor"),D=o.paint.get("text-translate-anchor"),k=o.layout.get("icon-rotation-alignment"),z=o.layout.get("text-rotation-alignment"),F=o.layout.get("icon-pitch-alignment"),G=o.layout.get("text-pitch-alignment"),j=o.layout.get("icon-keep-upright"),H=o.layout.get("text-keep-upright"),Z=o.paint.get("icon-color-saturation"),K=o.paint.get("icon-color-contrast"),re=o.paint.get("icon-color-brightness-min"),ce=o.paint.get("icon-color-brightness-max"),me=o.layout.get("symbol-elevation-reference")==="sea",fe=u.context,ue=fe.gl,he=u.transform,_e=k==="map",ye=z==="map",Le=F==="map",ze=G==="map",qe=o.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Xe=!1;const st=u.depthModeForSublayer(0,It.ReadOnly),De=new It(u.context.gl.LEQUAL,It.ReadOnly,u.depthRangeFor3D),je=[n.aD(he.center.lng),n.aH(he.center.lat)],Te=o.layout.get("text-variable-anchor"),Ke=he.projection.name==="globe",Be=[],it=[0,-1,0];for(const ft of d){const Ye=t.getTile(ft),ut=Ye.getBucket(o);if(!ut||ut.projection.name==="mercator"&&Ke||ut.fullyClipped)continue;const Mt=ut.projection.name==="globe",Pt=Mt?n.ah(he.zoom):0,Et=Uu(ft,ut.getProjection(),he),Ut=he.calculatePixelsToTileUnitsMatrix(Ye),qt=Te&&ut.hasTextData(),ei=ut.hasIconTextFit()&&qt&&ut.hasIconData(),ai=ut.getProjection().createInversionMatrix(he,ft.canonical),Ei=(1<<Ye.tileID.canonical.z)*n.aj/u.transform.worldSize,an=Cn=>{let Qi=[0,0,0];if(Cn){const Jn=u.style.directionalLight,$i=u.style.ambientLight;Jn&&$i&&(Qi=ll(u.style,Jn,$i))}return Qi},In=Cn=>{he.depthOcclusionForSymbolsAndCircles&&(o.hasInitialOcclusionOpacityProperties||u.terrain)&&(Cn.push("DEPTH_D24"),Cn.push("DEPTH_OCCLUSION"))},un=()=>{const Cn=_e&&o.layout.get("symbol-placement")!=="point",Qi=[];In(Qi);const Jn=Cn||ei,$i=ut.elevationType==="road"&&Le,ds=u.shadowRenderer,Ln=$i&&!!ds&&ds.enabled,Tn=an(Ln),zn=$i?De:st,nn=o.paint.get("icon-image-cross-fade");u.terrainRenderModeElevated()&&Le&&Qi.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(Qi.push("PROJECTION_GLOBE_VIEW"),Jn&&Qi.push("PROJECTED_POS_ON_VIEWPORT")),nn>0&&Qi.push("ICON_TRANSITION"),ut.icon.zOffsetVertexBuffer&&Qi.push("Z_OFFSET"),Z===0&&K===0&&re===0&&ce===1||Qi.push("COLOR_ADJUSTMENT"),ut.sdfIcons&&Qi.push("RENDER_SDF"),Ln&&Qi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$i&&ut.icon.orientationVertexBuffer&&Qi.push("ELEVATED_ROADS");const is=ut.icon.programConfigurations.get(o.id),Hs=u.getOrCreateProgram("symbol",{config:is,defines:Qi}),Vn=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Ki=ut.iconSizeData,Ir=n.bH(Ki,he.zoom),yr=Le||!he.isOrthographic,Br=Ho(Et,Ye.tileID.canonical,Le,_e,he,ut.getProjection(),Ut),co=Bu(Et,Ye.tileID.canonical,Le,_e,he,ut.getProjection(),Ut),Kr=u.translatePosMatrix(co,Ye,S,P,!0),xr=u.translatePosMatrix(Et,Ye,S,P),Da=Jn?Xo:Br,ho=_e&&!Le&&!Cn;let Ra=it;!Ke&&!he.mercatorFromTransition||_e||(Ra=Mh(he));const qh=Mt?Ra:it,Hp=o.getColorAdjustmentMatrix(Z,K,re,ce),bc=Ah(Ki.kind,Ir,ho,Le,u,xr,Da,Kr,me,!1,Vn,[0,0],0,ft,Pt,je,ai,qh,ut.getProjection(),Tn,Ei,Hp,nn,null),Wp=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,Zh=o.layout.get("icon-size").constantOr(0)!==1||ut.iconsNeedLinear,Dd=ut.sdfIcons||u.options.rotating||u.options.zooming||Zh||yr?ue.LINEAR:ue.NEAREST,Rd=ut.sdfIcons&&o.paint.get("icon-halo-width").constantOr(1)!==0,Mo=u.terrain&&Le&&Cn?n.bi(n.bz(),Br):Xo;if(Cn&&ut.icon){const wc=he.elevation,bl=wc?wc.getAtTileOffsetFunc(ft,he.center.lat,he.worldSize,ut.getProjection()):null,La=Fu(Et,Ye.tileID.canonical,Le,_e,he,ut.getProjection(),Ut);Nu(ut,Et,u,!1,La,co,Le,j,bl,ft)}return{program:Hs,buffers:ut.icon,uniformValues:bc,atlasTexture:Wp,atlasTextureIcon:null,atlasInterpolation:Dd,atlasInterpolationIcon:null,isSDF:ut.sdfIcons,hasHalo:Rd,depthMode:zn,tile:Ye,renderWithShadows:Ln,labelPlaneMatrixInv:Mo}},mn=()=>{const Cn=ye&&o.layout.get("symbol-placement")!=="point",Qi=[],Jn=Cn||Te||ei,$i=ut.elevationType==="road"&&ze,ds=u.shadowRenderer,Ln=$i&&!!ds&&ds.enabled,Tn=an(Ln),zn=$i?De:st;u.terrainRenderModeElevated()&&ze&&Qi.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(Qi.push("PROJECTION_GLOBE_VIEW"),Jn&&Qi.push("PROJECTED_POS_ON_VIEWPORT")),ut.text.zOffsetVertexBuffer&&Qi.push("Z_OFFSET"),ut.iconsInText&&Qi.push("RENDER_TEXT_AND_SYMBOL"),Qi.push("RENDER_SDF"),Ln&&Qi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),$i&&ut.text.orientationVertexBuffer&&Qi.push("ELEVATED_ROADS"),In(Qi);const nn=ut.text.programConfigurations.get(o.id),is=u.getOrCreateProgram("symbol",{config:nn,defines:Qi});let Hs,Vn=[0,0],Ki=null;const Ir=ut.textSizeData;ut.iconsInText&&(Vn=Ye.imageAtlasTexture?Ye.imageAtlasTexture.size:[0,0],Ki=Ye.imageAtlasTexture?Ye.imageAtlasTexture:null,Hs=ze||!he.isOrthographic||u.options.rotating||u.options.zooming||Ir.kind==="composite"||Ir.kind==="camera"?ue.LINEAR:ue.NEAREST);const yr=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture.size:[0,0],Br=o.layout.get("text-size-scale-range"),co=n.ay(u.scaleFactor,Br[0],Br[1]),Kr=n.bH(Ir,he.zoom,co),xr=Ho(Et,Ye.tileID.canonical,ze,ye,he,ut.getProjection(),Ut),Da=Bu(Et,Ye.tileID.canonical,ze,ye,he,ut.getProjection(),Ut),ho=u.translatePosMatrix(Da,Ye,A,D,!0),Ra=u.translatePosMatrix(Et,Ye,A,D),qh=Jn?Xo:xr,Hp=ye&&!ze&&!Cn;let bc=it;!Ke&&!he.mercatorFromTransition||ye||(bc=Mh(he));const Wp=Ah(Ir.kind,Kr,Hp,ze,u,Ra,qh,ho,me,!0,yr,Vn,0,ft,Pt,je,ai,Mt?bc:it,ut.getProjection(),Tn,Ei,null,null,co),Zh=Ye.glyphAtlasTexture?Ye.glyphAtlasTexture:null,Dd=ue.LINEAR,Rd=o.paint.get("text-halo-width").constantOr(1)!==0,Mo=u.terrain&&ze&&Cn?n.bi(n.bz(),xr):Xo;if(Cn&&ut.text){const wc=he.elevation,bl=wc?wc.getAtTileOffsetFunc(ft,he.center.lat,he.worldSize,ut.getProjection()):null,La=Fu(Et,Ye.tileID.canonical,ze,ye,he,ut.getProjection(),Ut);Nu(ut,Et,u,!0,La,Da,ze,H,bl,ft)}return{program:is,buffers:ut.text,uniformValues:Wp,atlasTexture:Zh,atlasTextureIcon:Ki,atlasInterpolation:Dd,atlasInterpolationIcon:Hs,isSDF:!0,hasHalo:Rd,depthMode:zn,tile:Ye,renderWithShadows:Ln,labelPlaneMatrixInv:Mo}},os=ut.icon.segments.get().length,vi=ut.text.segments.get().length,Mi=os&&!v.onlyText?un():null,Oi=vi&&!v.onlyIcons?mn():null,Rn=o.paint.get("icon-opacity").constantOr(1),_s=o.paint.get("text-opacity").constantOr(1);if(qe&&ut.canOverlap){Xe=!0;const Cn=Rn&&!v.onlyText?ut.icon.segments.get():[],Qi=_s&&!v.onlyIcons?ut.text.segments.get():[];for(const Jn of Cn)Be.push({segments:new n.bd([Jn]),sortKey:Jn.sortKey,state:Mi});for(const Jn of Qi)Be.push({segments:new n.bd([Jn]),sortKey:Jn.sortKey,state:Oi})}else v.onlyText||Be.push({segments:Rn?ut.icon.segments:new n.bd([]),sortKey:0,state:Mi}),v.onlyIcons||Be.push({segments:_s?ut.text.segments:new n.bd([]),sortKey:0,state:Oi})}Xe&&Be.sort((ft,Ye)=>ft.sortKey-Ye.sortKey);for(const ft of Be){const Ye=ft.state;if(Ye)if(u.terrain?u.terrain.setupElevationDraw(Ye.tile,Ye.program,{useDepthForOcclusion:he.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Ye.labelPlaneMatrixInv}):u.setupDepthForOcclusion(he.depthOcclusionForSymbolsAndCircles,Ye.program),fe.activeTexture.set(ue.TEXTURE0),Ye.atlasTexture&&Ye.atlasTexture.bind(Ye.atlasInterpolation,ue.CLAMP_TO_EDGE,!0),Ye.atlasTextureIcon&&(fe.activeTexture.set(ue.TEXTURE1),Ye.atlasTextureIcon&&Ye.atlasTextureIcon.bind(Ye.atlasInterpolationIcon,ue.CLAMP_TO_EDGE,!0)),Ye.renderWithShadows&&u.shadowRenderer.setupShadows(Ye.tile.tileID.toUnwrapped(),Ye.program,"vector-tile",Ye.tile.tileID.overscaledZ),u.uploadCommonLightUniforms(u.context,Ye.program),Ye.hasHalo){const ut=Ye.uniformValues;ut.u_is_halo=1,lc(Ye.buffers,ft.segments,o,u,Ye.program,Ye.depthMode,_,y,ut,2),ut.u_is_halo=0}else{if(Ye.isSDF){const ut=Ye.uniformValues;Ye.hasHalo&&(ut.u_is_halo=1,lc(Ye.buffers,ft.segments,o,u,Ye.program,Ye.depthMode,_,y,ut,1)),ut.u_is_halo=0}lc(Ye.buffers,ft.segments,o,u,Ye.program,Ye.depthMode,_,y,Ye.uniformValues,1)}}}function lc(u,t,o,d,_,y,v,S,A,P){const D=[u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer,u.iconTransitioningVertexBuffer,u.globeExtVertexBuffer,u.zOffsetVertexBuffer,u.orientationVertexBuffer];_.draw(d,d.context.gl.TRIANGLES,y,v,S,ni.disabled,A,o.id,u.layoutVertexBuffer,u.indexBuffer,t,o.paint,d.transform.zoom,u.programConfigurations.get(o.id),D,P)}function fd(u,t){const o=1<<u.canonical.z,d=(t.x*o-u.canonical.x-u.wrap*o)*n.aj,_=(t.y*o-u.canonical.y)*n.aj,y=n.dS(t.z,t.y);return n.cS(d,_,y)}function wp(u,t,o,d,_){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const y=u.context.gl,v=new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D),S=new It(u.context.gl.GREATER,It.ReadWrite,u.depthRangeFor3D),A=function(F){const G=n.cJ(F.pitch);let j=.01;return F.isOrthographic&&(j=n.ai(1e-4,j,n.cN(G>=Ns?1:G/Ns))),2*j}(u.transform),P=u.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",k=u.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),z=u.getOrCreateProgram(D);for(const F of d){const G=t.getTile(F),j=G.getBucket(o);if(!j)continue;const H=j.elevatedStructures;if(!H)continue;const Z=j.elevationBufferData.heightRange,K=fd(F.toUnwrapped(),P),re=u.translatePosMatrix(F.projMatrix,G,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));let ce,me,fe,ue;if(_==="initialize"){if(!Z||Z.min>=1||H.depthSegments.segments[0].primitiveLength===0)continue;ce=cd(re,K,A,1,0),me=v,fe=H.depthSegments,ue=k}else if(_==="reset"){if(!Z||Z.min>=0||H.maskSegments.segments[0].primitiveLength===0)continue;ce=cd(re,K,0,0,1),me=S,fe=H.maskSegments,ue=k}else if(_==="geometry"){if(H.depthSegments.segments[0].primitiveLength===0)continue;ce=cd(re,K,A,1,0),me=v,fe=H.depthSegments,ue=z}ue.draw(u,y.TRIANGLES,me,ci.disabled,Di.disabled,ni.disabled,ce,o.id,H.vertexBuffer,H.indexBuffer,fe,o.paint,u.transform.zoom)}}function Tp(u,t,o){const{painter:d,sourceCache:_,layer:y,coords:v,colorMode:S,elevationType:A,terrainEnabled:P,pass:D}=u,k=d.context.gl,z=y.paint.get("fill-pattern"),F=y.paint.get("fill-pattern-cross-fade"),G=z.constantOr(null);let j=A;A!=="road"||t&&!P||(j="none");const H=j==="road",Z=u.painter.shadowRenderer,K=H&&!!Z&&Z.enabled,re=new It(d.context.gl.LEQUAL,It.ReadOnly,d.depthRangeFor3D);let ce=[0,0,0];if(K){const ue=d.style.directionalLight,he=d.style.ambientLight;ue&&he&&(ce=ll(d.style,ue,he))}const me=z&&z.constantOr(1),fe=(ue,he)=>{let _e,ye,Le,ze,qe;he?(_e=me&&!y.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Le=k.LINES):(_e=me?"fillPattern":"fill",Le=k.TRIANGLES);for(const Xe of v){const st=_.getTile(Xe);if(me&&!st.patternsLoaded())continue;const De=st.getBucket(y);if(!De)continue;const je=t?De.elevationBufferData:De.bufferData;if(je.isEmpty())continue;d.prepareDrawTile();const Te=je.programConfigurations.get(y.id),Ke=d.isTileAffectedByFog(Xe),Be=[],it=[];H&&(Be.push("ELEVATED_ROADS"),it.push(je.elevatedLayoutVertexBuffer)),K&&Be.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),me&&(d.context.activeTexture.set(k.TEXTURE0),st.imageAtlasTexture&&st.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Te.updatePaintBuffers());let ft=!1;if(G&&st.imageAtlas){const Et=st.imageAtlas,Ut=n.dN.from(G),qt=Ut.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),ei=Ut.getSecondary(),ai=Et.patternPositions.get(qt),Ei=ei?Et.patternPositions.get(ei.scaleSelf(n.q.devicePixelRatio).toString()):null;ft=!!ai&&!!Ei,ai&&Te.setConstantPatternPositions(ai,Ei)}F>0&&(ft||Te.getPatternTransitionVertexBuffer("fill-pattern"))&&Be.push("FILL_PATTERN_TRANSITION");const Ye=d.getOrCreateProgram(_e,{config:Te,overrideFog:Ke,defines:Be}),ut=d.translatePosMatrix(Xe.projMatrix,st,y.paint.get("fill-translate"),y.paint.get("fill-translate-anchor"));K&&Z.setupShadows(st.tileID.toUnwrapped(),Ye,"vector-tile",st.tileID.overscaledZ);const Mt=y.paint.get("fill-emissive-strength");if(he){ze=je.lineIndexBuffer,qe=je.lineSegments;const Et=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];ye=_e==="fillOutlinePattern"&&me?xv(ut,Mt,d,st,Et,ce,F):yv(ut,Mt,Et,ce)}else ze=je.indexBuffer,qe=je.triangleSegments,ye=me?K_(ut,Mt,d,st,ce,F):fl(ut,Mt,ce);d.uploadCommonUniforms(d.context,Ye,Xe.toUnwrapped());let Pt=ue;(A==="road"&&!P||A==="offset")&&(Pt=re),Ye.draw(d,Le,Pt,o||d.stencilModeForClipping(Xe),S,ni.disabled,ye,y.id,je.layoutVertexBuffer,ze,qe,y.paint,d.transform.zoom,Te,it)}};d.renderPass===D&&fe(d.depthModeForSublayer(1,d.renderPass==="opaque"?It.ReadWrite:It.ReadOnly),!1),j==="none"&&d.renderPass==="translucent"&&y.paint.get("fill-antialias")&&fe(d.depthModeForSublayer(y.getPaintProperty("fill-outline-color")?2:0,It.ReadOnly),!0)}function Yo(u,t,o,d,_,y,v,S){o.resetLayerRenderingStats(u);const A=u.context,P=A.gl,D=u.transform,k=o.paint.get("fill-extrusion-pattern"),z=o.paint.get("fill-extrusion-pattern-cross-fade"),F=k.constantOr(null),G=k.constantOr(1),j=o.paint.get("fill-extrusion-opacity"),H=u.style.enable3dLights(),Z=o.paint.get(H&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),K=[o.paint.get("fill-extrusion-ambient-occlusion-intensity"),Z],re=o.layout.get("fill-extrusion-edge-radius"),ce=re>0&&!o.paint.get("fill-extrusion-rounded-roof"),me=ce?0:re,fe=D.projection.name==="globe"?n.dV():0,ue=D.projection.name==="globe",he=ue?n.ah(D.zoom):0,_e=[n.aD(D.center.lng),n.aH(D.center.lat)],ye=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Le=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ye?null:o.lut).toArray01().slice(0,3),ze=o.paint.get("fill-extrusion-flood-light-intensity"),qe=o.paint.get("fill-extrusion-vertical-scale"),Xe=o.paint.get("fill-extrusion-line-width").constantOr(1)!==0,st=o.paint.get("fill-extrusion-height-alignment"),De=o.paint.get("fill-extrusion-base-alignment"),je=So(u,o.paint.get("fill-extrusion-cutoff-fade-range")),Te=[];let Ke;ue&&Te.push("PROJECTION_GLOBE_VIEW"),K[0]>0&&Te.push("FAUX_AO"),ce&&Te.push("ZERO_ROOF_RADIUS"),S&&Te.push("HAS_CENTROID"),ze>0&&Te.push("FLOOD_LIGHT"),je.shouldRenderCutoff&&Te.push("RENDER_CUTOFF"),Xe&&Te.push("RENDER_WALL_MODE");const Be=u.renderPass==="shadow",it=u.shadowRenderer,ft=Be&&!!it,Ye=Be?ni.disabled:ni.backCCW;u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!0);let ut=[0,0,0];if(it){const Et=u.style.directionalLight,Ut=u.style.ambientLight;Et&&Ut&&(ut=ll(u.style,Et,Ut)),Be||(Te.push("RENDER_SHADOWS","DEPTH_TEXTURE"),it.useNormalOffset&&Te.push("NORMAL_OFFSET")),Ke=Te.concat(["SHADOWS_SINGLE_CASCADE"])}const Mt=ft?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",Pt=o.getLayerRenderingStats();for(const Et of d){const Ut=t.getTile(Et),qt=Ut.getBucket(o);if(!qt||qt.projection.name!==D.projection.name)continue;let ei=!1;it&&(ei=it.getMaxCascadeForTile(Et.toUnwrapped())===0);const ai=u.isTileAffectedByFog(Et),Ei=qt.programConfigurations.get(o.id);let an=!1;if(F&&Ut.imageAtlas){const Oi=Ut.imageAtlas,Rn=n.dN.from(F),_s=Rn.getPrimary().scaleSelf(n.q.devicePixelRatio).toString(),Cn=Rn.getSecondary(),Qi=Oi.patternPositions.get(_s),Jn=Cn?Oi.patternPositions.get(Cn.scaleSelf(n.q.devicePixelRatio).toString()):null;an=!!Qi&&!!Jn,Qi&&Ei.setConstantPatternPositions(Qi,Jn)}z>0&&(an||Ei.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Te.push("FILL_EXTRUSION_PATTERN_TRANSITION");const In=u.getOrCreateProgram(Mt,{config:Ei,defines:ei?Ke:Te,overrideFog:ai});if(u.terrain&&u.terrain.setupElevationDraw(Ut,In,{useMeterToDem:!0}),!qt.centroidVertexBuffer){const Oi=In.attributes.a_centroid_pos;Oi!==void 0&&P.vertexAttrib2f(Oi,0,0)}!Be&&it&&it.setupShadows(Ut.tileID.toUnwrapped(),In,"vector-tile",Ut.tileID.overscaledZ),G&&(u.context.activeTexture.set(P.TEXTURE0),Ut.imageAtlasTexture&&Ut.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Ei.updatePaintBuffers());const un=o.paint.get("fill-extrusion-vertical-gradient"),mn=1/qt.tileToMeter;let os;if(Be&&it){if(Sa(Ut.tileID,qt,u))continue;const Oi=it.calculateShadowPassMatrixFromTile(Ut.tileID.toUnwrapped());os=X_(Oi,me,mn,qe,st,De)}else{const Oi=u.translatePosMatrix(Et.expandedProjMatrix,Ut,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),Rn=D.projection.createInversionMatrix(D,Et.canonical);os=G?Y_(Oi,u,un,j,K,me,mn,Et,Ut,fe,st,De,he,_e,Rn,Le,qe,z):Eh(Oi,u,un,j,K,me,mn,Et,fe,st,De,he,_e,Rn,Le,qe,ze,ut)}u.uploadCommonUniforms(A,In,Et.toUnwrapped(),null,je);let vi=qt.segments;if(D.projection.name==="mercator"&&!Be&&(vi=qt.getVisibleSegments(Ut.tileID,u.terrain,u.transform.getFrustum(0)),!vi.get().length))continue;if(Pt)if(Be)for(const Oi of vi.get())Pt.numRenderedVerticesInShadowPass+=Oi.primitiveLength;else for(const Oi of vi.get())Pt.numRenderedVerticesInTransparentPass+=Oi.primitiveLength;const Mi=[];(u.terrain||S)&&Mi.push(qt.centroidVertexBuffer),ue&&Mi.push(qt.layoutVertexExtBuffer),Xe&&Mi.push(qt.wallVertexBuffer),In.draw(u,A.gl.TRIANGLES,_,y,v,Ye,os,o.id,qt.layoutVertexBuffer,qt.indexBuffer,vi,o.paint,u.transform.zoom,Ei,Mi)}u.shadowRenderer&&(u.shadowRenderer.useNormalOffset=!1)}function Ko(u,t,o,d,_,y,v,S,A,P,D,k,z,F,G,j,H,Z,K){const re=u.context,ce=re.gl,me=u.transform,fe=u.transform.zoom,ue=[],he=So(u,o.paint.get("fill-extrusion-cutoff-fade-range"));P==="clear"?(ue.push("CLEAR_SUBPASS"),K&&(ue.push("CLEAR_FROM_TEXTURE"),re.activeTexture.set(ce.TEXTURE0),K.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):P==="sdf"&&ue.push("SDF_SUBPASS"),H&&ue.push("HAS_CENTROID"),he.shouldRenderCutoff&&ue.push("RENDER_CUTOFF");const _e=o.layout.get("fill-extrusion-edge-radius"),ye=(Le,ze,qe,Xe,st)=>{const De=ze.programConfigurations.get(o.id),je=u.isTileAffectedByFog(Le),Te=u.getOrCreateProgram("fillExtrusionGroundEffect",{config:De,defines:ue,overrideFog:je}),Ke=((it,ft,Ye,ut,Mt,Pt,Et,Ut,qt,ei,ai)=>({u_matrix:ft,u_opacity:Ye,u_ao_pass:ut?1:0,u_meter_to_tile:Mt,u_ao:Pt,u_flood_light_intensity:Et,u_flood_light_color:Ut,u_attenuation:qt,u_edge_radius:ei,u_fb:0,u_fb_size:ai,u_dynamic_offset:1}))(0,Xe,D,A,st,[k,z*st],F,G,j,fe>=17?0:_e*st,K?K.size[0]:0),Be=[];H&&Be.push(ze.hiddenByLandmarkVertexBuffer),u.uploadCommonUniforms(re,Te,Le.toUnwrapped(),null,he),Te.draw(u,re.gl.TRIANGLES,_,y,v,S,Ke,o.id,ze.vertexBuffer,ze.indexBuffer,qe,o.paint,fe,De,Be)};for(const Le of d){const ze=t.getTile(Le),qe=ze.getBucket(o);if(!qe||qe.projection.name!==me.projection.name||!qe.groundEffect||qe.groundEffect&&!qe.groundEffect.hasData())continue;const Xe=qe.groundEffect,st=1/qe.tileToMeter;{const De=u.translatePosMatrix(Le.projMatrix,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),je=Xe.getDefaultSegment();ye(Le,Xe,je,De,st)}if(Z)for(let De=0;De<4;De++){const je=n.dT[De](Le),Te=t.getTile(je);if(!Te)continue;const Ke=Te.getBucket(o);if(!Ke||Ke.projection.name!==me.projection.name||!Ke.groundEffect||Ke.groundEffect&&!Ke.groundEffect.hasData())continue;const Be=Ke.groundEffect;let it,ft;De===0?(it=[-8192,0,0],ft=1):De===1?(it=[n.aj,0,0],ft=0):De===2?(it=[0,-8192,0],ft=3):(it=[0,n.aj,0],ft=2);const Ye=Be.regionSegments[ft];if(!Ye)continue;const ut=new Float32Array(16);n.bo(ut,Le.projMatrix,it),ye(Le,Be,Ye,u.translatePosMatrix(ut,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),st)}}}function Ct(u,t,o,d,_,y,v){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const S=y?y.findDEMTileFor(o):null;if(!(S&&S.dem||v))return;y&&S&&S.dem&&d.selfDEMTileTimestamp!==S.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=S.dem._timestamp);const A=Z=>new n.P(Math.ceil((Z+n.dX)*n.dY),0),P=Z=>{const K=t.getSource().minzoom,re=me=>{const fe=t.getTileByID(me);if(fe&&fe.hasData())return fe.getBucket(_)},ce=[0,-1,1];for(const me of ce){if(Z.overscaledZ+me<K)continue;const fe=re(Z.calculateScaledKey(Z.overscaledZ+me));if(fe)return fe}},D=[0,0,0],k=(Z,K)=>(D[0]=Math.min(Z.min.y,K.min.y),D[1]=Math.max(Z.max.y,K.max.y),D[2]=n.aj-K.min.x>Z.max.x?K.min.x-n.aj:Z.max.x,D),z=(Z,K)=>(D[0]=Math.min(Z.min.x,K.min.x),D[1]=Math.max(Z.max.x,K.max.x),D[2]=n.aj-K.min.y>Z.max.y?K.min.y-n.aj:Z.max.y,D),F=[(Z,K)=>k(Z,K),(Z,K)=>k(K,Z),(Z,K)=>z(Z,K),(Z,K)=>z(K,Z)],G=(Z,K,re,ce,me,fe,ue)=>{if(!y)return 0;const he=[[fe?re:Z,fe?Z:re,0],[fe?re:K,fe?K:re,0]],_e=ue<0?n.aj+ue:ue,ye=[fe?_e:(Z+K)/2,fe?(Z+K)/2:_e,0];return re===0&&ue<0||re!==0&&ue>0?y.getForTilePoints(me,[ye],!0,ce):he.push(ye),y.getForTilePoints(o,he,!0,S),Math.max(he[0][2],he[1][2],ye[2])/y.exaggeration()};for(let Z=0;Z<4;Z++){const K=d.borderFeatureIndices[Z];if(K.length===0)continue;const re=n.dT[Z](o),ce=P(re);if(!(ce&&ce instanceof n.dU))continue;const me=y?y.findDEMTileFor(re):null;if(!(me&&me.dem||v)||(y&&me&&me.dem&&d.borderDEMTileTimestamp[Z]!==me.dem._timestamp&&(d.borderDoneWithNeighborZ[Z]=-1,d.borderDEMTileTimestamp[Z]=me.dem._timestamp),d.borderDoneWithNeighborZ[Z]===ce.canonical.z))continue;ce.centroidVertexArray.length===0&&ce.createCentroidsBuffer();const fe=(Z<2?1:5)-Z,ue=ce.borderDoneWithNeighborZ[fe]!==d.canonical.z,he=ce.borderFeatureIndices[fe];let _e=0;if(d.canonical.z!==ce.canonical.z){for(const ye of K)d.showCentroid(d.featuresOnBorder[ye]);if(ue)for(const ye of he)ce.showCentroid(ce.featuresOnBorder[ye]);d.borderDoneWithNeighborZ[Z]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=d.canonical.z}for(const ye of K){const Le=d.featuresOnBorder[ye],ze=d.centroidData[Le.centroidDataIndex],qe=Le.borders[Z];let Xe;for(;_e<he.length;){Xe=ce.featuresOnBorder[he[_e]];const st=Xe.borders[fe];if(st[1]>qe[0]+3||st[0]>qe[0]-3)break;ce.showCentroid(Xe),_e++}if(Xe&&_e<he.length){const st=_e;let De=0;for(;!(Xe.borders[fe][0]>qe[1]-3)&&(De++,++_e!==he.length);)Xe=ce.featuresOnBorder[he[_e]];Xe=ce.featuresOnBorder[he[st]];let je=!1;if(De>=1){const Be=Xe.borders[fe];Math.abs(qe[0]-Be[0])<3&&Math.abs(qe[1]-Be[1])<3&&(De=1,je=!0,_e=st+1)}else if(De===0){d.showCentroid(Le);continue}const Te=ce.centroidData[Xe.centroidDataIndex];v&&je&&(((j=ze).flags|(H=Te).flags)&n.dW?(j.flags|=n.dW,H.flags|=n.dW):(j.flags&=2147483647,H.flags&=2147483647));const Ke=Le.intersectsCount()>1||Xe.intersectsCount()>1;if(De>1)_e=st,ze.centroidXY=Te.centroidXY=new n.P(0,0);else if(me&&me.dem&&!Ke){const Be=F[Z](ze,Te),it=Z%2?n.aj-1:0,ft=G(Be[0],Math.min(n.aj-1,Be[1]),it,me,re,Z<2,Be[2]);ze.centroidXY=Te.centroidXY=A(ft)}else Ke?ze.centroidXY=Te.centroidXY=new n.P(0,0):(ze.centroidXY=d.encodeBorderCentroid(Le),Te.centroidXY=ce.encodeBorderCentroid(Xe));d.writeCentroidToBuffer(ze),ce.writeCentroidToBuffer(Te)}else d.showCentroid(Le)}d.borderDoneWithNeighborZ[Z]=ce.canonical.z,ce.borderDoneWithNeighborZ[fe]=d.canonical.z}var j,H;(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(u)}const sg=[1,0,0],rg=[0,1,0],Ta=[0,0,1];function Sa(u,t,o){const d=o.transform,_=o.shadowRenderer;if(!_)return!0;const y=u.toUnwrapped(),v=d.tileSize*_._cascades[o.currentShadowCascade].scale;let S=t.maxHeight;if(d.elevation){const j=d.elevation.getMinMaxForTile(u);j&&(S+=j.max)}const A=[..._.shadowDirection];A[2]=-A[2];const P=_.computeSimplifiedTileShadowVolume(y,S,v,A);if(!P)return!1;const D=[sg,rg,Ta,A,[A[0],0,A[2]],[0,A[1],A[2]]],k=d.projection.name==="globe",z=d.scaleZoom(v),F=n.cn.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,z,!k),G=_.getCurrentCascadeFrustum();return F.intersectsPrecise(P.vertices,P.planes,D)===0||G.intersectsPrecise(P.vertices,P.planes,D)===0}function ti(u){return[u[0]*n.dZ,u[1]*n.dZ,u[2]*n.dZ,0]}function Dh(u,t,o,d,_,y,v,S,A){const P=d.getSource(),D=o.globeSharedBuffers;if(!D)return;let k,z,F;if(t&&(k=d.getTile(t)),P instanceof n.aP?(z=P.texture,F=n.ds(0,0,o.transform)):k&&t&&(z=k.texture,F=n.ds(t.canonical.z,t.canonical.x,o.transform)),!z||!F)return;u||(F=n.cE(n.bz(),F,[1,-1,1]));const G=o.context,j=G.gl,H=_.paint.get("raster-resampling")==="nearest"?j.NEAREST:j.LINEAR,Z=o.colorModeForDrapableLayerRenderPass(y),K=v.defines;K.push("GLOBE_POLES");const re=new It(j.LEQUAL,It.ReadWrite,o.depthRangeFor3D),ce=Float32Array.from(o.transform.expandedFarZProjMatrix),me=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0))));o.terrain&&o.terrain.prepareDrawTile(),G.activeTexture.set(j.TEXTURE0),z.bind(H,j.CLAMP_TO_EDGE),G.activeTexture.set(j.TEXTURE1),z.bind(H,j.CLAMP_TO_EDGE),"useMipmap"in z&&G.extTextureFilterAnisotropic&&o.transform.pitch>20&&j.texParameterf(j.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const[fe,ue,he,_e]=t?D.getPoleBuffers(t.canonical.z,!1):D.getPoleBuffers(0,!0),ye=_.paint.get("raster-elevation");let Le;u?(Le=fe,o.renderDefaultNorthPole=ye!==0):(Le=ue,o.renderDefaultSouthPole=ye!==0);const ze=ti(v.mix),qe=((st,De,je,Te,Ke,Be,it,ft,Ye,ut,Mt,Pt,Et)=>yp(st,De,je,new Float32Array(16),new Float32Array(9),[0,0],Te,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Be,[0,0],ft,2,ut,Mt,Pt,1,0,Et))(ce,me,F,n.ah(o.transform.zoom),0,_,0,ye,0,ze,v.offset,v.range,y),Xe=o.getOrCreateProgram("raster",{defines:K});o.uploadCommonUniforms(G,Xe,null),Xe.draw(o,j.TRIANGLES,re,A,Z,S,qe,_.id,Le,he,_e)}function Ev(u){const t=u._nearZ,o=u.projection.farthestPixelDistance(u),d=o-t,_=.2*u.height,y=t+_;return[t,o,(y-_-t)/d,(y-t)/d]}function Av(u,t,o,d){if(u)return t instanceof pa&&u instanceof Ul?t.getTextureDescriptor(u,o,!0):{texture:u.texture,mix:ti(d.mix),offset:d.offset,buffer:0,tileSize:1}}var Sp=n.d_([{name:"a_index",type:"Int16",components:1}]);class og{constructor(t,o,d,_){const y={width:d[0],height:d[1],data:null},v=t.gl;this.targetColorTexture=new n.T(t,y,v.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(t,y,v.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(o,_),this.lastInvalidatedAt=0}updateParticleTexture(t,o){if(this.particleTextureDimension===o.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,_=o.width*o.height;this.particleTexture0=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,o,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new n.d$;y.reserve(_);for(let v=0;v<_;v++)y.emplaceBack(v);this.particleIndexBuffer=this.context.createVertexBuffer(y,Sp.members,!0),this.particleSegment=n.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=o.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=n.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Iv(u,t,o){if(!u)return null;const d=t.getTextureDescriptor(u,o,!0);if(!d)return null;let{texture:_,mix:y,offset:v,tileSize:S,buffer:A,format:P}=d;if(!_||!P)return null;let D=!1;return P==="uint32"&&(D=!0,y[3]=0,y=pl(n.e0,y,[0,o.paint.get("raster-particle-max-speed")]),v=gp(n.e0,v,[0,o.paint.get("raster-particle-max-speed")])),{texture:_,textureOffset:[A/(S+2*A),S/(S+2*A)],tileSize:S,scalarData:D,scale:y,offset:v,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[P]]}}function ag(u){const t=u._nearZ,o=u.projection.farthestPixelDistance(u),d=o-t,_=.2*u.height,y=t+_;return[t,o,(y-_-t)/d,(y-t)/d]}const Cv=new n.am(1,0,0,1),Mv=new n.am(0,1,0,1),Ar=new n.am(0,0,1,1),Ep=new n.am(1,0,1,1),cr=new n.am(0,1,1,1);function Jo(u,t,o,d,_,y){for(let v=0;v<o.length;v++)if(_){const P=new n.am(d.r*.8,d.g*.8,d.b*.8,1);_l(u,t,o[v],d,-1,-1,y),_l(u,t,o[v],d,-1,1,y),_l(u,t,o[v],d,1,1,y),_l(u,t,o[v],d,1,-1,y),_l(u,t,o[v],P,0,0,y)}else _l(u,t,o[v],d,0,0,y)}function _l(u,t,o,d,_,y,v){const S=u.context,A=u.transform,P=S.gl,D=A.projection.name==="globe",k=D?["PROJECTION_GLOBE_VIEW"]:[];let z=n.bw(o.projMatrix);if(D&&n.ah(A.zoom)>0){const ze=n.bg(o.canonical,A),qe=n.e1(ze);z=n.az(new Float32Array(16),A.globeMatrix,qe),n.az(z,A.projMatrix,z)}const F=n.bz();F[12]+=2*_/(n.q.devicePixelRatio*A.width),F[13]+=2*y/(n.q.devicePixelRatio*A.height),n.az(z,F,z);const G=u.getOrCreateProgram("debug",{defines:k}),j=t.getTileByID(o.key);u.terrain&&u.terrain.setupElevationDraw(j,G);const H=It.disabled,Z=ci.disabled,K=u.colorModeForRenderPass(),re="$debug";S.activeTexture.set(P.TEXTURE0),u.emptyTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),D?j._makeGlobeTileDebugBuffers(u.context,A):j._makeDebugTileBoundsBuffers(u.context,A.projection);const ce=j._tileDebugBuffer||u.debugBuffer,me=j._tileDebugIndexBuffer||u.debugIndexBuffer,fe=j._tileDebugSegments||u.debugSegments;if(G.draw(u,P.LINE_STRIP,H,Z,K,ni.disabled,hd(z,d.toPremultipliedRenderColor(null)),re,ce,me,fe,null,null,null,[j._globeTileDebugBorderBuffer]),v){const ze=j.latestRawTileData,qe=Math.floor((ze&&ze.byteLength||0)/1024);let Xe=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(Xe+=` => ${o.overscaledZ}`),Xe+=` ${j.state}`,Xe+=` ${qe}kb`,function(st,De){st.initDebugOverlayCanvas();const je=st.debugOverlayCanvas,Te=st.context.gl,Ke=st.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,je.width,je.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(De,5,5),Ke.strokeText(De,5,5),st.debugOverlayTexture.update(je),st.debugOverlayTexture.bind(Te.LINEAR,Te.CLAMP_TO_EDGE)}(u,Xe)}const ue=t.getTile(o).tileSize,he=512/Math.min(ue,512)*(o.overscaledZ/A.zoom)*.5,_e=j._tileDebugTextBuffer||u.debugBuffer,ye=j._tileDebugTextIndexBuffer||u.quadTriangleIndexBuffer,Le=j._tileDebugTextSegments||u.debugSegments;G.draw(u,P.TRIANGLES,H,Z,Di.alphaBlended,ni.disabled,hd(z,n.am.transparent.toPremultipliedRenderColor(null),he),re,_e,ye,Le,null,null,null,[j._globeTileDebugTextBuffer])}function pd(u,t,o,d){cc(u,0,t+o/2,u.transform.width,o,d)}function md(u,t,o,d){cc(u,t-o/2,0,o,u.transform.height,d)}function cc(u,t,o,d,_,y){const v=u.context,S=v.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*n.q.devicePixelRatio,o*n.q.devicePixelRatio,d*n.q.devicePixelRatio,_*n.q.devicePixelRatio),v.clear({color:y}),S.disable(S.SCISSOR_TEST)}const lg=n.d_([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Qo}=lg;function gn(u,t,o,d){u.emplaceBack(t,o,d)}class Rh{constructor(t){this.vertexArray=new n.e2,this.indices=new n.a_,gn(this.vertexArray,-1,-1,1),gn(this.vertexArray,1,-1,1),gn(this.vertexArray,-1,1,1),gn(this.vertexArray,1,1,1),gn(this.vertexArray,-1,-1,-1),gn(this.vertexArray,1,-1,-1),gn(this.vertexArray,-1,1,-1),gn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Qo),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=n.bd.simpleSegment(0,0,36,12)}}function Ea(u,t,o,d,_,y){const v=u.context.gl,S=t.paint.get("sky-atmosphere-color"),A=t.paint.get("sky-atmosphere-halo-color"),P=t.paint.get("sky-atmosphere-sun-intensity"),D=((k,z,F,G,j)=>({u_matrix_3f:k,u_sun_direction:z,u_sun_intensity:F,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[j.r,j.g,j.b,j.a],u_luminance:5e-5}))(n.e4(n.dx(),d),_,P,S.toPremultipliedRenderColor(null),A.toPremultipliedRenderColor(null));v.framebufferTexture2D(v.FRAMEBUFFER,v.COLOR_ATTACHMENT0,v.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),o.draw(u,v.TRIANGLES,It.disabled,ci.disabled,Di.unblended,ni.frontCW,D,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const cg=n.d_([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class hg{constructor(t){const o=new n.e5;o.emplaceBack(-1,1,1,0,0),o.emplaceBack(1,1,1,1,0),o.emplaceBack(1,-1,1,1,1),o.emplaceBack(-1,-1,1,0,1);const d=new n.a_;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(o,cg.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=n.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const ug=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Pv{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class hc{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Di([1,al,1,al],n.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Di([1,0,1,0],n.am.transparent,[!1,!1,!1,!0]),this.params=new Pv,this.updateNeeded=!0,t.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),t.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),t.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(t){const o=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new hg(o);const d=this.params.sizeRange,_=this.params.intensityRange,y=function(D){const k=n.e7(30),z=[];for(let F=0;F<D;++F){const G=2*Math.PI*k(),j=Math.acos(1-2*k())-.5*Math.PI;z.push(n.cS(Math.cos(j)*Math.cos(G),Math.cos(j)*Math.sin(G),Math.sin(j)))}return z}(this.params.starsCount),v=n.e7(300),S=new n.e6,A=new n.a_;let P=0;for(let D=0;D<y.length;++D){const k=n.bY([],y[D],200),z=Math.max(0,1+.01*d*(1*v()-.5)),F=Math.max(0,1+.01*_*(1*v()-.5));S.emplaceBack(k[0],k[1],k[2],-1,-1,z,F),S.emplaceBack(k[0],k[1],k[2],1,-1,z,F),S.emplaceBack(k[0],k[1],k[2],1,1,z,F),S.emplaceBack(k[0],k[1],k[2],-1,1,z,F),A.emplaceBack(P+0,P+1,P+2),A.emplaceBack(P+0,P+2,P+3),P+=4}this.starsVx=o.createVertexBuffer(S,ug.members),this.starsIdx=o.createIndexBuffer(A),this.starsSegments=n.bd.simpleSegment(0,0,S.length,A.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,o){const d=t.context,_=d.gl,y=t.transform,v=new It(_.LEQUAL,It.ReadOnly,[0,1]),S=n.ah(y.zoom),A=t.style.getLut(o.scope),P=o.properties.get("color-use-theme")==="none",D=o.properties.get("color").toNonPremultipliedRenderColor(P?null:A).toArray01(),k=o.properties.get("high-color-use-theme")==="none",z=o.properties.get("high-color").toNonPremultipliedRenderColor(k?null:A).toArray01(),F=o.properties.get("space-color-use-theme")==="none",G=o.properties.get("space-color").toNonPremultipliedRenderColor(F?null:A).toArray01(),j=5e-4,H=n.e8(o.properties.get("horizon-blend"),0,1,j,.25),Z=n.dl(t,d,y)&&H===j?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,K=t.frameCounter/1e3%1,re=n.ae(y.globeCenterInViewSpace),ce=Math.sqrt(Math.pow(re,2)-Math.pow(Z,2)),me=Math.acos(ce/re),fe=ue=>{const he=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ue&&he.push("ALPHA_PASS");const _e=t.getOrCreateProgram("globeAtmosphere",{defines:he}),ye=((ze,qe,Xe,st,De,je,Te,Ke,Be,it,ft,Ye)=>({u_frustum_tl:ze,u_frustum_tr:qe,u_frustum_br:Xe,u_frustum_bl:st,u_horizon:De,u_transition:je,u_fadeout_range:Te,u_color:Ke,u_high_color:Be,u_space_color:it,u_temporal_offset:ft,u_horizon_angle:Ye}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,S,H,D,z,G,K,me);t.uploadCommonUniforms(d,_e);const Le=this.atmosphereBuffer;Le&&_e.draw(t,_.TRIANGLES,v,ci.disabled,ue?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,ni.backCW,ye,ue?"atmosphere_glow_alpha":"atmosphere_glow",Le.vertexBuffer,Le.indexBuffer,Le.segments)};fe(!1),fe(!0)}drawStars(t,o){const d=n.ay(o.properties.get("star-intensity"),0,1);if(d===0)return;const _=t.context,y=_.gl,v=t.transform,S=t.getOrCreateProgram("stars"),A=n.b_([]);n.c0(A,A,-v._pitch),n.b$(A,A,-v.angle),n.c0(A,A,n.al(v._center.lat)),n.e9(A,A,-n.al(v._center.lng));const P=n.c3(new Float32Array(16),A),D=n.az([],v.starsProjMatrix,P),k=n.e4([],P),z=n.ea([],k),F=[0,1,0];n.dz(F,F,z),n.bY(F,F,this.params.sizeMultiplier);const G=[1,0,0];n.dz(G,G,z),n.bY(G,G,this.params.sizeMultiplier);const j=(H=F,Z=G,K=d,{u_matrix:Float32Array.from(D),u_up:H,u_right:Z,u_intensity_multiplier:K});var H,Z,K;t.uploadCommonUniforms(_,S),this.starsVx&&this.starsIdx&&S.draw(t,y.TRIANGLES,It.disabled,ci.disabled,this.colorModeAlphaBlendedWriteRGB,ni.disabled,j,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function gl(u,t){const o=[...u],d=t.cameraWorldSizeForFog/t.worldSize,_=n.bx([]);return n.cE(_,_,[d,d,1]),n.az(o,_,o),n.az(o,t.worldToFogMatrix,o),o}function lt(u,t,o,d,_){const y=o.material,v=d.context,{baseColorTexture:S,metallicRoughnessTexture:A}=y.pbrMetallicRoughness,{normalTexture:P,occlusionTexture:D,emissionTexture:k}=y;function z(G,j,H){if(G&&(u.push(j),v.activeTexture.set(v.gl.TEXTURE0+H),G.gfxTexture)){const{minFilter:Z,magFilter:K,wrapS:re,wrapT:ce}=G.sampler;G.gfxTexture.bindExtraParam(Z,K,re,ce)}}z(S,"HAS_TEXTURE_u_baseColorTexture",lr.BaseColor),z(A,"HAS_TEXTURE_u_metallicRoughnessTexture",lr.MetallicRoughness),z(P,"HAS_TEXTURE_u_normalTexture",lr.Normal),z(D,"HAS_TEXTURE_u_occlusionTexture",lr.Occlusion),z(k,"HAS_TEXTURE_u_emissionTexture",lr.Emission),_&&(_.texture||(_.texture=new n.eh(d.context,_.image,[_.image.height,_.image.height,_.image.height],v.gl.RGBA8)),v.activeTexture.set(v.gl.TEXTURE0+lr.LUT),_.texture&&_.texture.bind(v.gl.LINEAR,v.gl.CLAMP_TO_EDGE),u.push("APPLY_LUT_ON_GPU")),o.texcoordBuffer&&(u.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(o.texcoordBuffer)),o.colorBuffer&&(u.push(o.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(o.colorBuffer)),o.normalBuffer&&(u.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(o.normalBuffer)),o.pbrBuffer&&(u.push("HAS_ATTRIBUTE_a_pbr"),u.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(o.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||u.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||u.push("DIFFUSE_SHADED");const F=d.shadowRenderer;F&&(u.push("RENDER_SHADOWS","DEPTH_TEXTURE"),F.useNormalOffset&&u.push("NORMAL_OFFSET"))}function St(u,t,o,d,_,y){const v=o.paint.get("model-opacity").constantOr(1),S=t.context,A=new It(t.context.gl.LEQUAL,It.ReadWrite,t.depthRangeFor3D),P=t.transform,D=u.mesh,k=D.material,z=k.pbrMetallicRoughness,F=t.style.fog;let G;G=t.transform.projection.zAxisUnit==="pixels"?[...u.nodeModelMatrix]:n.az([],d.zScaleMatrix,u.nodeModelMatrix),n.az(G,d.negCameraPosMatrix,G);const j=n.bi([],G);n.ee(j,j);const H=o.paint.get("model-color-use-theme").constantOr("default")==="none",Z=o.paint.get("model-emissive-strength").constantOr(0),K=Ch(new Float32Array(u.worldViewProjection),new Float32Array(G),new Float32Array(j),null,t,v,z.baseColorFactor,k.emissiveFactor,z.metallicFactor,z.roughnessFactor,k,Z,o),re={defines:[]},ce=[],me=t.shadowRenderer;me&&(me.useNormalOffset=!1),lt(re.defines,ce,D,t,H?null:o.lut);let fe=null;if(F){const _e=gl(u.nodeModelMatrix,t.transform);if(fe=new Float32Array(_e),P.projection.name!=="globe"){const ye=D.aabb.min,Le=D.aabb.max,[ze,qe]=F.getOpacityForBounds(_e,ye[0],ye[1],Le[0],Le[1]);re.overrideFog=ze>=Ve||qe>=Ve}}const ue=So(t,o.paint.get("model-cutoff-fade-range"));ue.shouldRenderCutoff&&re.defines.push("RENDER_CUTOFF");const he=t.getOrCreateProgram("model",re);t.uploadCommonUniforms(S,he,null,fe,ue),t.renderPass!=="shadow"&&me&&me.setupShadowsFromMatrix(u.nodeModelMatrix,he),he.draw(t,S.gl.TRIANGLES,A,_,y,D.material.doubleSided?ni.disabled:ni.backCCW,K,o.id,D.vertexBuffer,D.indexBuffer,D.segments,o.paint,t.transform.zoom,void 0,ce)}function yl(u,t,o,d,_,y,v){let S;S=u.projection.name==="globe"?n.ed(o,u):[...o],n.az(S,S,t.matrix);const A=n.az([],d,S);if(t.meshes)for(const P of t.meshes){if(P.material.alphaMode!=="BLEND"){v.push({mesh:P,depth:0,modelIndex:_,worldViewProjection:A,nodeModelMatrix:S});continue}const D=n.ad([],P.centroid,A);!u.isOrthographic&&D[2]<=0||y.push({mesh:P,depth:D[2],modelIndex:_,worldViewProjection:A,nodeModelMatrix:S})}if(t.children)for(const P of t.children)yl(u,P,o,d,_,y,v)}function Kn(u,t,o,d){const _=o.shadowRenderer;if(!_)return;const y=_.getShadowPassDepthMode(),v=_.getShadowPassColorMode(),S=_.calculateShadowPassMatrixFromMatrix(t),A=tg(S);o.getOrCreateProgram("modelDepth",{defines:o._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(o,o.context.gl.TRIANGLES,y,ci.disabled,v,ni.backCCW,A,d.id,u.vertexBuffer,u.indexBuffer,u.segments,d.paint,o.transform.zoom,void 0,void 0)}function Re(u,t,o){const d=t.updateZoomBasedPaintProperties(),_=function(y,v,S){let A,P,D,k=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&k>0){const z=y.terrain,F=z.findDEMTileFor(S);F&&F.dem?A=n.ei.create(z,S,F):k=0}if(k===0&&(v.terrainElevationMin=0,v.terrainElevationMax=0),k===v.validForExaggeration&&(k===0||A&&A._demTile&&A._demTile.tileID===v.validForDEMTile.id&&A._dem._timestamp===v.validForDEMTile.timestamp))return!1;for(const z in v.instancesPerModel){const F=v.instancesPerModel[z];for(let G=0;G<F.instancedDataArray.length;++G){const j=(A?k*A.getElevationAt(0|F.instancedDataArray.float32[16*G],0|F.instancedDataArray.float32[16*G+1],!0,!0):0)+F.instancesEvaluatedElevation[G];F.instancedDataArray.float32[16*G+6]=j,P=P?Math.min(v.terrainElevationMin,j):j,D=D?Math.max(v.terrainElevationMax,j):j}}return v.terrainElevationMin=P||0,v.terrainElevationMax=D||0,v.validForExaggeration=k,v.validForDEMTile=A&&A._demTile?{id:A._demTile.tileID,timestamp:A._dem._timestamp}:{id:void 0,timestamp:0},!0}(u,t,o);(d||_)&&(t.uploaded=!1,t.upload(u.context))}const ao={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.cW([0,0,0],[n.aj,n.aj,0])};function _d(u,t){const o=1<<u.canonical.z,d=t.getFreeCameraOptions().position,_=t.elevation,y=u.canonical.x/o,v=(u.canonical.x+1)/o,S=u.canonical.y/o,A=(u.canonical.y+1)/o;let P=t._centerAltitude;if(_){const F=_.getMinMaxForTile(u);F&&F.max>P&&(P=F.max)}const D=n.ay(d.x,y,v)-d.x,k=n.ay(d.y,S,A)-d.y,z=n.c6(P,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(D*D+k*k+z*z))}function gd(u,t,o,d,_,y,v){const S=u.context,A=u.renderPass==="shadow",P=u.shadowRenderer,D=A&&P?P.getShadowPassDepthMode():new It(S.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D),k=u.isTileAffectedByFog(y);if(o.meshes)for(const z of o.meshes){const F=["MODEL_POSITION_ON_GPU"],G=[];let j,H,Z;d.instancedDataArray.length>20&&F.push("INSTANCED_ARRAYS");const K=So(u,t.paint.get("model-cutoff-fade-range"));if(K.shouldRenderCutoff&&F.push("RENDER_CUTOFF"),A&&P)j=u.getOrCreateProgram("modelDepth",{defines:F}),H=tg(v.shadowTileMatrix,v.shadowTileMatrix,Float32Array.from(o.matrix)),Z=P.getShadowPassColorMode();else{lt(F,G,z,u,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),j=u.getOrCreateProgram("model",{defines:F,overrideFog:k});const ce=z.material,me=ce.pbrMetallicRoughness,fe=t.paint.get("model-opacity").constantOr(1),ue=t.paint.get("model-emissive-strength").constantOr(0);H=Ch(y.expandedProjMatrix,Float32Array.from(o.matrix),new Float32Array(16),null,u,fe,me.baseColorFactor,ce.emissiveFactor,me.metallicFactor,me.roughnessFactor,ce,ue,t,_),P&&(v.shadowUniformsInitialized?j.setShadowUniformValues(S,P.getShadowUniformValues()):(P.setupShadows(y.toUnwrapped(),j,"model-tile",y.overscaledZ),v.shadowUniformsInitialized=!0)),Z=K.shouldRenderCutoff||fe<1||ce.alphaMode!=="OPAQUE"?Di.alphaBlended:Di.unblended}u.uploadCommonUniforms(S,j,y.toUnwrapped(),null,K);const re=z.material.doubleSided?ni.disabled:ni.backCCW;if(d.instancedDataArray.length>20)G.push(d.instancedDataBuffer),j.draw(u,S.gl.TRIANGLES,D,ci.disabled,Z,re,H,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,u.transform.zoom,void 0,G,d.instancedDataArray.length);else{const ce=A?"u_instance":"u_normal_matrix";for(let me=0;me<d.instancedDataArray.length;++me)H[ce]=new Float32Array(d.instancedDataArray.arrayBuffer,64*me,16),j.draw(u,S.gl.TRIANGLES,D,ci.disabled,Z,re,H,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,u.transform.zoom,void 0,G)}}if(o.children)for(const z of o.children)gd(u,t,z,d,_,y,v)}const Ap=[1,-1,1];function dg(u,t,o,d){if(!o.modelManager)return!0;const _=o.modelManager;if(!o.shadowRenderer)return!0;const y=o.shadowRenderer,v=t.aabb;let S=!0,A=u.maxHeight;if(A===0){let D=0;for(const k in u.instancesPerModel){const z=_.getModel(k,d);z?D=Math.max(D,Math.max(Math.max(z.aabb.max[0],z.aabb.max[1]),z.aabb.max[2])):S=!1}A=u.maxScale*D*1.41+u.maxVerticalOffset,S&&(u.maxHeight=A)}v.max[2]=A,v.min[2]+=u.terrainElevationMin,v.max[2]+=u.terrainElevationMax,n.ad(v.min,v.min,t.tileMatrix),n.ad(v.max,v.max,t.tileMatrix);const P=v.intersects(y.getCurrentCascadeFrustum());return o.currentShadowCascade===0&&(u.isInsideFirstShadowMapFrustum=P===2),P===0}function fg(u,t){const o=u.uniformValues.u_cutoff_params[0],d=u.uniformValues.u_cutoff_params[1],_=u.uniformValues.u_cutoff_params[2],y=u.uniformValues.u_cutoff_params[3];return d===o||y===_?1:n.ay(((t-o)/(d-o)-_)/(y-_),0,1)}function uc(u,t,o,d){if(t.pitch<20)return 1;const _=t.getWorldToCameraMatrix();n.az(_,_,u);const y=n.ej(o.min[0],o.min[1],o.min[2],1);let v=n.aA(n.ek(),y,_),S=v,A=v;y[1]=o.max[1],v=n.aA(n.ek(),y,_),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A,y[0]=o.max[0],v=n.aA(n.ek(),y,_),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A,y[1]=o.min[1],v=n.aA(n.ek(),y,_),S=v[1]<S[1]?v:S,A=v[1]>A[1]?v:A;const P=n.ay(d[0],0,1),D=100*t.pixelsPerMeter*n.ay(d[1],0,1),k=n.ay(d[2],0,1),z=n.el(n.ek(),S,A,P),F=Math.tan(.5*t.fovX),G=-z[2]*F;if(D===0)return z[1]<-Math.abs(G)?k:1;const j=(-Math.abs(G)-z[1])/D,H=(K,re,ce)=>(1-ce)*K+ce*re,Z=n.ay(H(1,k,j),k,1);return H(1,Z,n.ay((t.pitch-20)/20,0,1))}class Dv{}class Rv{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,o,d){{const k=this._storage.get(o.id);if(k)return k.lastUsedFrameIdx=t,k.buf}const _=d.gl,y=_.getBufferParameter(_.ELEMENT_ARRAY_BUFFER,_.BUFFER_SIZE),v=new ArrayBuffer(y),S=new Int16Array(v);_.getBufferSubData(_.ELEMENT_ARRAY_BUFFER,0,new Int16Array(v));const A=new n.en;for(let k=0;k<y/2;k+=3){const z=S[k],F=S[k+1],G=S[k+2];A.emplaceBack(z,F),A.emplaceBack(F,G),A.emplaceBack(G,z)}const P=d.bindVertexArrayOES.current,D=new Dv;return D.buf=new Xr(d,A),D.lastUsedFrameIdx=t,this._storage.set(o.id,D),d.bindVertexArrayOES.set(P),D.buf}update(t){for(const[o,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(o))}destroy(){for(const[t,o]of this._storage)o.buf.destroy(),this._storage.delete(t)}}class pg{constructor(t){this.occluderSize=30,this.depthOffset=-1e-4,t.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),t.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const yd=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Ip{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Cp{constructor(t,o){this.revealStart=11,this.revealRange=2,t.registerParameter(this,[...o,"Reveal"],"revealStart",{min:0,max:17,step:.05}),t.registerParameter(this,[...o,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const mg=n.d_([{type:"Float32",name:"a_pos_2f",components:2}]);class xd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,o){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const v=new n.eo,S=new n.a_;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(1,1),v.emplaceBack(-1,1),S.emplaceBack(0,1,2),S.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(v,mg.members),this.vignetteIdx=t.context.createIndexBuffer(S)}const _=n.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const v={u_vignetteShape:(y={vignetteShape:[o.start,o.range,Math.pow(10,o.fadePower)],vignetteColor:[o.color.r,o.color.g,o.color.b,o.color.a*o.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,It.disabled,ci.disabled,Di.alphaBlended,ni.disabled,v,"vignette",this.vignetteVx,this.vignetteIdx,_)}var y}}class Lh{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,o){const d=t.getFreeCameraOptions().position,_=d.toAltitude(),y=d.toLngLat(),v=n.al(y.lng),S=n.al(y.lat),A=t.pixelsPerMeter/o,P=v*n.eq,D=n.eq*Math.log(Math.tan(Math.PI/4+S/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const k=-this._offsetYPrev+D,z=-this._elevationPrev+_;this._accumulatedOffsetX+=(-this._offsetXPrev+P)*A,this._accumulatedOffsetY+=k*A,this._accumulatedElevation+=z*A,this._offsetXPrev=P,this._offsetYPrev=D,this._elevationPrev=_}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function xl(u,t){return[-(u[0]-Math.floor(u[0]/t)*t),-(u[1]-Math.floor(u[1]/t)*t),-(u[2]-Math.floor(u[2]/t)*t)]}function Mp(u){const t=n.e7(1323123451230),o=[];for(let d=0;d<u;++d){const _=2*t()-1,y=2*t()-1,v=2*t()-1;o.push(n.cS(_,y,v))}return o}function Aa(u,t,o,d,_){const y=n.ay((_-o)/(d-o),0,1);return(1-y)*u+y*t}class nr{constructor(t){this._movement=new Lh,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new xd,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,o){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const _=d.starsProjMatrix,y=n.b_([]);n.c0(y,y,n.al(90)-d._pitch),n.b$(y,y,-d.angle);const v=n.c3(new Float32Array(16),y),S=n.ep(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),A=n.ee([],S),P=n.az([],A,v),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*o,this._prevTime=D,{projectionMatrix:_,modelviewMatrix:P}}}class Lv extends nr{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Cp(t.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const d=Mp(this.particlesCount),_=new n.er,y=new n.a_;let v=0;const S=n.e7(1323123451230);for(let A=0;A<d.length;++A){const P=d[A],D=[2*S()-1,S(),S(),S()];_.emplaceBack(P[0],P[1],P[2],-1,-1,...D),_.emplaceBack(P[0],P[1],P[2],1,-1,...D),_.emplaceBack(P[0],P[1],P[2],1,1,...D),_.emplaceBack(P[0],P[1],P[2],-1,1,...D),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=o.createVertexBuffer(_,yd.members),this.particlesIdx=o.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const o=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(o.revealStart>d)return;const _=Aa(0,1,o.revealStart,o.revealStart+o.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let v=[-y.direction.x,y.direction.y,-100];n.au(v,v);const S=structuredClone(this._vignetteParams);S.strength*=_,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),v=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,S.strength=1,S.color=structuredClone(t.style.rain.state.vignetteColor));const A=this.updateOnRender(t,y.timeFactor),P=t.context,D=P.gl,k=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new n.T(P,{width:t.width,height:t.height,data:null},D.RGBA8)),y.distortionStrength>0&&(P.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const z=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(P,z),P.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const F=[y.color.r,y.color.g,y.color.b,y.color.a],G=(j,H)=>{const Z=xl(this._movement.getPosition(),j),K=y.dropletSizeX,re=y.dropletSizeX*y.dropletSizeYScale,ce=t.width/2,me=t.height/2,fe=Aa(0,y.screenThinning.start,0,1,y.screenThinning.intensity),ue=Aa(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),he=Aa(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),_e=(ye={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Z,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:j,rainDropletSize:[K,re],distortionStrength:y.distortionStrength,rainDirection:v,color:F,screenSize:[k.width,k.height],thinningCenterPos:[ce,me],thinningShape:[fe,ue,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:he,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:H?0:1},{u_modelview:Float32Array.from(ye.modelview),u_projection:Float32Array.from(ye.projection),u_time:ye.time,u_cam_pos:ye.camPos,u_texScreen:0,u_velocityConeAperture:ye.velocityConeAperture,u_velocity:ye.velocity,u_boxSize:ye.boxSize,u_rainDropletSize:ye.rainDropletSize,u_distortionStrength:ye.distortionStrength,u_rainDirection:ye.rainDirection,u_color:ye.color,u_screenSize:ye.screenSize,u_thinningCenterPos:ye.thinningCenterPos,u_thinningShape:ye.thinningShape,u_thinningAffectedRatio:ye.thinningAffectedRatio,u_thinningParticleOffset:ye.thinningParticleOffset,u_shapeDirectionalPower:ye.shapeDirectionalPower,u_shapeNormalPower:ye.shapeNormalPower,u_mode:ye.mode});var ye;const Le=Math.round(y.intensity*this.particlesCount),ze=n.bd.simpleSegment(0,0,4*Le,2*Le);z.draw(t,D.TRIANGLES,It.disabled,ci.disabled,Di.alphaBlended,ni.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,ze)};y.distortionStrength>0&&G(y.boxSize,!0),G(y.boxSize,!1),this._vignette.draw(t,S)}}const zh=n.d_([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Nn extends nr{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Cp(t.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const o=t.context;if(!this.particlesVx){const d=Mp(this.particlesCount),_=new n.es,y=new n.a_;let v=0;const S=n.e7(1323123451230);for(let A=0;A<d.length;++A){const P=d[A],D=S(),k=S(),z=S(),F=[A/d.length,D,k,z],G=[S(),S()];_.emplaceBack(P[0],P[1],P[2],-1,-1,...F,...G),_.emplaceBack(P[0],P[1],P[2],1,-1,...F,...G),_.emplaceBack(P[0],P[1],P[2],1,1,...F,...G),_.emplaceBack(P[0],P[1],P[2],-1,1,...F,...G),y.emplaceBack(v+0,v+1,v+2),y.emplaceBack(v+0,v+2,v+3),v+=4}this.particlesVx=o.createVertexBuffer(_,zh.members),this.particlesIdx=o.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const o=structuredClone(this._params);let d=[-o.direction.x,o.direction.y,-100];n.au(d,d);const _=structuredClone(this._vignetteParams),y=o.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},v=t.transform.zoom;if(y.revealStart>v)return;const S=Aa(0,1,y.revealStart,y.revealStart+y.revealRange,v);_.strength*=S,o.overrideStyleParameters||(o.intensity=t.style.snow.state.density,o.timeFactor=t.style.snow.state.intensity,o.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),o.screenThinning.intensity=t.style.snow.state.centerThinning,o.billboardSize=2.79*t.style.snow.state.flakeSize,_.strength=1,_.color=structuredClone(t.style.snow.state.vignetteColor));const A=this.updateOnRender(t,o.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const P=t.context,D=P.gl,k=t.transform,z=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(P,z),((F,G,j)=>{const H=xl(this._movement.getPosition(),F),Z=k.width/2,K=k.height/2,re=Aa(0,j.screenThinning.start,0,1,j.screenThinning.intensity),ce=Aa(.001,j.screenThinning.range,0,1,j.screenThinning.intensity),me=Aa(0,j.screenThinning.particleOffset,0,1,j.screenThinning.intensity),fe=(ue={modelview:A.modelviewMatrix,projection:A.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:H,velocityConeAperture:j.velocityConeAperture,velocity:j.velocity,horizontalOscillationRadius:j.horizontalOscillationRadius,horizontalOscillationRate:j.horizontalOscillationRate,boxSize:F,billboardSize:1*j.billboardSize,simpleShapeParameters:[j.shapeFadeStart,j.shapeFadePower],screenSize:[k.width,k.height],thinningCenterPos:[Z,K],thinningShape:[re,ce,Math.pow(10,j.screenThinning.fadePower)],thinningAffectedRatio:j.screenThinning.affectedRatio,thinningParticleOffset:me,color:[j.color.r,j.color.g,j.color.b,j.color.a],direction:d},{u_modelview:Float32Array.from(ue.modelview),u_projection:Float32Array.from(ue.projection),u_time:ue.time,u_cam_pos:ue.camPos,u_velocityConeAperture:ue.velocityConeAperture,u_velocity:ue.velocity,u_horizontalOscillationRadius:ue.horizontalOscillationRadius,u_horizontalOscillationRate:ue.horizontalOscillationRate,u_boxSize:ue.boxSize,u_billboardSize:ue.billboardSize,u_simpleShapeParameters:ue.simpleShapeParameters,u_screenSize:ue.screenSize,u_thinningCenterPos:ue.thinningCenterPos,u_thinningShape:ue.thinningShape,u_thinningAffectedRatio:ue.thinningAffectedRatio,u_thinningParticleOffset:ue.thinningParticleOffset,u_particleColor:ue.color,u_direction:ue.direction});var ue;const he=Math.round(j.intensity*this.particlesCount),_e=n.bd.simpleSegment(0,0,4*he,2*he);this.particlesVx&&this.particlesIdx&&z.draw(t,D.TRIANGLES,It.disabled,ci.disabled,Di.alphaBlended,ni.disabled,fe,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(o.boxSize,0,o),this._vignette.draw(t,_)}}const Xi={symbol:function(u,t,o,d,_){if(u.renderPass!=="translucent")return;const y=ci.disabled,v=u.colorModeForRenderPass(),S=o.layout.get("text-variable-anchor"),A=o.layout.get("text-size-scale-range"),P=n.ay(u.scaleFactor,A[0],A[1]);S&&function(z,F,G,j,H,Z,K,re){const ce=F.transform,me=H==="map",fe=Z==="map";for(const ue of z){const he=j.getTile(ue),_e=he.getBucket(G);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const ye=n.bH(_e.textSizeData,ce.zoom,re),Le=Uu(ue,_e.getProjection(),ce),ze=ce.calculatePixelsToTileUnitsMatrix(he),qe=Ho(Le,he.tileID.canonical,fe,me,ce,_e.getProjection(),ze),Xe=_e.hasIconTextFit()&&_e.hasIconData();ye&&ng(_e,me,fe,K,ce,qe,ue,Math.pow(2,ce.zoom-he.tileID.overscaledZ),ye,Xe)}}(d,u,o,t,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),_,P);const D=o.paint.get("icon-opacity").constantOr(1)!==0,k=o.paint.get("text-opacity").constantOr(1)!==0;o.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||k)?ac(u,t,o,d,y,v):(D&&ac(u,t,o,d,y,v,{onlyIcons:!0}),k&&ac(u,t,o,d,y,v,{onlyText:!0})),t.map.showCollisionBoxes&&(dd(u,t,o,d,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),dd(u,t,o,d,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))},circle:function(u,t,o,d){if(u.renderPass!=="translucent")return;const _=o.paint.get("circle-opacity"),y=o.paint.get("circle-stroke-width"),v=o.paint.get("circle-stroke-opacity"),S=o.layout.get("circle-sort-key").constantOr(1)!==void 0,A=o.paint.get("circle-emissive-strength");if(_.constantOr(1)===0&&(y.constantOr(1)===0||v.constantOr(1)===0))return;const P=u.context,D=P.gl,k=u.transform,z=!(!u.terrain||!u.terrain.enabled),F=o.layout.get("circle-elevation-reference"),G=u.depthModeForSublayer(0,It.ReadOnly),j=new It(u.context.gl.LEQUAL,It.ReadOnly,u.depthRangeFor3D),H=F==="none"||z?G:j,Z=ci.disabled,K=u.colorModeForDrapableLayerRenderPass(A),re=k.projection.name==="globe",ce=[n.aD(k.center.lng),n.aH(k.center.lat)],me=[];for(let ue=0;ue<d.length;ue++){const he=d[ue],_e=t.getTile(he),ye=_e.getBucket(o);if(!ye||ye.projection.name!==k.projection.name)continue;const Le=ye.programConfigurations.get(o.id),ze=ye.layoutVertexBuffer,qe=ye.globeExtVertexBuffer,Xe=ye.indexBuffer,st=n.dK(o),De=[qe],je=u.isTileAffectedByFog(he);re&&st.push("PROJECTION_GLOBE_VIEW"),st.push("DEPTH_D24"),u.terrain&&k.depthOcclusionForSymbolsAndCircles&&st.push("DEPTH_OCCLUSION"),ye.hasElevation&&(st.push("ELEVATED_ROADS"),De.push(ye.elevatedLayoutVertexBuffer));const Te=u.getOrCreateProgram("circle",{config:Le,defines:st,overrideFog:je}),Ke=k.projection.createInversionMatrix(k,he.canonical),Be={programConfiguration:Le,program:Te,layoutVertexBuffer:ze,dynamicBuffers:De,indexBuffer:Xe,uniformValues:n.dL(u,he,_e,Ke,ce,o),tile:_e};if(S){const it=ye.segments.get();for(const ft of it)me.push({segments:new n.bd([ft]),sortKey:ft.sortKey,state:Be})}else me.push({segments:ye.segments,sortKey:0,state:Be})}S&&me.sort((ue,he)=>ue.sortKey-he.sortKey);const fe={useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles};for(const ue of me){const{programConfiguration:he,program:_e,layoutVertexBuffer:ye,dynamicBuffers:Le,indexBuffer:ze,uniformValues:qe,tile:Xe}=ue.state,st=ue.segments;u.terrain&&u.terrain.setupElevationDraw(Xe,_e,fe),u.uploadCommonUniforms(P,_e,Xe.tileID.toUnwrapped()),_e.draw(u,D.TRIANGLES,H,Z,K,ni.disabled,qe,o.id,ye,ze,st,o.paint,k.zoom,he,Le)}},heatmap:function(u,t,o,d){if(o.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){const _=u.context,y=_.gl,v=ci.disabled,S=new Di([y.ONE,y.ONE,y.ONE,y.ONE],n.am.transparent,[!0,!0,!0,!0]);(function(F,G,j,H){const Z=F.gl,K=G.width*H,re=G.height*H;F.activeTexture.set(Z.TEXTURE1),F.viewport.set([0,0,K,re]);let ce=j.heatmapFbo;if(!ce||ce&&(ce.width!==K||ce.height!==re)){ce&&ce.destroy();const me=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,me),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),ce=j.heatmapFbo=F.createFramebuffer(K,re,!0,null),function(fe,ue,he,_e,ye,Le){const ze=fe.gl;ze.texImage2D(ze.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,ye,Le,0,ze.RGBA,fe.extRenderToTextureHalfFloat?ze.HALF_FLOAT:ze.UNSIGNED_BYTE,null),_e.colorAttachment.set(he)}(F,0,me,ce,K,re)}else Z.bindTexture(Z.TEXTURE_2D,ce.colorAttachment.get()),F.bindFramebuffer.set(ce.framebuffer)})(_,u,o,u.transform.projection.name==="globe"?.5:.25),_.clear({color:n.am.transparent});const A=u.transform,P=A.projection.name==="globe",D=P?["PROJECTION_GLOBE_VIEW"]:[],k=P?ni.frontCCW:ni.disabled,z=[n.aD(A.center.lng),n.aH(A.center.lat)];for(let F=0;F<d.length;F++){const G=d[F];if(t.hasRenderableParent(G))continue;const j=t.getTile(G),H=j.getBucket(o);if(!H||H.projection.name!==A.projection.name)continue;const Z=u.isTileAffectedByFog(G),K=H.programConfigurations.get(o.id),re=u.getOrCreateProgram("heatmap",{config:K,defines:D,overrideFog:Z}),{zoom:ce}=u.transform;u.terrain&&u.terrain.setupElevationDraw(j,re),u.uploadCommonUniforms(_,re,G.toUnwrapped());const me=A.projection.createInversionMatrix(A,G.canonical);re.draw(u,y.TRIANGLES,It.disabled,v,S,k,J_(u,G,j,me,z,ce,o.paint.get("heatmap-intensity")),o.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,o.paint,u.transform.zoom,K,P?[H.globeExtVertexBuffer]:null)}_.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(_,y){const v=_.context,S=v.gl,A=y.heatmapFbo;if(!A)return;v.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,A.colorAttachment.get()),v.activeTexture.set(S.TEXTURE1);let P=y.colorRampTexture;P||(P=y.colorRampTexture=new n.T(v,y.colorRamp,S.RGBA8)),P.bind(S.LINEAR,S.CLAMP_TO_EDGE),_.getOrCreateProgram("heatmapTexture").draw(_,S.TRIANGLES,It.disabled,ci.disabled,_.colorModeForRenderPass(),ni.disabled,((D,k,z,F)=>({u_image:0,u_color_ramp:1,u_opacity:k.paint.get("heatmap-opacity")}))(0,y),y.id,_.viewportBuffer,_.quadTriangleIndexBuffer,_.viewportSegments,y.paint,_.transform.zoom)}(u,o))},line:function(u,t,o,d){if(u.renderPass!=="translucent")return;const _=o.paint.get("line-opacity"),y=o.paint.get("line-width");if(_.constantOr(1)===0||y.constantOr(1)===0)return;const v=o.paint.get("line-emissive-strength"),S=o.paint.get("line-occlusion-opacity"),A=o.layout.get("line-elevation-reference"),P=o.layout.get("line-width-unit")==="meters",D=A==="sea",k=!(!u.terrain||!u.terrain.enabled),z=u.context,F=z.gl;if(o.hasElevatedBuckets&&u.transform.projection.name==="globe")return;const G=o.layout.get("line-cross-slope"),j=G!==void 0,H=G<1,Z=u.colorModeForDrapableLayerRenderPass(v),K=u.terrain&&u.terrain.renderingToTexture,re=K?1:n.q.devicePixelRatio,ce=o.paint.get("line-dasharray"),me=ce.constantOr(1),fe=o.layout.get("line-cap"),ue=ce.constantOr(null),he=fe.constantOr(null),_e=o.paint.get("line-pattern"),ye=_e.constantOr(1),Le=o.paint.get("line-pattern-cross-fade"),ze=_e.constantOr(null),qe=o.paint.get("line-opacity").constantOr(1);let Xe=!ye&&qe!==1||u.depthOcclusion&&S>0&&S<1;const st=o.paint.get("line-gradient"),De=ye?"linePattern":"line",je=n.dM(o);let Te;if(K&&u.terrain&&u.terrain.clipOrMaskOverlapStencilType()&&(Xe=!1),S!==0&&u.depthOcclusion){const ft=o.paint._values["line-opacity"];ft&&ft.value&&ft.value.kind==="constant"?Te=ft.value:n.w(`Occlusion opacity for layer ${o.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&je.push("VARIABLE_LINE_WIDTH");const Ke=(ft,Ye,ut,Mt,Pt,Et)=>{for(const Ut of ft){const qt=t.getTile(Ut);if(ye&&!qt.patternsLoaded())continue;const ei=qt.getBucket(o);if(!ei||ei.elevationType!=="none"&&!Pt||ei.elevationType==="none"&&Pt)continue;u.prepareDrawTile();const ai=[...Ye],Ei=u.shadowRenderer,an=ei.elevationType==="road"&&!!Ei&&Ei.enabled;let In=[0,0,0];if(an){const $i=u.style.directionalLight,ds=u.style.ambientLight;$i&&ds&&(In=ll(u.style,$i,ds)),ai.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const un=ei.programConfigurations.get(o.id);let mn=!1;if(ze&&qt.imageAtlas){const $i=n.dN.from(ze),ds=$i.getPrimary().scaleSelf(re).toString(),Ln=qt.imageAtlas.patternPositions.get(ds),Tn=$i.getSecondary(),zn=Tn?qt.imageAtlas.patternPositions.get(Tn.scaleSelf(re).toString()):null;mn=!!Ln&&!!zn,Ln&&un.setConstantPatternPositions(Ln,zn)}Le>0&&(mn||un.getPatternTransitionVertexBuffer("line-pattern"))&&ai.push("LINE_PATTERN_TRANSITION");const os=u.isTileAffectedByFog(Ut),vi=u.getOrCreateProgram(De,{config:un,defines:ai,overrideFog:os,overrideRtt:!Pt&&void 0});if(!ye&&ue&&he&&qt.lineAtlas){const $i=qt.lineAtlas.getDash(ue,he);$i&&un.setConstantPatternPositions($i)}an&&Ei.setupShadows(qt.tileID.toUnwrapped(),vi,"vector-tile",qt.tileID.overscaledZ);let[Mi,Oi]=o.paint.get("line-trim-offset");(he==="round"||he==="square")&&Mi!==Oi&&(Mi===0&&(Mi-=1),Oi===1&&(Oi+=1));const Rn=K?Ut.projMatrix:null,_s=P?1/ei.tileToMeter/n.aw(qt,1,u.transform.zoom):1,Cn=P?1/ei.tileToMeter/n.aw(qt,1,Math.floor(u.transform.zoom)):1,Qi=ye?n.dO(u,qt,o,Rn,re,_s,Cn,[Mi,Oi],In,Le):n.dP(u,qt,o,Rn,ei.lineClipsArray.length,re,_s,Cn,[Mi,Oi],In);if(st){const $i=ei.gradients[o.id];let ds=$i.texture;if(o.gradientVersion!==$i.version){let Ln=256;if(o.stepInterpolant){const Tn=t.getSource().maxzoom,zn=Ut.canonical.z===Tn?Math.ceil(1<<u.transform.maxZoom-Ut.canonical.z):1;Ln=n.ay(n.dQ(ei.maxLineLength/n.aj*1024*zn),256,z.maxTextureSize)}$i.gradient=n.dR({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Ln,image:$i.gradient||void 0,clips:ei.lineClipsArray}),$i.texture?$i.texture.update($i.gradient):$i.texture=new n.T(z,$i.gradient,F.RGBA8),$i.version=o.gradientVersion,ds=$i.texture}z.activeTexture.set(F.TEXTURE1),ds.bind(o.stepInterpolant?F.NEAREST:F.LINEAR,F.CLAMP_TO_EDGE)}me&&(z.activeTexture.set(F.TEXTURE0),qt.lineAtlasTexture&&qt.lineAtlasTexture.bind(F.LINEAR,F.REPEAT),un.updatePaintBuffers()),ye&&(z.activeTexture.set(F.TEXTURE0),qt.imageAtlasTexture&&qt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),un.updatePaintBuffers()),Pt&&!D&&u.terrain.setupElevationDraw(qt,vi),u.uploadCommonUniforms(z,vi,Ut.toUnwrapped());const Jn=$i=>{Te!=null&&(Te.value=qe*S),vi.draw(u,F.TRIANGLES,ut,$i,Z,ni.disabled,Qi,o.id,ei.layoutVertexBuffer,ei.indexBuffer,ei.segments,o.paint,u.transform.zoom,un,[ei.layoutVertexBuffer2,ei.patternVertexBuffer,ei.zOffsetVertexBuffer]),Te!=null&&(Te.value=qe)};if(Xe&&!Pt){const $i=u.stencilModeForClipping(Ut).ref;$i===0&&K&&z.clear({stencil:0});const ds={func:F.EQUAL,mask:255};Qi.u_alpha_discard_threshold=.8,Jn(new ci(ds,$i,255,F.KEEP,F.KEEP,F.INVERT)),Qi.u_alpha_discard_threshold=0,Jn(new ci(ds,$i,255,F.KEEP,F.KEEP,F.KEEP))}else Qi.u_alpha_discard_threshold=Xe&&Pt&&Et?.8:0,Jn(Pt?Mt:u.stencilModeForClipping(Ut))}};let Be=u.depthModeForSublayer(0,It.ReadOnly);const it=new It(u.depthOcclusion?F.GREATER:F.LEQUAL,It.ReadOnly,u.depthRangeFor3D);if(o.hasNonElevatedBuckets){const ft=!K&&u.terrain;S!==0&&ft?n.w(`Occlusion opacity for layer ${o.id} is supported on terrain only if the layer has line-z-offset enabled.`):ft?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${o.id}.`):Ke(d,je,Be,ci.disabled,!1,!0)}if(o.hasElevatedBuckets){A==="hd-road-markup"?k||(Be=it,je.push("ELEVATED_ROADS")):(je.push("ELEVATED"),Be=it,j&&je.push(H?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&je.push("ELEVATION_REFERENCE_SEA"));const ft=Xe?u.stencilModeFor3D():ci.disabled;u.forceTerrainMode=!0,Ke(d,je,Be,ft,!0,!0),Xe&&Ke(d,je,Be,ft,!0,!1),u.forceTerrainMode=!1}Xe&&(u.resetStencilClippingMasks(),K&&z.clear({stencil:0})),S===0||u.depthOcclusion||K||u.layersWithOcclusionOpacity.push(u.currentLayer)},fill:function(u,t,o,d){const _=o.paint.get("fill-color"),y=o.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const v=o.paint.get("fill-emissive-strength"),S=u.colorModeForDrapableLayerRenderPass(v),A=o.paint.get("fill-pattern"),P=u.opaquePassEnabledForLayer()&&!A.constantOr(1)&&_.constantOr(n.am.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let D="none";o.layout.get("fill-elevation-reference")!=="none"?D="road":o.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const k=!(!u.terrain||!u.terrain.enabled),z={painter:u,sourceCache:t,layer:o,coords:d,colorMode:S,elevationType:D,terrainEnabled:k,pass:P};if(u.renderPass!=="shadow")if(D!=="offset"){if(Tp(z,!1),D==="road"){const F=!k&&u.renderPass==="translucent";F&&wp(u,t,o,d,"geometry"),Tp(z,!0,ci.disabled),F&&function(G){const{painter:j,sourceCache:H,layer:Z,coords:K,colorMode:re}=G,ce=j.context.gl,me=G.painter.shadowRenderer,fe=!!me&&me.enabled,ue=new It(j.context.gl.LEQUAL,It.ReadOnly,j.depthRangeFor3D);let he=[0,0,0];if(fe){const ye=j.style.directionalLight,Le=j.style.ambientLight;ye&&Le&&(he=ll(j.style,ye,Le))}const _e=ye=>{for(const Le of K){const ze=H.getTile(Le),qe=ze.getBucket(Z);if(!qe)continue;const Xe=qe.elevatedStructures;if(!Xe)continue;let st,De;if(ye?(st=Xe.renderableBridgeSegments,De=Xe.bridgeProgramConfigurations.get(Z.id)):(st=Xe.renderableTunnelSegments,De=Xe.tunnelProgramConfigurations.get(Z.id)),!st||st.segments[0].primitiveLength===0)continue;De.updatePaintBuffers(),j.prepareDrawTile();const je=j.isTileAffectedByFog(Le),Te=[];fe&&Te.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ke=j.getOrCreateProgram("elevatedStructures",{config:De,overrideFog:je,defines:Te}),Be=j.translatePosMatrix(Le.projMatrix,ze,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));fe&&me.setupShadows(ze.tileID.toUnwrapped(),Ke,"vector-tile",ze.tileID.overscaledZ);const it=vv(Be,he);j.uploadCommonUniforms(j.context,Ke,Le.toUnwrapped()),Ke.draw(j,ce.TRIANGLES,ue,ci.disabled,re,ni.backCCW,it,Z.id,Xe.vertexBuffer,Xe.indexBuffer,st,Z.paint,j.transform.zoom,De,[Xe.vertexBufferNormal])}};_e(!0),_e(!1)}(z)}}else Tp(z,!1,u.stencilModeFor3D());else u.shadowRenderer&&D==="road"&&!k&&function(F){const{painter:G,sourceCache:j,layer:H,coords:Z}=F,K=G.context.gl,re=F.painter.shadowRenderer;for(const ce of Z){const me=j.getTile(ce),fe=me.getBucket(H);if(!fe)continue;const ue=fe.elevatedStructures;if(!ue||!ue.shadowCasterSegments||ue.shadowCasterSegments.segments[0].primitiveLength===0)continue;G.prepareDrawTile();const he=fe.bufferData.programConfigurations.get(H.id),_e=G.isTileAffectedByFog(ce),ye=G.getOrCreateProgram("elevatedStructuresDepth",{config:he,overrideFog:_e}),Le=re.calculateShadowPassMatrixFromTile(me.tileID.toUnwrapped());G.uploadCommonUniforms(G.context,ye,ce.toUnwrapped());const ze={u_matrix:Le,u_depth_bias:.001};ye.draw(G,K.TRIANGLES,re.getShadowPassDepthMode(),ci.disabled,re.getShadowPassColorMode(),ni.disabled,ze,H.id,ue.vertexBuffer,ue.indexBuffer,ue.shadowCasterSegments,H.paint,G.transform.zoom,he)}}(z)},"fill-extrusion":function(u,t,o,d){const _=o.paint.get("fill-extrusion-opacity"),y=u.context,v=y.gl,S=u.terrain,A=S&&S.renderingToTexture;if(_===0)return;const P=u.conflationActive&&u.style.isLayerClipped(o,t.getSource()),D=u.style.order.indexOf(o.fqid);if(P&&function(k,z,F,G,j){for(const H of G){const Z=z.getTile(H).getBucket(F);Z&&(Z.updateReplacement(H,k.replacementSource,j),Z.uploadCentroid(k.context))}}(u,t,o,d,D),S||P)for(const k of d){const z=t.getTile(k).getBucket(o);z&&Ct(u.context,t,k,z,o,S,P)}if(u.renderPass==="shadow"&&u.shadowRenderer){const k=u.shadowRenderer;if(S&&_<.65&&o._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ab)return;const z=k.getShadowPassDepthMode(),F=k.getShadowPassColorMode();Yo(u,t,o,d,z,ci.disabled,F,P)}else if(u.renderPass==="translucent"){const k=!o.paint.get("fill-extrusion-pattern").constantOr(1),z=o.paint.get("fill-extrusion-color").constantOr(n.am.white);if(!A&&z.a!==0){const F=new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D);_===1&&k?Yo(u,t,o,d,F,ci.disabled,Di.unblended,P):(Yo(u,t,o,d,F,ci.disabled,Di.disabled,P),Yo(u,t,o,d,F,u.stencilModeFor3D(),u.colorModeForRenderPass(),P),u.resetStencilClippingMasks())}if(u.style.enable3dLights()&&k&&(!S&&u.transform.projection.name!=="globe"||A)){const F=o.paint.get("fill-extrusion-opacity"),G=o.paint.get("fill-extrusion-ambient-occlusion-intensity"),j=o.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),H=o.paint.get("fill-extrusion-flood-light-intensity"),Z=o.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",K=o.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:o.lut).toArray01().slice(0,3),re=G>0&&j>0,ce=H>0,me=(ue,he,_e)=>(1-_e)*ue+_e*he,fe=ue=>{const he=u.depthModeForSublayer(1,It.ReadOnly,v.LEQUAL,!0),_e=o.paint.get(ue?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ye=me(.1,3,_e),Le=u._showOverdrawInspector;if(!Le){const ze=new ci({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),qe=new Di([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0],v.MIN);Ko(u,t,o,d,he,ze,qe,ni.disabled,ue,"sdf",F,G,j,H,K,ye,P,!1)}{const ze=Le?ci.disabled:new ci({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),qe=Le?u.colorModeForRenderPass():new Di([v.ONE_MINUS_DST_ALPHA,v.DST_ALPHA,v.ONE,v.ONE],n.am.transparent,[!0,!0,!0,!0]);Ko(u,t,o,d,he,ze,qe,ni.disabled,ue,"color",F,G,j,H,K,ye,P,!1)}};if(A){const ue=(he,_e,ye)=>{const Le=u.depthModeForSublayer(1,It.ReadOnly,v.LEQUAL,!1),ze=o.paint.get(he?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),qe=me(.1,3,ze);{const Xe=new Di([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0]);Ko(u,t,o,d,Le,ci.disabled,Xe,ni.disabled,he,"clear",F,G,j,H,K,qe,P,_e)}{const Xe=new ci({func:v.ALWAYS,mask:255},255,255,v.KEEP,v.KEEP,v.REPLACE),st=new Di([v.ONE,v.ONE,v.ONE,v.ONE],n.am.transparent,[!1,!1,!1,!0],v.MIN);Ko(u,t,o,d,Le,Xe,st,ni.disabled,he,"sdf",F,G,j,H,K,qe,P,_e)}{const Xe=he?v.ZERO:v.ONE_MINUS_DST_ALPHA,st=new ci({func:v.EQUAL,mask:255},255,255,v.KEEP,v.DECR,v.DECR),De=new Di([Xe,v.DST_ALPHA,v.ONE_MINUS_DST_ALPHA,v.ZERO],n.am.transparent,[!0,!0,!0,!0]);Ko(u,t,o,d,Le,st,De,ni.disabled,he,"color",F,G,j,H,K,qe,P,_e)}{const Xe=new Di([v.ONE,v.ONE,v.ONE,he?v.ZERO:v.ONE],n.am.transparent,[!1,!1,!1,!0],he?v.FUNC_ADD:v.MAX);Ko(u,t,o,d,Le,ci.disabled,Xe,ni.disabled,he,"clear",F,G,j,H,K,qe,P,_e,ye)}};if(re||ce){let he;if(u.prepareDrawTile(),S){const _e=S.drapeBufferSize[0],ye=S.drapeBufferSize[1];he=S.framebufferCopyTexture,he&&(!he||he.size[0]===_e&&he.size[1]===ye)||(he&&he.destroy(),he=S.framebufferCopyTexture=new n.T(y,new n.r({width:_e,height:ye}),v.RGBA8)),he.bind(v.LINEAR,v.CLAMP_TO_EDGE),v.copyTexSubImage2D(v.TEXTURE_2D,0,0,0,0,0,_e,ye)}re&&ue(!0,!1,he),ce&&ue(!1,!0,he)}}else re&&fe(!0),ce&&fe(!1),(re||ce)&&u.resetStencilClippingMasks()}}},building:function(u,t,o,d){},hillshade:function(u,t,o,d){if(u.renderPass!=="offscreen"&&u.renderPass!=="translucent"||u.style.disableElevatedTerrain)return;const _=u.context,y=u.terrain&&u.terrain.renderingToTexture,[v,S]=u.renderPass!=="translucent"||y?[{},d]:u.stencilConfigForOverlap(d);for(const A of S){const P=t.getTile(A);if(P.needsHillshadePrepare&&u.renderPass==="offscreen")lv(u,P,o);else if(u.renderPass==="translucent"){const D=u.depthModeForSublayer(0,It.ReadOnly),k=o.paint.get("hillshade-emissive-strength"),z=u.colorModeForDrapableLayerRenderPass(k),F=y&&u.terrain?u.terrain.stencilModeForRTTOverlap(A):v[A.overscaledZ];av(u,A,P,o,D,F,z)}}_.viewport.set([0,0,u.width,u.height]),u.resetStencilClippingMasks()},raster:function(u,t,o,d,_,y){if(u.renderPass!=="translucent"||o.paint.get("raster-opacity")===0)return;const v=u.transform.projection.name==="globe",S=o.paint.get("raster-elevation")!==0,A=S&&v;if(u.renderElevatedRasterBackface&&!A)return;const P=u.context,D=P.gl,k=t.getSource(),z=function(fe,ue,he,_e){const ye=ue.paint.get("raster-color"),Le=fe.type==="raster-array",ze=[],qe=ue.paint.get("raster-resampling"),Xe=ue.paint.get("raster-color-mix");let st=ue.paint.get("raster-color-range");const De=[Xe[0],Xe[1],Xe[2],0],je=Xe[3];let Te=qe==="nearest"?_e.NEAREST:_e.LINEAR;if(Le&&(ze.push("RASTER_ARRAY"),ye||ze.push("RASTER_COLOR"),qe==="linear"&&ze.push("RASTER_ARRAY_LINEAR"),Te=_e.NEAREST,!st&&fe.rasterLayers)){const Ke=fe.rasterLayers.find(({id:Be})=>Be===ue.sourceLayer);Ke&&Ke.fields&&Ke.fields.range&&(st=Ke.fields.range)}if(st=st||[0,1],ye){ze.push("RASTER_COLOR"),he.activeTexture.set(_e.TEXTURE2),ue.updateColorRamp(st);let Ke=ue.colorRampTexture;Ke||(Ke=ue.colorRampTexture=new n.T(he,ue.colorRamp,_e.RGBA8)),Ke.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:De,range:st,offset:je,defines:ze,resampling:Te}}(k,o,P,D);if(k instanceof n.aP&&!d.length&&!v)return;const F=o.paint.get("raster-emissive-strength"),G=u.colorModeForDrapableLayerRenderPass(F),j=u.terrain&&u.terrain.renderingToTexture,H=!u.options.moving,Z=o.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(k instanceof n.aP&&!d.length&&(k.onNorthPole||k.onSouthPole)){const fe=S?u.stencilModeFor3D():ci.disabled;return void Dh(!!k.onNorthPole,null,u,t,o,F,z,ni.disabled,fe)}if(!d.length)return;const[K,re]=k instanceof n.aP||j?[{},d]:u.stencilConfigForOverlap(d),ce=re[re.length-1].overscaledZ;A&&z.defines.push("PROJECTION_GLOBE_VIEW"),S&&z.defines.push("RENDER_CUTOFF");const me=(fe,ue,he)=>{for(const _e of fe){const ye=_e.toUnwrapped(),Le=t.getTile(_e);if(j&&(!Le||!Le.hasData()))continue;P.activeTexture.set(D.TEXTURE0);const ze=Av(Le,k,o,z);if(!ze||!ze.texture)continue;const{texture:qe,mix:Xe,offset:st,tileSize:De,buffer:je}=ze;let Te,Ke;j?(Te=It.disabled,Ke=_e.projMatrix):S?(Te=new It(D.LEQUAL,It.ReadWrite,u.depthRangeFor3D),Ke=v?Float32Array.from(u.transform.expandedFarZProjMatrix):u.transform.calculateProjMatrix(ye,H)):(Te=u.depthModeForSublayer(_e.overscaledZ-ce,o.paint.get("raster-opacity")===1?It.ReadWrite:It.ReadOnly,D.LESS),Ke=u.transform.calculateProjMatrix(ye,H));const Be=u.terrain&&j?u.terrain.stencilModeForRTTOverlap(_e):K[_e.overscaledZ],it=y?0:o.paint.get("raster-fade-duration");Le.registerFadeDuration(it);const ft=t.findLoadedParent(_e,0),Ye=dl(Le,ft,t,u.transform,it);let ut,Mt;u.terrain&&u.terrain.prepareDrawTile(),P.activeTexture.set(D.TEXTURE0),qe.bind(Z,D.CLAMP_TO_EDGE),P.activeTexture.set(D.TEXTURE1),ft?(ft.texture&&ft.texture.bind(Z,D.CLAMP_TO_EDGE),ut=Math.pow(2,ft.tileID.overscaledZ-Le.tileID.overscaledZ),Mt=[Le.tileID.canonical.x*ut%1,Le.tileID.canonical.y*ut%1]):qe.bind(Z,D.CLAMP_TO_EDGE),"useMipmap"in qe&&P.extTextureFilterAnisotropic&&u.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Pt=u.transform;let Et;const Ut=S?Ev(Pt):[0,0,0,0];let qt,ei,ai,Ei,an,In=0;if(A&&k instanceof n.aP&&k.coordinates.length>3)qt=Float32Array.from(n.bh(n.dr(new n.cp(0,0,0)))),ei=Float32Array.from(Pt.globeMatrix),ai=Float32Array.from(n.dm(Pt)),Ei=[n.aD(Pt.center.lng),n.aH(Pt.center.lat)],Et=k.elevatedGlobePerspectiveTransform,an=k.elevatedGlobeGridMatrix||new Float32Array(9);else if(A){const vi=n.dn(_e.canonical);In=n.dp(vi.getCenter().lat),qt=Float32Array.from(n.bh(n.dr(_e.canonical))),ei=Float32Array.from(Pt.globeMatrix),ai=Float32Array.from(n.dm(Pt)),Ei=[n.aD(Pt.center.lng),n.aH(Pt.center.lat)],Et=[0,0],an=Float32Array.from(n.dq(_e.canonical,vi,In,Pt.worldSize/Pt._pixelsPerMercatorPixel))}else Et=k instanceof n.aP?k.perspectiveTransform:[0,0],qt=new Float32Array(16),ei=new Float32Array(9),ai=new Float32Array(16),Ei=[0,0],an=new Float32Array(9);const un=yp(Ke,qt,ei,ai,an,Mt||[0,0],n.ah(u.transform.zoom),Ei,Ut,ut||1,Ye,o,Et,S?o.paint.get("raster-elevation"):0,2,Xe,st,z.range,De,je,F),mn=u.isTileAffectedByFog(_e),os=u.getOrCreateProgram("raster",{defines:z.defines,overrideFog:mn});if(u.uploadCommonUniforms(P,os,ye),k instanceof n.aP){const vi=k.elevatedGlobeVertexBuffer,Mi=k.elevatedGlobeIndexBuffer;if(j||!v)k.boundsBuffer&&k.boundsSegments&&os.draw(u,D.TRIANGLES,Te,ci.disabled,G,ni.disabled,un,o.id,k.boundsBuffer,u.quadTriangleIndexBuffer,k.boundsSegments);else if(vi&&Mi){const Oi=Pt.zoom<=n.cL?k.elevatedGlobeSegments:k.getSegmentsForLongitude(Pt.center.lng);Oi&&os.draw(u,D.TRIANGLES,Te,ci.disabled,G,ue,un,o.id,vi,Mi,Oi)}}else if(A){Te=new It(D.LEQUAL,It.ReadOnly,u.depthRangeFor3D);const vi=u.globeSharedBuffers;if(vi){const[Mi,Oi,Rn]=vi.getGridBuffers(In,!1);os.draw(u,D.TRIANGLES,Te,he||Be,u.colorModeForRenderPass(),ue,un,o.id,Mi,Oi,Rn)}}else{const{tileBoundsBuffer:vi,tileBoundsIndexBuffer:Mi,tileBoundsSegments:Oi}=u.getTileBoundsBuffers(Le);os.draw(u,D.TRIANGLES,Te,Be,G,ni.disabled,un,o.id,vi,Mi,Oi)}}if(!(k instanceof n.aP)&&A)for(const _e of fe){const ye=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&Dh(!0,_e,u,t,o,F,z,ue,he||ci.disabled),ye&&Dh(!1,_e,u,t,o,F,z,ue===ni.frontCW?ni.backCW:ni.frontCW,he||ci.disabled)}};A?me(re,u.renderElevatedRasterBackface?ni.backCW:ni.frontCW,u.stencilModeFor3D()):me(re,ni.disabled,void 0),u.resetStencilClippingMasks()},"raster-particle":function(u,t,o,d,_,y){u.renderPass==="offscreen"&&function(v,S,A,P){if(!P.length)return;const D=v.context,k=D.gl,z=S.getSource();if(!(z instanceof pa))return;const F=Math.ceil(Math.sqrt(A.paint.get("raster-particle-count")));let G=A.particlePositionRGBAImage;if(!G||G.width!==F){const re=function(ce){const me=ce*ce,fe=new Uint8Array(4*me),ue=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},he=1/1.1;for(let _e=0;_e<me;_e++){const ye=he*(ue(2*_e+0)+ba),Le=he*(ue(2*_e+1)+ba),ze=255*ye%1,qe=255*Le%1,Xe=ze,st=Le-qe/255,De=qe;fe[4*_e+0]=255*(ye-ze/255),fe[4*_e+1]=255*Xe,fe[4*_e+2]=255*st,fe[4*_e+3]=255*De}return fe}(F);G=A.particlePositionRGBAImage=new n.r({width:F,height:F},re)}let j=A.particleFramebuffer;j?j.width!==F&&(j.destroy(),j=A.particleFramebuffer=D.createFramebuffer(F,F,!0,null)):j=A.particleFramebuffer=D.createFramebuffer(F,F,!0,null);const H=[];for(const re of P){const ce=S.getTile(re);if(!(ce instanceof Ul))continue;const me=Iv(ce,z,A);if(!me)continue;const fe=[ce.tileSize,ce.tileSize];let ue=A.tileFramebuffer;ue||(ue=A.tileFramebuffer=D.createFramebuffer(fe[0],fe[1],!0,null));let he=ce.rasterParticleState;he||(he=ce.rasterParticleState=new og(D,re,fe,G));const _e=he.update(A.lastInvalidatedAt);he.particleTextureDimension!==F&&he.updateParticleTexture(re,G);const ye=he.targetColorTexture;he.targetColorTexture=he.backgroundColorTexture,he.backgroundColorTexture=ye;const Le=he.particleTexture0;he.particleTexture0=he.particleTexture1,he.particleTexture1=Le,H.push([re,me,he,_e])}if(H.length===0)return;const Z=n.q.now(),K=A.previousDrawTimestamp?.001*(Z-A.previousDrawTimestamp):.0167;if(A.previousDrawTimestamp=Z,A.hasColorMap()){D.activeTexture.set(k.TEXTURE0+2);let re=A.colorRampTexture;re||(re=A.colorRampTexture=new n.T(D,A.colorRamp,k.RGBA8)),re.bind(k.LINEAR,k.CLAMP_TO_EDGE)}D.bindFramebuffer.set(A.tileFramebuffer.framebuffer),function(re,ce,me){const fe=re.context,ue=fe.gl,he=ce.tileFramebuffer;fe.activeTexture.set(ue.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(Le=ce.paint.get("raster-particle-fade-opacity-factor"))/(Le+.05)},ye=re.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Le;for(const ze of me){const[,,qe,Xe]=ze;he.colorAttachment.set(qe.targetColorTexture.texture),fe.viewport.set([0,0,he.width,he.height]),fe.clear({color:n.am.transparent}),Xe&&(qe.backgroundColorTexture.bind(ue.NEAREST,ue.CLAMP_TO_EDGE),ye.draw(re,ue.TRIANGLES,It.disabled,ci.disabled,Di.alphaBlended,ni.disabled,_e,ce.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments))}}(v,A,H),function(re,ce,me,fe){const ue=re.context,he=ue.gl,_e=me.tileFramebuffer,ye=re.transform.projection.name==="globe",Le=me.paint.get("raster-particle-max-speed");for(const ze of fe){const[qe,Xe,st]=ze;ue.activeTexture.set(he.TEXTURE0+0),Xe.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),_e.colorAttachment.set(st.targetColorTexture.texture);const De=re.getOrCreateProgram("rasterParticleDraw",{defines:Xe.defines,overrideFog:!1});ue.activeTexture.set(he.TEXTURE0+1);const je=Xe.scalarData?[]:[0,1,2,3].map(Be=>n.dT[Be](qe));je.push(qe);const Te=qe.canonical.x,Ke=qe.canonical.y;for(const Be of je){const it=ce.getTile(ye?Be.wrapped():Be);if(!it)continue;const ft=it.rasterParticleState;if(!ft)continue;const Ye=Be.canonical.x+(1<<Be.canonical.z)*(Be.wrap-qe.wrap),ut=Be.canonical.y;ft.particleTexture0.bind(he.NEAREST,he.CLAMP_TO_EDGE);const Mt=eg(1,ft.particleTexture0.size[0],[Ye-Te,ut-Ke],0,Xe.texture.size,2,Le,Xe.textureOffset,Xe.scale,Xe.offset);De.draw(re,he.POINTS,It.disabled,ci.disabled,Di.alphaBlended,ni.disabled,Mt,me.id,ft.particleIndexBuffer,void 0,ft.particleSegment)}}}(v,S,A,H),D.bindFramebuffer.set(A.particleFramebuffer.framebuffer),function(re,ce,me,fe){const ue=re.context,he=ue.gl,_e=ce.paint.get("raster-particle-max-speed"),ye=fe*ce.paint.get("raster-particle-speed-factor")*.15,Le=function(qe){return Math.pow(qe,6)}(.01+1*ce.paint.get("raster-particle-reset-rate-factor")),ze=ce.particleFramebuffer;ue.viewport.set([0,0,ze.width,ze.height]);for(const qe of me){const[,Xe,st]=qe;ue.activeTexture.set(he.TEXTURE0+0),Xe.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE),ue.activeTexture.set(he.TEXTURE0+1);const De=st.particleTexture0;De.bind(he.NEAREST,he.CLAMP_TO_EDGE);const je=wa(1,De.size[0],0,Xe.texture.size,_e,ye,Le,Xe.textureOffset,Xe.scale,Xe.offset);ze.colorAttachment.set(st.particleTexture1.texture),ue.clear({color:n.am.transparent}),re.getOrCreateProgram("rasterParticleUpdate",{defines:Xe.defines}).draw(re,he.TRIANGLES,It.disabled,ci.disabled,Di.unblended,ni.disabled,je,ce.id,re.viewportBuffer,re.quadTriangleIndexBuffer,re.viewportSegments)}}(v,A,H,K)}(u,t,o,d),u.renderPass==="translucent"&&(function(v,S,A,P,D){const k=v.context,z=k.gl,F=S.getSource().tileSize,G=5*(1-n.af(n.cx,n.cx+1,v.transform.zoom))*F+A.paint.get("raster-particle-elevation"),j=!v.options.moving,H=v.transform.projection.name==="globe";if(!P.length)return;const[Z,K]=v.stencilConfigForOverlap(P),re=[];H&&re.push("PROJECTION_GLOBE_VIEW");const ce=v.stencilModeFor3D();for(const me of K){const fe=me.toUnwrapped(),ue=S.getTile(me);if(!ue.rasterParticleState)continue;const he=ue.rasterParticleState,_e=100;ue.registerFadeDuration(_e);const ye=S.findLoadedParent(me,0),Le=dl(ue,ye,S,v.transform,_e);let ze,qe;v.terrain&&v.terrain.prepareDrawTile(),k.activeTexture.set(z.TEXTURE0),he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),k.activeTexture.set(z.TEXTURE1),ye&&ye.rasterParticleState?(ye.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),ze=Math.pow(2,ye.tileID.overscaledZ-ue.tileID.overscaledZ),qe=[ue.tileID.canonical.x*ze%1,ue.tileID.canonical.y*ze%1]):he.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Xe=H?Float32Array.from(v.transform.expandedFarZProjMatrix):v.transform.calculateProjMatrix(fe,j),st=v.transform,De=ag(st),je=n.dn(me.canonical),Te=n.dp(je.getCenter().lat);let Ke,Be,it,ft,Ye;H?(Ke=Float32Array.from(n.bh(n.dr(me.canonical))),Be=Float32Array.from(st.globeMatrix),it=Float32Array.from(n.dm(st)),ft=[n.aD(st.center.lng),n.aH(st.center.lat)],Ye=Float32Array.from(n.dq(me.canonical,je,Te,st.worldSize/st._pixelsPerMercatorPixel))):(Ke=new Float32Array(16),Be=new Float32Array(9),it=new Float32Array(16),ft=[0,0],Ye=new Float32Array(9));const ut=ml(Xe,Ke,Be,it,Ye,qe||[0,0],n.ah(v.transform.zoom),ft,De,ze||1,Le,G),Mt=v.isTileAffectedByFog(me),Pt=v.getOrCreateProgram("rasterParticle",{defines:re,overrideFog:Mt});if(v.uploadCommonUniforms(k,Pt,fe),H){const Et=new It(z.LEQUAL,It.ReadOnly,v.depthRangeFor3D),Ut=0,qt=v.globeSharedBuffers;if(qt){const[ei,ai,Ei]=qt.getGridBuffers(Te,Ut!==0);Pt.draw(v,z.TRIANGLES,Et,ce,Di.alphaBlended,v.renderElevatedRasterBackface?ni.frontCCW:ni.backCCW,ut,A.id,ei,ai,Ei)}}else{const Et=v.depthModeForSublayer(0,It.ReadOnly),Ut=Z[me.overscaledZ],{tileBoundsBuffer:qt,tileBoundsIndexBuffer:ei,tileBoundsSegments:ai}=v.getTileBoundsBuffers(ue);Pt.draw(v,z.TRIANGLES,Et,Ut,Di.alphaBlended,ni.disabled,ut,A.id,qt,ei,ai)}}v.resetStencilClippingMasks()}(u,t,o,d),u.style.map.triggerRepaint())},background:function(u,t,o,d){const _=o.paint.get("background-color"),y=o.paint.get("background-color-use-theme").constantOr("default")==="none",v=o.paint.get("background-opacity"),S=o.paint.get("background-emissive-strength"),A=o.paint.get("background-pitch-alignment")==="viewport";if(v===0)return;const P=u.context,D=P.gl,k=u.transform,z=k.tileSize,F=o.paint.get("background-pattern");let G;if(F!==void 0&&(F===null||(G=u.imageManager.getPattern(n.I.from(F.toString()),o.scope,u.style.getLut(o.scope)),!G)))return;const j=!F&&_.a===1&&v===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass!==j)return;const H=ci.disabled,Z=u.depthModeForSublayer(0,j==="opaque"?It.ReadWrite:It.ReadOnly),K=u.colorModeForDrapableLayerRenderPass(S),re=F?"backgroundPattern":"background";let ce,me=d;if(me||(ce=u.getBackgroundTiles(),me=Object.values(ce).map(fe=>fe.tileID)),F&&(P.activeTexture.set(D.TEXTURE0),u.imageManager.bind(u.context,o.scope)),A){const fe=u.getOrCreateProgram(re,{overrideFog:!1,overrideRtt:!0}),ue=new Float32Array(n.bx([])),he=new n.aM(0,0,0,0,0),_e=F?vp(ue,S,v,u,0,o.scope,G,A,{tileID:he,tileSize:z}):xp(ue,S,v,_.toPremultipliedRenderColor(y?null:o.lut));fe.draw(u,D.TRIANGLES,Z,H,K,ni.disabled,_e,o.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments)}else for(const fe of me){const ue=u.isTileAffectedByFog(fe),he=u.getOrCreateProgram(re,{overrideFog:ue}),_e=fe.toUnwrapped(),ye=d?fe.projMatrix:u.transform.calculateProjMatrix(_e);u.prepareDrawTile();const Le=t?t.getTile(fe):ce?ce[fe.key]:new Qa(fe,z,k.zoom,u),ze=F?vp(ye,S,v,u,0,o.scope,G,A,{tileID:fe,tileSize:z}):xp(ye,S,v,_.toPremultipliedRenderColor(y?null:o.lut));u.uploadCommonUniforms(P,he,_e);const{tileBoundsBuffer:qe,tileBoundsIndexBuffer:Xe,tileBoundsSegments:st}=u.getTileBoundsBuffers(Le);he.draw(u,D.TRIANGLES,Z,H,K,ni.disabled,ze,o.id,qe,Xe,st)}},sky:function(u,t,o){const d=u._atmosphere?n.ah(u.transform.zoom):1,_=o.paint.get("sky-opacity")*d;if(_===0)return;const y=u.context,v=o.paint.get("sky-type"),S=new It(y.gl.LEQUAL,It.ReadOnly,[0,1]),A=u.frameCounter/1e3%1;v==="atmosphere"?u.renderPass==="offscreen"?o.needsSkyboxCapture(u)&&(function(P,D,k,z){const F=P.context,G=F.gl;let j=D.skyboxFbo;if(!j){j=D.skyboxFbo=F.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Rh(F),D.skyboxTexture=F.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,D.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let re=0;re<6;++re)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+re,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}F.bindFramebuffer.set(j.framebuffer),F.viewport.set([0,0,32,32]);const H=D.getCenter(P,!0),Z=P.getOrCreateProgram("skyboxCapture"),K=new Float64Array(16);n.bx(K),n.e3(K,K,.5*-Math.PI),Ea(P,D,Z,K,H,0),n.bx(K),n.e3(K,K,.5*Math.PI),Ea(P,D,Z,K,H,1),n.bx(K),n.cG(K,K,.5*-Math.PI),Ea(P,D,Z,K,H,2),n.bx(K),n.cG(K,K,.5*Math.PI),Ea(P,D,Z,K,H,3),n.bx(K),Ea(P,D,Z,K,H,4),n.bx(K),n.e3(K,K,Math.PI),Ea(P,D,Z,K,H,5),F.viewport.set([0,0,P.width,P.height])}(u,o),o.markSkyboxValid(u)):u.renderPass==="sky"&&function(P,D,k,z,F){const G=P.context,j=G.gl,H=P.transform,Z=P.getOrCreateProgram("skybox");G.activeTexture.set(j.TEXTURE0),j.bindTexture(j.TEXTURE_CUBE_MAP,D.skyboxTexture);const K=((re,ce,me,fe,ue)=>({u_matrix:re,u_sun_direction:ce,u_cubemap:0,u_opacity:fe,u_temporal_offset:ue}))(H.skyboxMatrix,D.getCenter(P,!1),0,z,F);P.uploadCommonUniforms(G,Z),Z.draw(P,j.TRIANGLES,k,ci.disabled,P.colorModeForRenderPass(),ni.backCW,K,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(u,o,S,_,A):v==="gradient"&&u.renderPass==="sky"&&function(P,D,k,z,F){const G=P.context,j=G.gl,H=P.transform,Z=P.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Rh(G)),G.activeTexture.set(j.TEXTURE0);let K=D.colorRampTexture;K||(K=D.colorRampTexture=new n.T(G,D.colorRamp,j.RGBA8)),K.bind(j.LINEAR,j.CLAMP_TO_EDGE);const re=((ce,me,fe,ue,he)=>({u_matrix:ce,u_color_ramp:0,u_center_direction:me,u_radius:n.al(fe),u_opacity:ue,u_temporal_offset:he}))(H.skyboxMatrix,D.getCenter(P,!1),D.paint.get("sky-gradient-radius"),z,F);P.uploadCommonUniforms(G,Z),Z.draw(P,j.TRIANGLES,k,ci.disabled,P.colorModeForRenderPass(),ni.backCW,re,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(u,o,S,_,A)},custom:function(u,t,o,d){const _=u.context,y=o.implementation;if(!u.transform.projection.unsupportedLayers||!u.transform.projection.unsupportedLayers.includes("custom")||u.terrain&&(u.terrain.renderingToTexture||u.renderPass==="offscreen")&&o.isDraped(t)){if(u.renderPass==="offscreen"){const v=y.prerender;if(v){if(u.setCustomLayerDefaults(),_.setColorMode(u.colorModeForRenderPass()),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;v.call(y,_.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ah(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else v.call(y,_.gl,u.transform.customLayerMatrix());_.setDirty(),u.setBaseState()}}else if(u.renderPass==="translucent"){if(u.terrain&&u.terrain.renderingToTexture){const S=y.renderToTile;if(S){const A=d[0].canonical,P={x:A.x+d[0].wrap*(y.wrapTileId?0:1<<A.z),y:A.y,z:A.z};_.setDepthMode(It.disabled),_.setStencilMode(ci.disabled),_.setColorMode(u.colorModeForRenderPass()),u.setCustomLayerDefaults(),S.call(y,_.gl,P),_.setDirty(),u.setBaseState()}return}u.setCustomLayerDefaults(),_.setColorMode(u.colorModeForRenderPass()),_.setStencilMode(ci.disabled);const v=y.renderingMode==="3d"?new It(u.context.gl.LEQUAL,It.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,It.ReadOnly);if(_.setDepthMode(v),u.transform.projection.name==="globe"){const S=u.transform.pointMerc;y.render(_.gl,u.transform.customLayerMatrix(),u.transform.getProjection(),u.transform.globeToMercatorMatrix(),n.ah(u.transform.zoom),[S.x,S.y],u.transform.pixelsPerMeterRatio)}else y.render(_.gl,u.transform.customLayerMatrix());_.setDirty(),u.setBaseState(),_.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(u,t,o,d){if(u.renderPass==="opaque")return;const _=o.paint.get("model-opacity").constantOr(1);if(_===0)return;const y=o.paint.get("model-cast-shadows");if(u.renderPass==="shadow"&&(!y||u.terrain&&_<.65&&o._transitionablePaint._values["model-opacity"].value.expression instanceof n.ab))return;const v=u.shadowRenderer,S=o.paint.get("model-receive-shadows");v&&(v.useNormalOffset=!0,S||(v.enabled=!1));const A=()=>{v&&(v.useNormalOffset=!0,S||(v.enabled=!0))},P=t.getSource();if(u.renderPass==="light-beam"&&P.type!=="batched-model")return;if(P.type==="vector"||P.type==="geojson")return function(Z,K,re,ce,me){const fe=Z.transform;if(fe.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${fe.projection.name} projection is not yet implemented`);const ue=fe.getFreeCameraOptions().position;if(!Z.modelManager)return;const he=Z.modelManager;re.modelManager=he;const _e=Z.shadowRenderer;if(!re._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const ye=re._unevaluatedLayout._values["model-id"],Le=Object.assign({},re.layout.get("model-id").parameters),ze=Z.style.order.indexOf(re.fqid);for(const qe of ce){const Xe=K.getTile(qe).getBucket(re);if(!Xe||Xe.projection.name!==fe.projection.name)continue;const st=Xe.getModelUris();st&&!Xe.modelsRequested&&(he.addModelsFromBucket(st,me),Xe.modelsRequested=!0);const De=_d(qe,fe);Le.zoom=De;const je=ye.possiblyEvaluate(Le);if(Re(Z,Xe,qe),ao.shadowUniformsInitialized=!1,ao.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(qe.toUnwrapped())===0,Z.renderPass==="shadow"&&_e){if(Z.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const Be=fe.calculatePosMatrix(qe.toUnwrapped(),fe.worldSize);if(ao.tileMatrix.set(Be),ao.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(Be)),ao.aabb.min.fill(0),ao.aabb.max[0]=ao.aabb.max[1]=n.aj,ao.aabb.max[2]=0,dg(Xe,ao,Z,re.scope))continue}const Te=1<<qe.canonical.z,Ke=[((ue.x-qe.wrap)*Te-qe.canonical.x)*n.aj,(ue.y*Te-qe.canonical.y)*n.aj,ue.z*Te*n.aj];Z.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&Z.style.isLayerClipped(re,K.getSource())&&Xe.updateReplacement(qe,Z.replacementSource,ze,me)&&(Xe.uploaded=!1,Xe.upload(Z.context));for(let Be in Xe.instancesPerModel){const it=Xe.instancesPerModel[Be];it.features.length>0&&(Be=je.evaluate(it.features[0].feature,{}));const ft=he.getModel(Be,me);if(ft||he.hasURLBeenRequested(Be)||Xe.modelUris.includes(Be)||(Xe.modelUris.push(Be),Xe.modelsRequested=!1),ft&&ft.uploaded)for(const Ye of ft.nodes)gd(Z,re,Ye,it,Ke,qe,ao)}}}(u,t,o,d,P.type==="vector"?o.scope:""),void A();if(!P.loaded())return;if(P.type==="batched-model")return function(Z,K,re,ce){re.resetLayerRenderingStats(Z);const me=Z.context,fe=Z.transform,ue=Z.style.fog,he=Z.shadowRenderer;if(fe.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const _e=Z.transform.getFreeCameraOptions().position,ye=n.bY([],[_e.x,_e.y,_e.z],Z.transform.worldSize),Le=n.eb([],ye),ze=n.bx([]),qe=n.ec(fe.center.lat,fe.zoom),Xe=n.bn([],[1,1,1/qe]);n.bo(ze,ze,Le);const st=re.paint.get("model-opacity").constantOr(1),De=new It(me.gl.LEQUAL,It.ReadWrite,Z.depthRangeFor3D),je=new It(me.gl.LEQUAL,It.ReadOnly,Z.depthRangeFor3D),Te=new n.cW([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ke=Z.renderPass==="shadow",Be=Ke&&he?he.getCurrentCascadeFrustum():fe.getFrustum(fe.scaleZoom(fe.worldSize)),it=re.paint.get("model-front-cutoff"),ft=it[2]<1,Ye=So(Z,re.paint.get("model-cutoff-fade-range")),ut=re.getLayerRenderingStats();(function(Mt,Pt,Et,Ut){const qt=Mt.terrain?Mt.terrain.exaggeration():0,ei=Mt.transform.zoom;for(const ai of Ut){const Ei=Pt.getTile(ai).getBucket(Et);Ei&&(Ei.setFilter(Et.filter),Mt.conflationActive&&Ei.updateReplacement(ai,Mt.replacementSource),Ei.evaluateTransform(Mt,Et),Mt.terrain&&qt>0&&Ei.elevationUpdate(Mt.terrain,qt,ai,Et.source),Ei.needsReEvaluation(Mt,ei,Et)&&Ei.evaluate(Et))}})(Z,K,re,ce),function(){let Mt,Pt,Et;ft?(Mt=ce.length-1,Pt=-1,Et=-1):(Mt=0,Pt=ce.length,Et=1);const Ut=new Float64Array(16),qt=n.ef(),ei=new n.P(0,0);for(let ai=Mt;ai!==Pt;ai+=Et){const Ei=ce[ai],an=K.getTile(Ei).getBucket(re);if(!an||!an.uploaded)continue;let In=!1;he&&(In=he.getMaxCascadeForTile(Ei.toUnwrapped())===0);const un=fe.calculatePosMatrix(Ei.toUnwrapped(),fe.worldSize),mn=an.modelTraits;!Ke&&ft&&(n.bi(Ut,un),n.ad(qt,ye,Ut),ei.x=qt[0],ei.y=qt[1]);const os=[];an.setFilter(re.filter);for(const vi of an.getNodesInfo()){if(vi.hiddenByReplacement||!vi.node.meshes)continue;const Mi=vi.node;let Oi=0;Z.terrain&&Mi.elevation&&(Oi=Mi.elevation*Z.terrain.exaggeration());const Rn=(()=>{const is=vi.aabb;return Te.min=[...is.min],Te.max=[...is.max],Te.min[2]+=Oi,Te.max[2]+=Oi,n.ad(Te.min,Te.min,un),n.ad(Te.max,Te.max,un),Te})(),_s=vi.evaluatedScale;if(_s[0]<=1&&_s[1]<=1&&_s[2]<=1&&Rn.intersects(Be)===0)continue;if(!Ke&&ft){const is=.16666666666666666;vi.cameraCollisionOpacity=ye[0]>Rn.min[0]&&ye[0]<Rn.max[0]&&ye[1]>Rn.min[1]&&ye[1]<Rn.max[1]&&ye[2]*qe<Rn.max[2]&&Mi.footprint&&n.bS(ei,Mi.footprint)?Math.max(vi.cameraCollisionOpacity-is,0):Math.min(1,vi.cameraCollisionOpacity+is)}const Cn=[...un],Qi=1/n.cU(Ei.canonical),Jn=Mi.anchor?Mi.anchor[0]:0,$i=Mi.anchor?Mi.anchor[1]:0;n.bo(Cn,Cn,[Jn*(_s[0]-1)+vi.evaluatedTranslation[0]*Qi,$i*(_s[1]-1)+vi.evaluatedTranslation[1]*Qi,Oi+vi.evaluatedTranslation[2]]),n.ci(_s,n.eg)||n.cE(Cn,Cn,_s);const ds=n.az([],Cn,Mi.matrix),Ln=n.az([],fe.expandedFarZProjMatrix,ds),Tn=n.az([],fe.expandedFarZProjMatrix,Cn),zn=n.aA([],[Jn,$i,Oi,1],Ln)[2];Mi.hidden=!1;let nn=st;Ke||(ft&&(nn*=vi.cameraCollisionOpacity,nn*=uc(Cn,fe,vi.aabb,it)),nn*=fg(Ye,zn)),nn!==0?os.push({nodeInfo:vi,depth:zn,opacity:nn,wvpForNode:Ln,wvpForTile:Tn,nodeModelMatrix:ds,tileModelMatrix:Cn}):Mi.hidden=!0}Ke||os.sort((vi,Mi)=>!ft||vi.opacity===1&&Mi.opacity===1?vi.depth<Mi.depth?-1:1:vi.opacity===1?-1:Mi.opacity===1?1:vi.depth>Mi.depth?-1:1);for(const vi of os){const Mi=vi.nodeInfo,Oi=Mi.node;let Rn=n.az([],Xe,vi.tileModelMatrix);n.az(Rn,ze,Rn);const _s=n.bi([],Rn);n.ee(_s,_s),n.cE(_s,_s,Ap),Rn=n.az(Rn,Rn,Oi.matrix);const Cn=Z.renderPass==="light-beam",Qi=re.paint.get("model-color-use-theme").constantOr("default")==="none",Jn=mn&n.em.HasMapboxMeshFeatures,$i=Jn?0:Mi.evaluatedRMEA[0][2];for(let ds=0;ds<Oi.meshes.length;++ds){const Ln=Oi.meshes[ds],Tn=ds===Oi.lightMeshIndex;let zn=vi.wvpForNode;if(Tn){if(!Cn&&!Z.terrain&&Z.shadowRenderer){Z.currentLayer<Z.firstLightBeamLayer&&(Z.firstLightBeamLayer=Z.currentLayer);continue}zn=vi.wvpForTile}else if(Cn)continue;const nn={defines:[]},is=[];if(!Ke&&he&&(he.useNormalOffset=!!Ln.normalBuffer),lt(nn.defines,is,Ln,Z,Qi?null:re.lut),Jn||nn.defines.push("DIFFUSE_SHADED"),In&&nn.defines.push("SHADOWS_SINGLE_CASCADE"),ut&&(Ke?ut.numRenderedVerticesInShadowPass+=Ln.vertexArray.length:ut.numRenderedVerticesInTransparentPass+=Ln.vertexArray.length),Ke){Kn(Ln,vi.nodeModelMatrix,Z,re);continue}let Hs=null;if(ue){const co=gl(vi.nodeModelMatrix,Z.transform);if(Hs=new Float32Array(co),fe.projection.name!=="globe"){const Kr=Ln.aabb.min,xr=Ln.aabb.max,[Da,ho]=ue.getOpacityForBounds(co,Kr[0],Kr[1],xr[0],xr[1]);nn.overrideFog=Da>=Ve||ho>=Ve}}const Vn=Ln.material;let Ki;Vn.occlusionTexture&&Vn.occlusionTexture.offsetScale&&(Ki=Vn.occlusionTexture.offsetScale,nn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ir=Z.getOrCreateProgram("model",nn);!Ke&&he&&he.setupShadowsFromMatrix(vi.tileModelMatrix,Ir,he.useNormalOffset),Z.uploadCommonUniforms(me,Ir,null,Hs);const yr=Vn.pbrMetallicRoughness;yr.metallicFactor=.9,yr.roughnessFactor=.5;const Br=Ch(new Float32Array(zn),new Float32Array(Rn),new Float32Array(_s),new Float32Array(Oi.matrix),Z,vi.opacity,yr.baseColorFactor,Vn.emissiveFactor,yr.metallicFactor,yr.roughnessFactor,Vn,$i,re,[0,0,0],Ki);!Tn&&(Mi.hasTranslucentParts||vi.opacity<1)&&Ir.draw(Z,me.gl.TRIANGLES,De,ci.disabled,Di.disabled,ni.backCCW,Br,re.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,re.paint,Z.transform.zoom,void 0,is),Ir.draw(Z,me.gl.TRIANGLES,Tn?je:De,ci.disabled,Tn||vi.opacity<1||Mi.hasTranslucentParts?Di.alphaBlended:Di.unblended,ni.backCCW,Br,re.id,Ln.vertexBuffer,Ln.indexBuffer,Ln.segments,re.paint,Z.transform.zoom,void 0,is)}}}}()}(u,t,o,d),void A();if(P.type!=="model")return;const D=P.getModels(),k=[],z=u.transform.getFreeCameraOptions().position,F=n.bY([],[z.x,z.y,z.z],u.transform.worldSize);n.eb(F,F);const G=[],j=[];let H=0;for(const Z of D){const K=o.paint.get("model-rotation").constantOr(null),re=o.paint.get("model-scale").constantOr(null),ce=o.paint.get("model-translation").constantOr(null);Z.computeModelMatrix(u,K,re,ce,!0,!0,!1);const me=n.bx([]),fe=n.ec(Z.position.lat,u.transform.zoom),ue=n.bn([],[1,1,1/fe]);n.bo(me,me,F),k.push({zScaleMatrix:ue,negCameraPosMatrix:me});for(const he of Z.nodes)yl(u.transform,he,Z.matrix,u.transform.expandedFarZProjMatrix,H,G,j);H++}if(G.sort((Z,K)=>K.depth-Z.depth),u.renderPass!=="shadow"){if(_===1)for(const Z of j)St(Z,u,o,k[Z.modelIndex],ci.disabled,u.colorModeForRenderPass());else{for(const Z of j)St(Z,u,o,k[Z.modelIndex],ci.disabled,Di.disabled);for(const Z of j)St(Z,u,o,k[Z.modelIndex],u.stencilModeFor3D(),u.colorModeForRenderPass());u.resetStencilClippingMasks()}for(const Z of G)St(Z,u,o,k[Z.modelIndex],ci.disabled,u.colorModeForRenderPass());A()}else{for(const Z of j)Kn(Z.mesh,Z.nodeModelMatrix,u,o);for(const Z of G)Kn(Z.mesh,Z.nodeModelMatrix,u,o);A()}}},Pp={line:function(u,t,o){if(u.hasElevatedBuckets=!1,u.hasNonElevatedBuckets=!1,u._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||u._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const _ of d){const y=t.getTile(_).getBucket(u);if(y&&(y.elevationType!=="none"?u.hasElevatedBuckets=!0:u.hasNonElevatedBuckets=!0,u.hasElevatedBuckets&&u.hasNonElevatedBuckets))break}}}else u.hasNonElevatedBuckets=!0},model:function(u,t,o){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(o.modelManager&&o.modelManager.upload(o,d.type==="vector"?u.scope:""));if(d.type==="batched-model"||d.type!=="model")return;const _=d.getModels();for(const y of _)y.upload(o.context)},raster:function(u,t,o){const d=t.getSource();if(!(d instanceof pa&&d.loaded()))return;const _=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=u.paint.get("raster-array-band")||d.getInitialBand(_);if(y==null)return;const v=t.getIds().map(S=>t.getTileByID(S));for(const S of v)S.updateNeeded(_,y)&&d.prepareTile(S,_,y)},"raster-particle":function(u,t,o){const d=t.getSource();if(!(d instanceof pa&&d.loaded()))return;const _=u.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!_)return;const y=u.paint.get("raster-particle-array-band")||d.getInitialBand(_);if(y==null)return;const v=t.getIds().map(S=>t.getTileByID(S));for(const S of v)S.updateNeeded(_,y)&&d.prepareTile(S,_,y)}},ea={fill:wp},Oh={fill:function(u,t,o,d){if(!o.layout||o.layout.get("fill-elevation-reference")==="none")return;const _=u.context.gl,y=new It(_.LEQUAL,It.ReadOnly,u.depthRangeFor3D),v=new ci({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),S=u.transform.getFreeCameraOptions().position,A=u.getOrCreateProgram("elevatedStructuresDepthReconstruct",{defines:["DEPTH_RECONSTRUCTION"]});for(const P of d){const D=t.getTile(P),k=D.getBucket(o);if(!k)continue;const z=k.elevatedStructures;if(!z||z.maskSegments.segments[0].primitiveLength===0)continue;const F=fd(P.toUnwrapped(),S),G=u.translatePosMatrix(P.projMatrix,D,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor")),j=cd(G,F,0,0,0);A.draw(u,_.TRIANGLES,y,v,Di.disabled,ni.disabled,j,o.id,z.vertexBuffer,z.indexBuffer,z.maskSegments,o.paint,u.transform.zoom)}}};class dc{constructor(t,o,d,_,y,v){this.context=new Sv(t,o),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=y,this._timeStamp=n.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const S=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const P of S)this._debugParams.enabledLayers[P]=!0;y.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),y.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),y.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),y.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),y.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const P of S)y.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],P);this.occlusionParams=new pg(y),this.setup(),this.numSublayers=_r.maxUnderzooming+_r.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.et,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new nv(this),this._wireframeDebugCache=new Rv,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const A=new n.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,A,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=_,this.worldview=v}updateTerrain(t,o){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Th(this,t));const _=this._terrain;this.transform.elevation=d?_:null,_.update(t,this.transform,o),this.transform.elevation&&!_.enabled&&(this.transform.elevation=null)}_updateFog(t){const o=t.fog;if(!o||this.transform.projection.name==="globe"||o.getOpacity(this.transform.pitch)<1||o.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,_]=o.getFovAdjustedRange(this.transform._fov);if(d>_)return void(this.transform.fogCullDistSq=null);const y=d+.78*(_-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new Th(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,o){if(this.width=t*n.q.devicePixelRatio,this.height=o*n.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,o=new n.ba;o.emplaceBack(0,0),o.emplaceBack(n.aj,0),o.emplaceBack(0,n.aj),o.emplaceBack(n.aj,n.aj),this.tileExtentBuffer=t.createVertexBuffer(o,n.bc.members),this.tileExtentSegments=n.bd.simpleSegment(0,0,4,2);const d=new n.ba;d.emplaceBack(0,0),d.emplaceBack(n.aj,0),d.emplaceBack(0,n.aj),d.emplaceBack(n.aj,n.aj),this.debugBuffer=t.createVertexBuffer(d,n.bc.members),this.debugSegments=n.bd.simpleSegment(0,0,4,5);const _=new n.ba;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(-1,1),_.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(_,n.bc.members),this.viewportSegments=n.bd.simpleSegment(0,0,4,2);const y=new n.aZ;y.emplaceBack(0,0,0,0),y.emplaceBack(n.aj,0,n.aj,0),y.emplaceBack(0,n.aj,0,n.aj),y.emplaceBack(n.aj,n.aj,n.aj,n.aj),this.mercatorBoundsBuffer=t.createVertexBuffer(y,n.bf.members),this.mercatorBoundsSegments=n.bd.simpleSegment(0,0,4,2);const v=new n.a_;v.emplaceBack(0,1,2),v.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(v);const S=new n.bb;for(const P of[0,1,3,2,0])S.emplaceBack(P);this.debugIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new n.T(t,new n.r({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=n.bz();const A=this.context.gl;this.stencilClearMode=new ci({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,It.disabled,this.stencilClearMode,Di.disabled,ni.disabled,ul(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,o,d){if(!o||this.currentStencilSource===o.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let S=!1;for(const A of d)if(this._tileClippingMaskIDs[A.key]===void 0){S=!0;break}if(!S)return}this.currentStencilSource=o.id;const _=this.context,y=_.gl;this.nextStencilID+d.length>256&&this.clearStencil(),_.setColorMode(Di.disabled),_.setDepthMode(It.disabled);const v=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of d){const A=o.getTile(S),P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:k,tileBoundsSegments:z}=this.getTileBoundsBuffers(A);v.draw(this,y.TRIANGLES,It.disabled,new ci({func:y.ALWAYS,mask:0},P,255,y.KEEP,y.KEEP,y.REPLACE),Di.disabled,ni.disabled,ul(S.projMatrix),"$clipping",D,k,z)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,o=this.context.gl;return new ci({func:o.NOTEQUAL,mask:255},t,255,o.KEEP,o.KEEP,o.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const o=this.context.gl;return new ci({func:o.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,o.KEEP,o.KEEP,o.REPLACE)}stencilConfigForOverlap(t){const o=this.context.gl,d=t.sort((v,S)=>S.overscaledZ-v.overscaledZ),_=d[d.length-1].overscaledZ,y=d[0].overscaledZ-_+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const v={};for(let S=0;S<y;S++)v[S+_]=new ci({func:o.GEQUAL,mask:255},S+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=y,[v,d]}return[{[_]:ci.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Di([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new n.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Di.unblended:Di.alphaBlended}colorModeForDrapableLayerRenderPass(t){const o=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Di([o.ONE,o.ONE_MINUS_SRC_ALPHA,o.CONSTANT_ALPHA,o.ONE_MINUS_SRC_ALPHA],new n.am(0,0,0,t===void 0?0:t),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(t,o,d,_=!1){if(this.depthOcclusion)return new It(this.context.gl.GREATER,It.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!_)return It.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new It(d||this.context.gl.LEQUAL,o,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,o=Math.ceil(this.width),d=Math.ceil(this.height),_=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===o&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),o!==0&&d!==0&&(this.depthFBO=new bp(this.context,o,d,!1,"texture"),this.depthTexture=new n.T(this.context,{width:o,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(_),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,o,d,0,0,o,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,o)=>t+o/this._fpsHistory.length,0))}render(t,o){const d=n.q.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=o;const _=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),v=()=>this.style._getOrder(y).filter(De=>{const je=_[De];return!(je.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[je.type]});let S=v(),A=!1,P=!1;for(const De of S){const je=_[De];je.type==="circle"&&(A=!0),je.type==="symbol"&&(je.hasInitialOcclusionOpacityProperties?P=!0:A=!0)}let D=S.map(De=>_[De]);const k=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(n.q.now()),this.imageManager.beginFrame();let z=0,F=!1;for(const De in k){const je=k[De];je.used&&(je.prepare(this.context),je.getSource().usedInConflation&&++z)}let G=!1;for(const De of D)De.isHidden(this.transform.zoom)||(De.type==="clip"&&(G=!0),this.prepareLayer(De));const j={},H={},Z={},K={},re={};for(const De in k){const je=k[De];j[De]=je.getVisibleCoordinates(),H[De]=j[De].slice().reverse(),Z[De]=je.getVisibleCoordinates(!0).reverse(),K[De]=je.getShadowCasterCoordinates(),re[De]=je.sortCoordinatesByDistance(j[De])}const ce=De=>{const je=this.style.getLayerSourceCache(De);return je&&je.used?je.getSource():null};if(z||G||this._clippingActiveLastFrame){const De=[],je=[];let Te=0;for(const Ke of D)this.isSourceForClippingOrConflation(Ke,ce(Ke))&&(De.push(Ke),je.push(Te)),Te++;if(De&&(G||De.length>1)||this._clippingActiveLastFrame){G=!1;const Ke=[];for(let Be=0;Be<De.length;Be++){const it=De[Be],ft=je[Be],Ye=this.style.getLayerSourceCache(it);if(!Ye||!Ye.used||!Ye.getSource().usedInConflation&&it.type!=="clip")continue;let ut=n.eu,Mt=n.bQ.None;const Pt=[];let Et=!0;if(it.type==="clip"){ut=ft;for(const Ut of it.layout.get("clip-layer-types"))Mt|=Ut==="model"?n.bQ.Model:Ut==="symbol"?n.bQ.Symbol:n.bQ.FillExtrusion;for(const Ut of it.layout.get("clip-layer-scope"))Pt.push(Ut);it.isHidden(this.transform.zoom)?Et=!1:G=!0}Et&&Ke.push({layer:it.fqid,cache:Ye,order:ut,clipMask:Mt,clipScope:Pt})}this.replacementSource.setSources(Ke),F=!0}}this._clippingActiveLastFrame=G,F||this.replacementSource.clear(),this.conflationActive=F,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let De=0;De<D.length;De++){const je=D[De],Te=je.cutoffRange();if(this.longestCutoffRange=Math.max(Te,this.longestCutoffRange),Te>0){const Ke=ce(je);Ke&&(this.minCutoffZoom=Math.max(Ke.minzoom,this.minCutoffZoom)),je.minzoom&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom))}je.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=De),this._lastOcclusionLayer=De)}const me=this.style&&this.style.fog;me?(this._fogVisible=me.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=me.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0,S=v(),D=S.map(De=>_[De]));const fe=this._shadowRenderer;if(fe){fe.updateShadowParameters(this.transform,this.style.directionalLight);for(const De in k)for(const je of j[De]){let Te={min:0,max:0};this.terrain&&(Te=this.terrain.getMinMaxForTile(je)||Te),fe.addShadowReceiver(je.toUnwrapped(),Te.min,Te.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.ev(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new hc(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ue=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),he=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ue&&!this._snow&&(this._snow=new Nn(this)),!ue&&this._snow&&(this._snow.destroy(),delete this._snow),he&&!this._rain&&(this._rain=new Lv(this)),!he&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),!Ks.has(this.context.gl))return;this.renderPass="offscreen";for(const De of D){const je=t.getLayerSourceCache(De);if(!De.hasOffscreenPass()||De.isHidden(this.transform.zoom))continue;const Te=je?H[je.id]:void 0;(De.type==="custom"||De.type==="raster"||De.type==="raster-particle"||De.isSky()||Te&&Te.length)&&this.renderLayer(this,je,De,Te)}this.depthRangeFor3D=[0,1-(D.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,K)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const _e=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),ye=(()=>{if(o.showOverdrawInspector)return n.am.black;const De=this.style.fog;if(De&&this.transform.projection.supportsFog){const je=this.style.getLut(De.scope);if(!_e){const Te=De.properties.get("color-use-theme")==="none",Ke=De.properties.get("color").toNonPremultipliedRenderColor(Te?null:je).toArray01();return new n.am(...Ke)}if(_e){const Te=De.properties.get("space-color-use-theme")==="none",Ke=De.properties.get("space-color").toNonPremultipliedRenderColor(Te?null:je).toArray01();return new n.am(...Ke)}}return n.am.transparent})();if(this.context.clear({color:ye,depth:1}),this.clearStencil(),this._showOverdrawInspector=o.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=S.length-1;this.currentLayer>=0;this.currentLayer--){const De=D[this.currentLayer],je=t.getLayerSourceCache(De);if(De.isSky())continue;const Te=je?(De.is3D(y)?re:H)[je.id]:void 0;this._renderTileClippingMasks(De,je,Te),this.renderLayer(this,je,De,Te)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&_e&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<S.length;this.currentLayer++){const De=D[this.currentLayer],je=t.getLayerSourceCache(De);De.isSky()&&this.renderLayer(this,je,De,je?H[je.id]:void 0)}function Le(De,je){let Te;return je&&(Te=(De.type==="symbol"?Z:De.is3D(y)?re:H)[je.id]),Te}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<S.length;){const De=D[this.currentLayer];if(De.type==="raster"||De.type==="raster-particle"){const je=t.getLayerSourceCache(De);this.renderLayer(this,je,De,Le(De,je))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let ze=0;fe&&(ze=fe.getShadowCastingLayerCount());let qe=!1,Xe=-1;for(let De=0;De<S.length;++De){const je=D[De];je.isHidden(this.transform.zoom)||je.is3D(y)&&(Xe=De)}P&&Xe===-1&&(A=!0);let st=!1;for(;this.currentLayer<S.length;){const De=D[this.currentLayer],je=t.getLayerSourceCache(De);if(De.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(De)){if(De.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!st&&De.is3D(y)&&!y){const Te=this.currentLayer,Ke=Be=>{for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const it=D[this.currentLayer];if(ea[it.type]){const ft=this.style.getLayerSourceCache(it);ea[it.type](this,ft,it,Le(it,ft),Be)}}};Ke("initialize"),Ke("reset"),this.currentLayer=Te,st=!0}if(A&&!qe&&this.terrain&&!this.transform.isOrthographic&&(qe=!0,this.blitDepth()),P&&Xe!==-1&&this.currentLayer===Xe+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(De,je,je?j[je.id]:void 0),this.renderLayer(this,je,De,Le(De,je)),!this.terrain&&fe&&ze>0&&De.hasShadowPass()&&--ze==0){{this.clearStencil();const Te=this.currentLayer;for(this.currentLayer=0;this.currentLayer<D.length;this.currentLayer++){const Ke=D[this.currentLayer];if(Oh[Ke.type]){const Be=this.style.getLayerSourceCache(Ke);Oh[Ke.type](this,Be,Ke,Le(Ke,Be))}}this.currentLayer=Te}if(fe.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Te=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Te;this.currentLayer++){const Ke=D[this.currentLayer];if(!Ke.hasLightBeamPass())continue;const Be=t.getLayerSourceCache(Ke);this.renderLayer(this,Be,Ke,Be?H[Be.id]:void 0)}this.currentLayer=Te,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Te=this.currentLayer;this.depthOcclusion=!0;for(const Ke of this.layersWithOcclusionOpacity){this.currentLayer=Ke;const Be=D[this.currentLayer],it=t.getLayerSourceCache(Be),ft=it?H[it.id]:void 0;this.terrain||this._renderTileClippingMasks(Be,it,it?j[it.id]:void 0),this.renderLayer(this,it,Be,ft)}this.depthOcclusion=!1,this.currentLayer=Te,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let De=null;D.forEach(je=>{const Te=t.getLayerSourceCache(je);Te&&!je.isHidden(this.transform.zoom)&&Te.getVisibleCoordinates().length&&(!De||De.getSource().maxzoom<Te.getSource().maxzoom)&&(De=Te)}),De&&this.options.showTileBoundaries&&Jo(this,De,De.getVisibleCoordinates(),n.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Jo(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(De){const je=De.transform.padding;pd(De,De.transform.height-(je.top||0),3,Cv),pd(De,je.bottom||0,3,Mv),md(De,je.left||0,3,Ar),md(De,De.transform.width-(je.right||0),3,Ep);const Te=De.transform.centerPoint;(function(Ke,Be,it,ft){cc(Ke,Be-1,it-10,2,20,ft),cc(Ke,Be-10,it-1,20,2,ft)})(De,Te.x,De.transform.height-Te.y,cr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),F||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:o}=this.transform.projection,d=!o||!o.includes(t.type);if(Pp[t.type]&&(d||this.terrain&&t.type==="custom")){const _=this.style.getLayerSourceCache(t);Pp[t.type](t,_,this)}this.gpuTimingEnd()}renderLayer(t,o,d,_){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||_&&_.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Xi[d.type](t,o,d,_,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const o=this.context.extTimerQuery,d=this.context.gl;let _=this.gpuTimers[t.id];_||(_=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),_.calls++,d.beginQuery(o.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,o=this.context.gl,d=o.createQuery();this.deferredRenderGpuTimeQueries.push(d),o.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const o={};for(const d in t){const _=t[d],y=this.context.extTimerQuery,v=y.getQueryParameter(_.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(_.query),o[d]=v}return o}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const o=this.context.gl;let d=0;for(const _ of t)d+=o.getQueryParameter(_,o.QUERY_RESULT)/1e6,o.deleteQuery(_);return d}translatePosMatrix(t,o,d,_,y){if(!d[0]&&!d[1])return t;const v=y?_==="map"?this.transform.angle:0:_==="viewport"?-this.transform.angle:0;if(v){const P=Math.sin(v),D=Math.cos(v);d=[d[0]*D-d[1]*P,d[0]*P+d[1]*D]}const S=[y?d[0]:n.aw(o,d[0],this.transform.zoom),y?d[1]:n.aw(o,d[1],this.transform.zoom),0],A=new Float32Array(16);return n.bo(A,t,S),A}saveTileTexture(t){const o=t.size[0],d=this._tileTextures[o];d?d.push(t):this._tileTextures[o]=[t]}getTileTexture(t){const o=this._tileTextures[t];return o&&o.length>0?o.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,o,d){const _=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):_||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||_||o!==void 0&&!o||y.push("FOG","FOG_DITHERING"),_&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,o){this.cache=this.cache||{};const d=o&&o.defines||[],_=o&&o.config,y=this.currentGlobalDefines(t,o&&o.overrideFog,o&&o.overrideRtt).concat(d),v=ld.cacheKey(Xu[t],t,y,_);return this.cache[v]||(this.cache[v]=new ld(this.context,t,Xu[t],_,ig[t],y)),this.cache[v]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,o){if(this.style.enable3dLights()){const d=this.style.directionalLight,_=this.style.ambientLight;if(d&&_){const y=((v,S,A)=>{const P=v.properties.get("direction"),D=v.properties.get("color-use-theme")==="none",k=v.properties.get("color").toNonPremultipliedRenderColor(D?null:A.getLut(v.scope)).toArray01(),z=v.properties.get("intensity"),F=S.properties.get("color-use-theme")==="none",G=S.properties.get("color").toNonPremultipliedRenderColor(F?null:A.getLut(S.scope)).toArray01(),j=S.properties.get("intensity"),H=[P.x,P.y,P.z],Z=n.dw(G,j),K=n.dw(k,z);return{u_lighting_ambient_color:Z,u_lighting_directional_dir:H,u_lighting_directional_color:K,u_ground_radiance:ad(H,K,Z)}})(d,_,this.style);o.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,o,d,_,y){if(this.uploadCommonLightUniforms(t,o),this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const S=v.getOpacity(this.transform.pitch),A=((P,D,k,z,F,G,j,H,Z,K,re,ce)=>{const me=P.transform,fe=D.properties.get("color-use-theme")==="none",ue=D.properties.get("color").toNonPremultipliedRenderColor(fe?null:P.style.getLut(D.scope)).toArray01();ue[3]=z;const he=P.frameCounter/1e3%1,[_e,ye]=D.properties.get("vertical-range");return{u_fog_matrix:k?me.calculateFogTileMatrix(k):ce||P.identityMat,u_fog_range:D.getFovAdjustedRange(me._fov),u_fog_color:ue,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,ye),ye],u_fog_temporal_offset:he,u_frustum_tl:F,u_frustum_tr:G,u_frustum_br:j,u_frustum_bl:H,u_globe_pos:Z,u_globe_radius:K,u_viewport:re,u_globe_transition:n.ah(me.zoom),u_is_globe:+(me.projection.name==="globe")}})(this,v,d,S,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.q.devicePixelRatio,this.transform.height*n.q.devicePixelRatio],_);o.setFogUniformValues(t,A)}y&&o.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),o}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,o=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const _ of d)o[_.key]=t[_.key]||new Qa(_,512,this.transform.tileZoom,this,void 0,this.worldview);return o}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,o){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building")&&(!o||o.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let o=this._cachedTileFogOpacities[t.key];return o||(this._cachedTileFogOpacities[t.key]=o=this.style.fog.getOpacityForTile(t)),o[0]>=Ve||o[1]>=Ve}setupDepthForOcclusion(t,o,d){const _=this.context,y=_.gl,v=!!d;var S;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),_.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((S=this.depthRangeFor3D)[1]-S[0]),-1-2*S[0]/(S[1]-S[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),_.activeTexture.set(y.TEXTURE0),v||o.setTerrainUniformValues(_,d)}}function Ia(u,t){let o=!1,d=null;const _=()=>{d=null,o&&(u(),d=setTimeout(_,t),o=!1)};return()=>(o=!0,d||_(),d)}class Dp{constructor(t){this._hashName=t&&encodeURIComponent(t),n.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ia(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const o=vd(t);if(this._hashName){const d=this._hashName;let _=!1;const y=location.hash.slice(1).split("&").map(v=>{const S=v.split("=")[0];return S===d?(_=!0,`${S}=${o}`):v}).filter(v=>v);return _||y.push(`${d}=${o}`),`#${y.join("&")}`}return`#${o}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let o;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(o=d)}),(o&&o[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const o=this._getCurrentHash();if(o.length>=3&&!o.some(d=>isNaN(Number(d)))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(o[3]||0):t.getBearing();return t.jumpTo({center:[+o[2],+o[1]],zoom:+o[0],bearing:d,pitch:+(o[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function vd(u,t){const o=u.getCenter(),d=Math.round(100*u.getZoom())/100,_=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,_),v=Math.round(o.lng*y)/y,S=Math.round(o.lat*y)/y,A=u.getBearing(),P=u.getPitch();let D=t?`/${v}/${S}/${d}`:`${d}/${S}/${v}`;return(A||P)&&(D+="/"+Math.round(10*A)/10),P&&(D+=`/${Math.round(P)}`),D}const fc={linearity:.3,easing:n.ew(0,0,.3,1)},Rp=n.h({deceleration:2500,maxSpeed:1400},fc),Ao=n.h({deceleration:20,maxSpeed:1400},fc),Ca=n.h({deceleration:1e3,maxSpeed:360},fc),kh=n.h({deceleration:1e3,maxSpeed:90},fc);class bd{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.q.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,o=n.q.now();for(;t.length>0&&o-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const o={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)o.zoom+=y.zoomDelta||0,o.bearing+=y.bearingDelta||0,o.pitch+=y.pitchDelta||0,y.panDelta&&o.pan._add(y.panDelta),y.around&&(o.around=y.around),y.pinchAround&&(o.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,_={};if(o.pan.mag()){const y=mc(o.pan.mag(),d,n.h({},Rp,t||{}));_.offset=o.pan.mult(y.amount/o.pan.mag()),_.center=this._map.transform.center,pc(_,y)}if(o.zoom){const y=mc(o.zoom,d,Ao);_.zoom=this._map.transform.zoom+y.amount,pc(_,y)}if(o.bearing){const y=mc(o.bearing,d,Ca);_.bearing=this._map.transform.bearing+n.ay(y.amount,-179,179),pc(_,y)}if(o.pitch){const y=mc(o.pitch,d,kh);_.pitch=this._map.transform.pitch+y.amount,pc(_,y)}if(_.zoom||_.bearing){const y=o.pinchAround===void 0?o.around:o.pinchAround;_.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),_.noMoveStart=!0,_}}function pc(u,t){(!u.duration||u.duration<t.duration)&&(u.duration=t.duration,u.easing=t.easing)}function mc(u,t,o){const{maxSpeed:d,linearity:_,deceleration:y}=o,v=n.ay(u*_/(t/1e3),-d,d),S=Math.abs(v)/(y*_);return{easing:o.easing,duration:1e3*S,amount:v*(S/2)}}class $s extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d,_={}){const y=At(o.getCanvasContainer(),d),v=o.unproject(y);super(t,n.h({point:y,lngLat:v,originalEvent:d},_)),this._defaultPrevented=!1,this.target=o}}class _c extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o,d){const _=t==="touchend"?d.changedTouches:d.touches,y=Wt(o.getCanvasContainer(),_),v=y.map(A=>o.unproject(A)),S=y.reduce((A,P,D,k)=>A.add(P.div(k.length)),new n.P(0,0));super(t,{points:y,point:S,lngLats:v,lngLat:o.unproject(S),originalEvent:d}),this._defaultPrevented=!1}}class Ma extends n.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,o){super("wheel",{originalEvent:o}),this._defaultPrevented=!1}}class Lp{constructor(t,o){this._map=t,this._clickTolerance=o.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Ma(this._map,t))}mousedown(t,o){return this._mousedownPos=o,this._firePreventable(new $s(t.type,this._map,t))}mouseup(t){this._map.fire(new $s(t.type,this._map,t))}preclick(t){const o=n.h({},t);o.type="preclick",this._map.fire(new $s(o.type,this._map,o))}click(t,o){this._mousedownPos&&this._mousedownPos.dist(o)>=this._clickTolerance||(this.preclick(t),this._map.fire(new $s(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new $s(t.type,this._map,t))}mouseover(t){this._map.fire(new $s(t.type,this._map,t))}mouseout(t){this._map.fire(new $s(t.type,this._map,t))}touchstart(t){return this._firePreventable(new _c(t.type,this._map,t))}touchmove(t){this._map.fire(new _c(t.type,this._map,t))}touchend(t){this._map.fire(new _c(t.type,this._map,t))}touchcancel(t){this._map.fire(new _c(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wd{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new $s(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new $s("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new $s(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class zp{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=o.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,o){this.isEnabled()&&t.shiftKey&&t.button===0&&(Oe(),this._startPos=this._lastPos=o,this._active=!0)}mousemoveWindow(t,o){if(!this._active)return;const d=o,_=this._startPos,y=this._lastPos;if(!_||!y||y.equals(d)||!this._box&&d.dist(_)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=pe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const v=Math.min(_.x,d.x),S=Math.max(_.x,d.x),A=Math.min(_.y,d.y),P=Math.max(_.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${v}px,${A}px)`,this._box.style.width=S-v+"px",this._box.style.height=P-A+"px")})}mouseupWindow(t,o){if(!this._active)return;const d=this._startPos,_=o;if(d&&t.button===0){if(this.reset(),Tt(),d.x!==_.x||d.y!==_.y)return this._map.fire(new n.A("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,_,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),tt(),delete this._startPos,delete this._lastPos}_fireEvent(t,o){return this._map.fire(new n.A(t,{originalEvent:o}))}}function Fh(u,t){const o={};for(let d=0;d<u.length;d++)o[u[d].identifier]=t[d];return o}class Gs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,o,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(_){const y=new n.P(0,0);for(const v of _)y._add(v);return y.div(_.length)}(o),this.touches=Fh(d,o)))}touchmove(t,o,d){if(this.aborted||!this.centroid)return;const _=Fh(d,o);for(const y in this.touches){const v=_[y];(!v||v.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,o,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const _=!this.aborted&&this.centroid;if(this.reset(),_)return _}}}class Bh{constructor(t){this.singleTap=new Gs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,o,d){this.singleTap.touchstart(t,o,d)}touchmove(t,o,d){this.singleTap.touchmove(t,o,d)}touchend(t,o,d){const _=this.singleTap.touchend(t,o,d);if(_){const y=t.timeStamp-this.lastTime<500,v=!this.lastTap||this.lastTap.dist(_)<30;if(y&&v||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=_,this.count===this.numTaps)return this.reset(),_}}}class Op{constructor(){this._zoomIn=new Bh({numTouches:1,numTaps:2}),this._zoomOut=new Bh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,o,d){this._zoomIn.touchstart(t,o,d),this._zoomOut.touchstart(t,o,d)}touchmove(t,o,d){this._zoomIn.touchmove(t,o,d),this._zoomOut.touchmove(t,o,d)}touchend(t,o,d){const _=this._zoomIn.touchend(t,o,d),y=this._zoomOut.touchend(t,o,d);return _?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()+1,around:v.unproject(_)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:v=>v.easeTo({duration:300,zoom:v.getZoom()-1,around:v.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const kp={0:1,2:2},Pa={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Nh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,o){return!1}_move(t,o){return{}}mousedown(t,o){if(this._lastPoint)return;const d=Zt(t);this._correctButton(t,d)&&(this._lastPoint=o,this._eventButton=d)}mousemoveWindow(t,o){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(_,y){const v=kp[y];return _.buttons===void 0||(_.buttons&v)!==v}(t,this._eventButton))this.reset();else if(this._moved||!(o.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=o,this._move(d,o)}}mouseupWindow(t){this._lastPoint&&Zt(t)===this._eventButton&&(this._moved&&Tt(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Fp extends Nh{mousedown(t,o){super.mousedown(t,o),this._lastPoint&&(this._active=!0)}_correctButton(t,o){return o===0&&!t.ctrlKey}_move(t,o){return{around:o,panDelta:o.sub(t)}}}class Td extends Nh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Pa[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const d=.8*(o.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class vl extends Nh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Pa[t.pitchRotateKey]:void 0}_correctButton(t,o){return this._pitchRotateKey?o===0&&t[this._pitchRotateKey]:o===0&&t.ctrlKey||o===2}_move(t,o){const d=-.5*(o.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class Bp{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=o.clickTolerance||1,this.reset(),n.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(t,o,d){return this._calculateTransform(t,o,d)}touchmove(t,o,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!n.ex())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,o,d)}}touchend(t,o,d){this._calculateTransform(t,o,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,o,d){d.length>0&&(this._active=!0);const _=Fh(d,o),y=new n.P(0,0),v=new n.P(0,0);let S=0;for(const P in _){const D=_[P],k=this._touches[P];k&&(y._add(D),v._add(D.sub(k)),S++,_[P]=D)}if(this._touches=_,S<this._minTouches||!v.mag())return;const A=v.div(S);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(S),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Vh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,o,d){return{}}touchstart(t,o,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([o[0],o[1]]))}touchmove(t,o,d){const _=this._firstTwoTouches;if(!_)return;t.preventDefault();const[y,v]=_,S=gc(d,o,y),A=gc(d,o,v);if(!S||!A)return;const P=this._aroundCenter?null:S.add(A).div(2);return this._move([S,A],P,t)}touchend(t,o,d){if(!this._firstTwoTouches)return;const[_,y]=this._firstTwoTouches,v=gc(d,o,_),S=gc(d,o,y);v&&S||(this._active&&Tt(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function gc(u,t,o){for(let d=0;d<u.length;d++)if(u[d].identifier===o)return t[d]}function Uh(u,t){return Math.log(u/t)/Math.LN2}class Np extends Vh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,o){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Uh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Uh(this._distance,d),pinchAround:o}}}function Sd(u,t){return 180*u.angleWith(t)/Math.PI}class _g extends Vh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,o){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Sd(this._vector,d),pinchAround:o}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const o=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const _=Sd(t,d);return Math.abs(_)<o}}function Ed(u){return Math.abs(u.y)>Math.abs(u.x)}class gg extends Vh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Ed(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,o,d){const _=this._lastPoints;if(!_)return;const y=t[0].sub(_[0]),v=t[1].sub(_[1]);return this._map._cooperativeGestures&&!n.ex()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,v,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+v.y)/2*-.5})}gestureBeginsVertically(t,o,d){if(this._valid!==void 0)return this._valid;const _=t.mag()>=2,y=o.mag()>=2;if(!_&&!y)return;if(!_||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const v=t.y>0==o.y>0;return Ed(t)&&Ed(o)&&v}}const yg={panStep:100,bearingStep:15,pitchStep:10};class xg{constructor(){const t=yg;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let o=0,d=0,_=0,y=0,v=0;switch(t.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?_=1:(t.preventDefault(),v=-1);break;case 40:t.shiftKey?_=-1:(t.preventDefault(),v=1);break;default:return}return this._rotationDisabled&&(d=0,_=0),{cameraAnimation:S=>{const A=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:vg,zoom:o?Math.round(A)+o*(t.shiftKey?2:1):A,bearing:S.getBearing()+d*this._bearingStep,pitch:S.getPitch()+_*this._pitchStep,offset:[-y*this._panStep,-v*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vg(u){return u*(2-u)}const Vp=4.000244140625,bg=1/450;class wg{constructor(t,o){this._map=t,this._el=t.getCanvasContainer(),this._handler=o,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bg,n.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||n.ex()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let o=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=n.q.now(),_=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,o!==0&&o%Vp==0?this._type="wheel":o!==0&&Math.abs(o)<4?this._type="trackpad":_>400?(this._type=null,this._lastValue=o,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(_*o)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,o+=this._lastValue)),t.shiftKey&&o&&(o/=4),this._type&&(this._lastWheelEvent=t,this._delta-=o,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const o=At(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:o,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const o=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>Vp?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&D!==0&&(D=1/D);const k=o(),z=Math.pow(2,k),F=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(F*D))),this._type==="wheel"&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:o(),_=this._startZoom,y=this._easing;let v,S=!1;if(this._type==="wheel"&&_&&y){const P=Math.min((n.q.now()-this._lastWheelEventTime)/200,1),D=y(P);v=n.ai(_,d,D),P<1?this._frameId||(this._frameId=!0):S=!0}else v=d,S=!0;this._active=!0,S&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let A=v-o();return A*this._lastDelta<0&&(A=0),{noInertia:!0,needsRenderFrame:!S,zoomDelta:A,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let o=n.ey;if(this._prevEase){const d=this._prevEase,_=(n.q.now()-d.start)/d.duration,y=d.easing(_+.01)-d.easing(_),v=.27/Math.sqrt(y*y+1e-4)*.01,S=Math.sqrt(.0729-v*v);o=n.ew(v,S,.25,1)}return this._prevEase={start:n.q.now(),duration:t,easing:o},o}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=pe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Tg{constructor(t,o){this._clickZoom=t,this._tapZoom=o}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sg{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,o){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(o)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eg{constructor(){this._tap=new Bh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,o,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=o[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,o,d))}touchmove(t,o,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const _=o[0],y=_.y-this._swipePoint.y;return this._swipePoint=_,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,o,d)}touchend(t,o,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,o,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ag{constructor(t,o,d){this._el=t,this._mousePan=o,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class zv{constructor(t,o,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=o,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ov{constructor(t,o,d,_){this._el=t,this._touchZoom=o,this._touchRotate=d,this._tapDragZoom=_,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ad=u=>u.zoom||u.drag||u.pitch||u.rotate;class ts extends n.A{}class Ig{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,o){const d=n.at([],o,t);this.radius=n.ae(d[2]<0?n.eA([],d,this.constants):[d[0],d[1],0])}projectRay(t){n.eA(t,t,this.constants),n.au(t,t),n.eB(t,t,this.constants);const o=n.bY([],t,this.radius);if(o[2]>0){const d=n.bY([],[0,0,1],n.bG(o,[0,0,1])),_=n.bY([],n.au([],[o[0],o[1],0]),this.radius),y=n.cV([],o,n.bY([],n.at([],n.cV([],_,d),o),2));o[0]=y[0],o[1]=y[1]}return o}}function Id(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}class Up{constructor(t,o){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bd(t),this._bearingSnap=o.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ig,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(o),n.aV(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[_,y,v]of this._listeners){const S=_===document?this.handleWindowEvent:this.handleEvent;_.addEventListener(y,S,v)}}destroy(){for(const[t,o,d]of this._listeners){const _=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(o,_,d)}}_addDefaultHandlers(t){const o=this._map,d=o.getCanvasContainer();this._add("mapEvent",new Lp(o,t));const _=o.boxZoom=new zp(o,t);this._add("boxZoom",_);const y=new Op,v=new Sg;o.doubleClickZoom=new Tg(v,y),this._add("tapZoom",y),this._add("clickZoom",v);const S=new Eg;this._add("tapDragZoom",S);const A=o.touchPitch=new gg(o);this._add("touchPitch",A);const P=new Td(t),D=new vl(t);o.dragRotate=new zv(t,P,D),this._add("mouseRotate",P,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const k=new Fp(t),z=new Bp(o,t);o.dragPan=new Ag(d,k,z),this._add("mousePan",k),this._add("touchPan",z,["touchZoom","touchRotate"]);const F=new _g,G=new Np;o.touchZoomRotate=new Ov(d,G,F,S),this._add("touchRotate",F,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new wd(o));const j=o.scrollZoom=new wg(o,this);this._add("scrollZoom",j,["mousePan"]);const H=o.keyboard=new xg;this._add("keyboard",H);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Z]&&o[Z].enable(t[Z])}_add(t,o,d){this._handlers.push({handlerName:t,handler:o,allowed:d}),this._handlersById[t]=o}stop(t){if(!this._updatingCamera){for(const{handler:o}of this._handlers)o.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ad(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,o,d){for(const _ in t)if(_!==d&&(!o||o.indexOf(_)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const o=[];for(const d of t)this._el.contains(d.target)&&o.push(d);return o}handleEvent(t,o){this._updatingCamera=!0;const d=t.type==="renderFrame",_=d?void 0:t,y={needsRenderFrame:!1},v={},S={},A=t.touches?this._getMapTouches(t.touches):void 0,P=A?Wt(this._el,A):d?void 0:At(this._el,t);for(const{handlerName:z,handler:F,allowed:G}of this._handlers){if(!F.isEnabled())continue;let j;this._blockedByActive(S,G,z)?F.reset():F[o||t.type]&&(j=F[o||t.type](t,P,A),this.mergeHandlerResult(y,v,j,z,_),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||F.isActive())&&(S[z]=F)}const D={};for(const z in this._previousActiveHandlers)S[z]||(D[z]=_);this._previousActiveHandlers=S,(Object.keys(D).length||Id(y))&&(this._changes.push([y,v,D]),this._triggerRenderFrame()),(Object.keys(S).length||Id(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:k}=y;k&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],k(this._map))}mergeHandlerResult(t,o,d,_,y){if(!d)return;n.h(t,d);const v={handlerName:_,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(o.zoom=v),d.panDelta!==void 0&&(o.drag=v),d.pitchDelta!==void 0&&(o.pitch=v),d.bearingDelta!==void 0&&(o.rotate=v)}_applyChanges(){const t={},o={},d={};for(const[_,y,v]of this._changes)_.panDelta&&(t.panDelta=(t.panDelta||new n.P(0,0))._add(_.panDelta)),_.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+_.zoomDelta),_.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+_.bearingDelta),_.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+_.pitchDelta),_.around!==void 0&&(t.around=_.around),_.aroundCoord!==void 0&&(t.aroundCoord=_.aroundCoord),_.pinchAround!==void 0&&(t.pinchAround=_.pinchAround),_.noInertia&&(t.noInertia=_.noInertia),n.h(o,y),n.h(d,v);this._updateMapTransform(t,o,d),this._changes=[]}_updateMapTransform(t,o,d){const _=this._map,y=_.transform,v=K=>[K.x,K.y,K.z];if((K=>{const re=this._eventsInProgress.drag;return re&&!this._handlersById[re.handlerName].isActive()})()&&!Id(t)){const K=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),K!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&_._stop(!0),!Id(t))return void this._fireEvents(o,d,!0);let{panDelta:S,zoomDelta:A,bearingDelta:P,pitchDelta:D,around:k,aroundCoord:z,pinchAround:F}=t;y._isCameraConstrained&&(A>0&&(A=0),y._isCameraConstrained=!1),F!==void 0&&(k=F),(A||(K=>o[K]&&!this._eventsInProgress[K])("drag"))&&k&&(this._dragOrigin=v(y.pointCoordinate3D(k)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",_._stop(!0),k=k||_.transform.centerPoint,P&&(y.bearing+=P),D&&(y.pitch+=D),y._updateCameraState();const G=[0,0,0];if(S)if(y.projection.name==="mercator"){const K=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k).dir),re=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(k.sub(S)).dir);G[0]=re[0]-K[0],G[1]=re[1]-K[1]}else{const K=y.pointCoordinate(k);if(y.projection.name==="globe"){S=S.rotate(-y.angle);const re=y._pixelsPerMercatorPixel/y.worldSize;G[0]=-S.x*n.ez(n.aY(K.y))*re,G[1]=-S.y*n.ez(y.center.lat)*re}else{const re=y.pointCoordinate(k.sub(S));K&&re&&(G[0]=re.x-K.x,G[1]=re.y-K.y)}}const j=y.zoom,H=[0,0,0];if(A){const K=v(z||y.pointCoordinate3D(k)),re={dir:n.au([],n.at([],K,y._camera.position))};if(re.dir[2]<0){const ce=y.zoomDeltaToMovement(K,A);n.bY(H,re.dir,ce)}}const Z=n.cV(G,G,H);y._translateCameraConstrained(Z),A&&Math.abs(y.zoom-j)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(o,d,!0)}_fireEvents(t,o,d){const _=Ad(this._eventsInProgress),y=Ad(t),v={};for(const D in t){const{originalEvent:k}=t[D];this._eventsInProgress[D]||(v[`${D}start`]=k),this._eventsInProgress[D]=t[D]}!_&&y&&this._fireEvent("movestart",y.originalEvent);for(const D in v)this._fireEvent(D,v[D]);y&&this._fireEvent("move",y.originalEvent);for(const D in t){const{originalEvent:k}=t[D];this._fireEvent(D,k)}const S={};let A;for(const D in this._eventsInProgress){const{handlerName:k,originalEvent:z}=this._eventsInProgress[D];this._handlersById[k].isActive()||(delete this._eventsInProgress[D],A=o[k]||z,S[`${D}end`]=A)}for(const D in S)this._fireEvent(D,S[D]);const P=Ad(this._eventsInProgress);if(d&&(_||y)&&!P){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),k=z=>z!==0&&-this._bearingSnap<z&&z<this._bearingSnap;D?(k(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:A})):(this._map.fire(new n.A("moveend",{originalEvent:A})),k(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,o){this._map.fire(new n.A(t,o?{originalEvent:o}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new ts("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Cg="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class jh extends n.E{constructor(t,o){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=o.bearingSnap,this._respectPrefersReducedMotion=o.respectPrefersReducedMotion!==!1,n.aV(["_renderFrameCallback"],this)}getCenter(){return new n.cd(this.transform.center.lng,this.transform.center.lat)}setCenter(t,o){return this.jumpTo({center:t},o)}panBy(t,o,d){return t=n.P.convert(t).mult(-1),this.panTo(this.transform.center,n.h({offset:t},o),d)}panTo(t,o,d){return this.easeTo(n.h({center:t},o),d)}getZoom(){return this.transform.zoom}setZoom(t,o){return this.jumpTo({zoom:t},o),this}zoomTo(t,o,d){return this.easeTo(n.h({zoom:t},o),d)}zoomIn(t,o){return this.zoomTo(this.getZoom()+1,t,o),this}zoomOut(t,o){return this.zoomTo(this.getZoom()-1,t,o),this}getBearing(){return this.transform.bearing}setBearing(t,o){return this.jumpTo({bearing:t},o),this}getPadding(){return this.transform.padding}setPadding(t,o){return this.jumpTo({padding:t},o),this}rotateTo(t,o,d){return this.easeTo(n.h({bearing:t},o),d)}resetNorth(t,o){return this.rotateTo(0,n.h({duration:1e3},t),o),this}resetNorthPitch(t,o){return this.easeTo(n.h({bearing:0,pitch:0,duration:1e3},t),o),this}snapToNorth(t,o){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,o):this}getPitch(){return this.transform.pitch}setPitch(t,o){return this.jumpTo({pitch:t},o),this}cameraForBounds(t,o){t=n.aG.convert(t);const d=o&&o.bearing||0,_=o&&o.pitch||0,y=t.getNorthWest(),v=t.getSouthEast();return this._cameraForBounds(this.transform,y,v,d,_,o)}_extendPadding(t){const o={top:0,right:0,bottom:0,left:0};return t==null?n.h({},o,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:n.h({},o,t)}_extendCameraOptions(t){return(t=n.h({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,o){const d=o.max[0]-o.min[0],_=o.max[1]-o.min[1];return d/_>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):_/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,o,d,_,y,v){const S=t.clone(),A=this._extendCameraOptions(v);S.bearing=_,S.pitch=y;const P=n.cd.convert(o),D=n.cd.convert(d),k=.5*(P.lat+D.lat),z=.5*(P.lng+D.lng),F=n.eC(k,z),G=n.au([],F),j=n.au([],n.bF([],G,[0,1,0])),H=n.bF([],j,G),Z=[j[0],j[1],j[2],0,H[0],H[1],H[2],0,G[0],G[1],G[2],0,0,0,0,1],K=[F,n.eC(P.lat,P.lng),n.eC(D.lat,P.lng),n.eC(D.lat,D.lng),n.eC(P.lat,D.lng),n.eC(k,P.lng),n.eC(k,D.lng),n.eC(P.lat,z),n.eC(D.lat,z)];let re=n.cW.fromPoints(K.map(Be=>[n.bG(j,Be),n.bG(H,Be),n.bG(G,Be)]));const ce=n.ad([],re.center,Z);n.eD(ce)===0&&n.eE(ce,0,0,1),n.au(ce,ce),n.bY(ce,ce,n.aB),S.center=n.eF(ce);const me=S.getWorldToCameraMatrix(),fe=n.bi(new Float64Array(16),me);re=n.cW.applyTransform(re,n.az([],me,Z));const ue=this._extendAABB(re,S,A,_);if(!ue)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");re=ue,n.ad(ce,ce,me);const he=.5*(re.max[2]-re.min[2]),_e=this._minimumAABBFrustumDistance(S,re),ye=n.bY([],[0,0,1],he),Le=n.cV(ye,ce,ye),ze=_e+(S.pitch===0?0:n.bD(ce,Le)),qe=S.globeCenterInViewSpace,Xe=n.at([],ce,[qe[0],qe[1],qe[2]]);n.au(Xe,Xe),n.bY(Xe,Xe,ze);const st=n.cV([],ce,Xe);n.ad(st,st,fe);const De=n.eq/n.aB,je=n.ae(st),Te=n.c6(Math.max(je*De-n.eq,Number.EPSILON),0),Ke=Math.min(S.zoomFromMercatorZAdjusted(Te),A.maxZoom);return Ke>.5*(n.cL+n.cx)?(S.setProjection({name:"mercator"}),S.zoom=Ke,this._cameraForBounds(S,o,d,_,y,v)):{center:S.center,zoom:Ke,bearing:_,pitch:y}}_extendAABB(t,o,d,_){const y=.5*((d.padding.left||0)+(d.padding.right||0)),v=.5*((d.padding.top||0)+(d.padding.bottom||0)),S=v,A=y,P=y,D=v,k=o.width-(A+P),z=o.height-(S+D),F=n.at([],t.max,t.min),G=Math.min(k/F[0],z/F[1]),j=Math.min(o.scaleZoom(o.scale*G),d.maxZoom);if(isNaN(j))return null;const H=o.scale/o.zoomScale(j),Z=new n.cW([t.min[0]-A*H,t.min[1]-D*H,t.min[2]],[t.max[0]+P*H,t.max[1]+S*H,t.max[2]]),K=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new n.P(d.offset.x,d.offset.y):n.P.convert(d.offset)).rotate(-n.al(_));return Z.center[0]-=K.x*H,Z.center[1]+=K.y*H,Z}queryTerrainElevation(t,o){const d=this.transform.elevation;return d?(o=n.h({},{exaggerated:!0},o),d.getAtPoint(n.ac.fromLngLat(t),null,o.exaggerated)):null}_cameraForBounds(t,o,d,_,y,v){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,o,d,_,y,v);const S=t.clone(),A=this._extendCameraOptions(v);S.bearing=_,S.pitch=y;const P=n.cd.convert(o),D=n.cd.convert(d),k=new n.cd(P.lng,D.lat),z=new n.cd(D.lng,P.lat),F=S.project(P),G=S.project(D),j=this.queryTerrainElevation(P),H=this.queryTerrainElevation(D),Z=this.queryTerrainElevation(k),K=this.queryTerrainElevation(z),re=[[F.x,F.y,Math.min(j||0,H||0,Z||0,K||0)],[G.x,G.y,Math.max(j||0,H||0,Z||0,K||0)]];let ce=n.cW.fromPoints(re);const me=S.getWorldToCameraMatrix(),fe=n.bi(new Float64Array(16),me);ce=n.cW.applyTransform(ce,me);const ue=this._extendAABB(ce,S,A,_);if(!ue)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ce=ue;const he=.5*n.at([],ce.max,ce.min)[2],_e=this._minimumAABBFrustumDistance(S,ce),ye=[0,0,1,0];n.aA(ye,ye,me),n.eG(ye,ye);const Le=n.bY([],ye,_e+he),ze=n.cV([],ce.center,Le);n.ad(ce.center,ce.center,fe),n.ad(ze,ze,fe);const qe=S.unproject(new n.P(ce.center[0],ce.center[1])),Xe=n.eH(S.projection,qe),st=Math.pow(2,Xe),De=Math.min(S._zoomFromMercatorZ(ze[2]*S.pixelsPerMeter*st/S.worldSize),A.maxZoom);return S.mercatorFromTransition&&De<.5*(n.cL+n.cx)?(S.setProjection({name:"globe"}),S.zoom=De,this._cameraForBounds(S,o,d,_,y,v)):{center:qe,zoom:De,bearing:_,pitch:y}}fitBounds(t,o,d){const _=this.cameraForBounds(t,o);return this._fitInternal(_,o,d)}fitScreenCoordinates(t,o,d,_,y){const v=n.P.convert(t),S=n.P.convert(o),A=new n.P(Math.min(v.x,S.x),Math.min(v.y,S.y)),P=new n.P(Math.max(v.x,S.x),Math.max(v.y,S.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(v,S))return this;const D=this.transform.pointLocation3D(A),k=this.transform.pointLocation3D(P),z=this.transform.pointLocation3D(new n.P(A.x,P.y)),F=this.transform.pointLocation3D(new n.P(P.x,A.y)),G=[Math.min(D.lng,k.lng,z.lng,F.lng),Math.min(D.lat,k.lat,z.lat,F.lat)],j=[Math.max(D.lng,k.lng,z.lng,F.lng),Math.max(D.lat,k.lat,z.lat,F.lat)],H=_&&_.pitch?_.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,G,j,d,H,_);return this._fitInternal(Z,_,y)}_fitInternal(t,o,d){return t?(o=n.h(t,o)).linear?this.easeTo(o,d):this.flyTo(o,d):this}jumpTo(t,o){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let _=!1,y=!1,v=!1;"zoom"in t&&d.zoom!==+t.zoom&&(_=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=n.cd.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(v=!0,d.pitch=+t.pitch);const S=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(S))if(t.retainPadding===!1){const A=d.clone();A.padding=S,d.setLocationAtPoint(d.center,A.centerPoint)}else d.padding=S;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new n.A("movestart",o)).fire(new n.A("move",o)),_&&this.fire(new n.A("zoomstart",o)).fire(new n.A("zoom",o)).fire(new n.A("zoomend",o)),y&&this.fire(new n.A("rotatestart",o)).fire(new n.A("rotate",o)).fire(new n.A("rotateend",o)),v&&this.fire(new n.A("pitchstart",o)).fire(new n.A("pitch",o)).fire(new n.A("pitchend",o)),this.fire(new n.A("moveend",o)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Cg),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,o){const d=this.transform;if(!d.projection.supportsFreeCamera)return n.w(Cg),this;this.stop();const _=d.zoom,y=d.pitch,v=d.bearing;d.setFreeCameraOptions(t);const S=_!==d.zoom,A=y!==d.pitch,P=v!==d.bearing;return this.fire(new n.A("movestart",o)).fire(new n.A("move",o)),S&&this.fire(new n.A("zoomstart",o)).fire(new n.A("zoom",o)).fire(new n.A("zoomend",o)),P&&this.fire(new n.A("rotatestart",o)).fire(new n.A("rotate",o)).fire(new n.A("rotateend",o)),A&&this.fire(new n.A("pitchstart",o)).fire(new n.A("pitch",o)).fire(new n.A("pitchend",o)),this.fire(new n.A("moveend",o)),this}easeTo(t,o){this._stop(!1,t.easeId),((t=n.h({offset:[0,0],duration:500,easing:n.ey},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,_=this.getZoom(),y=this.getBearing(),v=this.getPitch(),S=this.getPadding(),A="zoom"in t?+t.zoom:_,P="bearing"in t?this._normalizeBearing(t.bearing,y):y,D="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),z=n.P.convert(t.offset);let F,G,j;if(d.projection.name==="globe"){const ye=n.ac.fromLngLat(d.center),Le=z.rotate(-d.angle);ye.x+=Le.x/d.worldSize,ye.y+=Le.y/d.worldSize;const ze=ye.toLngLat(),qe=n.cd.convert(t.center||ze);this._normalizeCenter(qe),F=d.centerPoint.add(Le),G=new n.P(ye.x,ye.y).mult(d.worldSize),j=new n.P(n.aD(qe.lng),n.aH(qe.lat)).mult(d.worldSize).sub(G)}else{F=d.centerPoint.add(z);const ye=d.pointLocation(F),Le=n.cd.convert(t.center||ye);this._normalizeCenter(Le),G=d.project(ye),j=d.project(Le).sub(G)}const H=d.zoomScale(A-_);let Z,K;t.around&&(Z=n.cd.convert(t.around),K=d.locationPoint(Z));const re=this._zooming||A!==_,ce=this._rotating||y!==P,me=this._pitching||D!==v,fe=!d.isPaddingEqual(k),ue=t.retainPadding===!1?d.clone():d,he=ye=>Le=>{if(re&&(ye.zoom=n.ai(_,A,Le)),ce&&(ye.bearing=n.ai(y,P,Le)),me&&(ye.pitch=n.ai(v,D,Le)),fe&&(ue.interpolatePadding(S,k,Le),F=ue.centerPoint.add(z)),Z)ye.setLocationAtPoint(Z,K);else{const ze=ye.zoomScale(ye.zoom-_),qe=A>_?Math.min(2,H):Math.max(.5,H),Xe=Math.pow(qe,1-Le),st=ye.unproject(G.add(j.mult(Le*Xe)).mult(ze));ye.setLocationAtPoint(ye.renderWorldCopies?st.wrap():st,F)}return t.preloadOnly||this._fireMoveEvents(o),ye};if(t.preloadOnly){const ye=this._emulate(he,t.duration,d);return this._preloadTiles(ye),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=re,this._rotating=ce,this._pitching=me,this._padding=fe,this._easeId=t.easeId,this._prepareEase(o,t.noMoveStart,_e),this._ease(he(d),ye=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(o,ye)},t),this}_prepareEase(t,o,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),o||d.moving||this.fire(new n.A("movestart",t)),this._zooming&&!d.zooming&&this.fire(new n.A("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new n.A("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new n.A("pitchstart",t))}_fireMoveEvents(t){this.fire(new n.A("move",t)),this._zooming&&this.fire(new n.A("zoom",t)),this._rotating&&this.fire(new n.A("rotate",t)),this._pitching&&this.fire(new n.A("pitch",t))}_afterEase(t,o){if(this._easeId&&o&&this._easeId===o)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,_=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new n.A("zoomend",t)),_&&this.fire(new n.A("rotateend",t)),y&&this.fire(new n.A("pitchend",t)),this.fire(new n.A("moveend",t))}flyTo(t,o){if(this._prefersReducedMotion(t)){const Be=n.aF(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Be,o)}this.stop(),t=n.h({offset:[0,0],speed:1.2,curve:1.42,easing:n.ey},t);const d=this.transform,_=this.getZoom(),y=this.getBearing(),v=this.getPitch(),S=this.getPadding(),A="zoom"in t?n.ay(+t.zoom,d.minZoom,d.maxZoom):_,P="bearing"in t?this._normalizeBearing(t.bearing,y):y,D="pitch"in t?+t.pitch:v,k=this._extendPadding(t.padding),z=d.zoomScale(A-_),F=n.P.convert(t.offset);let G=d.centerPoint.add(F);const j=d.pointLocation(G),H=n.cd.convert(t.center||j);this._normalizeCenter(H);const Z=d.project(j),K=d.project(H).sub(Z);let re=t.curve;const ce=Math.max(d.width,d.height),me=ce/z,fe=K.mag();if("minZoom"in t){const Be=n.ay(Math.min(t.minZoom,_,A),d.minZoom,d.maxZoom),it=ce/d.zoomScale(Be-_);re=Math.sqrt(it/fe*2)}const ue=re*re;function he(Be){const it=(me*me-ce*ce+(Be?-1:1)*ue*ue*fe*fe)/(2*(Be?me:ce)*ue*fe);return Math.log(Math.sqrt(it*it+1)-it)}function _e(Be){return(Math.exp(Be)-Math.exp(-Be))/2}function ye(Be){return(Math.exp(Be)+Math.exp(-Be))/2}const Le=he(0);let ze=function(Be){return ye(Le)/ye(Le+re*Be)},qe=function(Be){return ce*((ye(Le)*(_e(it=Le+re*Be)/ye(it))-_e(Le))/ue)/fe;var it},Xe=(he(1)-Le)/re;if(Math.abs(fe)<1e-6||!isFinite(Xe)){if(Math.abs(ce-me)<1e-6)return this.easeTo(t,o);const Be=me<ce?-1:1;Xe=Math.abs(Math.log(me/ce))/re,qe=function(){return 0},ze=function(it){return Math.exp(Be*re*it)}}t.duration="duration"in t?+t.duration:1e3*Xe/("screenSpeed"in t?+t.screenSpeed/re:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const st=y!==P,De=D!==v,je=!d.isPaddingEqual(k),Te=t.retainPadding===!1?d.clone():d,Ke=Be=>it=>{const ft=it*Xe,Ye=1/ze(ft);Be.zoom=it===1?A:_+Be.scaleZoom(Ye),st&&(Be.bearing=n.ai(y,P,it)),De&&(Be.pitch=n.ai(v,D,it)),je&&(Te.interpolatePadding(S,k,it),G=Te.centerPoint.add(F));const ut=it===1?H:Be.unproject(Z.add(K.mult(qe(ft))).mult(Ye));return Be.setLocationAtPoint(Be.renderWorldCopies?ut.wrap():ut,G),Be._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(o),Be};if(t.preloadOnly){const Be=this._emulate(Ke,t.duration,d);return this._preloadTiles(Be),this}return this._zooming=!0,this._rotating=st,this._pitching=De,this._padding=je,this._prepareEase(o,!1),this._ease(Ke(d),()=>this._afterEase(o),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,o){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,o)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,o,d){d.animate===!1||d.duration===0?(t(1),o()):(this._easeStart=n.q.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=o,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((n.q.now()-this._easeStart)/this._easeOptions.duration,1),o=this._onEaseFrame;o&&o(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,o){t=n.bX(t,-180,180);const d=Math.abs(t-o);return Math.abs(t-360-o)<d&&(t-=360),Math.abs(t+360-o)<d&&(t+=360),t}_normalizeCenter(t){const o=this.transform;if(o.maxBounds||o.projection.name!=="globe"&&!o.renderWorldCopies)return;const d=t.lng-o.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&n.q.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,o,d){const _=Math.ceil(15*o/1e3),y=[],v=t(d.clone());for(let S=0;S<=_;S++){const A=v(S/_);y.push(A.clone())}return y}_preloadTiles(t,o){}}class jp{constructor(t={}){this.options=t,n.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const o=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=pe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const _=pe("span","mapboxgl-ctrl-icon",this._compactButton);return _.setAttribute("aria-hidden","true"),_.setAttribute("title",d),this._innerContainer=pe("div","mapboxgl-ctrl-attrib-inner",this._container),o&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),o===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const o=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(t){const d=o.reduce((_,y,v)=>(y.value&&(_+=`${y.key}=${y.value}${v<o.length-1?"&":""}`),_),"?");t.href=`${n.e.FEEDBACK_URL}/${d}#${vd(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const _=this._map.style.stylesheet;this.styleOwner=_.owner,this.styleId=_.id}const o=this._map.style._mergedSourceCaches;for(const _ in o){const y=o[_];if(y.used){const v=y.getSource();v.attribution&&t.indexOf(v.attribution)<0&&t.push(v.attribution)}}t.sort((_,y)=>_.length-y.length),t=t.filter((_,y)=>{for(let v=y+1;v<t.length;v++)if(t[v].indexOf(_)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Cd{constructor(){n.aV(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=pe("div","mapboxgl-ctrl");const o=pe("a","mapboxgl-ctrl-logo");return o.target="_blank",o.rel="noopener nofollow",o.href="https://www.mapbox.com/",o.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),o.setAttribute("rel","noopener nofollow"),this._container.appendChild(o),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const o in t){const d=t[o].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const o=t[0];this._map.getCanvasContainer().offsetWidth<250?o.classList.add("mapboxgl-compact"):o.classList.remove("mapboxgl-compact")}}}class $h{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const o=++this._id;return this._queue.push({callback:t,id:o,cancelled:!1}),o}remove(t){const o=this._currentlyRunning,d=o?this._queue.concat(o):this._queue;for(const _ of d)if(_.id===t)return void(_.cancelled=!0)}run(t=0){const o=this._currentlyRunning=this._queue;this._queue=[];for(const d of o)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class ta{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const o=n.dk((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-o)+this._end*o}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,o,d){this._start=this.getValue(o),this._end=t,this._startTime=o,this._endTime=o+d}}const Md={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class us extends n.A{constructor(t,o,d,_){const{point:y,lngLat:v,originalEvent:S,target:A}=t;super(t.type,{point:y,lngLat:v,originalEvent:S,target:A}),this.preventDefault=()=>{t.preventDefault()},this.id=o,this.interaction=d,this.feature=_}}class Io{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,o){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=o.filter;let _=o.type;d&&this.filters.set(t,n.b3(d)),_==="mouseover"&&(_="mouseenter"),_==="mouseout"&&(_="mouseleave");const y=this.interactionsByType.get(_)||new Map;_==="mouseenter"||_==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,o)):y.size===0&&this.map.on(_,this.handleType),y.size===0&&this.interactionsByType.set(_,y),y.set(t,o),this.typeById.set(t,_)}get(t){const o=this.typeById.get(t);if(!o)return;const d=this.interactionsByType.get(o);return d?d.get(t):void 0}remove(t){const o=this.typeById.get(t);if(!o)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(o);d&&(d.delete(t),o==="mouseenter"||o==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(o,this.handleType))}queryTargets(t,o){const d=[];for(const[_,y]of o)y.target&&d.push({targetId:_,target:y.target,filter:this.filters.get(_)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const o=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());o.length&&(t.type="mouseenter",this.handleType(t,o));const d=new Map;for(const[_,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(_)||d.set(y.id,y);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const o=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);o.length&&(t.type="mouseleave",this.handleType(t,o)),this.hoveredFeatures.clear()}handleType(t,o){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void n.w("mouseenter interaction required for mouseleave to work.");const _=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!o;o=o||this.queryTargets(t.point,_);let v=!1;const S=new Set;for(const A of o){for(const[P,D]of _){if(!D.target)continue;const k=A.variants?A.variants[P]:null;if(k){for(const z of k){if(Lu(z,A,S,P))continue;const F=new n.de(A,z),G=ih(z,A,P);y&&(F.state=this.map.getFeatureState(F));const j=d?this.prevHoveredFeatures.get(G):null,H=new us(t,P,D,F),Z=j?j.stop:D.handler(H);if(d&&this.hoveredFeatures.set(G,{feature:A,stop:Z}),Z!==!1){v=!0;break}}if(v)break}}if(v)break}if(!v)for(const[A,P]of _){const{handler:D,target:k}=P;if(!k&&D(new us(t,A,P,null))!==!1)break}}}function Gh(u,t){if(Array.isArray(u)&&Array.isArray(t)){const o=new Set(u),d=new Set(t);return o.size===d.size&&u.every(_=>d.has(_))}return n.bv(u,t)}const Pd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Mg={showCompass:!0,showZoom:!0,visualizePitch:!1};class kv{constructor(t,o,d=!1){this._clickTolerance=10,this.element=o,this.mouseRotate=new Td({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new vl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),n.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),o.addEventListener("mousedown",this.mousedown),o.addEventListener("touchstart",this.touchstart,{passive:!1}),o.addEventListener("touchmove",this.touchmove),o.addEventListener("touchend",this.touchend),o.addEventListener("touchcancel",this.reset)}down(t,o){this.mouseRotate.mousedown(t,o),this.mousePitch&&this.mousePitch.mousedown(t,o),Oe()}move(t,o){const d=this.map,_=this.mouseRotate.mousemoveWindow(t,o),y=_&&_.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const v=this.mousePitch.mousemoveWindow(t,o),S=v&&v.pitchDelta;S&&d.setPitch(d.getPitch()+S)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){tt(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(n.h({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),At(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,At(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Wt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Wt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function yc(u,t,o){if(u=new n.cd(u.lng,u.lat),t){const d=new n.cd(u.lng-360,u.lat),_=new n.cd(u.lng+360,u.lat),y=360*Math.ceil(Math.abs(u.lng-o.center.lng)/360),v=o.locationPoint3D(u).distSqr(t),S=t.x<0||t.y<0||t.x>o.width||t.y>o.height;o.locationPoint3D(d).distSqr(t)<v&&(S||Math.abs(d.lng-o.center.lng)<y)?u=d:o.locationPoint3D(_).distSqr(t)<v&&(S||Math.abs(_.lng-o.center.lng)<y)&&(u=_)}for(;Math.abs(u.lng-o.center.lng)>180;){const d=o.locationPoint3D(u);if(d.x>=0&&d.y>=0&&d.x<=o.width&&d.y<=o.height)break;u.lng>o.center.lng?u.lng-=360:u.lng+=360}return u}const $p={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Co={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Hh extends n.E{constructor(t,o){super(),(t instanceof HTMLElement||o)&&(t=n.h({element:t},o)),n.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:_="#3FB1CE",scale:y=1,draggable:v=!1,clickTolerance:S=0,rotation:A=Co.rotation,rotationAlignment:P=Co.rotationAlignment,pitchAlignment:D=Co.pitchAlignment,occludedOpacity:k=Co.occludedOpacity,altitude:z=Co.altitude}=t||{};this._anchor=d,this._color=_,this._scale=y,this._draggable=v,this._clickTolerance=S,this._rotation=A,this._rotationAlignment=P,this._pitchAlignment=D,this._occludedOpacity=k,this._altitude=z,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=n.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",j=>{j.preventDefault()}),this._element.addEventListener("mousedown",j=>{j.preventDefault()});const F=this._element.classList;for(const j in $p)F.remove(`mapboxgl-marker-anchor-${j}`);F.add(`mapboxgl-marker-anchor-${this._anchor}`);const G=t&&t.className?t.className.trim().split(/\s+/):[];F.add(...G),this._popup=null}_createDefaultMarker(){const t=pe("div"),o=Ae("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=Ae("radialGradient",{id:"shadowGradient"},Ae("defs",{},o));Ae("stop",{offset:"10%","stop-opacity":.4},d),Ae("stop",{offset:"100%","stop-opacity":.05},d),Ae("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},o)}return Ae("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},o),Ae("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},o),Ae("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},o),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=n.cd.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||Co.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const _=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[_,-1*(38.1-13.5+_)],"bottom-right":[-_,-1*(38.1-13.5+_)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const o=t.code,d=t.charCode||t.keyCode;o!=="Space"&&o!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const o=t.originalEvent.target,d=this._element;this._popup&&(o===d||d.contains(o))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,o=this._pos;if(!t||!o)return!1;const d=t.unproject(o,this._altitude),_=t.getFreeCameraOptions();if(!_.position)return!1;const y=_.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const o=this._pos;if(!o||o.x<0||o.x>t.transform.width||o.y<0||o.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(o,this._altitude);let _;t._showingGlobe()&&n.eK(t.transform,this._lngLat)?_=0:(_=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(_*=this._occludedOpacity)),this._element.style.opacity=`${_}`,this._element.style.pointerEvents=_>0?"auto":"none",this._popup&&this._popup._setOpacity(_),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const o=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${$p[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${o.x}px,${o.y}px)
        `}_calculateXYTransform(){const t=this._pos,o=this._map,d=this.getPitchAlignment();if(!o||!t||d!=="map")return"";if(!o._showingGlobe()){const A=o.getPitch();return A?`rotateX(${A}deg)`:""}const _=n.cJ(n.eL(o.transform,this._lngLat)),y=t.sub(n.eM(o.transform)),v=Math.abs(y.x)+Math.abs(y.y);if(v===0)return"";const S=_/v;return`rotateX(${-y.y*S}deg) rotateY(${y.x*S}deg)`}_calculateZTransform(){const t=this._pos,o=this._map;if(!o||!t)return"";let d=0;const _=this.getRotationAlignment();if(_==="map")if(o._showingGlobe()){const y=o.project(new n.cd(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),v=o.project(new n.cd(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);d=n.cJ(Math.atan2(v.y,v.x))-90}else d=-o.getBearing();else if(_==="horizon"){const y=n.af(4,6,o.getZoom()),v=n.eM(o.transform);v.y+=y*o.transform.height;const S=t.sub(v),A=n.cJ(Math.atan2(S.y,S.x));d=(A>90?A-270:A+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const o=this._map;o&&(o.transform.renderWorldCopies&&(this._lngLat=yc(this._lngLat,this._pos,o.transform)),this._pos=o.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),o._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(o._showingGlobe()||o.getTerrain()||o.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=n.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const o=this._map;if(!o)return;const d=this._pointerdownPos,_=this._positionDelta;if(d&&_){if(!this._isDragging){const y=this._clickTolerance||o._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(_),this._lngLat=o.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.A("dragstart"))),this.fire(new n.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.A("dragend")),this._state="inactive"}_addDragHandler(t){const o=this._map,d=this._pos;o&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",o.on("mousemove",this._onMove),o.on("touchmove",this._onMove),o.once("mouseup",this._onUp),o.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const o=this._map;return o&&(t?(o.on("mousedown",this._addDragHandler),o.on("touchstart",this._addDragHandler)):(o.off("mousedown",this._addDragHandler),o.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||Co.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||Co.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||Co.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||Co.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Gp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Wh={maxWidth:100,unit:"metric"},xc={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},ia={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},lo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Yr(u=new n.P(0,0),t="bottom"){if(typeof u=="number"){const o=Math.round(Math.sqrt(.5*Math.pow(u,2)));switch(t){case"top":return new n.P(0,u);case"top-left":return new n.P(o,o);case"top-right":return new n.P(-o,o);case"bottom":return new n.P(0,-u);case"bottom-left":return new n.P(o,-o);case"bottom-right":return new n.P(-o,-o);case"left":return new n.P(u,0);case"right":return new n.P(-u,0)}return new n.P(0,0)}return u instanceof n.P||Array.isArray(u)?n.P.convert(u):n.P.convert(u[t]||[0,0])}return{version:R,supported:we.supported,setRTLTextPlugin:n.eQ,getRTLTextPluginStatus:n.eP,Map:class extends jh{constructor(u){N.mark(B.create);const t=u;if((u=n.h({},Pd,u)).minZoom!=null&&u.maxZoom!=null&&u.minZoom>u.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(u.minPitch!=null&&u.maxPitch!=null&&u.minPitch>u.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(u.minPitch!=null&&u.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(u.maxPitch!=null&&u.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(u.antialias&&n.eI(window)&&(u.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Yf(u.minZoom,u.maxZoom,u.minPitch,u.maxPitch,u.renderWorldCopies,null,null),u),this._repaint=!!u.repaint,this._interactive=u.interactive,this._minTileCacheSize=u.minTileCacheSize,this._maxTileCacheSize=u.maxTileCacheSize,this._failIfMajorPerformanceCaveat=u.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=u.preserveDrawingBuffer,this._antialias=u.antialias,this._trackResize=u.trackResize,this._bearingSnap=u.bearingSnap,this._refreshExpiredTiles=u.refreshExpiredTiles,this._fadeDuration=u.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=u.crossSourceCollisions,this._collectResourceTiming=u.collectResourceTiming,this._language=this._parseLanguage(u.language),this._worldview=u.worldview,this._renderTaskQueue=new $h,this._domRenderTaskQueue=new $h,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.a$(),this._locale=n.h({},Md,u.locale),this._clickTolerance=u.clickTolerance,this._cooperativeGestures=u.cooperativeGestures,this._performanceMetricsCollection=u.performanceMetricsCollection,this._tessellationStep=u.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=u.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new ta(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=u.scaleFactor,this._requestManager=new _i(u.transformRequest,u.accessToken,u.testMode),this._silenceAuthErrors=!!u.testMode,this._contextCreateOptions=u.contextCreateOptions?Object.assign({},u.contextCreateOptions):{},typeof u.container=="string"){const o=document.getElementById(u.container);if(!o)throw new Error(`Container '${u.container.toString()}' not found.`);this._container=o}else{if(!(u.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=u.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),u.maxBounds&&this.setMaxBounds(u.maxBounds),this._spriteFormat=u.spriteFormat,n.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new Ip),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Up(this,u),this._localFontFamily=u.localFontFamily,this._localIdeographFontFamily=u.localIdeographFontFamily,(u.style||!u.testMode)&&this.setStyle(u.style||n.e.DEFAULT_STYLE,{config:u.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),u.projection&&this.setProjection(u.projection),this.indoor=new sv(this),u.hash&&(this._hash=new Dp(typeof u.hash=="string"&&u.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:u.center,zoom:u.zoom,bearing:u.bearing,pitch:u.pitch});const o=u.bounds;o&&(this.resize(),this.fitBounds(o,n.h({},u.fitBoundsOptions,{duration:0})))}this.resize(),u.attributionControl&&this.addControl(new jp({customAttribution:u.customAttribution})),this._logoControl=new Cd,this.addControl(this._logoControl,u.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",o=>{this._update(o.dataType==="style"),this.fire(new n.A(`${o.dataType}data`,o))}),this.on("dataloading",o=>{this.fire(new n.A(`${o.dataType}dataloading`,o))}),this._interactions=new Io(this)}_getMapId(){return this._mapId}addControl(u,t){if(t===void 0&&(t=u.getDefaultPosition?u.getDefaultPosition():"top-right"),!u||!u.onAdd)return this.fire(new n.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const o=u.onAdd(this);this._controls.push(u);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(o,d.firstChild):d.appendChild(o),this}removeControl(u){if(!u||!u.onRemove)return this.fire(new n.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(u);return t>-1&&this._controls.splice(t,1),u.onRemove(this),this}hasControl(u){return this._controls.indexOf(u)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(u){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new n.A("movestart",u)).fire(new n.A("move",u)),this.fire(new n.A("resize",u)),t&&this.fire(new n.A("moveend",u)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(u){return this.transform.setMaxBounds(n.aG.convert(u)),this._update()}setMinZoom(u){if((u=u??-2)>=-2&&u<=this.transform.maxZoom)return this.transform.minZoom=u,this._update(),this.getZoom()<u?this.setZoom(u):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(u){if((u=u??22)>=this.transform.minZoom)return this.transform.maxZoom=u,this._update(),this.getZoom()>u?this.setZoom(u):this.fire(new n.A("zoomstart")).fire(new n.A("zoom")).fire(new n.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(u){if((u=u??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(u>=0&&u<=this.transform.maxPitch)return this.transform.minPitch=u,this._update(),this.getPitch()<u?this.setPitch(u):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(u){if((u=u??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(u>=this.transform.minPitch)return this.transform.maxPitch=u,this._update(),this.getPitch()>u?this.setPitch(u):this.fire(new n.A("pitchstart")).fire(new n.A("pitch")).fire(new n.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(u){return this._scaleFactor=u,this.painter.scaleFactor=u,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(u){return this.transform.renderWorldCopies=u,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(u){return u==="auto"?navigator.language:Array.isArray(u)?u.length===0?void 0:u.map(t=>t==="auto"?navigator.language:t):u}setLanguage(u){const t=this._parseLanguage(u);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const o of this._controls)o._setLanguage&&o._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(u){return this.style&&u!==this._worldview?(this._worldview=u,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(u){return this._lazyInitEmptyStyle(),u?typeof u=="string"&&(u={name:u}):u=null,this._useExplicitProjection=!!u,this._prioritizeAndUpdateProjection(u,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const u=this.transform,t=u.projection.name;let o;t==="globe"&&u.zoom>=n.cx?(u.setMercatorFromTransition(),o=!0):t==="mercator"&&u.zoom<n.cx&&(u.setProjection({name:"globe"}),o=!0),o&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(u,t){return this._updateProjection(u||t||{name:"mercator"})}_updateProjection(u){let t;return t=u.name==="globe"&&this.transform.zoom>=n.cx?this.transform.setMercatorFromTransition():this.transform.setProjection(u),this.style.applyProjectionUpdate(),t&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(u,t){return this.transform.locationPoint3D(n.cd.convert(u),t)}unproject(u,t){return this.transform.pointLocation3D(n.P.convert(u),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(u,t,o){const d=_=>{let y=[];if(Array.isArray(t)){const v=t.filter(S=>this.getLayer(S));y=v.length?this.queryRenderedFeatures(_,{layers:v}):[]}else y=this.queryRenderedFeatures(_,{target:t});return y};if(u==="mouseenter"||u==="mouseover"){let _=!1;return{listener:o,targets:t,delegates:{mousemove:v=>{const S=d(v.point);S.length?_||(_=!0,o.call(this,new $s(u,this,v.originalEvent,{features:S}))):_=!1},mouseout:()=>{_=!1}}}}if(u==="mouseleave"||u==="mouseout"){let _=!1;return{listener:o,targets:t,delegates:{mousemove:S=>{d(S.point).length?_=!0:_&&(_=!1,o.call(this,new $s(u,this,S.originalEvent)))},mouseout:S=>{_&&(_=!1,o.call(this,new $s(u,this,S.originalEvent)))}}}}{const _=y=>{const v=d(y.point);v.length&&(y.features=v,o.call(this,y),delete y.features)};return{listener:o,targets:t,delegates:{[u]:_}}}}on(u,t,o){if(typeof t=="function"||o===void 0)return super.on(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,o);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[u]=this._delegatedListeners[u]||[],this._delegatedListeners[u].push(d);for(const _ in d.delegates)this.on(_,d.delegates[_]);return this}once(u,t,o){if(typeof t=="function"||o===void 0)return super.once(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(u,t,o);for(const _ in d.delegates)this.once(_,d.delegates[_]);return this}off(u,t,o){if(typeof t=="function"||o===void 0)return super.off(u,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[u]:void 0;return d&&(_=>{for(let y=0;y<_.length;y++){const v=_[y];if(v.listener===o&&Gh(v.targets,t)){for(const S in v.delegates)this.off(S,v.delegates[S]);return _.splice(y,1),this}}})(d),this}queryRenderedFeatures(u,t){if(!this.style)return[];if(u===void 0||u instanceof n.P||Array.isArray(u)||t!==void 0||(t=u,u=void 0),u=u||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(u,void 0,this.transform),v=this.style.queryRenderedFeatureset(u,void 0,this.transform);return y.concat(v)}let o=!0;if(t.target&&(o=this._isTargetValid(t.target),o&&!t.layers))return this.style.queryRenderedFeatureset(u,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(u,t,this.transform)}let _=[];return d&&(_=_.concat(this.style.queryRenderedFeatures(u,t,this.transform))),o&&(_=_.concat(this.style.queryRenderedFeatureset(u,t,this.transform))),_}querySourceFeatures(u,t){return!u||typeof u=="string"&&!this._isValidId(u)?[]:this.style.querySourceFeatures(u,t)}isPointOnSurface(u){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&n.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(u))}addInteraction(u,t){return this._interactions.add(u,t),this}removeInteraction(u){return this._interactions.remove(u),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(u){return this._cooperativeGestures=u,this}setStyle(u,t){return t=n.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&u&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(u,(o,d)=>{if(o){const _=typeof o=="string"?o:o instanceof Error?o.message:o.error;n.w(`Unable to perform style diff: ${_}. Rebuilding the style from scratch.`),this._updateStyle(u,t)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(u,t))}_getUIString(u){const t=this._locale[u];if(t==null)throw new Error(`Missing UI string '${u}'`);return t}_updateStyle(u,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),u){const o=n.h({},t);t&&t.config&&(o.initialConfig=t.config,delete o.config),this.style=new ir(this,o).load(u),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ir(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(u){return u==null?(this.fire(new n.z(new Error("IDs can't be empty."))),!1):!n.d8(u)||(this.fire(new n.z(new Error(`IDs can't contain special symbols: "${u}".`))),!1)}_isTargetValid(u){return"featuresetId"in u?this._isValidId("importId"in u?u.importId:u.featuresetId):"layerId"in u&&this._isValidId(u.layerId)}_areTargetsValid(u){if(Array.isArray(u)){for(const t of u)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(u)}addSource(u,t){return this._isValidId(u)?(this._lazyInitEmptyStyle(),this.style.addSource(u,t),this._update(!0)):this}isSourceLoaded(u){return!!this._isValidId(u)&&!!this.style&&this.style._isSourceCacheLoaded(u)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(u,t,o){this._lazyInitEmptyStyle(),this.style.addSourceType(u,t,o)}removeSource(u){return this._isValidId(u)?(this.style.removeSource(u),this._updateTerrain(),this._update(!0)):this}getSource(u){return this._isValidId(u)?this.style.getOwnSource(u):null}addImage(u,t,{pixelRatio:o=1,sdf:d=!1,stretchX:_,stretchY:y,content:v}={}){this._lazyInitEmptyStyle();const S=n.I.from(u);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:A,height:P,data:D}=n.q.getImageData(t);this.style.addImage(S,{data:new n.r({width:A,height:P},D),pixelRatio:o,stretchX:_,stretchY:y,content:v,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new n.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:A,height:P}=t,D=t;this.style.addImage(S,{data:new n.r({width:A,height:P},new Uint8Array(D.data)),pixelRatio:o,stretchX:_,stretchY:y,content:v,sdf:d,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,u)}}updateImage(u,t){this._lazyInitEmptyStyle();const o=n.I.from(u),d=this.style.getImage(o);if(!d)return void this.fire(new n.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?n.q.getImageData(t):t,{width:y,height:v,data:S}=_;if(y===void 0||v===void 0)return void this.fire(new n.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||v!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new n.z(new Error(`The width and height of the updated image (${y}, ${v})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const A=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let P=!1;d.usvg?(d.data=new n.r({width:y,height:v},new Uint8Array(S)),d.usvg=!1,d.icon=void 0,P=!0):d.data.replace(S,A),this.style.updateImage(o,d,P)}hasImage(u){return u?!!this.style&&!!this.style.getImage(n.I.from(u)):(this.fire(new n.z(new Error("Missing required image id"))),!1)}removeImage(u){this.style.removeImage(n.I.from(u))}loadImage(u,t){n.o(this._requestManager.transformRequest(u,n.R.Image),(o,d)=>{t(o,d instanceof HTMLImageElement?n.q.getImageData(d):d)})}listImages(){return this.style.listImages().map(u=>u.name)}addModel(u,t){this._lazyInitEmptyStyle(),this.style.addModel(u,t)}hasModel(u){return u?this.style.hasModel(u):(this.fire(new n.z(new Error("Missing required model id"))),!1)}removeModel(u){this.style.removeModel(u)}listModels(){return this.style.listModels()}addLayer(u,t){return this._isValidId(u.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(u,t),this._update(!0)):this}getSlot(u){const t=this.getLayer(u);return t&&t.slot||null}setSlot(u,t){return this.style.setSlot(u,t),this.style.mergeLayers(),this._update(!0)}addImport(u,t){return this.style.addImport(u,t).catch(o=>this.fire(new n.z(new Error("Failed to add import",o)))),this}updateImport(u,t){return typeof t!="string"&&t.id!==u?(this.removeImport(u),this.addImport(t)):(this.style.updateImport(u,t),this._update(!0))}removeImport(u){return this.style.removeImport(u),this}moveImport(u,t){return this.style.moveImport(u,t),this._update(!0)}moveLayer(u,t){return this._isValidId(u)?(this.style.moveLayer(u,t),this._update(!0)):this}removeLayer(u){return this._isValidId(u)?(this.style.removeLayer(u),this._update(!0)):this}getLayer(u){if(!this._isValidId(u))return null;const t=this.style.getOwnLayer(u);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(u,t,o){return this._isValidId(u)?(this.style.setLayerZoomRange(u,t,o),this._update(!0)):this}setFilter(u,t,o={}){return this._isValidId(u)?(this.style.setFilter(u,t,o),this._update(!0)):this}getFilter(u){return this._isValidId(u)?this.style.getFilter(u):null}setPaintProperty(u,t,o,d={}){return this._isValidId(u)?(this.style.setPaintProperty(u,t,o,d),this._update(!0)):this}getPaintProperty(u,t){return this._isValidId(u)?this.style.getPaintProperty(u,t):null}setLayoutProperty(u,t,o,d={}){return this._isValidId(u)?(this.style.setLayoutProperty(u,t,o,d),this._update(!0)):this}getLayoutProperty(u,t){return this._isValidId(u)?this.style.getLayoutProperty(u,t):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(u){return this.style.setGlyphsUrl(u),this._update(!0)}getSchema(u){return this.style.getSchema(u)}setSchema(u,t){return this.style.setSchema(u,t),this._update(!0)}getConfig(u){return this.style.getConfig(u)}setConfig(u,t){return this.style.setConfig(u,t),this._update(!0)}getConfigProperty(u,t){return this.style.getConfigProperty(u,t)}setConfigProperty(u,t,o){return this.style.setConfigProperty(u,t,o),this._update(!0)}getFeaturesetDescriptors(u){return this.style.getFeaturesetDescriptors(u)}setLights(u){if(this._lazyInitEmptyStyle(),u&&u.length===1&&u[0].type==="flat"){const t=u[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(u),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const u=this.style.getLights()||[];return u.length===0&&u.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),u}setLight(u,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:u}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(u){return this._lazyInitEmptyStyle(),!u&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(u),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(u){return this._lazyInitEmptyStyle(),this.style.setFog(u),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(u){return this._lazyInitEmptyStyle(),this.style.setSnow(u),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(u){return this._lazyInitEmptyStyle(),this.style.setRain(u),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(u){return this._lazyInitEmptyStyle(),this.style.setColorTheme(u),this._update(!0)}setImportColorTheme(u,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(u,t),this._update(!0)}setCamera(u){return this.style.setCamera(u),this._triggerCameraUpdate(u)}_triggerCameraUpdate(u){return this._update(this.transform.setOrthographicProjectionAtLowPitch(u["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(u){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.cd.convert(u),this.transform):0}setFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.setFeatureState(u,t),this._update())}removeFeatureState(u,t){return u.source&&!this._isValidId(u.source)?this:(this.style.removeFeatureState(u,t),this._update())}getFeatureState(u){return u.source&&!this._isValidId(u.source)?null:this.style.getFeatureState(u)}_updateContainerDimensions(){if(!this._container)return;const u=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let o,d,_,y=this._container;for(;y&&(!d||!_);){const v=window.getComputedStyle(y).transform;v&&v!=="none"&&(o=v.match(/matrix.*\((.+)\)/)[1].split(", "),o[0]&&o[0]!=="0"&&o[0]!=="1"&&(d=o[0]),o[3]&&o[3]!=="0"&&o[3]!=="1"&&(_=o[3])),y=y.parentElement}this._containerWidth=d?Math.abs(u/d):u,this._containerHeight=_?Math.abs(t/_):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const u=this._container;u.classList.add("mapboxgl-map"),(this._missingCSSCanary=pe("div","mapboxgl-canary",u)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=pe("div","mapboxgl-canvas-container",u);this._canvas=pe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const o=this._controlContainer=pe("div","mapboxgl-control-container",u),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(_=>{d[_]=pe("div",`mapboxgl-ctrl-${_}`,o)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(u,t){const o=n.q.devicePixelRatio||1;this._canvas.width=o*Math.ceil(u),this._canvas.height=o*Math.ceil(t),this._canvas.style.width=`${u}px`,this._canvas.style.height=`${t}px`}_addMarker(u){this._markers.push(u)}_removeMarker(u){const t=this._markers.indexOf(u);t!==-1&&this._markers.splice(t,1)}_addPopup(u){this._popups.push(u)}_removePopup(u){const t=this._popups.indexOf(u);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const u=n.h({},we.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",u);t?(Js(t,!0),this.painter=new dc(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",o=>{o.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),n.l.testSupport(t)):this.fire(new n.z(new Error("Failed to initialize WebGL")))}_contextLost(u){u.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.A("webglcontextlost",{originalEvent:u}))}_contextRestored(u){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.A("webglcontextrestored",{originalEvent:u}))}_onMapScroll(u){if(u.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(u){return this.style?(this._styleDirty=this._styleDirty||u,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(u){return this._update(),this._renderTaskQueue.add(u)}_cancelRenderFrame(u){this._renderTaskQueue.remove(u)}_requestDomTask(u){!this.loaded()||this.loaded()&&!this.isMoving()?u():this._domRenderTaskQueue.add(u)}_render(u){let t;this.fire(new n.A("renderstart")),++this._frameId;const o=this.painter.context.extTimerQuery,d=n.q.now(),_=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=_.createQuery(),_.beginQuery(o.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(u),this._domRenderTaskQueue.run(u),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const P=this.transform.zoom,D=this.transform.pitch,k=n.q.now(),z=new n.aa(P,{now:k,fadeDuration:y,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let v=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),v=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):v=this._updateAverageElevation(d);const S=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),S&&(this._placementDirty=S.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,N.mark(B.load),this.fire(new n.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const P=n.q.now()-d;_.endQuery(o.TIME_ELAPSED_EXT),setTimeout(()=>{const D=_.getQueryParameter(t,_.QUERY_RESULT)/1e6;_.deleteQuery(t),this.fire(new n.A("gpu-timing-frame",{cpuTime:P,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const P=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(P);this.fire(new n.A("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const P=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(P);this.fire(new n.A("gpu-timing-deferred-render",{gpuTime:D}))},50)}const A=this._sourcesDirty||this._styleDirty||this._placementDirty||v;if(A||this._repaint)this.triggerRepaint();else{const P=this.idle();if(P&&(v=this._updateAverageElevation(d,!0)),v)this.triggerRepaint();else if(this._triggerFrame(!1),P&&(this.fire(new n.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new n.A("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||A||(this._fullyLoaded=!0,N.mark(B.fullLoad),this._performanceMetricsCollection&&xs(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(u){for(const t of this._markers)u&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!u||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(u,t=!1){const o=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&o(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||u-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(u)){const _=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=u;const v=Math.abs(_-y);if(v>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),o(y);this._averageElevation.easeTo(y,u,300)}else if(v>1e-4)return this._averageElevation.jumpTo(y),o(y)}return!!this._averageElevation.isEasing(u)&&o(this._averageElevation.getValue(u))}_authenticate(){pr(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,u=>{if(u&&(u.message===gi||u.status===401)){const t=this.painter.context.gl;Js(t,!1),this._logoControl instanceof Cd&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Is(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&en(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const u=this._isDragging();this.painter.updateTerrain(this.style,u)}_calculateSpeedIndex(){const u=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const o=this.painter.context.gl,d=o.createFramebuffer();function _(y){o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0,o.TEXTURE_2D,y,0);const v=new Uint8Array(o.drawingBufferWidth*o.drawingBufferHeight*4);return o.readPixels(0,0,o.drawingBufferWidth,o.drawingBufferHeight,o.RGBA,o.UNSIGNED_BYTE,v),v}return o.bindFramebuffer(o.FRAMEBUFFER,d),this._canvasPixelComparison(_(u),t.canvasCopies.map(_),t.timeStamps)}_canvasPixelComparison(u,t,o){let d=o[1]-o[0];const _=u.length/4;for(let y=0;y<t.length;y++){const v=t[y];let S=0;for(let A=0;A<v.length;A+=4)v[A]===u[A]&&v[A+1]===u[A+1]&&v[A+2]===u[A+2]&&v[A+3]===u[A+3]&&(S+=1);d+=(o[y+2]-o[y+1])*(1-S/_)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const u=this.painter.context.gl.getExtension("WEBGL_lose_context");u&&u.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ks.delete(this.painter.context.gl),fn.remove(),Fs.remove(),this._removed=!0,this.fire(new n.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(u){this._renderNextFrame=this._renderNextFrame||u,this.style&&!this._frame&&(this._frame=n.q.frame(t=>{const o=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,o&&this._render(t)}))}_preloadTiles(u){const t=this.style?this.style.getSourceCaches():[];return n.bt(t,(o,d)=>o._preloadTiles(u,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(u){this._trackResize&&this.resize({originalEvent:u})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(u){this._showTileBoundaries!==u&&(this._showTileBoundaries=u,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(u){this._showParseStatus!==u&&(this._showParseStatus=u,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(u){this._showTerrainWireframe!==u&&(this._showTerrainWireframe=u,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(u){this._showLayers2DWireframe!==u&&(this._showLayers2DWireframe=u,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(u){this._showLayers3DWireframe!==u&&(this._showLayers3DWireframe=u,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(u){this._speedIndexTiming!==u&&(this._speedIndexTiming=u,this._update())}get showPadding(){return!!this._showPadding}set showPadding(u){this._showPadding!==u&&(this._showPadding=u,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(u){this._showCollisionBoxes!==u&&(this._showCollisionBoxes=u,this._tp.refreshUI(),u?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(u){this._showOverdrawInspector!==u&&(this._showOverdrawInspector=u,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(u){this._repaint!==u&&(this._repaint=u,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(u){this._vertices=u,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(u){this._showTileAABBs!==u&&(this._showTileAABBs=u,this._tp.refreshUI(),u&&this._update())}_setCacheLimits(u,t){n.eJ(u,t)}get version(){return R}},NavigationControl:class{constructor(u={}){this.options=n.h({},Mg,u),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(n.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),pe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),pe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const o=this._map;o&&(this.options.visualizePitch?o.resetNorthPitch({},{originalEvent:t}):o.resetNorth({},{originalEvent:t}))}),this._compassIcon=pe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const u=this._map;if(!u)return;const t=u.getZoom(),o=t===u.getMaxZoom(),d=t===u.getMinZoom();this._zoomInButton.disabled=o,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",o.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const u=this._map;if(!u)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(u.transform.pitch*(Math.PI/180)),.5)}) rotateX(${u.transform.pitch}deg) rotateZ(${u.transform.angle*(180/Math.PI)}deg)`:`rotate(${u.transform.angle*(180/Math.PI)}deg)`;u._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),u.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&u.on("pitch",this._rotateCompassArrow),u.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new kv(u,this._compass,this.options.visualizePitch)),this._container}onRemove(){const u=this._map;u&&(this._container.remove(),this.options.showZoom&&u.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&u.off("pitch",this._rotateCompassArrow),u.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(u,t){const o=pe("button",u,this._container);return o.type="button",o.addEventListener("click",t),o}_setButtonTitle(u,t){if(!this._map)return;const o=this._map._getUIString(`NavigationControl.${t}`);u.setAttribute("aria-label",o),u.firstElementChild&&u.firstElementChild.setAttribute("title",o)}},GeolocateControl:class extends n.E{constructor(u={}){super();const t=navigator.geolocation;this.options=n.h({geolocation:t},Gp,u),n.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ia(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(u){return this._map=u,this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(u){const t=(o=!!this.options.geolocation)=>{this._supportsGeolocation=o,u(o)};this._supportsGeolocation!==void 0?u(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(o=>t(o.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(u){const t=this._map.getMaxBounds(),o=u.coords;return!!t&&(o.longitude<t.getWest()||o.longitude>t.getEast()||o.latitude<t.getSouth()||o.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(u){if(this._map){if(this._isOutOfMapMaxBounds(u))return this._setErrorState(),this.fire(new n.A("outofmaxbounds",u)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=u,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(u),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(u),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("geolocate",u)),this._finish()}}_updateCamera(u){const t=new n.cd(u.coords.longitude,u.coords.latitude),o=u.coords.accuracy,d=this._map.getBearing(),_=n.h({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(o),_,{geolocateSource:!0})}_updateMarker(u){if(u){const t=new n.cd(u.coords.longitude,u.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=u.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const u=this._map.transform,t=n.c6(1,u._center.lat)*u.worldSize,o=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${o}px`,this._circleElement.style.height=`${o}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(u){if(this._map){if(this.options.trackUserLocation)if(u.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(u.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.A("error",u)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(u){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=pe("button","mapboxgl-ctrl-geolocate",this._container),pe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",u===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=pe("div","mapboxgl-user-location"),this._dotElement.appendChild(pe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(pe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Hh({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=pe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Hh({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.A("trackuserlocationend")))})}}_onDeviceOrientation(u){this._userLocationDotMarker&&(u.webkitCompassHeading?this._heading=u.webkitCompassHeading:u.absolute===!0&&(this._heading=-1*u.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let u;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(u={maximumAge:6e5,timeout:0},this._noTimeout=!0):(u=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,u),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const u=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&u()}).catch(console.error):u()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:jp,ScaleControl:class{constructor(u={}){this.options=n.h({},Wh,u),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),n.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const u=this.options.maxWidth||100,t=this._map,o=t._containerHeight/2,d=t._containerWidth/2-u/2,_=t.unproject([d,o]),y=t.unproject([d+u,o]),v=_.distanceTo(y);if(this.options.unit==="imperial"){const S=3.2808*v;S>5280?this._setScale(u,S/5280,"mile"):this._setScale(u,S,"foot")}else this.options.unit==="nautical"?this._setScale(u,v/1852,"nautical-mile"):v>=1e3?this._setScale(u,v/1e3,"kilometer"):this._setScale(u,v,"meter")}_setScale(u,t,o){this._map._requestDomTask(()=>{const d=function(y){const v=Math.pow(10,`${Math.floor(y)}`.length-1);let S=y/v;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(A){const P=Math.pow(10,Math.ceil(-Math.log(A)/Math.LN10));return Math.round(A*P)/P}(S),v*S}(t),_=d/t;this._container.innerHTML=this._isNumberFormatSupported&&o!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:o}).format(d):`${d}&nbsp;${xc[o]}`,this._container.style.width=u*_+"px"})}onAdd(u){return this._map=u,this._language=u.getLanguage(),this._container=pe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(u){this._language=u,this._update()}setUnit(u){this.options.unit=u,this._update()}},FullscreenControl:class{constructor(u={}){this._fullscreen=!1,u&&u.container&&(u.container instanceof HTMLElement?this._container=u.container:n.w("Full screen control 'container' must be a DOM element.")),n.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=pe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const u=this._fullscreenButton=pe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);pe("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden","true"),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",u)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends n.E{constructor(u){super(),this.options=n.h(Object.create(ia),u),this._altitude=this.options.altitude,n.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(u&&u.className?u.className.trim().split(/\s+/):[])}addTo(u){return this._map&&this.remove(),this._map=u,this.options.closeOnClick&&u.on("preclick",this._onClose),this.options.closeOnMove&&u.on("move",this._onClose),u.on("remove",this.remove),this._update(),u._addPopup(this),this._focusFirstElement(),this._trackPointer?(u.on("mousemove",this._onMouseEvent),u.on("mouseup",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")):u.on("move",this._update),this.fire(new n.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const u=this._map;return u&&(u.off("move",this._update),u.off("move",this._onClose),u.off("preclick",this._onClose),u.off("click",this._onClose),u.off("remove",this.remove),u.off("mousemove",this._onMouseEvent),u.off("mouseup",this._onMouseEvent),u.off("drag",this._onMouseEvent),u._canvasContainer&&u._canvasContainer.classList.remove("mapboxgl-track-pointer"),u._removePopup(this),this._map=void 0),this.fire(new n.A("close")),this}getLngLat(){return this._lngLat}setLngLat(u){this._lngLat=n.cd.convert(u),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(u){return this._altitude=u,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const u=this._map;return u&&(u.off("move",this._update),u.on("mousemove",this._onMouseEvent),u.on("drag",this._onMouseEvent),u._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(u){return this.setDOMContent(document.createTextNode(u))}setHTML(u){const t=document.createDocumentFragment(),o=document.createElement("body");let d;for(o.innerHTML=u;d=o.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(u){return this.options.maxWidth=u,this._update(),this}setDOMContent(u){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=pe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(u),this.options.closeButton){const o=this._closeButton=pe("button","mapboxgl-popup-close-button",t);o.type="button",o.setAttribute("aria-label","Close popup"),o.innerHTML='<span aria-hidden="true">&#215;</span>',o.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(u){return this._classList.add(u),this._updateClassList(),this}removeClassName(u){return this._classList.delete(u),this._updateClassList(),this}setOffset(u){return this.options.offset=u,this._update(),this}toggleClassName(u){let t;return this._classList.delete(u)?t=!1:(this._classList.add(u),t=!0),this._updateClassList(),t}_onMouseEvent(u){this._update(u.point)}_getAnchor(u){if(this.options.anchor)return this.options.anchor;const t=this._map,o=this._container,d=this._pos;if(!t||!o||!d)return"bottom";const _=o.offsetWidth,y=o.offsetHeight,v=d.x<_/2,S=d.x>t.transform.width-_/2;if(d.y+u<y)return v?"top-left":S?"top-right":"top";if(d.y>t.transform.height-y){if(v)return"bottom-left";if(S)return"bottom-right"}return v?"left":S?"right":"bottom"}_updateClassList(){const u=this._container;if(!u)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),u.className=t.join(" ")}_update(u){const t=this._map,o=this._content;if(!t||!this._lngLat&&!this._trackPointer||!o)return;let d=this._container;if(d||(d=this._container=pe("div","mapboxgl-popup",t.getContainer()),this._tip=pe("div","mapboxgl-popup-tip",d),d.appendChild(o)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yc(this._lngLat,this._pos,t.transform)),!this._trackPointer||u){const _=this._pos=this._trackPointer&&u instanceof n.P?u:t.project(this._lngLat,this._altitude),y=Yr(this.options.offset),v=this._anchor=this._getAnchor(y.y),S=Yr(this.options.offset,v),A=_.add(S).round();t._requestDomTask(()=>{this._container&&v&&(this._container.style.transform=`${$p[v]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&t._showingGlobe()){const _=n.eK(t.transform,this._lngLat)?0:1;this._setOpacity(_)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const u=this._container.querySelector(lo);u&&u.focus()}_onClose(){this.remove()}_setOpacity(u){this._container&&(this._container.style.opacity=`${u}`),this._content&&(this._content.style.pointerEvents=u?"auto":"none")}},Marker:Hh,Style:ir,LngLat:n.cd,LngLatBounds:n.aG,Point:n.P,MercatorCoordinate:n.ac,FreeCameraOptions:L_,Evented:n.E,config:n.e,prewarm:n.eO,clearPrewarmedResources:n.eN,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(u){n.e.ACCESS_TOKEN=u},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(u){n.e.API_URL=u},get workerCount(){return n.eX.workerCount},set workerCount(u){n.eX.workerCount=u},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){n.e.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage(u){n.eW(u)},get workerUrl(){return n.eV.workerUrl},set workerUrl(u){n.eV.workerUrl=u},get workerClass(){return n.eV.workerClass},set workerClass(u){n.eV.workerClass=u},get workerParams(){return n.eV.workerParams},set workerParams(u){n.eV.workerParams=u},get dracoUrl(){return n.eU()},set dracoUrl(u){n.eT(u)},get meshoptUrl(){return n.eS()},set meshoptUrl(u){n.eR(u)},setNow:n.q.setNow,restoreNow:n.q.restoreNow}});var E=g;return E})}(ox)),ox.exports}var d3=u3();const Dm=c3(d3),I1=(a,s)=>{const c=a.__vccOpts||a;for(const[m,g]of s)c[m]=g;return c},f3={class:"map-popup p-2"},p3={class:"d-flex justify-content-between align-items-start mb-2"},m3={class:"mb-0"},_3=["href"],g3={class:"text-muted mb-2"},y3={class:"d-flex justify-content-between mb-3"},x3={class:"text-center flex-fill mx-1"},v3={class:"h4 mb-0"},b3={class:"text-center flex-fill mx-1"},w3={class:"h4 mb-0"},T3={key:0,class:"text-center flex-fill mx-1"},S3={class:"h4 mb-0"},E3={key:1,class:"text-center flex-fill mx-1"},A3={class:"h4 mb-0"},I3={class:"list-unstyled"},C3=["href"],M3={class:"h5 mb-0"},P3=["href"],D3={class:"text-muted"},R3={__name:"Popup",props:{location_id:String,location_name:String,location_region:String,submissions:[String,Array],distance_km:Number,duration_min:Number,taxonomic_order:Array,latitude:Number,longitude:Number,hotspot:Boolean},emits:["close"],setup(a,{emit:s}){const c=a,{location_id:m,location_name:g,location_region:b,submissions:E,distance_km:n,duration_min:R,taxonomic_order:B,latitude:N,longitude:X,hotspot:ie}=hO(c),se=vu(()=>{const Je=n.value;return Je?`${+Je.toFixed(2)} km`:null}),we=vu(()=>{const Je=R.value;if(!Je)return null;const Pe=Math.floor(Je/(24*60)),Oe=Math.floor(Je%(24*60)/60),tt=Math.floor(Je%60),xt=[];return Pe&&xt.push(`${Pe}d`),Oe&&xt.push(`${Oe}h`),(tt||xt.length===0)&&xt.push(`${tt}min`),xt.join(" ")}),pe=vu(()=>B.value?.length??0);function Ae(Je){return new Date(Je).toLocaleDateString(void 0,{day:"numeric",month:"short",year:"numeric"})}function Ie(Je){return new Date(Je).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})}return(Je,Pe)=>(Ps(),Ls("div",f3,[fi("div",p3,[fi("h5",m3,[aa(ie)?(Ps(),Ls("a",{key:0,href:`https://ebird.org/hotspot/${aa(m)}`,target:"_blank",rel:"noopener noreferrer",class:"text-decoration-none"},dr(aa(g)),9,_3)):(Ps(),Ls(Us,{key:1},[ca(dr(aa(g)),1)],64))])]),fi("div",g3,dr(aa(b)),1),fi("div",y3,[fi("div",x3,[fi("div",v3,dr(pe.value),1),Pe[0]||(Pe[0]=fi("small",{class:"text-muted"},"Species",-1))]),fi("div",b3,[fi("div",w3,dr(aa(E).length),1),Pe[1]||(Pe[1]=fi("small",{class:"text-muted"},"Checklists",-1))]),we.value!=null?(Ps(),Ls("div",T3,[fi("div",S3,dr(we.value),1),Pe[2]||(Pe[2]=fi("small",{class:"text-muted"},"Duration",-1))])):af("",!0),se.value!=null?(Ps(),Ls("div",E3,[fi("div",A3,dr(se.value),1),Pe[3]||(Pe[3]=fi("small",{class:"text-muted"},"Distance",-1))])):af("",!0)]),Pe[5]||(Pe[5]=fi("hr",null,null,-1)),fi("ul",I3,[(Ps(!0),Ls(Us,null,o_(aa(E),Oe=>(Ps(),Ls("li",{key:Oe.submission_id,class:"d-flex align-items-start gap-3 mb-3"},[fi("a",{href:`https://ebird.org/checklist/${Oe.submission_id}`,target:"_blank",rel:"noopener noreferrer",class:"text-white text-center rounded px-3 py-2",style:{background:"#40718f","min-width":"4rem"}},[fi("div",M3,dr(Oe.taxonomic_order.length),1),Pe[4]||(Pe[4]=fi("small",null,"Species",-1))],8,C3),fi("div",null,[fi("a",{href:`https://ebird.org/checklist/${Oe.submission_id}`,target:"_blank",rel:"noopener noreferrer",class:"text-decoration-none"},[fi("div",null,dr(Ae(Oe.datetime)),1),fi("small",D3,dr(Ie(Oe.datetime)),1)],8,P3)])]))),128))])]))}},L3=I1(R3,[["__scopeId","data-v-e8413ab9"]]),z3={id:"map",style:{height:"100%",width:"100%"}},O3={__name:"MapView",props:{locations:{type:Array,required:!0}},setup(a,{expose:s}){async function c(X){const ie=Wk({render(){return vx(L3,{...X})}});return await sM(ie)}Dm.accessToken="pk.eyJ1IjoicmFmbnVzcyIsImEiOiIzMVE1dnc0In0.3FNMKIlQ_afYktqki-6m0g";const m=a,g=mo(null),b=[];let E=!1;async function n(X){const ie=new Dm.LngLatBounds;for(const se of X){const we=document.createElement("img");we.src=se.hotspot?"/map-marker-hotspot.png":"/map-marker-personal.png";const pe=await c(se),Ae=new Dm.Popup({offset:10,className:"custom-popup",maxWidth:"350px"}).setHTML(pe),Ie=new Dm.Marker({element:we}).setLngLat([se.longitude,se.latitude]).setPopup(Ae).addTo(g.value);Ie.only_incidental=se.only_incidental,Ie.taxonomic_order=se.taxonomic_order,b.push(Ie),ie.extend([se.longitude,se.latitude])}R(E),ie.isEmpty()||g.value.fitBounds(ie,{padding:{top:50,bottom:50,left:500,right:50},maxZoom:10})}function R(X){E=X,b.forEach(ie=>{ie.only_incidental&&(ie.getElement().style.display=X?"block":"none")})}function B(X){b.forEach(ie=>{const we=!X||X.length===0?!0:ie.taxonomic_order.includes(X);ie.getElement().style.display=we?"block":"none"})}s({filterMarkers:B});function N(){const X=document.createElement("div");X.style.position="absolute",X.style.top="10px",X.style.right="10px",X.style.backgroundColor="white",X.style.padding="8px",X.style.fontFamily="Arial, sans-serif",X.style.fontSize="14px",X.style.borderRadius="4px",X.style.boxShadow="0 0 5px rgba(0,0,0,0.3)",X.style.zIndex=10;const ie=document.createElement("label");ie.style.cursor="pointer";const se=document.createElement("input");se.type="checkbox",se.checked=E,se.style.marginRight="6px",se.addEventListener("change",we=>{R(we.target.checked)}),ie.appendChild(se),ie.appendChild(document.createTextNode("Show Casual Observations")),X.appendChild(ie),g.value.getContainer().appendChild(X)}return Nx(()=>{g.value=new Dm.Map({container:"map",style:"mapbox://styles/mapbox/satellite-v9",center:[0,0],zoom:2,logoPosition:"bottom-right"}),g.value.on("load",()=>{fetch("routes.geojson").then(X=>X.json()).then(X=>{g.value.addSource("route",{type:"geojson",data:X}),g.value.addLayer({id:"route-line",type:"line",source:"route",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#ffffff","line-width":2}}),g.value.addLayer({id:"route-points",type:"circle",source:"route",paint:{"circle-radius":3,"circle-color":"#ffffff"}})}),n(m.locations),N()})}),(X,ie)=>(Ps(),Ls("div",z3))}},k3=I1(O3,[["__scopeId","data-v-7b27e603"]]),F3={class:"px-3 py-2"},B3={class:"mb-2"},N3=["value","id"],V3=["for"],U3=["onMouseenter"],j3={type:"button",class:"btn btn-light btn-sm w-100 text-end",disabled:""},$3={class:"fw-semibold me-1"},G3=["href"],H3={__name:"SpeciesList",props:{taxonomy:Array},emits:["update-visible-species"],setup(a,{emit:s}){const c=a,m=s,g=["species","slash","spuh","hybrid"],b=mo(["species","hybrid"]),E=mo(""),n=vu(()=>c.taxonomy.filter(ie=>{const se=b.value.includes(ie.category),we=E.value.toLowerCase().trim(),pe=!we||ie.common_name?.toLowerCase().includes(we)||ie.scientific_name?.toLowerCase().includes(we);return se&&pe})),R=mo("taxonomic_order"),B=mo(!0);function N(ie){R.value===ie?B.value=!B.value:(R.value=ie,B.value=!0)}const X=vu(()=>[...n.value].sort((ie,se)=>{const we=ie[R.value],pe=se[R.value];return typeof we=="string"?B.value?we.localeCompare(pe):pe.localeCompare(we):B.value?we-pe:pe-we}));return(ie,se)=>(Ps(),Ls(Us,null,[se[11]||(se[11]=fi("h2",null,"Species List",-1)),fi("div",F3,[fi("div",B3,[du(fi("input",{type:"text",class:"form-control","onUpdate:modelValue":se[0]||(se[0]=we=>E.value=we),placeholder:"Search species..."},null,512),[[qC,E.value]])]),(Ps(),Ls(Us,null,o_(g,we=>fi("div",{class:"form-check form-check-inline",key:we},[du(fi("input",{class:"form-check-input",type:"checkbox",value:we,"onUpdate:modelValue":se[1]||(se[1]=pe=>b.value=pe),id:`check-${we}`},null,8,N3),[[ZC,b.value]]),fi("label",{class:"form-check-label",for:`check-${we}`},dr(we),9,V3)])),64))]),fi("table",{class:"table table-sm table-borderless align-middle bg-transparent text-nowrap table-hover",onMouseleave:se[5]||(se[5]=we=>m("update-visible-species",[]))},[fi("thead",null,[fi("tr",null,[fi("th",{style:{width:"80px"},onClick:se[2]||(se[2]=we=>N("count")),role:"button",class:"user-select-none"},[se[6]||(se[6]=ca(" Count ")),R.value==="count"?(Ps(),Ls("i",{key:0,class:la(["bi",B.value?"bi-caret-up-fill":"bi-caret-down-fill"])},null,2)):af("",!0)]),fi("th",{onClick:se[3]||(se[3]=we=>N("taxonomic_order")),role:"button",class:"user-select-none"},[se[7]||(se[7]=ca(" Species name ")),R.value==="taxonomic_order"?(Ps(),Ls("i",{key:0,class:la(["bi",B.value?"bi-caret-up-fill":"bi-caret-down-fill"])},null,2)):af("",!0)]),fi("th",{style:{width:"80px"},onClick:se[4]||(se[4]=we=>N("nobs")),role:"button",class:"user-select-none"},[se[8]||(se[8]=ca(" Obs. ")),R.value==="nobs"?(Ps(),Ls("i",{key:0,class:la(["bi",B.value?"bi-caret-up-fill":"bi-caret-down-fill"])},null,2)):af("",!0)])])]),fi("tbody",null,[(Ps(!0),Ls(Us,null,o_(X.value,we=>(Ps(),Ls("tr",{key:we.taxonomic_order,onMouseenter:pe=>m("update-visible-species",we.taxonomic_order)},[fi("td",null,[fi("button",j3,dr(we.count.toLocaleString()),1)]),fi("td",null,[fi("span",$3,dr(we.common_name),1),we.media.length>0?(Ps(),Ls("a",{key:0,href:`https://media.ebird.org/catalog?userId=USER497615&beginMonth=5&endMonth=7&beginYear=2025&endYear=2025&birdOnly=true&sort=rating_rank_desc&unconfirmed=incl&taxonCode=${we.species_code}`,target:"_blank"},se[9]||(se[9]=[fi("i",{class:"bi bi-card-image"},null,-1)]),8,G3)):af("",!0)]),fi("td",null,[se[10]||(se[10]=fi("i",{class:"bi bi-card-checklist"},null,-1)),ca(" "+dr(we.nobs),1)])],40,U3))),128))])],32)],64))}},W3=I1(H3,[["__scopeId","data-v-d1d09a2e"]]);/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function S_(a){return a+.5|0}const kc=(a,s,c)=>Math.max(Math.min(a,c),s);function jm(a){return kc(S_(a*2.55),0,255)}function Uc(a){return kc(S_(a*255),0,255)}function Ml(a){return kc(S_(a/2.55)/100,0,1)}function U2(a){return kc(S_(a*100),0,100)}const Do={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},qb=[..."0123456789ABCDEF"],q3=a=>qb[a&15],Z3=a=>qb[(a&240)>>4]+qb[a&15],Ry=a=>(a&240)>>4===(a&15),X3=a=>Ry(a.r)&&Ry(a.g)&&Ry(a.b)&&Ry(a.a);function Y3(a){var s=a.length,c;return a[0]==="#"&&(s===4||s===5?c={r:255&Do[a[1]]*17,g:255&Do[a[2]]*17,b:255&Do[a[3]]*17,a:s===5?Do[a[4]]*17:255}:(s===7||s===9)&&(c={r:Do[a[1]]<<4|Do[a[2]],g:Do[a[3]]<<4|Do[a[4]],b:Do[a[5]]<<4|Do[a[6]],a:s===9?Do[a[7]]<<4|Do[a[8]]:255})),c}const K3=(a,s)=>a<255?s(a):"";function J3(a){var s=X3(a)?q3:Z3;return a?"#"+s(a.r)+s(a.g)+s(a.b)+K3(a.a,s):void 0}const Q3=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function oM(a,s,c){const m=s*Math.min(c,1-c),g=(b,E=(b+a/30)%12)=>c-m*Math.max(Math.min(E-3,9-E,1),-1);return[g(0),g(8),g(4)]}function eF(a,s,c){const m=(g,b=(g+a/60)%6)=>c-c*s*Math.max(Math.min(b,4-b,1),0);return[m(5),m(3),m(1)]}function tF(a,s,c){const m=oM(a,1,.5);let g;for(s+c>1&&(g=1/(s+c),s*=g,c*=g),g=0;g<3;g++)m[g]*=1-s-c,m[g]+=s;return m}function iF(a,s,c,m,g){return a===g?(s-c)/m+(s<c?6:0):s===g?(c-a)/m+2:(a-s)/m+4}function C1(a){const c=a.r/255,m=a.g/255,g=a.b/255,b=Math.max(c,m,g),E=Math.min(c,m,g),n=(b+E)/2;let R,B,N;return b!==E&&(N=b-E,B=n>.5?N/(2-b-E):N/(b+E),R=iF(c,m,g,N,b),R=R*60+.5),[R|0,B||0,n]}function M1(a,s,c,m){return(Array.isArray(s)?a(s[0],s[1],s[2]):a(s,c,m)).map(Uc)}function P1(a,s,c){return M1(oM,a,s,c)}function nF(a,s,c){return M1(tF,a,s,c)}function sF(a,s,c){return M1(eF,a,s,c)}function aM(a){return(a%360+360)%360}function rF(a){const s=Q3.exec(a);let c=255,m;if(!s)return;s[5]!==m&&(c=s[6]?jm(+s[5]):Uc(+s[5]));const g=aM(+s[2]),b=+s[3]/100,E=+s[4]/100;return s[1]==="hwb"?m=nF(g,b,E):s[1]==="hsv"?m=sF(g,b,E):m=P1(g,b,E),{r:m[0],g:m[1],b:m[2],a:c}}function oF(a,s){var c=C1(a);c[0]=aM(c[0]+s),c=P1(c),a.r=c[0],a.g=c[1],a.b=c[2]}function aF(a){if(!a)return;const s=C1(a),c=s[0],m=U2(s[1]),g=U2(s[2]);return a.a<255?`hsla(${c}, ${m}%, ${g}%, ${Ml(a.a)})`:`hsl(${c}, ${m}%, ${g}%)`}const j2={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},$2={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function lF(){const a={},s=Object.keys($2),c=Object.keys(j2);let m,g,b,E,n;for(m=0;m<s.length;m++){for(E=n=s[m],g=0;g<c.length;g++)b=c[g],n=n.replace(b,j2[b]);b=parseInt($2[E],16),a[n]=[b>>16&255,b>>8&255,b&255]}return a}let Ly;function cF(a){Ly||(Ly=lF(),Ly.transparent=[0,0,0,0]);const s=Ly[a.toLowerCase()];return s&&{r:s[0],g:s[1],b:s[2],a:s.length===4?s[3]:255}}const hF=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function uF(a){const s=hF.exec(a);let c=255,m,g,b;if(s){if(s[7]!==m){const E=+s[7];c=s[8]?jm(E):kc(E*255,0,255)}return m=+s[1],g=+s[3],b=+s[5],m=255&(s[2]?jm(m):kc(m,0,255)),g=255&(s[4]?jm(g):kc(g,0,255)),b=255&(s[6]?jm(b):kc(b,0,255)),{r:m,g,b,a:c}}}function dF(a){return a&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${Ml(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`)}const cb=a=>a<=.0031308?a*12.92:Math.pow(a,1/2.4)*1.055-.055,Jd=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function fF(a,s,c){const m=Jd(Ml(a.r)),g=Jd(Ml(a.g)),b=Jd(Ml(a.b));return{r:Uc(cb(m+c*(Jd(Ml(s.r))-m))),g:Uc(cb(g+c*(Jd(Ml(s.g))-g))),b:Uc(cb(b+c*(Jd(Ml(s.b))-b))),a:a.a+c*(s.a-a.a)}}function zy(a,s,c){if(a){let m=C1(a);m[s]=Math.max(0,Math.min(m[s]+m[s]*c,s===0?360:1)),m=P1(m),a.r=m[0],a.g=m[1],a.b=m[2]}}function lM(a,s){return a&&Object.assign(s||{},a)}function G2(a){var s={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(s={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(s.a=Uc(a[3]))):(s=lM(a,{r:0,g:0,b:0,a:1}),s.a=Uc(s.a)),s}function pF(a){return a.charAt(0)==="r"?uF(a):rF(a)}class u_{constructor(s){if(s instanceof u_)return s;const c=typeof s;let m;c==="object"?m=G2(s):c==="string"&&(m=Y3(s)||cF(s)||pF(s)),this._rgb=m,this._valid=!!m}get valid(){return this._valid}get rgb(){var s=lM(this._rgb);return s&&(s.a=Ml(s.a)),s}set rgb(s){this._rgb=G2(s)}rgbString(){return this._valid?dF(this._rgb):void 0}hexString(){return this._valid?J3(this._rgb):void 0}hslString(){return this._valid?aF(this._rgb):void 0}mix(s,c){if(s){const m=this.rgb,g=s.rgb;let b;const E=c===b?.5:c,n=2*E-1,R=m.a-g.a,B=((n*R===-1?n:(n+R)/(1+n*R))+1)/2;b=1-B,m.r=255&B*m.r+b*g.r+.5,m.g=255&B*m.g+b*g.g+.5,m.b=255&B*m.b+b*g.b+.5,m.a=E*m.a+(1-E)*g.a,this.rgb=m}return this}interpolate(s,c){return s&&(this._rgb=fF(this._rgb,s._rgb,c)),this}clone(){return new u_(this.rgb)}alpha(s){return this._rgb.a=Uc(s),this}clearer(s){const c=this._rgb;return c.a*=1-s,this}greyscale(){const s=this._rgb,c=S_(s.r*.3+s.g*.59+s.b*.11);return s.r=s.g=s.b=c,this}opaquer(s){const c=this._rgb;return c.a*=1+s,this}negate(){const s=this._rgb;return s.r=255-s.r,s.g=255-s.g,s.b=255-s.b,this}lighten(s){return zy(this._rgb,2,s),this}darken(s){return zy(this._rgb,2,-s),this}saturate(s){return zy(this._rgb,1,s),this}desaturate(s){return zy(this._rgb,1,-s),this}rotate(s){return oF(this._rgb,s),this}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function El(){}const mF=(()=>{let a=0;return()=>a++})();function hs(a){return a==null}function rr(a){if(Array.isArray&&Array.isArray(a))return!0;const s=Object.prototype.toString.call(a);return s.slice(0,7)==="[object"&&s.slice(-6)==="Array]"}function ls(a){return a!==null&&Object.prototype.toString.call(a)==="[object Object]"}function Fo(a){return(typeof a=="number"||a instanceof Number)&&isFinite(+a)}function Ba(a,s){return Fo(a)?a:s}function Gn(a,s){return typeof a>"u"?s:a}const _F=(a,s)=>typeof a=="string"&&a.endsWith("%")?parseFloat(a)/100*s:+a;function Ms(a,s,c){if(a&&typeof a.call=="function")return a.apply(c,s)}function fs(a,s,c,m){let g,b,E;if(rr(a))for(b=a.length,g=0;g<b;g++)s.call(c,a[g],g);else if(ls(a))for(E=Object.keys(a),b=E.length,g=0;g<b;g++)s.call(c,a[E[g]],E[g])}function Tx(a,s){let c,m,g,b;if(!a||!s||a.length!==s.length)return!1;for(c=0,m=a.length;c<m;++c)if(g=a[c],b=s[c],g.datasetIndex!==b.datasetIndex||g.index!==b.index)return!1;return!0}function Sx(a){if(rr(a))return a.map(Sx);if(ls(a)){const s=Object.create(null),c=Object.keys(a),m=c.length;let g=0;for(;g<m;++g)s[c[g]]=Sx(a[c[g]]);return s}return a}function cM(a){return["__proto__","prototype","constructor"].indexOf(a)===-1}function gF(a,s,c,m){if(!cM(a))return;const g=s[a],b=c[a];ls(g)&&ls(b)?d_(g,b,m):s[a]=Sx(b)}function d_(a,s,c){const m=rr(s)?s:[s],g=m.length;if(!ls(a))return a;c=c||{};const b=c.merger||gF;let E;for(let n=0;n<g;++n){if(E=m[n],!ls(E))continue;const R=Object.keys(E);for(let B=0,N=R.length;B<N;++B)b(R[B],a,E,c)}return a}function Ym(a,s){return d_(a,s,{merger:yF})}function yF(a,s,c){if(!cM(a))return;const m=s[a],g=c[a];ls(m)&&ls(g)?Ym(m,g):Object.prototype.hasOwnProperty.call(s,a)||(s[a]=Sx(g))}const H2={"":a=>a,x:a=>a.x,y:a=>a.y};function xF(a){const s=a.split("."),c=[];let m="";for(const g of s)m+=g,m.endsWith("\\")?m=m.slice(0,-1)+".":(c.push(m),m="");return c}function vF(a){const s=xF(a);return c=>{for(const m of s){if(m==="")break;c=c&&c[m]}return c}}function wf(a,s){return(H2[s]||(H2[s]=vF(s)))(a)}function D1(a){return a.charAt(0).toUpperCase()+a.slice(1)}const f_=a=>typeof a<"u",Gc=a=>typeof a=="function",W2=(a,s)=>{if(a.size!==s.size)return!1;for(const c of a)if(!s.has(c))return!1;return!0};function bF(a){return a.type==="mouseup"||a.type==="click"||a.type==="contextmenu"}const fr=Math.PI,$a=2*fr,wF=$a+fr,Ex=Number.POSITIVE_INFINITY,TF=fr/180,ha=fr/2,ou=fr/4,q2=fr*2/3,hM=Math.log10,Ga=Math.sign;function Km(a,s,c){return Math.abs(a-s)<c}function Z2(a){const s=Math.round(a);a=Km(a,s,a/1e3)?s:a;const c=Math.pow(10,Math.floor(hM(a))),m=a/c;return(m<=1?1:m<=2?2:m<=5?5:10)*c}function SF(a){const s=[],c=Math.sqrt(a);let m;for(m=1;m<c;m++)a%m===0&&(s.push(m),s.push(a/m));return c===(c|0)&&s.push(c),s.sort((g,b)=>g-b).pop(),s}function EF(a){return typeof a=="symbol"||typeof a=="object"&&a!==null&&!(Symbol.toPrimitive in a||"toString"in a||"valueOf"in a)}function p_(a){return!EF(a)&&!isNaN(parseFloat(a))&&isFinite(a)}function AF(a,s){const c=Math.round(a);return c-s<=a&&c+s>=a}function IF(a,s,c){let m,g,b;for(m=0,g=a.length;m<g;m++)b=a[m][c],isNaN(b)||(s.min=Math.min(s.min,b),s.max=Math.max(s.max,b))}function fu(a){return a*(fr/180)}function CF(a){return a*(180/fr)}function X2(a){if(!Fo(a))return;let s=1,c=0;for(;Math.round(a*s)/s!==a;)s*=10,c++;return c}function MF(a,s){const c=s.x-a.x,m=s.y-a.y,g=Math.sqrt(c*c+m*m);let b=Math.atan2(m,c);return b<-.5*fr&&(b+=$a),{angle:b,distance:g}}function Zb(a,s){return Math.sqrt(Math.pow(s.x-a.x,2)+Math.pow(s.y-a.y,2))}function PF(a,s){return(a-s+wF)%$a-fr}function Rc(a){return(a%$a+$a)%$a}function uM(a,s,c,m){const g=Rc(a),b=Rc(s),E=Rc(c),n=Rc(b-g),R=Rc(E-g),B=Rc(g-b),N=Rc(g-E);return g===b||g===E||m&&b===E||n>R&&B<N}function go(a,s,c){return Math.max(s,Math.min(c,a))}function DF(a){return go(a,-32768,32767)}function pu(a,s,c,m=1e-6){return a>=Math.min(s,c)-m&&a<=Math.max(s,c)+m}function R1(a,s,c){c=c||(E=>a[E]<s);let m=a.length-1,g=0,b;for(;m-g>1;)b=g+m>>1,c(b)?g=b:m=b;return{lo:g,hi:m}}const mu=(a,s,c,m)=>R1(a,c,m?g=>{const b=a[g][s];return b<c||b===c&&a[g+1][s]===c}:g=>a[g][s]<c),RF=(a,s,c)=>R1(a,c,m=>a[m][s]>=c);function LF(a,s,c){let m=0,g=a.length;for(;m<g&&a[m]<s;)m++;for(;g>m&&a[g-1]>c;)g--;return m>0||g<a.length?a.slice(m,g):a}const dM=["push","pop","shift","splice","unshift"];function zF(a,s){if(a._chartjs){a._chartjs.listeners.push(s);return}Object.defineProperty(a,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[s]}}),dM.forEach(c=>{const m="_onData"+D1(c),g=a[c];Object.defineProperty(a,c,{configurable:!0,enumerable:!1,value(...b){const E=g.apply(this,b);return a._chartjs.listeners.forEach(n=>{typeof n[m]=="function"&&n[m](...b)}),E}})})}function Y2(a,s){const c=a._chartjs;if(!c)return;const m=c.listeners,g=m.indexOf(s);g!==-1&&m.splice(g,1),!(m.length>0)&&(dM.forEach(b=>{delete a[b]}),delete a._chartjs)}function fM(a){const s=new Set(a);return s.size===a.length?a:Array.from(s)}const pM=function(){return typeof window>"u"?function(a){return a()}:window.requestAnimationFrame}();function mM(a,s){let c=[],m=!1;return function(...g){c=g,m||(m=!0,pM.call(window,()=>{m=!1,a.apply(s,c)}))}}function OF(a,s){let c;return function(...m){return s?(clearTimeout(c),c=setTimeout(a,s,m)):a.apply(this,m),s}}const L1=a=>a==="start"?"left":a==="end"?"right":"center",Pr=(a,s,c)=>a==="start"?s:a==="end"?c:(s+c)/2,kF=(a,s,c,m)=>a===(m?"left":"right")?c:a==="center"?(s+c)/2:s;function FF(a,s,c){const m=s.length;let g=0,b=m;if(a._sorted){const{iScale:E,vScale:n,_parsed:R}=a,B=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null,N=E.axis,{min:X,max:ie,minDefined:se,maxDefined:we}=E.getUserBounds();if(se){if(g=Math.min(mu(R,N,X).lo,c?m:mu(s,N,E.getPixelForValue(X)).lo),B){const pe=R.slice(0,g+1).reverse().findIndex(Ae=>!hs(Ae[n.axis]));g-=Math.max(0,pe)}g=go(g,0,m-1)}if(we){let pe=Math.max(mu(R,E.axis,ie,!0).hi+1,c?0:mu(s,N,E.getPixelForValue(ie),!0).hi+1);if(B){const Ae=R.slice(pe-1).findIndex(Ie=>!hs(Ie[n.axis]));pe+=Math.max(0,Ae)}b=go(pe,g,m)-g}else b=m-g}return{start:g,count:b}}function BF(a){const{xScale:s,yScale:c,_scaleRanges:m}=a,g={xmin:s.min,xmax:s.max,ymin:c.min,ymax:c.max};if(!m)return a._scaleRanges=g,!0;const b=m.xmin!==s.min||m.xmax!==s.max||m.ymin!==c.min||m.ymax!==c.max;return Object.assign(m,g),b}const Oy=a=>a===0||a===1,K2=(a,s,c)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-s)*$a/c)),J2=(a,s,c)=>Math.pow(2,-10*a)*Math.sin((a-s)*$a/c)+1,Jm={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*ha)+1,easeOutSine:a=>Math.sin(a*ha),easeInOutSine:a=>-.5*(Math.cos(fr*a)-1),easeInExpo:a=>a===0?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>a===1?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>Oy(a)?a:a<.5?.5*Math.pow(2,10*(a*2-1)):.5*(-Math.pow(2,-10*(a*2-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>Oy(a)?a:K2(a,.075,.3),easeOutElastic:a=>Oy(a)?a:J2(a,.075,.3),easeInOutElastic(a){return Oy(a)?a:a<.5?.5*K2(a*2,.1125,.45):.5+.5*J2(a*2-1,.1125,.45)},easeInBack(a){return a*a*((1.70158+1)*a-1.70158)},easeOutBack(a){return(a-=1)*a*((1.70158+1)*a+1.70158)+1},easeInOutBack(a){let s=1.70158;return(a/=.5)<1?.5*(a*a*(((s*=1.525)+1)*a-s)):.5*((a-=2)*a*(((s*=1.525)+1)*a+s)+2)},easeInBounce:a=>1-Jm.easeOutBounce(1-a),easeOutBounce(a){return a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375},easeInOutBounce:a=>a<.5?Jm.easeInBounce(a*2)*.5:Jm.easeOutBounce(a*2-1)*.5+.5};function z1(a){if(a&&typeof a=="object"){const s=a.toString();return s==="[object CanvasPattern]"||s==="[object CanvasGradient]"}return!1}function Q2(a){return z1(a)?a:new u_(a)}function hb(a){return z1(a)?a:new u_(a).saturate(.5).darken(.1).hexString()}const NF=["x","y","borderWidth","radius","tension"],VF=["color","borderColor","backgroundColor"];function UF(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:s=>s!=="onProgress"&&s!=="onComplete"&&s!=="fn"}),a.set("animations",{colors:{type:"color",properties:VF},numbers:{type:"number",properties:NF}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:s=>s|0}}}})}function jF(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const eA=new Map;function $F(a,s){s=s||{};const c=a+JSON.stringify(s);let m=eA.get(c);return m||(m=new Intl.NumberFormat(a,s),eA.set(c,m)),m}function _M(a,s,c){return $F(s,c).format(a)}const GF={values(a){return rr(a)?a:""+a},numeric(a,s,c){if(a===0)return"0";const m=this.chart.options.locale;let g,b=a;if(c.length>1){const B=Math.max(Math.abs(c[0].value),Math.abs(c[c.length-1].value));(B<1e-4||B>1e15)&&(g="scientific"),b=HF(a,c)}const E=hM(Math.abs(b)),n=isNaN(E)?1:Math.max(Math.min(-1*Math.floor(E),20),0),R={notation:g,minimumFractionDigits:n,maximumFractionDigits:n};return Object.assign(R,this.options.ticks.format),_M(a,m,R)}};function HF(a,s){let c=s.length>3?s[2].value-s[1].value:s[1].value-s[0].value;return Math.abs(c)>=1&&a!==Math.floor(a)&&(c=a-Math.floor(a)),c}var gM={formatters:GF};function WF(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(s,c)=>c.lineWidth,tickColor:(s,c)=>c.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:gM.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:s=>!s.startsWith("before")&&!s.startsWith("after")&&s!=="callback"&&s!=="parser",_indexable:s=>s!=="borderDash"&&s!=="tickBorderDash"&&s!=="dash"}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:s=>s!=="backdropPadding"&&s!=="callback",_indexable:s=>s!=="backdropPadding"})}const Tu=Object.create(null),Xb=Object.create(null);function Qm(a,s){if(!s)return a;const c=s.split(".");for(let m=0,g=c.length;m<g;++m){const b=c[m];a=a[b]||(a[b]=Object.create(null))}return a}function ub(a,s,c){return typeof s=="string"?d_(Qm(a,s),c):d_(Qm(a,""),s)}class qF{constructor(s,c){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=m=>m.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(m,g)=>hb(g.backgroundColor),this.hoverBorderColor=(m,g)=>hb(g.borderColor),this.hoverColor=(m,g)=>hb(g.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(s),this.apply(c)}set(s,c){return ub(this,s,c)}get(s){return Qm(this,s)}describe(s,c){return ub(Xb,s,c)}override(s,c){return ub(Tu,s,c)}route(s,c,m,g){const b=Qm(this,s),E=Qm(this,m),n="_"+c;Object.defineProperties(b,{[n]:{value:b[c],writable:!0},[c]:{enumerable:!0,get(){const R=this[n],B=E[g];return ls(R)?Object.assign({},B,R):Gn(R,B)},set(R){this[n]=R}}})}apply(s){s.forEach(c=>c(this))}}var qs=new qF({_scriptable:a=>!a.startsWith("on"),_indexable:a=>a!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[UF,jF,WF]);function ZF(a){return!a||hs(a.size)||hs(a.family)?null:(a.style?a.style+" ":"")+(a.weight?a.weight+" ":"")+a.size+"px "+a.family}function tA(a,s,c,m,g){let b=s[g];return b||(b=s[g]=a.measureText(g).width,c.push(g)),b>m&&(m=b),m}function au(a,s,c){const m=a.currentDevicePixelRatio,g=c!==0?Math.max(c/2,.5):0;return Math.round((s-g)*m)/m+g}function iA(a,s){!s&&!a||(s=s||a.getContext("2d"),s.save(),s.resetTransform(),s.clearRect(0,0,a.width,a.height),s.restore())}function Yb(a,s,c,m){yM(a,s,c,m,null)}function yM(a,s,c,m,g){let b,E,n,R,B,N,X,ie;const se=s.pointStyle,we=s.rotation,pe=s.radius;let Ae=(we||0)*TF;if(se&&typeof se=="object"&&(b=se.toString(),b==="[object HTMLImageElement]"||b==="[object HTMLCanvasElement]")){a.save(),a.translate(c,m),a.rotate(Ae),a.drawImage(se,-se.width/2,-se.height/2,se.width,se.height),a.restore();return}if(!(isNaN(pe)||pe<=0)){switch(a.beginPath(),se){default:g?a.ellipse(c,m,g/2,pe,0,0,$a):a.arc(c,m,pe,0,$a),a.closePath();break;case"triangle":N=g?g/2:pe,a.moveTo(c+Math.sin(Ae)*N,m-Math.cos(Ae)*pe),Ae+=q2,a.lineTo(c+Math.sin(Ae)*N,m-Math.cos(Ae)*pe),Ae+=q2,a.lineTo(c+Math.sin(Ae)*N,m-Math.cos(Ae)*pe),a.closePath();break;case"rectRounded":B=pe*.516,R=pe-B,E=Math.cos(Ae+ou)*R,X=Math.cos(Ae+ou)*(g?g/2-B:R),n=Math.sin(Ae+ou)*R,ie=Math.sin(Ae+ou)*(g?g/2-B:R),a.arc(c-X,m-n,B,Ae-fr,Ae-ha),a.arc(c+ie,m-E,B,Ae-ha,Ae),a.arc(c+X,m+n,B,Ae,Ae+ha),a.arc(c-ie,m+E,B,Ae+ha,Ae+fr),a.closePath();break;case"rect":if(!we){R=Math.SQRT1_2*pe,N=g?g/2:R,a.rect(c-N,m-R,2*N,2*R);break}Ae+=ou;case"rectRot":X=Math.cos(Ae)*(g?g/2:pe),E=Math.cos(Ae)*pe,n=Math.sin(Ae)*pe,ie=Math.sin(Ae)*(g?g/2:pe),a.moveTo(c-X,m-n),a.lineTo(c+ie,m-E),a.lineTo(c+X,m+n),a.lineTo(c-ie,m+E),a.closePath();break;case"crossRot":Ae+=ou;case"cross":X=Math.cos(Ae)*(g?g/2:pe),E=Math.cos(Ae)*pe,n=Math.sin(Ae)*pe,ie=Math.sin(Ae)*(g?g/2:pe),a.moveTo(c-X,m-n),a.lineTo(c+X,m+n),a.moveTo(c+ie,m-E),a.lineTo(c-ie,m+E);break;case"star":X=Math.cos(Ae)*(g?g/2:pe),E=Math.cos(Ae)*pe,n=Math.sin(Ae)*pe,ie=Math.sin(Ae)*(g?g/2:pe),a.moveTo(c-X,m-n),a.lineTo(c+X,m+n),a.moveTo(c+ie,m-E),a.lineTo(c-ie,m+E),Ae+=ou,X=Math.cos(Ae)*(g?g/2:pe),E=Math.cos(Ae)*pe,n=Math.sin(Ae)*pe,ie=Math.sin(Ae)*(g?g/2:pe),a.moveTo(c-X,m-n),a.lineTo(c+X,m+n),a.moveTo(c+ie,m-E),a.lineTo(c-ie,m+E);break;case"line":E=g?g/2:Math.cos(Ae)*pe,n=Math.sin(Ae)*pe,a.moveTo(c-E,m-n),a.lineTo(c+E,m+n);break;case"dash":a.moveTo(c,m),a.lineTo(c+Math.cos(Ae)*(g?g/2:pe),m+Math.sin(Ae)*pe);break;case!1:a.closePath();break}a.fill(),s.borderWidth>0&&a.stroke()}}function m_(a,s,c){return c=c||.5,!s||a&&a.x>s.left-c&&a.x<s.right+c&&a.y>s.top-c&&a.y<s.bottom+c}function O1(a,s){a.save(),a.beginPath(),a.rect(s.left,s.top,s.right-s.left,s.bottom-s.top),a.clip()}function k1(a){a.restore()}function XF(a,s,c,m,g){if(!s)return a.lineTo(c.x,c.y);if(g==="middle"){const b=(s.x+c.x)/2;a.lineTo(b,s.y),a.lineTo(b,c.y)}else g==="after"!=!!m?a.lineTo(s.x,c.y):a.lineTo(c.x,s.y);a.lineTo(c.x,c.y)}function YF(a,s,c,m){if(!s)return a.lineTo(c.x,c.y);a.bezierCurveTo(m?s.cp1x:s.cp2x,m?s.cp1y:s.cp2y,m?c.cp2x:c.cp1x,m?c.cp2y:c.cp1y,c.x,c.y)}function KF(a,s){s.translation&&a.translate(s.translation[0],s.translation[1]),hs(s.rotation)||a.rotate(s.rotation),s.color&&(a.fillStyle=s.color),s.textAlign&&(a.textAlign=s.textAlign),s.textBaseline&&(a.textBaseline=s.textBaseline)}function JF(a,s,c,m,g){if(g.strikethrough||g.underline){const b=a.measureText(m),E=s-b.actualBoundingBoxLeft,n=s+b.actualBoundingBoxRight,R=c-b.actualBoundingBoxAscent,B=c+b.actualBoundingBoxDescent,N=g.strikethrough?(R+B)/2:B;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=g.decorationWidth||2,a.moveTo(E,N),a.lineTo(n,N),a.stroke()}}function QF(a,s){const c=a.fillStyle;a.fillStyle=s.color,a.fillRect(s.left,s.top,s.width,s.height),a.fillStyle=c}function __(a,s,c,m,g,b={}){const E=rr(s)?s:[s],n=b.strokeWidth>0&&b.strokeColor!=="";let R,B;for(a.save(),a.font=g.string,KF(a,b),R=0;R<E.length;++R)B=E[R],b.backdrop&&QF(a,b.backdrop),n&&(b.strokeColor&&(a.strokeStyle=b.strokeColor),hs(b.strokeWidth)||(a.lineWidth=b.strokeWidth),a.strokeText(B,c,m,b.maxWidth)),a.fillText(B,c,m,b.maxWidth),JF(a,c,m,B,b),m+=Number(g.lineHeight);a.restore()}function Ax(a,s){const{x:c,y:m,w:g,h:b,radius:E}=s;a.arc(c+E.topLeft,m+E.topLeft,E.topLeft,1.5*fr,fr,!0),a.lineTo(c,m+b-E.bottomLeft),a.arc(c+E.bottomLeft,m+b-E.bottomLeft,E.bottomLeft,fr,ha,!0),a.lineTo(c+g-E.bottomRight,m+b),a.arc(c+g-E.bottomRight,m+b-E.bottomRight,E.bottomRight,ha,0,!0),a.lineTo(c+g,m+E.topRight),a.arc(c+g-E.topRight,m+E.topRight,E.topRight,0,-ha,!0),a.lineTo(c+E.topLeft,m)}const eB=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,tB=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function iB(a,s){const c=(""+a).match(eB);if(!c||c[1]==="normal")return s*1.2;switch(a=+c[2],c[3]){case"px":return a;case"%":a/=100;break}return s*a}const nB=a=>+a||0;function xM(a,s){const c={},m=ls(s),g=m?Object.keys(s):s,b=ls(a)?m?E=>Gn(a[E],a[s[E]]):E=>a[E]:()=>a;for(const E of g)c[E]=nB(b(E));return c}function vM(a){return xM(a,{top:"y",right:"x",bottom:"y",left:"x"})}function gf(a){return xM(a,["topLeft","topRight","bottomLeft","bottomRight"])}function Bo(a){const s=vM(a);return s.width=s.left+s.right,s.height=s.top+s.bottom,s}function Rr(a,s){a=a||{},s=s||qs.font;let c=Gn(a.size,s.size);typeof c=="string"&&(c=parseInt(c,10));let m=Gn(a.style,s.style);m&&!(""+m).match(tB)&&(console.warn('Invalid font style specified: "'+m+'"'),m=void 0);const g={family:Gn(a.family,s.family),lineHeight:iB(Gn(a.lineHeight,s.lineHeight),c),size:c,style:m,weight:Gn(a.weight,s.weight),string:""};return g.string=ZF(g),g}function ky(a,s,c,m){let g,b,E;for(g=0,b=a.length;g<b;++g)if(E=a[g],E!==void 0&&E!==void 0)return E}function sB(a,s,c){const{min:m,max:g}=a,b=_F(s,(g-m)/2),E=(n,R)=>c&&n===0?0:n+R;return{min:E(m,-Math.abs(b)),max:E(g,b)}}function Cu(a,s){return Object.assign(Object.create(a),s)}function F1(a,s=[""],c,m,g=()=>a[0]){const b=c||a;typeof m>"u"&&(m=SM("_fallback",a));const E={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:b,_fallback:m,_getTarget:g,override:n=>F1([n,...a],s,b,m)};return new Proxy(E,{deleteProperty(n,R){return delete n[R],delete n._keys,delete a[0][R],!0},get(n,R){return wM(n,R,()=>dB(R,s,a,n))},getOwnPropertyDescriptor(n,R){return Reflect.getOwnPropertyDescriptor(n._scopes[0],R)},getPrototypeOf(){return Reflect.getPrototypeOf(a[0])},has(n,R){return sA(n).includes(R)},ownKeys(n){return sA(n)},set(n,R,B){const N=n._storage||(n._storage=g());return n[R]=N[R]=B,delete n._keys,!0}})}function Tf(a,s,c,m){const g={_cacheable:!1,_proxy:a,_context:s,_subProxy:c,_stack:new Set,_descriptors:bM(a,m),setContext:b=>Tf(a,b,c,m),override:b=>Tf(a.override(b),s,c,m)};return new Proxy(g,{deleteProperty(b,E){return delete b[E],delete a[E],!0},get(b,E,n){return wM(b,E,()=>oB(b,E,n))},getOwnPropertyDescriptor(b,E){return b._descriptors.allKeys?Reflect.has(a,E)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,E)},getPrototypeOf(){return Reflect.getPrototypeOf(a)},has(b,E){return Reflect.has(a,E)},ownKeys(){return Reflect.ownKeys(a)},set(b,E,n){return a[E]=n,delete b[E],!0}})}function bM(a,s={scriptable:!0,indexable:!0}){const{_scriptable:c=s.scriptable,_indexable:m=s.indexable,_allKeys:g=s.allKeys}=a;return{allKeys:g,scriptable:c,indexable:m,isScriptable:Gc(c)?c:()=>c,isIndexable:Gc(m)?m:()=>m}}const rB=(a,s)=>a?a+D1(s):s,B1=(a,s)=>ls(s)&&a!=="adapters"&&(Object.getPrototypeOf(s)===null||s.constructor===Object);function wM(a,s,c){if(Object.prototype.hasOwnProperty.call(a,s)||s==="constructor")return a[s];const m=c();return a[s]=m,m}function oB(a,s,c){const{_proxy:m,_context:g,_subProxy:b,_descriptors:E}=a;let n=m[s];return Gc(n)&&E.isScriptable(s)&&(n=aB(s,n,a,c)),rr(n)&&n.length&&(n=lB(s,n,a,E.isIndexable)),B1(s,n)&&(n=Tf(n,g,b&&b[s],E)),n}function aB(a,s,c,m){const{_proxy:g,_context:b,_subProxy:E,_stack:n}=c;if(n.has(a))throw new Error("Recursion detected: "+Array.from(n).join("->")+"->"+a);n.add(a);let R=s(b,E||m);return n.delete(a),B1(a,R)&&(R=N1(g._scopes,g,a,R)),R}function lB(a,s,c,m){const{_proxy:g,_context:b,_subProxy:E,_descriptors:n}=c;if(typeof b.index<"u"&&m(a))return s[b.index%s.length];if(ls(s[0])){const R=s,B=g._scopes.filter(N=>N!==R);s=[];for(const N of R){const X=N1(B,g,a,N);s.push(Tf(X,b,E&&E[a],n))}}return s}function TM(a,s,c){return Gc(a)?a(s,c):a}const cB=(a,s)=>a===!0?s:typeof a=="string"?wf(s,a):void 0;function hB(a,s,c,m,g){for(const b of s){const E=cB(c,b);if(E){a.add(E);const n=TM(E._fallback,c,g);if(typeof n<"u"&&n!==c&&n!==m)return n}else if(E===!1&&typeof m<"u"&&c!==m)return null}return!1}function N1(a,s,c,m){const g=s._rootScopes,b=TM(s._fallback,c,m),E=[...a,...g],n=new Set;n.add(m);let R=nA(n,E,c,b||c,m);return R===null||typeof b<"u"&&b!==c&&(R=nA(n,E,b,R,m),R===null)?!1:F1(Array.from(n),[""],g,b,()=>uB(s,c,m))}function nA(a,s,c,m,g){for(;c;)c=hB(a,s,c,m,g);return c}function uB(a,s,c){const m=a._getTarget();s in m||(m[s]={});const g=m[s];return rr(g)&&ls(c)?c:g||{}}function dB(a,s,c,m){let g;for(const b of s)if(g=SM(rB(b,a),c),typeof g<"u")return B1(a,g)?N1(c,m,a,g):g}function SM(a,s){for(const c of s){if(!c)continue;const m=c[a];if(typeof m<"u")return m}}function sA(a){let s=a._keys;return s||(s=a._keys=fB(a._scopes)),s}function fB(a){const s=new Set;for(const c of a)for(const m of Object.keys(c).filter(g=>!g.startsWith("_")))s.add(m);return Array.from(s)}const pB=Number.EPSILON||1e-14,Sf=(a,s)=>s<a.length&&!a[s].skip&&a[s],EM=a=>a==="x"?"y":"x";function mB(a,s,c,m){const g=a.skip?s:a,b=s,E=c.skip?s:c,n=Zb(b,g),R=Zb(E,b);let B=n/(n+R),N=R/(n+R);B=isNaN(B)?0:B,N=isNaN(N)?0:N;const X=m*B,ie=m*N;return{previous:{x:b.x-X*(E.x-g.x),y:b.y-X*(E.y-g.y)},next:{x:b.x+ie*(E.x-g.x),y:b.y+ie*(E.y-g.y)}}}function _B(a,s,c){const m=a.length;let g,b,E,n,R,B=Sf(a,0);for(let N=0;N<m-1;++N)if(R=B,B=Sf(a,N+1),!(!R||!B)){if(Km(s[N],0,pB)){c[N]=c[N+1]=0;continue}g=c[N]/s[N],b=c[N+1]/s[N],n=Math.pow(g,2)+Math.pow(b,2),!(n<=9)&&(E=3/Math.sqrt(n),c[N]=g*E*s[N],c[N+1]=b*E*s[N])}}function gB(a,s,c="x"){const m=EM(c),g=a.length;let b,E,n,R=Sf(a,0);for(let B=0;B<g;++B){if(E=n,n=R,R=Sf(a,B+1),!n)continue;const N=n[c],X=n[m];E&&(b=(N-E[c])/3,n[`cp1${c}`]=N-b,n[`cp1${m}`]=X-b*s[B]),R&&(b=(R[c]-N)/3,n[`cp2${c}`]=N+b,n[`cp2${m}`]=X+b*s[B])}}function yB(a,s="x"){const c=EM(s),m=a.length,g=Array(m).fill(0),b=Array(m);let E,n,R,B=Sf(a,0);for(E=0;E<m;++E)if(n=R,R=B,B=Sf(a,E+1),!!R){if(B){const N=B[s]-R[s];g[E]=N!==0?(B[c]-R[c])/N:0}b[E]=n?B?Ga(g[E-1])!==Ga(g[E])?0:(g[E-1]+g[E])/2:g[E-1]:g[E]}_B(a,g,b),gB(a,b,s)}function Fy(a,s,c){return Math.max(Math.min(a,c),s)}function xB(a,s){let c,m,g,b,E,n=m_(a[0],s);for(c=0,m=a.length;c<m;++c)E=b,b=n,n=c<m-1&&m_(a[c+1],s),b&&(g=a[c],E&&(g.cp1x=Fy(g.cp1x,s.left,s.right),g.cp1y=Fy(g.cp1y,s.top,s.bottom)),n&&(g.cp2x=Fy(g.cp2x,s.left,s.right),g.cp2y=Fy(g.cp2y,s.top,s.bottom)))}function vB(a,s,c,m,g){let b,E,n,R;if(s.spanGaps&&(a=a.filter(B=>!B.skip)),s.cubicInterpolationMode==="monotone")yB(a,g);else{let B=m?a[a.length-1]:a[0];for(b=0,E=a.length;b<E;++b)n=a[b],R=mB(B,n,a[Math.min(b+1,E-(m?0:1))%E],s.tension),n.cp1x=R.previous.x,n.cp1y=R.previous.y,n.cp2x=R.next.x,n.cp2y=R.next.y,B=n}s.capBezierPoints&&xB(a,c)}function V1(){return typeof window<"u"&&typeof document<"u"}function U1(a){let s=a.parentNode;return s&&s.toString()==="[object ShadowRoot]"&&(s=s.host),s}function Ix(a,s,c){let m;return typeof a=="string"?(m=parseInt(a,10),a.indexOf("%")!==-1&&(m=m/100*s.parentNode[c])):m=a,m}const jx=a=>a.ownerDocument.defaultView.getComputedStyle(a,null);function bB(a,s){return jx(a).getPropertyValue(s)}const wB=["top","right","bottom","left"];function bu(a,s,c){const m={};c=c?"-"+c:"";for(let g=0;g<4;g++){const b=wB[g];m[b]=parseFloat(a[s+"-"+b+c])||0}return m.width=m.left+m.right,m.height=m.top+m.bottom,m}const TB=(a,s,c)=>(a>0||s>0)&&(!c||!c.shadowRoot);function SB(a,s){const c=a.touches,m=c&&c.length?c[0]:a,{offsetX:g,offsetY:b}=m;let E=!1,n,R;if(TB(g,b,a.target))n=g,R=b;else{const B=s.getBoundingClientRect();n=m.clientX-B.left,R=m.clientY-B.top,E=!0}return{x:n,y:R,box:E}}function hu(a,s){if("native"in a)return a;const{canvas:c,currentDevicePixelRatio:m}=s,g=jx(c),b=g.boxSizing==="border-box",E=bu(g,"padding"),n=bu(g,"border","width"),{x:R,y:B,box:N}=SB(a,c),X=E.left+(N&&n.left),ie=E.top+(N&&n.top);let{width:se,height:we}=s;return b&&(se-=E.width+n.width,we-=E.height+n.height),{x:Math.round((R-X)/se*c.width/m),y:Math.round((B-ie)/we*c.height/m)}}function EB(a,s,c){let m,g;if(s===void 0||c===void 0){const b=a&&U1(a);if(!b)s=a.clientWidth,c=a.clientHeight;else{const E=b.getBoundingClientRect(),n=jx(b),R=bu(n,"border","width"),B=bu(n,"padding");s=E.width-B.width-R.width,c=E.height-B.height-R.height,m=Ix(n.maxWidth,b,"clientWidth"),g=Ix(n.maxHeight,b,"clientHeight")}}return{width:s,height:c,maxWidth:m||Ex,maxHeight:g||Ex}}const By=a=>Math.round(a*10)/10;function AB(a,s,c,m){const g=jx(a),b=bu(g,"margin"),E=Ix(g.maxWidth,a,"clientWidth")||Ex,n=Ix(g.maxHeight,a,"clientHeight")||Ex,R=EB(a,s,c);let{width:B,height:N}=R;if(g.boxSizing==="content-box"){const ie=bu(g,"border","width"),se=bu(g,"padding");B-=se.width+ie.width,N-=se.height+ie.height}return B=Math.max(0,B-b.width),N=Math.max(0,m?B/m:N-b.height),B=By(Math.min(B,E,R.maxWidth)),N=By(Math.min(N,n,R.maxHeight)),B&&!N&&(N=By(B/2)),(s!==void 0||c!==void 0)&&m&&R.height&&N>R.height&&(N=R.height,B=By(Math.floor(N*m))),{width:B,height:N}}function rA(a,s,c){const m=s||1,g=Math.floor(a.height*m),b=Math.floor(a.width*m);a.height=Math.floor(a.height),a.width=Math.floor(a.width);const E=a.canvas;return E.style&&(c||!E.style.height&&!E.style.width)&&(E.style.height=`${a.height}px`,E.style.width=`${a.width}px`),a.currentDevicePixelRatio!==m||E.height!==g||E.width!==b?(a.currentDevicePixelRatio=m,E.height=g,E.width=b,a.ctx.setTransform(m,0,0,m,0,0),!0):!1}const IB=function(){let a=!1;try{const s={get passive(){return a=!0,!1}};V1()&&(window.addEventListener("test",null,s),window.removeEventListener("test",null,s))}catch{}return a}();function oA(a,s){const c=bB(a,s),m=c&&c.match(/^(\d+)(\.\d+)?px$/);return m?+m[1]:void 0}function uu(a,s,c,m){return{x:a.x+c*(s.x-a.x),y:a.y+c*(s.y-a.y)}}function CB(a,s,c,m){return{x:a.x+c*(s.x-a.x),y:m==="middle"?c<.5?a.y:s.y:m==="after"?c<1?a.y:s.y:c>0?s.y:a.y}}function MB(a,s,c,m){const g={x:a.cp2x,y:a.cp2y},b={x:s.cp1x,y:s.cp1y},E=uu(a,g,c),n=uu(g,b,c),R=uu(b,s,c),B=uu(E,n,c),N=uu(n,R,c);return uu(B,N,c)}const PB=function(a,s){return{x(c){return a+a+s-c},setWidth(c){s=c},textAlign(c){return c==="center"?c:c==="right"?"left":"right"},xPlus(c,m){return c-m},leftForLtr(c,m){return c-m}}},DB=function(){return{x(a){return a},setWidth(a){},textAlign(a){return a},xPlus(a,s){return a+s},leftForLtr(a,s){return a}}};function yf(a,s,c){return a?PB(s,c):DB()}function AM(a,s){let c,m;(s==="ltr"||s==="rtl")&&(c=a.canvas.style,m=[c.getPropertyValue("direction"),c.getPropertyPriority("direction")],c.setProperty("direction",s,"important"),a.prevTextDirection=m)}function IM(a,s){s!==void 0&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",s[0],s[1]))}function CM(a){return a==="angle"?{between:uM,compare:PF,normalize:Rc}:{between:pu,compare:(s,c)=>s-c,normalize:s=>s}}function aA({start:a,end:s,count:c,loop:m,style:g}){return{start:a%c,end:s%c,loop:m&&(s-a+1)%c===0,style:g}}function RB(a,s,c){const{property:m,start:g,end:b}=c,{between:E,normalize:n}=CM(m),R=s.length;let{start:B,end:N,loop:X}=a,ie,se;if(X){for(B+=R,N+=R,ie=0,se=R;ie<se&&E(n(s[B%R][m]),g,b);++ie)B--,N--;B%=R,N%=R}return N<B&&(N+=R),{start:B,end:N,loop:X,style:a.style}}function LB(a,s,c){if(!c)return[a];const{property:m,start:g,end:b}=c,E=s.length,{compare:n,between:R,normalize:B}=CM(m),{start:N,end:X,loop:ie,style:se}=RB(a,s,c),we=[];let pe=!1,Ae=null,Ie,Je,Pe;const Oe=()=>R(g,Pe,Ie)&&n(g,Pe)!==0,tt=()=>n(b,Ie)===0||R(b,Pe,Ie),xt=()=>pe||Oe(),Tt=()=>!pe||tt();for(let At=N,Wt=N;At<=X;++At)Je=s[At%E],!Je.skip&&(Ie=B(Je[m]),Ie!==Pe&&(pe=R(Ie,g,b),Ae===null&&xt()&&(Ae=n(Ie,g)===0?At:Wt),Ae!==null&&Tt()&&(we.push(aA({start:Ae,end:At,loop:ie,count:E,style:se})),Ae=null),Wt=At,Pe=Ie));return Ae!==null&&we.push(aA({start:Ae,end:X,loop:ie,count:E,style:se})),we}function zB(a,s){const c=[],m=a.segments;for(let g=0;g<m.length;g++){const b=LB(m[g],a.points,s);b.length&&c.push(...b)}return c}function OB(a,s,c,m){let g=0,b=s-1;if(c&&!m)for(;g<s&&!a[g].skip;)g++;for(;g<s&&a[g].skip;)g++;for(g%=s,c&&(b+=g);b>g&&a[b%s].skip;)b--;return b%=s,{start:g,end:b}}function kB(a,s,c,m){const g=a.length,b=[];let E=s,n=a[s],R;for(R=s+1;R<=c;++R){const B=a[R%g];B.skip||B.stop?n.skip||(m=!1,b.push({start:s%g,end:(R-1)%g,loop:m}),s=E=B.stop?R:null):(E=R,n.skip&&(s=R)),n=B}return E!==null&&b.push({start:s%g,end:E%g,loop:m}),b}function FB(a,s){const c=a.points,m=a.options.spanGaps,g=c.length;if(!g)return[];const b=!!a._loop,{start:E,end:n}=OB(c,g,b,m);if(m===!0)return lA(a,[{start:E,end:n,loop:b}],c,s);const R=n<E?n+g:n,B=!!a._fullLoop&&E===0&&n===g-1;return lA(a,kB(c,E,R,B),c,s)}function lA(a,s,c,m){return!m||!m.setContext||!c?s:BB(a,s,c,m)}function BB(a,s,c,m){const g=a._chart.getContext(),b=cA(a.options),{_datasetIndex:E,options:{spanGaps:n}}=a,R=c.length,B=[];let N=b,X=s[0].start,ie=X;function se(we,pe,Ae,Ie){const Je=n?-1:1;if(we!==pe){for(we+=R;c[we%R].skip;)we-=Je;for(;c[pe%R].skip;)pe+=Je;we%R!==pe%R&&(B.push({start:we%R,end:pe%R,loop:Ae,style:Ie}),N=Ie,X=pe%R)}}for(const we of s){X=n?X:we.start;let pe=c[X%R],Ae;for(ie=X+1;ie<=we.end;ie++){const Ie=c[ie%R];Ae=cA(m.setContext(Cu(g,{type:"segment",p0:pe,p1:Ie,p0DataIndex:(ie-1)%R,p1DataIndex:ie%R,datasetIndex:E}))),NB(Ae,N)&&se(X,ie-1,we.loop,N),pe=Ie,N=Ae}X<ie-1&&se(X,ie-1,we.loop,N)}return B}function cA(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function NB(a,s){if(!s)return!1;const c=[],m=function(g,b){return z1(b)?(c.includes(b)||c.push(b),c.indexOf(b)):b};return JSON.stringify(a,m)!==JSON.stringify(s,m)}function Ny(a,s,c){return a.options.clip?a[c]:s[c]}function VB(a,s){const{xScale:c,yScale:m}=a;return c&&m?{left:Ny(c,s,"left"),right:Ny(c,s,"right"),top:Ny(m,s,"top"),bottom:Ny(m,s,"bottom")}:s}function UB(a,s){const c=s._clip;if(c.disabled)return!1;const m=VB(s,a.chartArea);return{left:c.left===!1?0:m.left-(c.left===!0?0:c.left),right:c.right===!1?a.width:m.right+(c.right===!0?0:c.right),top:c.top===!1?0:m.top-(c.top===!0?0:c.top),bottom:c.bottom===!1?a.height:m.bottom+(c.bottom===!0?0:c.bottom)}}/*!
 * Chart.js v4.5.0
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class jB{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(s,c,m,g){const b=c.listeners[g],E=c.duration;b.forEach(n=>n({chart:s,initial:c.initial,numSteps:E,currentStep:Math.min(m-c.start,E)}))}_refresh(){this._request||(this._running=!0,this._request=pM.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(s=Date.now()){let c=0;this._charts.forEach((m,g)=>{if(!m.running||!m.items.length)return;const b=m.items;let E=b.length-1,n=!1,R;for(;E>=0;--E)R=b[E],R._active?(R._total>m.duration&&(m.duration=R._total),R.tick(s),n=!0):(b[E]=b[b.length-1],b.pop());n&&(g.draw(),this._notify(g,m,s,"progress")),b.length||(m.running=!1,this._notify(g,m,s,"complete"),m.initial=!1),c+=b.length}),this._lastDate=s,c===0&&(this._running=!1)}_getAnims(s){const c=this._charts;let m=c.get(s);return m||(m={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},c.set(s,m)),m}listen(s,c,m){this._getAnims(s).listeners[c].push(m)}add(s,c){!c||!c.length||this._getAnims(s).items.push(...c)}has(s){return this._getAnims(s).items.length>0}start(s){const c=this._charts.get(s);c&&(c.running=!0,c.start=Date.now(),c.duration=c.items.reduce((m,g)=>Math.max(m,g._duration),0),this._refresh())}running(s){if(!this._running)return!1;const c=this._charts.get(s);return!(!c||!c.running||!c.items.length)}stop(s){const c=this._charts.get(s);if(!c||!c.items.length)return;const m=c.items;let g=m.length-1;for(;g>=0;--g)m[g].cancel();c.items=[],this._notify(s,c,Date.now(),"complete")}remove(s){return this._charts.delete(s)}}var Al=new jB;const hA="transparent",$B={boolean(a,s,c){return c>.5?s:a},color(a,s,c){const m=Q2(a||hA),g=m.valid&&Q2(s||hA);return g&&g.valid?g.mix(m,c).hexString():s},number(a,s,c){return a+(s-a)*c}};class GB{constructor(s,c,m,g){const b=c[m];g=ky([s.to,g,b,s.from]);const E=ky([s.from,b,g]);this._active=!0,this._fn=s.fn||$B[s.type||typeof E],this._easing=Jm[s.easing]||Jm.linear,this._start=Math.floor(Date.now()+(s.delay||0)),this._duration=this._total=Math.floor(s.duration),this._loop=!!s.loop,this._target=c,this._prop=m,this._from=E,this._to=g,this._promises=void 0}active(){return this._active}update(s,c,m){if(this._active){this._notify(!1);const g=this._target[this._prop],b=m-this._start,E=this._duration-b;this._start=m,this._duration=Math.floor(Math.max(E,s.duration)),this._total+=b,this._loop=!!s.loop,this._to=ky([s.to,c,g,s.from]),this._from=ky([s.from,g,c])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(s){const c=s-this._start,m=this._duration,g=this._prop,b=this._from,E=this._loop,n=this._to;let R;if(this._active=b!==n&&(E||c<m),!this._active){this._target[g]=n,this._notify(!0);return}if(c<0){this._target[g]=b;return}R=c/m%2,R=E&&R>1?2-R:R,R=this._easing(Math.min(1,Math.max(0,R))),this._target[g]=this._fn(b,n,R)}wait(){const s=this._promises||(this._promises=[]);return new Promise((c,m)=>{s.push({res:c,rej:m})})}_notify(s){const c=s?"res":"rej",m=this._promises||[];for(let g=0;g<m.length;g++)m[g][c]()}}class MM{constructor(s,c){this._chart=s,this._properties=new Map,this.configure(c)}configure(s){if(!ls(s))return;const c=Object.keys(qs.animation),m=this._properties;Object.getOwnPropertyNames(s).forEach(g=>{const b=s[g];if(!ls(b))return;const E={};for(const n of c)E[n]=b[n];(rr(b.properties)&&b.properties||[g]).forEach(n=>{(n===g||!m.has(n))&&m.set(n,E)})})}_animateOptions(s,c){const m=c.options,g=WB(s,m);if(!g)return[];const b=this._createAnimations(g,m);return m.$shared&&HB(s.options.$animations,m).then(()=>{s.options=m},()=>{}),b}_createAnimations(s,c){const m=this._properties,g=[],b=s.$animations||(s.$animations={}),E=Object.keys(c),n=Date.now();let R;for(R=E.length-1;R>=0;--R){const B=E[R];if(B.charAt(0)==="$")continue;if(B==="options"){g.push(...this._animateOptions(s,c));continue}const N=c[B];let X=b[B];const ie=m.get(B);if(X)if(ie&&X.active()){X.update(ie,N,n);continue}else X.cancel();if(!ie||!ie.duration){s[B]=N;continue}b[B]=X=new GB(ie,s,B,N),g.push(X)}return g}update(s,c){if(this._properties.size===0){Object.assign(s,c);return}const m=this._createAnimations(s,c);if(m.length)return Al.add(this._chart,m),!0}}function HB(a,s){const c=[],m=Object.keys(s);for(let g=0;g<m.length;g++){const b=a[m[g]];b&&b.active()&&c.push(b.wait())}return Promise.all(c)}function WB(a,s){if(!s)return;let c=a.options;if(!c){a.options=s;return}return c.$shared&&(a.options=c=Object.assign({},c,{$shared:!1,$animations:{}})),c}function uA(a,s){const c=a&&a.options||{},m=c.reverse,g=c.min===void 0?s:0,b=c.max===void 0?s:0;return{start:m?b:g,end:m?g:b}}function qB(a,s,c){if(c===!1)return!1;const m=uA(a,c),g=uA(s,c);return{top:g.end,right:m.end,bottom:g.start,left:m.start}}function ZB(a){let s,c,m,g;return ls(a)?(s=a.top,c=a.right,m=a.bottom,g=a.left):s=c=m=g=a,{top:s,right:c,bottom:m,left:g,disabled:a===!1}}function PM(a,s){const c=[],m=a._getSortedDatasetMetas(s);let g,b;for(g=0,b=m.length;g<b;++g)c.push(m[g].index);return c}function dA(a,s,c,m={}){const g=a.keys,b=m.mode==="single";let E,n,R,B;if(s===null)return;let N=!1;for(E=0,n=g.length;E<n;++E){if(R=+g[E],R===c){if(N=!0,m.all)continue;break}B=a.values[R],Fo(B)&&(b||s===0||Ga(s)===Ga(B))&&(s+=B)}return!N&&!m.all?0:s}function XB(a,s){const{iScale:c,vScale:m}=s,g=c.axis==="x"?"x":"y",b=m.axis==="x"?"x":"y",E=Object.keys(a),n=new Array(E.length);let R,B,N;for(R=0,B=E.length;R<B;++R)N=E[R],n[R]={[g]:N,[b]:a[N]};return n}function db(a,s){const c=a&&a.options.stacked;return c||c===void 0&&s.stack!==void 0}function YB(a,s,c){return`${a.id}.${s.id}.${c.stack||c.type}`}function KB(a){const{min:s,max:c,minDefined:m,maxDefined:g}=a.getUserBounds();return{min:m?s:Number.NEGATIVE_INFINITY,max:g?c:Number.POSITIVE_INFINITY}}function JB(a,s,c){const m=a[s]||(a[s]={});return m[c]||(m[c]={})}function fA(a,s,c,m){for(const g of s.getMatchingVisibleMetas(m).reverse()){const b=a[g.index];if(c&&b>0||!c&&b<0)return g.index}return null}function pA(a,s){const{chart:c,_cachedMeta:m}=a,g=c._stacks||(c._stacks={}),{iScale:b,vScale:E,index:n}=m,R=b.axis,B=E.axis,N=YB(b,E,m),X=s.length;let ie;for(let se=0;se<X;++se){const we=s[se],{[R]:pe,[B]:Ae}=we,Ie=we._stacks||(we._stacks={});ie=Ie[B]=JB(g,N,pe),ie[n]=Ae,ie._top=fA(ie,E,!0,m.type),ie._bottom=fA(ie,E,!1,m.type);const Je=ie._visualValues||(ie._visualValues={});Je[n]=Ae}}function fb(a,s){const c=a.scales;return Object.keys(c).filter(m=>c[m].axis===s).shift()}function QB(a,s){return Cu(a,{active:!1,dataset:void 0,datasetIndex:s,index:s,mode:"default",type:"dataset"})}function eN(a,s,c){return Cu(a,{active:!1,dataIndex:s,parsed:void 0,raw:void 0,element:c,index:s,mode:"default",type:"data"})}function Rm(a,s){const c=a.controller.index,m=a.vScale&&a.vScale.axis;if(m){s=s||a._parsed;for(const g of s){const b=g._stacks;if(!b||b[m]===void 0||b[m][c]===void 0)return;delete b[m][c],b[m]._visualValues!==void 0&&b[m]._visualValues[c]!==void 0&&delete b[m]._visualValues[c]}}}const pb=a=>a==="reset"||a==="none",mA=(a,s)=>s?a:Object.assign({},a),tN=(a,s,c)=>a&&!s.hidden&&s._stacked&&{keys:PM(c,!0),values:null};class j1{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(s,c){this.chart=s,this._ctx=s.ctx,this.index=c,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const s=this._cachedMeta;this.configure(),this.linkScales(),s._stacked=db(s.vScale,s),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(s){this.index!==s&&Rm(this._cachedMeta),this.index=s}linkScales(){const s=this.chart,c=this._cachedMeta,m=this.getDataset(),g=(X,ie,se,we)=>X==="x"?ie:X==="r"?we:se,b=c.xAxisID=Gn(m.xAxisID,fb(s,"x")),E=c.yAxisID=Gn(m.yAxisID,fb(s,"y")),n=c.rAxisID=Gn(m.rAxisID,fb(s,"r")),R=c.indexAxis,B=c.iAxisID=g(R,b,E,n),N=c.vAxisID=g(R,E,b,n);c.xScale=this.getScaleForId(b),c.yScale=this.getScaleForId(E),c.rScale=this.getScaleForId(n),c.iScale=this.getScaleForId(B),c.vScale=this.getScaleForId(N)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(s){return this.chart.scales[s]}_getOtherScale(s){const c=this._cachedMeta;return s===c.iScale?c.vScale:c.iScale}reset(){this._update("reset")}_destroy(){const s=this._cachedMeta;this._data&&Y2(this._data,this),s._stacked&&Rm(s)}_dataCheck(){const s=this.getDataset(),c=s.data||(s.data=[]),m=this._data;if(ls(c)){const g=this._cachedMeta;this._data=XB(c,g)}else if(m!==c){if(m){Y2(m,this);const g=this._cachedMeta;Rm(g),g._parsed=[]}c&&Object.isExtensible(c)&&zF(c,this),this._syncList=[],this._data=c}}addElements(){const s=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(s.dataset=new this.datasetElementType)}buildOrUpdateElements(s){const c=this._cachedMeta,m=this.getDataset();let g=!1;this._dataCheck();const b=c._stacked;c._stacked=db(c.vScale,c),c.stack!==m.stack&&(g=!0,Rm(c),c.stack=m.stack),this._resyncElements(s),(g||b!==c._stacked)&&(pA(this,c._parsed),c._stacked=db(c.vScale,c))}configure(){const s=this.chart.config,c=s.datasetScopeKeys(this._type),m=s.getOptionScopes(this.getDataset(),c,!0);this.options=s.createResolver(m,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(s,c){const{_cachedMeta:m,_data:g}=this,{iScale:b,_stacked:E}=m,n=b.axis;let R=s===0&&c===g.length?!0:m._sorted,B=s>0&&m._parsed[s-1],N,X,ie;if(this._parsing===!1)m._parsed=g,m._sorted=!0,ie=g;else{rr(g[s])?ie=this.parseArrayData(m,g,s,c):ls(g[s])?ie=this.parseObjectData(m,g,s,c):ie=this.parsePrimitiveData(m,g,s,c);const se=()=>X[n]===null||B&&X[n]<B[n];for(N=0;N<c;++N)m._parsed[N+s]=X=ie[N],R&&(se()&&(R=!1),B=X);m._sorted=R}E&&pA(this,ie)}parsePrimitiveData(s,c,m,g){const{iScale:b,vScale:E}=s,n=b.axis,R=E.axis,B=b.getLabels(),N=b===E,X=new Array(g);let ie,se,we;for(ie=0,se=g;ie<se;++ie)we=ie+m,X[ie]={[n]:N||b.parse(B[we],we),[R]:E.parse(c[we],we)};return X}parseArrayData(s,c,m,g){const{xScale:b,yScale:E}=s,n=new Array(g);let R,B,N,X;for(R=0,B=g;R<B;++R)N=R+m,X=c[N],n[R]={x:b.parse(X[0],N),y:E.parse(X[1],N)};return n}parseObjectData(s,c,m,g){const{xScale:b,yScale:E}=s,{xAxisKey:n="x",yAxisKey:R="y"}=this._parsing,B=new Array(g);let N,X,ie,se;for(N=0,X=g;N<X;++N)ie=N+m,se=c[ie],B[N]={x:b.parse(wf(se,n),ie),y:E.parse(wf(se,R),ie)};return B}getParsed(s){return this._cachedMeta._parsed[s]}getDataElement(s){return this._cachedMeta.data[s]}applyStack(s,c,m){const g=this.chart,b=this._cachedMeta,E=c[s.axis],n={keys:PM(g,!0),values:c._stacks[s.axis]._visualValues};return dA(n,E,b.index,{mode:m})}updateRangeFromParsed(s,c,m,g){const b=m[c.axis];let E=b===null?NaN:b;const n=g&&m._stacks[c.axis];g&&n&&(g.values=n,E=dA(g,b,this._cachedMeta.index)),s.min=Math.min(s.min,E),s.max=Math.max(s.max,E)}getMinMax(s,c){const m=this._cachedMeta,g=m._parsed,b=m._sorted&&s===m.iScale,E=g.length,n=this._getOtherScale(s),R=tN(c,m,this.chart),B={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:N,max:X}=KB(n);let ie,se;function we(){se=g[ie];const pe=se[n.axis];return!Fo(se[s.axis])||N>pe||X<pe}for(ie=0;ie<E&&!(!we()&&(this.updateRangeFromParsed(B,s,se,R),b));++ie);if(b){for(ie=E-1;ie>=0;--ie)if(!we()){this.updateRangeFromParsed(B,s,se,R);break}}return B}getAllParsedValues(s){const c=this._cachedMeta._parsed,m=[];let g,b,E;for(g=0,b=c.length;g<b;++g)E=c[g][s.axis],Fo(E)&&m.push(E);return m}getMaxOverflow(){return!1}getLabelAndValue(s){const c=this._cachedMeta,m=c.iScale,g=c.vScale,b=this.getParsed(s);return{label:m?""+m.getLabelForValue(b[m.axis]):"",value:g?""+g.getLabelForValue(b[g.axis]):""}}_update(s){const c=this._cachedMeta;this.update(s||"default"),c._clip=ZB(Gn(this.options.clip,qB(c.xScale,c.yScale,this.getMaxOverflow())))}update(s){}draw(){const s=this._ctx,c=this.chart,m=this._cachedMeta,g=m.data||[],b=c.chartArea,E=[],n=this._drawStart||0,R=this._drawCount||g.length-n,B=this.options.drawActiveElementsOnTop;let N;for(m.dataset&&m.dataset.draw(s,b,n,R),N=n;N<n+R;++N){const X=g[N];X.hidden||(X.active&&B?E.push(X):X.draw(s,b))}for(N=0;N<E.length;++N)E[N].draw(s,b)}getStyle(s,c){const m=c?"active":"default";return s===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(m):this.resolveDataElementOptions(s||0,m)}getContext(s,c,m){const g=this.getDataset();let b;if(s>=0&&s<this._cachedMeta.data.length){const E=this._cachedMeta.data[s];b=E.$context||(E.$context=eN(this.getContext(),s,E)),b.parsed=this.getParsed(s),b.raw=g.data[s],b.index=b.dataIndex=s}else b=this.$context||(this.$context=QB(this.chart.getContext(),this.index)),b.dataset=g,b.index=b.datasetIndex=this.index;return b.active=!!c,b.mode=m,b}resolveDatasetElementOptions(s){return this._resolveElementOptions(this.datasetElementType.id,s)}resolveDataElementOptions(s,c){return this._resolveElementOptions(this.dataElementType.id,c,s)}_resolveElementOptions(s,c="default",m){const g=c==="active",b=this._cachedDataOpts,E=s+"-"+c,n=b[E],R=this.enableOptionSharing&&f_(m);if(n)return mA(n,R);const B=this.chart.config,N=B.datasetElementScopeKeys(this._type,s),X=g?[`${s}Hover`,"hover",s,""]:[s,""],ie=B.getOptionScopes(this.getDataset(),N),se=Object.keys(qs.elements[s]),we=()=>this.getContext(m,g,c),pe=B.resolveNamedOptions(ie,se,we,X);return pe.$shared&&(pe.$shared=R,b[E]=Object.freeze(mA(pe,R))),pe}_resolveAnimations(s,c,m){const g=this.chart,b=this._cachedDataOpts,E=`animation-${c}`,n=b[E];if(n)return n;let R;if(g.options.animation!==!1){const N=this.chart.config,X=N.datasetAnimationScopeKeys(this._type,c),ie=N.getOptionScopes(this.getDataset(),X);R=N.createResolver(ie,this.getContext(s,m,c))}const B=new MM(g,R&&R.animations);return R&&R._cacheable&&(b[E]=Object.freeze(B)),B}getSharedOptions(s){if(s.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},s))}includeOptions(s,c){return!c||pb(s)||this.chart._animationsDisabled}_getSharedOptions(s,c){const m=this.resolveDataElementOptions(s,c),g=this._sharedOptions,b=this.getSharedOptions(m),E=this.includeOptions(c,b)||b!==g;return this.updateSharedOptions(b,c,m),{sharedOptions:b,includeOptions:E}}updateElement(s,c,m,g){pb(g)?Object.assign(s,m):this._resolveAnimations(c,g).update(s,m)}updateSharedOptions(s,c,m){s&&!pb(c)&&this._resolveAnimations(void 0,c).update(s,m)}_setStyle(s,c,m,g){s.active=g;const b=this.getStyle(c,g);this._resolveAnimations(c,m,g).update(s,{options:!g&&this.getSharedOptions(b)||b})}removeHoverStyle(s,c,m){this._setStyle(s,m,"active",!1)}setHoverStyle(s,c,m){this._setStyle(s,m,"active",!0)}_removeDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!1)}_setDatasetHoverStyle(){const s=this._cachedMeta.dataset;s&&this._setStyle(s,void 0,"active",!0)}_resyncElements(s){const c=this._data,m=this._cachedMeta.data;for(const[n,R,B]of this._syncList)this[n](R,B);this._syncList=[];const g=m.length,b=c.length,E=Math.min(b,g);E&&this.parse(0,E),b>g?this._insertElements(g,b-g,s):b<g&&this._removeElements(b,g-b)}_insertElements(s,c,m=!0){const g=this._cachedMeta,b=g.data,E=s+c;let n;const R=B=>{for(B.length+=c,n=B.length-1;n>=E;n--)B[n]=B[n-c]};for(R(b),n=s;n<E;++n)b[n]=new this.dataElementType;this._parsing&&R(g._parsed),this.parse(s,c),m&&this.updateElements(b,s,c,"reset")}updateElements(s,c,m,g){}_removeElements(s,c){const m=this._cachedMeta;if(this._parsing){const g=m._parsed.splice(s,c);m._stacked&&Rm(m,g)}m.data.splice(s,c)}_sync(s){if(this._parsing)this._syncList.push(s);else{const[c,m,g]=s;this[c](m,g)}this.chart._dataChanges.push([this.index,...s])}_onDataPush(){const s=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-s,s])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(s,c){c&&this._sync(["_removeElements",s,c]);const m=arguments.length-2;m&&this._sync(["_insertElements",s,m])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function iN(a,s){if(!a._cache.$bar){const c=a.getMatchingVisibleMetas(s);let m=[];for(let g=0,b=c.length;g<b;g++)m=m.concat(c[g].controller.getAllParsedValues(a));a._cache.$bar=fM(m.sort((g,b)=>g-b))}return a._cache.$bar}function nN(a){const s=a.iScale,c=iN(s,a.type);let m=s._length,g,b,E,n;const R=()=>{E===32767||E===-32768||(f_(n)&&(m=Math.min(m,Math.abs(E-n)||m)),n=E)};for(g=0,b=c.length;g<b;++g)E=s.getPixelForValue(c[g]),R();for(n=void 0,g=0,b=s.ticks.length;g<b;++g)E=s.getPixelForTick(g),R();return m}function sN(a,s,c,m){const g=c.barThickness;let b,E;return hs(g)?(b=s.min*c.categoryPercentage,E=c.barPercentage):(b=g*m,E=1),{chunk:b/m,ratio:E,start:s.pixels[a]-b/2}}function rN(a,s,c,m){const g=s.pixels,b=g[a];let E=a>0?g[a-1]:null,n=a<g.length-1?g[a+1]:null;const R=c.categoryPercentage;E===null&&(E=b-(n===null?s.end-s.start:n-b)),n===null&&(n=b+b-E);const B=b-(b-Math.min(E,n))/2*R;return{chunk:Math.abs(n-E)/2*R/m,ratio:c.barPercentage,start:B}}function oN(a,s,c,m){const g=c.parse(a[0],m),b=c.parse(a[1],m),E=Math.min(g,b),n=Math.max(g,b);let R=E,B=n;Math.abs(E)>Math.abs(n)&&(R=n,B=E),s[c.axis]=B,s._custom={barStart:R,barEnd:B,start:g,end:b,min:E,max:n}}function DM(a,s,c,m){return rr(a)?oN(a,s,c,m):s[c.axis]=c.parse(a,m),s}function _A(a,s,c,m){const g=a.iScale,b=a.vScale,E=g.getLabels(),n=g===b,R=[];let B,N,X,ie;for(B=c,N=c+m;B<N;++B)ie=s[B],X={},X[g.axis]=n||g.parse(E[B],B),R.push(DM(ie,X,b,B));return R}function mb(a){return a&&a.barStart!==void 0&&a.barEnd!==void 0}function aN(a,s,c){return a!==0?Ga(a):(s.isHorizontal()?1:-1)*(s.min>=c?1:-1)}function lN(a){let s,c,m,g,b;return a.horizontal?(s=a.base>a.x,c="left",m="right"):(s=a.base<a.y,c="bottom",m="top"),s?(g="end",b="start"):(g="start",b="end"),{start:c,end:m,reverse:s,top:g,bottom:b}}function cN(a,s,c,m){let g=s.borderSkipped;const b={};if(!g){a.borderSkipped=b;return}if(g===!0){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:E,end:n,reverse:R,top:B,bottom:N}=lN(a);g==="middle"&&c&&(a.enableBorderRadius=!0,(c._top||0)===m?g=B:(c._bottom||0)===m?g=N:(b[gA(N,E,n,R)]=!0,g=B)),b[gA(g,E,n,R)]=!0,a.borderSkipped=b}function gA(a,s,c,m){return m?(a=hN(a,s,c),a=yA(a,c,s)):a=yA(a,s,c),a}function hN(a,s,c){return a===s?c:a===c?s:a}function yA(a,s,c){return a==="start"?s:a==="end"?c:a}function uN(a,{inflateAmount:s},c){a.inflateAmount=s==="auto"?c===1?.33:0:s}class dN extends j1{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(s,c,m,g){return _A(s,c,m,g)}parseArrayData(s,c,m,g){return _A(s,c,m,g)}parseObjectData(s,c,m,g){const{iScale:b,vScale:E}=s,{xAxisKey:n="x",yAxisKey:R="y"}=this._parsing,B=b.axis==="x"?n:R,N=E.axis==="x"?n:R,X=[];let ie,se,we,pe;for(ie=m,se=m+g;ie<se;++ie)pe=c[ie],we={},we[b.axis]=b.parse(wf(pe,B),ie),X.push(DM(wf(pe,N),we,E,ie));return X}updateRangeFromParsed(s,c,m,g){super.updateRangeFromParsed(s,c,m,g);const b=m._custom;b&&c===this._cachedMeta.vScale&&(s.min=Math.min(s.min,b.min),s.max=Math.max(s.max,b.max))}getMaxOverflow(){return 0}getLabelAndValue(s){const c=this._cachedMeta,{iScale:m,vScale:g}=c,b=this.getParsed(s),E=b._custom,n=mb(E)?"["+E.start+", "+E.end+"]":""+g.getLabelForValue(b[g.axis]);return{label:""+m.getLabelForValue(b[m.axis]),value:n}}initialize(){this.enableOptionSharing=!0,super.initialize();const s=this._cachedMeta;s.stack=this.getDataset().stack}update(s){const c=this._cachedMeta;this.updateElements(c.data,0,c.data.length,s)}updateElements(s,c,m,g){const b=g==="reset",{index:E,_cachedMeta:{vScale:n}}=this,R=n.getBasePixel(),B=n.isHorizontal(),N=this._getRuler(),{sharedOptions:X,includeOptions:ie}=this._getSharedOptions(c,g);for(let se=c;se<c+m;se++){const we=this.getParsed(se),pe=b||hs(we[n.axis])?{base:R,head:R}:this._calculateBarValuePixels(se),Ae=this._calculateBarIndexPixels(se,N),Ie=(we._stacks||{})[n.axis],Je={horizontal:B,base:pe.base,enableBorderRadius:!Ie||mb(we._custom)||E===Ie._top||E===Ie._bottom,x:B?pe.head:Ae.center,y:B?Ae.center:pe.head,height:B?Ae.size:Math.abs(pe.size),width:B?Math.abs(pe.size):Ae.size};ie&&(Je.options=X||this.resolveDataElementOptions(se,s[se].active?"active":g));const Pe=Je.options||s[se].options;cN(Je,Pe,Ie,E),uN(Je,Pe,N.ratio),this.updateElement(s[se],se,Je,g)}}_getStacks(s,c){const{iScale:m}=this._cachedMeta,g=m.getMatchingVisibleMetas(this._type).filter(N=>N.controller.options.grouped),b=m.options.stacked,E=[],n=this._cachedMeta.controller.getParsed(c),R=n&&n[m.axis],B=N=>{const X=N._parsed.find(se=>se[m.axis]===R),ie=X&&X[N.vScale.axis];if(hs(ie)||isNaN(ie))return!0};for(const N of g)if(!(c!==void 0&&B(N))&&((b===!1||E.indexOf(N.stack)===-1||b===void 0&&N.stack===void 0)&&E.push(N.stack),N.index===s))break;return E.length||E.push(void 0),E}_getStackCount(s){return this._getStacks(void 0,s).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const s=this.chart.scales,c=this.chart.options.indexAxis;return Object.keys(s).filter(m=>s[m].axis===c).shift()}_getAxis(){const s={},c=this.getFirstScaleIdForIndexAxis();for(const m of this.chart.data.datasets)s[Gn(this.chart.options.indexAxis==="x"?m.xAxisID:m.yAxisID,c)]=!0;return Object.keys(s)}_getStackIndex(s,c,m){const g=this._getStacks(s,m),b=c!==void 0?g.indexOf(c):-1;return b===-1?g.length-1:b}_getRuler(){const s=this.options,c=this._cachedMeta,m=c.iScale,g=[];let b,E;for(b=0,E=c.data.length;b<E;++b)g.push(m.getPixelForValue(this.getParsed(b)[m.axis],b));const n=s.barThickness;return{min:n||nN(c),pixels:g,start:m._startPixel,end:m._endPixel,stackCount:this._getStackCount(),scale:m,grouped:s.grouped,ratio:n?1:s.categoryPercentage*s.barPercentage}}_calculateBarValuePixels(s){const{_cachedMeta:{vScale:c,_stacked:m,index:g},options:{base:b,minBarLength:E}}=this,n=b||0,R=this.getParsed(s),B=R._custom,N=mb(B);let X=R[c.axis],ie=0,se=m?this.applyStack(c,R,m):X,we,pe;se!==X&&(ie=se-X,se=X),N&&(X=B.barStart,se=B.barEnd-B.barStart,X!==0&&Ga(X)!==Ga(B.barEnd)&&(ie=0),ie+=X);const Ae=!hs(b)&&!N?b:ie;let Ie=c.getPixelForValue(Ae);if(this.chart.getDataVisibility(s)?we=c.getPixelForValue(ie+se):we=Ie,pe=we-Ie,Math.abs(pe)<E){pe=aN(pe,c,n)*E,X===n&&(Ie-=pe/2);const Je=c.getPixelForDecimal(0),Pe=c.getPixelForDecimal(1),Oe=Math.min(Je,Pe),tt=Math.max(Je,Pe);Ie=Math.max(Math.min(Ie,tt),Oe),we=Ie+pe,m&&!N&&(R._stacks[c.axis]._visualValues[g]=c.getValueForPixel(we)-c.getValueForPixel(Ie))}if(Ie===c.getPixelForValue(n)){const Je=Ga(pe)*c.getLineWidthForValue(n)/2;Ie+=Je,pe-=Je}return{size:pe,base:Ie,head:we,center:we+pe/2}}_calculateBarIndexPixels(s,c){const m=c.scale,g=this.options,b=g.skipNull,E=Gn(g.maxBarThickness,1/0);let n,R;const B=this._getAxisCount();if(c.grouped){const N=b?this._getStackCount(s):c.stackCount,X=g.barThickness==="flex"?rN(s,c,g,N*B):sN(s,c,g,N*B),ie=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,se=this._getAxis().indexOf(Gn(ie,this.getFirstScaleIdForIndexAxis())),we=this._getStackIndex(this.index,this._cachedMeta.stack,b?s:void 0)+se;n=X.start+X.chunk*we+X.chunk/2,R=Math.min(E,X.chunk*X.ratio)}else n=m.getPixelForValue(this.getParsed(s)[m.axis],s),R=Math.min(E,c.min*c.ratio);return{base:n-R/2,head:n+R/2,center:n,size:R}}draw(){const s=this._cachedMeta,c=s.vScale,m=s.data,g=m.length;let b=0;for(;b<g;++b)this.getParsed(b)[c.axis]!==null&&!m[b].hidden&&m[b].draw(this._ctx)}}class fN extends j1{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(s){const c=this._cachedMeta,{dataset:m,data:g=[],_dataset:b}=c,E=this.chart._animationsDisabled;let{start:n,count:R}=FF(c,g,E);this._drawStart=n,this._drawCount=R,BF(c)&&(n=0,R=g.length),m._chart=this.chart,m._datasetIndex=this.index,m._decimated=!!b._decimated,m.points=g;const B=this.resolveDatasetElementOptions(s);this.options.showLine||(B.borderWidth=0),B.segment=this.options.segment,this.updateElement(m,void 0,{animated:!E,options:B},s),this.updateElements(g,n,R,s)}updateElements(s,c,m,g){const b=g==="reset",{iScale:E,vScale:n,_stacked:R,_dataset:B}=this._cachedMeta,{sharedOptions:N,includeOptions:X}=this._getSharedOptions(c,g),ie=E.axis,se=n.axis,{spanGaps:we,segment:pe}=this.options,Ae=p_(we)?we:Number.POSITIVE_INFINITY,Ie=this.chart._animationsDisabled||b||g==="none",Je=c+m,Pe=s.length;let Oe=c>0&&this.getParsed(c-1);for(let tt=0;tt<Pe;++tt){const xt=s[tt],Tt=Ie?xt:{};if(tt<c||tt>=Je){Tt.skip=!0;continue}const At=this.getParsed(tt),Wt=hs(At[se]),Zt=Tt[ie]=E.getPixelForValue(At[ie],tt),jt=Tt[se]=b||Wt?n.getBasePixel():n.getPixelForValue(R?this.applyStack(n,At,R):At[se],tt);Tt.skip=isNaN(Zt)||isNaN(jt)||Wt,Tt.stop=tt>0&&Math.abs(At[ie]-Oe[ie])>Ae,pe&&(Tt.parsed=At,Tt.raw=B.data[tt]),X&&(Tt.options=N||this.resolveDataElementOptions(tt,xt.active?"active":g)),Ie||this.updateElement(xt,tt,Tt,g),Oe=At}}getMaxOverflow(){const s=this._cachedMeta,c=s.dataset,m=c.options&&c.options.borderWidth||0,g=s.data||[];if(!g.length)return m;const b=g[0].size(this.resolveDataElementOptions(0)),E=g[g.length-1].size(this.resolveDataElementOptions(g.length-1));return Math.max(m,b,E)/2}draw(){const s=this._cachedMeta;s.dataset.updateControlPoints(this.chart.chartArea,s.iScale.axis),super.draw()}}function lu(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class $1{static override(s){Object.assign($1.prototype,s)}options;constructor(s){this.options=s||{}}init(){}formats(){return lu()}parse(){return lu()}format(){return lu()}add(){return lu()}diff(){return lu()}startOf(){return lu()}endOf(){return lu()}}var pN={_date:$1};function mN(a,s,c,m){const{controller:g,data:b,_sorted:E}=a,n=g._cachedMeta.iScale,R=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null;if(n&&s===n.axis&&s!=="r"&&E&&b.length){const B=n._reversePixels?RF:mu;if(m){if(g._sharedOptions){const N=b[0],X=typeof N.getRange=="function"&&N.getRange(s);if(X){const ie=B(b,s,c-X),se=B(b,s,c+X);return{lo:ie.lo,hi:se.hi}}}}else{const N=B(b,s,c);if(R){const{vScale:X}=g._cachedMeta,{_parsed:ie}=a,se=ie.slice(0,N.lo+1).reverse().findIndex(pe=>!hs(pe[X.axis]));N.lo-=Math.max(0,se);const we=ie.slice(N.hi).findIndex(pe=>!hs(pe[X.axis]));N.hi+=Math.max(0,we)}return N}}return{lo:0,hi:b.length-1}}function $x(a,s,c,m,g){const b=a.getSortedVisibleDatasetMetas(),E=c[s];for(let n=0,R=b.length;n<R;++n){const{index:B,data:N}=b[n],{lo:X,hi:ie}=mN(b[n],s,E,g);for(let se=X;se<=ie;++se){const we=N[se];we.skip||m(we,B,se)}}}function _N(a){const s=a.indexOf("x")!==-1,c=a.indexOf("y")!==-1;return function(m,g){const b=s?Math.abs(m.x-g.x):0,E=c?Math.abs(m.y-g.y):0;return Math.sqrt(Math.pow(b,2)+Math.pow(E,2))}}function _b(a,s,c,m,g){const b=[];return!g&&!a.isPointInArea(s)||$x(a,c,s,function(n,R,B){!g&&!m_(n,a.chartArea,0)||n.inRange(s.x,s.y,m)&&b.push({element:n,datasetIndex:R,index:B})},!0),b}function gN(a,s,c,m){let g=[];function b(E,n,R){const{startAngle:B,endAngle:N}=E.getProps(["startAngle","endAngle"],m),{angle:X}=MF(E,{x:s.x,y:s.y});uM(X,B,N)&&g.push({element:E,datasetIndex:n,index:R})}return $x(a,c,s,b),g}function yN(a,s,c,m,g,b){let E=[];const n=_N(c);let R=Number.POSITIVE_INFINITY;function B(N,X,ie){const se=N.inRange(s.x,s.y,g);if(m&&!se)return;const we=N.getCenterPoint(g);if(!(!!b||a.isPointInArea(we))&&!se)return;const Ae=n(s,we);Ae<R?(E=[{element:N,datasetIndex:X,index:ie}],R=Ae):Ae===R&&E.push({element:N,datasetIndex:X,index:ie})}return $x(a,c,s,B),E}function gb(a,s,c,m,g,b){return!b&&!a.isPointInArea(s)?[]:c==="r"&&!m?gN(a,s,c,g):yN(a,s,c,m,g,b)}function xA(a,s,c,m,g){const b=[],E=c==="x"?"inXRange":"inYRange";let n=!1;return $x(a,c,s,(R,B,N)=>{R[E]&&R[E](s[c],g)&&(b.push({element:R,datasetIndex:B,index:N}),n=n||R.inRange(s.x,s.y,g))}),m&&!n?[]:b}var xN={modes:{index(a,s,c,m){const g=hu(s,a),b=c.axis||"x",E=c.includeInvisible||!1,n=c.intersect?_b(a,g,b,m,E):gb(a,g,b,!1,m,E),R=[];return n.length?(a.getSortedVisibleDatasetMetas().forEach(B=>{const N=n[0].index,X=B.data[N];X&&!X.skip&&R.push({element:X,datasetIndex:B.index,index:N})}),R):[]},dataset(a,s,c,m){const g=hu(s,a),b=c.axis||"xy",E=c.includeInvisible||!1;let n=c.intersect?_b(a,g,b,m,E):gb(a,g,b,!1,m,E);if(n.length>0){const R=n[0].datasetIndex,B=a.getDatasetMeta(R).data;n=[];for(let N=0;N<B.length;++N)n.push({element:B[N],datasetIndex:R,index:N})}return n},point(a,s,c,m){const g=hu(s,a),b=c.axis||"xy",E=c.includeInvisible||!1;return _b(a,g,b,m,E)},nearest(a,s,c,m){const g=hu(s,a),b=c.axis||"xy",E=c.includeInvisible||!1;return gb(a,g,b,c.intersect,m,E)},x(a,s,c,m){const g=hu(s,a);return xA(a,g,"x",c.intersect,m)},y(a,s,c,m){const g=hu(s,a);return xA(a,g,"y",c.intersect,m)}}};const RM=["left","top","right","bottom"];function Lm(a,s){return a.filter(c=>c.pos===s)}function vA(a,s){return a.filter(c=>RM.indexOf(c.pos)===-1&&c.box.axis===s)}function zm(a,s){return a.sort((c,m)=>{const g=s?m:c,b=s?c:m;return g.weight===b.weight?g.index-b.index:g.weight-b.weight})}function vN(a){const s=[];let c,m,g,b,E,n;for(c=0,m=(a||[]).length;c<m;++c)g=a[c],{position:b,options:{stack:E,stackWeight:n=1}}=g,s.push({index:c,box:g,pos:b,horizontal:g.isHorizontal(),weight:g.weight,stack:E&&b+E,stackWeight:n});return s}function bN(a){const s={};for(const c of a){const{stack:m,pos:g,stackWeight:b}=c;if(!m||!RM.includes(g))continue;const E=s[m]||(s[m]={count:0,placed:0,weight:0,size:0});E.count++,E.weight+=b}return s}function wN(a,s){const c=bN(a),{vBoxMaxWidth:m,hBoxMaxHeight:g}=s;let b,E,n;for(b=0,E=a.length;b<E;++b){n=a[b];const{fullSize:R}=n.box,B=c[n.stack],N=B&&n.stackWeight/B.weight;n.horizontal?(n.width=N?N*m:R&&s.availableWidth,n.height=g):(n.width=m,n.height=N?N*g:R&&s.availableHeight)}return c}function TN(a){const s=vN(a),c=zm(s.filter(B=>B.box.fullSize),!0),m=zm(Lm(s,"left"),!0),g=zm(Lm(s,"right")),b=zm(Lm(s,"top"),!0),E=zm(Lm(s,"bottom")),n=vA(s,"x"),R=vA(s,"y");return{fullSize:c,leftAndTop:m.concat(b),rightAndBottom:g.concat(R).concat(E).concat(n),chartArea:Lm(s,"chartArea"),vertical:m.concat(g).concat(R),horizontal:b.concat(E).concat(n)}}function bA(a,s,c,m){return Math.max(a[c],s[c])+Math.max(a[m],s[m])}function LM(a,s){a.top=Math.max(a.top,s.top),a.left=Math.max(a.left,s.left),a.bottom=Math.max(a.bottom,s.bottom),a.right=Math.max(a.right,s.right)}function SN(a,s,c,m){const{pos:g,box:b}=c,E=a.maxPadding;if(!ls(g)){c.size&&(a[g]-=c.size);const X=m[c.stack]||{size:0,count:1};X.size=Math.max(X.size,c.horizontal?b.height:b.width),c.size=X.size/X.count,a[g]+=c.size}b.getPadding&&LM(E,b.getPadding());const n=Math.max(0,s.outerWidth-bA(E,a,"left","right")),R=Math.max(0,s.outerHeight-bA(E,a,"top","bottom")),B=n!==a.w,N=R!==a.h;return a.w=n,a.h=R,c.horizontal?{same:B,other:N}:{same:N,other:B}}function EN(a){const s=a.maxPadding;function c(m){const g=Math.max(s[m]-a[m],0);return a[m]+=g,g}a.y+=c("top"),a.x+=c("left"),c("right"),c("bottom")}function AN(a,s){const c=s.maxPadding;function m(g){const b={left:0,top:0,right:0,bottom:0};return g.forEach(E=>{b[E]=Math.max(s[E],c[E])}),b}return m(a?["left","right"]:["top","bottom"])}function $m(a,s,c,m){const g=[];let b,E,n,R,B,N;for(b=0,E=a.length,B=0;b<E;++b){n=a[b],R=n.box,R.update(n.width||s.w,n.height||s.h,AN(n.horizontal,s));const{same:X,other:ie}=SN(s,c,n,m);B|=X&&g.length,N=N||ie,R.fullSize||g.push(n)}return B&&$m(g,s,c,m)||N}function Vy(a,s,c,m,g){a.top=c,a.left=s,a.right=s+m,a.bottom=c+g,a.width=m,a.height=g}function wA(a,s,c,m){const g=c.padding;let{x:b,y:E}=s;for(const n of a){const R=n.box,B=m[n.stack]||{placed:0,weight:1},N=n.stackWeight/B.weight||1;if(n.horizontal){const X=s.w*N,ie=B.size||R.height;f_(B.start)&&(E=B.start),R.fullSize?Vy(R,g.left,E,c.outerWidth-g.right-g.left,ie):Vy(R,s.left+B.placed,E,X,ie),B.start=E,B.placed+=X,E=R.bottom}else{const X=s.h*N,ie=B.size||R.width;f_(B.start)&&(b=B.start),R.fullSize?Vy(R,b,g.top,ie,c.outerHeight-g.bottom-g.top):Vy(R,b,s.top+B.placed,ie,X),B.start=b,B.placed+=X,b=R.right}}s.x=b,s.y=E}var zo={addBox(a,s){a.boxes||(a.boxes=[]),s.fullSize=s.fullSize||!1,s.position=s.position||"top",s.weight=s.weight||0,s._layers=s._layers||function(){return[{z:0,draw(c){s.draw(c)}}]},a.boxes.push(s)},removeBox(a,s){const c=a.boxes?a.boxes.indexOf(s):-1;c!==-1&&a.boxes.splice(c,1)},configure(a,s,c){s.fullSize=c.fullSize,s.position=c.position,s.weight=c.weight},update(a,s,c,m){if(!a)return;const g=Bo(a.options.layout.padding),b=Math.max(s-g.width,0),E=Math.max(c-g.height,0),n=TN(a.boxes),R=n.vertical,B=n.horizontal;fs(a.boxes,pe=>{typeof pe.beforeLayout=="function"&&pe.beforeLayout()});const N=R.reduce((pe,Ae)=>Ae.box.options&&Ae.box.options.display===!1?pe:pe+1,0)||1,X=Object.freeze({outerWidth:s,outerHeight:c,padding:g,availableWidth:b,availableHeight:E,vBoxMaxWidth:b/2/N,hBoxMaxHeight:E/2}),ie=Object.assign({},g);LM(ie,Bo(m));const se=Object.assign({maxPadding:ie,w:b,h:E,x:g.left,y:g.top},g),we=wN(R.concat(B),X);$m(n.fullSize,se,X,we),$m(R,se,X,we),$m(B,se,X,we)&&$m(R,se,X,we),EN(se),wA(n.leftAndTop,se,X,we),se.x+=se.w,se.y+=se.h,wA(n.rightAndBottom,se,X,we),a.chartArea={left:se.left,top:se.top,right:se.left+se.w,bottom:se.top+se.h,height:se.h,width:se.w},fs(n.chartArea,pe=>{const Ae=pe.box;Object.assign(Ae,a.chartArea),Ae.update(se.w,se.h,{left:0,top:0,right:0,bottom:0})})}};class zM{acquireContext(s,c){}releaseContext(s){return!1}addEventListener(s,c,m){}removeEventListener(s,c,m){}getDevicePixelRatio(){return 1}getMaximumSize(s,c,m,g){return c=Math.max(0,c||s.width),m=m||s.height,{width:c,height:Math.max(0,g?Math.floor(c/g):m)}}isAttached(s){return!0}updateConfig(s){}}class IN extends zM{acquireContext(s){return s&&s.getContext&&s.getContext("2d")||null}updateConfig(s){s.options.animation=!1}}const ax="$chartjs",CN={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},TA=a=>a===null||a==="";function MN(a,s){const c=a.style,m=a.getAttribute("height"),g=a.getAttribute("width");if(a[ax]={initial:{height:m,width:g,style:{display:c.display,height:c.height,width:c.width}}},c.display=c.display||"block",c.boxSizing=c.boxSizing||"border-box",TA(g)){const b=oA(a,"width");b!==void 0&&(a.width=b)}if(TA(m))if(a.style.height==="")a.height=a.width/(s||2);else{const b=oA(a,"height");b!==void 0&&(a.height=b)}return a}const OM=IB?{passive:!0}:!1;function PN(a,s,c){a&&a.addEventListener(s,c,OM)}function DN(a,s,c){a&&a.canvas&&a.canvas.removeEventListener(s,c,OM)}function RN(a,s){const c=CN[a.type]||a.type,{x:m,y:g}=hu(a,s);return{type:c,chart:s,native:a,x:m!==void 0?m:null,y:g!==void 0?g:null}}function Cx(a,s){for(const c of a)if(c===s||c.contains(s))return!0}function LN(a,s,c){const m=a.canvas,g=new MutationObserver(b=>{let E=!1;for(const n of b)E=E||Cx(n.addedNodes,m),E=E&&!Cx(n.removedNodes,m);E&&c()});return g.observe(document,{childList:!0,subtree:!0}),g}function zN(a,s,c){const m=a.canvas,g=new MutationObserver(b=>{let E=!1;for(const n of b)E=E||Cx(n.removedNodes,m),E=E&&!Cx(n.addedNodes,m);E&&c()});return g.observe(document,{childList:!0,subtree:!0}),g}const g_=new Map;let SA=0;function kM(){const a=window.devicePixelRatio;a!==SA&&(SA=a,g_.forEach((s,c)=>{c.currentDevicePixelRatio!==a&&s()}))}function ON(a,s){g_.size||window.addEventListener("resize",kM),g_.set(a,s)}function kN(a){g_.delete(a),g_.size||window.removeEventListener("resize",kM)}function FN(a,s,c){const m=a.canvas,g=m&&U1(m);if(!g)return;const b=mM((n,R)=>{const B=g.clientWidth;c(n,R),B<g.clientWidth&&c()},window),E=new ResizeObserver(n=>{const R=n[0],B=R.contentRect.width,N=R.contentRect.height;B===0&&N===0||b(B,N)});return E.observe(g),ON(a,b),E}function yb(a,s,c){c&&c.disconnect(),s==="resize"&&kN(a)}function BN(a,s,c){const m=a.canvas,g=mM(b=>{a.ctx!==null&&c(RN(b,a))},a);return PN(m,s,g),g}class NN extends zM{acquireContext(s,c){const m=s&&s.getContext&&s.getContext("2d");return m&&m.canvas===s?(MN(s,c),m):null}releaseContext(s){const c=s.canvas;if(!c[ax])return!1;const m=c[ax].initial;["height","width"].forEach(b=>{const E=m[b];hs(E)?c.removeAttribute(b):c.setAttribute(b,E)});const g=m.style||{};return Object.keys(g).forEach(b=>{c.style[b]=g[b]}),c.width=c.width,delete c[ax],!0}addEventListener(s,c,m){this.removeEventListener(s,c);const g=s.$proxies||(s.$proxies={}),E={attach:LN,detach:zN,resize:FN}[c]||BN;g[c]=E(s,c,m)}removeEventListener(s,c){const m=s.$proxies||(s.$proxies={}),g=m[c];if(!g)return;({attach:yb,detach:yb,resize:yb}[c]||DN)(s,c,g),m[c]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(s,c,m,g){return AB(s,c,m,g)}isAttached(s){const c=s&&U1(s);return!!(c&&c.isConnected)}}function VN(a){return!V1()||typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas?IN:NN}let Xc=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(s){const{x:c,y:m}=this.getProps(["x","y"],s);return{x:c,y:m}}hasValue(){return p_(this.x)&&p_(this.y)}getProps(s,c){const m=this.$animations;if(!c||!m)return this;const g={};return s.forEach(b=>{g[b]=m[b]&&m[b].active()?m[b]._to:this[b]}),g}};function UN(a,s){const c=a.options.ticks,m=jN(a),g=Math.min(c.maxTicksLimit||m,m),b=c.major.enabled?GN(s):[],E=b.length,n=b[0],R=b[E-1],B=[];if(E>g)return HN(s,B,b,E/g),B;const N=$N(b,s,g);if(E>0){let X,ie;const se=E>1?Math.round((R-n)/(E-1)):null;for(Uy(s,B,N,hs(se)?0:n-se,n),X=0,ie=E-1;X<ie;X++)Uy(s,B,N,b[X],b[X+1]);return Uy(s,B,N,R,hs(se)?s.length:R+se),B}return Uy(s,B,N),B}function jN(a){const s=a.options.offset,c=a._tickSize(),m=a._length/c+(s?0:1),g=a._maxLength/c;return Math.floor(Math.min(m,g))}function $N(a,s,c){const m=WN(a),g=s.length/c;if(!m)return Math.max(g,1);const b=SF(m);for(let E=0,n=b.length-1;E<n;E++){const R=b[E];if(R>g)return R}return Math.max(g,1)}function GN(a){const s=[];let c,m;for(c=0,m=a.length;c<m;c++)a[c].major&&s.push(c);return s}function HN(a,s,c,m){let g=0,b=c[0],E;for(m=Math.ceil(m),E=0;E<a.length;E++)E===b&&(s.push(a[E]),g++,b=c[g*m])}function Uy(a,s,c,m,g){const b=Gn(m,0),E=Math.min(Gn(g,a.length),a.length);let n=0,R,B,N;for(c=Math.ceil(c),g&&(R=g-m,c=R/Math.floor(R/c)),N=b;N<0;)n++,N=Math.round(b+n*c);for(B=Math.max(b,0);B<E;B++)B===N&&(s.push(a[B]),n++,N=Math.round(b+n*c))}function WN(a){const s=a.length;let c,m;if(s<2)return!1;for(m=a[0],c=1;c<s;++c)if(a[c]-a[c-1]!==m)return!1;return m}const qN=a=>a==="left"?"right":a==="right"?"left":a,EA=(a,s,c)=>s==="top"||s==="left"?a[s]+c:a[s]-c,AA=(a,s)=>Math.min(s||a,a);function IA(a,s){const c=[],m=a.length/s,g=a.length;let b=0;for(;b<g;b+=m)c.push(a[Math.floor(b)]);return c}function ZN(a,s,c){const m=a.ticks.length,g=Math.min(s,m-1),b=a._startPixel,E=a._endPixel,n=1e-6;let R=a.getPixelForTick(g),B;if(!(c&&(m===1?B=Math.max(R-b,E-R):s===0?B=(a.getPixelForTick(1)-R)/2:B=(R-a.getPixelForTick(g-1))/2,R+=g<s?B:-B,R<b-n||R>E+n)))return R}function XN(a,s){fs(a,c=>{const m=c.gc,g=m.length/2;let b;if(g>s){for(b=0;b<g;++b)delete c.data[m[b]];m.splice(0,g)}})}function Om(a){return a.drawTicks?a.tickLength:0}function CA(a,s){if(!a.display)return 0;const c=Rr(a.font,s),m=Bo(a.padding);return(rr(a.text)?a.text.length:1)*c.lineHeight+m.height}function YN(a,s){return Cu(a,{scale:s,type:"scale"})}function KN(a,s,c){return Cu(a,{tick:c,index:s,type:"tick"})}function JN(a,s,c){let m=L1(a);return(c&&s!=="right"||!c&&s==="right")&&(m=qN(m)),m}function QN(a,s,c,m){const{top:g,left:b,bottom:E,right:n,chart:R}=a,{chartArea:B,scales:N}=R;let X=0,ie,se,we;const pe=E-g,Ae=n-b;if(a.isHorizontal()){if(se=Pr(m,b,n),ls(c)){const Ie=Object.keys(c)[0],Je=c[Ie];we=N[Ie].getPixelForValue(Je)+pe-s}else c==="center"?we=(B.bottom+B.top)/2+pe-s:we=EA(a,c,s);ie=n-b}else{if(ls(c)){const Ie=Object.keys(c)[0],Je=c[Ie];se=N[Ie].getPixelForValue(Je)-Ae+s}else c==="center"?se=(B.left+B.right)/2-Ae+s:se=EA(a,c,s);we=Pr(m,E,g),X=c==="left"?-ha:ha}return{titleX:se,titleY:we,maxWidth:ie,rotation:X}}class zf extends Xc{constructor(s){super(),this.id=s.id,this.type=s.type,this.options=void 0,this.ctx=s.ctx,this.chart=s.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(s){this.options=s.setContext(this.getContext()),this.axis=s.axis,this._userMin=this.parse(s.min),this._userMax=this.parse(s.max),this._suggestedMin=this.parse(s.suggestedMin),this._suggestedMax=this.parse(s.suggestedMax)}parse(s,c){return s}getUserBounds(){let{_userMin:s,_userMax:c,_suggestedMin:m,_suggestedMax:g}=this;return s=Ba(s,Number.POSITIVE_INFINITY),c=Ba(c,Number.NEGATIVE_INFINITY),m=Ba(m,Number.POSITIVE_INFINITY),g=Ba(g,Number.NEGATIVE_INFINITY),{min:Ba(s,m),max:Ba(c,g),minDefined:Fo(s),maxDefined:Fo(c)}}getMinMax(s){let{min:c,max:m,minDefined:g,maxDefined:b}=this.getUserBounds(),E;if(g&&b)return{min:c,max:m};const n=this.getMatchingVisibleMetas();for(let R=0,B=n.length;R<B;++R)E=n[R].controller.getMinMax(this,s),g||(c=Math.min(c,E.min)),b||(m=Math.max(m,E.max));return c=b&&c>m?m:c,m=g&&c>m?c:m,{min:Ba(c,Ba(m,c)),max:Ba(m,Ba(c,m))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const s=this.chart.data;return this.options.labels||(this.isHorizontal()?s.xLabels:s.yLabels)||s.labels||[]}getLabelItems(s=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(s))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Ms(this.options.beforeUpdate,[this])}update(s,c,m){const{beginAtZero:g,grace:b,ticks:E}=this.options,n=E.sampleSize;this.beforeUpdate(),this.maxWidth=s,this.maxHeight=c,this._margins=m=Object.assign({left:0,right:0,top:0,bottom:0},m),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+m.left+m.right:this.height+m.top+m.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=sB(this,b,g),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const R=n<this.ticks.length;this._convertTicksToLabels(R?IA(this.ticks,n):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),E.display&&(E.autoSkip||E.source==="auto")&&(this.ticks=UN(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),R&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let s=this.options.reverse,c,m;this.isHorizontal()?(c=this.left,m=this.right):(c=this.top,m=this.bottom,s=!s),this._startPixel=c,this._endPixel=m,this._reversePixels=s,this._length=m-c,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Ms(this.options.afterUpdate,[this])}beforeSetDimensions(){Ms(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Ms(this.options.afterSetDimensions,[this])}_callHooks(s){this.chart.notifyPlugins(s,this.getContext()),Ms(this.options[s],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Ms(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(s){const c=this.options.ticks;let m,g,b;for(m=0,g=s.length;m<g;m++)b=s[m],b.label=Ms(c.callback,[b.value,m,s],this)}afterTickToLabelConversion(){Ms(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Ms(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const s=this.options,c=s.ticks,m=AA(this.ticks.length,s.ticks.maxTicksLimit),g=c.minRotation||0,b=c.maxRotation;let E=g,n,R,B;if(!this._isVisible()||!c.display||g>=b||m<=1||!this.isHorizontal()){this.labelRotation=g;return}const N=this._getLabelSizes(),X=N.widest.width,ie=N.highest.height,se=go(this.chart.width-X,0,this.maxWidth);n=s.offset?this.maxWidth/m:se/(m-1),X+6>n&&(n=se/(m-(s.offset?.5:1)),R=this.maxHeight-Om(s.grid)-c.padding-CA(s.title,this.chart.options.font),B=Math.sqrt(X*X+ie*ie),E=CF(Math.min(Math.asin(go((N.highest.height+6)/n,-1,1)),Math.asin(go(R/B,-1,1))-Math.asin(go(ie/B,-1,1)))),E=Math.max(g,Math.min(b,E))),this.labelRotation=E}afterCalculateLabelRotation(){Ms(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Ms(this.options.beforeFit,[this])}fit(){const s={width:0,height:0},{chart:c,options:{ticks:m,title:g,grid:b}}=this,E=this._isVisible(),n=this.isHorizontal();if(E){const R=CA(g,c.options.font);if(n?(s.width=this.maxWidth,s.height=Om(b)+R):(s.height=this.maxHeight,s.width=Om(b)+R),m.display&&this.ticks.length){const{first:B,last:N,widest:X,highest:ie}=this._getLabelSizes(),se=m.padding*2,we=fu(this.labelRotation),pe=Math.cos(we),Ae=Math.sin(we);if(n){const Ie=m.mirror?0:Ae*X.width+pe*ie.height;s.height=Math.min(this.maxHeight,s.height+Ie+se)}else{const Ie=m.mirror?0:pe*X.width+Ae*ie.height;s.width=Math.min(this.maxWidth,s.width+Ie+se)}this._calculatePadding(B,N,Ae,pe)}}this._handleMargins(),n?(this.width=this._length=c.width-this._margins.left-this._margins.right,this.height=s.height):(this.width=s.width,this.height=this._length=c.height-this._margins.top-this._margins.bottom)}_calculatePadding(s,c,m,g){const{ticks:{align:b,padding:E},position:n}=this.options,R=this.labelRotation!==0,B=n!=="top"&&this.axis==="x";if(this.isHorizontal()){const N=this.getPixelForTick(0)-this.left,X=this.right-this.getPixelForTick(this.ticks.length-1);let ie=0,se=0;R?B?(ie=g*s.width,se=m*c.height):(ie=m*s.height,se=g*c.width):b==="start"?se=c.width:b==="end"?ie=s.width:b!=="inner"&&(ie=s.width/2,se=c.width/2),this.paddingLeft=Math.max((ie-N+E)*this.width/(this.width-N),0),this.paddingRight=Math.max((se-X+E)*this.width/(this.width-X),0)}else{let N=c.height/2,X=s.height/2;b==="start"?(N=0,X=s.height):b==="end"&&(N=c.height,X=0),this.paddingTop=N+E,this.paddingBottom=X+E}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Ms(this.options.afterFit,[this])}isHorizontal(){const{axis:s,position:c}=this.options;return c==="top"||c==="bottom"||s==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(s){this.beforeTickToLabelConversion(),this.generateTickLabels(s);let c,m;for(c=0,m=s.length;c<m;c++)hs(s[c].label)&&(s.splice(c,1),m--,c--);this.afterTickToLabelConversion()}_getLabelSizes(){let s=this._labelSizes;if(!s){const c=this.options.ticks.sampleSize;let m=this.ticks;c<m.length&&(m=IA(m,c)),this._labelSizes=s=this._computeLabelSizes(m,m.length,this.options.ticks.maxTicksLimit)}return s}_computeLabelSizes(s,c,m){const{ctx:g,_longestTextCache:b}=this,E=[],n=[],R=Math.floor(c/AA(c,m));let B=0,N=0,X,ie,se,we,pe,Ae,Ie,Je,Pe,Oe,tt;for(X=0;X<c;X+=R){if(we=s[X].label,pe=this._resolveTickFontOptions(X),g.font=Ae=pe.string,Ie=b[Ae]=b[Ae]||{data:{},gc:[]},Je=pe.lineHeight,Pe=Oe=0,!hs(we)&&!rr(we))Pe=tA(g,Ie.data,Ie.gc,Pe,we),Oe=Je;else if(rr(we))for(ie=0,se=we.length;ie<se;++ie)tt=we[ie],!hs(tt)&&!rr(tt)&&(Pe=tA(g,Ie.data,Ie.gc,Pe,tt),Oe+=Je);E.push(Pe),n.push(Oe),B=Math.max(Pe,B),N=Math.max(Oe,N)}XN(b,c);const xt=E.indexOf(B),Tt=n.indexOf(N),At=Wt=>({width:E[Wt]||0,height:n[Wt]||0});return{first:At(0),last:At(c-1),widest:At(xt),highest:At(Tt),widths:E,heights:n}}getLabelForValue(s){return s}getPixelForValue(s,c){return NaN}getValueForPixel(s){}getPixelForTick(s){const c=this.ticks;return s<0||s>c.length-1?null:this.getPixelForValue(c[s].value)}getPixelForDecimal(s){this._reversePixels&&(s=1-s);const c=this._startPixel+s*this._length;return DF(this._alignToPixels?au(this.chart,c,0):c)}getDecimalForPixel(s){const c=(s-this._startPixel)/this._length;return this._reversePixels?1-c:c}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:s,max:c}=this;return s<0&&c<0?c:s>0&&c>0?s:0}getContext(s){const c=this.ticks||[];if(s>=0&&s<c.length){const m=c[s];return m.$context||(m.$context=KN(this.getContext(),s,m))}return this.$context||(this.$context=YN(this.chart.getContext(),this))}_tickSize(){const s=this.options.ticks,c=fu(this.labelRotation),m=Math.abs(Math.cos(c)),g=Math.abs(Math.sin(c)),b=this._getLabelSizes(),E=s.autoSkipPadding||0,n=b?b.widest.width+E:0,R=b?b.highest.height+E:0;return this.isHorizontal()?R*m>n*g?n/m:R/g:R*g<n*m?R/m:n/g}_isVisible(){const s=this.options.display;return s!=="auto"?!!s:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(s){const c=this.axis,m=this.chart,g=this.options,{grid:b,position:E,border:n}=g,R=b.offset,B=this.isHorizontal(),X=this.ticks.length+(R?1:0),ie=Om(b),se=[],we=n.setContext(this.getContext()),pe=we.display?we.width:0,Ae=pe/2,Ie=function($t){return au(m,$t,pe)};let Je,Pe,Oe,tt,xt,Tt,At,Wt,Zt,jt,pi,gi;if(E==="top")Je=Ie(this.bottom),Tt=this.bottom-ie,Wt=Je-Ae,jt=Ie(s.top)+Ae,gi=s.bottom;else if(E==="bottom")Je=Ie(this.top),jt=s.top,gi=Ie(s.bottom)-Ae,Tt=Je+Ae,Wt=this.top+ie;else if(E==="left")Je=Ie(this.right),xt=this.right-ie,At=Je-Ae,Zt=Ie(s.left)+Ae,pi=s.right;else if(E==="right")Je=Ie(this.left),Zt=s.left,pi=Ie(s.right)-Ae,xt=Je+Ae,At=this.left+ie;else if(c==="x"){if(E==="center")Je=Ie((s.top+s.bottom)/2+.5);else if(ls(E)){const $t=Object.keys(E)[0],xi=E[$t];Je=Ie(this.chart.scales[$t].getPixelForValue(xi))}jt=s.top,gi=s.bottom,Tt=Je+Ae,Wt=Tt+ie}else if(c==="y"){if(E==="center")Je=Ie((s.left+s.right)/2);else if(ls(E)){const $t=Object.keys(E)[0],xi=E[$t];Je=Ie(this.chart.scales[$t].getPixelForValue(xi))}xt=Je-Ae,At=xt-ie,Zt=s.left,pi=s.right}const _i=Gn(g.ticks.maxTicksLimit,X),yi=Math.max(1,Math.ceil(X/_i));for(Pe=0;Pe<X;Pe+=yi){const $t=this.getContext(Pe),xi=b.setContext($t),hi=n.setContext($t),sn=xi.lineWidth,Ui=xi.color,ss=hi.dash||[],jn=hi.dashOffset,Fs=xi.tickWidth,Is=xi.tickColor,Zi=xi.tickBorderDash||[],en=xi.tickBorderDashOffset;Oe=ZN(this,Pe,R),Oe!==void 0&&(tt=au(m,Oe,sn),B?xt=At=Zt=pi=tt:Tt=Wt=jt=gi=tt,se.push({tx1:xt,ty1:Tt,tx2:At,ty2:Wt,x1:Zt,y1:jt,x2:pi,y2:gi,width:sn,color:Ui,borderDash:ss,borderDashOffset:jn,tickWidth:Fs,tickColor:Is,tickBorderDash:Zi,tickBorderDashOffset:en}))}return this._ticksLength=X,this._borderValue=Je,se}_computeLabelItems(s){const c=this.axis,m=this.options,{position:g,ticks:b}=m,E=this.isHorizontal(),n=this.ticks,{align:R,crossAlign:B,padding:N,mirror:X}=b,ie=Om(m.grid),se=ie+N,we=X?-N:se,pe=-fu(this.labelRotation),Ae=[];let Ie,Je,Pe,Oe,tt,xt,Tt,At,Wt,Zt,jt,pi,gi="middle";if(g==="top")xt=this.bottom-we,Tt=this._getXAxisLabelAlignment();else if(g==="bottom")xt=this.top+we,Tt=this._getXAxisLabelAlignment();else if(g==="left"){const yi=this._getYAxisLabelAlignment(ie);Tt=yi.textAlign,tt=yi.x}else if(g==="right"){const yi=this._getYAxisLabelAlignment(ie);Tt=yi.textAlign,tt=yi.x}else if(c==="x"){if(g==="center")xt=(s.top+s.bottom)/2+se;else if(ls(g)){const yi=Object.keys(g)[0],$t=g[yi];xt=this.chart.scales[yi].getPixelForValue($t)+se}Tt=this._getXAxisLabelAlignment()}else if(c==="y"){if(g==="center")tt=(s.left+s.right)/2-se;else if(ls(g)){const yi=Object.keys(g)[0],$t=g[yi];tt=this.chart.scales[yi].getPixelForValue($t)}Tt=this._getYAxisLabelAlignment(ie).textAlign}c==="y"&&(R==="start"?gi="top":R==="end"&&(gi="bottom"));const _i=this._getLabelSizes();for(Ie=0,Je=n.length;Ie<Je;++Ie){Pe=n[Ie],Oe=Pe.label;const yi=b.setContext(this.getContext(Ie));At=this.getPixelForTick(Ie)+b.labelOffset,Wt=this._resolveTickFontOptions(Ie),Zt=Wt.lineHeight,jt=rr(Oe)?Oe.length:1;const $t=jt/2,xi=yi.color,hi=yi.textStrokeColor,sn=yi.textStrokeWidth;let Ui=Tt;E?(tt=At,Tt==="inner"&&(Ie===Je-1?Ui=this.options.reverse?"left":"right":Ie===0?Ui=this.options.reverse?"right":"left":Ui="center"),g==="top"?B==="near"||pe!==0?pi=-jt*Zt+Zt/2:B==="center"?pi=-_i.highest.height/2-$t*Zt+Zt:pi=-_i.highest.height+Zt/2:B==="near"||pe!==0?pi=Zt/2:B==="center"?pi=_i.highest.height/2-$t*Zt:pi=_i.highest.height-jt*Zt,X&&(pi*=-1),pe!==0&&!yi.showLabelBackdrop&&(tt+=Zt/2*Math.sin(pe))):(xt=At,pi=(1-jt)*Zt/2);let ss;if(yi.showLabelBackdrop){const jn=Bo(yi.backdropPadding),Fs=_i.heights[Ie],Is=_i.widths[Ie];let Zi=pi-jn.top,en=0-jn.left;switch(gi){case"middle":Zi-=Fs/2;break;case"bottom":Zi-=Fs;break}switch(Tt){case"center":en-=Is/2;break;case"right":en-=Is;break;case"inner":Ie===Je-1?en-=Is:Ie>0&&(en-=Is/2);break}ss={left:en,top:Zi,width:Is+jn.width,height:Fs+jn.height,color:yi.backdropColor}}Ae.push({label:Oe,font:Wt,textOffset:pi,options:{rotation:pe,color:xi,strokeColor:hi,strokeWidth:sn,textAlign:Ui,textBaseline:gi,translation:[tt,xt],backdrop:ss}})}return Ae}_getXAxisLabelAlignment(){const{position:s,ticks:c}=this.options;if(-fu(this.labelRotation))return s==="top"?"left":"right";let g="center";return c.align==="start"?g="left":c.align==="end"?g="right":c.align==="inner"&&(g="inner"),g}_getYAxisLabelAlignment(s){const{position:c,ticks:{crossAlign:m,mirror:g,padding:b}}=this.options,E=this._getLabelSizes(),n=s+b,R=E.widest.width;let B,N;return c==="left"?g?(N=this.right+b,m==="near"?B="left":m==="center"?(B="center",N+=R/2):(B="right",N+=R)):(N=this.right-n,m==="near"?B="right":m==="center"?(B="center",N-=R/2):(B="left",N=this.left)):c==="right"?g?(N=this.left+b,m==="near"?B="right":m==="center"?(B="center",N-=R/2):(B="left",N-=R)):(N=this.left+n,m==="near"?B="left":m==="center"?(B="center",N+=R/2):(B="right",N=this.right)):B="right",{textAlign:B,x:N}}_computeLabelArea(){if(this.options.ticks.mirror)return;const s=this.chart,c=this.options.position;if(c==="left"||c==="right")return{top:0,left:this.left,bottom:s.height,right:this.right};if(c==="top"||c==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:s.width}}drawBackground(){const{ctx:s,options:{backgroundColor:c},left:m,top:g,width:b,height:E}=this;c&&(s.save(),s.fillStyle=c,s.fillRect(m,g,b,E),s.restore())}getLineWidthForValue(s){const c=this.options.grid;if(!this._isVisible()||!c.display)return 0;const g=this.ticks.findIndex(b=>b.value===s);return g>=0?c.setContext(this.getContext(g)).lineWidth:0}drawGrid(s){const c=this.options.grid,m=this.ctx,g=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(s));let b,E;const n=(R,B,N)=>{!N.width||!N.color||(m.save(),m.lineWidth=N.width,m.strokeStyle=N.color,m.setLineDash(N.borderDash||[]),m.lineDashOffset=N.borderDashOffset,m.beginPath(),m.moveTo(R.x,R.y),m.lineTo(B.x,B.y),m.stroke(),m.restore())};if(c.display)for(b=0,E=g.length;b<E;++b){const R=g[b];c.drawOnChartArea&&n({x:R.x1,y:R.y1},{x:R.x2,y:R.y2},R),c.drawTicks&&n({x:R.tx1,y:R.ty1},{x:R.tx2,y:R.ty2},{color:R.tickColor,width:R.tickWidth,borderDash:R.tickBorderDash,borderDashOffset:R.tickBorderDashOffset})}}drawBorder(){const{chart:s,ctx:c,options:{border:m,grid:g}}=this,b=m.setContext(this.getContext()),E=m.display?b.width:0;if(!E)return;const n=g.setContext(this.getContext(0)).lineWidth,R=this._borderValue;let B,N,X,ie;this.isHorizontal()?(B=au(s,this.left,E)-E/2,N=au(s,this.right,n)+n/2,X=ie=R):(X=au(s,this.top,E)-E/2,ie=au(s,this.bottom,n)+n/2,B=N=R),c.save(),c.lineWidth=b.width,c.strokeStyle=b.color,c.beginPath(),c.moveTo(B,X),c.lineTo(N,ie),c.stroke(),c.restore()}drawLabels(s){if(!this.options.ticks.display)return;const m=this.ctx,g=this._computeLabelArea();g&&O1(m,g);const b=this.getLabelItems(s);for(const E of b){const n=E.options,R=E.font,B=E.label,N=E.textOffset;__(m,B,0,N,R,n)}g&&k1(m)}drawTitle(){const{ctx:s,options:{position:c,title:m,reverse:g}}=this;if(!m.display)return;const b=Rr(m.font),E=Bo(m.padding),n=m.align;let R=b.lineHeight/2;c==="bottom"||c==="center"||ls(c)?(R+=E.bottom,rr(m.text)&&(R+=b.lineHeight*(m.text.length-1))):R+=E.top;const{titleX:B,titleY:N,maxWidth:X,rotation:ie}=QN(this,R,c,n);__(s,m.text,0,0,b,{color:m.color,maxWidth:X,rotation:ie,textAlign:JN(n,c,g),textBaseline:"middle",translation:[B,N]})}draw(s){this._isVisible()&&(this.drawBackground(),this.drawGrid(s),this.drawBorder(),this.drawTitle(),this.drawLabels(s))}_layers(){const s=this.options,c=s.ticks&&s.ticks.z||0,m=Gn(s.grid&&s.grid.z,-1),g=Gn(s.border&&s.border.z,0);return!this._isVisible()||this.draw!==zf.prototype.draw?[{z:c,draw:b=>{this.draw(b)}}]:[{z:m,draw:b=>{this.drawBackground(),this.drawGrid(b),this.drawTitle()}},{z:g,draw:()=>{this.drawBorder()}},{z:c,draw:b=>{this.drawLabels(b)}}]}getMatchingVisibleMetas(s){const c=this.chart.getSortedVisibleDatasetMetas(),m=this.axis+"AxisID",g=[];let b,E;for(b=0,E=c.length;b<E;++b){const n=c[b];n[m]===this.id&&(!s||n.type===s)&&g.push(n)}return g}_resolveTickFontOptions(s){const c=this.options.ticks.setContext(this.getContext(s));return Rr(c.font)}_maxDigits(){const s=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/s}}class jy{constructor(s,c,m){this.type=s,this.scope=c,this.override=m,this.items=Object.create(null)}isForType(s){return Object.prototype.isPrototypeOf.call(this.type.prototype,s.prototype)}register(s){const c=Object.getPrototypeOf(s);let m;i5(c)&&(m=this.register(c));const g=this.items,b=s.id,E=this.scope+"."+b;if(!b)throw new Error("class does not have id: "+s);return b in g||(g[b]=s,e5(s,E,m),this.override&&qs.override(s.id,s.overrides)),E}get(s){return this.items[s]}unregister(s){const c=this.items,m=s.id,g=this.scope;m in c&&delete c[m],g&&m in qs[g]&&(delete qs[g][m],this.override&&delete Tu[m])}}function e5(a,s,c){const m=d_(Object.create(null),[c?qs.get(c):{},qs.get(s),a.defaults]);qs.set(s,m),a.defaultRoutes&&t5(s,a.defaultRoutes),a.descriptors&&qs.describe(s,a.descriptors)}function t5(a,s){Object.keys(s).forEach(c=>{const m=c.split("."),g=m.pop(),b=[a].concat(m).join("."),E=s[c].split("."),n=E.pop(),R=E.join(".");qs.route(b,g,R,n)})}function i5(a){return"id"in a&&"defaults"in a}class n5{constructor(){this.controllers=new jy(j1,"datasets",!0),this.elements=new jy(Xc,"elements"),this.plugins=new jy(Object,"plugins"),this.scales=new jy(zf,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...s){this._each("register",s)}remove(...s){this._each("unregister",s)}addControllers(...s){this._each("register",s,this.controllers)}addElements(...s){this._each("register",s,this.elements)}addPlugins(...s){this._each("register",s,this.plugins)}addScales(...s){this._each("register",s,this.scales)}getController(s){return this._get(s,this.controllers,"controller")}getElement(s){return this._get(s,this.elements,"element")}getPlugin(s){return this._get(s,this.plugins,"plugin")}getScale(s){return this._get(s,this.scales,"scale")}removeControllers(...s){this._each("unregister",s,this.controllers)}removeElements(...s){this._each("unregister",s,this.elements)}removePlugins(...s){this._each("unregister",s,this.plugins)}removeScales(...s){this._each("unregister",s,this.scales)}_each(s,c,m){[...c].forEach(g=>{const b=m||this._getRegistryForType(g);m||b.isForType(g)||b===this.plugins&&g.id?this._exec(s,b,g):fs(g,E=>{const n=m||this._getRegistryForType(E);this._exec(s,n,E)})})}_exec(s,c,m){const g=D1(s);Ms(m["before"+g],[],m),c[s](m),Ms(m["after"+g],[],m)}_getRegistryForType(s){for(let c=0;c<this._typedRegistries.length;c++){const m=this._typedRegistries[c];if(m.isForType(s))return m}return this.plugins}_get(s,c,m){const g=c.get(s);if(g===void 0)throw new Error('"'+s+'" is not a registered '+m+".");return g}}var Ua=new n5;class s5{constructor(){this._init=[]}notify(s,c,m,g){c==="beforeInit"&&(this._init=this._createDescriptors(s,!0),this._notify(this._init,s,"install"));const b=g?this._descriptors(s).filter(g):this._descriptors(s),E=this._notify(b,s,c,m);return c==="afterDestroy"&&(this._notify(b,s,"stop"),this._notify(this._init,s,"uninstall")),E}_notify(s,c,m,g){g=g||{};for(const b of s){const E=b.plugin,n=E[m],R=[c,g,b.options];if(Ms(n,R,E)===!1&&g.cancelable)return!1}return!0}invalidate(){hs(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(s){if(this._cache)return this._cache;const c=this._cache=this._createDescriptors(s);return this._notifyStateChanges(s),c}_createDescriptors(s,c){const m=s&&s.config,g=Gn(m.options&&m.options.plugins,{}),b=r5(m);return g===!1&&!c?[]:a5(s,b,g,c)}_notifyStateChanges(s){const c=this._oldCache||[],m=this._cache,g=(b,E)=>b.filter(n=>!E.some(R=>n.plugin.id===R.plugin.id));this._notify(g(c,m),s,"stop"),this._notify(g(m,c),s,"start")}}function r5(a){const s={},c=[],m=Object.keys(Ua.plugins.items);for(let b=0;b<m.length;b++)c.push(Ua.getPlugin(m[b]));const g=a.plugins||[];for(let b=0;b<g.length;b++){const E=g[b];c.indexOf(E)===-1&&(c.push(E),s[E.id]=!0)}return{plugins:c,localIds:s}}function o5(a,s){return!s&&a===!1?null:a===!0?{}:a}function a5(a,{plugins:s,localIds:c},m,g){const b=[],E=a.getContext();for(const n of s){const R=n.id,B=o5(m[R],g);B!==null&&b.push({plugin:n,options:l5(a.config,{plugin:n,local:c[R]},B,E)})}return b}function l5(a,{plugin:s,local:c},m,g){const b=a.pluginScopeKeys(s),E=a.getOptionScopes(m,b);return c&&s.defaults&&E.push(s.defaults),a.createResolver(E,g,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Kb(a,s){const c=qs.datasets[a]||{};return((s.datasets||{})[a]||{}).indexAxis||s.indexAxis||c.indexAxis||"x"}function c5(a,s){let c=a;return a==="_index_"?c=s:a==="_value_"&&(c=s==="x"?"y":"x"),c}function h5(a,s){return a===s?"_index_":"_value_"}function MA(a){if(a==="x"||a==="y"||a==="r")return a}function u5(a){if(a==="top"||a==="bottom")return"x";if(a==="left"||a==="right")return"y"}function Jb(a,...s){if(MA(a))return a;for(const c of s){const m=c.axis||u5(c.position)||a.length>1&&MA(a[0].toLowerCase());if(m)return m}throw new Error(`Cannot determine type of '${a}' axis. Please provide 'axis' or 'position' option.`)}function PA(a,s,c){if(c[s+"AxisID"]===a)return{axis:s}}function d5(a,s){if(s.data&&s.data.datasets){const c=s.data.datasets.filter(m=>m.xAxisID===a||m.yAxisID===a);if(c.length)return PA(a,"x",c[0])||PA(a,"y",c[0])}return{}}function f5(a,s){const c=Tu[a.type]||{scales:{}},m=s.scales||{},g=Kb(a.type,s),b=Object.create(null);return Object.keys(m).forEach(E=>{const n=m[E];if(!ls(n))return console.error(`Invalid scale configuration for scale: ${E}`);if(n._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${E}`);const R=Jb(E,n,d5(E,a),qs.scales[n.type]),B=h5(R,g),N=c.scales||{};b[E]=Ym(Object.create(null),[{axis:R},n,N[R],N[B]])}),a.data.datasets.forEach(E=>{const n=E.type||a.type,R=E.indexAxis||Kb(n,s),N=(Tu[n]||{}).scales||{};Object.keys(N).forEach(X=>{const ie=c5(X,R),se=E[ie+"AxisID"]||ie;b[se]=b[se]||Object.create(null),Ym(b[se],[{axis:ie},m[se],N[X]])})}),Object.keys(b).forEach(E=>{const n=b[E];Ym(n,[qs.scales[n.type],qs.scale])}),b}function FM(a){const s=a.options||(a.options={});s.plugins=Gn(s.plugins,{}),s.scales=f5(a,s)}function BM(a){return a=a||{},a.datasets=a.datasets||[],a.labels=a.labels||[],a}function p5(a){return a=a||{},a.data=BM(a.data),FM(a),a}const DA=new Map,NM=new Set;function $y(a,s){let c=DA.get(a);return c||(c=s(),DA.set(a,c),NM.add(c)),c}const km=(a,s,c)=>{const m=wf(s,c);m!==void 0&&a.add(m)};let m5=class{constructor(s){this._config=p5(s),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(s){this._config.type=s}get data(){return this._config.data}set data(s){this._config.data=BM(s)}get options(){return this._config.options}set options(s){this._config.options=s}get plugins(){return this._config.plugins}update(){const s=this._config;this.clearCache(),FM(s)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(s){return $y(s,()=>[[`datasets.${s}`,""]])}datasetAnimationScopeKeys(s,c){return $y(`${s}.transition.${c}`,()=>[[`datasets.${s}.transitions.${c}`,`transitions.${c}`],[`datasets.${s}`,""]])}datasetElementScopeKeys(s,c){return $y(`${s}-${c}`,()=>[[`datasets.${s}.elements.${c}`,`datasets.${s}`,`elements.${c}`,""]])}pluginScopeKeys(s){const c=s.id,m=this.type;return $y(`${m}-plugin-${c}`,()=>[[`plugins.${c}`,...s.additionalOptionScopes||[]]])}_cachedScopes(s,c){const m=this._scopeCache;let g=m.get(s);return(!g||c)&&(g=new Map,m.set(s,g)),g}getOptionScopes(s,c,m){const{options:g,type:b}=this,E=this._cachedScopes(s,m),n=E.get(c);if(n)return n;const R=new Set;c.forEach(N=>{s&&(R.add(s),N.forEach(X=>km(R,s,X))),N.forEach(X=>km(R,g,X)),N.forEach(X=>km(R,Tu[b]||{},X)),N.forEach(X=>km(R,qs,X)),N.forEach(X=>km(R,Xb,X))});const B=Array.from(R);return B.length===0&&B.push(Object.create(null)),NM.has(c)&&E.set(c,B),B}chartOptionScopes(){const{options:s,type:c}=this;return[s,Tu[c]||{},qs.datasets[c]||{},{type:c},qs,Xb]}resolveNamedOptions(s,c,m,g=[""]){const b={$shared:!0},{resolver:E,subPrefixes:n}=RA(this._resolverCache,s,g);let R=E;if(g5(E,c)){b.$shared=!1,m=Gc(m)?m():m;const B=this.createResolver(s,m,n);R=Tf(E,m,B)}for(const B of c)b[B]=R[B];return b}createResolver(s,c,m=[""],g){const{resolver:b}=RA(this._resolverCache,s,m);return ls(c)?Tf(b,c,void 0,g):b}};function RA(a,s,c){let m=a.get(s);m||(m=new Map,a.set(s,m));const g=c.join();let b=m.get(g);return b||(b={resolver:F1(s,c),subPrefixes:c.filter(n=>!n.toLowerCase().includes("hover"))},m.set(g,b)),b}const _5=a=>ls(a)&&Object.getOwnPropertyNames(a).some(s=>Gc(a[s]));function g5(a,s){const{isScriptable:c,isIndexable:m}=bM(a);for(const g of s){const b=c(g),E=m(g),n=(E||b)&&a[g];if(b&&(Gc(n)||_5(n))||E&&rr(n))return!0}return!1}var y5="4.5.0";const x5=["top","bottom","left","right","chartArea"];function LA(a,s){return a==="top"||a==="bottom"||x5.indexOf(a)===-1&&s==="x"}function zA(a,s){return function(c,m){return c[a]===m[a]?c[s]-m[s]:c[a]-m[a]}}function OA(a){const s=a.chart,c=s.options.animation;s.notifyPlugins("afterRender"),Ms(c&&c.onComplete,[a],s)}function v5(a){const s=a.chart,c=s.options.animation;Ms(c&&c.onProgress,[a],s)}function VM(a){return V1()&&typeof a=="string"?a=document.getElementById(a):a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}const lx={},kA=a=>{const s=VM(a);return Object.values(lx).filter(c=>c.canvas===s).pop()};function b5(a,s,c){const m=Object.keys(a);for(const g of m){const b=+g;if(b>=s){const E=a[g];delete a[g],(c>0||b>s)&&(a[b+c]=E)}}}function w5(a,s,c,m){return!c||a.type==="mouseout"?null:m?s:a}let Of=class{static defaults=qs;static instances=lx;static overrides=Tu;static registry=Ua;static version=y5;static getChart=kA;static register(...s){Ua.add(...s),FA()}static unregister(...s){Ua.remove(...s),FA()}constructor(s,c){const m=this.config=new m5(c),g=VM(s),b=kA(g);if(b)throw new Error("Canvas is already in use. Chart with ID '"+b.id+"' must be destroyed before the canvas with ID '"+b.canvas.id+"' can be reused.");const E=m.createResolver(m.chartOptionScopes(),this.getContext());this.platform=new(m.platform||VN(g)),this.platform.updateConfig(m);const n=this.platform.acquireContext(g,E.aspectRatio),R=n&&n.canvas,B=R&&R.height,N=R&&R.width;if(this.id=mF(),this.ctx=n,this.canvas=R,this.width=N,this.height=B,this._options=E,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new s5,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=OF(X=>this.update(X),E.resizeDelay||0),this._dataChanges=[],lx[this.id]=this,!n||!R){console.error("Failed to create chart: can't acquire context from the given item");return}Al.listen(this,"complete",OA),Al.listen(this,"progress",v5),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:s,maintainAspectRatio:c},width:m,height:g,_aspectRatio:b}=this;return hs(s)?c&&b?b:g?m/g:null:s}get data(){return this.config.data}set data(s){this.config.data=s}get options(){return this._options}set options(s){this.config.options=s}get registry(){return Ua}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():rA(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return iA(this.canvas,this.ctx),this}stop(){return Al.stop(this),this}resize(s,c){Al.running(this)?this._resizeBeforeDraw={width:s,height:c}:this._resize(s,c)}_resize(s,c){const m=this.options,g=this.canvas,b=m.maintainAspectRatio&&this.aspectRatio,E=this.platform.getMaximumSize(g,s,c,b),n=m.devicePixelRatio||this.platform.getDevicePixelRatio(),R=this.width?"resize":"attach";this.width=E.width,this.height=E.height,this._aspectRatio=this.aspectRatio,rA(this,n,!0)&&(this.notifyPlugins("resize",{size:E}),Ms(m.onResize,[this,E],this),this.attached&&this._doResize(R)&&this.render())}ensureScalesHaveIDs(){const c=this.options.scales||{};fs(c,(m,g)=>{m.id=g})}buildOrUpdateScales(){const s=this.options,c=s.scales,m=this.scales,g=Object.keys(m).reduce((E,n)=>(E[n]=!1,E),{});let b=[];c&&(b=b.concat(Object.keys(c).map(E=>{const n=c[E],R=Jb(E,n),B=R==="r",N=R==="x";return{options:n,dposition:B?"chartArea":N?"bottom":"left",dtype:B?"radialLinear":N?"category":"linear"}}))),fs(b,E=>{const n=E.options,R=n.id,B=Jb(R,n),N=Gn(n.type,E.dtype);(n.position===void 0||LA(n.position,B)!==LA(E.dposition))&&(n.position=E.dposition),g[R]=!0;let X=null;if(R in m&&m[R].type===N)X=m[R];else{const ie=Ua.getScale(N);X=new ie({id:R,type:N,ctx:this.ctx,chart:this}),m[X.id]=X}X.init(n,s)}),fs(g,(E,n)=>{E||delete m[n]}),fs(m,E=>{zo.configure(this,E,E.options),zo.addBox(this,E)})}_updateMetasets(){const s=this._metasets,c=this.data.datasets.length,m=s.length;if(s.sort((g,b)=>g.index-b.index),m>c){for(let g=c;g<m;++g)this._destroyDatasetMeta(g);s.splice(c,m-c)}this._sortedMetasets=s.slice(0).sort(zA("order","index"))}_removeUnreferencedMetasets(){const{_metasets:s,data:{datasets:c}}=this;s.length>c.length&&delete this._stacks,s.forEach((m,g)=>{c.filter(b=>b===m._dataset).length===0&&this._destroyDatasetMeta(g)})}buildOrUpdateControllers(){const s=[],c=this.data.datasets;let m,g;for(this._removeUnreferencedMetasets(),m=0,g=c.length;m<g;m++){const b=c[m];let E=this.getDatasetMeta(m);const n=b.type||this.config.type;if(E.type&&E.type!==n&&(this._destroyDatasetMeta(m),E=this.getDatasetMeta(m)),E.type=n,E.indexAxis=b.indexAxis||Kb(n,this.options),E.order=b.order||0,E.index=m,E.label=""+b.label,E.visible=this.isDatasetVisible(m),E.controller)E.controller.updateIndex(m),E.controller.linkScales();else{const R=Ua.getController(n),{datasetElementType:B,dataElementType:N}=qs.datasets[n];Object.assign(R,{dataElementType:Ua.getElement(N),datasetElementType:B&&Ua.getElement(B)}),E.controller=new R(this,m),s.push(E.controller)}}return this._updateMetasets(),s}_resetElements(){fs(this.data.datasets,(s,c)=>{this.getDatasetMeta(c).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(s){const c=this.config;c.update();const m=this._options=c.createResolver(c.chartOptionScopes(),this.getContext()),g=this._animationsDisabled=!m.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:s,cancelable:!0})===!1)return;const b=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let E=0;for(let B=0,N=this.data.datasets.length;B<N;B++){const{controller:X}=this.getDatasetMeta(B),ie=!g&&b.indexOf(X)===-1;X.buildOrUpdateElements(ie),E=Math.max(+X.getMaxOverflow(),E)}E=this._minPadding=m.layout.autoPadding?E:0,this._updateLayout(E),g||fs(b,B=>{B.reset()}),this._updateDatasets(s),this.notifyPlugins("afterUpdate",{mode:s}),this._layers.sort(zA("z","_idx"));const{_active:n,_lastEvent:R}=this;R?this._eventHandler(R,!0):n.length&&this._updateHoverStyles(n,n,!0),this.render()}_updateScales(){fs(this.scales,s=>{zo.removeBox(this,s)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const s=this.options,c=new Set(Object.keys(this._listeners)),m=new Set(s.events);(!W2(c,m)||!!this._responsiveListeners!==s.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:s}=this,c=this._getUniformDataChanges()||[];for(const{method:m,start:g,count:b}of c){const E=m==="_removeElements"?-b:b;b5(s,g,E)}}_getUniformDataChanges(){const s=this._dataChanges;if(!s||!s.length)return;this._dataChanges=[];const c=this.data.datasets.length,m=b=>new Set(s.filter(E=>E[0]===b).map((E,n)=>n+","+E.splice(1).join(","))),g=m(0);for(let b=1;b<c;b++)if(!W2(g,m(b)))return;return Array.from(g).map(b=>b.split(",")).map(b=>({method:b[1],start:+b[2],count:+b[3]}))}_updateLayout(s){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;zo.update(this,this.width,this.height,s);const c=this.chartArea,m=c.width<=0||c.height<=0;this._layers=[],fs(this.boxes,g=>{m&&g.position==="chartArea"||(g.configure&&g.configure(),this._layers.push(...g._layers()))},this),this._layers.forEach((g,b)=>{g._idx=b}),this.notifyPlugins("afterLayout")}_updateDatasets(s){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:s,cancelable:!0})!==!1){for(let c=0,m=this.data.datasets.length;c<m;++c)this.getDatasetMeta(c).controller.configure();for(let c=0,m=this.data.datasets.length;c<m;++c)this._updateDataset(c,Gc(s)?s({datasetIndex:c}):s);this.notifyPlugins("afterDatasetsUpdate",{mode:s})}}_updateDataset(s,c){const m=this.getDatasetMeta(s),g={meta:m,index:s,mode:c,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",g)!==!1&&(m.controller._update(c),g.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",g))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Al.has(this)?this.attached&&!Al.running(this)&&Al.start(this):(this.draw(),OA({chart:this})))}draw(){let s;if(this._resizeBeforeDraw){const{width:m,height:g}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(m,g)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const c=this._layers;for(s=0;s<c.length&&c[s].z<=0;++s)c[s].draw(this.chartArea);for(this._drawDatasets();s<c.length;++s)c[s].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(s){const c=this._sortedMetasets,m=[];let g,b;for(g=0,b=c.length;g<b;++g){const E=c[g];(!s||E.visible)&&m.push(E)}return m}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const s=this.getSortedVisibleDatasetMetas();for(let c=s.length-1;c>=0;--c)this._drawDataset(s[c]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(s){const c=this.ctx,m={meta:s,index:s.index,cancelable:!0},g=UB(this,s);this.notifyPlugins("beforeDatasetDraw",m)!==!1&&(g&&O1(c,g),s.controller.draw(),g&&k1(c),m.cancelable=!1,this.notifyPlugins("afterDatasetDraw",m))}isPointInArea(s){return m_(s,this.chartArea,this._minPadding)}getElementsAtEventForMode(s,c,m,g){const b=xN.modes[c];return typeof b=="function"?b(this,s,m,g):[]}getDatasetMeta(s){const c=this.data.datasets[s],m=this._metasets;let g=m.filter(b=>b&&b._dataset===c).pop();return g||(g={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:c&&c.order||0,index:s,_dataset:c,_parsed:[],_sorted:!1},m.push(g)),g}getContext(){return this.$context||(this.$context=Cu(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(s){const c=this.data.datasets[s];if(!c)return!1;const m=this.getDatasetMeta(s);return typeof m.hidden=="boolean"?!m.hidden:!c.hidden}setDatasetVisibility(s,c){const m=this.getDatasetMeta(s);m.hidden=!c}toggleDataVisibility(s){this._hiddenIndices[s]=!this._hiddenIndices[s]}getDataVisibility(s){return!this._hiddenIndices[s]}_updateVisibility(s,c,m){const g=m?"show":"hide",b=this.getDatasetMeta(s),E=b.controller._resolveAnimations(void 0,g);f_(c)?(b.data[c].hidden=!m,this.update()):(this.setDatasetVisibility(s,m),E.update(b,{visible:m}),this.update(n=>n.datasetIndex===s?g:void 0))}hide(s,c){this._updateVisibility(s,c,!1)}show(s,c){this._updateVisibility(s,c,!0)}_destroyDatasetMeta(s){const c=this._metasets[s];c&&c.controller&&c.controller._destroy(),delete this._metasets[s]}_stop(){let s,c;for(this.stop(),Al.remove(this),s=0,c=this.data.datasets.length;s<c;++s)this._destroyDatasetMeta(s)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:s,ctx:c}=this;this._stop(),this.config.clearCache(),s&&(this.unbindEvents(),iA(s,c),this.platform.releaseContext(c),this.canvas=null,this.ctx=null),delete lx[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...s){return this.canvas.toDataURL(...s)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const s=this._listeners,c=this.platform,m=(b,E)=>{c.addEventListener(this,b,E),s[b]=E},g=(b,E,n)=>{b.offsetX=E,b.offsetY=n,this._eventHandler(b)};fs(this.options.events,b=>m(b,g))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const s=this._responsiveListeners,c=this.platform,m=(R,B)=>{c.addEventListener(this,R,B),s[R]=B},g=(R,B)=>{s[R]&&(c.removeEventListener(this,R,B),delete s[R])},b=(R,B)=>{this.canvas&&this.resize(R,B)};let E;const n=()=>{g("attach",n),this.attached=!0,this.resize(),m("resize",b),m("detach",E)};E=()=>{this.attached=!1,g("resize",b),this._stop(),this._resize(0,0),m("attach",n)},c.isAttached(this.canvas)?n():E()}unbindEvents(){fs(this._listeners,(s,c)=>{this.platform.removeEventListener(this,c,s)}),this._listeners={},fs(this._responsiveListeners,(s,c)=>{this.platform.removeEventListener(this,c,s)}),this._responsiveListeners=void 0}updateHoverStyle(s,c,m){const g=m?"set":"remove";let b,E,n,R;for(c==="dataset"&&(b=this.getDatasetMeta(s[0].datasetIndex),b.controller["_"+g+"DatasetHoverStyle"]()),n=0,R=s.length;n<R;++n){E=s[n];const B=E&&this.getDatasetMeta(E.datasetIndex).controller;B&&B[g+"HoverStyle"](E.element,E.datasetIndex,E.index)}}getActiveElements(){return this._active||[]}setActiveElements(s){const c=this._active||[],m=s.map(({datasetIndex:b,index:E})=>{const n=this.getDatasetMeta(b);if(!n)throw new Error("No dataset found at index "+b);return{datasetIndex:b,element:n.data[E],index:E}});!Tx(m,c)&&(this._active=m,this._lastEvent=null,this._updateHoverStyles(m,c))}notifyPlugins(s,c,m){return this._plugins.notify(this,s,c,m)}isPluginEnabled(s){return this._plugins._cache.filter(c=>c.plugin.id===s).length===1}_updateHoverStyles(s,c,m){const g=this.options.hover,b=(R,B)=>R.filter(N=>!B.some(X=>N.datasetIndex===X.datasetIndex&&N.index===X.index)),E=b(c,s),n=m?s:b(s,c);E.length&&this.updateHoverStyle(E,g.mode,!1),n.length&&g.mode&&this.updateHoverStyle(n,g.mode,!0)}_eventHandler(s,c){const m={event:s,replay:c,cancelable:!0,inChartArea:this.isPointInArea(s)},g=E=>(E.options.events||this.options.events).includes(s.native.type);if(this.notifyPlugins("beforeEvent",m,g)===!1)return;const b=this._handleEvent(s,c,m.inChartArea);return m.cancelable=!1,this.notifyPlugins("afterEvent",m,g),(b||m.changed)&&this.render(),this}_handleEvent(s,c,m){const{_active:g=[],options:b}=this,E=c,n=this._getActiveElements(s,g,m,E),R=bF(s),B=w5(s,this._lastEvent,m,R);m&&(this._lastEvent=null,Ms(b.onHover,[s,n,this],this),R&&Ms(b.onClick,[s,n,this],this));const N=!Tx(n,g);return(N||c)&&(this._active=n,this._updateHoverStyles(n,g,c)),this._lastEvent=B,N}_getActiveElements(s,c,m,g){if(s.type==="mouseout")return[];if(!m)return c;const b=this.options.hover;return this.getElementsAtEventForMode(s,b.mode,b,g)}};function FA(){return fs(Of.instances,a=>a._plugins.invalidate())}function UM(a,s,c=s){a.lineCap=Gn(c.borderCapStyle,s.borderCapStyle),a.setLineDash(Gn(c.borderDash,s.borderDash)),a.lineDashOffset=Gn(c.borderDashOffset,s.borderDashOffset),a.lineJoin=Gn(c.borderJoinStyle,s.borderJoinStyle),a.lineWidth=Gn(c.borderWidth,s.borderWidth),a.strokeStyle=Gn(c.borderColor,s.borderColor)}function T5(a,s,c){a.lineTo(c.x,c.y)}function S5(a){return a.stepped?XF:a.tension||a.cubicInterpolationMode==="monotone"?YF:T5}function jM(a,s,c={}){const m=a.length,{start:g=0,end:b=m-1}=c,{start:E,end:n}=s,R=Math.max(g,E),B=Math.min(b,n),N=g<E&&b<E||g>n&&b>n;return{count:m,start:R,loop:s.loop,ilen:B<R&&!N?m+B-R:B-R}}function E5(a,s,c,m){const{points:g,options:b}=s,{count:E,start:n,loop:R,ilen:B}=jM(g,c,m),N=S5(b);let{move:X=!0,reverse:ie}=m||{},se,we,pe;for(se=0;se<=B;++se)we=g[(n+(ie?B-se:se))%E],!we.skip&&(X?(a.moveTo(we.x,we.y),X=!1):N(a,pe,we,ie,b.stepped),pe=we);return R&&(we=g[(n+(ie?B:0))%E],N(a,pe,we,ie,b.stepped)),!!R}function A5(a,s,c,m){const g=s.points,{count:b,start:E,ilen:n}=jM(g,c,m),{move:R=!0,reverse:B}=m||{};let N=0,X=0,ie,se,we,pe,Ae,Ie;const Je=Oe=>(E+(B?n-Oe:Oe))%b,Pe=()=>{pe!==Ae&&(a.lineTo(N,Ae),a.lineTo(N,pe),a.lineTo(N,Ie))};for(R&&(se=g[Je(0)],a.moveTo(se.x,se.y)),ie=0;ie<=n;++ie){if(se=g[Je(ie)],se.skip)continue;const Oe=se.x,tt=se.y,xt=Oe|0;xt===we?(tt<pe?pe=tt:tt>Ae&&(Ae=tt),N=(X*N+Oe)/++X):(Pe(),a.lineTo(Oe,tt),we=xt,X=0,pe=Ae=tt),Ie=tt}Pe()}function Qb(a){const s=a.options,c=s.borderDash&&s.borderDash.length;return!a._decimated&&!a._loop&&!s.tension&&s.cubicInterpolationMode!=="monotone"&&!s.stepped&&!c?A5:E5}function I5(a){return a.stepped?CB:a.tension||a.cubicInterpolationMode==="monotone"?MB:uu}function C5(a,s,c,m){let g=s._path;g||(g=s._path=new Path2D,s.path(g,c,m)&&g.closePath()),UM(a,s.options),a.stroke(g)}function M5(a,s,c,m){const{segments:g,options:b}=s,E=Qb(s);for(const n of g)UM(a,b,n.style),a.beginPath(),E(a,s,n,{start:c,end:c+m-1})&&a.closePath(),a.stroke()}const P5=typeof Path2D=="function";function D5(a,s,c,m){P5&&!s.options.segment?C5(a,s,c,m):M5(a,s,c,m)}class R5 extends Xc{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:s=>s!=="borderDash"&&s!=="fill"};constructor(s){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,s&&Object.assign(this,s)}updateControlPoints(s,c){const m=this.options;if((m.tension||m.cubicInterpolationMode==="monotone")&&!m.stepped&&!this._pointsUpdated){const g=m.spanGaps?this._loop:this._fullLoop;vB(this._points,m,s,g,c),this._pointsUpdated=!0}}set points(s){this._points=s,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=FB(this,this.options.segment))}first(){const s=this.segments,c=this.points;return s.length&&c[s[0].start]}last(){const s=this.segments,c=this.points,m=s.length;return m&&c[s[m-1].end]}interpolate(s,c){const m=this.options,g=s[c],b=this.points,E=zB(this,{property:c,start:g,end:g});if(!E.length)return;const n=[],R=I5(m);let B,N;for(B=0,N=E.length;B<N;++B){const{start:X,end:ie}=E[B],se=b[X],we=b[ie];if(se===we){n.push(se);continue}const pe=Math.abs((g-se[c])/(we[c]-se[c])),Ae=R(se,we,pe,m.stepped);Ae[c]=s[c],n.push(Ae)}return n.length===1?n[0]:n}pathSegment(s,c,m){return Qb(this)(s,this,c,m)}path(s,c,m){const g=this.segments,b=Qb(this);let E=this._loop;c=c||0,m=m||this.points.length-c;for(const n of g)E&=b(s,this,n,{start:c,end:c+m-1});return!!E}draw(s,c,m,g){const b=this.options||{};(this.points||[]).length&&b.borderWidth&&(s.save(),D5(s,this,m,g),s.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function BA(a,s,c,m){const g=a.options,{[c]:b}=a.getProps([c],m);return Math.abs(s-b)<g.radius+g.hitRadius}class L5 extends Xc{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(s){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,s&&Object.assign(this,s)}inRange(s,c,m){const g=this.options,{x:b,y:E}=this.getProps(["x","y"],m);return Math.pow(s-b,2)+Math.pow(c-E,2)<Math.pow(g.hitRadius+g.radius,2)}inXRange(s,c){return BA(this,s,"x",c)}inYRange(s,c){return BA(this,s,"y",c)}getCenterPoint(s){const{x:c,y:m}=this.getProps(["x","y"],s);return{x:c,y:m}}size(s){s=s||this.options||{};let c=s.radius||0;c=Math.max(c,c&&s.hoverRadius||0);const m=c&&s.borderWidth||0;return(c+m)*2}draw(s,c){const m=this.options;this.skip||m.radius<.1||!m_(this,c,this.size(m)/2)||(s.strokeStyle=m.borderColor,s.lineWidth=m.borderWidth,s.fillStyle=m.backgroundColor,Yb(s,m,this.x,this.y))}getRange(){const s=this.options||{};return s.radius+s.hitRadius}}function $M(a,s){const{x:c,y:m,base:g,width:b,height:E}=a.getProps(["x","y","base","width","height"],s);let n,R,B,N,X;return a.horizontal?(X=E/2,n=Math.min(c,g),R=Math.max(c,g),B=m-X,N=m+X):(X=b/2,n=c-X,R=c+X,B=Math.min(m,g),N=Math.max(m,g)),{left:n,top:B,right:R,bottom:N}}function Fc(a,s,c,m){return a?0:go(s,c,m)}function z5(a,s,c){const m=a.options.borderWidth,g=a.borderSkipped,b=vM(m);return{t:Fc(g.top,b.top,0,c),r:Fc(g.right,b.right,0,s),b:Fc(g.bottom,b.bottom,0,c),l:Fc(g.left,b.left,0,s)}}function O5(a,s,c){const{enableBorderRadius:m}=a.getProps(["enableBorderRadius"]),g=a.options.borderRadius,b=gf(g),E=Math.min(s,c),n=a.borderSkipped,R=m||ls(g);return{topLeft:Fc(!R||n.top||n.left,b.topLeft,0,E),topRight:Fc(!R||n.top||n.right,b.topRight,0,E),bottomLeft:Fc(!R||n.bottom||n.left,b.bottomLeft,0,E),bottomRight:Fc(!R||n.bottom||n.right,b.bottomRight,0,E)}}function k5(a){const s=$M(a),c=s.right-s.left,m=s.bottom-s.top,g=z5(a,c/2,m/2),b=O5(a,c/2,m/2);return{outer:{x:s.left,y:s.top,w:c,h:m,radius:b},inner:{x:s.left+g.l,y:s.top+g.t,w:c-g.l-g.r,h:m-g.t-g.b,radius:{topLeft:Math.max(0,b.topLeft-Math.max(g.t,g.l)),topRight:Math.max(0,b.topRight-Math.max(g.t,g.r)),bottomLeft:Math.max(0,b.bottomLeft-Math.max(g.b,g.l)),bottomRight:Math.max(0,b.bottomRight-Math.max(g.b,g.r))}}}}function xb(a,s,c,m){const g=s===null,b=c===null,n=a&&!(g&&b)&&$M(a,m);return n&&(g||pu(s,n.left,n.right))&&(b||pu(c,n.top,n.bottom))}function F5(a){return a.topLeft||a.topRight||a.bottomLeft||a.bottomRight}function B5(a,s){a.rect(s.x,s.y,s.w,s.h)}function vb(a,s,c={}){const m=a.x!==c.x?-s:0,g=a.y!==c.y?-s:0,b=(a.x+a.w!==c.x+c.w?s:0)-m,E=(a.y+a.h!==c.y+c.h?s:0)-g;return{x:a.x+m,y:a.y+g,w:a.w+b,h:a.h+E,radius:a.radius}}class GM extends Xc{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(s){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,s&&Object.assign(this,s)}draw(s){const{inflateAmount:c,options:{borderColor:m,backgroundColor:g}}=this,{inner:b,outer:E}=k5(this),n=F5(E.radius)?Ax:B5;s.save(),(E.w!==b.w||E.h!==b.h)&&(s.beginPath(),n(s,vb(E,c,b)),s.clip(),n(s,vb(b,-c,E)),s.fillStyle=m,s.fill("evenodd")),s.beginPath(),n(s,vb(b,c)),s.fillStyle=g,s.fill(),s.restore()}inRange(s,c,m){return xb(this,s,c,m)}inXRange(s,c){return xb(this,s,null,c)}inYRange(s,c){return xb(this,null,s,c)}getCenterPoint(s){const{x:c,y:m,base:g,horizontal:b}=this.getProps(["x","y","base","horizontal"],s);return{x:b?(c+g)/2:c,y:b?m:(m+g)/2}}getRange(s){return s==="x"?this.width/2:this.height/2}}const NA=(a,s)=>{let{boxHeight:c=s,boxWidth:m=s}=a;return a.usePointStyle&&(c=Math.min(c,s),m=a.pointStyleWidth||Math.min(m,s)),{boxWidth:m,boxHeight:c,itemHeight:Math.max(s,c)}},N5=(a,s)=>a!==null&&s!==null&&a.datasetIndex===s.datasetIndex&&a.index===s.index;class VA extends Xc{constructor(s){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,c,m){this.maxWidth=s,this.maxHeight=c,this._margins=m,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const s=this.options.labels||{};let c=Ms(s.generateLabels,[this.chart],this)||[];s.filter&&(c=c.filter(m=>s.filter(m,this.chart.data))),s.sort&&(c=c.sort((m,g)=>s.sort(m,g,this.chart.data))),this.options.reverse&&c.reverse(),this.legendItems=c}fit(){const{options:s,ctx:c}=this;if(!s.display){this.width=this.height=0;return}const m=s.labels,g=Rr(m.font),b=g.size,E=this._computeTitleHeight(),{boxWidth:n,itemHeight:R}=NA(m,b);let B,N;c.font=g.string,this.isHorizontal()?(B=this.maxWidth,N=this._fitRows(E,b,n,R)+10):(N=this.maxHeight,B=this._fitCols(E,g,n,R)+10),this.width=Math.min(B,s.maxWidth||this.maxWidth),this.height=Math.min(N,s.maxHeight||this.maxHeight)}_fitRows(s,c,m,g){const{ctx:b,maxWidth:E,options:{labels:{padding:n}}}=this,R=this.legendHitBoxes=[],B=this.lineWidths=[0],N=g+n;let X=s;b.textAlign="left",b.textBaseline="middle";let ie=-1,se=-N;return this.legendItems.forEach((we,pe)=>{const Ae=m+c/2+b.measureText(we.text).width;(pe===0||B[B.length-1]+Ae+2*n>E)&&(X+=N,B[B.length-(pe>0?0:1)]=0,se+=N,ie++),R[pe]={left:0,top:se,row:ie,width:Ae,height:g},B[B.length-1]+=Ae+n}),X}_fitCols(s,c,m,g){const{ctx:b,maxHeight:E,options:{labels:{padding:n}}}=this,R=this.legendHitBoxes=[],B=this.columnSizes=[],N=E-s;let X=n,ie=0,se=0,we=0,pe=0;return this.legendItems.forEach((Ae,Ie)=>{const{itemWidth:Je,itemHeight:Pe}=V5(m,c,b,Ae,g);Ie>0&&se+Pe+2*n>N&&(X+=ie+n,B.push({width:ie,height:se}),we+=ie+n,pe++,ie=se=0),R[Ie]={left:we,top:se,col:pe,width:Je,height:Pe},ie=Math.max(ie,Je),se+=Pe+n}),X+=ie,B.push({width:ie,height:se}),X}adjustHitBoxes(){if(!this.options.display)return;const s=this._computeTitleHeight(),{legendHitBoxes:c,options:{align:m,labels:{padding:g},rtl:b}}=this,E=yf(b,this.left,this.width);if(this.isHorizontal()){let n=0,R=Pr(m,this.left+g,this.right-this.lineWidths[n]);for(const B of c)n!==B.row&&(n=B.row,R=Pr(m,this.left+g,this.right-this.lineWidths[n])),B.top+=this.top+s+g,B.left=E.leftForLtr(E.x(R),B.width),R+=B.width+g}else{let n=0,R=Pr(m,this.top+s+g,this.bottom-this.columnSizes[n].height);for(const B of c)B.col!==n&&(n=B.col,R=Pr(m,this.top+s+g,this.bottom-this.columnSizes[n].height)),B.top=R,B.left+=this.left+g,B.left=E.leftForLtr(E.x(B.left),B.width),R+=B.height+g}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const s=this.ctx;O1(s,this),this._draw(),k1(s)}}_draw(){const{options:s,columnSizes:c,lineWidths:m,ctx:g}=this,{align:b,labels:E}=s,n=qs.color,R=yf(s.rtl,this.left,this.width),B=Rr(E.font),{padding:N}=E,X=B.size,ie=X/2;let se;this.drawTitle(),g.textAlign=R.textAlign("left"),g.textBaseline="middle",g.lineWidth=.5,g.font=B.string;const{boxWidth:we,boxHeight:pe,itemHeight:Ae}=NA(E,X),Ie=function(xt,Tt,At){if(isNaN(we)||we<=0||isNaN(pe)||pe<0)return;g.save();const Wt=Gn(At.lineWidth,1);if(g.fillStyle=Gn(At.fillStyle,n),g.lineCap=Gn(At.lineCap,"butt"),g.lineDashOffset=Gn(At.lineDashOffset,0),g.lineJoin=Gn(At.lineJoin,"miter"),g.lineWidth=Wt,g.strokeStyle=Gn(At.strokeStyle,n),g.setLineDash(Gn(At.lineDash,[])),E.usePointStyle){const Zt={radius:pe*Math.SQRT2/2,pointStyle:At.pointStyle,rotation:At.rotation,borderWidth:Wt},jt=R.xPlus(xt,we/2),pi=Tt+ie;yM(g,Zt,jt,pi,E.pointStyleWidth&&we)}else{const Zt=Tt+Math.max((X-pe)/2,0),jt=R.leftForLtr(xt,we),pi=gf(At.borderRadius);g.beginPath(),Object.values(pi).some(gi=>gi!==0)?Ax(g,{x:jt,y:Zt,w:we,h:pe,radius:pi}):g.rect(jt,Zt,we,pe),g.fill(),Wt!==0&&g.stroke()}g.restore()},Je=function(xt,Tt,At){__(g,At.text,xt,Tt+Ae/2,B,{strikethrough:At.hidden,textAlign:R.textAlign(At.textAlign)})},Pe=this.isHorizontal(),Oe=this._computeTitleHeight();Pe?se={x:Pr(b,this.left+N,this.right-m[0]),y:this.top+N+Oe,line:0}:se={x:this.left+N,y:Pr(b,this.top+Oe+N,this.bottom-c[0].height),line:0},AM(this.ctx,s.textDirection);const tt=Ae+N;this.legendItems.forEach((xt,Tt)=>{g.strokeStyle=xt.fontColor,g.fillStyle=xt.fontColor;const At=g.measureText(xt.text).width,Wt=R.textAlign(xt.textAlign||(xt.textAlign=E.textAlign)),Zt=we+ie+At;let jt=se.x,pi=se.y;R.setWidth(this.width),Pe?Tt>0&&jt+Zt+N>this.right&&(pi=se.y+=tt,se.line++,jt=se.x=Pr(b,this.left+N,this.right-m[se.line])):Tt>0&&pi+tt>this.bottom&&(jt=se.x=jt+c[se.line].width+N,se.line++,pi=se.y=Pr(b,this.top+Oe+N,this.bottom-c[se.line].height));const gi=R.x(jt);if(Ie(gi,pi,xt),jt=kF(Wt,jt+we+ie,Pe?jt+Zt:this.right,s.rtl),Je(R.x(jt),pi,xt),Pe)se.x+=Zt+N;else if(typeof xt.text!="string"){const _i=B.lineHeight;se.y+=HM(xt,_i)+N}else se.y+=tt}),IM(this.ctx,s.textDirection)}drawTitle(){const s=this.options,c=s.title,m=Rr(c.font),g=Bo(c.padding);if(!c.display)return;const b=yf(s.rtl,this.left,this.width),E=this.ctx,n=c.position,R=m.size/2,B=g.top+R;let N,X=this.left,ie=this.width;if(this.isHorizontal())ie=Math.max(...this.lineWidths),N=this.top+B,X=Pr(s.align,X,this.right-ie);else{const we=this.columnSizes.reduce((pe,Ae)=>Math.max(pe,Ae.height),0);N=B+Pr(s.align,this.top,this.bottom-we-s.labels.padding-this._computeTitleHeight())}const se=Pr(n,X,X+ie);E.textAlign=b.textAlign(L1(n)),E.textBaseline="middle",E.strokeStyle=c.color,E.fillStyle=c.color,E.font=m.string,__(E,c.text,se,N,m)}_computeTitleHeight(){const s=this.options.title,c=Rr(s.font),m=Bo(s.padding);return s.display?c.lineHeight+m.height:0}_getLegendItemAt(s,c){let m,g,b;if(pu(s,this.left,this.right)&&pu(c,this.top,this.bottom)){for(b=this.legendHitBoxes,m=0;m<b.length;++m)if(g=b[m],pu(s,g.left,g.left+g.width)&&pu(c,g.top,g.top+g.height))return this.legendItems[m]}return null}handleEvent(s){const c=this.options;if(!$5(s.type,c))return;const m=this._getLegendItemAt(s.x,s.y);if(s.type==="mousemove"||s.type==="mouseout"){const g=this._hoveredItem,b=N5(g,m);g&&!b&&Ms(c.onLeave,[s,g,this],this),this._hoveredItem=m,m&&!b&&Ms(c.onHover,[s,m,this],this)}else m&&Ms(c.onClick,[s,m,this],this)}}function V5(a,s,c,m,g){const b=U5(m,a,s,c),E=j5(g,m,s.lineHeight);return{itemWidth:b,itemHeight:E}}function U5(a,s,c,m){let g=a.text;return g&&typeof g!="string"&&(g=g.reduce((b,E)=>b.length>E.length?b:E)),s+c.size/2+m.measureText(g).width}function j5(a,s,c){let m=a;return typeof s.text!="string"&&(m=HM(s,c)),m}function HM(a,s){const c=a.text?a.text.length:0;return s*c}function $5(a,s){return!!((a==="mousemove"||a==="mouseout")&&(s.onHover||s.onLeave)||s.onClick&&(a==="click"||a==="mouseup"))}var G1={id:"legend",_element:VA,start(a,s,c){const m=a.legend=new VA({ctx:a.ctx,options:c,chart:a});zo.configure(a,m,c),zo.addBox(a,m)},stop(a){zo.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,s,c){const m=a.legend;zo.configure(a,m,c),m.options=c},afterUpdate(a){const s=a.legend;s.buildLabels(),s.adjustHitBoxes()},afterEvent(a,s){s.replay||a.legend.handleEvent(s.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,s,c){const m=s.datasetIndex,g=c.chart;g.isDatasetVisible(m)?(g.hide(m),s.hidden=!0):(g.show(m),s.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){const s=a.data.datasets,{labels:{usePointStyle:c,pointStyle:m,textAlign:g,color:b,useBorderRadius:E,borderRadius:n}}=a.legend.options;return a._getSortedDatasetMetas().map(R=>{const B=R.controller.getStyle(c?0:void 0),N=Bo(B.borderWidth);return{text:s[R.index].label,fillStyle:B.backgroundColor,fontColor:b,hidden:!R.visible,lineCap:B.borderCapStyle,lineDash:B.borderDash,lineDashOffset:B.borderDashOffset,lineJoin:B.borderJoinStyle,lineWidth:(N.width+N.height)/4,strokeStyle:B.borderColor,pointStyle:m||B.pointStyle,rotation:B.rotation,textAlign:g||B.textAlign,borderRadius:E&&(n||B.borderRadius),datasetIndex:R.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}};class WM extends Xc{constructor(s){super(),this.chart=s.chart,this.options=s.options,this.ctx=s.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(s,c){const m=this.options;if(this.left=0,this.top=0,!m.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=s,this.height=this.bottom=c;const g=rr(m.text)?m.text.length:1;this._padding=Bo(m.padding);const b=g*Rr(m.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=b:this.width=b}isHorizontal(){const s=this.options.position;return s==="top"||s==="bottom"}_drawArgs(s){const{top:c,left:m,bottom:g,right:b,options:E}=this,n=E.align;let R=0,B,N,X;return this.isHorizontal()?(N=Pr(n,m,b),X=c+s,B=b-m):(E.position==="left"?(N=m+s,X=Pr(n,g,c),R=fr*-.5):(N=b-s,X=Pr(n,c,g),R=fr*.5),B=g-c),{titleX:N,titleY:X,maxWidth:B,rotation:R}}draw(){const s=this.ctx,c=this.options;if(!c.display)return;const m=Rr(c.font),b=m.lineHeight/2+this._padding.top,{titleX:E,titleY:n,maxWidth:R,rotation:B}=this._drawArgs(b);__(s,c.text,0,0,m,{color:c.color,maxWidth:R,rotation:B,textAlign:L1(c.align),textBaseline:"middle",translation:[E,n]})}}function G5(a,s){const c=new WM({ctx:a.ctx,options:s,chart:a});zo.configure(a,c,s),zo.addBox(a,c),a.titleBlock=c}var H1={id:"title",_element:WM,start(a,s,c){G5(a,c)},stop(a){const s=a.titleBlock;zo.removeBox(a,s),delete a.titleBlock},beforeUpdate(a,s,c){const m=a.titleBlock;zo.configure(a,m,c),m.options=c},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Gm={average(a){if(!a.length)return!1;let s,c,m=new Set,g=0,b=0;for(s=0,c=a.length;s<c;++s){const n=a[s].element;if(n&&n.hasValue()){const R=n.tooltipPosition();m.add(R.x),g+=R.y,++b}}return b===0||m.size===0?!1:{x:[...m].reduce((n,R)=>n+R)/m.size,y:g/b}},nearest(a,s){if(!a.length)return!1;let c=s.x,m=s.y,g=Number.POSITIVE_INFINITY,b,E,n;for(b=0,E=a.length;b<E;++b){const R=a[b].element;if(R&&R.hasValue()){const B=R.getCenterPoint(),N=Zb(s,B);N<g&&(g=N,n=R)}}if(n){const R=n.tooltipPosition();c=R.x,m=R.y}return{x:c,y:m}}};function Na(a,s){return s&&(rr(s)?Array.prototype.push.apply(a,s):a.push(s)),a}function Il(a){return(typeof a=="string"||a instanceof String)&&a.indexOf(`
`)>-1?a.split(`
`):a}function H5(a,s){const{element:c,datasetIndex:m,index:g}=s,b=a.getDatasetMeta(m).controller,{label:E,value:n}=b.getLabelAndValue(g);return{chart:a,label:E,parsed:b.getParsed(g),raw:a.data.datasets[m].data[g],formattedValue:n,dataset:b.getDataset(),dataIndex:g,datasetIndex:m,element:c}}function UA(a,s){const c=a.chart.ctx,{body:m,footer:g,title:b}=a,{boxWidth:E,boxHeight:n}=s,R=Rr(s.bodyFont),B=Rr(s.titleFont),N=Rr(s.footerFont),X=b.length,ie=g.length,se=m.length,we=Bo(s.padding);let pe=we.height,Ae=0,Ie=m.reduce((Oe,tt)=>Oe+tt.before.length+tt.lines.length+tt.after.length,0);if(Ie+=a.beforeBody.length+a.afterBody.length,X&&(pe+=X*B.lineHeight+(X-1)*s.titleSpacing+s.titleMarginBottom),Ie){const Oe=s.displayColors?Math.max(n,R.lineHeight):R.lineHeight;pe+=se*Oe+(Ie-se)*R.lineHeight+(Ie-1)*s.bodySpacing}ie&&(pe+=s.footerMarginTop+ie*N.lineHeight+(ie-1)*s.footerSpacing);let Je=0;const Pe=function(Oe){Ae=Math.max(Ae,c.measureText(Oe).width+Je)};return c.save(),c.font=B.string,fs(a.title,Pe),c.font=R.string,fs(a.beforeBody.concat(a.afterBody),Pe),Je=s.displayColors?E+2+s.boxPadding:0,fs(m,Oe=>{fs(Oe.before,Pe),fs(Oe.lines,Pe),fs(Oe.after,Pe)}),Je=0,c.font=N.string,fs(a.footer,Pe),c.restore(),Ae+=we.width,{width:Ae,height:pe}}function W5(a,s){const{y:c,height:m}=s;return c<m/2?"top":c>a.height-m/2?"bottom":"center"}function q5(a,s,c,m){const{x:g,width:b}=m,E=c.caretSize+c.caretPadding;if(a==="left"&&g+b+E>s.width||a==="right"&&g-b-E<0)return!0}function Z5(a,s,c,m){const{x:g,width:b}=c,{width:E,chartArea:{left:n,right:R}}=a;let B="center";return m==="center"?B=g<=(n+R)/2?"left":"right":g<=b/2?B="left":g>=E-b/2&&(B="right"),q5(B,a,s,c)&&(B="center"),B}function jA(a,s,c){const m=c.yAlign||s.yAlign||W5(a,c);return{xAlign:c.xAlign||s.xAlign||Z5(a,s,c,m),yAlign:m}}function X5(a,s){let{x:c,width:m}=a;return s==="right"?c-=m:s==="center"&&(c-=m/2),c}function Y5(a,s,c){let{y:m,height:g}=a;return s==="top"?m+=c:s==="bottom"?m-=g+c:m-=g/2,m}function $A(a,s,c,m){const{caretSize:g,caretPadding:b,cornerRadius:E}=a,{xAlign:n,yAlign:R}=c,B=g+b,{topLeft:N,topRight:X,bottomLeft:ie,bottomRight:se}=gf(E);let we=X5(s,n);const pe=Y5(s,R,B);return R==="center"?n==="left"?we+=B:n==="right"&&(we-=B):n==="left"?we-=Math.max(N,ie)+g:n==="right"&&(we+=Math.max(X,se)+g),{x:go(we,0,m.width-s.width),y:go(pe,0,m.height-s.height)}}function Gy(a,s,c){const m=Bo(c.padding);return s==="center"?a.x+a.width/2:s==="right"?a.x+a.width-m.right:a.x+m.left}function GA(a){return Na([],Il(a))}function K5(a,s,c){return Cu(a,{tooltip:s,tooltipItems:c,type:"tooltip"})}function HA(a,s){const c=s&&s.dataset&&s.dataset.tooltip&&s.dataset.tooltip.callbacks;return c?a.override(c):a}const qM={beforeTitle:El,title(a){if(a.length>0){const s=a[0],c=s.chart.data.labels,m=c?c.length:0;if(this&&this.options&&this.options.mode==="dataset")return s.dataset.label||"";if(s.label)return s.label;if(m>0&&s.dataIndex<m)return c[s.dataIndex]}return""},afterTitle:El,beforeBody:El,beforeLabel:El,label(a){if(this&&this.options&&this.options.mode==="dataset")return a.label+": "+a.formattedValue||a.formattedValue;let s=a.dataset.label||"";s&&(s+=": ");const c=a.formattedValue;return hs(c)||(s+=c),s},labelColor(a){const c=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:c.borderColor,backgroundColor:c.backgroundColor,borderWidth:c.borderWidth,borderDash:c.borderDash,borderDashOffset:c.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){const c=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:c.pointStyle,rotation:c.rotation}},afterLabel:El,afterBody:El,beforeFooter:El,footer:El,afterFooter:El};function Qr(a,s,c,m){const g=a[s].call(c,m);return typeof g>"u"?qM[s].call(c,m):g}let WA=class extends Xc{static positioners=Gm;constructor(s){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=s.chart,this.options=s.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(s){this.options=s,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const s=this._cachedAnimations;if(s)return s;const c=this.chart,m=this.options.setContext(this.getContext()),g=m.enabled&&c.options.animation&&m.animations,b=new MM(this.chart,g);return g._cacheable&&(this._cachedAnimations=Object.freeze(b)),b}getContext(){return this.$context||(this.$context=K5(this.chart.getContext(),this,this._tooltipItems))}getTitle(s,c){const{callbacks:m}=c,g=Qr(m,"beforeTitle",this,s),b=Qr(m,"title",this,s),E=Qr(m,"afterTitle",this,s);let n=[];return n=Na(n,Il(g)),n=Na(n,Il(b)),n=Na(n,Il(E)),n}getBeforeBody(s,c){return GA(Qr(c.callbacks,"beforeBody",this,s))}getBody(s,c){const{callbacks:m}=c,g=[];return fs(s,b=>{const E={before:[],lines:[],after:[]},n=HA(m,b);Na(E.before,Il(Qr(n,"beforeLabel",this,b))),Na(E.lines,Qr(n,"label",this,b)),Na(E.after,Il(Qr(n,"afterLabel",this,b))),g.push(E)}),g}getAfterBody(s,c){return GA(Qr(c.callbacks,"afterBody",this,s))}getFooter(s,c){const{callbacks:m}=c,g=Qr(m,"beforeFooter",this,s),b=Qr(m,"footer",this,s),E=Qr(m,"afterFooter",this,s);let n=[];return n=Na(n,Il(g)),n=Na(n,Il(b)),n=Na(n,Il(E)),n}_createItems(s){const c=this._active,m=this.chart.data,g=[],b=[],E=[];let n=[],R,B;for(R=0,B=c.length;R<B;++R)n.push(H5(this.chart,c[R]));return s.filter&&(n=n.filter((N,X,ie)=>s.filter(N,X,ie,m))),s.itemSort&&(n=n.sort((N,X)=>s.itemSort(N,X,m))),fs(n,N=>{const X=HA(s.callbacks,N);g.push(Qr(X,"labelColor",this,N)),b.push(Qr(X,"labelPointStyle",this,N)),E.push(Qr(X,"labelTextColor",this,N))}),this.labelColors=g,this.labelPointStyles=b,this.labelTextColors=E,this.dataPoints=n,n}update(s,c){const m=this.options.setContext(this.getContext()),g=this._active;let b,E=[];if(!g.length)this.opacity!==0&&(b={opacity:0});else{const n=Gm[m.position].call(this,g,this._eventPosition);E=this._createItems(m),this.title=this.getTitle(E,m),this.beforeBody=this.getBeforeBody(E,m),this.body=this.getBody(E,m),this.afterBody=this.getAfterBody(E,m),this.footer=this.getFooter(E,m);const R=this._size=UA(this,m),B=Object.assign({},n,R),N=jA(this.chart,m,B),X=$A(m,B,N,this.chart);this.xAlign=N.xAlign,this.yAlign=N.yAlign,b={opacity:1,x:X.x,y:X.y,width:R.width,height:R.height,caretX:n.x,caretY:n.y}}this._tooltipItems=E,this.$context=void 0,b&&this._resolveAnimations().update(this,b),s&&m.external&&m.external.call(this,{chart:this.chart,tooltip:this,replay:c})}drawCaret(s,c,m,g){const b=this.getCaretPosition(s,m,g);c.lineTo(b.x1,b.y1),c.lineTo(b.x2,b.y2),c.lineTo(b.x3,b.y3)}getCaretPosition(s,c,m){const{xAlign:g,yAlign:b}=this,{caretSize:E,cornerRadius:n}=m,{topLeft:R,topRight:B,bottomLeft:N,bottomRight:X}=gf(n),{x:ie,y:se}=s,{width:we,height:pe}=c;let Ae,Ie,Je,Pe,Oe,tt;return b==="center"?(Oe=se+pe/2,g==="left"?(Ae=ie,Ie=Ae-E,Pe=Oe+E,tt=Oe-E):(Ae=ie+we,Ie=Ae+E,Pe=Oe-E,tt=Oe+E),Je=Ae):(g==="left"?Ie=ie+Math.max(R,N)+E:g==="right"?Ie=ie+we-Math.max(B,X)-E:Ie=this.caretX,b==="top"?(Pe=se,Oe=Pe-E,Ae=Ie-E,Je=Ie+E):(Pe=se+pe,Oe=Pe+E,Ae=Ie+E,Je=Ie-E),tt=Pe),{x1:Ae,x2:Ie,x3:Je,y1:Pe,y2:Oe,y3:tt}}drawTitle(s,c,m){const g=this.title,b=g.length;let E,n,R;if(b){const B=yf(m.rtl,this.x,this.width);for(s.x=Gy(this,m.titleAlign,m),c.textAlign=B.textAlign(m.titleAlign),c.textBaseline="middle",E=Rr(m.titleFont),n=m.titleSpacing,c.fillStyle=m.titleColor,c.font=E.string,R=0;R<b;++R)c.fillText(g[R],B.x(s.x),s.y+E.lineHeight/2),s.y+=E.lineHeight+n,R+1===b&&(s.y+=m.titleMarginBottom-n)}}_drawColorBox(s,c,m,g,b){const E=this.labelColors[m],n=this.labelPointStyles[m],{boxHeight:R,boxWidth:B}=b,N=Rr(b.bodyFont),X=Gy(this,"left",b),ie=g.x(X),se=R<N.lineHeight?(N.lineHeight-R)/2:0,we=c.y+se;if(b.usePointStyle){const pe={radius:Math.min(B,R)/2,pointStyle:n.pointStyle,rotation:n.rotation,borderWidth:1},Ae=g.leftForLtr(ie,B)+B/2,Ie=we+R/2;s.strokeStyle=b.multiKeyBackground,s.fillStyle=b.multiKeyBackground,Yb(s,pe,Ae,Ie),s.strokeStyle=E.borderColor,s.fillStyle=E.backgroundColor,Yb(s,pe,Ae,Ie)}else{s.lineWidth=ls(E.borderWidth)?Math.max(...Object.values(E.borderWidth)):E.borderWidth||1,s.strokeStyle=E.borderColor,s.setLineDash(E.borderDash||[]),s.lineDashOffset=E.borderDashOffset||0;const pe=g.leftForLtr(ie,B),Ae=g.leftForLtr(g.xPlus(ie,1),B-2),Ie=gf(E.borderRadius);Object.values(Ie).some(Je=>Je!==0)?(s.beginPath(),s.fillStyle=b.multiKeyBackground,Ax(s,{x:pe,y:we,w:B,h:R,radius:Ie}),s.fill(),s.stroke(),s.fillStyle=E.backgroundColor,s.beginPath(),Ax(s,{x:Ae,y:we+1,w:B-2,h:R-2,radius:Ie}),s.fill()):(s.fillStyle=b.multiKeyBackground,s.fillRect(pe,we,B,R),s.strokeRect(pe,we,B,R),s.fillStyle=E.backgroundColor,s.fillRect(Ae,we+1,B-2,R-2))}s.fillStyle=this.labelTextColors[m]}drawBody(s,c,m){const{body:g}=this,{bodySpacing:b,bodyAlign:E,displayColors:n,boxHeight:R,boxWidth:B,boxPadding:N}=m,X=Rr(m.bodyFont);let ie=X.lineHeight,se=0;const we=yf(m.rtl,this.x,this.width),pe=function(At){c.fillText(At,we.x(s.x+se),s.y+ie/2),s.y+=ie+b},Ae=we.textAlign(E);let Ie,Je,Pe,Oe,tt,xt,Tt;for(c.textAlign=E,c.textBaseline="middle",c.font=X.string,s.x=Gy(this,Ae,m),c.fillStyle=m.bodyColor,fs(this.beforeBody,pe),se=n&&Ae!=="right"?E==="center"?B/2+N:B+2+N:0,Oe=0,xt=g.length;Oe<xt;++Oe){for(Ie=g[Oe],Je=this.labelTextColors[Oe],c.fillStyle=Je,fs(Ie.before,pe),Pe=Ie.lines,n&&Pe.length&&(this._drawColorBox(c,s,Oe,we,m),ie=Math.max(X.lineHeight,R)),tt=0,Tt=Pe.length;tt<Tt;++tt)pe(Pe[tt]),ie=X.lineHeight;fs(Ie.after,pe)}se=0,ie=X.lineHeight,fs(this.afterBody,pe),s.y-=b}drawFooter(s,c,m){const g=this.footer,b=g.length;let E,n;if(b){const R=yf(m.rtl,this.x,this.width);for(s.x=Gy(this,m.footerAlign,m),s.y+=m.footerMarginTop,c.textAlign=R.textAlign(m.footerAlign),c.textBaseline="middle",E=Rr(m.footerFont),c.fillStyle=m.footerColor,c.font=E.string,n=0;n<b;++n)c.fillText(g[n],R.x(s.x),s.y+E.lineHeight/2),s.y+=E.lineHeight+m.footerSpacing}}drawBackground(s,c,m,g){const{xAlign:b,yAlign:E}=this,{x:n,y:R}=s,{width:B,height:N}=m,{topLeft:X,topRight:ie,bottomLeft:se,bottomRight:we}=gf(g.cornerRadius);c.fillStyle=g.backgroundColor,c.strokeStyle=g.borderColor,c.lineWidth=g.borderWidth,c.beginPath(),c.moveTo(n+X,R),E==="top"&&this.drawCaret(s,c,m,g),c.lineTo(n+B-ie,R),c.quadraticCurveTo(n+B,R,n+B,R+ie),E==="center"&&b==="right"&&this.drawCaret(s,c,m,g),c.lineTo(n+B,R+N-we),c.quadraticCurveTo(n+B,R+N,n+B-we,R+N),E==="bottom"&&this.drawCaret(s,c,m,g),c.lineTo(n+se,R+N),c.quadraticCurveTo(n,R+N,n,R+N-se),E==="center"&&b==="left"&&this.drawCaret(s,c,m,g),c.lineTo(n,R+X),c.quadraticCurveTo(n,R,n+X,R),c.closePath(),c.fill(),g.borderWidth>0&&c.stroke()}_updateAnimationTarget(s){const c=this.chart,m=this.$animations,g=m&&m.x,b=m&&m.y;if(g||b){const E=Gm[s.position].call(this,this._active,this._eventPosition);if(!E)return;const n=this._size=UA(this,s),R=Object.assign({},E,this._size),B=jA(c,s,R),N=$A(s,R,B,c);(g._to!==N.x||b._to!==N.y)&&(this.xAlign=B.xAlign,this.yAlign=B.yAlign,this.width=n.width,this.height=n.height,this.caretX=E.x,this.caretY=E.y,this._resolveAnimations().update(this,N))}}_willRender(){return!!this.opacity}draw(s){const c=this.options.setContext(this.getContext());let m=this.opacity;if(!m)return;this._updateAnimationTarget(c);const g={width:this.width,height:this.height},b={x:this.x,y:this.y};m=Math.abs(m)<.001?0:m;const E=Bo(c.padding),n=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;c.enabled&&n&&(s.save(),s.globalAlpha=m,this.drawBackground(b,s,g,c),AM(s,c.textDirection),b.y+=E.top,this.drawTitle(b,s,c),this.drawBody(b,s,c),this.drawFooter(b,s,c),IM(s,c.textDirection),s.restore())}getActiveElements(){return this._active||[]}setActiveElements(s,c){const m=this._active,g=s.map(({datasetIndex:n,index:R})=>{const B=this.chart.getDatasetMeta(n);if(!B)throw new Error("Cannot find a dataset at index "+n);return{datasetIndex:n,element:B.data[R],index:R}}),b=!Tx(m,g),E=this._positionChanged(g,c);(b||E)&&(this._active=g,this._eventPosition=c,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(s,c,m=!0){if(c&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const g=this.options,b=this._active||[],E=this._getActiveElements(s,b,c,m),n=this._positionChanged(E,s),R=c||!Tx(E,b)||n;return R&&(this._active=E,(g.enabled||g.external)&&(this._eventPosition={x:s.x,y:s.y},this.update(!0,c))),R}_getActiveElements(s,c,m,g){const b=this.options;if(s.type==="mouseout")return[];if(!g)return c.filter(n=>this.chart.data.datasets[n.datasetIndex]&&this.chart.getDatasetMeta(n.datasetIndex).controller.getParsed(n.index)!==void 0);const E=this.chart.getElementsAtEventForMode(s,b.mode,b,m);return b.reverse&&E.reverse(),E}_positionChanged(s,c){const{caretX:m,caretY:g,options:b}=this,E=Gm[b.position].call(this,s,c);return E!==!1&&(m!==E.x||g!==E.y)}};var W1={id:"tooltip",_element:WA,positioners:Gm,afterInit(a,s,c){c&&(a.tooltip=new WA({chart:a,options:c}))},beforeUpdate(a,s,c){a.tooltip&&a.tooltip.initialize(c)},reset(a,s,c){a.tooltip&&a.tooltip.initialize(c)},afterDraw(a){const s=a.tooltip;if(s&&s._willRender()){const c={tooltip:s};if(a.notifyPlugins("beforeTooltipDraw",{...c,cancelable:!0})===!1)return;s.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",c)}},afterEvent(a,s){if(a.tooltip){const c=s.replay;a.tooltip.handleEvent(s.event,c,s.inChartArea)&&(s.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,s)=>s.bodyFont.size,boxWidth:(a,s)=>s.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:qM},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>a!=="filter"&&a!=="itemSort"&&a!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const J5=(a,s,c,m)=>(typeof s=="string"?(c=a.push(s)-1,m.unshift({index:c,label:s})):isNaN(s)&&(c=null),c);function Q5(a,s,c,m){const g=a.indexOf(s);if(g===-1)return J5(a,s,c,m);const b=a.lastIndexOf(s);return g!==b?c:g}const e4=(a,s)=>a===null?null:go(Math.round(a),0,s);function qA(a){const s=this.getLabels();return a>=0&&a<s.length?s[a]:a}class q1 extends zf{static id="category";static defaults={ticks:{callback:qA}};constructor(s){super(s),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(s){const c=this._addedLabels;if(c.length){const m=this.getLabels();for(const{index:g,label:b}of c)m[g]===b&&m.splice(g,1);this._addedLabels=[]}super.init(s)}parse(s,c){if(hs(s))return null;const m=this.getLabels();return c=isFinite(c)&&m[c]===s?c:Q5(m,s,Gn(c,s),this._addedLabels),e4(c,m.length-1)}determineDataLimits(){const{minDefined:s,maxDefined:c}=this.getUserBounds();let{min:m,max:g}=this.getMinMax(!0);this.options.bounds==="ticks"&&(s||(m=0),c||(g=this.getLabels().length-1)),this.min=m,this.max=g}buildTicks(){const s=this.min,c=this.max,m=this.options.offset,g=[];let b=this.getLabels();b=s===0&&c===b.length-1?b:b.slice(s,c+1),this._valueRange=Math.max(b.length-(m?0:1),1),this._startValue=this.min-(m?.5:0);for(let E=s;E<=c;E++)g.push({value:E});return g}getLabelForValue(s){return qA.call(this,s)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(s){return typeof s!="number"&&(s=this.parse(s)),s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getPixelForTick(s){const c=this.ticks;return s<0||s>c.length-1?null:this.getPixelForValue(c[s].value)}getValueForPixel(s){return Math.round(this._startValue+this.getDecimalForPixel(s)*this._valueRange)}getBasePixel(){return this.bottom}}function t4(a,s){const c=[],{bounds:g,step:b,min:E,max:n,precision:R,count:B,maxTicks:N,maxDigits:X,includeBounds:ie}=a,se=b||1,we=N-1,{min:pe,max:Ae}=s,Ie=!hs(E),Je=!hs(n),Pe=!hs(B),Oe=(Ae-pe)/(X+1);let tt=Z2((Ae-pe)/we/se)*se,xt,Tt,At,Wt;if(tt<1e-14&&!Ie&&!Je)return[{value:pe},{value:Ae}];Wt=Math.ceil(Ae/tt)-Math.floor(pe/tt),Wt>we&&(tt=Z2(Wt*tt/we/se)*se),hs(R)||(xt=Math.pow(10,R),tt=Math.ceil(tt*xt)/xt),g==="ticks"?(Tt=Math.floor(pe/tt)*tt,At=Math.ceil(Ae/tt)*tt):(Tt=pe,At=Ae),Ie&&Je&&b&&AF((n-E)/b,tt/1e3)?(Wt=Math.round(Math.min((n-E)/tt,N)),tt=(n-E)/Wt,Tt=E,At=n):Pe?(Tt=Ie?E:Tt,At=Je?n:At,Wt=B-1,tt=(At-Tt)/Wt):(Wt=(At-Tt)/tt,Km(Wt,Math.round(Wt),tt/1e3)?Wt=Math.round(Wt):Wt=Math.ceil(Wt));const Zt=Math.max(X2(tt),X2(Tt));xt=Math.pow(10,hs(R)?Zt:R),Tt=Math.round(Tt*xt)/xt,At=Math.round(At*xt)/xt;let jt=0;for(Ie&&(ie&&Tt!==E?(c.push({value:E}),Tt<E&&jt++,Km(Math.round((Tt+jt*tt)*xt)/xt,E,ZA(E,Oe,a))&&jt++):Tt<E&&jt++);jt<Wt;++jt){const pi=Math.round((Tt+jt*tt)*xt)/xt;if(Je&&pi>n)break;c.push({value:pi})}return Je&&ie&&At!==n?c.length&&Km(c[c.length-1].value,n,ZA(n,Oe,a))?c[c.length-1].value=n:c.push({value:n}):(!Je||At===n)&&c.push({value:At}),c}function ZA(a,s,{horizontal:c,minRotation:m}){const g=fu(m),b=(c?Math.sin(g):Math.cos(g))||.001,E=.75*s*(""+a).length;return Math.min(s/b,E)}class i4 extends zf{constructor(s){super(s),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(s,c){return hs(s)||(typeof s=="number"||s instanceof Number)&&!isFinite(+s)?null:+s}handleTickRangeOptions(){const{beginAtZero:s}=this.options,{minDefined:c,maxDefined:m}=this.getUserBounds();let{min:g,max:b}=this;const E=R=>g=c?g:R,n=R=>b=m?b:R;if(s){const R=Ga(g),B=Ga(b);R<0&&B<0?n(0):R>0&&B>0&&E(0)}if(g===b){let R=b===0?1:Math.abs(b*.05);n(b+R),s||E(g-R)}this.min=g,this.max=b}getTickLimit(){const s=this.options.ticks;let{maxTicksLimit:c,stepSize:m}=s,g;return m?(g=Math.ceil(this.max/m)-Math.floor(this.min/m)+1,g>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${m} would result generating up to ${g} ticks. Limiting to 1000.`),g=1e3)):(g=this.computeTickLimit(),c=c||11),c&&(g=Math.min(c,g)),g}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const s=this.options,c=s.ticks;let m=this.getTickLimit();m=Math.max(2,m);const g={maxTicks:m,bounds:s.bounds,min:s.min,max:s.max,precision:c.precision,step:c.stepSize,count:c.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:c.minRotation||0,includeBounds:c.includeBounds!==!1},b=this._range||this,E=t4(g,b);return s.bounds==="ticks"&&IF(E,this,"value"),s.reverse?(E.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),E}configure(){const s=this.ticks;let c=this.min,m=this.max;if(super.configure(),this.options.offset&&s.length){const g=(m-c)/Math.max(s.length-1,1)/2;c-=g,m+=g}this._startValue=c,this._endValue=m,this._valueRange=m-c}getLabelForValue(s){return _M(s,this.chart.options.locale,this.options.ticks.format)}}class Z1 extends i4{static id="linear";static defaults={ticks:{callback:gM.formatters.numeric}};determineDataLimits(){const{min:s,max:c}=this.getMinMax(!0);this.min=Fo(s)?s:0,this.max=Fo(c)?c:1,this.handleTickRangeOptions()}computeTickLimit(){const s=this.isHorizontal(),c=s?this.width:this.height,m=fu(this.options.ticks.minRotation),g=(s?Math.sin(m):Math.cos(m))||.001,b=this._resolveTickFontOptions(0);return Math.ceil(c/Math.min(40,b.lineHeight/g))}getPixelForValue(s){return s===null?NaN:this.getPixelForDecimal((s-this._startValue)/this._valueRange)}getValueForPixel(s){return this._startValue+this.getDecimalForPixel(s)*this._valueRange}}const Gx={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},to=Object.keys(Gx);function XA(a,s){return a-s}function YA(a,s){if(hs(s))return null;const c=a._adapter,{parser:m,round:g,isoWeekday:b}=a._parseOpts;let E=s;return typeof m=="function"&&(E=m(E)),Fo(E)||(E=typeof m=="string"?c.parse(E,m):c.parse(E)),E===null?null:(g&&(E=g==="week"&&(p_(b)||b===!0)?c.startOf(E,"isoWeek",b):c.startOf(E,g)),+E)}function KA(a,s,c,m){const g=to.length;for(let b=to.indexOf(a);b<g-1;++b){const E=Gx[to[b]],n=E.steps?E.steps:Number.MAX_SAFE_INTEGER;if(E.common&&Math.ceil((c-s)/(n*E.size))<=m)return to[b]}return to[g-1]}function n4(a,s,c,m,g){for(let b=to.length-1;b>=to.indexOf(c);b--){const E=to[b];if(Gx[E].common&&a._adapter.diff(g,m,E)>=s-1)return E}return to[c?to.indexOf(c):0]}function s4(a){for(let s=to.indexOf(a)+1,c=to.length;s<c;++s)if(Gx[to[s]].common)return to[s]}function JA(a,s,c){if(!c)a[s]=!0;else if(c.length){const{lo:m,hi:g}=R1(c,s),b=c[m]>=s?c[m]:c[g];a[b]=!0}}function r4(a,s,c,m){const g=a._adapter,b=+g.startOf(s[0].value,m),E=s[s.length-1].value;let n,R;for(n=b;n<=E;n=+g.add(n,1,m))R=c[n],R>=0&&(s[R].major=!0);return s}function QA(a,s,c){const m=[],g={},b=s.length;let E,n;for(E=0;E<b;++E)n=s[E],g[n]=E,m.push({value:n,major:!1});return b===0||!c?m:r4(a,m,g,c)}class eI extends zf{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(s){super(s),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(s,c={}){const m=s.time||(s.time={}),g=this._adapter=new pN._date(s.adapters.date);g.init(c),Ym(m.displayFormats,g.formats()),this._parseOpts={parser:m.parser,round:m.round,isoWeekday:m.isoWeekday},super.init(s),this._normalized=c.normalized}parse(s,c){return s===void 0?null:YA(this,s)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const s=this.options,c=this._adapter,m=s.time.unit||"day";let{min:g,max:b,minDefined:E,maxDefined:n}=this.getUserBounds();function R(B){!E&&!isNaN(B.min)&&(g=Math.min(g,B.min)),!n&&!isNaN(B.max)&&(b=Math.max(b,B.max))}(!E||!n)&&(R(this._getLabelBounds()),(s.bounds!=="ticks"||s.ticks.source!=="labels")&&R(this.getMinMax(!1))),g=Fo(g)&&!isNaN(g)?g:+c.startOf(Date.now(),m),b=Fo(b)&&!isNaN(b)?b:+c.endOf(Date.now(),m)+1,this.min=Math.min(g,b-1),this.max=Math.max(g+1,b)}_getLabelBounds(){const s=this.getLabelTimestamps();let c=Number.POSITIVE_INFINITY,m=Number.NEGATIVE_INFINITY;return s.length&&(c=s[0],m=s[s.length-1]),{min:c,max:m}}buildTicks(){const s=this.options,c=s.time,m=s.ticks,g=m.source==="labels"?this.getLabelTimestamps():this._generate();s.bounds==="ticks"&&g.length&&(this.min=this._userMin||g[0],this.max=this._userMax||g[g.length-1]);const b=this.min,E=this.max,n=LF(g,b,E);return this._unit=c.unit||(m.autoSkip?KA(c.minUnit,this.min,this.max,this._getLabelCapacity(b)):n4(this,n.length,c.minUnit,this.min,this.max)),this._majorUnit=!m.major.enabled||this._unit==="year"?void 0:s4(this._unit),this.initOffsets(g),s.reverse&&n.reverse(),QA(this,n,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(s=>+s.value))}initOffsets(s=[]){let c=0,m=0,g,b;this.options.offset&&s.length&&(g=this.getDecimalForValue(s[0]),s.length===1?c=1-g:c=(this.getDecimalForValue(s[1])-g)/2,b=this.getDecimalForValue(s[s.length-1]),s.length===1?m=b:m=(b-this.getDecimalForValue(s[s.length-2]))/2);const E=s.length<3?.5:.25;c=go(c,0,E),m=go(m,0,E),this._offsets={start:c,end:m,factor:1/(c+1+m)}}_generate(){const s=this._adapter,c=this.min,m=this.max,g=this.options,b=g.time,E=b.unit||KA(b.minUnit,c,m,this._getLabelCapacity(c)),n=Gn(g.ticks.stepSize,1),R=E==="week"?b.isoWeekday:!1,B=p_(R)||R===!0,N={};let X=c,ie,se;if(B&&(X=+s.startOf(X,"isoWeek",R)),X=+s.startOf(X,B?"day":E),s.diff(m,c,E)>1e5*n)throw new Error(c+" and "+m+" are too far apart with stepSize of "+n+" "+E);const we=g.ticks.source==="data"&&this.getDataTimestamps();for(ie=X,se=0;ie<m;ie=+s.add(ie,n,E),se++)JA(N,ie,we);return(ie===m||g.bounds==="ticks"||se===1)&&JA(N,ie,we),Object.keys(N).sort(XA).map(pe=>+pe)}getLabelForValue(s){const c=this._adapter,m=this.options.time;return m.tooltipFormat?c.format(s,m.tooltipFormat):c.format(s,m.displayFormats.datetime)}format(s,c){const g=this.options.time.displayFormats,b=this._unit,E=c||g[b];return this._adapter.format(s,E)}_tickFormatFunction(s,c,m,g){const b=this.options,E=b.ticks.callback;if(E)return Ms(E,[s,c,m],this);const n=b.time.displayFormats,R=this._unit,B=this._majorUnit,N=R&&n[R],X=B&&n[B],ie=m[c],se=B&&X&&ie&&ie.major;return this._adapter.format(s,g||(se?X:N))}generateTickLabels(s){let c,m,g;for(c=0,m=s.length;c<m;++c)g=s[c],g.label=this._tickFormatFunction(g.value,c,s)}getDecimalForValue(s){return s===null?NaN:(s-this.min)/(this.max-this.min)}getPixelForValue(s){const c=this._offsets,m=this.getDecimalForValue(s);return this.getPixelForDecimal((c.start+m)*c.factor)}getValueForPixel(s){const c=this._offsets,m=this.getDecimalForPixel(s)/c.factor-c.end;return this.min+m*(this.max-this.min)}_getLabelSize(s){const c=this.options.ticks,m=this.ctx.measureText(s).width,g=fu(this.isHorizontal()?c.maxRotation:c.minRotation),b=Math.cos(g),E=Math.sin(g),n=this._resolveTickFontOptions(0).size;return{w:m*b+n*E,h:m*E+n*b}}_getLabelCapacity(s){const c=this.options.time,m=c.displayFormats,g=m[c.unit]||m.millisecond,b=this._tickFormatFunction(s,0,QA(this,[s],this._majorUnit),g),E=this._getLabelSize(b),n=Math.floor(this.isHorizontal()?this.width/E.w:this.height/E.h)-1;return n>0?n:1}getDataTimestamps(){let s=this._cache.data||[],c,m;if(s.length)return s;const g=this.getMatchingVisibleMetas();if(this._normalized&&g.length)return this._cache.data=g[0].controller.getAllParsedValues(this);for(c=0,m=g.length;c<m;++c)s=s.concat(g[c].controller.getAllParsedValues(this));return this._cache.data=this.normalize(s)}getLabelTimestamps(){const s=this._cache.labels||[];let c,m;if(s.length)return s;const g=this.getLabels();for(c=0,m=g.length;c<m;++c)s.push(YA(this,g[c]));return this._cache.labels=this._normalized?s:this.normalize(s)}normalize(s){return fM(s.sort(XA))}}function Hy(a,s,c){let m=0,g=a.length-1,b,E,n,R;c?(s>=a[m].pos&&s<=a[g].pos&&({lo:m,hi:g}=mu(a,"pos",s)),{pos:b,time:n}=a[m],{pos:E,time:R}=a[g]):(s>=a[m].time&&s<=a[g].time&&({lo:m,hi:g}=mu(a,"time",s)),{time:b,pos:n}=a[m],{time:E,pos:R}=a[g]);const B=E-b;return B?n+(R-n)*(s-b)/B:n}class F8 extends eI{static id="timeseries";static defaults=eI.defaults;constructor(s){super(s),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const s=this._getTimestampsForTable(),c=this._table=this.buildLookupTable(s);this._minPos=Hy(c,this.min),this._tableRange=Hy(c,this.max)-this._minPos,super.initOffsets(s)}buildLookupTable(s){const{min:c,max:m}=this,g=[],b=[];let E,n,R,B,N;for(E=0,n=s.length;E<n;++E)B=s[E],B>=c&&B<=m&&g.push(B);if(g.length<2)return[{time:c,pos:0},{time:m,pos:1}];for(E=0,n=g.length;E<n;++E)N=g[E+1],R=g[E-1],B=g[E],Math.round((N+R)/2)!==B&&b.push({time:B,pos:E/(n-1)});return b}_generate(){const s=this.min,c=this.max;let m=super.getDataTimestamps();return(!m.includes(s)||!m.length)&&m.splice(0,0,s),(!m.includes(c)||m.length===1)&&m.push(c),m.sort((g,b)=>g-b)}_getTimestampsForTable(){let s=this._cache.all||[];if(s.length)return s;const c=this.getDataTimestamps(),m=this.getLabelTimestamps();return c.length&&m.length?s=this.normalize(c.concat(m)):s=c.length?c:m,s=this._cache.all=s,s}getDecimalForValue(s){return(Hy(this._table,s)-this._minPos)/this._tableRange}getValueForPixel(s){const c=this._offsets,m=this.getDecimalForPixel(s)/c.factor-c.end;return Hy(this._table,m*this._tableRange+this._minPos,!0)}}const ZM={data:{type:Object,required:!0},options:{type:Object,default:()=>({})},plugins:{type:Array,default:()=>[]},datasetIdKey:{type:String,default:"label"},updateMode:{type:String,default:void 0}},o4={ariaLabel:{type:String},ariaDescribedby:{type:String}},a4={type:{type:String,required:!0},destroyDelay:{type:Number,default:0},...ZM,...o4},l4=$C[0]==="2"?(a,s)=>Object.assign(a,{attrs:s}):(a,s)=>Object.assign(a,s);function Qd(a){return b_(a)?Qn(a):a}function c4(a){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:a;return b_(s)?new Proxy(a,{}):a}function h4(a,s){const c=a.options;c&&s&&Object.assign(c,s)}function XM(a,s){a.labels=s}function YM(a,s,c){const m=[];a.datasets=s.map(g=>{const b=a.datasets.find(E=>E[c]===g[c]);return!b||!g.data||m.includes(b)?{...g}:(m.push(b),Object.assign(b,g),b)})}function u4(a,s){const c={labels:[],datasets:[]};return XM(c,a.labels),YM(c,a.datasets,s),c}const d4=uC({props:a4,setup(a,s){let{expose:c,slots:m}=s;const g=mo(null),b=sC(null);c({chart:b});const E=()=>{if(!g.value)return;const{type:B,data:N,options:X,plugins:ie,datasetIdKey:se}=a,we=u4(N,se),pe=c4(we,N);b.value=new Of(g.value,{type:B,data:pe,options:{...X},plugins:ie})},n=()=>{const B=Qn(b.value);B&&(a.destroyDelay>0?setTimeout(()=>{B.destroy(),b.value=null},a.destroyDelay):(B.destroy(),b.value=null))},R=B=>{B.update(a.updateMode)};return Nx(E),b1(n),tx([()=>a.options,()=>a.data],(B,N)=>{let[X,ie]=B,[se,we]=N;const pe=Qn(b.value);if(!pe)return;let Ae=!1;if(X){const Ie=Qd(X),Je=Qd(se);Ie&&Ie!==Je&&(h4(pe,Ie),Ae=!0)}if(ie){const Ie=Qd(ie.labels),Je=Qd(we.labels),Pe=Qd(ie.datasets),Oe=Qd(we.datasets);Ie!==Je&&(XM(pe.config.data,Ie),Ae=!0),Pe&&Pe!==Oe&&(YM(pe.config.data,Pe,a.datasetIdKey),Ae=!0)}Ae&&y1(()=>{R(pe)})},{deep:!0}),()=>vx("canvas",{role:"img",ariaLabel:a.ariaLabel,ariaDescribedby:a.ariaDescribedby,ref:g},[vx("p",{},[m.default?m.default():""])])}});function KM(a,s){return Of.register(s),uC({props:ZM,setup(c,m){let{expose:g}=m;const b=sC(null),E=n=>{b.value=n?.chart};return g({chart:b}),()=>vx(d4,l4({ref:E},{type:a,...c}))}})}const JM=KM("bar",dN),f4=KM("line",fN),p4={__name:"HistogramChart",setup(a){Of.register(H1,W1,G1,GM,q1,Z1);const m={labels:["0–5 min","5–10 min","10–30 min","30–60 min","1–2 hrs",">2 hrs"],datasets:[{label:"Number of checklists",data:[95,108,185,102,79,16],backgroundColor:"#40718f"}]},g={responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:b=>`${b.raw} checklists`}}}};return(b,E)=>(Ps(),Ls(Us,null,[E[0]||(E[0]=fi("p",null," Checklists are the basic unit that sample bird occurance (how often?) and abundance (how many?). I become a firm believer of the usefulness of make many short checklists which a believe to be better suited to represent occurence and probably abundance! ",-1)),Es(aa(JM),{data:m,options:g})],64))}},m4=["value"],_4={__name:"TripStatsChart",setup(a){Of.register(H1,W1,G1,GM,q1,Z1);const s=Array.from({length:48},(E,n)=>new Date(2025,4,16+n).toLocaleDateString("en-GB",{day:"numeric",month:"short"}).replace(" ","-")),c={"Distance (km)":[6.4,18.39,18.03,18.59,14.4,16.98,12.131,12.01,8.432,11.269,10.904,5.302,12.931,11.245,4.692,6.772,17.084,2.381,15.242,7.426,6.83,23.421,6.851,13.055,1.499,5.41,4.919,6.305,1.926,7.055,5.01,13.567,12.374,16.627,3.198,3.208,6.135,7.28,3.399,4.214,2.222,7.525,6.646,6.78,4.106,.898,5.422,.39],"Birding hours (hr)":[2.28,6.87,6.18,7.3,5.42,10.13,6.05,8.98,7.98,7.2,8.63,4.57,6.52,7.33,7.43,6.23,7.42,4.63,9.37,7.67,6.92,3.93,3.47,6.25,.67,2.4,3.82,9.82,2.57,5.45,3.57,8.97,6.4,8.87,5.37,3.8,6.92,7.98,8.1,6.75,6.43,7.23,5.1,4.55,5.48,3.08,5.58,3.12],"Number of checklists":[5,13,6,24,11,18,14,13,15,17,21,26,18,26,11,18,15,24,19,16,9,11,3,14,8,2,5,13,9,7,9,16,12,13,32,29,32,20,19,10,14,10,8,8,16,8,7,7],"Number of species":[39,101,86,106,109,104,109,129,116,107,85,93,109,108,94,97,102,89,106,107,99,85,67,91,42,16,66,92,56,56,50,70,53,46,71,57,56,66,64,44,62,39,51,56,94,60,96,48],"Number of media":[0,35,37,5,14,36,8,24,38,55,7,24,34,12,3,8,39,6,33,12,12,2,1,19,1,0,3,18,4,20,18,111,15,46,7,7,10,21,148,112,15,21,2,3,2,0,1,1]},m=mo("Number of species"),g=vu(()=>({labels:s,datasets:[{label:m.value,data:c[m.value],backgroundColor:"#40718f"}]})),b={responsive:!0,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1}},scales:{x:{ticks:{maxRotation:45,minRotation:45,autoSkip:!0,maxTicksLimit:15}},y:{beginAtZero:!0}}};return(E,n)=>(Ps(),Ls(Us,null,[n[2]||(n[2]=fi("p",null,"In 50 days, we can see some intresting pattern in basic metric",-1)),fi("div",null,[n[1]||(n[1]=fi("label",{for:"variable-select",class:"form-label"},"Select Variable:",-1)),du(fi("select",{id:"variable-select","onUpdate:modelValue":n[0]||(n[0]=R=>m.value=R),class:"form-select mb-3"},[(Ps(!0),Ls(Us,null,o_(Object.keys(c),R=>(Ps(),Ls("option",{key:R,value:R},dr(R),9,m4))),128))],512),[[jk,m.value]]),Es(aa(JM),{data:g.value,options:b},null,8,["data"])])],64))}},g4={__name:"BirdingByTimeChart",setup(a){Of.register(H1,W1,G1,R5,L5,q1,Z1);const s=[];for(let b=0;b<24;b++)for(let E of[0,15,30,45])s.push(`${String(b).padStart(2,"0")}:${String(E).padStart(2,"0")}`);const m={labels:s,datasets:[{label:"Fraction of days birded",data:[0,.0074,.0044,.0133,.0133,.0267,.0356,.04,.0356,.0356,.0222,.0133,.0089,.0089,.0133,.0356,.0667,.1067,.1511,.2178,.3022,.4133,.5111,.5778,.6222,.6267,.5822,.5422,.5156,.4844,.4533,.4267,.4,.3822,.3733,.3733,.3867,.3956,.4311,.4622,.4889,.5289,.5378,.5289,.5111,.48,.4311,.4044,.3644,.3244,.2889,.2578,.2444,.2267,.2133,.1911,.1778,.16,.1511,.1422,.1556,.1644,.1778,.2089,.24,.2756,.3022,.3333,.36,.3689,.3644,.3733,.3733,.3822,.3911,.4,.4089,.4133,.3556,.3333,.2978,.2711,.2444,.2756,.2533,.28,.2889,.2889,.2667,.2756,.24,.1867,.1378,.0889,.0444,.0074,0],borderColor:"#40718f",tension:.2,pointRadius:1.2}]},g={responsive:!0,plugins:{legend:{display:!1},tooltip:{callbacks:{label:b=>`${(b.raw*100).toFixed(1)}% of days`}}},scales:{x:{title:{display:!0,text:"Time of Day"},ticks:{maxTicksLimit:12,maxRotation:45,minRotation:45}},y:{title:{display:!0,text:"Fraction of Days"},suggestedMax:1,beginAtZero:!0}}};return(b,E)=>(Ps(),Ls(Us,null,[E[0]||(E[0]=Vm("<p> One might think it&#39;s the birds that dictate the rhythm of a typical day… but in reality, it&#39;s more of a default birding flow interrupted by the necessities of daily life. Let&#39;s explore when we&#39;re actually out birding — or rather, when we&#39;re <em>not</em> birding! </p><ul><li><b>00:00 - 04:00</b> – Thanks to Améline&#39;s light sleep, we&#39;ve managed to catch a few cool nocturnal species in the middle of the night. </li><li><b>04:00 - 06:00</b> – The day usually begins between 4:00 and 5:00 (mostly solo), with peak birding activity around 6:00. </li><li><b>08:00</b> – Breakfast calls for a short pause between 8:00 and 9:00, after which the kids usually join in. </li><li><b>13:00</b> – Mornings are often long and tend to stretch past noon.There&#39;s always a good lunch, followed by a well-deserved nap for everyone until 16:00. </li><li><b>20:00</b> – Evenings generally continue quite late (especially as the days get longer), with a break for dinner and the kids&#39; bedtime. </li><li><b>22:00</b> – And since there are often nocturnal species still to look for as darkness falls, Améline and I usually head back out again! </li></ul>",2)),Es(aa(f4),{data:m,options:g})],64))}},y4={class:"container my-4"},x4={class:"row row-cols-2 row-cols-md-4 g-3 text-center"},v4={class:"text-bg-primary rounded h-100 mx-1 py-1"},b4={class:"mb-1"},w4={class:"small mb-1"},T4={class:"container mb-4"},S4={class:"container mb-4"},E4={class:"container mb-4"},A4={class:"container mb-4"},I4={__name:"Intro",setup(a){const s=[{nb:287,text:"Species"},{nb:683,text:"Checklists"},{nb:142061,text:"Individuals"},{nb:291,text:"Hours"},{nb:416,text:"km"}],c=mo([!1,!1,!1,!1]);function m(g){c.value[g]=!c.value[g]}return(g,b)=>(Ps(),Ls("div",null,[b[11]||(b[11]=Vm('<h2 class="fw-bold display-5 mb-1">The Great North</h2><p class="opacity-75">16 May – 4 July 2025 (50 days)</p><div class="mb-4"><p> Between 16th May and 4th of July 2025, we embarked on a family roadtrip to the <i>Great North</i> of Europe in a camping-car! More narrative on each country is available for each trip report: </p><div class="d-flex flex-wrap gap-3"><a href="https://ebird.org/tripreport/391401" target="_blank" class="btn btn-outline-primary">🇩🇪 DE</a><a href="https://ebird.org/tripreport/377229" target="_blank" class="btn btn-outline-primary">🇵🇱 PL</a><a href="https://ebird.org/tripreport/378180" target="_blank" class="btn btn-outline-primary">🇱🇹 LI</a><a href="https://ebird.org/tripreport/378388" target="_blank" class="btn btn-outline-primary">🇱🇻 LV</a><a href="https://ebird.org/tripreport/380243" target="_blank" class="btn btn-outline-primary">🇪🇪 EE</a><a href="https://ebird.org/tripreport/382025" target="_blank" class="btn btn-outline-primary">🇫🇮 FI</a><a href="https://ebird.org/tripreport/386664" target="_blank" class="btn btn-outline-primary">🇳🇴 NO</a></div></div>',3)),fi("div",y4,[fi("div",x4,[(Ps(),Ls(Us,null,o_(s,E=>fi("div",{key:E.text,class:"col h-100"},[fi("div",v4,[fi("h5",b4,dr(E.nb.toLocaleString()),1),fi("p",w4,dr(E.text),1)])])),64))])]),fi("h2",null,[b[4]||(b[4]=ca(" Lifer Summary ")),fi("button",{class:"btn btn-link",onClick:b[0]||(b[0]=E=>m(1))},[fi("i",{class:la(c.value[1]?"bi-chevron-up":"bi-chevron-down")},null,2)])]),du(fi("div",T4,b[5]||(b[5]=[Vm('<p> At such latitude, the species richness is low, making each lifer even more special! On the 10 possible lifers, <b>we ticked 7 of them</b>! </p><ul class="list-unstyled"><li> ✅ <a href="https://ebird.org/checklist/S251698421#arcwar1" target="_blank">Arctic Warbler</a> – Quite a few encountered in Sør-Varanger. We really enjoyed the rich song of this chubby little Phylloscopus! </li><li> ✅ <a href="https://ebird.org/checklist/S245266848#boowar1" target="_blank">Booted Warbler</a> – Happy to tick this species in its specific habitat, with a singing bird and a touch of mist. A magical scene—even if Idunas aren&#39;t the flashiest visually! </li><li> ✅ <a href="https://ebird.org/checklist/S251018893#gyhchi" target="_blank">Siberian Tit</a> – Tits are always a joy to search for! A bit of playback, and suddenly they&#39;re all around. We&#39;ll need to head to Asia for the rest of the Poeciles. </li><li> ✅ <a href="https://ebird.org/checklist/S250914288#parcro2" target="_blank">Parrot Crossbill</a> – Crossbills are tricky. You hear them calling in flight, hope they perch, and then get fooled by bill size and angles... Still, a good one to tick! </li><li> ✅ <a href="https://ebird.org/checklist/S250914288#refblu1" target="_blank">Red-flanked Bluetail</a> – What a stunning bird! Recently colonizing northeast Finland. I typically found 1–3 singers on damp mountain slopes. </li><li> ✅ <a href="https://ebird.org/checklist/S250914288#rusbun" target="_blank">Rustic Bunting</a> – A gorgeous bunting in breeding plumage—so much nicer than in winter! Lovely song too. </li><li> ✅ <a href="https://ebird.org/checklist/S251258197#sibjay1" target="_blank">Siberian Jay</a> – Searching for these jays reminded us of the U.S., with its many jay species. A great bird to watch. </li><li> ✅ <a href="https://ebird.org/checklist/S253722868#yebloo" target="_blank">White-billed Diver</a> – Three sightings: a close flying immature, a distant breeding adult on calm water, and another immature in wavy water. Not perfect views, but still exciting! </li><li>❌ Lanceolated Warbler – None reported this year.</li><li> ❌ Greater Spotted Eagle – Possibly in Poland, but we didn&#39;t spend enough time searching. Hoping to catch one on migration or wintering in France, Spain, or Italy. </li><li> ❌ <a href="https://ebird.org/checklist/S255540840" target="_blank">Paddyfield Warbler</a> – We gave it a solid try: one evening and a full morning (from early to late)... but not a peep. </li></ul>',2)]),512),[[Um,c.value[1]]]),fi("h2",null,[b[6]||(b[6]=ca(" Palearctic Lifers ")),fi("button",{class:"btn btn-link",onClick:b[1]||(b[1]=E=>m(2))},[fi("i",{class:la(c.value[2]?"bi-chevron-up":"bi-chevron-down")},null,2)])]),du(fi("div",S4,b[7]||(b[7]=[Vm('<p>On top, we also made a a few Palearctic lifers:</p><ul class="list-unstyled"><li> ✅ <a href="https://ebird.org/checklist/S240284378#eurwar2" target="_blank">River Warbler</a> – Locustella should only be heard, not seen! It&#39;s such a different experience than ringing them in Ngulia, yet the same specie! </li><li> ✅ <a href="https://ebird.org/checklist/S240653495#amewig" target="_blank">American Wigeon</a> – A known vagrant individual. Always fun to catch a Nearctic guest on this side of the ocean! </li><li> ✅ <a href="https://ebird.org/checklist/S254192063#cacgoo1" target="_blank">Cackling Goose</a> – A breeding bird visible only with a scope and very precise directions. Worth the effort! </li><li> ✅ <a href="https://ebird.org/checklist/S253683628#thbmur" target="_blank">Brünnich&#39;s Guillemot</a> – After missing one in Iceland, it was a treat to see them up close on breeding cliffs in Vardø. </li><li> ✅ <a href="https://ebird.org/checklist/S253383652#kineid" target="_blank">King Eider</a> – I used to chase lone wintering individuals, so it was great to finally see a proper group—as ducks should be! </li></ul>',2)]),512),[[Um,c.value[2]]]),fi("h2",null,[b[8]||(b[8]=ca(" Photo-lifer Cleanup ")),fi("button",{class:"btn btn-link",onClick:b[2]||(b[2]=E=>m(3))},[fi("i",{class:la(c.value[3]?"bi-chevron-up":"bi-chevron-down")},null,2)])]),du(fi("div",E4,b[9]||(b[9]=[Vm('<p> As the number of lifers wasn&#39;t that high, I took the opportunity to clean up my photo-lifer list—and ended up with 9 missing species: </p><ul class="list-unstyled"><li> ✅ <a href="https://ebird.org/checklist/S256521673#eucdov" target="_blank">Collared Dove</a> – 680 observations of over 2,000 birds... and not a single photo. Oops! </li><li> ✅ <a href="https://ebird.org/checklist/S250053959" target="_blank">Eurasian Treecreeper</a> – 272 sightings, 624 individuals, 8 audio recordings... but no photos until now. </li><li> ✅ <a href="https://ebird.org/checklist/S241986823#wiltit1" target="_blank">Willow Tit</a> – After 127 observations and 7 audio recordings, I finally got the shot! </li><li> ✅ <a href="https://ebird.org/checklist/S246157498" target="_blank">Common Grasshopper Warbler</a> – This photo proves the rule: Locustellas should be heard, not seen! </li><li> ✅ <a href="https://ebird.org/checklist/S242053330#syrwoo1" target="_blank">Syrian Woodpecker</a> – Great views this time, and finally a photo-worthy moment. </li><li> ✅ <a href="https://ebird.org/checklist/S243528656#corcra" target="_blank">Corncrake</a> – Tried playback countless times. People showed phone pics of tame birds... not for us. After 48 records (108 birds on this trip alone), one blurry flyby finally did it! </li><li> ✅ <a href="https://ebird.org/checklist/S251030515#taibeg1" target="_blank">Taiga Bean Goose</a> – Glad to photograph it before the lump! </li><li> ✅ <a href="https://ebird.org/checklist/S245790908#blrwar1" target="_blank">Blyth&#39;s Reed Warbler</a> – Credit to Ameline, who ventured out at night with a flashlight and phone-camera-through-bino technique! </li><li> ✅ <a href="https://ebird.org/checklist/S239541088#rebfly" target="_blank">Red-breasted Flycatcher</a> – A singing male in breeding forest beats a lonely vagrant in a Falsterbo bush. Sorry, not sorry! </li></ul>',2)]),512),[[Um,c.value[3]]]),fi("h2",null,[b[10]||(b[10]=ca(" Figures ")),fi("button",{class:"btn btn-link",onClick:b[3]||(b[3]=E=>m(4))},[fi("i",{class:la(c.value[4]?"bi-chevron-up":"bi-chevron-down")},null,2)])]),du(fi("div",A4,[Es(g4),Es(_4),Es(p4)],512),[[Um,c.value[4]]])]))}},C4={class:"bg-dark vh-100 overflow-hidden"},M4={class:"col-12 col-sm-6 col-md-5 col-lg-4 position-absolute top-0 start-0 h-100 overflow-auto text-white",style:{background:`linear-gradient(
          to right,
          rgba(0, 0, 0, 0.85) 0%,
          rgba(0, 0, 0, 0.85) 60%,
          rgba(0, 0, 0, 0.5) 80%,
          rgba(0, 0, 0, 0) 100%
        )`}},P4={class:"container"},D4={class:"row"},R4={__name:"App",setup(a){const s=mo([]),c=mo([]),m=mo([]),g=mo([]),b=mo();function E(n){b.value?.filterMarkers(n)}return Nx(async()=>{const[n,R,B,N]=await Promise.all([fetch("/locations.json"),fetch("/taxonomy.json"),fetch("/observations.json"),fetch("/submissions.json")]);let X=await n.json(),ie=await R.json(),se=await B.json(),we=await N.json();we.map(Ae=>{const Ie=se.filter(Je=>Je.submission_id===Ae.submission_id);return Ae.taxonomic_order=Ie.map(Je=>Je.taxonomic_order),Ae.count=Ie.reduce((Je,Pe)=>Je+Pe.count,0),Ae}),X.map(Ae=>{const Ie=we.filter(Je=>Je.location_id===Ae.location_id);return Ae.submissions=Ie,Ae.submission_id=Ie.flatMap(Je=>Je.submission_id),Ae.taxonomic_order=[...new Set(Ie.flatMap(Je=>Je.taxonomic_order))],Ae.distance_km=Ie.reduce((Je,Pe)=>Je+(Pe.distance_km??0),0),Ae.duration_min=Ie.reduce((Je,Pe)=>Je+(Pe.duration_min??0),0),Ae.only_incidental=Ie.every(Je=>Je.protocol==="eBird - Casual Observation"),Ae});let pe=Object.values(ie.reduce((Ae,Ie)=>{const Je=Ie.report_as_species_code;return Ae[Je]||(Ae[Je]={taxonomic_order:Ie.report_as_taxonomic_order,common_name:Ie.report_as_common_name,primary_com_name:Ie.report_as_primary_com_name,scientific_name:Ie.report_as_scientific_name,order:Ie.report_as_order,family:Ie.report_as_family,species_code:Ie.report_as_species_code,category:Ie.report_as_category,species_codes_reported:[],taxonomic_orders_reported:[]}),Ae[Je].species_codes_reported.push(Ie.speciesCode),Ae[Je].taxonomic_orders_reported.push(Ie.taxonomic_order),Ae},{})).sort((Ae,Ie)=>Ae.taxonomic_order-Ie.taxonomic_order);pe.map(Ae=>{Ae.obs=se.filter(Ie=>Ae.taxonomic_orders_reported.includes(Ie.taxonomic_order)),Ae.count=Ae.obs.reduce((Ie,Je)=>Ie+(Je.count??0),0),Ae.nobs=Ae.obs.length,Ae.media=Ae.obs.map(Ie=>Ie.ml_catalog_numbers).filter(Ie=>Ie&&Ie.trim()!=="").flatMap(Ie=>Ie.split(" "))}),console.log([...new Set(pe.flatMap(Ae=>Ae.category))]),s.value=X,c.value=pe,m.value=se,g.value=we}),(n,R)=>(Ps(),Ls("div",C4,[Es(k3,{ref_key:"mapView",ref:b,locations:s.value,class:"w-100 h-100 position-absolute top-0 start-0"},null,8,["locations"]),fi("div",M4,[fi("div",P4,[fi("div",D4,[Es(I4),Es(W3,{taxonomy:c.value,onUpdateVisibleSpecies:E},null,8,["taxonomy"])])])])]))}};var $r="top",xo="bottom",vo="right",Gr="left",Hx="auto",kf=[$r,xo,vo,Gr],Su="start",Ef="end",QM="clippingParents",X1="viewport",sf="popper",eP="reference",e1=kf.reduce(function(a,s){return a.concat([s+"-"+Su,s+"-"+Ef])},[]),Y1=[].concat(kf,[Hx]).reduce(function(a,s){return a.concat([s,s+"-"+Su,s+"-"+Ef])},[]),tP="beforeRead",iP="read",nP="afterRead",sP="beforeMain",rP="main",oP="afterMain",aP="beforeWrite",lP="write",cP="afterWrite",hP=[tP,iP,nP,sP,rP,oP,aP,lP,cP];function Ya(a){return a?(a.nodeName||"").toLowerCase():null}function bo(a){if(a==null)return window;if(a.toString()!=="[object Window]"){var s=a.ownerDocument;return s&&s.defaultView||window}return a}function Eu(a){var s=bo(a).Element;return a instanceof s||a instanceof Element}function ko(a){var s=bo(a).HTMLElement;return a instanceof s||a instanceof HTMLElement}function K1(a){if(typeof ShadowRoot>"u")return!1;var s=bo(a).ShadowRoot;return a instanceof s||a instanceof ShadowRoot}function L4(a){var s=a.state;Object.keys(s.elements).forEach(function(c){var m=s.styles[c]||{},g=s.attributes[c]||{},b=s.elements[c];!ko(b)||!Ya(b)||(Object.assign(b.style,m),Object.keys(g).forEach(function(E){var n=g[E];n===!1?b.removeAttribute(E):b.setAttribute(E,n===!0?"":n)}))})}function z4(a){var s=a.state,c={popper:{position:s.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(s.elements.popper.style,c.popper),s.styles=c,s.elements.arrow&&Object.assign(s.elements.arrow.style,c.arrow),function(){Object.keys(s.elements).forEach(function(m){var g=s.elements[m],b=s.attributes[m]||{},E=Object.keys(s.styles.hasOwnProperty(m)?s.styles[m]:c[m]),n=E.reduce(function(R,B){return R[B]="",R},{});!ko(g)||!Ya(g)||(Object.assign(g.style,n),Object.keys(b).forEach(function(R){g.removeAttribute(R)}))})}}const J1={name:"applyStyles",enabled:!0,phase:"write",fn:L4,effect:z4,requires:["computeStyles"]};function Ha(a){return a.split("-")[0]}var wu=Math.max,Mx=Math.min,Af=Math.round;function t1(){var a=navigator.userAgentData;return a!=null&&a.brands&&Array.isArray(a.brands)?a.brands.map(function(s){return s.brand+"/"+s.version}).join(" "):navigator.userAgent}function uP(){return!/^((?!chrome|android).)*safari/i.test(t1())}function If(a,s,c){s===void 0&&(s=!1),c===void 0&&(c=!1);var m=a.getBoundingClientRect(),g=1,b=1;s&&ko(a)&&(g=a.offsetWidth>0&&Af(m.width)/a.offsetWidth||1,b=a.offsetHeight>0&&Af(m.height)/a.offsetHeight||1);var E=Eu(a)?bo(a):window,n=E.visualViewport,R=!uP()&&c,B=(m.left+(R&&n?n.offsetLeft:0))/g,N=(m.top+(R&&n?n.offsetTop:0))/b,X=m.width/g,ie=m.height/b;return{width:X,height:ie,top:N,right:B+X,bottom:N+ie,left:B,x:B,y:N}}function Q1(a){var s=If(a),c=a.offsetWidth,m=a.offsetHeight;return Math.abs(s.width-c)<=1&&(c=s.width),Math.abs(s.height-m)<=1&&(m=s.height),{x:a.offsetLeft,y:a.offsetTop,width:c,height:m}}function dP(a,s){var c=s.getRootNode&&s.getRootNode();if(a.contains(s))return!0;if(c&&K1(c)){var m=s;do{if(m&&a.isSameNode(m))return!0;m=m.parentNode||m.host}while(m)}return!1}function Fl(a){return bo(a).getComputedStyle(a)}function O4(a){return["table","td","th"].indexOf(Ya(a))>=0}function Yc(a){return((Eu(a)?a.ownerDocument:a.document)||window.document).documentElement}function Wx(a){return Ya(a)==="html"?a:a.assignedSlot||a.parentNode||(K1(a)?a.host:null)||Yc(a)}function tI(a){return!ko(a)||Fl(a).position==="fixed"?null:a.offsetParent}function k4(a){var s=/firefox/i.test(t1()),c=/Trident/i.test(t1());if(c&&ko(a)){var m=Fl(a);if(m.position==="fixed")return null}var g=Wx(a);for(K1(g)&&(g=g.host);ko(g)&&["html","body"].indexOf(Ya(g))<0;){var b=Fl(g);if(b.transform!=="none"||b.perspective!=="none"||b.contain==="paint"||["transform","perspective"].indexOf(b.willChange)!==-1||s&&b.willChange==="filter"||s&&b.filter&&b.filter!=="none")return g;g=g.parentNode}return null}function E_(a){for(var s=bo(a),c=tI(a);c&&O4(c)&&Fl(c).position==="static";)c=tI(c);return c&&(Ya(c)==="html"||Ya(c)==="body"&&Fl(c).position==="static")?s:c||k4(a)||s}function ew(a){return["top","bottom"].indexOf(a)>=0?"x":"y"}function e_(a,s,c){return wu(a,Mx(s,c))}function F4(a,s,c){var m=e_(a,s,c);return m>c?c:m}function fP(){return{top:0,right:0,bottom:0,left:0}}function pP(a){return Object.assign({},fP(),a)}function mP(a,s){return s.reduce(function(c,m){return c[m]=a,c},{})}var B4=function(s,c){return s=typeof s=="function"?s(Object.assign({},c.rects,{placement:c.placement})):s,pP(typeof s!="number"?s:mP(s,kf))};function N4(a){var s,c=a.state,m=a.name,g=a.options,b=c.elements.arrow,E=c.modifiersData.popperOffsets,n=Ha(c.placement),R=ew(n),B=[Gr,vo].indexOf(n)>=0,N=B?"height":"width";if(!(!b||!E)){var X=B4(g.padding,c),ie=Q1(b),se=R==="y"?$r:Gr,we=R==="y"?xo:vo,pe=c.rects.reference[N]+c.rects.reference[R]-E[R]-c.rects.popper[N],Ae=E[R]-c.rects.reference[R],Ie=E_(b),Je=Ie?R==="y"?Ie.clientHeight||0:Ie.clientWidth||0:0,Pe=pe/2-Ae/2,Oe=X[se],tt=Je-ie[N]-X[we],xt=Je/2-ie[N]/2+Pe,Tt=e_(Oe,xt,tt),At=R;c.modifiersData[m]=(s={},s[At]=Tt,s.centerOffset=Tt-xt,s)}}function V4(a){var s=a.state,c=a.options,m=c.element,g=m===void 0?"[data-popper-arrow]":m;g!=null&&(typeof g=="string"&&(g=s.elements.popper.querySelector(g),!g)||dP(s.elements.popper,g)&&(s.elements.arrow=g))}const _P={name:"arrow",enabled:!0,phase:"main",fn:N4,effect:V4,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Cf(a){return a.split("-")[1]}var U4={top:"auto",right:"auto",bottom:"auto",left:"auto"};function j4(a,s){var c=a.x,m=a.y,g=s.devicePixelRatio||1;return{x:Af(c*g)/g||0,y:Af(m*g)/g||0}}function iI(a){var s,c=a.popper,m=a.popperRect,g=a.placement,b=a.variation,E=a.offsets,n=a.position,R=a.gpuAcceleration,B=a.adaptive,N=a.roundOffsets,X=a.isFixed,ie=E.x,se=ie===void 0?0:ie,we=E.y,pe=we===void 0?0:we,Ae=typeof N=="function"?N({x:se,y:pe}):{x:se,y:pe};se=Ae.x,pe=Ae.y;var Ie=E.hasOwnProperty("x"),Je=E.hasOwnProperty("y"),Pe=Gr,Oe=$r,tt=window;if(B){var xt=E_(c),Tt="clientHeight",At="clientWidth";if(xt===bo(c)&&(xt=Yc(c),Fl(xt).position!=="static"&&n==="absolute"&&(Tt="scrollHeight",At="scrollWidth")),xt=xt,g===$r||(g===Gr||g===vo)&&b===Ef){Oe=xo;var Wt=X&&xt===tt&&tt.visualViewport?tt.visualViewport.height:xt[Tt];pe-=Wt-m.height,pe*=R?1:-1}if(g===Gr||(g===$r||g===xo)&&b===Ef){Pe=vo;var Zt=X&&xt===tt&&tt.visualViewport?tt.visualViewport.width:xt[At];se-=Zt-m.width,se*=R?1:-1}}var jt=Object.assign({position:n},B&&U4),pi=N===!0?j4({x:se,y:pe},bo(c)):{x:se,y:pe};if(se=pi.x,pe=pi.y,R){var gi;return Object.assign({},jt,(gi={},gi[Oe]=Je?"0":"",gi[Pe]=Ie?"0":"",gi.transform=(tt.devicePixelRatio||1)<=1?"translate("+se+"px, "+pe+"px)":"translate3d("+se+"px, "+pe+"px, 0)",gi))}return Object.assign({},jt,(s={},s[Oe]=Je?pe+"px":"",s[Pe]=Ie?se+"px":"",s.transform="",s))}function $4(a){var s=a.state,c=a.options,m=c.gpuAcceleration,g=m===void 0?!0:m,b=c.adaptive,E=b===void 0?!0:b,n=c.roundOffsets,R=n===void 0?!0:n,B={placement:Ha(s.placement),variation:Cf(s.placement),popper:s.elements.popper,popperRect:s.rects.popper,gpuAcceleration:g,isFixed:s.options.strategy==="fixed"};s.modifiersData.popperOffsets!=null&&(s.styles.popper=Object.assign({},s.styles.popper,iI(Object.assign({},B,{offsets:s.modifiersData.popperOffsets,position:s.options.strategy,adaptive:E,roundOffsets:R})))),s.modifiersData.arrow!=null&&(s.styles.arrow=Object.assign({},s.styles.arrow,iI(Object.assign({},B,{offsets:s.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:R})))),s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-placement":s.placement})}const tw={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:$4,data:{}};var Wy={passive:!0};function G4(a){var s=a.state,c=a.instance,m=a.options,g=m.scroll,b=g===void 0?!0:g,E=m.resize,n=E===void 0?!0:E,R=bo(s.elements.popper),B=[].concat(s.scrollParents.reference,s.scrollParents.popper);return b&&B.forEach(function(N){N.addEventListener("scroll",c.update,Wy)}),n&&R.addEventListener("resize",c.update,Wy),function(){b&&B.forEach(function(N){N.removeEventListener("scroll",c.update,Wy)}),n&&R.removeEventListener("resize",c.update,Wy)}}const iw={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:G4,data:{}};var H4={left:"right",right:"left",bottom:"top",top:"bottom"};function cx(a){return a.replace(/left|right|bottom|top/g,function(s){return H4[s]})}var W4={start:"end",end:"start"};function nI(a){return a.replace(/start|end/g,function(s){return W4[s]})}function nw(a){var s=bo(a),c=s.pageXOffset,m=s.pageYOffset;return{scrollLeft:c,scrollTop:m}}function sw(a){return If(Yc(a)).left+nw(a).scrollLeft}function q4(a,s){var c=bo(a),m=Yc(a),g=c.visualViewport,b=m.clientWidth,E=m.clientHeight,n=0,R=0;if(g){b=g.width,E=g.height;var B=uP();(B||!B&&s==="fixed")&&(n=g.offsetLeft,R=g.offsetTop)}return{width:b,height:E,x:n+sw(a),y:R}}function Z4(a){var s,c=Yc(a),m=nw(a),g=(s=a.ownerDocument)==null?void 0:s.body,b=wu(c.scrollWidth,c.clientWidth,g?g.scrollWidth:0,g?g.clientWidth:0),E=wu(c.scrollHeight,c.clientHeight,g?g.scrollHeight:0,g?g.clientHeight:0),n=-m.scrollLeft+sw(a),R=-m.scrollTop;return Fl(g||c).direction==="rtl"&&(n+=wu(c.clientWidth,g?g.clientWidth:0)-b),{width:b,height:E,x:n,y:R}}function rw(a){var s=Fl(a),c=s.overflow,m=s.overflowX,g=s.overflowY;return/auto|scroll|overlay|hidden/.test(c+g+m)}function gP(a){return["html","body","#document"].indexOf(Ya(a))>=0?a.ownerDocument.body:ko(a)&&rw(a)?a:gP(Wx(a))}function t_(a,s){var c;s===void 0&&(s=[]);var m=gP(a),g=m===((c=a.ownerDocument)==null?void 0:c.body),b=bo(m),E=g?[b].concat(b.visualViewport||[],rw(m)?m:[]):m,n=s.concat(E);return g?n:n.concat(t_(Wx(E)))}function i1(a){return Object.assign({},a,{left:a.x,top:a.y,right:a.x+a.width,bottom:a.y+a.height})}function X4(a,s){var c=If(a,!1,s==="fixed");return c.top=c.top+a.clientTop,c.left=c.left+a.clientLeft,c.bottom=c.top+a.clientHeight,c.right=c.left+a.clientWidth,c.width=a.clientWidth,c.height=a.clientHeight,c.x=c.left,c.y=c.top,c}function sI(a,s,c){return s===X1?i1(q4(a,c)):Eu(s)?X4(s,c):i1(Z4(Yc(a)))}function Y4(a){var s=t_(Wx(a)),c=["absolute","fixed"].indexOf(Fl(a).position)>=0,m=c&&ko(a)?E_(a):a;return Eu(m)?s.filter(function(g){return Eu(g)&&dP(g,m)&&Ya(g)!=="body"}):[]}function K4(a,s,c,m){var g=s==="clippingParents"?Y4(a):[].concat(s),b=[].concat(g,[c]),E=b[0],n=b.reduce(function(R,B){var N=sI(a,B,m);return R.top=wu(N.top,R.top),R.right=Mx(N.right,R.right),R.bottom=Mx(N.bottom,R.bottom),R.left=wu(N.left,R.left),R},sI(a,E,m));return n.width=n.right-n.left,n.height=n.bottom-n.top,n.x=n.left,n.y=n.top,n}function yP(a){var s=a.reference,c=a.element,m=a.placement,g=m?Ha(m):null,b=m?Cf(m):null,E=s.x+s.width/2-c.width/2,n=s.y+s.height/2-c.height/2,R;switch(g){case $r:R={x:E,y:s.y-c.height};break;case xo:R={x:E,y:s.y+s.height};break;case vo:R={x:s.x+s.width,y:n};break;case Gr:R={x:s.x-c.width,y:n};break;default:R={x:s.x,y:s.y}}var B=g?ew(g):null;if(B!=null){var N=B==="y"?"height":"width";switch(b){case Su:R[B]=R[B]-(s[N]/2-c[N]/2);break;case Ef:R[B]=R[B]+(s[N]/2-c[N]/2);break}}return R}function Mf(a,s){s===void 0&&(s={});var c=s,m=c.placement,g=m===void 0?a.placement:m,b=c.strategy,E=b===void 0?a.strategy:b,n=c.boundary,R=n===void 0?QM:n,B=c.rootBoundary,N=B===void 0?X1:B,X=c.elementContext,ie=X===void 0?sf:X,se=c.altBoundary,we=se===void 0?!1:se,pe=c.padding,Ae=pe===void 0?0:pe,Ie=pP(typeof Ae!="number"?Ae:mP(Ae,kf)),Je=ie===sf?eP:sf,Pe=a.rects.popper,Oe=a.elements[we?Je:ie],tt=K4(Eu(Oe)?Oe:Oe.contextElement||Yc(a.elements.popper),R,N,E),xt=If(a.elements.reference),Tt=yP({reference:xt,element:Pe,placement:g}),At=i1(Object.assign({},Pe,Tt)),Wt=ie===sf?At:xt,Zt={top:tt.top-Wt.top+Ie.top,bottom:Wt.bottom-tt.bottom+Ie.bottom,left:tt.left-Wt.left+Ie.left,right:Wt.right-tt.right+Ie.right},jt=a.modifiersData.offset;if(ie===sf&&jt){var pi=jt[g];Object.keys(Zt).forEach(function(gi){var _i=[vo,xo].indexOf(gi)>=0?1:-1,yi=[$r,xo].indexOf(gi)>=0?"y":"x";Zt[gi]+=pi[yi]*_i})}return Zt}function J4(a,s){s===void 0&&(s={});var c=s,m=c.placement,g=c.boundary,b=c.rootBoundary,E=c.padding,n=c.flipVariations,R=c.allowedAutoPlacements,B=R===void 0?Y1:R,N=Cf(m),X=N?n?e1:e1.filter(function(we){return Cf(we)===N}):kf,ie=X.filter(function(we){return B.indexOf(we)>=0});ie.length===0&&(ie=X);var se=ie.reduce(function(we,pe){return we[pe]=Mf(a,{placement:pe,boundary:g,rootBoundary:b,padding:E})[Ha(pe)],we},{});return Object.keys(se).sort(function(we,pe){return se[we]-se[pe]})}function Q4(a){if(Ha(a)===Hx)return[];var s=cx(a);return[nI(a),s,nI(s)]}function eV(a){var s=a.state,c=a.options,m=a.name;if(!s.modifiersData[m]._skip){for(var g=c.mainAxis,b=g===void 0?!0:g,E=c.altAxis,n=E===void 0?!0:E,R=c.fallbackPlacements,B=c.padding,N=c.boundary,X=c.rootBoundary,ie=c.altBoundary,se=c.flipVariations,we=se===void 0?!0:se,pe=c.allowedAutoPlacements,Ae=s.options.placement,Ie=Ha(Ae),Je=Ie===Ae,Pe=R||(Je||!we?[cx(Ae)]:Q4(Ae)),Oe=[Ae].concat(Pe).reduce(function(Is,Zi){return Is.concat(Ha(Zi)===Hx?J4(s,{placement:Zi,boundary:N,rootBoundary:X,padding:B,flipVariations:we,allowedAutoPlacements:pe}):Zi)},[]),tt=s.rects.reference,xt=s.rects.popper,Tt=new Map,At=!0,Wt=Oe[0],Zt=0;Zt<Oe.length;Zt++){var jt=Oe[Zt],pi=Ha(jt),gi=Cf(jt)===Su,_i=[$r,xo].indexOf(pi)>=0,yi=_i?"width":"height",$t=Mf(s,{placement:jt,boundary:N,rootBoundary:X,altBoundary:ie,padding:B}),xi=_i?gi?vo:Gr:gi?xo:$r;tt[yi]>xt[yi]&&(xi=cx(xi));var hi=cx(xi),sn=[];if(b&&sn.push($t[pi]<=0),n&&sn.push($t[xi]<=0,$t[hi]<=0),sn.every(function(Is){return Is})){Wt=jt,At=!1;break}Tt.set(jt,sn)}if(At)for(var Ui=we?3:1,ss=function(Zi){var en=Oe.find(function(es){var xs=Tt.get(es);if(xs)return xs.slice(0,Zi).every(function(fn){return fn})});if(en)return Wt=en,"break"},jn=Ui;jn>0;jn--){var Fs=ss(jn);if(Fs==="break")break}s.placement!==Wt&&(s.modifiersData[m]._skip=!0,s.placement=Wt,s.reset=!0)}}const xP={name:"flip",enabled:!0,phase:"main",fn:eV,requiresIfExists:["offset"],data:{_skip:!1}};function rI(a,s,c){return c===void 0&&(c={x:0,y:0}),{top:a.top-s.height-c.y,right:a.right-s.width+c.x,bottom:a.bottom-s.height+c.y,left:a.left-s.width-c.x}}function oI(a){return[$r,vo,xo,Gr].some(function(s){return a[s]>=0})}function tV(a){var s=a.state,c=a.name,m=s.rects.reference,g=s.rects.popper,b=s.modifiersData.preventOverflow,E=Mf(s,{elementContext:"reference"}),n=Mf(s,{altBoundary:!0}),R=rI(E,m),B=rI(n,g,b),N=oI(R),X=oI(B);s.modifiersData[c]={referenceClippingOffsets:R,popperEscapeOffsets:B,isReferenceHidden:N,hasPopperEscaped:X},s.attributes.popper=Object.assign({},s.attributes.popper,{"data-popper-reference-hidden":N,"data-popper-escaped":X})}const vP={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:tV};function iV(a,s,c){var m=Ha(a),g=[Gr,$r].indexOf(m)>=0?-1:1,b=typeof c=="function"?c(Object.assign({},s,{placement:a})):c,E=b[0],n=b[1];return E=E||0,n=(n||0)*g,[Gr,vo].indexOf(m)>=0?{x:n,y:E}:{x:E,y:n}}function nV(a){var s=a.state,c=a.options,m=a.name,g=c.offset,b=g===void 0?[0,0]:g,E=Y1.reduce(function(N,X){return N[X]=iV(X,s.rects,b),N},{}),n=E[s.placement],R=n.x,B=n.y;s.modifiersData.popperOffsets!=null&&(s.modifiersData.popperOffsets.x+=R,s.modifiersData.popperOffsets.y+=B),s.modifiersData[m]=E}const bP={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:nV};function sV(a){var s=a.state,c=a.name;s.modifiersData[c]=yP({reference:s.rects.reference,element:s.rects.popper,placement:s.placement})}const ow={name:"popperOffsets",enabled:!0,phase:"read",fn:sV,data:{}};function rV(a){return a==="x"?"y":"x"}function oV(a){var s=a.state,c=a.options,m=a.name,g=c.mainAxis,b=g===void 0?!0:g,E=c.altAxis,n=E===void 0?!1:E,R=c.boundary,B=c.rootBoundary,N=c.altBoundary,X=c.padding,ie=c.tether,se=ie===void 0?!0:ie,we=c.tetherOffset,pe=we===void 0?0:we,Ae=Mf(s,{boundary:R,rootBoundary:B,padding:X,altBoundary:N}),Ie=Ha(s.placement),Je=Cf(s.placement),Pe=!Je,Oe=ew(Ie),tt=rV(Oe),xt=s.modifiersData.popperOffsets,Tt=s.rects.reference,At=s.rects.popper,Wt=typeof pe=="function"?pe(Object.assign({},s.rects,{placement:s.placement})):pe,Zt=typeof Wt=="number"?{mainAxis:Wt,altAxis:Wt}:Object.assign({mainAxis:0,altAxis:0},Wt),jt=s.modifiersData.offset?s.modifiersData.offset[s.placement]:null,pi={x:0,y:0};if(xt){if(b){var gi,_i=Oe==="y"?$r:Gr,yi=Oe==="y"?xo:vo,$t=Oe==="y"?"height":"width",xi=xt[Oe],hi=xi+Ae[_i],sn=xi-Ae[yi],Ui=se?-At[$t]/2:0,ss=Je===Su?Tt[$t]:At[$t],jn=Je===Su?-At[$t]:-Tt[$t],Fs=s.elements.arrow,Is=se&&Fs?Q1(Fs):{width:0,height:0},Zi=s.modifiersData["arrow#persistent"]?s.modifiersData["arrow#persistent"].padding:fP(),en=Zi[_i],es=Zi[yi],xs=e_(0,Tt[$t],Is[$t]),fn=Pe?Tt[$t]/2-Ui-xs-en-Zt.mainAxis:ss-xs-en-Zt.mainAxis,pr=Pe?-Tt[$t]/2+Ui+xs+es+Zt.mainAxis:jn+xs+es+Zt.mainAxis,Ks=s.elements.arrow&&E_(s.elements.arrow),Js=Ks?Oe==="y"?Ks.clientTop||0:Ks.clientLeft||0:0,Ce=(gi=jt?.[Oe])!=null?gi:0,Ze=xi+fn-Ce-Js,gt=xi+pr-Ce,Rt=e_(se?Mx(hi,Ze):hi,xi,se?wu(sn,gt):sn);xt[Oe]=Rt,pi[Oe]=Rt-xi}if(n){var zt,Nt=Oe==="x"?$r:Gr,Qt=Oe==="x"?xo:vo,Gt=xt[tt],Kt=tt==="y"?"height":"width",Vt=Gt+Ae[Nt],Ci=Gt-Ae[Qt],Jt=[$r,Gr].indexOf(Ie)!==-1,Ti=(zt=jt?.[tt])!=null?zt:0,Vi=Jt?Vt:Gt-Tt[Kt]-At[Kt]-Ti+Zt.altAxis,ji=Jt?Gt+Tt[Kt]+At[Kt]-Ti-Zt.altAxis:Ci,$n=se&&Jt?F4(Vi,Gt,ji):e_(se?Vi:Vt,Gt,se?ji:Ci);xt[tt]=$n,pi[tt]=$n-Gt}s.modifiersData[m]=pi}}const wP={name:"preventOverflow",enabled:!0,phase:"main",fn:oV,requiresIfExists:["offset"]};function aV(a){return{scrollLeft:a.scrollLeft,scrollTop:a.scrollTop}}function lV(a){return a===bo(a)||!ko(a)?nw(a):aV(a)}function cV(a){var s=a.getBoundingClientRect(),c=Af(s.width)/a.offsetWidth||1,m=Af(s.height)/a.offsetHeight||1;return c!==1||m!==1}function hV(a,s,c){c===void 0&&(c=!1);var m=ko(s),g=ko(s)&&cV(s),b=Yc(s),E=If(a,g,c),n={scrollLeft:0,scrollTop:0},R={x:0,y:0};return(m||!m&&!c)&&((Ya(s)!=="body"||rw(b))&&(n=lV(s)),ko(s)?(R=If(s,!0),R.x+=s.clientLeft,R.y+=s.clientTop):b&&(R.x=sw(b))),{x:E.left+n.scrollLeft-R.x,y:E.top+n.scrollTop-R.y,width:E.width,height:E.height}}function uV(a){var s=new Map,c=new Set,m=[];a.forEach(function(b){s.set(b.name,b)});function g(b){c.add(b.name);var E=[].concat(b.requires||[],b.requiresIfExists||[]);E.forEach(function(n){if(!c.has(n)){var R=s.get(n);R&&g(R)}}),m.push(b)}return a.forEach(function(b){c.has(b.name)||g(b)}),m}function dV(a){var s=uV(a);return hP.reduce(function(c,m){return c.concat(s.filter(function(g){return g.phase===m}))},[])}function fV(a){var s;return function(){return s||(s=new Promise(function(c){Promise.resolve().then(function(){s=void 0,c(a())})})),s}}function pV(a){var s=a.reduce(function(c,m){var g=c[m.name];return c[m.name]=g?Object.assign({},g,m,{options:Object.assign({},g.options,m.options),data:Object.assign({},g.data,m.data)}):m,c},{});return Object.keys(s).map(function(c){return s[c]})}var aI={placement:"bottom",modifiers:[],strategy:"absolute"};function lI(){for(var a=arguments.length,s=new Array(a),c=0;c<a;c++)s[c]=arguments[c];return!s.some(function(m){return!(m&&typeof m.getBoundingClientRect=="function")})}function qx(a){a===void 0&&(a={});var s=a,c=s.defaultModifiers,m=c===void 0?[]:c,g=s.defaultOptions,b=g===void 0?aI:g;return function(n,R,B){B===void 0&&(B=b);var N={placement:"bottom",orderedModifiers:[],options:Object.assign({},aI,b),modifiersData:{},elements:{reference:n,popper:R},attributes:{},styles:{}},X=[],ie=!1,se={state:N,setOptions:function(Ie){var Je=typeof Ie=="function"?Ie(N.options):Ie;pe(),N.options=Object.assign({},b,N.options,Je),N.scrollParents={reference:Eu(n)?t_(n):n.contextElement?t_(n.contextElement):[],popper:t_(R)};var Pe=dV(pV([].concat(m,N.options.modifiers)));return N.orderedModifiers=Pe.filter(function(Oe){return Oe.enabled}),we(),se.update()},forceUpdate:function(){if(!ie){var Ie=N.elements,Je=Ie.reference,Pe=Ie.popper;if(lI(Je,Pe)){N.rects={reference:hV(Je,E_(Pe),N.options.strategy==="fixed"),popper:Q1(Pe)},N.reset=!1,N.placement=N.options.placement,N.orderedModifiers.forEach(function(Zt){return N.modifiersData[Zt.name]=Object.assign({},Zt.data)});for(var Oe=0;Oe<N.orderedModifiers.length;Oe++){if(N.reset===!0){N.reset=!1,Oe=-1;continue}var tt=N.orderedModifiers[Oe],xt=tt.fn,Tt=tt.options,At=Tt===void 0?{}:Tt,Wt=tt.name;typeof xt=="function"&&(N=xt({state:N,options:At,name:Wt,instance:se})||N)}}}},update:fV(function(){return new Promise(function(Ae){se.forceUpdate(),Ae(N)})}),destroy:function(){pe(),ie=!0}};if(!lI(n,R))return se;se.setOptions(B).then(function(Ae){!ie&&B.onFirstUpdate&&B.onFirstUpdate(Ae)});function we(){N.orderedModifiers.forEach(function(Ae){var Ie=Ae.name,Je=Ae.options,Pe=Je===void 0?{}:Je,Oe=Ae.effect;if(typeof Oe=="function"){var tt=Oe({state:N,name:Ie,instance:se,options:Pe}),xt=function(){};X.push(tt||xt)}})}function pe(){X.forEach(function(Ae){return Ae()}),X=[]}return se}}var mV=qx(),_V=[iw,ow,tw,J1],gV=qx({defaultModifiers:_V}),yV=[iw,ow,tw,J1,bP,xP,wP,_P,vP],aw=qx({defaultModifiers:yV});const TP=Object.freeze(Object.defineProperty({__proto__:null,afterMain:oP,afterRead:nP,afterWrite:cP,applyStyles:J1,arrow:_P,auto:Hx,basePlacements:kf,beforeMain:sP,beforeRead:tP,beforeWrite:aP,bottom:xo,clippingParents:QM,computeStyles:tw,createPopper:aw,createPopperBase:mV,createPopperLite:gV,detectOverflow:Mf,end:Ef,eventListeners:iw,flip:xP,hide:vP,left:Gr,main:rP,modifierPhases:hP,offset:bP,placements:Y1,popper:sf,popperGenerator:qx,popperOffsets:ow,preventOverflow:wP,read:iP,reference:eP,right:vo,start:Su,top:$r,variationPlacements:e1,viewport:X1,write:lP},Symbol.toStringTag,{value:"Module"}));/*!
  * Bootstrap v5.3.7 (https://getbootstrap.com/)
  * Copyright 2011-2025 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */const Dc=new Map,bb={set(a,s,c){Dc.has(a)||Dc.set(a,new Map);const m=Dc.get(a);if(!m.has(s)&&m.size!==0){console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(m.keys())[0]}.`);return}m.set(s,c)},get(a,s){return Dc.has(a)&&Dc.get(a).get(s)||null},remove(a,s){if(!Dc.has(a))return;const c=Dc.get(a);c.delete(s),c.size===0&&Dc.delete(a)}},xV=1e6,vV=1e3,n1="transitionend",SP=a=>(a&&window.CSS&&window.CSS.escape&&(a=a.replace(/#([^\s"#']+)/g,(s,c)=>`#${CSS.escape(c)}`)),a),bV=a=>a==null?`${a}`:Object.prototype.toString.call(a).match(/\s([a-z]+)/i)[1].toLowerCase(),wV=a=>{do a+=Math.floor(Math.random()*xV);while(document.getElementById(a));return a},TV=a=>{if(!a)return 0;let{transitionDuration:s,transitionDelay:c}=window.getComputedStyle(a);const m=Number.parseFloat(s),g=Number.parseFloat(c);return!m&&!g?0:(s=s.split(",")[0],c=c.split(",")[0],(Number.parseFloat(s)+Number.parseFloat(c))*vV)},EP=a=>{a.dispatchEvent(new Event(n1))},Ll=a=>!a||typeof a!="object"?!1:(typeof a.jquery<"u"&&(a=a[0]),typeof a.nodeType<"u"),Hc=a=>Ll(a)?a.jquery?a[0]:a:typeof a=="string"&&a.length>0?document.querySelector(SP(a)):null,Ff=a=>{if(!Ll(a)||a.getClientRects().length===0)return!1;const s=getComputedStyle(a).getPropertyValue("visibility")==="visible",c=a.closest("details:not([open])");if(!c)return s;if(c!==a){const m=a.closest("summary");if(m&&m.parentNode!==c||m===null)return!1}return s},Wc=a=>!a||a.nodeType!==Node.ELEMENT_NODE||a.classList.contains("disabled")?!0:typeof a.disabled<"u"?a.disabled:a.hasAttribute("disabled")&&a.getAttribute("disabled")!=="false",AP=a=>{if(!document.documentElement.attachShadow)return null;if(typeof a.getRootNode=="function"){const s=a.getRootNode();return s instanceof ShadowRoot?s:null}return a instanceof ShadowRoot?a:a.parentNode?AP(a.parentNode):null},Px=()=>{},A_=a=>{a.offsetHeight},IP=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,wb=[],SV=a=>{document.readyState==="loading"?(wb.length||document.addEventListener("DOMContentLoaded",()=>{for(const s of wb)s()}),wb.push(a)):a()},No=()=>document.documentElement.dir==="rtl",Uo=a=>{SV(()=>{const s=IP();if(s){const c=a.NAME,m=s.fn[c];s.fn[c]=a.jQueryInterface,s.fn[c].Constructor=a,s.fn[c].noConflict=()=>(s.fn[c]=m,a.jQueryInterface)}})},io=(a,s=[],c=a)=>typeof a=="function"?a.call(...s):c,CP=(a,s,c=!0)=>{if(!c){io(a);return}const g=TV(s)+5;let b=!1;const E=({target:n})=>{n===s&&(b=!0,s.removeEventListener(n1,E),io(a))};s.addEventListener(n1,E),setTimeout(()=>{b||EP(s)},g)},lw=(a,s,c,m)=>{const g=a.length;let b=a.indexOf(s);return b===-1?!c&&m?a[g-1]:a[0]:(b+=c?1:-1,m&&(b=(b+g)%g),a[Math.max(0,Math.min(b,g-1))])},EV=/[^.]*(?=\..*)\.|.*/,AV=/\..*/,IV=/::\d+$/,Tb={};let cI=1;const MP={mouseenter:"mouseover",mouseleave:"mouseout"},CV=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function PP(a,s){return s&&`${s}::${cI++}`||a.uidEvent||cI++}function DP(a){const s=PP(a);return a.uidEvent=s,Tb[s]=Tb[s]||{},Tb[s]}function MV(a,s){return function c(m){return cw(m,{delegateTarget:a}),c.oneOff&&Xt.off(a,m.type,s),s.apply(a,[m])}}function PV(a,s,c){return function m(g){const b=a.querySelectorAll(s);for(let{target:E}=g;E&&E!==this;E=E.parentNode)for(const n of b)if(n===E)return cw(g,{delegateTarget:E}),m.oneOff&&Xt.off(a,g.type,s,c),c.apply(E,[g])}}function RP(a,s,c=null){return Object.values(a).find(m=>m.callable===s&&m.delegationSelector===c)}function LP(a,s,c){const m=typeof s=="string",g=m?c:s||c;let b=zP(a);return CV.has(b)||(b=a),[m,g,b]}function hI(a,s,c,m,g){if(typeof s!="string"||!a)return;let[b,E,n]=LP(s,c,m);s in MP&&(E=(we=>function(pe){if(!pe.relatedTarget||pe.relatedTarget!==pe.delegateTarget&&!pe.delegateTarget.contains(pe.relatedTarget))return we.call(this,pe)})(E));const R=DP(a),B=R[n]||(R[n]={}),N=RP(B,E,b?c:null);if(N){N.oneOff=N.oneOff&&g;return}const X=PP(E,s.replace(EV,"")),ie=b?PV(a,c,E):MV(a,E);ie.delegationSelector=b?c:null,ie.callable=E,ie.oneOff=g,ie.uidEvent=X,B[X]=ie,a.addEventListener(n,ie,b)}function s1(a,s,c,m,g){const b=RP(s[c],m,g);b&&(a.removeEventListener(c,b,!!g),delete s[c][b.uidEvent])}function DV(a,s,c,m){const g=s[c]||{};for(const[b,E]of Object.entries(g))b.includes(m)&&s1(a,s,c,E.callable,E.delegationSelector)}function zP(a){return a=a.replace(AV,""),MP[a]||a}const Xt={on(a,s,c,m){hI(a,s,c,m,!1)},one(a,s,c,m){hI(a,s,c,m,!0)},off(a,s,c,m){if(typeof s!="string"||!a)return;const[g,b,E]=LP(s,c,m),n=E!==s,R=DP(a),B=R[E]||{},N=s.startsWith(".");if(typeof b<"u"){if(!Object.keys(B).length)return;s1(a,R,E,b,g?c:null);return}if(N)for(const X of Object.keys(R))DV(a,R,X,s.slice(1));for(const[X,ie]of Object.entries(B)){const se=X.replace(IV,"");(!n||s.includes(se))&&s1(a,R,E,ie.callable,ie.delegationSelector)}},trigger(a,s,c){if(typeof s!="string"||!a)return null;const m=IP(),g=zP(s),b=s!==g;let E=null,n=!0,R=!0,B=!1;b&&m&&(E=m.Event(s,c),m(a).trigger(E),n=!E.isPropagationStopped(),R=!E.isImmediatePropagationStopped(),B=E.isDefaultPrevented());const N=cw(new Event(s,{bubbles:n,cancelable:!0}),c);return B&&N.preventDefault(),R&&a.dispatchEvent(N),N.defaultPrevented&&E&&E.preventDefault(),N}};function cw(a,s={}){for(const[c,m]of Object.entries(s))try{a[c]=m}catch{Object.defineProperty(a,c,{configurable:!0,get(){return m}})}return a}function uI(a){if(a==="true")return!0;if(a==="false")return!1;if(a===Number(a).toString())return Number(a);if(a===""||a==="null")return null;if(typeof a!="string")return a;try{return JSON.parse(decodeURIComponent(a))}catch{return a}}function Sb(a){return a.replace(/[A-Z]/g,s=>`-${s.toLowerCase()}`)}const zl={setDataAttribute(a,s,c){a.setAttribute(`data-bs-${Sb(s)}`,c)},removeDataAttribute(a,s){a.removeAttribute(`data-bs-${Sb(s)}`)},getDataAttributes(a){if(!a)return{};const s={},c=Object.keys(a.dataset).filter(m=>m.startsWith("bs")&&!m.startsWith("bsConfig"));for(const m of c){let g=m.replace(/^bs/,"");g=g.charAt(0).toLowerCase()+g.slice(1),s[g]=uI(a.dataset[m])}return s},getDataAttribute(a,s){return uI(a.getAttribute(`data-bs-${Sb(s)}`))}};class I_{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(s){return s=this._mergeConfigObj(s),s=this._configAfterMerge(s),this._typeCheckConfig(s),s}_configAfterMerge(s){return s}_mergeConfigObj(s,c){const m=Ll(c)?zl.getDataAttribute(c,"config"):{};return{...this.constructor.Default,...typeof m=="object"?m:{},...Ll(c)?zl.getDataAttributes(c):{},...typeof s=="object"?s:{}}}_typeCheckConfig(s,c=this.constructor.DefaultType){for(const[m,g]of Object.entries(c)){const b=s[m],E=Ll(b)?"element":bV(b);if(!new RegExp(g).test(E))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${m}" provided type "${E}" but expected type "${g}".`)}}}const RV="5.3.7";class da extends I_{constructor(s,c){super(),s=Hc(s),s&&(this._element=s,this._config=this._getConfig(c),bb.set(this._element,this.constructor.DATA_KEY,this))}dispose(){bb.remove(this._element,this.constructor.DATA_KEY),Xt.off(this._element,this.constructor.EVENT_KEY);for(const s of Object.getOwnPropertyNames(this))this[s]=null}_queueCallback(s,c,m=!0){CP(s,c,m)}_getConfig(s){return s=this._mergeConfigObj(s,this._element),s=this._configAfterMerge(s),this._typeCheckConfig(s),s}static getInstance(s){return bb.get(Hc(s),this.DATA_KEY)}static getOrCreateInstance(s,c={}){return this.getInstance(s)||new this(s,typeof c=="object"?c:null)}static get VERSION(){return RV}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(s){return`${s}${this.EVENT_KEY}`}}const Eb=a=>{let s=a.getAttribute("data-bs-target");if(!s||s==="#"){let c=a.getAttribute("href");if(!c||!c.includes("#")&&!c.startsWith("."))return null;c.includes("#")&&!c.startsWith("#")&&(c=`#${c.split("#")[1]}`),s=c&&c!=="#"?c.trim():null}return s?s.split(",").map(c=>SP(c)).join(","):null},Wi={find(a,s=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(s,a))},findOne(a,s=document.documentElement){return Element.prototype.querySelector.call(s,a)},children(a,s){return[].concat(...a.children).filter(c=>c.matches(s))},parents(a,s){const c=[];let m=a.parentNode.closest(s);for(;m;)c.push(m),m=m.parentNode.closest(s);return c},prev(a,s){let c=a.previousElementSibling;for(;c;){if(c.matches(s))return[c];c=c.previousElementSibling}return[]},next(a,s){let c=a.nextElementSibling;for(;c;){if(c.matches(s))return[c];c=c.nextElementSibling}return[]},focusableChildren(a){const s=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map(c=>`${c}:not([tabindex^="-"])`).join(",");return this.find(s,a).filter(c=>!Wc(c)&&Ff(c))},getSelectorFromElement(a){const s=Eb(a);return s&&Wi.findOne(s)?s:null},getElementFromSelector(a){const s=Eb(a);return s?Wi.findOne(s):null},getMultipleElementsFromSelector(a){const s=Eb(a);return s?Wi.find(s):[]}},Zx=(a,s="hide")=>{const c=`click.dismiss${a.EVENT_KEY}`,m=a.NAME;Xt.on(document,c,`[data-bs-dismiss="${m}"]`,function(g){if(["A","AREA"].includes(this.tagName)&&g.preventDefault(),Wc(this))return;const b=Wi.getElementFromSelector(this)||this.closest(`.${m}`);a.getOrCreateInstance(b)[s]()})},LV="alert",zV="bs.alert",OP=`.${zV}`,OV=`close${OP}`,kV=`closed${OP}`,FV="fade",BV="show";class Xx extends da{static get NAME(){return LV}close(){if(Xt.trigger(this._element,OV).defaultPrevented)return;this._element.classList.remove(BV);const c=this._element.classList.contains(FV);this._queueCallback(()=>this._destroyElement(),this._element,c)}_destroyElement(){this._element.remove(),Xt.trigger(this._element,kV),this.dispose()}static jQueryInterface(s){return this.each(function(){const c=Xx.getOrCreateInstance(this);if(typeof s=="string"){if(c[s]===void 0||s.startsWith("_")||s==="constructor")throw new TypeError(`No method named "${s}"`);c[s](this)}})}}Zx(Xx,"close");Uo(Xx);const NV="button",VV="bs.button",UV=`.${VV}`,jV=".data-api",$V="active",dI='[data-bs-toggle="button"]',GV=`click${UV}${jV}`;class Yx extends da{static get NAME(){return NV}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle($V))}static jQueryInterface(s){return this.each(function(){const c=Yx.getOrCreateInstance(this);s==="toggle"&&c[s]()})}}Xt.on(document,GV,dI,a=>{a.preventDefault();const s=a.target.closest(dI);Yx.getOrCreateInstance(s).toggle()});Uo(Yx);const HV="swipe",Bf=".bs.swipe",WV=`touchstart${Bf}`,qV=`touchmove${Bf}`,ZV=`touchend${Bf}`,XV=`pointerdown${Bf}`,YV=`pointerup${Bf}`,KV="touch",JV="pen",QV="pointer-event",eU=40,tU={endCallback:null,leftCallback:null,rightCallback:null},iU={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Dx extends I_{constructor(s,c){super(),this._element=s,!(!s||!Dx.isSupported())&&(this._config=this._getConfig(c),this._deltaX=0,this._supportPointerEvents=!!window.PointerEvent,this._initEvents())}static get Default(){return tU}static get DefaultType(){return iU}static get NAME(){return HV}dispose(){Xt.off(this._element,Bf)}_start(s){if(!this._supportPointerEvents){this._deltaX=s.touches[0].clientX;return}this._eventIsPointerPenTouch(s)&&(this._deltaX=s.clientX)}_end(s){this._eventIsPointerPenTouch(s)&&(this._deltaX=s.clientX-this._deltaX),this._handleSwipe(),io(this._config.endCallback)}_move(s){this._deltaX=s.touches&&s.touches.length>1?0:s.touches[0].clientX-this._deltaX}_handleSwipe(){const s=Math.abs(this._deltaX);if(s<=eU)return;const c=s/this._deltaX;this._deltaX=0,c&&io(c>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(Xt.on(this._element,XV,s=>this._start(s)),Xt.on(this._element,YV,s=>this._end(s)),this._element.classList.add(QV)):(Xt.on(this._element,WV,s=>this._start(s)),Xt.on(this._element,qV,s=>this._move(s)),Xt.on(this._element,ZV,s=>this._end(s)))}_eventIsPointerPenTouch(s){return this._supportPointerEvents&&(s.pointerType===JV||s.pointerType===KV)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const nU="carousel",sU="bs.carousel",Kc=`.${sU}`,kP=".data-api",rU="ArrowLeft",oU="ArrowRight",aU=500,Fm="next",ef="prev",rf="left",hx="right",lU=`slide${Kc}`,Ab=`slid${Kc}`,cU=`keydown${Kc}`,hU=`mouseenter${Kc}`,uU=`mouseleave${Kc}`,dU=`dragstart${Kc}`,fU=`load${Kc}${kP}`,pU=`click${Kc}${kP}`,FP="carousel",qy="active",mU="slide",_U="carousel-item-end",gU="carousel-item-start",yU="carousel-item-next",xU="carousel-item-prev",BP=".active",NP=".carousel-item",vU=BP+NP,bU=".carousel-item img",wU=".carousel-indicators",TU="[data-bs-slide], [data-bs-slide-to]",SU='[data-bs-ride="carousel"]',EU={[rU]:hx,[oU]:rf},AU={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},IU={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class C_ extends da{constructor(s,c){super(s,c),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=Wi.findOne(wU,this._element),this._addEventListeners(),this._config.ride===FP&&this.cycle()}static get Default(){return AU}static get DefaultType(){return IU}static get NAME(){return nU}next(){this._slide(Fm)}nextWhenVisible(){!document.hidden&&Ff(this._element)&&this.next()}prev(){this._slide(ef)}pause(){this._isSliding&&EP(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval(()=>this.nextWhenVisible(),this._config.interval)}_maybeEnableCycle(){if(this._config.ride){if(this._isSliding){Xt.one(this._element,Ab,()=>this.cycle());return}this.cycle()}}to(s){const c=this._getItems();if(s>c.length-1||s<0)return;if(this._isSliding){Xt.one(this._element,Ab,()=>this.to(s));return}const m=this._getItemIndex(this._getActive());if(m===s)return;const g=s>m?Fm:ef;this._slide(g,c[s])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(s){return s.defaultInterval=s.interval,s}_addEventListeners(){this._config.keyboard&&Xt.on(this._element,cU,s=>this._keydown(s)),this._config.pause==="hover"&&(Xt.on(this._element,hU,()=>this.pause()),Xt.on(this._element,uU,()=>this._maybeEnableCycle())),this._config.touch&&Dx.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const m of Wi.find(bU,this._element))Xt.on(m,dU,g=>g.preventDefault());const c={leftCallback:()=>this._slide(this._directionToOrder(rf)),rightCallback:()=>this._slide(this._directionToOrder(hx)),endCallback:()=>{this._config.pause==="hover"&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout(()=>this._maybeEnableCycle(),aU+this._config.interval))}};this._swipeHelper=new Dx(this._element,c)}_keydown(s){if(/input|textarea/i.test(s.target.tagName))return;const c=EU[s.key];c&&(s.preventDefault(),this._slide(this._directionToOrder(c)))}_getItemIndex(s){return this._getItems().indexOf(s)}_setActiveIndicatorElement(s){if(!this._indicatorsElement)return;const c=Wi.findOne(BP,this._indicatorsElement);c.classList.remove(qy),c.removeAttribute("aria-current");const m=Wi.findOne(`[data-bs-slide-to="${s}"]`,this._indicatorsElement);m&&(m.classList.add(qy),m.setAttribute("aria-current","true"))}_updateInterval(){const s=this._activeElement||this._getActive();if(!s)return;const c=Number.parseInt(s.getAttribute("data-bs-interval"),10);this._config.interval=c||this._config.defaultInterval}_slide(s,c=null){if(this._isSliding)return;const m=this._getActive(),g=s===Fm,b=c||lw(this._getItems(),m,g,this._config.wrap);if(b===m)return;const E=this._getItemIndex(b),n=se=>Xt.trigger(this._element,se,{relatedTarget:b,direction:this._orderToDirection(s),from:this._getItemIndex(m),to:E});if(n(lU).defaultPrevented||!m||!b)return;const B=!!this._interval;this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(E),this._activeElement=b;const N=g?gU:_U,X=g?yU:xU;b.classList.add(X),A_(b),m.classList.add(N),b.classList.add(N);const ie=()=>{b.classList.remove(N,X),b.classList.add(qy),m.classList.remove(qy,X,N),this._isSliding=!1,n(Ab)};this._queueCallback(ie,m,this._isAnimated()),B&&this.cycle()}_isAnimated(){return this._element.classList.contains(mU)}_getActive(){return Wi.findOne(vU,this._element)}_getItems(){return Wi.find(NP,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(s){return No()?s===rf?ef:Fm:s===rf?Fm:ef}_orderToDirection(s){return No()?s===ef?rf:hx:s===ef?hx:rf}static jQueryInterface(s){return this.each(function(){const c=C_.getOrCreateInstance(this,s);if(typeof s=="number"){c.to(s);return}if(typeof s=="string"){if(c[s]===void 0||s.startsWith("_")||s==="constructor")throw new TypeError(`No method named "${s}"`);c[s]()}})}}Xt.on(document,pU,TU,function(a){const s=Wi.getElementFromSelector(this);if(!s||!s.classList.contains(FP))return;a.preventDefault();const c=C_.getOrCreateInstance(s),m=this.getAttribute("data-bs-slide-to");if(m){c.to(m),c._maybeEnableCycle();return}if(zl.getDataAttribute(this,"slide")==="next"){c.next(),c._maybeEnableCycle();return}c.prev(),c._maybeEnableCycle()});Xt.on(window,fU,()=>{const a=Wi.find(SU);for(const s of a)C_.getOrCreateInstance(s)});Uo(C_);const CU="collapse",MU="bs.collapse",M_=`.${MU}`,PU=".data-api",DU=`show${M_}`,RU=`shown${M_}`,LU=`hide${M_}`,zU=`hidden${M_}`,OU=`click${M_}${PU}`,Ib="show",lf="collapse",Zy="collapsing",kU="collapsed",FU=`:scope .${lf} .${lf}`,BU="collapse-horizontal",NU="width",VU="height",UU=".collapse.show, .collapse.collapsing",r1='[data-bs-toggle="collapse"]',jU={parent:null,toggle:!0},$U={parent:"(null|element)",toggle:"boolean"};class y_ extends da{constructor(s,c){super(s,c),this._isTransitioning=!1,this._triggerArray=[];const m=Wi.find(r1);for(const g of m){const b=Wi.getSelectorFromElement(g),E=Wi.find(b).filter(n=>n===this._element);b!==null&&E.length&&this._triggerArray.push(g)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return jU}static get DefaultType(){return $U}static get NAME(){return CU}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let s=[];if(this._config.parent&&(s=this._getFirstLevelChildren(UU).filter(n=>n!==this._element).map(n=>y_.getOrCreateInstance(n,{toggle:!1}))),s.length&&s[0]._isTransitioning||Xt.trigger(this._element,DU).defaultPrevented)return;for(const n of s)n.hide();const m=this._getDimension();this._element.classList.remove(lf),this._element.classList.add(Zy),this._element.style[m]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const g=()=>{this._isTransitioning=!1,this._element.classList.remove(Zy),this._element.classList.add(lf,Ib),this._element.style[m]="",Xt.trigger(this._element,RU)},E=`scroll${m[0].toUpperCase()+m.slice(1)}`;this._queueCallback(g,this._element,!0),this._element.style[m]=`${this._element[E]}px`}hide(){if(this._isTransitioning||!this._isShown()||Xt.trigger(this._element,LU).defaultPrevented)return;const c=this._getDimension();this._element.style[c]=`${this._element.getBoundingClientRect()[c]}px`,A_(this._element),this._element.classList.add(Zy),this._element.classList.remove(lf,Ib);for(const g of this._triggerArray){const b=Wi.getElementFromSelector(g);b&&!this._isShown(b)&&this._addAriaAndCollapsedClass([g],!1)}this._isTransitioning=!0;const m=()=>{this._isTransitioning=!1,this._element.classList.remove(Zy),this._element.classList.add(lf),Xt.trigger(this._element,zU)};this._element.style[c]="",this._queueCallback(m,this._element,!0)}_isShown(s=this._element){return s.classList.contains(Ib)}_configAfterMerge(s){return s.toggle=!!s.toggle,s.parent=Hc(s.parent),s}_getDimension(){return this._element.classList.contains(BU)?NU:VU}_initializeChildren(){if(!this._config.parent)return;const s=this._getFirstLevelChildren(r1);for(const c of s){const m=Wi.getElementFromSelector(c);m&&this._addAriaAndCollapsedClass([c],this._isShown(m))}}_getFirstLevelChildren(s){const c=Wi.find(FU,this._config.parent);return Wi.find(s,this._config.parent).filter(m=>!c.includes(m))}_addAriaAndCollapsedClass(s,c){if(s.length)for(const m of s)m.classList.toggle(kU,!c),m.setAttribute("aria-expanded",c)}static jQueryInterface(s){const c={};return typeof s=="string"&&/show|hide/.test(s)&&(c.toggle=!1),this.each(function(){const m=y_.getOrCreateInstance(this,c);if(typeof s=="string"){if(typeof m[s]>"u")throw new TypeError(`No method named "${s}"`);m[s]()}})}}Xt.on(document,OU,r1,function(a){(a.target.tagName==="A"||a.delegateTarget&&a.delegateTarget.tagName==="A")&&a.preventDefault();for(const s of Wi.getMultipleElementsFromSelector(this))y_.getOrCreateInstance(s,{toggle:!1}).toggle()});Uo(y_);const fI="dropdown",GU="bs.dropdown",Mu=`.${GU}`,hw=".data-api",HU="Escape",pI="Tab",WU="ArrowUp",mI="ArrowDown",qU=2,ZU=`hide${Mu}`,XU=`hidden${Mu}`,YU=`show${Mu}`,KU=`shown${Mu}`,VP=`click${Mu}${hw}`,UP=`keydown${Mu}${hw}`,JU=`keyup${Mu}${hw}`,of="show",QU="dropup",e6="dropend",t6="dropstart",i6="dropup-center",n6="dropdown-center",_u='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',s6=`${_u}.${of}`,ux=".dropdown-menu",r6=".navbar",o6=".navbar-nav",a6=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",l6=No()?"top-end":"top-start",c6=No()?"top-start":"top-end",h6=No()?"bottom-end":"bottom-start",u6=No()?"bottom-start":"bottom-end",d6=No()?"left-start":"right-start",f6=No()?"right-start":"left-start",p6="top",m6="bottom",_6={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},g6={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class Wa extends da{constructor(s,c){super(s,c),this._popper=null,this._parent=this._element.parentNode,this._menu=Wi.next(this._element,ux)[0]||Wi.prev(this._element,ux)[0]||Wi.findOne(ux,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return _6}static get DefaultType(){return g6}static get NAME(){return fI}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Wc(this._element)||this._isShown())return;const s={relatedTarget:this._element};if(!Xt.trigger(this._element,YU,s).defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(o6))for(const m of[].concat(...document.body.children))Xt.on(m,"mouseover",Px);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(of),this._element.classList.add(of),Xt.trigger(this._element,KU,s)}}hide(){if(Wc(this._element)||!this._isShown())return;const s={relatedTarget:this._element};this._completeHide(s)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(s){if(!Xt.trigger(this._element,ZU,s).defaultPrevented){if("ontouchstart"in document.documentElement)for(const m of[].concat(...document.body.children))Xt.off(m,"mouseover",Px);this._popper&&this._popper.destroy(),this._menu.classList.remove(of),this._element.classList.remove(of),this._element.setAttribute("aria-expanded","false"),zl.removeDataAttribute(this._menu,"popper"),Xt.trigger(this._element,XU,s),this._element.focus()}}_getConfig(s){if(s=super._getConfig(s),typeof s.reference=="object"&&!Ll(s.reference)&&typeof s.reference.getBoundingClientRect!="function")throw new TypeError(`${fI.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return s}_createPopper(){if(typeof TP>"u")throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org/docs/v2/)");let s=this._element;this._config.reference==="parent"?s=this._parent:Ll(this._config.reference)?s=Hc(this._config.reference):typeof this._config.reference=="object"&&(s=this._config.reference);const c=this._getPopperConfig();this._popper=aw(s,this._menu,c)}_isShown(){return this._menu.classList.contains(of)}_getPlacement(){const s=this._parent;if(s.classList.contains(e6))return d6;if(s.classList.contains(t6))return f6;if(s.classList.contains(i6))return p6;if(s.classList.contains(n6))return m6;const c=getComputedStyle(this._menu).getPropertyValue("--bs-position").trim()==="end";return s.classList.contains(QU)?c?c6:l6:c?u6:h6}_detectNavbar(){return this._element.closest(r6)!==null}_getOffset(){const{offset:s}=this._config;return typeof s=="string"?s.split(",").map(c=>Number.parseInt(c,10)):typeof s=="function"?c=>s(c,this._element):s}_getPopperConfig(){const s={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||this._config.display==="static")&&(zl.setDataAttribute(this._menu,"popper","static"),s.modifiers=[{name:"applyStyles",enabled:!1}]),{...s,...io(this._config.popperConfig,[void 0,s])}}_selectMenuItem({key:s,target:c}){const m=Wi.find(a6,this._menu).filter(g=>Ff(g));m.length&&lw(m,c,s===mI,!m.includes(c)).focus()}static jQueryInterface(s){return this.each(function(){const c=Wa.getOrCreateInstance(this,s);if(typeof s=="string"){if(typeof c[s]>"u")throw new TypeError(`No method named "${s}"`);c[s]()}})}static clearMenus(s){if(s.button===qU||s.type==="keyup"&&s.key!==pI)return;const c=Wi.find(s6);for(const m of c){const g=Wa.getInstance(m);if(!g||g._config.autoClose===!1)continue;const b=s.composedPath(),E=b.includes(g._menu);if(b.includes(g._element)||g._config.autoClose==="inside"&&!E||g._config.autoClose==="outside"&&E||g._menu.contains(s.target)&&(s.type==="keyup"&&s.key===pI||/input|select|option|textarea|form/i.test(s.target.tagName)))continue;const n={relatedTarget:g._element};s.type==="click"&&(n.clickEvent=s),g._completeHide(n)}}static dataApiKeydownHandler(s){const c=/input|textarea/i.test(s.target.tagName),m=s.key===HU,g=[WU,mI].includes(s.key);if(!g&&!m||c&&!m)return;s.preventDefault();const b=this.matches(_u)?this:Wi.prev(this,_u)[0]||Wi.next(this,_u)[0]||Wi.findOne(_u,s.delegateTarget.parentNode),E=Wa.getOrCreateInstance(b);if(g){s.stopPropagation(),E.show(),E._selectMenuItem(s);return}E._isShown()&&(s.stopPropagation(),E.hide(),b.focus())}}Xt.on(document,UP,_u,Wa.dataApiKeydownHandler);Xt.on(document,UP,ux,Wa.dataApiKeydownHandler);Xt.on(document,VP,Wa.clearMenus);Xt.on(document,JU,Wa.clearMenus);Xt.on(document,VP,_u,function(a){a.preventDefault(),Wa.getOrCreateInstance(this).toggle()});Uo(Wa);const jP="backdrop",y6="fade",_I="show",gI=`mousedown.bs.${jP}`,x6={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},v6={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class $P extends I_{constructor(s){super(),this._config=this._getConfig(s),this._isAppended=!1,this._element=null}static get Default(){return x6}static get DefaultType(){return v6}static get NAME(){return jP}show(s){if(!this._config.isVisible){io(s);return}this._append();const c=this._getElement();this._config.isAnimated&&A_(c),c.classList.add(_I),this._emulateAnimation(()=>{io(s)})}hide(s){if(!this._config.isVisible){io(s);return}this._getElement().classList.remove(_I),this._emulateAnimation(()=>{this.dispose(),io(s)})}dispose(){this._isAppended&&(Xt.off(this._element,gI),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const s=document.createElement("div");s.className=this._config.className,this._config.isAnimated&&s.classList.add(y6),this._element=s}return this._element}_configAfterMerge(s){return s.rootElement=Hc(s.rootElement),s}_append(){if(this._isAppended)return;const s=this._getElement();this._config.rootElement.append(s),Xt.on(s,gI,()=>{io(this._config.clickCallback)}),this._isAppended=!0}_emulateAnimation(s){CP(s,this._getElement(),this._config.isAnimated)}}const b6="focustrap",w6="bs.focustrap",Rx=`.${w6}`,T6=`focusin${Rx}`,S6=`keydown.tab${Rx}`,E6="Tab",A6="forward",yI="backward",I6={autofocus:!0,trapElement:null},C6={autofocus:"boolean",trapElement:"element"};class GP extends I_{constructor(s){super(),this._config=this._getConfig(s),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return I6}static get DefaultType(){return C6}static get NAME(){return b6}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),Xt.off(document,Rx),Xt.on(document,T6,s=>this._handleFocusin(s)),Xt.on(document,S6,s=>this._handleKeydown(s)),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,Xt.off(document,Rx))}_handleFocusin(s){const{trapElement:c}=this._config;if(s.target===document||s.target===c||c.contains(s.target))return;const m=Wi.focusableChildren(c);m.length===0?c.focus():this._lastTabNavDirection===yI?m[m.length-1].focus():m[0].focus()}_handleKeydown(s){s.key===E6&&(this._lastTabNavDirection=s.shiftKey?yI:A6)}}const xI=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",vI=".sticky-top",Xy="padding-right",bI="margin-right";class o1{constructor(){this._element=document.body}getWidth(){const s=document.documentElement.clientWidth;return Math.abs(window.innerWidth-s)}hide(){const s=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Xy,c=>c+s),this._setElementAttributes(xI,Xy,c=>c+s),this._setElementAttributes(vI,bI,c=>c-s)}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Xy),this._resetElementAttributes(xI,Xy),this._resetElementAttributes(vI,bI)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(s,c,m){const g=this.getWidth(),b=E=>{if(E!==this._element&&window.innerWidth>E.clientWidth+g)return;this._saveInitialAttribute(E,c);const n=window.getComputedStyle(E).getPropertyValue(c);E.style.setProperty(c,`${m(Number.parseFloat(n))}px`)};this._applyManipulationCallback(s,b)}_saveInitialAttribute(s,c){const m=s.style.getPropertyValue(c);m&&zl.setDataAttribute(s,c,m)}_resetElementAttributes(s,c){const m=g=>{const b=zl.getDataAttribute(g,c);if(b===null){g.style.removeProperty(c);return}zl.removeDataAttribute(g,c),g.style.setProperty(c,b)};this._applyManipulationCallback(s,m)}_applyManipulationCallback(s,c){if(Ll(s)){c(s);return}for(const m of Wi.find(s,this._element))c(m)}}const M6="modal",P6="bs.modal",Vo=`.${P6}`,D6=".data-api",R6="Escape",L6=`hide${Vo}`,z6=`hidePrevented${Vo}`,HP=`hidden${Vo}`,WP=`show${Vo}`,O6=`shown${Vo}`,k6=`resize${Vo}`,F6=`click.dismiss${Vo}`,B6=`mousedown.dismiss${Vo}`,N6=`keydown.dismiss${Vo}`,V6=`click${Vo}${D6}`,wI="modal-open",U6="fade",TI="show",Cb="modal-static",j6=".modal.show",$6=".modal-dialog",G6=".modal-body",H6='[data-bs-toggle="modal"]',W6={backdrop:!0,focus:!0,keyboard:!0},q6={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Pf extends da{constructor(s,c){super(s,c),this._dialog=Wi.findOne($6,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new o1,this._addEventListeners()}static get Default(){return W6}static get DefaultType(){return q6}static get NAME(){return M6}toggle(s){return this._isShown?this.hide():this.show(s)}show(s){this._isShown||this._isTransitioning||Xt.trigger(this._element,WP,{relatedTarget:s}).defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(wI),this._adjustDialog(),this._backdrop.show(()=>this._showElement(s)))}hide(){!this._isShown||this._isTransitioning||Xt.trigger(this._element,L6).defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(TI),this._queueCallback(()=>this._hideModal(),this._element,this._isAnimated()))}dispose(){Xt.off(window,Vo),Xt.off(this._dialog,Vo),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new $P({isVisible:!!this._config.backdrop,isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new GP({trapElement:this._element})}_showElement(s){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const c=Wi.findOne(G6,this._dialog);c&&(c.scrollTop=0),A_(this._element),this._element.classList.add(TI);const m=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,Xt.trigger(this._element,O6,{relatedTarget:s})};this._queueCallback(m,this._dialog,this._isAnimated())}_addEventListeners(){Xt.on(this._element,N6,s=>{if(s.key===R6){if(this._config.keyboard){this.hide();return}this._triggerBackdropTransition()}}),Xt.on(window,k6,()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()}),Xt.on(this._element,B6,s=>{Xt.one(this._element,F6,c=>{if(!(this._element!==s.target||this._element!==c.target)){if(this._config.backdrop==="static"){this._triggerBackdropTransition();return}this._config.backdrop&&this.hide()}})})}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide(()=>{document.body.classList.remove(wI),this._resetAdjustments(),this._scrollBar.reset(),Xt.trigger(this._element,HP)})}_isAnimated(){return this._element.classList.contains(U6)}_triggerBackdropTransition(){if(Xt.trigger(this._element,z6).defaultPrevented)return;const c=this._element.scrollHeight>document.documentElement.clientHeight,m=this._element.style.overflowY;m==="hidden"||this._element.classList.contains(Cb)||(c||(this._element.style.overflowY="hidden"),this._element.classList.add(Cb),this._queueCallback(()=>{this._element.classList.remove(Cb),this._queueCallback(()=>{this._element.style.overflowY=m},this._dialog)},this._dialog),this._element.focus())}_adjustDialog(){const s=this._element.scrollHeight>document.documentElement.clientHeight,c=this._scrollBar.getWidth(),m=c>0;if(m&&!s){const g=No()?"paddingLeft":"paddingRight";this._element.style[g]=`${c}px`}if(!m&&s){const g=No()?"paddingRight":"paddingLeft";this._element.style[g]=`${c}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(s,c){return this.each(function(){const m=Pf.getOrCreateInstance(this,s);if(typeof s=="string"){if(typeof m[s]>"u")throw new TypeError(`No method named "${s}"`);m[s](c)}})}}Xt.on(document,V6,H6,function(a){const s=Wi.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&a.preventDefault(),Xt.one(s,WP,g=>{g.defaultPrevented||Xt.one(s,HP,()=>{Ff(this)&&this.focus()})});const c=Wi.findOne(j6);c&&Pf.getInstance(c).hide(),Pf.getOrCreateInstance(s).toggle(this)});Zx(Pf);Uo(Pf);const Z6="offcanvas",X6="bs.offcanvas",Nl=`.${X6}`,qP=".data-api",Y6=`load${Nl}${qP}`,K6="Escape",SI="show",EI="showing",AI="hiding",J6="offcanvas-backdrop",ZP=".offcanvas.show",Q6=`show${Nl}`,ej=`shown${Nl}`,tj=`hide${Nl}`,II=`hidePrevented${Nl}`,XP=`hidden${Nl}`,ij=`resize${Nl}`,nj=`click${Nl}${qP}`,sj=`keydown.dismiss${Nl}`,rj='[data-bs-toggle="offcanvas"]',oj={backdrop:!0,keyboard:!0,scroll:!1},aj={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class qc extends da{constructor(s,c){super(s,c),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return oj}static get DefaultType(){return aj}static get NAME(){return Z6}toggle(s){return this._isShown?this.hide():this.show(s)}show(s){if(this._isShown||Xt.trigger(this._element,Q6,{relatedTarget:s}).defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||new o1().hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(EI);const m=()=>{(!this._config.scroll||this._config.backdrop)&&this._focustrap.activate(),this._element.classList.add(SI),this._element.classList.remove(EI),Xt.trigger(this._element,ej,{relatedTarget:s})};this._queueCallback(m,this._element,!0)}hide(){if(!this._isShown||Xt.trigger(this._element,tj).defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(AI),this._backdrop.hide();const c=()=>{this._element.classList.remove(SI,AI),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||new o1().reset(),Xt.trigger(this._element,XP)};this._queueCallback(c,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const s=()=>{if(this._config.backdrop==="static"){Xt.trigger(this._element,II);return}this.hide()},c=!!this._config.backdrop;return new $P({className:J6,isVisible:c,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:c?s:null})}_initializeFocusTrap(){return new GP({trapElement:this._element})}_addEventListeners(){Xt.on(this._element,sj,s=>{if(s.key===K6){if(this._config.keyboard){this.hide();return}Xt.trigger(this._element,II)}})}static jQueryInterface(s){return this.each(function(){const c=qc.getOrCreateInstance(this,s);if(typeof s=="string"){if(c[s]===void 0||s.startsWith("_")||s==="constructor")throw new TypeError(`No method named "${s}"`);c[s](this)}})}}Xt.on(document,nj,rj,function(a){const s=Wi.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&a.preventDefault(),Wc(this))return;Xt.one(s,XP,()=>{Ff(this)&&this.focus()});const c=Wi.findOne(ZP);c&&c!==s&&qc.getInstance(c).hide(),qc.getOrCreateInstance(s).toggle(this)});Xt.on(window,Y6,()=>{for(const a of Wi.find(ZP))qc.getOrCreateInstance(a).show()});Xt.on(window,ij,()=>{for(const a of Wi.find("[aria-modal][class*=show][class*=offcanvas-]"))getComputedStyle(a).position!=="fixed"&&qc.getOrCreateInstance(a).hide()});Zx(qc);Uo(qc);const lj=/^aria-[\w-]*$/i,YP={"*":["class","dir","id","lang","role",lj],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},cj=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),hj=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,uj=(a,s)=>{const c=a.nodeName.toLowerCase();return s.includes(c)?cj.has(c)?!!hj.test(a.nodeValue):!0:s.filter(m=>m instanceof RegExp).some(m=>m.test(c))};function dj(a,s,c){if(!a.length)return a;if(c&&typeof c=="function")return c(a);const g=new window.DOMParser().parseFromString(a,"text/html"),b=[].concat(...g.body.querySelectorAll("*"));for(const E of b){const n=E.nodeName.toLowerCase();if(!Object.keys(s).includes(n)){E.remove();continue}const R=[].concat(...E.attributes),B=[].concat(s["*"]||[],s[n]||[]);for(const N of R)uj(N,B)||E.removeAttribute(N.nodeName)}return g.body.innerHTML}const fj="TemplateFactory",pj={allowList:YP,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},mj={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},_j={entry:"(string|element|function|null)",selector:"(string|element)"};class gj extends I_{constructor(s){super(),this._config=this._getConfig(s)}static get Default(){return pj}static get DefaultType(){return mj}static get NAME(){return fj}getContent(){return Object.values(this._config.content).map(s=>this._resolvePossibleFunction(s)).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(s){return this._checkContent(s),this._config.content={...this._config.content,...s},this}toHtml(){const s=document.createElement("div");s.innerHTML=this._maybeSanitize(this._config.template);for(const[g,b]of Object.entries(this._config.content))this._setContent(s,b,g);const c=s.children[0],m=this._resolvePossibleFunction(this._config.extraClass);return m&&c.classList.add(...m.split(" ")),c}_typeCheckConfig(s){super._typeCheckConfig(s),this._checkContent(s.content)}_checkContent(s){for(const[c,m]of Object.entries(s))super._typeCheckConfig({selector:c,entry:m},_j)}_setContent(s,c,m){const g=Wi.findOne(m,s);if(g){if(c=this._resolvePossibleFunction(c),!c){g.remove();return}if(Ll(c)){this._putElementInTemplate(Hc(c),g);return}if(this._config.html){g.innerHTML=this._maybeSanitize(c);return}g.textContent=c}}_maybeSanitize(s){return this._config.sanitize?dj(s,this._config.allowList,this._config.sanitizeFn):s}_resolvePossibleFunction(s){return io(s,[void 0,this])}_putElementInTemplate(s,c){if(this._config.html){c.innerHTML="",c.append(s);return}c.textContent=s.textContent}}const yj="tooltip",xj=new Set(["sanitize","allowList","sanitizeFn"]),Mb="fade",vj="modal",Yy="show",bj=".tooltip-inner",CI=`.${vj}`,MI="hide.bs.modal",Bm="hover",Pb="focus",Db="click",wj="manual",Tj="hide",Sj="hidden",Ej="show",Aj="shown",Ij="inserted",Cj="click",Mj="focusin",Pj="focusout",Dj="mouseenter",Rj="mouseleave",Lj={AUTO:"auto",TOP:"top",RIGHT:No()?"left":"right",BOTTOM:"bottom",LEFT:No()?"right":"left"},zj={allowList:YP,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Oj={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Nf extends da{constructor(s,c){if(typeof TP>"u")throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org/docs/v2/)");super(s,c),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return zj}static get DefaultType(){return Oj}static get NAME(){return yj}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){if(this._isEnabled){if(this._isShown()){this._leave();return}this._enter()}}dispose(){clearTimeout(this._timeout),Xt.off(this._element.closest(CI),MI,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if(this._element.style.display==="none")throw new Error("Please use show on visible elements");if(!(this._isWithContent()&&this._isEnabled))return;const s=Xt.trigger(this._element,this.constructor.eventName(Ej)),m=(AP(this._element)||this._element.ownerDocument.documentElement).contains(this._element);if(s.defaultPrevented||!m)return;this._disposePopper();const g=this._getTipElement();this._element.setAttribute("aria-describedby",g.getAttribute("id"));const{container:b}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(b.append(g),Xt.trigger(this._element,this.constructor.eventName(Ij))),this._popper=this._createPopper(g),g.classList.add(Yy),"ontouchstart"in document.documentElement)for(const n of[].concat(...document.body.children))Xt.on(n,"mouseover",Px);const E=()=>{Xt.trigger(this._element,this.constructor.eventName(Aj)),this._isHovered===!1&&this._leave(),this._isHovered=!1};this._queueCallback(E,this.tip,this._isAnimated())}hide(){if(!this._isShown()||Xt.trigger(this._element,this.constructor.eventName(Tj)).defaultPrevented)return;if(this._getTipElement().classList.remove(Yy),"ontouchstart"in document.documentElement)for(const g of[].concat(...document.body.children))Xt.off(g,"mouseover",Px);this._activeTrigger[Db]=!1,this._activeTrigger[Pb]=!1,this._activeTrigger[Bm]=!1,this._isHovered=null;const m=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),Xt.trigger(this._element,this.constructor.eventName(Sj)))};this._queueCallback(m,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return!!this._getTitle()}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(s){const c=this._getTemplateFactory(s).toHtml();if(!c)return null;c.classList.remove(Mb,Yy),c.classList.add(`bs-${this.constructor.NAME}-auto`);const m=wV(this.constructor.NAME).toString();return c.setAttribute("id",m),this._isAnimated()&&c.classList.add(Mb),c}setContent(s){this._newContent=s,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(s){return this._templateFactory?this._templateFactory.changeContent(s):this._templateFactory=new gj({...this._config,content:s,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[bj]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(s){return this.constructor.getOrCreateInstance(s.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(Mb)}_isShown(){return this.tip&&this.tip.classList.contains(Yy)}_createPopper(s){const c=io(this._config.placement,[this,s,this._element]),m=Lj[c.toUpperCase()];return aw(this._element,s,this._getPopperConfig(m))}_getOffset(){const{offset:s}=this._config;return typeof s=="string"?s.split(",").map(c=>Number.parseInt(c,10)):typeof s=="function"?c=>s(c,this._element):s}_resolvePossibleFunction(s){return io(s,[this._element,this._element])}_getPopperConfig(s){const c={placement:s,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:m=>{this._getTipElement().setAttribute("data-popper-placement",m.state.placement)}}]};return{...c,...io(this._config.popperConfig,[void 0,c])}}_setListeners(){const s=this._config.trigger.split(" ");for(const c of s)if(c==="click")Xt.on(this._element,this.constructor.eventName(Cj),this._config.selector,m=>{const g=this._initializeOnDelegatedTarget(m);g._activeTrigger[Db]=!(g._isShown()&&g._activeTrigger[Db]),g.toggle()});else if(c!==wj){const m=c===Bm?this.constructor.eventName(Dj):this.constructor.eventName(Mj),g=c===Bm?this.constructor.eventName(Rj):this.constructor.eventName(Pj);Xt.on(this._element,m,this._config.selector,b=>{const E=this._initializeOnDelegatedTarget(b);E._activeTrigger[b.type==="focusin"?Pb:Bm]=!0,E._enter()}),Xt.on(this._element,g,this._config.selector,b=>{const E=this._initializeOnDelegatedTarget(b);E._activeTrigger[b.type==="focusout"?Pb:Bm]=E._element.contains(b.relatedTarget),E._leave()})}this._hideModalHandler=()=>{this._element&&this.hide()},Xt.on(this._element.closest(CI),MI,this._hideModalHandler)}_fixTitle(){const s=this._element.getAttribute("title");s&&(!this._element.getAttribute("aria-label")&&!this._element.textContent.trim()&&this._element.setAttribute("aria-label",s),this._element.setAttribute("data-bs-original-title",s),this._element.removeAttribute("title"))}_enter(){if(this._isShown()||this._isHovered){this._isHovered=!0;return}this._isHovered=!0,this._setTimeout(()=>{this._isHovered&&this.show()},this._config.delay.show)}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout(()=>{this._isHovered||this.hide()},this._config.delay.hide))}_setTimeout(s,c){clearTimeout(this._timeout),this._timeout=setTimeout(s,c)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(s){const c=zl.getDataAttributes(this._element);for(const m of Object.keys(c))xj.has(m)&&delete c[m];return s={...c,...typeof s=="object"&&s?s:{}},s=this._mergeConfigObj(s),s=this._configAfterMerge(s),this._typeCheckConfig(s),s}_configAfterMerge(s){return s.container=s.container===!1?document.body:Hc(s.container),typeof s.delay=="number"&&(s.delay={show:s.delay,hide:s.delay}),typeof s.title=="number"&&(s.title=s.title.toString()),typeof s.content=="number"&&(s.content=s.content.toString()),s}_getDelegateConfig(){const s={};for(const[c,m]of Object.entries(this._config))this.constructor.Default[c]!==m&&(s[c]=m);return s.selector=!1,s.trigger="manual",s}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(s){return this.each(function(){const c=Nf.getOrCreateInstance(this,s);if(typeof s=="string"){if(typeof c[s]>"u")throw new TypeError(`No method named "${s}"`);c[s]()}})}}Uo(Nf);const kj="popover",Fj=".popover-header",Bj=".popover-body",Nj={...Nf.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},Vj={...Nf.DefaultType,content:"(null|string|element|function)"};class uw extends Nf{static get Default(){return Nj}static get DefaultType(){return Vj}static get NAME(){return kj}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Fj]:this._getTitle(),[Bj]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(s){return this.each(function(){const c=uw.getOrCreateInstance(this,s);if(typeof s=="string"){if(typeof c[s]>"u")throw new TypeError(`No method named "${s}"`);c[s]()}})}}Uo(uw);const Uj="scrollspy",jj="bs.scrollspy",dw=`.${jj}`,$j=".data-api",Gj=`activate${dw}`,PI=`click${dw}`,Hj=`load${dw}${$j}`,Wj="dropdown-item",tf="active",qj='[data-bs-spy="scroll"]',Rb="[href]",Zj=".nav, .list-group",DI=".nav-link",Xj=".nav-item",Yj=".list-group-item",Kj=`${DI}, ${Xj} > ${DI}, ${Yj}`,Jj=".dropdown",Qj=".dropdown-toggle",e8={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},t8={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class Kx extends da{constructor(s,c){super(s,c),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement=getComputedStyle(this._element).overflowY==="visible"?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return e8}static get DefaultType(){return t8}static get NAME(){return Uj}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const s of this._observableSections.values())this._observer.observe(s)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(s){return s.target=Hc(s.target)||document.body,s.rootMargin=s.offset?`${s.offset}px 0px -30%`:s.rootMargin,typeof s.threshold=="string"&&(s.threshold=s.threshold.split(",").map(c=>Number.parseFloat(c))),s}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(Xt.off(this._config.target,PI),Xt.on(this._config.target,PI,Rb,s=>{const c=this._observableSections.get(s.target.hash);if(c){s.preventDefault();const m=this._rootElement||window,g=c.offsetTop-this._element.offsetTop;if(m.scrollTo){m.scrollTo({top:g,behavior:"smooth"});return}m.scrollTop=g}}))}_getNewObserver(){const s={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver(c=>this._observerCallback(c),s)}_observerCallback(s){const c=E=>this._targetLinks.get(`#${E.target.id}`),m=E=>{this._previousScrollData.visibleEntryTop=E.target.offsetTop,this._process(c(E))},g=(this._rootElement||document.documentElement).scrollTop,b=g>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=g;for(const E of s){if(!E.isIntersecting){this._activeTarget=null,this._clearActiveClass(c(E));continue}const n=E.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(b&&n){if(m(E),!g)return;continue}!b&&!n&&m(E)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const s=Wi.find(Rb,this._config.target);for(const c of s){if(!c.hash||Wc(c))continue;const m=Wi.findOne(decodeURI(c.hash),this._element);Ff(m)&&(this._targetLinks.set(decodeURI(c.hash),c),this._observableSections.set(c.hash,m))}}_process(s){this._activeTarget!==s&&(this._clearActiveClass(this._config.target),this._activeTarget=s,s.classList.add(tf),this._activateParents(s),Xt.trigger(this._element,Gj,{relatedTarget:s}))}_activateParents(s){if(s.classList.contains(Wj)){Wi.findOne(Qj,s.closest(Jj)).classList.add(tf);return}for(const c of Wi.parents(s,Zj))for(const m of Wi.prev(c,Kj))m.classList.add(tf)}_clearActiveClass(s){s.classList.remove(tf);const c=Wi.find(`${Rb}.${tf}`,s);for(const m of c)m.classList.remove(tf)}static jQueryInterface(s){return this.each(function(){const c=Kx.getOrCreateInstance(this,s);if(typeof s=="string"){if(c[s]===void 0||s.startsWith("_")||s==="constructor")throw new TypeError(`No method named "${s}"`);c[s]()}})}}Xt.on(window,Hj,()=>{for(const a of Wi.find(qj))Kx.getOrCreateInstance(a)});Uo(Kx);const i8="tab",n8="bs.tab",Pu=`.${n8}`,s8=`hide${Pu}`,r8=`hidden${Pu}`,o8=`show${Pu}`,a8=`shown${Pu}`,l8=`click${Pu}`,c8=`keydown${Pu}`,h8=`load${Pu}`,u8="ArrowLeft",RI="ArrowRight",d8="ArrowUp",LI="ArrowDown",Lb="Home",zI="End",gu="active",OI="fade",zb="show",f8="dropdown",KP=".dropdown-toggle",p8=".dropdown-menu",Ob=`:not(${KP})`,m8='.list-group, .nav, [role="tablist"]',_8=".nav-item, .list-group-item",g8=`.nav-link${Ob}, .list-group-item${Ob}, [role="tab"]${Ob}`,JP='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',kb=`${g8}, ${JP}`,y8=`.${gu}[data-bs-toggle="tab"], .${gu}[data-bs-toggle="pill"], .${gu}[data-bs-toggle="list"]`;class Df extends da{constructor(s){super(s),this._parent=this._element.closest(m8),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),Xt.on(this._element,c8,c=>this._keydown(c)))}static get NAME(){return i8}show(){const s=this._element;if(this._elemIsActive(s))return;const c=this._getActiveElem(),m=c?Xt.trigger(c,s8,{relatedTarget:s}):null;Xt.trigger(s,o8,{relatedTarget:c}).defaultPrevented||m&&m.defaultPrevented||(this._deactivate(c,s),this._activate(s,c))}_activate(s,c){if(!s)return;s.classList.add(gu),this._activate(Wi.getElementFromSelector(s));const m=()=>{if(s.getAttribute("role")!=="tab"){s.classList.add(zb);return}s.removeAttribute("tabindex"),s.setAttribute("aria-selected",!0),this._toggleDropDown(s,!0),Xt.trigger(s,a8,{relatedTarget:c})};this._queueCallback(m,s,s.classList.contains(OI))}_deactivate(s,c){if(!s)return;s.classList.remove(gu),s.blur(),this._deactivate(Wi.getElementFromSelector(s));const m=()=>{if(s.getAttribute("role")!=="tab"){s.classList.remove(zb);return}s.setAttribute("aria-selected",!1),s.setAttribute("tabindex","-1"),this._toggleDropDown(s,!1),Xt.trigger(s,r8,{relatedTarget:c})};this._queueCallback(m,s,s.classList.contains(OI))}_keydown(s){if(![u8,RI,d8,LI,Lb,zI].includes(s.key))return;s.stopPropagation(),s.preventDefault();const c=this._getChildren().filter(g=>!Wc(g));let m;if([Lb,zI].includes(s.key))m=c[s.key===Lb?0:c.length-1];else{const g=[RI,LI].includes(s.key);m=lw(c,s.target,g,!0)}m&&(m.focus({preventScroll:!0}),Df.getOrCreateInstance(m).show())}_getChildren(){return Wi.find(kb,this._parent)}_getActiveElem(){return this._getChildren().find(s=>this._elemIsActive(s))||null}_setInitialAttributes(s,c){this._setAttributeIfNotExists(s,"role","tablist");for(const m of c)this._setInitialAttributesOnChild(m)}_setInitialAttributesOnChild(s){s=this._getInnerElement(s);const c=this._elemIsActive(s),m=this._getOuterElement(s);s.setAttribute("aria-selected",c),m!==s&&this._setAttributeIfNotExists(m,"role","presentation"),c||s.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(s,"role","tab"),this._setInitialAttributesOnTargetPanel(s)}_setInitialAttributesOnTargetPanel(s){const c=Wi.getElementFromSelector(s);c&&(this._setAttributeIfNotExists(c,"role","tabpanel"),s.id&&this._setAttributeIfNotExists(c,"aria-labelledby",`${s.id}`))}_toggleDropDown(s,c){const m=this._getOuterElement(s);if(!m.classList.contains(f8))return;const g=(b,E)=>{const n=Wi.findOne(b,m);n&&n.classList.toggle(E,c)};g(KP,gu),g(p8,zb),m.setAttribute("aria-expanded",c)}_setAttributeIfNotExists(s,c,m){s.hasAttribute(c)||s.setAttribute(c,m)}_elemIsActive(s){return s.classList.contains(gu)}_getInnerElement(s){return s.matches(kb)?s:Wi.findOne(kb,s)}_getOuterElement(s){return s.closest(_8)||s}static jQueryInterface(s){return this.each(function(){const c=Df.getOrCreateInstance(this);if(typeof s=="string"){if(c[s]===void 0||s.startsWith("_")||s==="constructor")throw new TypeError(`No method named "${s}"`);c[s]()}})}}Xt.on(document,l8,JP,function(a){["A","AREA"].includes(this.tagName)&&a.preventDefault(),!Wc(this)&&Df.getOrCreateInstance(this).show()});Xt.on(window,h8,()=>{for(const a of Wi.find(y8))Df.getOrCreateInstance(a)});Uo(Df);const x8="toast",v8="bs.toast",Jc=`.${v8}`,b8=`mouseover${Jc}`,w8=`mouseout${Jc}`,T8=`focusin${Jc}`,S8=`focusout${Jc}`,E8=`hide${Jc}`,A8=`hidden${Jc}`,I8=`show${Jc}`,C8=`shown${Jc}`,M8="fade",kI="hide",Ky="show",Jy="showing",P8={animation:"boolean",autohide:"boolean",delay:"number"},D8={animation:!0,autohide:!0,delay:5e3};class Jx extends da{constructor(s,c){super(s,c),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return D8}static get DefaultType(){return P8}static get NAME(){return x8}show(){if(Xt.trigger(this._element,I8).defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(M8);const c=()=>{this._element.classList.remove(Jy),Xt.trigger(this._element,C8),this._maybeScheduleHide()};this._element.classList.remove(kI),A_(this._element),this._element.classList.add(Ky,Jy),this._queueCallback(c,this._element,this._config.animation)}hide(){if(!this.isShown()||Xt.trigger(this._element,E8).defaultPrevented)return;const c=()=>{this._element.classList.add(kI),this._element.classList.remove(Jy,Ky),Xt.trigger(this._element,A8)};this._element.classList.add(Jy),this._queueCallback(c,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Ky),super.dispose()}isShown(){return this._element.classList.contains(Ky)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout(()=>{this.hide()},this._config.delay)))}_onInteraction(s,c){switch(s.type){case"mouseover":case"mouseout":{this._hasMouseInteraction=c;break}case"focusin":case"focusout":{this._hasKeyboardInteraction=c;break}}if(c){this._clearTimeout();return}const m=s.relatedTarget;this._element===m||this._element.contains(m)||this._maybeScheduleHide()}_setListeners(){Xt.on(this._element,b8,s=>this._onInteraction(s,!0)),Xt.on(this._element,w8,s=>this._onInteraction(s,!1)),Xt.on(this._element,T8,s=>this._onInteraction(s,!0)),Xt.on(this._element,S8,s=>this._onInteraction(s,!1))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(s){return this.each(function(){const c=Jx.getOrCreateInstance(this,s);if(typeof s=="string"){if(typeof c[s]>"u")throw new TypeError(`No method named "${s}"`);c[s](this)}})}}Zx(Jx);Uo(Jx);KC(R4).mount("#app");
